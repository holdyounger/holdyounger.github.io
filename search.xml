<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Retmote Registry 服务</title>
      <link href="/OS/Windows/%E6%9C%8D%E5%8A%A1/RemoteRegistry/"/>
      <url>/OS/Windows/%E6%9C%8D%E5%8A%A1/RemoteRegistry/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Remote Registry是什么服务？</p><blockquote><p>Remote Registry,翻译为”远程注册表”,如果远程的计算机连接到了你的计算机那么他可以通过字符界面或者其他方式远程修改注册表.这是一个相当严重的漏洞,可以为黑客入侵提供早期的方便(修改某些项目便于入侵,比如操作系统版本).</p></blockquote></blockquote><p>[toc]</p><h1 id="开启-Remote-Regustiy-服务"><a href="#开启-Remote-Regustiy-服务" class="headerlink" title="开启 Remote Regustiy 服务"></a>开启 Remote Regustiy 服务</h1><p>默认情况下，Windows 7 禁用远程注册表服务（可能是出于安全原因）。</p><h2 id="方法1-ui"><a href="#方法1-ui" class="headerlink" title="方法1 ui"></a>方法1 ui</h2><p>打开windows服务，在服务中修改 Remote Registry 服务的启动类型为手动，然后启动 Remote Registry 服务。</p><h2 id="方法2-命令行"><a href="#方法2-命令行" class="headerlink" title="方法2 命令行"></a>方法2 命令行</h2><ol><li>要从命令行启用它，请键入以下内容：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\computername config remoteregistry start= auto</span><br></pre></td></tr></table></figure><p>确保 &#x3D; 符号和 auto 之间有一个空格，<br>如果您在本地计算机上执行此操作，您可以删除 \computername 部分，<br>您也可以将“remoteregistry”替换为另一个服务来启用或禁用它。</p><p>启用该服务后，您可以重新启动计算机，或者立即使用以下命令启动它：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\computername start remoteregistry</span><br></pre></td></tr></table></figure><ol start="2"><li>使用ps工具</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc start remoteregistry start= auto</span><br></pre></td></tr></table></figure><ul><li>启动服务并将其设置为自动 </li><li>不需要启动服务</li></ul><h1 id="Remote-Registry服务可以关闭吗？"><a href="#Remote-Registry服务可以关闭吗？" class="headerlink" title="Remote Registry服务可以关闭吗？"></a>Remote Registry服务可以关闭吗？</h1><p>因此关闭这个服务没有什么害处,而益处很多.强烈建议关闭,并且禁用.另外系统中没有其他服务是依赖或者跟此服务有关联的，所以禁用之后不会对其他服务产生影响。</p><p>Remote Registry服务关闭方法：</p><p>1、按住键盘的“Win+R”快捷组合键，打开“运行”对话命令窗口，输入“services.msc”命令，点击“确定”；，如图：</p><p><img src="/../images/RemoteRegistry/20171206102840976.jpg" alt="img"></p><p>2、打开服务界面后找到“Remote Registry”选项，并左键双击打开其属性对话窗口；</p><p><img src="/../images/RemoteRegistry/20171206102840304.jpg" alt="img"></p><p>3、在打开的“Remote Registry 的属性”对话窗口中，在启动类型选项中选择“禁用”选项，再点击“应用”–“停止”–“确定”按钮保存设置即可解决问题。</p><p>以上就是Remote Registry服务的详细介绍了，小编强烈建议关闭此服务，因为注册表是一台电脑的核心数据库，我们必须保证自己核心数据库的安全。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 服务 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> registry </tag>
            
            <tag> 注册表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pdm用法整理</title>
      <link href="/Code/Python/pdm%E7%94%A8%E6%B3%95/"/>
      <url>/Code/Python/pdm%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/468445226">来了！划时代的 Python 包管理工具 – PDM - 知乎</a></p><h3 id="初始化-PDM-："><a href="#初始化-PDM-：" class="headerlink" title="初始化 PDM ："></a>初始化 PDM ：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdm init</span><br></pre></td></tr></table></figure><h3 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdm -h</span><br></pre></td></tr></table></figure><h3 id="切换python环境"><a href="#切换python环境" class="headerlink" title="切换python环境"></a>切换python环境</h3><p>当你在初始化 pdm 项目时，就已经选定了当前的 Python 版本和可用的 Python 版本范围，后面如果想更改，可以使用 use 命令，但版本要受之前设定的版本范围约束。</p><p>假设允许范围是 python 3.9+，当前使用的是 python 3.10，可以直接切换过去。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pdm use python3.9</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows权限(Privilege Constants)</title>
      <link href="/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/Privilege%20constants/"/>
      <url>/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/Privilege%20constants/</url>
      
        <content type="html"><![CDATA[<blockquote><p>windows 提权时常用的 Constants</p><p>微软官方文档：<a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/privilege-constants">Privilege Constants (Winnt.h) - Win32 apps | Microsoft Learn</a></p></blockquote><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><h2 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h2><table><thead><tr><th align="left">Constant&#x2F;value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><strong>SE_ASSIGNPRIMARYTOKEN_NAME</strong><br />TEXT(“SeAssignPrimaryTokenPrivilege”)</td><td align="left">Required to assign the <a href="https://learn.microsoft.com/en-us/windows/desktop/SecGloss/p-gly"><em>primary token</em></a> of a process. User Right: Replace a process-level token.</td></tr><tr><td align="left"><strong>SE_AUDIT_NAME</strong><br />TEXT(“SeAuditPrivilege”)</td><td align="left">Required to generate audit-log entries. Give this privilege to secure servers. User Right: Generate security audits.</td></tr><tr><td align="left"><strong>SE_BACKUP_NAME</strong><br />TEXT(“SeBackupPrivilege”)</td><td align="left">Required to perform backup operations. This privilege causes the system to grant all read access control to any file, regardless of the <a href="https://learn.microsoft.com/en-us/windows/desktop/SecGloss/a-gly"><em>access control list</em></a> (ACL) specified for the file. Any access request other than read is still evaluated with the ACL. This privilege is required by the <a href="https://learn.microsoft.com/en-us/windows/desktop/api/winreg/nf-winreg-regsavekeya"><strong>RegSaveKey</strong></a> and <a href="https://learn.microsoft.com/en-us/windows/desktop/api/winreg/nf-winreg-regsavekeyexa"><strong>RegSaveKeyEx</strong></a>functions. The following access rights are granted if this privilege is held: READ_CONTROLACCESS_SYSTEM_SECURITYFILE_GENERIC_READFILE_TRAVERSEUser Right: Back up files and directories. If the file is located on a removable drive and the “Audit Removable Storage” is enabled, the SE_SECURITY_NAME is required to have ACCESS_SYSTEM_SECURITY.</td></tr><tr><td align="left"><strong>SE_CHANGE_NOTIFY_NAME</strong><br />TEXT(“SeChangeNotifyPrivilege”)</td><td align="left">Required to receive notifications of changes to files or directories. This privilege also causes the system to skip all traversal access checks. It is enabled by default for all users. User Right: Bypass traverse checking.</td></tr><tr><td align="left"><strong>SE_CREATE_GLOBAL_NAME</strong><br />TEXT(“SeCreateGlobalPrivilege”)</td><td align="left">Required to create named file mapping objects in the global namespace during Terminal Services sessions. This privilege is enabled by default for administrators, services, and the local system account. User Right: Create global objects.</td></tr><tr><td align="left"><strong>SE_CREATE_PAGEFILE_NAME</strong><br />TEXT(“SeCreatePagefilePrivilege”)</td><td align="left">Required to create a paging file. User Right: Create a pagefile.</td></tr><tr><td align="left"><strong>SE_CREATE_PERMANENT_NAME</strong><br />TEXT(“SeCreatePermanentPrivilege”)</td><td align="left">Required to create a permanent object. User Right: Create permanent shared objects.</td></tr><tr><td align="left"><strong>SE_CREATE_SYMBOLIC_LINK_NAME</strong><br />TEXT(“SeCreateSymbolicLinkPrivilege”)</td><td align="left">Required to create a symbolic link. User Right: Create symbolic links.</td></tr><tr><td align="left">**SE_CREATE_TOKEN_NAME<br />**TEXT(“SeCreateTokenPrivilege”)</td><td align="left">Required to create a primary token. User Right: Create a token object. You cannot add this privilege to a user account with the “Create a token object” policy. Additionally, you cannot add this privilege to an owned process using Windows APIs.<strong>Windows Server 2003 and Windows XP with SP1 and earlier:</strong> Windows APIs can add this privilege to an owned process.</td></tr><tr><td align="left">**SE_DEBUG_NAME<br />**TEXT(“SeDebugPrivilege”)</td><td align="left">Required to debug and adjust the memory of a process owned by another account. User Right: Debug programs.</td></tr><tr><td align="left">**SE_DELEGATE_SESSION_USER_IMPERSONATE_NAME<br />**TEXT(“SeDelegateSessionUserImpersonatePrivilege”)</td><td align="left">Required to obtain an impersonation token for another user in the same session. User Right: Impersonate other users.</td></tr><tr><td align="left"><strong>SE_ENABLE_DELEGATION_NAME</strong><br />TEXT(“SeEnableDelegationPrivilege”)</td><td align="left">Required to mark user and computer accounts as trusted for delegation. User Right: Enable computer and user accounts to be trusted for delegation.</td></tr><tr><td align="left"><strong>SE_IMPERSONATE_NAME</strong><br />TEXT(“SeImpersonatePrivilege”)</td><td align="left">Required to impersonate. User Right: Impersonate a client after authentication.</td></tr><tr><td align="left"><strong>SE_INC_BASE_PRIORITY_NAME</strong><br />TEXT(“SeIncreaseBasePriorityPrivilege”)</td><td align="left">Required to increase the base priority of a process. User Right: Increase scheduling priority.</td></tr><tr><td align="left"><strong>SE_INCREASE_QUOTA_NAME</strong><br />TEXT(“SeIncreaseQuotaPrivilege”)</td><td align="left">Required to increase the quota assigned to a process. User Right: Adjust memory quotas for a process.</td></tr><tr><td align="left">**SE_INC_WORKING_SET_NAME<br />**TEXT(“SeIncreaseWorkingSetPrivilege”)</td><td align="left">Required to allocate more memory for applications that run in the context of users. User Right: Increase a process working set.</td></tr><tr><td align="left">**SE_LOAD_DRIVER_NAME<br />**TEXT(“SeLoadDriverPrivilege”)</td><td align="left">Required to load or unload a device driver. User Right: Load and unload device drivers.</td></tr><tr><td align="left">**SE_LOCK_MEMORY_NAME<br />**TEXT(“SeLockMemoryPrivilege”)</td><td align="left">Required to lock physical pages in memory. User Right: Lock pages in memory.</td></tr><tr><td align="left">**SE_MACHINE_ACCOUNT_NAME<br />**TEXT(“SeMachineAccountPrivilege”)</td><td align="left">Required to create a computer account. User Right: Add workstations to domain.</td></tr><tr><td align="left"><strong>SE_MANAGE_VOLUME_NAME</strong><br />TEXT(“SeManageVolumePrivilege”)</td><td align="left">Required to enable volume management privileges. User Right: Manage the files on a volume.</td></tr><tr><td align="left"><strong>SE_PROF_SINGLE_PROCESS_NAME</strong><br />TEXT(“SeProfileSingleProcessPrivilege”)</td><td align="left">Required to gather profiling information for a single process. User Right: Profile single process.</td></tr><tr><td align="left"><strong>SE_RELABEL_NAME</strong><br />TEXT(“SeRelabelPrivilege”)</td><td align="left">Required to modify the mandatory integrity level of an object. User Right: Modify an object label.</td></tr><tr><td align="left">**SE_REMOTE_SHUTDOWN_NAME<br />**TEXT(“SeRemoteShutdownPrivilege”)</td><td align="left">Required to shut down a system using a network request. User Right: Force shutdown from a remote system.</td></tr><tr><td align="left"><strong>SE_RESTORE_NAME</strong><br />TEXT(“SeRestorePrivilege”)</td><td align="left">Required to perform restore operations. This privilege causes the system to grant all write access control to any file, regardless of the ACL specified for the file. Any access request other than write is still evaluated with the ACL. Additionally, this privilege enables you to set any valid user or group SID as the owner of a file. This privilege is required by the <a href="https://learn.microsoft.com/en-us/windows/desktop/api/winreg/nf-winreg-regloadkeya"><strong>RegLoadKey</strong></a> function. The following access rights are granted if this privilege is held: WRITE_DACWRITE_OWNERACCESS_SYSTEM_SECURITYFILE_GENERIC_WRITEFILE_ADD_FILEFILE_ADD_SUBDIRECTORYDELETEUser Right: Restore files and directories. If the file is located on a removable drive and the “Audit Removable Storage” is enabled, the SE_SECURITY_NAME is required to have ACCESS_SYSTEM_SECURITY.</td></tr><tr><td align="left"><strong>SE_SECURITY_NAME</strong><br />TEXT(“SeSecurityPrivilege”)</td><td align="left">Required to perform a number of security-related functions, such as controlling and viewing audit messages. This privilege identifies its holder as a security operator. User Right: Manage auditing and security log.</td></tr><tr><td align="left"><strong>SE_SHUTDOWN_NAME</strong><br />TEXT(“SeShutdownPrivilege”)</td><td align="left">Required to shut down a local system. User Right: Shut down the system.</td></tr><tr><td align="left"><strong>SE_SYNC_AGENT_NAME</strong><br />TEXT(“SeSyncAgentPrivilege”)</td><td align="left">Required for a domain controller to use the <a href="https://learn.microsoft.com/en-us/windows/desktop/SecGloss/l-gly"><em>Lightweight Directory Access Protocol</em></a> directory synchronization services. This privilege enables the holder to read all objects and properties in the directory, regardless of the protection on the objects and properties. By default, it is assigned to the Administrator and LocalSystem accounts on domain controllers. User Right: Synchronize directory service data.</td></tr><tr><td align="left"><strong>SE_SYSTEM_ENVIRONMENT_NAME</strong><br />TEXT(“SeSystemEnvironmentPrivilege”)</td><td align="left">Required to modify the nonvolatile RAM of systems that use this type of memory to store configuration information. User Right: Modify firmware environment values.</td></tr><tr><td align="left"><strong>SE_SYSTEM_PROFILE_NAME</strong><br />TEXT(“SeSystemProfilePrivilege”)</td><td align="left">Required to gather profiling information for the entire system. User Right: Profile system performance.</td></tr><tr><td align="left"><strong>SE_SYSTEMTIME_NAME</strong><br />TEXT(“SeSystemtimePrivilege”)</td><td align="left">Required to modify the system time. User Right: Change the system time.</td></tr><tr><td align="left"><strong>SE_TAKE_OWNERSHIP_NAME</strong><br />TEXT(“SeTakeOwnershipPrivilege”)</td><td align="left">Required to take ownership of an object without being granted discretionary access. This privilege allows the owner value to be set only to those values that the holder may legitimately assign as the owner of an object. User Right: Take ownership of files or other objects.</td></tr><tr><td align="left">**SE_TCB_NAME<br />**TEXT(“SeTcbPrivilege”)</td><td align="left">This privilege identifies its holder as part of the trusted computer base. Some trusted protected subsystems are granted this privilege. User Right: Act as part of the operating system.</td></tr><tr><td align="left">**SE_TIME_ZONE_NAME<br />**TEXT(“SeTimeZonePrivilege”)</td><td align="left">Required to adjust the time zone associated with the computer’s internal clock. User Right: Change the time zone.</td></tr><tr><td align="left"><strong>SE_TRUSTED_CREDMAN_ACCESS_NAME</strong><br />TEXT(“SeTrustedCredManAccessPrivilege”)</td><td align="left">Required to access Credential Manager as a trusted caller. User Right: Access Credential Manager as a trusted caller.</td></tr><tr><td align="left"><strong>SE_UNDOCK_NAME</strong><br />TEXT(“SeUndockPrivilege”)</td><td align="left">Required to undock a laptop. User Right: Remove computer from docking station.</td></tr><tr><td align="left">**SE_UNSOLICITED_INPUT_NAME<br />**TEXT(“SeUnsolicitedInputPrivilege”)</td><td align="left">Required to read unsolicited input from a <a href="https://learn.microsoft.com/en-us/windows/desktop/SecGloss/t-gly"><em>terminal</em></a> device. User Right: Not applicable.</td></tr></tbody></table><h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>value不同，对应的操作和权限也不同，本文列举了有关 Privilege Constants 的一些使用方式。</p><h2 id="LookupPrivilegeValue"><a href="#LookupPrivilegeValue" class="headerlink" title="LookupPrivilegeValue"></a>LookupPrivilegeValue</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">EnablePrivilege</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LUID PrivilegeRequired ;</span><br><span class="line">    BOOL bRes = FALSE;</span><br><span class="line">  </span><br><span class="line">    bRes = <span class="built_in">LookupPrivilegeValue</span>(<span class="literal">NULL</span>, SE_DEBUG_NAME, &amp;PrivilegeRequired);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bRes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用-AdjustTokenPrivileges-修改权限"><a href="#使用-AdjustTokenPrivileges-修改权限" class="headerlink" title="使用 AdjustTokenPrivileges 修改权限"></a>使用 AdjustTokenPrivileges 修改权限</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> BOOL <span class="title">CToolhelp::EnablePrivilege</span><span class="params">(PCTSTR szPrivilege, BOOL fEnable)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Enabling the debug privilege allows the application to see</span></span><br><span class="line">   <span class="comment">// information about service applications</span></span><br><span class="line">   BOOL fOk = FALSE;    <span class="comment">// Assume function fails</span></span><br><span class="line">   HANDLE hToken;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Try to open this process&#x27;s access token</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">OpenProcessToken</span>(<span class="built_in">GetCurrentProcess</span>(), TOKEN_ADJUST_PRIVILEGES, </span><br><span class="line">      &amp;hToken)) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Attempt to modify the given privilege</span></span><br><span class="line">      TOKEN_PRIVILEGES tp;</span><br><span class="line">      tp.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">LookupPrivilegeValue</span>(<span class="literal">NULL</span>, szPrivilege, &amp;tp.Privileges[<span class="number">0</span>].Luid);</span><br><span class="line">      tp.Privileges[<span class="number">0</span>].Attributes = fEnable ? SE_PRIVILEGE_ENABLED : <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">AdjustTokenPrivileges</span>(hToken, FALSE, &amp;tp, <span class="built_in">sizeof</span>(tp), <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">      fOk = (<span class="built_in">GetLastError</span>() == ERROR_SUCCESS);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Don&#x27;t forget to close the token handle</span></span><br><span class="line">      <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span>(fOk);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 权限与会话 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AD域</title>
      <link href="/OS/Windows/%E5%AE%89%E5%85%A8/AD%E5%9F%9F/"/>
      <url>/OS/Windows/%E5%AE%89%E5%85%A8/AD%E5%9F%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="AD域"><a href="#AD域" class="headerlink" title="AD域"></a>AD域</h1><p>AD域（Active Directory Domain）是一种Windows Server的组织单元，用于管理计算机、用户、组织和其他资源。它提供了一种集中式的管理方式，可以让管理员轻松地管理网络中的资源。AD域支持以下功能：</p><ol><li>用户和计算机管理：可以使用AD域来管理网络中的用户和计算机，包括创建、删除、修改用户和计算机的属性等。</li><li>组织管理：可以使用AD域来管理网络中的组织，包括创建、删除、修改组织的属性等。</li><li>权限管理：可以使用AD域来管理网络中的权限，包括授予用户访问资源的权限等。</li><li>网络服务管理：可以使用AD域来管理网络中的服务，包括打印服务、邮件服务等。</li><li>数据备份和恢复：可以使用AD域来备份和恢复网络中的数据，以防止数据丢失。</li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 安全 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DCSYNC攻击防护</title>
      <link href="/OS/Windows/%E5%AE%89%E5%85%A8/DCSYNC%E6%94%BB%E5%87%BB/"/>
      <url>/OS/Windows/%E5%AE%89%E5%85%A8/DCSYNC%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="DCSYNC攻击"><a href="#DCSYNC攻击" class="headerlink" title="DCSYNC攻击"></a>DCSYNC攻击</h1><p>DCSYNC攻击是一种利用DC（域控制器）之间的同步过程来实现的攻击。攻击者可以利用这个过程来获取域管理员的权限，从而对域中的计算机和用户进行攻击。为了防护DCSYNC攻击，可以采取以下措施：</p><pre><code>1. 安装最新的安全补丁：确保所有的DC都安装了最新的安全补丁，以防止攻击者利用已知的漏洞进行攻击。2. 启用安全策略：启用安全策略，例如限制管理员的权限，以防止攻击者利用管理员权限进行攻击。3. 使用防火墙：使用防火墙来限制DC之间的通信，以防止攻击者利用通信过程进行攻击。4. 启用IPsec：启用IPsec来加密DC之间的通信，以防止攻击者截获通信内容。5. 启用身份验证：启用身份验证，例如使用Kerberos，以防止攻击者冒充域用户进行攻击。6. 定期审计：定期审计DC之间的通信，以及域用户的活动，以发现可能的攻击行为。</code></pre><h1 id="相关补充"><a href="#相关补充" class="headerlink" title="相关补充"></a>相关补充</h1><h2 id="域控制器"><a href="#域控制器" class="headerlink" title="域控制器"></a>域控制器</h2><p>域控制器（Domain Controller，DC）是一台服务器，管理网络和身份安全，有效地充当用户验证和授权进入域内 IT 资源的门卫。域控制器在微软目录服务术语中尤其重要，它是一台计算机，存储和管理域内的用户和计算机信息，以及网络上的其他信息。它负责为域内的用户和计算机提供身份验证和授权服务，并维护域内的安全性。</p><h2 id="Kerberos"><a href="#Kerberos" class="headerlink" title="Kerberos"></a>Kerberos</h2><p>Kerberos是一种网络认证协议，用于在网络上验证用户的身份。它使用一种称为“票据”的概念来实现身份验证，其中包含用户的身份信息和服务器的身份信息。当用户请求访问服务器时，它会向票据发行机（KDC）发送请求，请求一个票据。KDC会根据用户的身份信息和服务器的身份信息生成一个票据，并将其发送给用户。用户将票据发送给服务器，服务器会验证票据的有效性，并根据票据中的信息授予用户访问权限。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 安全 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>windbg 分析实战</title>
      <link href="/OS/Windows/Windbg/%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/"/>
      <url>/OS/Windows/Windbg/%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Process-输出"><a href="#Process-输出" class="headerlink" title="!Process 输出"></a>!Process 输出</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">1: kd&gt; !process fffffa800c5c8060 3</span><br><span class="line">PROCESS fffffa800c5c8060</span><br><span class="line">    SessionId: 0  Cid: 06fc    Peb: 7fffffd4000  ParentCid: 025c</span><br><span class="line">    DirBase: 1f8dfb000  ObjectTable: fffff8a0020a44e0  HandleCount: 281.</span><br><span class="line">    Image: svchost.exe</span><br><span class="line">    VadRoot fffffa800c5c8570 Vads 128 Clone 0 Private 2532. Modified 992. Locked 0.</span><br><span class="line">    DeviceMap fffff8a001b400b0</span><br><span class="line">    Token                             fffff8a0020ac060</span><br><span class="line">    ElapsedTime                       00:06:27.486</span><br><span class="line">    UserTime                          00:00:00.046</span><br><span class="line">    KernelTime                        00:00:00.093</span><br><span class="line">    QuotaPoolUsage[PagedPool]         94704</span><br><span class="line">    QuotaPoolUsage[NonPagedPool]      32760</span><br><span class="line">    Working Set Sizes (now,min,max)  (4303, 50, 345) (17212KB, 200KB, 1380KB)</span><br><span class="line">    PeakWorkingSetSize                4717</span><br><span class="line">    VirtualSize                       57 Mb</span><br><span class="line">    PeakVirtualSize                   57 Mb</span><br><span class="line">    PageFaultCount                    6769</span><br><span class="line">    MemoryPriority                    BACKGROUND</span><br><span class="line">    BasePriority                      8</span><br><span class="line">    CommitCharge                      2766</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c5d0060  Cid 06fc.0700  Teb: 000007fffffde000 Win32Thread: fffff900c075cc10 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800c3d96a0  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c482060  Cid 06fc.0704  Teb: 000007fffffdc000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Alertable</span><br><span class="line">            fffffa800c471060  SynchronizationTimer</span><br><span class="line">            fffffa800c42d200  SynchronizationTimer</span><br><span class="line">            fffffa800c467680  SynchronizationEvent</span><br><span class="line">            fffffa800c48b440  SynchronizationEvent</span><br><span class="line">            fffffa800c47f1f0  SynchronizationEvent</span><br><span class="line">            fffffa800c534060  SynchronizationEvent</span><br><span class="line">            fffffa800c556060  SynchronizationEvent</span><br><span class="line">            fffffa800c5212f0  SynchronizationEvent</span><br><span class="line">            fffffa800c5213f0  SynchronizationEvent</span><br><span class="line">            fffffa800c41f5d0  SynchronizationTimer</span><br><span class="line">            fffffa800c4595d0  SynchronizationTimer</span><br><span class="line">            fffffa800c592240  SynchronizationEvent</span><br><span class="line">            fffffa800c593b00  ProcessObject</span><br><span class="line">            fffffa800c459550  SynchronizationEvent</span><br><span class="line">            fffffa800c59b400  SynchronizationEvent</span><br><span class="line">            fffffa800c3f6810  SynchronizationEvent</span><br><span class="line">            fffffa800c5a1120  SynchronizationEvent</span><br><span class="line">            fffffa800c5b5120  SynchronizationEvent</span><br><span class="line">            fffffa800c482610  SynchronizationTimer</span><br><span class="line">            fffffa800c466060  SynchronizationEvent</span><br><span class="line">            fffffa800c59b060  SynchronizationEvent</span><br><span class="line">            fffffa800c3ec2d0  SynchronizationEvent</span><br><span class="line">            fffffa800c466240  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c4ad370  Cid 06fc.0708  Teb: 000007fffffda000 Win32Thread: fffff900c07cac10 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800cbdf3e0  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c4a2060  Cid 06fc.0714  Teb: 000007fffff9e000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800c4a9110  NotificationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c537370  Cid 06fc.0718  Teb: 000007fffff9c000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa80075eb840  NotificationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c54c370  Cid 06fc.0724  Teb: 000007fffff9a000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800c556140  NotificationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c54a060  Cid 06fc.072c  Teb: 000007fffffd6000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800c5386b0  SynchronizationEvent</span><br><span class="line">            fffffa800c521370  NotificationEvent</span><br><span class="line">            fffffa800c521140  NotificationEvent</span><br><span class="line">            fffffa800c54a5b0  NotificationEvent</span><br><span class="line">            fffffa800c543760  NotificationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c51e060  Cid 06fc.0734  Teb: 000007fffff96000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800b2f8600  SynchronizationEvent</span><br><span class="line">            fffffa800c5341d0  SynchronizationEvent</span><br><span class="line">            fffffa800c556620  SynchronizationEvent</span><br><span class="line">            fffffa800c583780  SynchronizationEvent</span><br><span class="line">            fffffa800c5ce280  SynchronizationEvent</span><br><span class="line">            fffffa800cbcf660  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c41e380  Cid 06fc.0754  Teb: 000007fffff94000 Win32Thread: 0000000000000000 WAIT: (WrLpcReply) UserMode Non-Alertable</span><br><span class="line">            fffffa800c41e748  Semaphore Limit 0x1</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c41f060  Cid 06fc.075c  Teb: 000007fffff90000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c5b53c0  QueueObject</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c466300  Cid 06fc.0760  Teb: 000007fffff8e000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Alertable</span><br><span class="line">            fffffa800c3ec060  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800c461060  Cid 06fc.0764  Teb: 000007fffff8c000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800c41f790  SynchronizationEvent</span><br><span class="line">            fffffa800c41f810  NotificationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa8007c92060  Cid 06fc.00a0  Teb: 000007fffffd8000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c3d9500  QueueObject</span><br><span class="line"></span><br><span class="line">        THREAD fffffa800780e640  Cid 06fc.19f0  Teb: 000007fffff98000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c3d9500  QueueObject</span><br><span class="line"></span><br><span class="line">        THREAD fffffa80078fe650  Cid 06fc.1010  Teb: 000007fffff92000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c3d9500  QueueObject</span><br><span class="line"></span><br><span class="line">        THREAD fffffa8007ebdb50  Cid 06fc.12e4  Teb: 000007fffff8a000 Win32Thread: 0000000000000000 WAIT: (UserRequest) UserMode Non-Alertable</span><br><span class="line">            fffffa800d8a88c0  SynchronizationEvent</span><br><span class="line"></span><br><span class="line">        THREAD fffffa8008228b50  Cid 06fc.0e3c  Teb: 000007fffff88000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c3d9500  QueueObject</span><br><span class="line"></span><br><span class="line">        THREAD fffffa8007800b50  Cid 06fc.0440  Teb: 000007fffff86000 Win32Thread: 0000000000000000 WAIT: (WrQueue) UserMode Alertable</span><br><span class="line">            fffffa800c3d9500  QueueObject</span><br></pre></td></tr></table></figure><p>这是Windows Debugger（WinDbg）中<code>!process</code>命令的输出，提供了关于特定进程的信息。<br>第一行显示了进程的ID，即<code>fffffa800c5c8060</code>。第二行显示了进程的会话ID，即<code>0</code>。第三行显示了调用进程的ID，即<code>025c</code>。<br>第四行显示了进程在内存中的基地址，即<code>1f8dfb000</code>。第五行显示了进程的对象表，即<code>ffff8a0020a44e0</code>。第六行显示了进程的句柄数，即<code>281</code>。<br>第七行显示了进程的图像，即<code>svchost.exe</code>。第八行显示了进程的虚拟地址根，即<code>ffffa800c5c8570</code>。第九行显示了进程中的VAD（虚拟地址目录）数，即<code>128</code>。第十行显示了进程是否为克隆进程，即<code>0</code>。第十一行显示了进程是否为私有进程，即<code>2532</code>。第十二行显示了进程的修改计数，即<code>992</code>。第十三行显示了进程的锁定计数，即<code>0</code>。<br>第十四行显示了进程的设备映射，即<code>ffff8a001b400b0</code>。第十五行显示了进程的令牌，即<code>ffff8a0020ac060</code>。第十六行显示了进程的运行时间，即<code>00:06:27.486</code>。第十七行显示了进程的用户时间，即<code>00:00:00.046</code>。第十八行显示了进程的内核时间，即<code>00:00:00.093</code>。第十九行显示了进程的配额池使用情况，即<code>94704</code>用于页面池和<code>32760</code>用于非页面池。第二十行显示了进程的工作集大小，即<code>4303</code>用于现在、<code>50</code>用于最小和<code>345</code>用于最大。第二十一行显示了进程的峰值工作集大小，即<code>4717</code>。第二十二行显示了进程的虚拟大小，即<code>57 MB</code>。第二十三行显示了进程的峰值虚拟大小，也是<code>57 MB</code>。第二十四行显示了进程的页面故障次数，即<code>6769</code>。第二十五行显示了进程的内存优先级，即<code>BACKGROUND</code>。第二十六行显示了进程的基本优先级，即<code>8</code>。第二十七行显示了进程的提交量，即<code>2766</code>。<br>最后一部分输出显示了进程的线程。每个线程都用一行表示，包括线程ID、Cid（连接ID）、Teb（线程环境块）和等待类型和等待的对象。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>windows进程间通信整理</title>
      <link href="/OS/Windows/IPC/windows%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"/>
      <url>/OS/Windows/IPC/windows%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：windows进程间通信的各种方式</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">A(windows进程间通信) --&gt; B[&quot;管道(pipe)&quot;]</span><br><span class="line">A --&gt; C[&quot;邮件槽(Mailslots)&quot;]</span><br><span class="line">A --&gt; D[&quot;文件映射(fileMapping)&quot;]</span><br><span class="line">A --&gt; E[&quot;信号量(Semaphore)&quot;]</span><br><span class="line">A --&gt; F[&quot;信号(signal)&quot;]</span><br><span class="line">A --&gt; G[&quot;套接字(Socket)&quot;]</span><br><span class="line">A --&gt; H[&quot;动态库(dll)&quot;]</span><br><span class="line">A --&gt; I[&quot;组件对象模型(COM)&quot;]</span><br><span class="line"></span><br><span class="line">B --&gt; B1[&quot;匿名管道(Anonymous pipe)&quot;]</span><br><span class="line">B --&gt; B2[&quot;命名管道(named pipe)&quot;]</span><br><span class="line"></span><br><span class="line">D --&gt; D1[&quot;共享内存(shared memory)&quot;]</span><br><span class="line"></span><br><span class="line">F --&gt; F1[&quot;windows没有信号这个概念，但是会提供类似功能的api，比如杀死进程。linux下的kill信号，windows下提供TerminateProcess&quot;]</span><br><span class="line"></span><br><span class="line">H --&gt; H1[&quot;地址无关代码：两个进程无法通过同一个dll进行数据交换&quot;]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> IPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IPC </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win32多线程——线程同步之信号量（Semaphores）</title>
      <link href="/OS/Windows/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%B9%8B%E4%BF%A1%E5%8F%B7%E9%87%8FSeamphorse/"/>
      <url>/OS/Windows/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%B9%8B%E4%BF%A1%E5%8F%B7%E9%87%8FSeamphorse/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： semaphores 的说明和使用</p><p>微软官方文档： </p><ul><li><a href="https://learn.microsoft.com/en-us/windows/win32/sync/semaphore-objects">Semaphore Objects - Win32 apps | Microsoft Learn</a></li></ul></blockquote><p>Semaphores是解决各种 producer&#x2F;consumer问题的关键要素。这种问题会存有一个缓冲区，可能在同一时间内被读出数据或被写入数据。</p><p>理论可以证明,mutex 是 semaphore 的一种退化。如果你产生一个semaphore 并令最大值为1,那就是一个 mutex。也因此, mutex又常被称为binary semaphore。在许多系统中, semaphores 常被使用, 因为 mutexes可能并不存在。在Win32中semaphores 被使用的情况就少得多，因为 mutex 存在的缘故。</p><h2 id="创建-semaphore"><a href="#创建-semaphore" class="headerlink" title="创建 semaphore"></a>创建 semaphore</h2><p><a href="https://learn.microsoft.com/zh-CN/windows/win32/api/winbase/nf-winbase-createsemaphorea">createSemaphoreA 函数 (winbase.h) - Win32 apps | Microsoft Learn</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">CreateSemaphore</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">LPSECURITY_ATTRIBUTES lpAttributes,<span class="comment">// 安全属性, 可以设置NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">LONG lInitialCount,<span class="comment">// 初始值, [0, lMaximumCount]</span></span></span></span><br><span class="line"><span class="params"><span class="function">LONG lMaximumCount,<span class="comment">// 最大值, 这也就是在同一时间内能够锁住semaphore之线程的最多个数</span></span></span></span><br><span class="line"><span class="params"><span class="function">LPCTSTR lpName<span class="comment">// 名称, 其他线程或进程可以根据名称引用该信号量; NULL则产生无名称信号量</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>如果成功就传回一个handle, 否则传回NULL. 不论哪一种情况,GetLastError()都会传回一个合理的结果. 如果指定的semaphore名称已经存在,则该函数还是成功的, GetLastError()会传回ERROR_ALREADY_EXISTS.</p><h2 id="获得-semaphore"><a href="#获得-semaphore" class="headerlink" title="获得 semaphore"></a>获得 semaphore</h2><blockquote><p> 通过信号量名，获得信号量对象句柄</p><p><a href="https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-opensemaphorew">OpenSemaphoreW function (synchapi.h) - Win32 apps | Microsoft Learn</a></p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">OpenSemaphoreW</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD   dwDesiredAccess, <span class="comment">// 访问权限，一般传入 SEMAPHORE_ALL_ACCESS </span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] BOOL    bInheritHandle, <span class="comment">// 信号量句柄继承性，一般传入TRUE即可</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCWSTR lpName <span class="comment">// 名称，不同进程中个线程可以通过名称来确保它们访问同一个信号量</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>semaphore的现值代表的意义是目前可用的资源数, 如果semaphore的现值为1, 表示还有一个锁定动作可以成功; 如果现值为5, 就表示还有五个锁定动作可以成功. 每当一个锁定动作成功, semaphore的现值就会减1. 你可以使用任何一种 <code>Wait()</code> 函数(例如 <code>WaitForSingleObject()</code> )要求锁定一个semaphore. 因此, 如果semaphore的现值不为0, <code>Wait()</code> 函数会立刻返回.<br>一个线程可以反复调用 <code>Wait()</code> 函数以产生新的锁定.  这和mutex绝不相同：拥有mutex的线程不论再调用多少次 <code>Wait()</code> 函数, 也不会被阻塞住。<br>一旦semaphore的现值降到0, 就表示资源已经耗尽. 此时, 任何线程如果调用Wait…()函数, 必然要等待, 直到某个锁定被解除为止.</p><h2 id="解除-semaphore"><a href="#解除-semaphore" class="headerlink" title="解除 semaphore"></a>解除 semaphore</h2><blockquote><p> 释放信号量</p><p> <a href="https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-releasesemaphore">ReleaseSemaphore function (synchapi.h) - Win32 apps | Microsoft Learn</a></p><p> 注：传入的句柄必须有 <strong>SEMAPHORE_MODIFY_STATE</strong>  权限，参考 <a href="https://learn.microsoft.com/zh-cn/windows/win32/sync/synchronization-object-security-and-access-rights">同步对象安全性和访问权限 - Win32 apps | Microsoft Learn</a></p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ReleaseSemaphore</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            HANDLE hSemaphore, <span class="comment">// 信号量的句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            LONG   lReleaseCount, <span class="comment">// 表示增加个数，必须大于0且不超过最大资源数量</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] LPLONG lpPreviousCount <span class="comment">// 可以用来传出先前的资源计数，设为NULL表示不需要传出</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>ReleaseSemaphore函数会触发WaitForSingleObject函数。ReleaseSemaphore函数用于释放一个信号量对象的计数，而WaitForSingleObject函数用于等待一个信号量对象的计数。当ReleaseSemaphore函数被调用时，它会将信号量对象的计数增加，并且如果有一个线程正在等待这个信号量对象的计数，那么这个线程就会被唤醒。因此，ReleaseSemaphore函数会触发WaitForSingleObject函数。</p><h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><h3 id="为什么-semaphore-要有一个初值"><a href="#为什么-semaphore-要有一个初值" class="headerlink" title="为什么 semaphore 要有一个初值"></a>为什么 semaphore 要有一个初值</h3><p>CreateSemaphore()的第二个参数是lInitialCount, 它的存在理由和CreateMutex()的bInitialOwner参数的存在理由是一样的. 如果你把初值设定为0, 你的线程就可以在产生semaphore之后进行所有必要的初始化工作. 待初始化工作完成后, 调用 ReleaseSemaphore()就可以把现值增加到其最大可能值.</p><h2 id="Demo-多线程同步"><a href="#Demo-多线程同步" class="headerlink" title="Demo 多线程同步"></a>Demo 多线程同步</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span>  </span></span><br><span class="line"><span class="type">long</span> g_nNum;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> __stdcall <span class="title">Fun</span><span class="params">(<span class="type">void</span>* pPM)</span></span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> THREAD_NUM = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//信号量与关键段  </span></span><br><span class="line">HANDLE            g_hThreadParameter;</span><br><span class="line">CRITICAL_SECTION  g_csThreadCode;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;     经典线程同步 信号量Semaphore\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; -- by MoreWindows( http://blog.csdn.net/MoreWindows ) --\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化信号量和关键段  </span></span><br><span class="line">    g_hThreadParameter = <span class="built_in">CreateSemaphore</span>(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="literal">NULL</span>);<span class="comment">//当前0个资源，最大允许1个同时访问  </span></span><br><span class="line">    <span class="built_in">InitializeCriticalSection</span>(&amp;g_csThreadCode);</span><br><span class="line"></span><br><span class="line">    HANDLE  handle[THREAD_NUM];</span><br><span class="line">    g_nNum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; THREAD_NUM)</span><br><span class="line">    &#123;</span><br><span class="line">        handle[i] = (HANDLE)_beginthreadex(<span class="literal">NULL</span>, <span class="number">0</span>, Fun, &amp;i, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">WaitForSingleObject</span>(g_hThreadParameter, INFINITE);<span class="comment">//等待信号量&gt;0  </span></span><br><span class="line">        ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">WaitForMultipleObjects</span>(THREAD_NUM, handle, TRUE, INFINITE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁信号量和关键段  </span></span><br><span class="line">    <span class="built_in">DeleteCriticalSection</span>(&amp;g_csThreadCode);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(g_hThreadParameter);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; THREAD_NUM; i++)</span><br><span class="line">        <span class="built_in">CloseHandle</span>(handle[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> __stdcall <span class="title">Fun</span><span class="params">(<span class="type">void</span>* pPM)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> nThreadNum = *(<span class="type">int</span>*)pPM;</span><br><span class="line">    <span class="built_in">ReleaseSemaphore</span>(g_hThreadParameter, <span class="number">1</span>, <span class="literal">NULL</span>);<span class="comment">//信号量++  </span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">50</span>);<span class="comment">//some work should to do  </span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">EnterCriticalSection</span>(&amp;g_csThreadCode);</span><br><span class="line">    ++g_nNum;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">0</span>);<span class="comment">//some work should to do  </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;线程编号为%d  全局资源值为%d\n&quot;</span>, nThreadNum, g_nNum);</span><br><span class="line">    <span class="built_in">LeaveCriticalSection</span>(&amp;g_csThreadCode);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 多线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 多线程 </tag>
            
            <tag> semaphores </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TEB (线程环境块)</title>
      <link href="/OS/Windows/Windbg/TEB(%E7%BA%BF%E7%A8%8B%E7%8E%AF%E5%A2%83%E5%9D%97)/"/>
      <url>/OS/Windows/Windbg/TEB(%E7%BA%BF%E7%A8%8B%E7%8E%AF%E5%A2%83%E5%9D%97)/</url>
      
        <content type="html"><![CDATA[<blockquote><p> 概述：TEB（Thread <a href="https://so.csdn.net/so/search?q=Environment&spm=1001.2101.3001.7020">Environment</a> Block，线程环境块）指线程环境块，该结构体包含进程中运行线程的各种信息，进程中的每个线程都对应着一个TEB结构体。不同OS中TEB结构体的形态略微有点不同</p><p> 微软官方文档：</p><ul><li><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/debug/thread-environment-block--debugging-notes-">线程环境块 (调试说明) - Win32 apps | Microsoft Learn</a></p></li><li><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winternl/ns-winternl-teb">TEB (winternl.h) - Win32 apps | Microsoft Learn</a></p></li></ul></blockquote><p>[toc]</p><h1 id="TEB-结构体定义"><a href="#TEB-结构体定义" class="headerlink" title="TEB 结构体定义"></a>TEB 结构体定义</h1><h2 id="MSDN"><a href="#MSDN" class="headerlink" title="MSDN"></a>MSDN</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_TEB</span> &#123;</span><br><span class="line">  PVOID Reserved1[<span class="number">12</span>];</span><br><span class="line">  PPEB  ProcessEnvironmentBlock;</span><br><span class="line">  PVOID Reserved2[<span class="number">399</span>];</span><br><span class="line">  BYTE  Reserved3[<span class="number">1952</span>];</span><br><span class="line">  PVOID TlsSlots[<span class="number">64</span>];</span><br><span class="line">  BYTE  Reserved4[<span class="number">8</span>];</span><br><span class="line">  PVOID Reserved5[<span class="number">26</span>];</span><br><span class="line">  PVOID ReservedForOle;</span><br><span class="line">  PVOID Reserved6[<span class="number">4</span>];</span><br><span class="line">  PVOID TlsExpansionSlots;</span><br><span class="line">&#125; TEB, *PTEB;</span><br></pre></td></tr></table></figure><h2 id="Windows-XP-SP3"><a href="#Windows-XP-SP3" class="headerlink" title="Windows XP SP3"></a>Windows XP SP3</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">nt!_TEB</span><br><span class="line">   +<span class="number">0x000</span> NtTib            : _NT_TIB</span><br><span class="line">   +<span class="number">0x01c</span> EnvironmentPointer : Ptr32 Void</span><br><span class="line">   +<span class="number">0x020</span> ClientId         : _CLIENT_ID</span><br><span class="line">   +<span class="number">0x028</span> ActiveRpcHandle  : Ptr32 Void</span><br><span class="line">   +<span class="number">0x02c</span> ThreadLocalStoragePointer : Ptr32 Void</span><br><span class="line">   +<span class="number">0x030</span> ProcessEnvironmentBlock : Ptr32 _PEB</span><br><span class="line">   +<span class="number">0x034</span> LastErrorValue   : Uint4B</span><br><span class="line">   +<span class="number">0x038</span> CountOfOwnedCriticalSections : Uint4B</span><br><span class="line">   +<span class="number">0x03c</span> CsrClientThread  : Ptr32 Void</span><br><span class="line">   +<span class="number">0x040</span> Win32ThreadInfo  : Ptr32 Void</span><br><span class="line">   +<span class="number">0x044</span> User32Reserved   : [<span class="number">26</span>] Uint4B</span><br><span class="line">   +<span class="number">0x0ac</span> UserReserved     : [<span class="number">5</span>] Uint4B</span><br><span class="line">   +<span class="number">0x0c0</span> WOW32Reserved    : Ptr32 Void</span><br><span class="line">   +<span class="number">0x0c4</span> CurrentLocale    : Uint4B</span><br><span class="line">   +<span class="number">0x0c8</span> FpSoftwareStatusRegister : Uint4B</span><br><span class="line">   +<span class="number">0x0cc</span> SystemReserved1  : [<span class="number">54</span>] Ptr32 Void</span><br><span class="line">   +<span class="number">0x1a4</span> ExceptionCode    : Int4B</span><br><span class="line">   +<span class="number">0x1a8</span> ActivationContextStack : _ACTIVATION_CONTEXT_STACK</span><br><span class="line">   +<span class="number">0x1bc</span> SpareBytes1      : [<span class="number">24</span>] UChar</span><br><span class="line">   +<span class="number">0x1d4</span> GdiTebBatch      : _GDI_TEB_BATCH</span><br><span class="line">   +<span class="number">0x6b4</span> RealClientId     : _CLIENT_ID</span><br><span class="line">   +<span class="number">0x6bc</span> GdiCachedProcessHandle : Ptr32 Void</span><br><span class="line">   +<span class="number">0x6c0</span> GdiClientPID     : Uint4B</span><br><span class="line">   +<span class="number">0x6c4</span> GdiClientTID     : Uint4B</span><br><span class="line">   +<span class="number">0x6c8</span> GdiThreadLocalInfo : Ptr32 Void</span><br><span class="line">   +<span class="number">0x6cc</span> Win32ClientInfo  : [<span class="number">62</span>] Uint4B</span><br><span class="line">   +<span class="number">0x7c4</span> glDispatchTable  : [<span class="number">233</span>] Ptr32 Void</span><br><span class="line">   +<span class="number">0xb68</span> glReserved1      : [<span class="number">29</span>] Uint4B</span><br><span class="line">   +<span class="number">0xbdc</span> glReserved2      : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbe0</span> glSectionInfo    : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbe4</span> glSection        : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbe8</span> glTable          : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbec</span> glCurrentRC      : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbf0</span> glContext        : Ptr32 Void</span><br><span class="line">   +<span class="number">0xbf4</span> LastStatusValue  : Uint4B</span><br><span class="line">   +<span class="number">0xbf8</span> StaticUnicodeString : _UNICODE_STRING</span><br><span class="line">   +<span class="number">0xc00</span> StaticUnicodeBuffer : [<span class="number">261</span>] Uint2B</span><br><span class="line">   +<span class="number">0xe0c</span> DeallocationStack : Ptr32 Void</span><br><span class="line">   +<span class="number">0xe10</span> TlsSlots         : [<span class="number">64</span>] Ptr32 Void</span><br><span class="line">   +<span class="number">0xf10</span> TlsLinks         : _LIST_ENTRY</span><br><span class="line">   +<span class="number">0xf18</span> Vdm              : Ptr32 Void</span><br><span class="line">   +<span class="number">0xf1c</span> ReservedForNtRpc : Ptr32 Void</span><br><span class="line">   +<span class="number">0xf20</span> DbgSsReserved    : [<span class="number">2</span>] Ptr32 Void</span><br><span class="line">   +<span class="number">0xf28</span> HardErrorsAreDisabled : Uint4B</span><br><span class="line">   +<span class="number">0xf2c</span> Instrumentation  : [<span class="number">16</span>] Ptr32 Void</span><br><span class="line">   +<span class="number">0xf6c</span> WinSockData      : Ptr32 Void</span><br><span class="line">   +<span class="number">0xf70</span> GdiBatchCount    : Uint4B</span><br><span class="line">   +<span class="number">0xf74</span> InDbgPrint       : UChar</span><br><span class="line">   +<span class="number">0xf75</span> FreeStackOnTermination : UChar</span><br><span class="line">   +<span class="number">0xf76</span> HasFiberData     : UChar</span><br><span class="line">   +<span class="number">0xf77</span> IdealProcessor   : UChar</span><br><span class="line">   +<span class="number">0xf78</span> Spare3           : Uint4B</span><br><span class="line">   +<span class="number">0xf7c</span> ReservedForPerf  : Ptr32 Void</span><br><span class="line">   +<span class="number">0xf80</span> ReservedForOle   : Ptr32 Void</span><br><span class="line">   +<span class="number">0xf84</span> WaitingOnLoaderLock : Uint4B</span><br><span class="line">   +<span class="number">0xf88</span> Wx86Thread       : _Wx86ThreadState</span><br><span class="line">   +<span class="number">0xf94</span> TlsExpansionSlots : Ptr32 Ptr32 Void</span><br><span class="line">   +<span class="number">0xf98</span> ImpersonationLocale : Uint4B</span><br><span class="line">   +<span class="number">0xf9c</span> IsImpersonating  : Uint4B</span><br><span class="line">   +<span class="number">0xfa0</span> NlsCache         : Ptr32 Void</span><br><span class="line">   +<span class="number">0xfa4</span> pShimData        : Ptr32 Void</span><br><span class="line">   +<span class="number">0xfa8</span> HeapVirtualAffinity : Uint4B</span><br><span class="line">   +<span class="number">0xfac</span> CurrentTransactionHandle : Ptr32 Void</span><br><span class="line">   +<span class="number">0xfb0</span> ActiveFrame      : Ptr32 _TEB_ACTIVE_FRAME</span><br><span class="line">   +<span class="number">0xfb4</span> SafeThunkCall    : UChar</span><br><span class="line">   +<span class="number">0xfb5</span> BooleanSpare     : [<span class="number">3</span>] UChar</span><br></pre></td></tr></table></figure><h3 id="各变量说明"><a href="#各变量说明" class="headerlink" title="各变量说明"></a>各变量说明</h3><p>“_TEB” 是一个Windows内核对象的结构体，用于描述一个线程的状态和信息。它包含了线程的一些基本信息，例如线程的堆栈指针、环境变量、堆栈大小等。<br>以下是 “_TEB” 结构体中的一些常用变量及其说明：</p><ul><li>*NtTeb: 指向当前线程的 “_TEB” 结构体的指针。</li><li>StackBase: 指向线程的堆栈起始地址。</li><li>StackLimit: 指向线程的堆栈结束地址。</li><li>StackReserveSize: 指定线程的堆栈大小。</li><li>EnvironmentPointer: 指向线程的环境变量的指针。</li><li>ThreadLocalStoragePointer: 指向线程的线程局部存储空间的指针。</li><li>*ProcessEnvironmentBlock: 指向进程的环境变量的指针。</li><li>BasePriority: 指定线程的优先级。</li><li>UniqueThreadID: 指定线程的唯一ID。</li><li>IdealProcessor: 指定线程的理想处理器。</li><li>IdealProcessorGroup: 指定线程的理想处理器组。</li><li>ThreadLocale: 指定线程的本地化信息。</li><li>ActiveStackAddress: 指向线程当前活跃的堆栈地址。</li><li>TlsSlots: 指向线程的线程局部存储空间的指针数组。</li><li>TlsExpansionSlots: 指定线程的线程局部存储空间的扩展槽数量。</li><li>Reserved: 保留字段。</li><li>Reserved2: 保留字段。</li></ul><p>这些变量可以用于查看和分析线程的状态和信息。您可以使用Windows调试工具中的 “dt” 命令查看这些变量的值和相关信息，例如：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dt</span> nt!_TEB &lt;teb_object&gt;</span><br></pre></td></tr></table></figure><p>其中 “<teb_object>“ 是线程的 “_TEB” 结构体的实例，例如 “fffffa800cd85b00”。这将显示线程的名称、大小、当前线程等信息。您可以根据需要进一步查看和分析这些信息。</p><h2 id="重要成员"><a href="#重要成员" class="headerlink" title="重要成员"></a>重要成员</h2><p>在用户模式调试中起着重要作用的成员有2个，如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+<span class="number">0x000</span> NtTib            : _NT_TIB</span><br><span class="line">………………………………………………………………………………</span><br><span class="line">+<span class="number">0x030</span> ProcessEnvironmentBlock : Ptr32 _PEB</span><br></pre></td></tr></table></figure><h2 id="ProcessEnvironmentBlock成员："><a href="#ProcessEnvironmentBlock成员：" class="headerlink" title="ProcessEnvironmentBlock成员："></a>ProcessEnvironmentBlock成员：</h2><p>先看Offset 30处的ProcessEnvironmentBlock成员，它是指向PEB（Process Environment Block，进程环境块）结构体指针。PEB是进程环境块，每个进程对应1个PEB结构体。</p><h2 id="NtTib成员"><a href="#NtTib成员" class="headerlink" title="NtTib成员"></a>NtTib成员</h2><p><code>TEB</code>结构体的第一个成员为<code>_NT_TIB</code>结构体（<code>TIB</code>是Thread Information Block的简称，意为“线程信息块”），<code>_NT_TIB</code>结构体的定义如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_NT_TIB</span>          <span class="comment">//sizeof  1ch</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="number">00</span>h   <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span>  *ExceptionList;          <span class="comment">//SEH链入口</span></span><br><span class="line"> <span class="number">04</span>h   PVOID                            StackBase;              <span class="comment">//堆栈基址</span></span><br><span class="line"> <span class="number">08</span>h   PVOID                            StackLimit;             <span class="comment">//堆栈大小</span></span><br><span class="line"> <span class="number">0</span>ch   PVOID                            SubSystemTib;</span><br><span class="line">       <span class="keyword">union</span> &#123;</span><br><span class="line">           PVOID                FiberData;</span><br><span class="line"> <span class="number">10</span>h       DWORD                Version;</span><br><span class="line">       &#125;;</span><br><span class="line"> <span class="number">14</span>h   PVOID                            ArbitraryUserPointer;</span><br><span class="line"> <span class="number">18</span>h   <span class="keyword">struct</span> <span class="title class_">_NT_TIB</span>                   *Self;                  <span class="comment">//本NT_TIB结构自身的线性地址</span></span><br><span class="line">&#125;NT_TIB;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span>     NT_TIB      *PNT_TIB;</span><br></pre></td></tr></table></figure><p>ExceptionList成员指向_EXCEPTION_REGISTRATION_RECORD结构体组成的链表，它用于Windows OS的SEH。Self成员是_NT_TIB结构体的自引用指针，也是TEB结构体的指针（因为TEB结构体的第一个成员就是_NT_TIB结构体）。那么我们如何在用户模式下访问到TEB结构体呢？只有访问它才能使用相应信息。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>windbg内核调试</title>
      <link href="/OS/Windows/Windbg/windbg%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/"/>
      <url>/OS/Windows/Windbg/windbg%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：</p><p>参考：<a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/debugger/getting-started-with-windbg--kernel-mode-">WinDbg (内核模式) 入门 - Windows drivers | Microsoft Learn</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>netsh 抓包</title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/%E6%8A%93%E5%8C%85/netsh%E6%8A%93%E5%8C%85/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/%E6%8A%93%E5%8C%85/netsh%E6%8A%93%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：windows系统下使用 <code>netsh</code> 命令抓包</p></blockquote><h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="1-打开管理员命令行"><a href="#1-打开管理员命令行" class="headerlink" title="1 打开管理员命令行"></a>1 打开管理员命令行</h2><p><kbd>win</kbd> -&gt; 输入 <code>cmd</code> -&gt; <kbd>以管理员身份运行</kbd></p><img src="images/netsh%E6%8A%93%E5%8C%85/image-20230825214027512.png" alt="image-20230825214027512" style="zoom:67%;" /><h2 id="2-输入以下命令开始抓包"><a href="#2-输入以下命令开始抓包" class="headerlink" title="2 输入以下命令开始抓包"></a>2 输入以下命令开始抓包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh trace start capture=YES report=YES persistent=YES</span><br></pre></td></tr></table></figure><p>运行成功后，如下所示</p><p><img src="/images/netsh%E6%8A%93%E5%8C%85/image-20230825214252186.png" alt="运行示例"></p><h2 id="3-运行-零信任客户端"><a href="#3-运行-零信任客户端" class="headerlink" title="3 运行 零信任客户端"></a>3 运行 零信任客户端</h2><p>连接tac，直到复现敲门失败情况</p><h2 id="4-回到-cmd-界面"><a href="#4-回到-cmd-界面" class="headerlink" title="4 回到 cmd 界面"></a>4 回到 <code>cmd</code> 界面</h2><p>键入并回车以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh trace stop</span><br></pre></td></tr></table></figure><p>回车后稍等一会，界面上会输出以下内容，将图示路径文件收集即可。</p><p><img src="/images/netsh%E6%8A%93%E5%8C%85/image-20230825214449220.png" alt="运行示例"></p><h2 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">etl2pcapng.exe nettrace.etl nettrace.cap</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
          <category> 抓包 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/SOCKET%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0(CC++)/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/SOCKET%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0(CC++)/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Windows 下 Socket相关</p></blockquote><h1 id="一、socket-函数-创建套接字"><a href="#一、socket-函数-创建套接字" class="headerlink" title="一、socket()函数 创建套接字"></a>一、socket()函数 创建套接字</h1><p>Windows 不把套接字作为普通文件对待，而是返回 SOCKET 类型的句柄。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SOCKET <span class="title">socket</span><span class="params">(<span class="type">int</span> af, <span class="type">int</span> type, <span class="type">int</span> protocol)</span></span>;</span><br></pre></td></tr></table></figure><p>实例，创建TCP套接字：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SOCKET sock = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);  <span class="comment">//创建TCP套接字</span></span><br></pre></td></tr></table></figure><h1 id="二、bind"><a href="#二、bind" class="headerlink" title="二、bind()"></a>二、bind()</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bind</span><span class="params">(SOCKET sock, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">int</span> addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p><code>sock </code>为 socket 文件描述符<br><code>addr </code>为 sockaddr 结构体变量的指针<br><code>addrlen </code>为 addr 变量的大小，可由 sizeof() 计算得出。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建套接字</span></span><br><span class="line">SOCKET servSock = <span class="built_in">socket</span>(PF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定套接字</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> sockAddr;</span><br><span class="line"><span class="built_in">memset</span> (&amp;sockAddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(sockAddr)); <span class="comment">// 每个套接字都用0填充</span></span><br><span class="line">sockAddr.sin_family = PF_INET; <span class="comment">// 使用IPv4地址</span></span><br><span class="line">sockAddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">sockAddr.sin_port = <span class="built_in">htons</span>(<span class="number">1234</span>);<span class="comment">// 端口</span></span><br><span class="line"><span class="built_in">bind</span>(servSock, (SOCKADDR*)&amp;sockAddr, <span class="built_in">sizeof</span>(SOCKADDR));</span><br></pre></td></tr></table></figure><h4 id="sockaddr结构体"><a href="#sockaddr结构体" class="headerlink" title="sockaddr结构体"></a>sockaddr结构体</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr</span>&#123;</span><br><span class="line">    <span class="type">sa_family_t</span>  sin_family;   <span class="comment">//地址族（Address Family），也就是地址类型</span></span><br><span class="line">    <span class="type">char</span>         sa_data[<span class="number">14</span>];  <span class="comment">//IP地址和端口号</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="sockaddr-in-结构体"><a href="#sockaddr-in-结构体" class="headerlink" title="sockaddr_in 结构体"></a>sockaddr_in 结构体</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span>&#123;</span><br><span class="line">    <span class="type">sa_family_t</span>     sin_family;   <span class="comment">//地址族（Address Family），也就是地址类型</span></span><br><span class="line">    <span class="type">uint16_t</span>        sin_port;     <span class="comment">//16位的端口号</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span>  sin_addr;     <span class="comment">//32位IP地址</span></span><br><span class="line">    <span class="type">char</span>            sin_zero[<span class="number">8</span>];  <span class="comment">//不使用，一般用0填充</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li><code>sin_family </code>和<code>socket()</code>的第一个参数的含义相同，取值也要保持一致。</li><li><code>sin_prot </code>为端口号。uint16_t 的长度为两个字节，理论上端口号的取值范围为 0<del>65536，但 0</del>1023 的端口一般由系统分配给特定的服务程序，例如 Web 服务的端口号为 80，FTP 服务的端口号为 21，所以我们的程序要尽量在 1024~65536 之间分配端口号。端口号需要用 <code>htons() </code>函数转换，后面会讲解为什么。</li><li><code>sin_addr </code>是 struct in_addr 结构体类型的变量，下面会详细讲解。</li><li><code>sin_zero[8]</code>是多余的8个字节，没有用，一般使用<code> memset()</code> 函数填充为 0。上面的代码中，先用 <code>memset()</code> 将结构体的全部字节填充为 0，再给前3个成员赋值，剩下的 <code>sin_zero </code>自然就是 0 了。</li></ol><h4 id="in-addr-结构体"><a href="#in-addr-结构体" class="headerlink" title="in_addr 结构体"></a>in_addr 结构体</h4><p>sockaddr_in 的第3个成员是 in_addr 类型的结构体，该结构体只包含一个成员，如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">in_addr</span>&#123;</span><br><span class="line">    <span class="type">in_addr_t</span>  s_addr;  <span class="comment">//32位的IP地址</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>in_addr_t </code>在头文件 &lt;netinet&#x2F;in.h&gt; 中定义，等价于 unsigned long，长度为4个字节。也就是说，<code>s_addr </code>是一个整数，而IP地址是一个字符串，所以需要** inet_addr() **函数进行转换，例如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ip = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, ip);</span><br></pre></td></tr></table></figure><p>运行结果：<br><code>16777343</code></p><h1 id="三、connect-函数"><a href="#三、connect-函数" class="headerlink" title="三、connect() 函数"></a>三、connect() 函数</h1><p>参数与<code>bind()</code>相同。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span><span class="params">(SOCKET sock, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *serv_addr, <span class="type">int</span> addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><h1 id="四、listen-函数"><a href="#四、listen-函数" class="headerlink" title="四、listen() 函数"></a>四、listen() 函数</h1><p>通过 listen() 函数可以让套接字进入被动监听状态，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span><span class="params">(SOCKET sock, <span class="type">int</span> backlog)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p><code>sock </code>为需要进入监听状态的套接字，<code>backlog </code>为请求队列的最大长度。</p><p><strong>被动监听：</strong>是指当没有客户端请求时，套接字处于“睡眠”状态，只有当接收到客户端请求时，套接字才会被“唤醒”来响应请求。<br>如果将 backlog 的值设置为 <strong>SOMAXCONN</strong>，就由系统来决定请求队列长度，这个值一般比较大，可能是几百，或者更多。<br>当请求队列满时，就不再接收新的请求，对于 <strong>Linux</strong>，客户端会收到 **ECONNREFUSED **错误，对于 <strong>Windows</strong>，客户端会收到 **WSAECONNREFUSED **错误。<br><strong>注意：</strong><code>listen()</code>只是让套接字处于监听状态，并没有接收请求。接收请求需要使用<code>accept()</code>函数。</p><h1 id="五、accept-函数"><a href="#五、accept-函数" class="headerlink" title="五、accept() 函数"></a>五、accept() 函数</h1><p>当套接字处于监听状态时，可以通过 <code>accept()</code>函数来接收客户端请求。它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SOCKET <span class="title">accept</span><span class="params">(SOCKET sock, <span class="keyword">struct</span> sockaddr *addr, <span class="type">int</span> *addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>它的参数与 listen() 和 connect() 是相同的：<code>sock</code>为服务器端套接字，<code>addr</code>为 sockaddr_in 结构体变量，<code>addrlen</code>为参数 addr 的长度，可由 <code>sizeof()</code> 求得。</p>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>IO多路复用</title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近面试，岗位是安全开发岗。问了较多的网络相关函数。其中关于io多路复用的问题，由于工作中涉及的比较少，回答的一塌糊涂。知耻而后勇，专门整理一遍记录一下这个知识点吧</p><p>主要是之前还专门写过一遍笔记用来记录当时的学习情况，还写的挺详细！！！</p><p><a href="https://blog.csdn.net/Fuel_Ming/article/details/122931926">【一文搞懂】FD_SET的使用_欧恩意的博客-CSDN博客</a></p></blockquote><p>[toc]</p><h1 id="IO多路复用"><a href="#IO多路复用" class="headerlink" title="IO多路复用"></a>IO多路复用</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>顾名思义，就是可以多个可以重复使用的io（输入\输出）。</p><ul><li><p>多路：核心需求是要用尽可能少的线程来处理尽可能多的连接，这里的多路是指需要处理的众多连接。</p></li><li><p>复用：核心需求是要求使用尽可能少的线程，尽可能减少系统开销去处理尽可能多的连接，那么这个复用是指利用有限的资源。也就是说利用有限的资源去处理尽可能多的任务。例如：在阻塞IO中，一个连接需要一个线程去处理，但是在IO多路复用的模型中，则可以使用一个线程去处理多个任务。</p></li></ul><p>参考及引用：</p><ul><li><a href="https://devarea.com/linux-io-multiplexing-select-vs-poll-vs-epoll/#.XYD0TygzaUl">Linux – IO Multiplexing – Select vs Poll vs Epoll – Developers Area</a></li><li><a href="https://notes.shichao.io/unp/ch6/">Chapter 6. I&#x2F;O Multiplexing: The select and poll Functions - Shichao’s Notes</a></li><li><a href="https://www.ulduzsoft.com/2014/01/select-poll-epoll-practical-difference-for-system-architects/">select &#x2F; poll &#x2F; epoll: practical difference for system architects | UlduzSoft</a></li><li><a href="https://www.bilibili.com/video/BV1qJ411w7du/?spm_id_from=333.880.my_history.page.click&vd_source=2d8da596010444663e6f18397a9e3505">【并发】IO多路复用select&#x2F;poll&#x2F;epoll介绍_哔哩哔哩_bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IO复用 </tag>
            
            <tag> wanlguo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域名解析相关经验</title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>整理记录排查网络问题事的域名解析相关问题</p></blockquote><p>[toc]</p><h1 id="基础知识点"><a href="#基础知识点" class="headerlink" title="基础知识点"></a>基础知识点</h1><h2 id="A-和-AAAA"><a href="#A-和-AAAA" class="headerlink" title="A 和 AAAA"></a><code>A</code> 和 <code>AAAA</code></h2><p><code>A</code> 和 <code>AAAA</code> 都是DNS记录，它们的作用是将域名解析到IP地址。具体来说，A记录将域名解析到IPv4地址，而AAAA记录将域名解析到IPv6地址。</p><p>因此，主要的区别在于 <code>A</code> 记录用于IPv4，而 <code>AAAA</code> 记录用于IPv6。</p><h1 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h1><h2 id="设置域名工具"><a href="#设置域名工具" class="headerlink" title="设置域名工具"></a>设置域名工具</h2><blockquote><p>常见方式是在网卡的配置界面设置 <code>dns</code> 服务器，在高级页面可以配置多个 <code>DNS</code> 服务器。但是，在特殊环境：</p><p>如使用 <code>netsh</code> 命令设置的静态 <code>dns</code> 服务器等与用户手动添加的 <code>dns</code> 一样时，可能会出现 <code>dns</code> 解析异常的问题。</p></blockquote><ul><li><code>quicksetdns_sec</code>工具:<a href="https://www.appinn.com/quicksetdns/">QuickSetDNS - 快速修改 DNS 服务器工具 - 小众软件</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
          <category> DNS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络 </tag>
            
            <tag> DNS </tag>
            
            <tag> 域名 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>查看浏览器DNS缓存</title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/%E6%9F%A5%E7%9C%8B%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/%E6%9F%A5%E7%9C%8B%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：本文主要介绍如何在浏览器查看DNS缓存，同时罗列了DNS查询的一些顺序</p></blockquote><p>[toc]</p><h1 id="DNS-缓存与解析"><a href="#DNS-缓存与解析" class="headerlink" title="DNS 缓存与解析"></a>DNS 缓存与解析</h1><h2 id="DNS-缓存分类"><a href="#DNS-缓存分类" class="headerlink" title="DNS 缓存分类"></a>DNS 缓存分类</h2><h4 id="1、浏览器缓存"><a href="#1、浏览器缓存" class="headerlink" title="1、浏览器缓存"></a>1、浏览器缓存</h4><p>浏览器会根据一定频率缓存DNS记录；</p><h4 id="2、本地DNS缓存"><a href="#2、本地DNS缓存" class="headerlink" title="2、本地DNS缓存"></a>2、本地DNS缓存</h4><p>如果浏览器缓存中找不到解析记录，就会去询问操作系统中的缓存；</p><h4 id="3、本地HOSTS文件"><a href="#3、本地HOSTS文件" class="headerlink" title="3、本地HOSTS文件"></a>3、本地HOSTS文件</h4><p>HOSTS是记录域名与IP地址一一映射关系的本地文件，Windows系统中位于 <code>C:\Windows\System32\drivers\etc</code></p><h4 id="4、路由器DNS缓存"><a href="#4、路由器DNS缓存" class="headerlink" title="4、路由器DNS缓存"></a>4、路由器DNS缓存</h4><p>我们常用的路由器也带有自动缓存功能，路由器DNS被篡改会造成域名劫持，将访问网址定位到另外一个服务器；</p><h4 id="5、递归服务器缓存"><a href="#5、递归服务器缓存" class="headerlink" title="5、递归服务器缓存"></a>5、递归服务器缓存</h4><p>递归服务器在将解析结果告知客户端的同时，将记录缓存下来，当下次请求同一个域名时，直接会将记录返回，而无需再进行全球查询。</p><h2 id="DNS-解析顺序"><a href="#DNS-解析顺序" class="headerlink" title="DNS 解析顺序"></a>DNS 解析顺序</h2><p>DNS解析顺序是 “先查缓存，再递归解析”，查询顺序为：浏览器缓存 -&gt; 系统缓存 -&gt; 路由器缓存 -&gt; 递归服务器缓存 -&gt; 递归查询</p><p>以 <code>www.baidu.com</code> 这个域名为例进行查询，具体流程如下：</p><h3 id="1-搜索浏览器自带的DNS缓存"><a href="#1-搜索浏览器自带的DNS缓存" class="headerlink" title="1. 搜索浏览器自带的DNS缓存"></a>1. 搜索浏览器自带的DNS缓存</h3><blockquote><p>当收到访问请求后，浏览器首先会查询浏览器自身的DNS缓存，这个缓存时间比较短（chrome:&#x2F;&#x2F;net-internals&#x2F;#dns 这里可以查询缓存的dns记录），且只能容纳 1000条缓存，如果缓存中有对应条目，返回结果，解析到此结束。</p></blockquote><p>在chrome打开 <code>chrome://net-internals/#dns</code> </p><p><img src="/images/%E6%9F%A5%E7%9C%8B%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98/1.png" alt="image-20230822093936706"></p><p>如上所示，浏览器解析到了 <code>www.baidu.com</code> 的ip</p><h3 id="2-查询操作系统缓存和hosts本地文件"><a href="#2-查询操作系统缓存和hosts本地文件" class="headerlink" title="2. 查询操作系统缓存和hosts本地文件"></a>2. 查询操作系统缓存和hosts本地文件</h3><blockquote><p>如果浏览器缓存中没有找到对应条目（<code>ipconfig/displaydns</code>可以查看），操作系统也会有一个域名解析的过程，浏览器会先搜索操作系统的DNS缓存中是否有这个域名解析记录，如果有返回结果，解析结束。</p><p>此外，电脑本地文件HOSTS中可以设定域名到IP地址的指向关系。如果HOSTS文件中保存有该域名的记录，浏览器会首先使用这个IP地址，并将其结果缓存下来，缓存时间同样受域名失效时间和缓存空间大小决定。</p></blockquote><h3 id="3-查询路由器缓存"><a href="#3-查询路由器缓存" class="headerlink" title="3. 查询路由器缓存"></a>3. 查询路由器缓存</h3><blockquote><p>如果浏览器和操作系统中没有域名解析记录，就会查询路由器中的DNS缓存，如果路由器DNS缓存中有解析条目，直接返回结果，解析结束。</p></blockquote><h3 id="4-递归解析服务器缓存"><a href="#4-递归解析服务器缓存" class="headerlink" title="4. 递归解析服务器缓存"></a>4. 递归解析服务器缓存</h3><blockquote><p>如果本机和路由器DNS缓存中没有该域名的解析记录，浏览器就会向递归服务器发起请求，如果递归服务器缓存有该域名解析条目，返回结果，解析结束。</p></blockquote><h3 id="5-查询根域名服务器"><a href="#5-查询根域名服务器" class="headerlink" title="5. 查询根域名服务器"></a>5. 查询根域名服务器</h3><blockquote><p>如果递归服务器缓存中没有结果，就会委托递归服务器发起全球查询，首先递归服务器会向根域名服务器发起解析请求。根域名服务器告知.com顶级域名服务器地址。</p></blockquote><h3 id="6-查询顶级域名服务器"><a href="#6-查询顶级域名服务器" class="headerlink" title="6. 查询顶级域名服务器"></a>6. 查询顶级域名服务器</h3><blockquote><p>递归服务器向.com顶级域名服务器发起DNS请求，.com顶级服务器告知example.com所属权威域名服务器地址。</p></blockquote><h3 id="7-查询权威域名服务器"><a href="#7-查询权威域名服务器" class="headerlink" title="7. 查询权威域名服务器"></a>7. 查询权威域名服务器</h3><blockquote><p>递归服务器向example.com的权威域名服务器地址发起请求，权威服务器告知<a href="http://www.example.com所对应的ip地址./">www.example.com所对应的IP地址。</a></p></blockquote><h3 id="8-返回解析结果"><a href="#8-返回解析结果" class="headerlink" title="8. 返回解析结果"></a>8. 返回解析结果</h3><blockquote><p>得到<a href="http://www.example.com的ip地址后,递归服务器将结果告知客户端,客户端对该ip地址发起访问.整个dns解析流程到此结束./">www.example.com的IP地址后，递归服务器将结果告知客户端，客户端对该IP地址发起访问。整个DNS解析流程到此结束。</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
          <category> DNS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DNS </tag>
            
            <tag> 缓存 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNS用的是TCP协议还是UDP协议</title>
      <link href="/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/DNS%E5%8D%8F%E8%AE%AE/"/>
      <url>/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/DNS/DNS%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述: 关于 DNS 使用的是 TCP 还是 UDP 的说明</p><p>DNS缓存问题可以看这篇文章 <a href="./%E6%9F%A5%E7%9C%8B%E6%B5%8F%E8%A7%88%E5%99%A8DNS%E7%BC%93%E5%AD%98.md">【查看浏览器DNS缓存】</a></p></blockquote><p>[toc]</p><h1 id="DNS概述"><a href="#DNS概述" class="headerlink" title="DNS概述"></a>DNS概述</h1><p>DNS占用53号端口，同时使用TCP和UDP协议。</p><p>📌 那么DNS在什么情况下使用这两种协议？</p><ul><li><p>DNS在区域传输的时候使用TCP协议，其他时候使用UDP协议。</p></li><li><p>DNS区域传输的时候使用TCP协议：</p><ol><li><p>辅域名服务器会定时（一般3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，会执行一次区域传送，进行数据同步。区域传送使用TCP而不是UDP，因为数据同步传送的数据量比一个请求应答的数据量要多得多。</p></li><li><p>TCP是一种可靠连接，保证了数据的准确性。</p></li></ol></li></ul><p>🎃 域名解析时使用UDP协议：</p><p>客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。不用经过三次握手，这样DNS服务器负载更低，响应更快。理论上说，客户端也可以指定向DNS服务器查询时用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。</p><h1 id="DNS为什么用TCP和UDP"><a href="#DNS为什么用TCP和UDP" class="headerlink" title="DNS为什么用TCP和UDP"></a>DNS为什么用TCP和UDP</h1><p>DNS同时占用UDP和TCP端口53是公认的，这种单个应用协议同时使用两种传输协议的情况在TCP&#x2F;IP栈也算是个另类。但很少有人知道DNS分别在什么情况下使用这两种协议。</p><h2 id="先简单介绍下TCP与UDP"><a href="#先简单介绍下TCP与UDP" class="headerlink" title="先简单介绍下TCP与UDP"></a>先简单介绍下TCP与UDP</h2><blockquote><p>TCP是一种面向连接的协议，提供可靠的数据传输，一般服务质量要求比较高的情况，使用这个协议。UDP—用户数据报协议，是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。</p></blockquote><h4 id="TCP与UDP的区别："><a href="#TCP与UDP的区别：" class="headerlink" title="TCP与UDP的区别："></a>TCP与UDP的区别：</h4><p>UDP和TCP协议的主要区别是两者在如何实现信息的<span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;">可靠传递</span>方面不同。TCP协议中包含了专门的传递保证机制，当数据接收方收到发送方传来的信息时，会自动向发送方发出确认消息；发送方只有在接收到该确认消息之后才继续传送其它信息，否则将一直等待直到收到确认信息为止。 与TCP不同，UDP协议并不提供数据传送的保证机制。如果在从发送方到接收方的传递过程中出现数据报的丢失，协议本身并不能做出任何检测或提示。因此，通常人们把UDP协议称为不可靠的传输协议。相对于TCP协议，UDP协议的另外一个不同之处在于如何接收突发性的多个数据报。不同于TCP，UDP并不能确保数据的发送和接收顺序。事实上，UDP协议的这种乱序性基本上很少出现，通常只会在网络非常拥挤的情况下才有可能发生。</p><blockquote><p>既然UDP是一种不可靠的网络协议，那么还有什么使用价值或必要呢？</p><blockquote><p>其实不然，在有些情况下UDP协议可能会变得非常有用。因为UDP具有TCP所望尘莫及的速度优势。虽然TCP协议中植入了各种安全保障功能，但是在实际执行的过程中会占用大量的系统开销，无疑使速度受到严重的影响。反观UDP由于排除了信息可靠传递机制，将安全和排序等功能移交给上层应用来完成，极大降低了执行时间，使速度得到了保证。</p></blockquote></blockquote><p>DNS在进行区域传输的时候使用TCP协议，其它时候则使用UDP协议；<br>DNS的规范规定了2种类型的DNS服务器，一个叫<span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;">主DNS服务器</span>，一个叫<span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;">辅助DNS服务器</span>。在一个区中主DNS服务器从自己本机的数据文件中读取该区的DNS数据信息，而辅助DNS服务器则从区的主DNS服务器中读取该区的DNS数据信息。当一个辅助DNS服务器启动时，它需要与主DNS服务器通信，并加载数据信息，这就叫做区传送（zone transfer）。</p><h4 id="为什么既使用TCP又使用UDP？"><a href="#为什么既使用TCP又使用UDP？" class="headerlink" title="为什么既使用TCP又使用UDP？"></a>为什么既使用TCP又使用UDP？</h4><p>首先了解一下TCP与UDP传送字节的长度限制：</p><p>UDP报文的最大长度为512字节，而TCP则允许报文长度超过512字节。当DNS查询超过512字节时，协议的TC标志出现删除标志，这时则使用TCP发送。通常传统的UDP报文一般不会大于512字节。</p><p>区域传送时使用TCP，主要有一下两点考虑：</p><ol><li><p>辅域名服务器会定时（一般时3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，则会执行一次区域传送，进行数据同步。区域传送将使用TCP而不是UDP，因为数据同步传送的数据量比一个请求和应答的数据量要多得多。</p></li><li><p>TCP是一种可靠的连接，保证了数据的准确性。</p></li></ol><h3 id="域名解析时使用UDP协议："><a href="#域名解析时使用UDP协议：" class="headerlink" title="域名解析时使用UDP协议："></a>域名解析时使用UDP协议：</h3><p>客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。不用经过TCP三次握手，这样DNS服务器负载更低，响应更快。虽然从理论上说，客户端也可以指定向DNS服务器查询的时候使用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。</p><h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><blockquote><p>UDP 与 TCP 的主要区别在于 UDP 不一定提供可靠的数据传输。事实上，该协议不能保证数据准确无误地到达目的地。UDP 在许多方面非常有效。当某个程序的目标是尽快地传输尽可能多的信息时（其中任意给定数据的重要性相对较低），可使用 UDP。ICQ 短消息使用 UDP 协议发送消息。</p></blockquote><p>许多程序将使用单独的TCP连接和单独的UDP连接。重要的状态信息随可靠的TCP连接发送，而主数据流通过UDP发送。</p><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>TCP的目的是提供可靠的数据传输，并在相互进行通信的设备或服务之间保持一个虚拟连接。TCP在数据包接收无序、丢失或在交付期间被破坏时，负责数据恢复。它通过为其发送的每个数据包提供一个序号来完成此恢复。记住，较低的网络层会将每个数据包视为一个独立的单元，因此，数据包可以沿完全不同的路径发送，即使它们都是同一消息的组成部分。这种路由与网络层处理分段和重新组装数据包的方式非常相似，只是级别更高而已。</p><p>为确保正确地接收数据，TCP要求在目标计算机成功收到数据时发回一个确认（即 ACK）。如果在某个时限内未收到相应的 ACK，将重新传送数据包。如果网络拥塞，这种重新传送将导致发送的数据包重复。但是，接收计算机可使用数据包的序号来确定它是否为重复数据包，并在必要时丢弃它。</p><h2 id="TCP与UDP的选择"><a href="#TCP与UDP的选择" class="headerlink" title="TCP与UDP的选择"></a>TCP与UDP的选择</h2><p>如果比较UDP包和TCP包的结构，很明显UDP包不具备TCP包复杂的可靠性与控制机制。与TCP协议相同，UDP的源端口数和目的端口数也都支持一台主机上的多个应用。一个16位的UDP包包含了一个字节长的头部和数据的长度，校验码域使其可以进行整体校验。（许多应用只支持UDP，如：多媒体数据流，不产生任何额外的数据，即使知道有破坏的包也不进行重发。）</p><p>很明显，当数据传输的性能必须让位于数据传输的完整性、可控制性和可靠性时，TCP协议是当然的选择。当强调传输性能而不是传输的完整性时，如：音频和多媒体应用，UDP是最好的选择。在数据传输时间很短，以至于此前的连接过程成为整个流量主体的情况下，UDP也是一个好的选择，如：DNS交换。把SNMP建立在UDP上的部分原因是设计者认为当发生网络阻塞时，UDP较低的开销使其有更好的机会去传送管理数据。TCP丰富的功能有时会导致不可预料的性能低下，但是我们相信在不远的将来，TCP可靠的点对点连接将会用于绝大多数的网络应用。</p><h4 id="TCP-1"><a href="#TCP-1" class="headerlink" title="TCP"></a>TCP</h4><p>TCP（Transmission Control Protocol，传输控制协议）是基于连接的协议，也就是说，在正式收发数据前，必须和对方建立可靠的连接。</p><p>一个TCP连接必须要经过三次“对话”才能建立起来。三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接和要求同步（同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。</p><h4 id="UDP-1"><a href="#UDP-1" class="headerlink" title="UDP"></a>UDP</h4><p>UDP（User Data Protocol，用户数据报协议）是与TCP相对应的协议。它是面向非连接的协议，它不与对方建立连接，而是直接就把数据包发送过去！</p><p>UDP适用于一次只传送少量数据、对可靠性要求不高的应用环境。比如，我们经常使用“ping”命令来测试两台主机之间TCP&#x2F;IP通信是否正常，其实“ping”命令的原理就是向对方主机发送UDP数据包，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。例如，在默认状态下，一次“ping”操作发送4个数据包（如图2所示）。大家可以看到，发送的数据包数量是4包，收到的也是4包（因为对方主机收到后会发回一个确认收到的数据包）。这充分说明了UDP协议是面向非连接的协议，没有建立连接的过程。正因为UDP协议没有连接的过程，所以它的通信效果高；但也正因为如此，它的可靠性不如TCP协议高。QQ就使用UDP发消息，因此有时会出现收不到消息的情况。HTTP是用TCP协议传输的。</p><h2 id="TCP协议与UDP协议的区别"><a href="#TCP协议与UDP协议的区别" class="headerlink" title="TCP协议与UDP协议的区别"></a>TCP协议与UDP协议的区别</h2><p>TCP基于<strong>面向连接的协议</strong>，数据传输<strong>可靠</strong>，<strong>传输速度慢</strong>，适用于<strong>传输大量数据</strong>，可靠性要求高的场合。</p><p>UDP协议<strong>面向非连接协议</strong>，数据传输不可靠，<strong>传输速度快</strong>，适用于<strong>一次只传送少量数据</strong>、对可靠性要求不高的应用环境。</p><h4 id="面向连接的TCP"><a href="#面向连接的TCP" class="headerlink" title="面向连接的TCP"></a>面向连接的TCP</h4><p>“面向连接”就是在正式通信前必须要与对方建立起连接。比如你给别人打电话，必须等线路接通了、对方拿起话筒才能相互通话。</p><p>TCP协议能为应用程序提供可靠的通信连接，使一台计算机发出的字节流无差错地发往网络上的其他计算机，对可靠性要求高的数据通信系统往往使用TCP协议传输数据。</p><h4 id="面向非连接的UDP协议"><a href="#面向非连接的UDP协议" class="headerlink" title="面向非连接的UDP协议"></a>面向非连接的UDP协议</h4><p>“面向非连接“就是在正式通信前不必与对方先建立连接，不管对方状态就直接发送。这与现在风行的手机短信非常相似：你在发短信的时候，只需要输入对方手机号就OK了。</p><p>UDP适用于一次只传送少量数据、对可靠性要求不高的应用环境</p><p>UDP协议是面向非连接的协议，没有建立连接的过程。正因为UDP协议没有连接的过程，所以它的通信效果高；但也正因为如此，它的可靠性不如TCP协议高。QQ就使用UDP发消息，因此有时会出现收不到消息的情况。</p><h4 id="TCP协议与UDP协议支持的应用协议"><a href="#TCP协议与UDP协议支持的应用协议" class="headerlink" title="TCP协议与UDP协议支持的应用协议"></a>TCP协议与UDP协议支持的应用协议</h4><p>TCP支持的应用协议主要有：<strong>Telnet、FTP、SMTP</strong> 等；<br>UDP支持的应用层协议主要有：<strong>NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系统）、TFTP（通用文件传输协议）</strong>等。</p><p>TCP和UDP都是位于OSI模型中的传输层中。</p><p>📢 <strong>TCP优点</strong>：面向连接的,具有实时性,就象打电话一样,两者必须建立连接.<br>它保证你所传输的东西是准确到达的,并且收方要给你一个收到或没有\收到的回复,所以它具有安全性的特点..<br>📢 <strong>UDP优点</strong>：面向无连接的,就象给某人寄信一样,对方不需要在邮局等着你的信到.<br>所以说,它没有保障性,不能确保你一定能收到信,不象TCP那样,,但是 它比TCP好的一点,就是速度快,因为他不需要双方交流是否收到,对发的东西有一个确认的过程.</p>]]></content>
      
      
      <categories>
          
          <category> 网络通信 </category>
          
          <category> DNS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DNS </tag>
            
            <tag> UDP </tag>
            
            <tag> TCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDoS攻击</title>
      <link href="/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/DDoS%E6%94%BB%E5%87%BB/"/>
      <url>/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/DDoS%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：DDoS() 技术鉴赏</p></blockquote><p>[toc]</p><h1 id="DDoS说明"><a href="#DDoS说明" class="headerlink" title="DDoS说明"></a>DDoS说明</h1><blockquote><p>DDoS(Distributed Denial of Service)即分布式拒绝服务攻击,是一种通过大量占用目标服务器资源的方式,使服务暂时中断或停止,无法对正常用户提供服务的攻击手段。</p></blockquote><p>DDoS攻击的主要特征包括:</p><blockquote><ul><li>分布式 - 利用大量分布在不同地点的攻击源进行攻击。</li><li>流量泛滥 - 通过发送大量流量淹没目标服务器的带宽或资源。常见的有UDP flood、ICMP flood等。</li><li>资源耗尽 - 占用目标服务器的关键系统资源,如连接数、线程数等。如SYN flood攻击。</li><li>攻击增强 - 通过各种方式增强攻击流量和效果。如IP地址欺骗。</li><li>多向量组合 - 综合使用各种类型的攻击手段,对目标发起多维攻击。</li></ul></blockquote><p>防御DDoS攻击的主要手段包括:</p><blockquote><ul><li><p>增加带宽 - 提高流量承载能力。</p></li><li><p>使用DDoS防护服务 - 由服务提供商过滤攻击流量。</p></li><li><p>限制连接和请求 - 加强对高流量源的访问控制。</p></li><li><p>丢弃无效流量 - 通过技术手段识别并丢弃攻击流量。</p></li><li><p>扩展关键系统资源 - 提高关键资源池容量。</p></li><li><p>服务降级 - 在被攻击时暂时停止非核心服务。</p></li><li><p>服务分散 - 通过CDN等方式分散服务,避免单点故障。</p></li><li><p>合理限速 - 对源IP访问频率和流量进行控制。</p><p>DDoS防御需要综合运用各种技术手段,从网络、服务和应用层进行防护,最大程度减轻攻击影响。</p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> DDoS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>密钥分配</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20%E7%AC%AC7%E7%89%88%E3%80%8B/%E7%AC%AC7%E7%AB%A0%20%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/7.5%20%E5%AF%86%E9%92%A5%E5%88%86%E9%85%8D/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20%E7%AC%AC7%E7%89%88%E3%80%8B/%E7%AC%AC7%E7%AB%A0%20%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/7.5%20%E5%AF%86%E9%92%A5%E5%88%86%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="密钥分配"><a href="#密钥分配" class="headerlink" title="密钥分配"></a>密钥分配</h1><p>由于密码算法是公开的，网路的安全性就完全基于密钥的安全保护上。因此在密码学中出现了一个重要的分支——密钥管理。密钥管理包括：密钥的产生、分配、注入、验证和使用。本节只讨论密钥的分配。</p><blockquote><p><strong>密钥分配</strong>（或<strong>密钥分发</strong>）是密钥管理中最大的问题。密钥必须通过最安全的通路进行分配。</p><p>例如，可以派非常可靠的信使携带密钥分配给互相通信的各用户。这种方法称为<strong>网外分配方式</strong>。但随着用户的增多和网络流量的增大，密钥更换频繁（密钥必须定期更换才能做到可靠），派信使的办法已不再使用，而应采用网内分配方式，即对密钥自动分配。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《计算机网络 第7版》 </category>
          
          <category> 第7章 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 密钥管理 </tag>
            
            <tag> 对称密钥 </tag>
            
            <tag> 公钥 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第7章 网络安全</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20%E7%AC%AC7%E7%89%88%E3%80%8B/%E7%AC%AC7%E7%AB%A0%20%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/index/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20%E7%AC%AC7%E7%89%88%E3%80%8B/%E7%AC%AC7%E7%AB%A0%20%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/index/</url>
      
        <content type="html"><![CDATA[<p>本章只是对计算机网络安全问题进行初步的介绍。</p><p>本章最重要的内容是：</p><ol><li>计算机完了过面临的安全性威胁和计算机网络安全的主要问题</li></ol>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《计算机网络 第7版》 </category>
          
          <category> 第7章 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 防火墙 </tag>
            
            <tag> 对称密钥 </tag>
            
            <tag> 公钥 </tag>
            
            <tag> ssl </tag>
            
            <tag> tls </tag>
            
            <tag> 系统安全 </tag>
            
            <tag> 数字签名与鉴别 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>热补丁支持</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B/3-13-%E7%83%AD%E8%A1%A5%E4%B8%81%E6%94%AF%E6%8C%81/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B/3-13-%E7%83%AD%E8%A1%A5%E4%B8%81%E6%94%AF%E6%8C%81/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="补丁"><a href="#补丁" class="headerlink" title="补丁"></a>补丁</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>补丁是指衣服、被褥上为遮掩破洞而钉补上的小布块。明白了吗？</p><blockquote><p>现在也指对于大型<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6">软件</a>系统(如<a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/233219">微软操作系统</a>)在使用过程中暴露的问题（一般由<a href="https://baike.baidu.com/item/%E9%BB%91%E5%AE%A2/118396">黑客</a>或<a href="https://baike.baidu.com/item/%E7%97%85%E6%AF%92/21267">病毒</a>设计者发现）而发布的解决问题的小程序。就像衣服烂了就要打补丁一样，人编写程序不可能十全十美的，所以<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6/12053">软件</a>也免不了会出现BUG，而补丁是专门修复这些BUG做的因为原来发布的软件存在缺陷，发现之后另外编制一个小程序使其完善，这种小程序俗称补丁。补丁是由<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6/12053">软件</a>的原来作者制作的，可以访问网站下载补丁。</p><p>补丁一般都是 <code>.exe</code> 文件</p></blockquote><h2 id="微软补丁"><a href="#微软补丁" class="headerlink" title="微软补丁"></a>微软补丁</h2><p><a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF">微软</a>的<a href="https://baike.baidu.com/item/Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">Windows操作系统</a>比较大，比较复杂。因此总有考虑不周的地方。有些病毒或者黑客就利用微软的漏洞进行攻击。微软发现漏洞后就发布一些补丁程序。 我们得到微软的补丁程序后安装到计算机上就叫打补丁。</p><blockquote><p>什么是微软补丁？</p><p>微软发布的系统补丁有两种类型：<code>Hotfix</code> 和 <code>Service Pack</code>，下面介绍它们之间的区别和联系。</p><ul><li><code>hotfix</code> 是微软针对某一个具体的系统漏洞或安全问题而发布的专门解决程序，<code>Hotfix</code>的程序文件名有严格的规定，一般格式为“产品名-KBXXXXXX-处理器平台-语言版本.exe”。现在一个例子来详细说明：微软针对震荡病毒而发布的<code>Hotfix</code>程序名为“Win2K-KB835732-X86-CHS.exe”，我们知道这个补丁是针对Win2000系统的，其知识库编号为 835732，应用于 X86 处理器平台，语言版本为简体中文。</li><li><code>Hotfix</code> 是针对某一个具体问题而发布的解决程序，因此它会经常发布，数量非常大。用户想要知道目前已经发布了哪些<code>Hotfix</code>程序是一件非常麻烦的事。因此微软将这些<code>Hotfix</code>补丁全部打包成一个程序提供给用户安装，这就是<code>Service Pack</code>，简称<code>SP</code>。<code>Service Pack</code>包含了发布日期以前所有的<code>Hotfix</code>程序，因此只要安装了它，就可以保证自己不会漏掉一个<code>Hotfix</code>程序。而且发布时间晚的<code>Service Pack</code>程序会包含以前的<code>Service Pack</code>，例如 <code>SP3</code>会包含<code>SP1</code>、<code>SP2</code>的所有补丁。</li></ul></blockquote><h1 id="热补丁支持"><a href="#热补丁支持" class="headerlink" title="热补丁支持"></a>热补丁支持</h1><blockquote><p>重新引导一台机器以便把最新的补丁都应用上，这对于服务器来说可能会意味着一段显著的宕机时间，这也正是为什么Windows要支持运行时刻的补丁方法，称为热补丁（hot patch，或简化为hotpatch）。与之相反的是冷补丁（coldpatch），它要求一次重新引导。热补丁并非只是简单地允许文件可在执行过程中被覆盖;相反地，它包括了一系列可能会被请求执行的复杂操作（这些操作也可能会组合起来）。</p></blockquote><h2 id="热补丁执行操作"><a href="#热补丁执行操作" class="headerlink" title="热补丁执行操作"></a>热补丁执行操作</h2><p>下表列出了这些操作：</p><table><thead><tr><th>操作</th><th>含义</th><th>用途</th></tr></thead><tbody><tr><td>映像文件改名称<br />（Rename Image)</td><td>替换磁盘上一个正在被其他应用程序使用的DLL，或者替换磁盘上一个已经被内核加载到系统中的驱动程序</td><td>当一个用户模式的库需要完整地被替换的时候，内核可以检测到哪些进程和服务正在引用该库，将它们卸载出内存，然后更新DLL，再重新启动这些程序和服务（通过<u>重启管理器</u>[restart manager]来完成）。当一个驱动程序需要被替换的时候，内核可以卸载该驱动程序（该驱动程序要求有一个卸载例程），更新驱动程序，然后重新加载替换后的驱动程序</td></tr><tr><td>对象交换<br />（Object Swap）</td><td>以原子操作的方式更改对象目录名字空间中的一个对象</td><td>当一个文件（往往是已知的DLL）需要被原子凡事修改名称，但不影响任何可能正在使用该文件的进程时（所以，这些进程可以立即使用新的文件，且仍然使用老的句柄，但不要求应用程序重新启动）</td></tr><tr><td>补丁函数代码<br />（Patch Function Code）</td><td>将一个映像文件中的一个或多个函数的代码替换为新的版本</td><td>如果在运行时刻一个DLL或驱动程序不能被替换或修改名称，则该映像中的函数可以直接被打上补丁。对于一个包含了新代码的热补丁DLL，当老的函数被调用时，它会跳转到新的代码中。</td></tr><tr><td>刷新系统DLL<br />（Refresh System DLL）</td><td>重新为Ntdll.dll加载内存映射区对象</td><td>Windows的系统原生库Ntdll.dll只在系统引导过程中被加载一次，以后只是被简单地复制到每个新进程的地址空间中。如果它呗热补丁了，那么，系统必须刷新这一内存区对象，以便加载新的版本</td></tr></tbody></table><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p><mark style="background-color:red">运行时刻卸载</mark></p><p>热补丁文件的构成除了包括要替换的函数部分，还包括一个<u><code>Update.exe</code>的程序</u>以及<u>一个额外的<code>.hp</code>热补丁文件</u>。</p><ul><li><code>Update.exe</code>：完成该补丁的提取工作，也执行相应的更新过程。</li><li><code>.hp</code>热补丁文件：此文件包含一个特殊的<code>PE头</code>，称为<code>.HOT1</code>。该PE头包含了一个数据结构，描述了该文件中出现的各种补丁描述符（patch descriptor）。每一个补丁描述述符指明了在原始文件中需要被补丁的偏移位置、一个验证机制（它可以包含一份老数据的简单比较、一个校验和，或者一个散列值），以及待补丁的新数据。内核将解析这些描述符，并且执行恰当的修改动作。若是被保护的进程（protected process，有关进程的更多信息，参见《深入理解Windows操作系统》第5章），或者其他经过数字签名的二进制映像，在这些情况下，热补丁也必须被经过数字签名，以避免针对敏感文件或进程执行“伪造的”补丁。</li></ul><p>在编译时刻对热补丁的支持，是通过在每个函数的开始处加入7个额外的字节来做到的。其中5个字节被看做前一个函数的结束部分，2个字节被看作<strong>函数前缀</strong>（function prolog）部分，也就是函数的开始。</p><h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p>使用热补丁也存在一些限制：</p><ol><li>与安全软件的不兼容。像安全软件类的第三方应用程序可能会阻止这样的补丁；补丁也可能与第三方应用程序的操作系统不兼容</li><li>补丁要修改一个文件的导出表或导入表</li><li>补丁要改变数据结构，修正无限循环，或者包含内联的汇编代码</li></ol>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《深入理解Windows操作系统》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《深入理解Windows操作系统》 </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSI参考模型</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B/7-1-OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B/7-1-OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>OSI 参考模型是一个理想化的方案。这么说是因为很少有系统是完全按照它来实现（关于这一点可以后续再讨论），但是它通常被用来作为网络原理讨论的框架。</p><blockquote><p>一台机器上的每一层都假设它在跟另一台机器上的同一层“通话”。在同一层次上，两台机器“说”的是同一种语言或协议。</p></blockquote><p>每一次网络传输必须都要向下传输，通过客户机器的每一层，再传输到网络上，然后再目标机器上向上传递，直至到达某一可以理解和执行该请求的层。</p><p>在 OSI 模型中，每一层的目的是：向更高的层提供服务，并且对如何在低层上实现这些服务进行抽象。</p><p>以下内容为 OSI 七层中每一层的介绍:</p><ol><li>物理层</li><li>数据链路层</li><li>网络层</li><li>传输层</li><li>会话层</li><li>表示层</li><li>应用层</li></ol>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《深入理解Windows操作系统》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《深入理解Windows操作系统》 </tag>
            
            <tag> 网络编程 </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>返回值类型的规范</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B/1-1-%E8%BF%94%E5%9B%9E%E5%80%BC%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%A7%84%E8%8C%83/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B/1-1-%E8%BF%94%E5%9B%9E%E5%80%BC%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%A7%84%E8%8C%83/</url>
      
        <content type="html"><![CDATA[<p>参照 Windows 对程序错误的处理中，函数常用返回值的设置，作为C++开发，也应该参照这一标准。</p><blockquote><p>当调用一个 Windows 函数时，它首先要检验传递给它的的各个参数的有效性，然后再设法</p><p>执行任务。如果传递了一个无效参数，或者由于某种原因无法执行这项操作，那么操作系统就</p><p>会返回一个值，指明该函数在某种程度上运行失败了。表 1 - 1列出了大多数 Windows 函数使用</p><p>的返回值的数据类型</p></blockquote><center>Windows 函数常用的返回值类型</center><table><thead><tr><th>数据类型</th><th>表示失败的值</th></tr></thead><tbody><tr><td>void</td><td>该函数的运行不可能失败。Windows 函数的返回值类型很少是 void</td></tr><tr><td>bool</td><td>如果函数运行失败，那么返回值是0，否则返回的是非0值。最好对返回值进行测试，以确定它是0还是非0。不要测试返回值是否为TRUE</td></tr><tr><td>HANDLE</td><td>如果函数运行失败，则返回值通常是 NULL，否则返回值为 HANDLE，用于标识你可以操作的一个对象。注意，有些函数会返回一个句柄值 INVALID_ HANDLE_VALUE，它被定义为 -1。函数的Platform SDK 文档将会清楚地说明该函数运行失败时返回的是 NULL 还是 INVALID_HANDLE_VALID</td></tr><tr><td>PVOID</td><td>如果函数运行失败，则返回值是 NULL，否则返回PVOID，以标识数据块的内存地址</td></tr><tr><td>LONG&#x2F;DWORD</td><td>这是个难以处理的值。返回数量的函数通常返回LONG或DWORD。如果由于某种原因，函数无法对想要进行计数的对象进行计数，那么该函数通常返回 0或-1（根据函数而定）。如果调用的函数反悔了LONG&#x2F;DWORD，那么需要阅读相应的函数说明，以确保能正确检查潜在的错误。</td></tr></tbody></table><p>一个 <code>Windows</code> 函数返回的错误代码对了解该函数为什么会运行失败尝尝很有用。</p><blockquote><p>从系统内部来讲，当一个Windows函数检测到一个错误时，它会使用一个称为线程本地存储器（thread-local storage）的机制，将相应的错误代码号码与调用的线程关联起来。这将使线程能够互相独立运行，而不会影响各自的错误代码。当函数返回时，它的返回值就能指明一个错误已经发生。若要确定这是个什么错误，则需要调用 <code>GetLastError</code> 函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DWORD GetLastError</span><br></pre></td></tr></table></figure></blockquote>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Windows核心编程》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《Windows核心编程》 </tag>
            
            <tag> 规范 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;3&gt; 确定对象使用前初始化</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/3_%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E5%89%8D%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/3_%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E5%89%8D%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="未初始化的对象"><a href="#未初始化的对象" class="headerlink" title="未初始化的对象"></a>未初始化的对象</h1><p>在初始化对象的值方面，C++ 似乎相当善变。如下面示例代码，<code>g_var</code> 为全局变量，自动初始化为 0，而 a 是一个随机值。p 的成员变量有时候被初始化为 0，有时候不会，从运行结果来看两次都已经初始化为 0。</p><p>而其他变成语言中用一个 “无初值对象” 是不存在的，这很重要。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initObj.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __INITOBJ_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __INITOBJ_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g_var;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>() &#123;&#125;</span><br><span class="line">    ~<span class="built_in">Point</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> xp; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> yp; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> xp;</span><br><span class="line">    <span class="type">int</span> yp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __INITOBJ_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initObj.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;initObj.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;a = &quot;</span> &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;g_var = &quot;</span> &lt;&lt; g_var &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    Point p;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Point::x = &quot;</span> &lt;&lt; p.<span class="built_in">x</span>() &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Point::y = &quot;</span> &lt;&lt; p.<span class="built_in">y</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="C-初始化"><a href="#C-初始化" class="headerlink" title="C++初始化"></a>C++初始化</h1><p>通常如果你使用类 C 语法部分而未初始化可能招致运行期成本，那么就不保证发生初始化。一旦进入纯 C++ 部分，规则有些变化。这就很好地解释了为什么数组不保证其内容被初始化，而 <code>vector</code> 却能保证初始化。</p><h4 id="基础数据类型初始化"><a href="#基础数据类型初始化" class="headerlink" title="基础数据类型初始化"></a>基础数据类型初始化</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// baseData.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>;                              <span class="comment">// 手动初始化 int 类型对象</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> * text = <span class="string">&quot;shiyanlou&quot;</span>;        <span class="comment">// 手动初始化指针字符串</span></span><br><span class="line">    <span class="type">double</span> d;                               <span class="comment">// 通过读取输入方式初始化</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;请输入：&quot;</span>;</span><br><span class="line">    std::cin &gt;&gt; d;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;text = &quot;</span> &lt;&lt; text &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;d = &quot;</span> &lt;&lt; d &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="类初始化"><a href="#类初始化" class="headerlink" title="类初始化"></a>类初始化</h4><p>至于内置类型以外的任何其他对象，初始化责任落在了构造函数。规则很简单，确保每一个构造函数都将对象的每一个成员初始化。</p><p>这个规则很简单，重要的是别混淆了赋值和初始化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initClass.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __INITCLASS_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __INITCLASS_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneNumber</span> &#123;  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ABEntry</span></span><br><span class="line">&#123; <span class="comment">// ABEntry = “Address Book Entry”</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; address,</span><br><span class="line">    <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string theName;</span><br><span class="line">    std::string theAddress;</span><br><span class="line">    std::list&lt;PhoneNumber&gt; thePhones;</span><br><span class="line">    <span class="type">int</span> numTimesConsulted;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __INITCLASS_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initClass.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;initClass.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">ABEntry::<span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name,</span><br><span class="line">    <span class="type">const</span> std::string&amp; address,</span><br><span class="line">    <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones)</span><br><span class="line">&#123;</span><br><span class="line">    theName = name;         <span class="comment">// 这些都是赋值而非初始化</span></span><br><span class="line">    theAddress = address;</span><br><span class="line">    thePhones = phones;</span><br><span class="line">    numTimesConsulted = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这将产生具有你期望的值的 <code>ABEntry</code> 对象，但这仍然不是最好的方法。C++ 的规则规定，对象的数据成员在进入构造函数的主体之前被初始化。在 <code>ABEntry</code> 构造函数中，<code>theName</code>、<code>theAddress</code> 和 <code>thePhones</code> 没有被初始化，它们只是被赋值。初始化发生在进入 <code>ABEntry</code> 构造函数正文之前，即自动调用它们的默认构造函数时进行的。在进入 <code>ABEntry</code> 构造函数的主体之前，已经进行了初始化。这对于 <code>numTimesConsulted</code> 不是这样，因为它是一个内置类型。对它来说，不能保证它在被赋值之前就被初始化了。</p><h1 id="初始化列表"><a href="#初始化列表" class="headerlink" title="初始化列表"></a>初始化列表</h1><p><code>ABEntry</code> 构造函数的一个较佳写法是使用初始化列表进行初始化。</p><h4 id="初始化列表使用方法"><a href="#初始化列表使用方法" class="headerlink" title="初始化列表使用方法"></a>初始化列表使用方法</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initList.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __INITLIST_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __INITLIST_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneNumber</span> &#123;  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ABEntry</span></span><br><span class="line">&#123; <span class="comment">// ABEntry = “Address Book Entry”</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; address,</span><br><span class="line">    <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string theName;</span><br><span class="line">    std::string theAddress;</span><br><span class="line">    std::list&lt;PhoneNumber&gt; thePhones;</span><br><span class="line">    <span class="type">int</span> numTimesConsulted;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __INITLIST_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initList.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;initList.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">ABEntry::<span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name,</span><br><span class="line">    <span class="type">const</span> std::string&amp; address,</span><br><span class="line">    <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones) :</span><br><span class="line">    <span class="built_in">theName</span>(name),      <span class="comment">// 以下使用初始化列表，从冒号（:）后开始</span></span><br><span class="line">    <span class="built_in">theAddress</span>(address),</span><br><span class="line">    <span class="built_in">thePhones</span>(phones),</span><br><span class="line">    <span class="built_in">numTimesConsulted</span>(<span class="number">0</span>)</span><br><span class="line">&#123;&#125;                      <span class="comment">// 构造函数中为空</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例代码中构造函数与在构造函数中赋值的最终结果相同，但它往往更有效率。基于赋值的版本首先调用默认构造函数来初始化 <code>theName</code>、<code>theAddress</code> 和 <code>thePhones</code>，然后立即在默认构造的基础上分配新的值。因此，所有在这些默认构造中进行的工作都被浪费了。成员初始化列表的方法避免了这个问题，因为初始化列表中的参数被用作各种数据成员的构造器参数。在这个例子中，<code>theName</code> 是由 <code>name</code> 拷贝构造的，<code>theAddress</code> 是由 <code>address</code> 复制构造的，<code>thePhones</code> 是由 <code>phones</code> 拷贝构造的。</p><p>对大多数类型而言，比起先调用默认构造函数然后再调用拷贝赋值操作符，单只调用一次赋值构造函数是比较高效的，有时甚至高效得多。对于内置型对象如 <code>numTimesConsulted</code>，其初始化和赋值的成本相同，但为了一致性最好也通过成员初值列来初始化。同样道理，甚至当你想要默认构造一个成员变量，你都可以使用成员初值列，只要指定 0 或者空作为初始化实参即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ABEntry::<span class="built_in">ABEntry</span>() :</span><br><span class="line">    <span class="built_in">theName</span>(),              <span class="comment">// 调用 thenName 默认构造函数</span></span><br><span class="line">    <span class="built_in">theAddress</span>(),           <span class="comment">// 调用 theAddress 默认构造函数</span></span><br><span class="line">    <span class="built_in">thePhones</span>(),            <span class="comment">// 调用 thePhones 默认构造函数</span></span><br><span class="line">    <span class="built_in">numTimesConsulted</span>(<span class="number">0</span>)    <span class="comment">// 初始化为 0</span></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="初始化说明"><a href="#初始化说明" class="headerlink" title="初始化说明"></a>初始化说明</h4><p>当用户定义类型的数据成员在成员初始化列表中没有初始化时，编译器会自动调用这些数据成员的默认构造器，所以有些程序员认为上述方法是多余的是可以理解的，但是如果有一个总是在初始化列表中列出每个数据成员的策略，就可以避免记住哪些数据成员在被省略后可能会被未初始化。例如，由于 <code>numTimesConsulted</code> 是一个内置的类型，如果没有在初始化列表中遗漏没有初值时就会导致不明确行为。</p><p>有些情况下即使面对的成员变量属于内置类型（其初始化与赋值的成本相同），也一定得使用初值列。是的，如果成员变量是常量或引用时，它们就一定需要初值，不能被赋值。为避免需要记住成员变量何时必须在成员初值列中初始化，何时不需要，最简单的做法就是：总是使用成员初值列。这样做有时候绝对必要，且又往往比赋值更高效。</p><p>许多类拥有多个构造函数，每个构造函数有自己的成员初值列。如果这种类存在许多成员变量或基类，多份成员初值列的存在就会导致不受欢迎的重复（在初值列内）和无聊的工作（对程序员而言）。这种情况下可以合理地在初值列中遗漏那些 “赋值表现像初始化一样好” 的成员变量，改用它们的赋值操作，并将那些赋值操作移往某个函数（通常是私有的），供所有构造函数调用。这种做法在 “成员变量的初值系由文件或数据库读入” 时特别有用。然而，比起经由赋值操作完成的 “伪初始化”（pseudo-initialization），通过成员初值列完成的 “真正初始化” 通常更加可取。</p><p>C++ 有着十分固定的 “成员初始化顺序”。顺序总是相同：基类更早于其子类被初始化，而类的成员变量总是以其声明次序被初始化。回头看看 <code>ABEntry</code>，其 <code>theName</code> 成员永远最先被初始化，然后是 <code>theAddress</code>，再是 <code>thePhones</code>，最后是 <code>numTimesConsulted</code>。即使它们在成员初值列中以不同的顺序出现（很不幸那是合法的），也不会有任何影响。为避免你或你的检查代码的人迷惑，并避免某些可能存在的晦涩错误，当你在成员初值列中条列各个成员时，最好总是以其声明次序为次序。</p><h1 id="初始化静态对象"><a href="#初始化静态对象" class="headerlink" title="初始化静态对象"></a>初始化静态对象</h1><p>静态（static）对象寿命从被构造出来直到程序结束为止，因此栈和堆对象都被排除。包括全局对象、命名空间内的对象、类、函数和文件内被声明静态的对象。函数内的静态对象称为局部静态对象（因为它们对函数而言是局部的），其他静态对象称为非局部静态对象。程序结束时静态对象会被自动销毁，也就是它们的析构函数会在 <code>main()</code> 结束时被自动调用。</p><h1 id="初始化顺序"><a href="#初始化顺序" class="headerlink" title="初始化顺序"></a>初始化顺序</h1><p>如下示例代码，我们关心的问题涉及至少两个源码文件，每一个内含至少一个非局部静态对象（也就是说该对象是全局或位于命名空间内，抑或在类内或源码文件内被声明为静态）。真正的问题是：如果某编译单元内的某个非局部静态对象的初始化动作使用了另一编译单元内的某个非局部静态对象，它所用到的这个对象可能尚未被初始化，因为 C++ 对 “定义于不同编译单元内的非局部静态对象” 的初始化次序并无明确定义。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileSystem.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __FILESYSTEM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __FILESYSTEM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    假设有一个 FileSystem 类，它让互联网上的文件看起来好像位于本机。</span></span><br><span class="line"><span class="comment">    由于这个类使文件系统看起来像个单一文件系统，你可能会产出一个特殊对象，</span></span><br><span class="line"><span class="comment">    位于全局或命名空间作用域内，像是单一文件系统。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystem</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileSystem</span>() &#123;&#125;</span><br><span class="line">    ~<span class="built_in">FileSystem</span>() &#123;&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function">std::<span class="type">size_t</span> <span class="title">numDisks</span><span class="params">()</span> <span class="type">const</span></span>; <span class="comment">// 其中一个成员函数</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  FileSystem 对象绝不是一个稀松平常无关痛痒的对象，</span></span><br><span class="line"><span class="comment">  因为你的客户如果在 theFileSystem 对象构造完成前就使用它，会得到惨重的灾情。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 预留给用户使用的对象</span></span><br><span class="line"><span class="keyword">extern</span> FileSystem tfs;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __FILESYSTEM_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Directory.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DIRECTORY_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DIRECTORY_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FileSystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Directory</span>(<span class="type">const</span> FileSystem &amp;fs);</span><br><span class="line">    ~<span class="built_in">Directory</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __DIRECTORY_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Director.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Directory.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  假设某些客户建立了一个 Directory 类用以处理文件系统内的目录。</span></span><br><span class="line"><span class="comment">  很自然他们的类会用上 theFileSystem 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Directory::<span class="built_in">Directory</span>(<span class="type">const</span> FileSystem &amp;tfs)</span><br><span class="line">&#123;</span><br><span class="line">    std::<span class="type">size_t</span> disks = tfs.<span class="built_in">numDisks</span>(); <span class="comment">// 使用 tfs 对象</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Directory::~<span class="built_in">Directory</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FileSystem.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Directory.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 假设创建一个目录来存放临时文件</span></span><br><span class="line">    <span class="function">Directory <span class="title">tempDir</span><span class="params">(tfs)</span></span>;     <span class="comment">// 临时文件存放目录</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在，初始化次序的重要性显现出来了：除非 <code>tfs</code> 在 <code>tempDir</code> 之前先被初始化，否则 <code>tempDir</code> 的构造函数会用到尚未初始化的 <code>tfs</code>。但 <code>tfs</code> 和 <code>tempDir</code> 是不同的人在不同的时间于不同的源码文件建立起来的，它们是定义于不同编译单元内的非局部静态对象。如何能够确定 <code>tfs</code> 会在 <code>tempDir</code> 之前先被初始化？</p><p>C++ 对 “定义于不同的编译单元内的非局部静态对象” 的初始化相对次序并无明确定义。这是有原因的：决定它们的初始化次序相当困难，根本无解。在其最常见形式，也就是多个编译单元内的非局部静态对象经由 “模板隐式具现化” 形成（而后者自己可能也是经由 “模板隐式具现化” 形成），不但不可能决定正确的初始化次序，甚至往往不值得寻找 “可决定正确次序” 的特殊情况。</p><h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p>幸运的是一个小小的设计便可完全消除这个问题。唯一需要做的是：将每个 非局部静态对象搬到自己的专属函数内（该对象在此函数内被声明为静态）。这些函数返回一个引用指向它所含的对象。然后用户调用这些函数，而不直接指涉这些对象。换句话说，非局部静态对象被局部静态对象替换了。设计模式的迷哥迷妹们想必认出来了，这是单例模式的一个常见实现手法。</p><p>这个手法的基础在于：C++ 保证，函数内的局部静态对象会在该函数被调用期间首次遇上该对象之定义式时被初始化。所以如果你以 “函数调用”（返回一个引用指向局部静态对象）替换直接访问非局部静态对象，你就获得了保证，保证你所获得的那个引用将指向一个历经初始化的对象。更棒的是，如果你从未调用非局部静态对象的 “仿真函数”，就绝不会引发构造和析构成本；真正的非局部静态对象可没这等便宜！</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileSystem.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FileSystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 该函数替换 tfs 对象，在类中是静态的，</span></span><br><span class="line"><span class="function">FileSystem&amp; <span class="title">tfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> FileSystem tfs;  <span class="comment">// 定义并初始化非局部静态对象</span></span><br><span class="line">    <span class="keyword">return</span> tfs;             <span class="comment">// 返回对象引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::<span class="type">size_t</span> <span class="title">FileSystem::numDisks</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Director.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Directory.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  假设某些客户建立了一个 Directory 类用以处理文件系统内的目录。</span></span><br><span class="line"><span class="comment">  很自然他们的类会用上 theFileSystem 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Directory::<span class="built_in">Directory</span>(<span class="type">const</span> FileSystem &amp;tfs)</span><br><span class="line">&#123;</span><br><span class="line">    std::<span class="type">size_t</span> disks = tfs.<span class="built_in">numDisks</span>(); <span class="comment">// 使用 tfs 对象</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Directory::~<span class="built_in">Directory</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这么修改之后，这个系统程序的客户完全像以前一样地用它，唯一不同的是他们现在使用 <code>tfs()</code> 和 <code>tempDir()</code> 函数，而不再是 <code>tfs</code> 和 <code>tempDir</code> 对象。也就是说他们使用函数返回的 “指向静态对象” 的引用，而不再使用对象自身。</p><p>这种结构下的返回引用函数往往十分单纯：第一行定义并初始化一个局部静态对象，第二行返回它。这样的单纯性往往使用内联函数，尤其如果它们被频繁调用的话（见实验《透彻内联》）。但是从另一个角度看，这些函数 “内含静态对象” 的事实使它们在多线程系统中带有不确定性。再说一次，任何一种非常量静态对象，不论它是局部或非局部，在多线程环境下往往都会很麻烦。处理这个麻烦的一种做法是：在程序的单线程启动阶段手工调用所有返回引用函数，这可消除与初始化有关的 “竞速条件（race conditions）”。</p><p>为避免在对象初始化之前过早地使用它们，你需要做三件事：</p><ol><li>手动初始化内置型非成员变量。</li><li>使用初始化列表初始化成员变量。</li><li>在初始化顺序不确定情况下加强设计。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Efficient C++》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Efficent C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;4&gt; 了解C++默认创建并调用的函数</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/4-%E4%BA%86%E8%A7%A3C++%E9%BB%98%E8%AE%A4%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/4-%E4%BA%86%E8%A7%A3C++%E9%BB%98%E8%AE%A4%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="编译器创建的函数"><a href="#编译器创建的函数" class="headerlink" title="编译器创建的函数"></a>编译器创建的函数</h1><p>空类：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span>&#123;&#125;;</span><br></pre></td></tr></table></figure><p>编译器默认添加的函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// defaultFunc.h</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 当程序中未定义以下函数时编译器默认添加</span></span><br><span class="line">    <span class="built_in">Empty</span>() &#123;  &#125;                                <span class="comment">// 默认构造函数</span></span><br><span class="line">    <span class="built_in">Empty</span>(<span class="type">const</span> Empty&amp; rhs) &#123;  &#125;                <span class="comment">// 拷贝构造函数</span></span><br><span class="line">    ~<span class="built_in">Empty</span>() &#123;  &#125;                               <span class="comment">// 析构函数</span></span><br><span class="line">    Empty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Empty&amp; rhs) &#123;  &#125;     <span class="comment">// 拷贝赋值操作符函数</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="拷贝构造函数与拷贝赋值操作符函数"><a href="#拷贝构造函数与拷贝赋值操作符函数" class="headerlink" title="拷贝构造函数与拷贝赋值操作符函数"></a>拷贝构造函数与拷贝赋值操作符函数</h1><p>拷贝构造函数和拷贝赋值操作符函数，编译器创建的版本只是单纯地将来源对象的每一个非静态成员变量拷贝到目标对象。如下模板类 <code>NamedObject</code>，它允许你将一个名称和类型为 T 的对象产生关联。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// copy.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __COPY_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __COPY_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NamedObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      由于其中声明了一个构造函数，编译器于是不再为它创建默认构造函数。</span></span><br><span class="line"><span class="comment">      这很重要，意味如果你用心设计一个类，其构造函数要求实参，</span></span><br><span class="line"><span class="comment">      你就无须担心编译器会毫无挂虑地为你添加一个无实参构造函数（即默认构造函数）而遮盖掉你的版本。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NamedObject</span>(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">const</span> T&amp; value) : <span class="built_in">nameValue</span>(name), <span class="built_in">objectValue</span>(value) &#123;&#125;</span><br><span class="line">    <span class="built_in">NamedObject</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> T&amp; value) : <span class="built_in">nameValue</span>(name), <span class="built_in">objectValue</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string nameValue;</span><br><span class="line">    T objectValue;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __COPY_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;copy.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      NamedObject 既没有声明拷贝构造函数，也没有声明拷贝赋值操作符函数，</span></span><br><span class="line"><span class="comment">      所以编译器会为它创建那些函数（如果它们被调用的话）。</span></span><br><span class="line"><span class="comment">      现在，看看拷贝构造函数的用法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">NamedObject&lt;<span class="type">int</span>&gt; <span class="title">no1</span><span class="params">(<span class="string">&quot;Smallest Prime Number&quot;</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">NamedObject&lt;<span class="type">int</span>&gt; <span class="title">no2</span><span class="params">(no1)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="编译器拒绝创建拷贝赋值操作符函数的情况"><a href="#编译器拒绝创建拷贝赋值操作符函数的情况" class="headerlink" title="编译器拒绝创建拷贝赋值操作符函数的情况"></a>编译器拒绝创建拷贝赋值操作符函数的情况</h1><p>编译器为 <code>NamedObject&lt;int&gt;</code> 所产生的拷贝赋值操作符函数，其行为基本上与拷贝构造函数如出一辙，但一般而言只有当生出的代码合法且有适当机会证明它有意义，其表现才会如我先前所说。万一两个条件有一个不符合，编译器会拒绝为类产生拷贝赋值操作符函数。</p><p>编译器拒绝创建拷贝赋值操作符函数情况：</p><ul><li>成员函数为引用类型。</li><li>成员函数为常量。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Efficient C++》 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>《Efficient C++》 导读</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/Readme/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/Readme/</url>
      
        <content type="html"><![CDATA[<h1 id="导读目录"><a href="#导读目录" class="headerlink" title="导读目录"></a>导读目录</h1><ol><li><a href="./2_const%E5%85%B3%E9%94%AE%E5%AD%97.md">2_const关键字</a></li><li><a href="./3_%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E5%89%8D%E5%88%9D%E5%A7%8B%E5%8C%96.md">3_确定对象使用前初始化</a></li><li><a href="./4-%E4%BA%86%E8%A7%A3C++%E9%BB%98%E8%AE%A4%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0.md">4-了解C++默认创建并调用的函数</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Efficient C++》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 《Efficient C++》 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《Linux命令行与shell脚本编程大全》 导读</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8.%E7%AC%AC3%E7%89%88%E3%80%8B/Readme/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8.%E7%AC%AC3%E7%89%88%E3%80%8B/Readme/</url>
      
        <content type="html"><![CDATA[<h1 id="导读目录"><a href="#导读目录" class="headerlink" title="导读目录"></a>导读目录</h1>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Linux命令行与shell脚本编程大全.第3版》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 《Linux命令行与shell脚本编程大全》 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;2&gt; const 关键字</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/2_const%E5%85%B3%E9%94%AE%E5%AD%97/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AEfficient%20C++%E3%80%8B/2_const%E5%85%B3%E9%94%AE%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="const-修饰指针变量"><a href="#const-修饰指针变量" class="headerlink" title="const 修饰指针变量"></a><code>const</code> 修饰指针变量</h1><p>对于指针，你可以指定指针本身是否为常量，也可以指定指针所指向的内容是常量，或两者都是，或两者都不是。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constPointer.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CONSTPOINTER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CONSTPOINTER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> greeting[] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f1</span><span class="params">(<span class="type">const</span> Widget *pw)</span></span>; <span class="comment">// f1 获取一个指针指向常量的 Widget 对象</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(Widget <span class="type">const</span> *pw)</span></span>; <span class="comment">// f2 相同</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __CONSTPOINTER_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constPointer.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;constPointer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> *p1 = greeting;                <span class="comment">// 非常量指针, 非常量数据</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *p2 = greeting;          <span class="comment">// 非常量指针, 常量数据</span></span><br><span class="line">    <span class="type">char</span> <span class="type">const</span> *p3 = greeting;          <span class="comment">// 非常量指针, 常量数据</span></span><br><span class="line">    <span class="type">char</span> * <span class="type">const</span> p4 = greeting;         <span class="comment">// 常量指针, 非常量数据</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> p5 = greeting;   <span class="comment">// 常量指针, 常量数据</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p1 = &quot;</span> &lt;&lt; p1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p2 = &quot;</span> &lt;&lt; p2 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p3 = &quot;</span> &lt;&lt; p3 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p4 = &quot;</span> &lt;&lt; p4 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p5 = &quot;</span> &lt;&lt; p5 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>总结</strong>：如果 <code>const</code> 出现在星号的左边，那么被指针指向的内容就是常量；如果 <code>const</code> 出现在星号的右边，那么指针本身就是常量；如果 <code>const</code> 出现在星号两边，则表示指针和指针指向的内容都是常量。</p><h1 id="迭代器中的-const"><a href="#迭代器中的-const" class="headerlink" title="迭代器中的 const"></a>迭代器中的 <code>const</code></h1><p><code>STL</code> 的迭代器是以指针为模型的，所以一个迭代器的行为很想一个和 <code>T*</code> 指针。声明一个迭代器的常数就像声明一个指针的常量（即声明一个 <code>T*</code> 常量指针）。迭代器不允许指向不同的内容，但它指向的内容可以被修改。如果你想要一个迭代器指向不能被修改的东西（即 STL 类似于一个 <code>const T*</code> 指针），则需要一个 <code>const_itrerator</code>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constIterator.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CONSTITERATOR_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CONSTITERATOR_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __CONSTITERATOR_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constIterator.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;constIterator.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 指针为非常量，内容为非常量</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;::iterator iter1 = vec.<span class="built_in">begin</span>();</span><br><span class="line">    *iter1 = <span class="number">10</span>;     <span class="comment">// 正确</span></span><br><span class="line">    ++iter1;         <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 指针为常量，内容为非常量</span></span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;::iterator iter2 = vec.<span class="built_in">begin</span>();</span><br><span class="line">    *iter2 = <span class="number">10</span>;     <span class="comment">// 正确， 修改指针所指内容</span></span><br><span class="line">    ++iter2;         <span class="comment">// 错误，iter2 为常量指针，不能修改</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 指针为非常量，内容为常量</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;::const_iterator iter3 = vec.<span class="built_in">begin</span>();</span><br><span class="line">    *iter3 = <span class="number">10</span>;    <span class="comment">// 错误， *iter3 表示指针所指内容为常量，不能修改</span></span><br><span class="line">    ++iter3;        <span class="comment">// 正确，指针非常量，可以改变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 指针为常量，内容为常量</span></span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;::const_iterator iter4 = vec.<span class="built_in">begin</span>();</span><br><span class="line">    *iter4 = <span class="number">10</span>;    <span class="comment">// 错误， *iter4 表示指针所指内容为常量，不能修改</span></span><br><span class="line">    ++iter4;        <span class="comment">// 错误，iter4 为常量指针，不能修改</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 等效于 std::vector&lt;int&gt;::const_iterator iter5 = vec.begin();</span></span><br><span class="line">    <span class="keyword">auto</span> iter5 = vec.<span class="built_in">cbegin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="const-修饰函数返回值"><a href="#const-修饰函数返回值" class="headerlink" title="const 修饰函数返回值"></a><code>const</code> 修饰函数返回值</h1><p>在成员函数上使用 <code>const</code> 的目的是为了确定哪些成员函数可以在 <code>const</code>对象上调用。这样的成员函数很重要，原因有二。首先，它们使一个类的接口更容易理解。知道哪些函数可以修改一个对象，哪些不可以，是很重要的。第二，它们使我们有可能与常量对象一起工作。这是编写高效代码的一个关键方面，提高 C++ 程序性能的基本方法之一是通过引用到常量来传递对象。这种技术只有在有常量成员函数的情况下才是可行的，可以用它来处理产生的常量限定的对象。</p><p>关于 <code>const</code> 修饰成员函数主要讲以下三个知识点：</p><ul><li><code>const</code> 修饰的成员函数可以被重载。</li><li>关于 ”二进制位常量性“ 与 ”逻辑常量性“。</li><li>避免重载而导致重复代码。</li></ul><h2 id="const-修饰成员变量可以被重载"><a href="#const-修饰成员变量可以被重载" class="headerlink" title="const 修饰成员变量可以被重载"></a><code>const</code> 修饰成员变量可以被重载</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// overloadConst.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __OVERLOADCONST_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __OVERLOADCONST_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TextBlock</span>(std::string t) : <span class="built_in">text</span>(t) &#123;&#125;</span><br><span class="line">    ~<span class="built_in">TextBlock</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;const char&amp; operator[](std::size_t position) const&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;char&amp; operator[](std::size_t position)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __OVERLOADCONST_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// overloadConst.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;overloadConst.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在函数中, ctb 是常量</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> TextBlock&amp; ctb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 调用 const TextBlock::operator[]</span></span><br><span class="line">    std::cout &lt;&lt; ctb[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// ctb[0] = &#x27;x&#x27;;                           // 错误，不能修改一个常量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 调用 TextBlock::operator[]</span></span><br><span class="line">    <span class="function">TextBlock <span class="title">tb</span><span class="params">(<span class="string">&quot;Hello&quot;</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; tb[<span class="number">0</span>] &lt;&lt; std::endl;        <span class="comment">// 正确，只读一个非常量</span></span><br><span class="line">    tb[<span class="number">0</span>] = <span class="string">&#x27;x&#x27;</span>;                            <span class="comment">// 正确，修改一个非常量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 const TextBlock::operator[]</span></span><br><span class="line">    <span class="function"><span class="type">const</span> TextBlock <span class="title">ctb</span><span class="params">(<span class="string">&quot;World&quot;</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; ctb[<span class="number">0</span>] &lt;&lt; std::endl;       <span class="comment">// 正确，只读一个常量</span></span><br><span class="line">    <span class="comment">// ctb[0] = &#x27;x&#x27;;                           // 错误，不能修改一个常量</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(tb);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过重载 <code>operator[]</code> 并赋予不同版本的返回值类型，你可以对常量和非常量 <code>TextBlocks</code> 进行不同的处理。</li><li>常量对象在实际程序中最常出现的是通过指针或引用到常量的结果。例如示例代码中的 <code>void print(const TextBlock&amp; ctb)</code> 函数。</li><li>请注意，<code>main()</code> 函数中 <code>ctb[0] = &#39;x&#39;;</code> 的错误只与被调用的 <code>operator[]</code> 的返回类型有关；对 <code>operator[]</code> 本身的调用都是正常的。错误是由于试图对 <code>const char&amp;</code> 进行赋值。</li><li><code>operator[]</code> 的返回数据类型是 <code>char&amp;</code>，不是 <code>char</code>。如果 <code>operator[]</code> 如果只返回一个 <code>char</code>，是不会被编译通过的，因为修改内置数据类型的函数的返回值是不合法的。即使它是合法的，C++ 按值返回对象的事实将意味着一个 <code>tb.text[0]</code> 的副本会被修改，而不是 <code>tb.text[0]</code> 本身。</li></ul><h2 id="二进制位常量性与逻辑常量性"><a href="#二进制位常量性与逻辑常量性" class="headerlink" title="二进制位常量性与逻辑常量性"></a>二进制位常量性与逻辑常量性</h2><p>一个成员函数为常量意味着什么？有两个普遍的概念：“二进制位常量性”（也称为 “物理常量性”）和 “逻辑常量性”。</p><h4 id="二进制位常量性"><a href="#二进制位常量性" class="headerlink" title="二进制位常量性"></a>二进制位常量性</h4><p>”二进制位常量性“ 阵营认为，当且仅当一个成员函数不修改对象的任何数据成员（不包括静态成员）时，它才是常量，也就是说它不修改对象内部的任何比特位。比特恒定性的好处是，它很容易被检测到违规行为，编译器只需查看对数据成员的赋值。事实上，逐位不变性是 C++ 对不变性的定义，而且一个常量成员函数不允许修改其所在对象的任何非静态数据成员。</p><p>遗憾的是，许多不怎么规范的成员函数都通过了二进制位常量性测试。特别是，一个修改了 “指针所指向的内容” 的成员函数经常不算是常量成员。但如果对象中只有指针，那么称该函数是 “二进制位常量性”，编译器也不会有异议。例如下面的示例代码所示，假设有一个类似于 <code>TextBlock</code> 的类，它将其数据存储为 <code>char*</code> 类型而不是 <code>string</code>类型，因为它需要通过一个不认识 <code>string</code> 对象的 <code>C API</code> 进行交互。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bitwise.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __BITWISE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __BITWISE_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTextBlock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CTextBlock</span>(std::string txt);</span><br><span class="line">    ~<span class="built_in">CTextBlock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二进制位常量性声明，实际并不合适</span></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> pText[position];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">release</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span> *pText;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __BITWISE_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bitwise.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bitwise.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">CTextBlock::<span class="built_in">CTextBlock</span>(std::string txt) : <span class="built_in">pText</span>(<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">release</span>();</span><br><span class="line">    <span class="type">int</span> len = txt.<span class="built_in">length</span>();</span><br><span class="line">    pText = <span class="keyword">new</span> <span class="type">char</span>[len + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(pText, <span class="number">0</span>, len + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(pText, txt.<span class="built_in">data</span>(), len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CTextBlock::~<span class="built_in">CTextBlock</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">release</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CTextBlock::release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pText != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> pText;</span><br><span class="line">        pText = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="type">const</span> CTextBlock <span class="title">cctb</span><span class="params">(<span class="string">&quot;Hello&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">char</span> *pc = &amp;cctb[<span class="number">0</span>];</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;before modified: pc = &quot;</span> &lt;&lt; *pc &lt;&lt; std::endl;</span><br><span class="line">    *pc = <span class="string">&#x27;J&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;after modified: pc = &quot;</span> &lt;&lt; *pc &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CTextBlock</code> 类（不恰当地）将 <code>operator[]</code> 声明为一个常量成员函数，尽管该函数返回的是对对象内部数据的引用。注意到 <code>operator[]</code> 的实现并没有以任何方式修改 <code>pText</code>。因此，编译器会很乐意为 <code>operator[]</code> 生成代码。</p><p>但是我们却发现在 <code>main()</code> 函数中 <code>*pc = &#39;J&#39;;</code> 对返回值进行了修改，<code>*pc</code> 可是调用 <code>operator[]</code> 后的返回值。</p><h4 id="逻辑常量性"><a href="#逻辑常量性" class="headerlink" title="逻辑常量性"></a>逻辑常量性</h4><p>出现上面 “二进制位常量性” 示例代码中问题后出现了 “逻辑常量性” 派。 一个常量成员函数可能会修改它所调用的对象中的比特位，但只是以客户端检测不到的方式。例如，当你的 <code>CTextBlock</code> 类被请求后，可能想缓存文本块的长度。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logic.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LOGIC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LOGIC_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTextBlock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::<span class="type">size_t</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span> *pText;</span><br><span class="line">    std::<span class="type">size_t</span> textLength;     <span class="comment">// 最近一次计算文本区块长度</span></span><br><span class="line">    <span class="type">bool</span> lengthIsValid;         <span class="comment">// 目前长度是否有效</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __LOGIC_H__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logic.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;logic.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::<span class="type">size_t</span> <span class="title">CTextBlock::length</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!lengthIsValid) &#123;</span><br><span class="line">        <span class="comment">// 错误，const 成员函数内不能给 textLength 和 lengthIsValid 赋值</span></span><br><span class="line">        textLength = std::<span class="built_in">strlen</span>(pText);</span><br><span class="line">        lengthIsValid = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> textLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>length()</code> 的实现不是 “二进制位常量性”，因为 <code>textLength</code> 和 <code>lengthIsValid</code> 都可能被修改。这两个数据被修改对 <code>const CTextBlock</code> 对象而言虽然可接受，但编译器不同意。</p><p>解决办法也很简单，利用 C++ 的一个与 <code>const</code> 相关的摆动场：<code>mutable</code>（可变的）。<code>mutable</code> 释放掉非静态成员变量的 “二进制位常量性” 约束。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logic.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LOGIC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LOGIC_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTextBlock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::<span class="type">size_t</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span> *pText;</span><br><span class="line">    <span class="keyword">mutable</span> std::<span class="type">size_t</span> textLength;     <span class="comment">// 最近一次计算文本区块长度</span></span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">bool</span> lengthIsValid;         <span class="comment">// 目前长度是否有效</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __LOGIC_H__</span></span></span><br></pre></td></tr></table></figure><h2 id="避免常量和非常量成员重复"><a href="#避免常量和非常量成员重复" class="headerlink" title="避免常量和非常量成员重复"></a>避免常量和非常量成员重复</h2><p><code>mutable</code> 是一个很好的解决方案，它解决了二进制位常量性非我所欲的问题，但它并没有解决所有与常量相关的困难。例如，假设 <code>TextBlock</code>（和 <code>CTextBlock</code>）中的 <code>operator[]</code> 不仅返回对相应字符的引用，它还执行边界检查，记录访问信息，甚至可能进行数据完整性验证。把所有这些放在常量和非常量的 <code>operator[]</code> 函数中（不要担心，现在有隐式内联长度的函数–见实验《透彻内联》）会产生这种怪异的现象。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// avoidDuplication.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __AVOIDDUPLICATION_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __AVOIDDUPLICATION_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 边界检查</span></span><br><span class="line">        <span class="comment">// 日志数据访问</span></span><br><span class="line">        <span class="comment">// 验证数据完整性</span></span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 边界检查</span></span><br><span class="line">        <span class="comment">// 日志数据访问</span></span><br><span class="line">        <span class="comment">// 验证数据完整性</span></span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __AVOIDDUPLICATION_H__</span></span></span><br></pre></td></tr></table></figure><p>看到上面示例代码，你能说代码重复，以及随之而来的编译时间、维护和代码漏洞等问题吗？当然，我们可以把所有的边界检查等代码移到一个单独的成员函数中（私有的），两个版本的 <code>operator[]</code> 都会调用。但你仍然会重复调用该函数，并且你仍然有重复的返回语句代码。</p><p>你真正想做的是实现一次 <code>operator[]</code> 功能并使用它两次。也就是说，你想让一个版本的 <code>operator[]</code> 调用 <code>const operator[]</code>。这就使得我们需要去除常量性。</p><h4 id="去重复代码"><a href="#去重复代码" class="headerlink" title="去重复代码"></a>去重复代码</h4><p>作为一般规则，转型是一个糟糕的想法，在实验《尽量少类型转换》整个实验来讨论这个问题，但代码重复也不是什么好事。在这种情况下，<code>const operator[]</code> 所做的与 <code>operator[]</code> 所做的事情相同，只有常量版本返回值类型受到常量约束。在这种情况下，将返回值中的 <code>const</code> 转型是安全的。因为不论调用 <code>operator[]</code> 还是 <code>const operator[]</code> 都一定首先有个非常量对象，否则就不能够调用非常量函数。所以用 <code>operator[]</code> 调用 <code>const operator[]</code> 是一个避免代码重复的安全做法，即使过程中需要一个转型动作。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// safeCast.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TEXTBLOCK_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TEXTBLOCK_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 边界检查</span></span><br><span class="line">        <span class="comment">// 日志数据访问</span></span><br><span class="line">        <span class="comment">// 验证数据完整性</span></span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](std::<span class="type">size_t</span> position)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">const_cast</span>&lt;<span class="type">char</span>&amp;&gt;(<span class="built_in">static_cast</span>&lt;<span class="type">const</span> TextBlock&amp;&gt;(*<span class="keyword">this</span>)[position]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __TEXTBLOCK_H__</span></span></span><br></pre></td></tr></table></figure><ul><li>如示例代码所示，代码有两个转型，而不是一个。第一次用来为 <code>*this</code> 添加 <code>const</code> 使得 <code>operator[]</code> 可以调用 <code>const operator[]</code>，第二次则是从 <code>const operator[]</code> 的返回值中去除常量性。</li><li>示例代码中使用 <code>operator[]</code> 调用 <code>const operator[]</code>，但如果只是单纯的调用会递归调用自己，那么代码会一直重复调用。为了避免无穷递归，调用时必须明确指出调用的是 <code>const operator[]</code>。</li><li>C++ 缺乏直接的语法可以去调用，因此将 <code>*this</code> 从其原始类型 <code>TextBlock&amp;</code> 转型为 <code>const TextBlock&amp;</code>。</li><li>使用 <code>static_cast</code> 添加常量性，强制进行了一次安全转型；再使用 <code>const_cast</code> 去除常量性。</li></ul><h1 id="const-修饰成员函数"><a href="#const-修饰成员函数" class="headerlink" title="const 修饰成员函数"></a><code>const</code> 修饰成员函数</h1>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《Efficient C++》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 《Efficient C++》 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>友元</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AC++%20primer%20plus%E3%80%8B/%E7%AC%AC11%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E7%B1%BB/%E5%8F%8B%E5%85%83/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AC++%20primer%20plus%E3%80%8B/%E7%AC%AC11%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E7%B1%BB/%E5%8F%8B%E5%85%83/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="友元"><a href="#友元" class="headerlink" title="友元"></a>友元</h1><p>C++ 提供了另外一种形式的访问权限：友元。友元有3种：</p><ul><li>友元函数</li><li>友元类</li><li>友元成员函数</li></ul><p>通过让函数成为类的友元，可以赋予该函数与类的成员函数相同的访问权限。</p><h1 id="为何需要友元"><a href="#为何需要友元" class="headerlink" title="为何需要友元"></a>为何需要友元</h1><blockquote><p>在为类重载二元运算符时（带两个参数的运算符）常常需要友元。将 Time 对象乘以实数就属于这种情况。</p></blockquote><p>下面的语句：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = B * <span class="number">2.75</span>；</span><br></pre></td></tr></table></figure><p>将被转换成：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = B.<span class="keyword">operator</span>*(<span class="number">2.75</span>);</span><br></pre></td></tr></table></figure><p>但下面的语句又如何呢?</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="number">2.75</span> * B;</span><br></pre></td></tr></table></figure><p>从概念上说，<code>2.75*B</code> 与 <code>B*2.75</code> 相同，但第一个表达式不对应于成员函数，因为2.75不是 Timer 类型的对象。记住，左侧的操作数应是调用对象，但2.75不是对象。因此，编译器不能使用成员函数调用来替换该表达式。</p><p>解决这个难题的一种方式是，告知每个人（包括程序员自己），只能按 <code>B*2.75</code> 的格式编写，不能写成<code>2.75*B</code>。这是一种对服务器友好-客户警惕的（server-friendly, client-beware)解决方案，与OOP无关。</p><p>当然，上述的问题也有解决方案——非成员函数。非成员函数不是由对象调用的，它使用的所有值（包括对象）都是显式参数。这样，编译器能够将下面的表达式:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="number">2.75</span> * B;</span><br></pre></td></tr></table></figure><p>与下面的非成员函数调用匹配：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="keyword">operator</span>*(<span class="number">2.75</span>,B);</span><br></pre></td></tr></table></figure><p>该函数的原型如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Time <span class="keyword">operator</span>*(<span class="type">double</span> m, <span class="type">const</span> Time &amp;t);</span><br></pre></td></tr></table></figure><p>对于非成员重载运算符函数来说，运算符表达式左边的操作数对应于运算符函数的第一个参数，运算符表达式右边的操作数对应于运算符函数的第二个参数。而原来的成员函数可以访问类的私有成员，它们被称为友元函数。</p><h1 id="创建友元"><a href="#创建友元" class="headerlink" title="创建友元"></a>创建友元</h1><p>创建友元函数的第一步是将其原型放在类声明中，并在原型声明前加上关键字 <code>friend</code>:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span>*(<span class="type">double</span> m, <span class="type">const</span> Time &amp; t);</span><br></pre></td></tr></table></figure><p>该原型意味着下面两点：</p><ul><li>虽然 <code>operator*()</code> 函数是在类声明中声明的，但它不是成员函数，因此不能使用成员运算符来调用；</li><li>虽然 <code>operator*()</code> 函数不是成员函数，但它与成员函数的访问权限相同。</li></ul><p>第二步是编写函数定义。因为它不是成员函数，所以不要使用 Time:: 限定符。另外，不要在定义中使用关键字 <code>friend</code>，定义如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Time <span class="keyword">operator</span>*(<span class="type">double</span> m,<span class="type">const</span> Tlme &amp; t)<span class="comment">// frlend not ued in definition</span></span><br><span class="line">&#123;</span><br><span class="line">    Time result; </span><br><span class="line">    <span class="type">long</span> totalminutes = t.hours * m * <span class="number">60</span> + t.minutes * m;</span><br><span class="line">    result.hours = totalminutes/<span class="number">60</span>;</span><br><span class="line">    result.minutes = totalminutes % <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总之，类的友元函数是非成员函数，其访问权限与成员函数相同。 </p>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《C++ primer plus》 </category>
          
          <category> 第11章 使用类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《C++ primer plus》 </tag>
            
            <tag> 友元 </tag>
            
            <tag> friend </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三黑豆浆</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E9%A3%9F%E7%89%A9/%E4%B8%89%E9%BB%91%E8%B1%86%E6%B5%86/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E9%A3%9F%E7%89%A9/%E4%B8%89%E9%BB%91%E8%B1%86%E6%B5%86/</url>
      
        <content type="html"><![CDATA[<ol><li>配料表</li></ol><ul><li><p>黑豆 25克</p></li><li><p>黑米 20克</p></li><li><p>黑芝麻 15克</p></li><li><p>核桃 25克</p></li><li><p>冰糖 15克</p></li><li><p>凉水 800ml</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
          <category> 食物 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 粥类 </tag>
            
            <tag> 熬夜 </tag>
            
            <tag> 豆浆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 枚举</title>
      <link href="/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AC++%20primer%20plus%E3%80%8B/enum/"/>
      <url>/%E7%AB%8B%E5%BF%97%E5%8D%9A%E8%A7%88%E7%BE%A4%E4%B9%A6/%E3%80%8AC++%20primer%20plus%E3%80%8B/enum/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h1><p>C++的枚举工具提供了另一种创建符号常量的方式，这种方式可以代替<code>const</code>。还允许定义新类型，但必须按严格的限制执行。使用<code>enum</code>的句法与<code>struct</code>类似。</p><p><code>enum color &#123; red, orange, blue, green, red, black&#125;</code></p><p>这条语句定义了一个名为<code>color</code>的新类型，它的取值范围为<code>red, orange, blue, green, red, black</code>，称为符号常量，同时将<code>0~5</code>分别对应于<code>red~black</code>。在默认情况下，<code>0</code>对应的是<code>red</code>,<code>5</code>对应的是<code>black</code>,其他以此类推。</p><h2 id="声明与使用"><a href="#声明与使用" class="headerlink" title="声明与使用"></a>声明与使用</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color cor1; <span class="comment">//定义了一个类型为color的变量cor1</span></span><br><span class="line"><span class="comment">//枚举变量的赋值</span></span><br><span class="line">cor1 = red; <span class="comment">//正常赋值</span></span><br><span class="line">cor1 = <span class="number">20</span>; <span class="comment">//非法，20不是枚举变量</span></span><br></pre></td></tr></table></figure><p>由此可以看出，枚举变量的赋值受到限制，与程序员的定义有关。</p><ul><li><p>对枚举而言，它的操作符只有赋值运算符<code>=</code>，这就意味着枚举变量不能执行<code>++、--、+、—</code>等<code>等号</code>以外的操作。</p></li><li><p>枚举量是整形，可被提升为int类型，但int类型不能自动转换为枚举类型</p></li><li><p>枚举可以进行强制类型转换，但不确定其结果，如<code>cor1 = spectrum(100);</code></p></li><li><p>如果只打算使用常量，而不创建枚举类型的变量，则可以省略枚举类型的名称 <code>enum &#123;red,orange&#125;</code>；</p></li></ul><h2 id="设置枚举的值"><a href="#设置枚举的值" class="headerlink" title="设置枚举的值"></a>设置枚举的值</h2><p>可以使用赋值运算符显式地来设置枚举量的值：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">bits</span> &#123;one = <span class="number">1</span>, two = <span class="number">2</span>, three = <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure><p>但是，指定的值必须是整数。也可以只显式的设置其中一部分的值，默认情况下，枚举的 第一个常量始终是从<code>0</code>开始的，这一点需要注意。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">digits</span> &#123;zero, one = <span class="number">0</span>, two, three = <span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure><p>这里，<code>zero</code>和<code>one</code>的枚举量都为<code>0</code>,<code>two</code>和<code>three</code>都是<code>1</code>。</p><p>除了可以将<code>int</code>类型的值赋值给枚举量，还可以使用<code>long</code>和<code>long long</code>类型的值。</p><h2 id="枚举的取值范围"><a href="#枚举的取值范围" class="headerlink" title="枚举的取值范围"></a>枚举的取值范围</h2><p>现在有指定了枚举量的枚举如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">enum</span> <span class="title">bits</span><span class="params">(one = <span class="number">1</span>, two = <span class="number">2</span>,four = <span class="number">4</span>,eight = <span class="number">8</span>&#125;;</span></span></span><br><span class="line"><span class="params"><span class="function">bits myflag;</span></span></span><br><span class="line"><span class="params"><span class="function">myflag = bits(<span class="number">6</span>);</span></span></span><br></pre></td></tr></table></figure><p>问：</p><div align=center style="filter:blur(5);">    上述赋值是否合法<pre><code>    合法，虽然`6`不是枚举量，但它位于枚举定义的取值范围内。</code></pre></div><p>关于取值范围的定义（参考C++ primer 第六版）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">enum</span> <span class="title">bigstep</span><span class="params">(firat,second = <span class="number">100</span>, third&#125;;</span></span></span><br></pre></td></tr></table></figure><blockquote><p>首先，要找出上限，需要知道枚举量的最大值。找到大于这个最大值的、最小的2的幂，将它减去1，得到的便是取值范围的上限。例如，定义的bigstep的最大值枚举值是101。在2的幂中，比这个数大的最小值为128，因此取值范围的上限为127。要计算下限，需要知道枚举量的最小值。如果它不小于0，则取值范围的下限为0∶否则，采用与寻找上限方式相同的方式，但加上负号。</p><hr><p>例如，如果最小的枚举量为-6，而比它小的、最大的2的幂是-8（加上负号），因此下限为-7。选择用多少空间来存储枚举由编译器决定。对于取值范围较小的枚举，使用一个字节或更少的空间∶而对于包含 long类型值的枚举，则使用4个字节。</p></blockquote><h2 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">myFlag</span> &#123;</span><br><span class="line">one,</span><br><span class="line">two = <span class="number">0</span>,</span><br><span class="line">three,</span><br><span class="line">four = <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; three &lt;&lt; endl;</span><br><span class="line">myFlag flag = <span class="built_in">myFlag</span>(<span class="number">0</span>);</span><br><span class="line">cout &lt;&lt; flag &lt;&lt; endl;</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><div style="background:black;color:white">1<br>0<br></div><hr><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">color</span> &#123; red=<span class="number">1</span>, green, blue &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">enum</span>  <span class="title class_">color</span> favorite_color;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* 用户输入数字来选择颜色 */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入你喜欢的颜色: (1. red, 2. green, 3. blue): &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>, &amp;favorite_color);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* 输出结果 */</span></span><br><span class="line">    <span class="keyword">switch</span> (favorite_color)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> red:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;你喜欢的颜色是红色&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> green:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;你喜欢的颜色是绿色&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> blue:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;你喜欢的颜色是蓝色&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;你没有选择你喜欢的颜色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div style="background:black;color:white">请输入你喜欢的颜色: (1. red, 2. green, 3. blue): 1<br>你喜欢的颜色是红色</div><h1 id="枚举进阶"><a href="#枚举进阶" class="headerlink" title="枚举进阶"></a>枚举进阶</h1><h2 id="1-位运算支持"><a href="#1-位运算支持" class="headerlink" title="1. 位运算支持"></a>1. 位运算支持</h2><blockquote><p>在使用枚举时结合到 <mark>2进制</mark> 的强大，对枚举值自由的进行异或运算。</p></blockquote><p>举例一：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">AttributeTargets</span></span><br><span class="line">&#123;</span><br><span class="line">     Assembly = <span class="number">0x0001</span>,</span><br><span class="line">     Class = <span class="number">0x0002</span>,</span><br><span class="line">     Struct = <span class="number">0x0004</span></span><br><span class="line">     ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>举例二：</p><p>但是在</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">FileAccess</span></span><br><span class="line">&#123;</span><br><span class="line">     Read = <span class="number">0x1</span>,</span><br><span class="line">     Write = <span class="number">0x2</span>,</span><br><span class="line">     ReadWrite = Read | Write</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-0值"><a href="#2-0值" class="headerlink" title="2. 0值"></a>2. 0值</h2><p>为简单枚举提供一个 0 值枚举量，可以考虑将其命名为 <code>None</code>。如果这个名对于特定的枚举不合适的时候，可以自行找一个准确的。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Compression</span></span><br><span class="line">&#123;</span><br><span class="line">     None = <span class="number">0</span>,</span><br><span class="line">     GZip,</span><br><span class="line">     Deflate</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3-用枚举代替define"><a href="#3-用枚举代替define" class="headerlink" title="3. 用枚举代替define"></a>3. 用枚举代替<code>define</code></h2><blockquote><p>在合适的情况下尽量使用枚举类型，而不是静态常量或 “#define” 值 。枚举 类型是一个具有一个静态常量集合的结构体。如果遵守这些规范，定义枚举类型，而不是带 有静态常量的结构体，您便会得到额外的编译器和反射支持，在调试代码时也能更加直观。</p></blockquote><p>Good:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span></span><br><span class="line">&#123;</span><br><span class="line">     Red,</span><br><span class="line">     Green,</span><br><span class="line">     Blue</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>bad:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> RED = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> GREEN = <span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BLUE = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RED 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GREEN 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLUE 2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 立志博览群书 </category>
          
          <category> 《C++ primer plus》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《C++ primer plus》 </tag>
            
            <tag> enum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>声网参赛经历记录——白板插件开发(前端)</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E5%A3%B0%E7%BD%91%E5%8F%82%E8%B5%9B%E5%88%86%E4%BA%AB/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E5%A3%B0%E7%BD%91%E5%8F%82%E8%B5%9B%E5%88%86%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/_posts/%E6%9D%82%E8%AE%B0/%E5%A3%B0%E7%BD%91%E5%8F%82%E8%B5%9B%E5%88%86%E4%BA%AB/image-20220925184747631.png" alt="title"></p><p>[toc]</p><h1 id="比赛创意"><a href="#比赛创意" class="headerlink" title="# 比赛创意"></a># 比赛创意</h1><p>最开始讨论的结果时做一个会议记录相关的插件，结合声望原本提供的白板插件功能，可以实时的进行展示，多人操作、互动，音视频通话。区别于现有会议模式的一点就是，除了音视频通话，还可以在通话的同时，在白板上进行操作，类似于Web上 <mark>在线文档</mark>、<mark>在线会议</mark>、<mark>在线画板</mark> 三者功能集一身的一款白板插件，当然这里在线白板的功能是由声望的 <code>SDK</code> 提供了这个能力，在线文档的这些具体的在线同步的逻辑还是要以声望提供的为基准。</p><h1 id="1-最终结果"><a href="#1-最终结果" class="headerlink" title="1. 最终结果"></a>1. 最终结果</h1><p>最终由于我们人力有限，并且都是兼职参加比赛，所以完成上是大打折扣。</p><ul><li>调用了讯飞的实时语音识别接口实现了插件的 <mark>语音转写</mark> 功能，可以进行多人语音识别到插件内部</li><li>可以对会议内容和识别记录进行 <mark>一键导出</mark> 的功能</li></ul><p>最后呢，由于实现的功能过于单调，又新增了一个 <code>Markdown</code> 的编辑器，插件启动后可以编辑，但是这个内容是不同步的。</p><h1 id="技术总结"><a href="#技术总结" class="headerlink" title="# 技术总结"></a># 技术总结</h1><p>总结一下我个人在比赛中学习和使用到的一些技术，由于我本人是 C++客户端 开发，之前虽然也有学习过VUE和前端知识，但是 <code>VUE3</code> 的改动还是挺大，使用起来颇有些不太习惯的地方。主要的前端框架以及代码功能都是由我比赛的队友去完成的。我负责后台数据相关的一些工作。主要面向于音视频录制、存储、发送等，以及调用语音识别接口。</p><ol><li>AgoraRTC(声网的sdk，提供实时音视频服务)</li><li>IatRecorder(讯飞封装的一个语音识别接口)</li><li>Vue</li><li>前端三剑客（js、h5、CSS）这三个在调试过程中占比很大</li></ol><h1 id="实现"><a href="#实现" class="headerlink" title="# 实现"></a># 实现</h1><p>实现部分主要讲关于音频传输、录音、实时语音转写这三点：</p><h2 id="音频传输"><a href="#音频传输" class="headerlink" title="音频传输"></a>音频传输</h2><p>音频传输方面。声网有现成的demo提供学习，使用起来相对比较简单。</p><p><a href="https://github.com/AgoraIO/API-Examples-Web/tree/main/Demo/selfRendering">API-Examples-Web&#x2F;Demo&#x2F;selfRendering at main · AgoraIO&#x2F;API-Examples-Web</a></p>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 声网 </tag>
            
            <tag> 比赛 </tag>
            
            <tag> RTC </tag>
            
            <tag> 音视频 </tag>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>临时文件</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E4%B8%B4%E6%97%B6%E7%AC%94%E8%AE%B0/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E4%B8%B4%E6%97%B6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>人文环境的形成是常年累月的积淀，是人的改造与自然的打磨巧妙结合形成的，因此也蕴含了独特的精神力量和难得的物质底色。从物质文化和精神文化两个角度来看，对人文环境中的建筑进行设计所受到的牵制较多。纵向看，有历史文化的影响；横向看，有地域因素的制约；另一个方面，观者的审美角度、使用者的生活习惯，以及人们道德规范的约束都是人文环境中对建筑消隐的重要因素。在这种情况下，做到“消隐”，需要设计师考虑各方面的因素，从而做出更能突出建筑特，又能达到“消隐”目的的设计方案。以下结合三个相对典型的案例进行具体的分析。</p><p>建筑设计环节需要考虑的因素除了人文环境、造价、风格之外，也应考虑到建筑技术对建筑设计的提升。不仅如此，建筑技术可以说是建筑创作中重要的一个环节，其最终体现在建筑的空间形态上，建筑形态是否优美、是否达到了效果，又可以直接反馈出建筑技术的使用情况。建筑技术的要素包括材料、结构、施工等不同的类别，从选材到施工，每一个技术环节都有其对应的使用环境，充分利用这一特定环境，从而有效地利用建筑技术对每个环节进行改造和提升。这也能充分体现环境整体观的理念。</p><h1 id="社会访谈：-一名工程师眼中的新时代及启示"><a href="#社会访谈：-一名工程师眼中的新时代及启示" class="headerlink" title="社会访谈： 一名工程师眼中的新时代及启示"></a>社会访谈： 一名工程师眼中的新时代及启示</h1><p>深入访谈一个自己的长辈，请其介绍职业经历和人生阅历，并通过这个切入点，以小见大介绍其对国家发展的看法感受，记述其访谈内容及对自己未来的启示。</p><h2 id="访谈对象："><a href="#访谈对象：" class="headerlink" title="访谈对象："></a><strong>访谈对象：</strong></h2><p>访谈对象：同学的舅舅 </p><p>性别：男 </p><p>年龄：48</p><p>职业：结构工程师 </p><p>单位：中建一局某分公司 </p><p>职务：工程师</p><p>从业年数：22 </p><p>访谈时间：2022.11.26</p><p>访谈形式：电话</p><h2 id="访谈内容："><a href="#访谈内容：" class="headerlink" title="访谈内容："></a><strong>访谈内容：</strong></h2><ol><li><h3 id="您是如何找到这份工作的？"><a href="#您是如何找到这份工作的？" class="headerlink" title="您是如何找到这份工作的？"></a>您是如何找到这份工作的？</h3></li></ol><p>当时工作还是包分配的，毕业后我选择了去中建。</p><ol start="2"><li><h3 id="就您的工作而言，您最喜欢什么？最不喜欢什么？"><a href="#就您的工作而言，您最喜欢什么？最不喜欢什么？" class="headerlink" title="就您的工作而言，您最喜欢什么？最不喜欢什么？"></a>就您的工作而言，您最喜欢什么？最不喜欢什么？</h3></li></ol><p>喜欢的是自己和大家一起努力工作之后，出现的问题被解决，工程一日日逐渐被完成，最终被交付的那种喜悦。</p><p>不喜欢工作中的与人打交道，在工作中会产生内耗，需要处理好复杂的人际关系。还有就是工作常年在外，全国各地地跑，和家人是聚少离多。不过工作这么些年，也习惯了，有空间就会回家看看家人，这两年因为疫情的原因，回去的更少了。在单位，就是想着怎么把工作干好。保质保量完成建设任务。</p><ol start="3"><li><h3 id="您的职位是什么？你的主要职责是什么？"><a href="#您的职位是什么？你的主要职责是什么？" class="headerlink" title="您的职位是什么？你的主要职责是什么？"></a>您的职位是什么？你的主要职责是什么？</h3></li></ol><p>目前是项目部的工程师，主要职责就是负责工程上的项目进行监工以及项目部规划等内容。</p><ol start="4"><li><h3 id="大学期间可以做的准备有什么？"><a href="#大学期间可以做的准备有什么？" class="headerlink" title="大学期间可以做的准备有什么？"></a>大学期间可以做的准备有什么？</h3></li></ol><p>学好自己的专业知识，尽量拓展知识面。这个岗位对专业的对口性一般要求不高，但是不论是经济类、管理类还是工程类的专业，还是需要认真学习的，它虽然要求的面广，但你总得有一方面是要有核心竞争力的。尽量多学习其他知识，做到“见多识广”，因为这个岗位会遇到很多人，很多不同种类的项目，这样工作起来思维会比较快，沟通也会变得容易些。</p><p>有侧重的锻炼自己的沟通、写作、表达能力。多参加社团活动，和一些有意义的比赛，历练自己。</p><ol start="5"><li><h3 id="在行业内，先从什么样的工作岗位做起，能学到最多的知识，最有益于发展？"><a href="#在行业内，先从什么样的工作岗位做起，能学到最多的知识，最有益于发展？" class="headerlink" title="在行业内，先从什么样的工作岗位做起，能学到最多的知识，最有益于发展？"></a>在行业内，先从什么样的工作岗位做起，能学到最多的知识，最有益于发展？</h3></li></ol><p>先应聘资料员或质检员、施工员,能利用在校学到的知识,工作起来顺手,工作后通过自学尽快掌握各种工程软件的应用,掌握后根据自己的爱好,可转行预算员、技术员、测量员等.</p><ol start="6"><li><h3 id="工作地点在哪里？主要工作场所是什么？有哪些特征？"><a href="#工作地点在哪里？主要工作场所是什么？有哪些特征？" class="headerlink" title="工作地点在哪里？主要工作场所是什么？有哪些特征？"></a>工作地点在哪里？主要工作场所是什么？有哪些特征？</h3></li></ol><p>工作地点有工地，项目部。主要场所是项目部。忙的时候来回奔波，也会加班赶工期。</p><ol start="7"><li><h3 id="您在做这份工作时，日常面临的问题是什么，什么最有挑战性？"><a href="#您在做这份工作时，日常面临的问题是什么，什么最有挑战性？" class="headerlink" title="您在做这份工作时，日常面临的问题是什么，什么最有挑战性？"></a>您在做这份工作时，日常面临的问题是什么，什么最有挑战性？</h3></li></ol><p>这个很多，比如刚开始工作的时候，要慢慢适应工厂的环境;还要和同事打好关系等等。特别是厂里的一些老师傅在我们正式上岗前经行培训的时候，老师傅传授了一些我们在学校里没见过的加工方法，我们只能从头学起。我想说的是学校里的教材之类的不能太过相信，有些老旧的教材的内容已经逐渐被淘汰，因此要不断地学习，要关注行业发展动态。</p><ol start="8"><li><h3 id="在您的工作领域里初级职位和略高级别职位的薪水一般是什么水平？"><a href="#在您的工作领域里初级职位和略高级别职位的薪水一般是什么水平？" class="headerlink" title="在您的工作领域里初级职位和略高级别职位的薪水一般是什么水平？"></a>在您的工作领域里初级职位和略高级别职位的薪水一般是什么水平？</h3></li></ol><p>收入还可以，包括基本工资+年底奖金。主要还是根据工程难度，工期长短，以及工作地点等因素影响。初级平均可以拿到8000左右，年底5~20万不等。</p><ol start="9"><li><h3 id="在这个职位上，如果想获得成功必须拥有并保持什么样的能力？"><a href="#在这个职位上，如果想获得成功必须拥有并保持什么样的能力？" class="headerlink" title="在这个职位上，如果想获得成功必须拥有并保持什么样的能力？"></a>在这个职位上，如果想获得成功必须拥有并保持什么样的能力？</h3></li></ol><p>需要有坚实的基础学科知识，更需要有不断学习的能力，去挑战的新的建设需求。其次的话就是有一定的与人交往的能力。</p><ol start="10"><li><h3 id="目前还缺乏的必须改进的能力有哪些？"><a href="#目前还缺乏的必须改进的能力有哪些？" class="headerlink" title="目前还缺乏的必须改进的能力有哪些？"></a>目前还缺乏的必须改进的能力有哪些？</h3></li></ol><p>需要的技能：CAD及各种计算软件，比如PKPM、YJK、3D3S、MIDAS等（至少学会一到两种，各软件有相通之处）。</p><ol start="11"><li><h3 id="您认为什么样的个人品质、性格和能力对做好这份工作来讲是重要的？"><a href="#您认为什么样的个人品质、性格和能力对做好这份工作来讲是重要的？" class="headerlink" title="您认为什么样的个人品质、性格和能力对做好这份工作来讲是重要的？"></a>您认为什么样的个人品质、性格和能力对做好这份工作来讲是重要的？</h3></li></ol><p>能坚持下去，有创新思想，常与人沟通交流，通过工作不断积累自己的经验。</p><ol start="12"><li><h3 id="您认为做好这份工作应该具备哪些知识、技能和经验？"><a href="#您认为做好这份工作应该具备哪些知识、技能和经验？" class="headerlink" title="您认为做好这份工作应该具备哪些知识、技能和经验？"></a>您认为做好这份工作应该具备哪些知识、技能和经验？</h3></li></ol><p>要掌握一些基本的专业知识，比如制图（包括CAD)，金属加工的技艺，还有就是一些行业规定，行业语言等，之后当然要考取这种证书来表明已经掌握了这些内容。当然，经验也是很重要的，特别是出现一些课本上或平时没出现过的情况时，经验显得尤为重要。</p><ol start="13"><li><h3 id="目前，行业内要求从事这份工作的人应该有什么准备？"><a href="#目前，行业内要求从事这份工作的人应该有什么准备？" class="headerlink" title="目前，行业内要求从事这份工作的人应该有什么准备？"></a>目前，行业内要求从事这份工作的人应该有什么准备？</h3></li></ol><p>首先梳理自己已有的专业知识能力，客观地评价自己的优势和劣势，尽可能做到扬长补短。其次有目的地提前锁定一些目标实习单位，有针对性地进行一些关注和调研，做到有的放矢。最后可以阅读一些人际交往或社交礼仪的知识，力求在细节方面也做到位，也可以向往届师兄师姐讨教实习的一些鲜活的经验，以利于较快地适应角色和心态的转变。</p><ol start="14"><li><h3 id="学校中的哪些课程对这个行业比较有帮助？"><a href="#学校中的哪些课程对这个行业比较有帮助？" class="headerlink" title="学校中的哪些课程对这个行业比较有帮助？"></a>学校中的哪些课程对这个行业比较有帮助？</h3></li></ol><p>总的来说是有帮助的，但是大家都知道，书上的知识永远赶不上技术的发展，所有如果你向在这个行业有好的发展的话，就不能局限于书本上的东西，要多动手，这样能学到的东西比你课程上所能学到的多很多。</p><ol start="15"><li><h3 id="行业内，单位对刚进入该领域工作的员工一般会提供哪些培训？"><a href="#行业内，单位对刚进入该领域工作的员工一般会提供哪些培训？" class="headerlink" title="行业内，单位对刚进入该领域工作的员工一般会提供哪些培训？"></a>行业内，单位对刚进入该领域工作的员工一般会提供哪些培训？</h3></li></ol><p>每一个新进入的员工都会进行一系列相关的培训，内容主要是对新来员工培训相关技能，让员工能够更好的将学校中所学到的知识更好的转化为想用的技能。除了部门自己组织的学习以外，公司每年都会组织一些培训，让大家更好的了解当前行业的新技术，新动态。正式进入工作岗位后，要求每个人都有一定的技能，能够独立面对一些问题，在技术方面要求会比较多。在深造方面，公司是比较支持大家进行更加高层的学习。</p><ol start="16"><li><h3 id="这个行业存在的困难及前景如何？"><a href="#这个行业存在的困难及前景如何？" class="headerlink" title="这个行业存在的困难及前景如何？"></a>这个行业存在的困难及前景如何？</h3></li></ol><p>目前这一行业工作较为辛苦，有很多人难以坚持下来，现有的人员构成并不是非常合理，尽管做这个方面的人相当多，但是很缺少能够独当一面的优秀人才，总的来说就是，高层然才比较欠缺，低层人员泛滥。所以，对于每一个想要在此行业有所发展的人来说，机遇和挑战是同时并存的。</p>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>安装PEM文件</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E5%AE%89%E8%A3%85PEM%E6%96%87%E4%BB%B6/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E5%AE%89%E8%A3%85PEM%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： windows和Linux安装PEM文件步骤</p></blockquote><p>[toc]</p><h1 id="如何安装PEM证书"><a href="#如何安装PEM证书" class="headerlink" title="如何安装PEM证书"></a>如何安装PEM证书</h1><p>更新：2023-05-29 21:11</p><p>PEM证书是一种常见的证书文件格式，通常用于加密、验证和身份认证等。在运行应用程序或服务时，有时需要将PEM证书安装到系统或设备中，并确保其正确配置。本文将介绍如何安装PEM证书。</p><h2 id="1-下载PEM证书文件"><a href="#1-下载PEM证书文件" class="headerlink" title="1. 下载PEM证书文件"></a>1. 下载PEM证书文件</h2><p>首先，您需要有PEM证书文件。它可以是自签名证书、客户端或服务器证书、根证书或中间证书。您可以从许多来源获取PEM证书文件，例如：</p><ul><li>证书颁发机构 (CA)</li><li>厂商提供的PEM证书</li><li>自己创建的PEM证书文件</li></ul><p>确保您已经获得PEM证书文件并将其下载到计算机的本地文件夹中。</p><h2 id="2-安装PEM证书文件"><a href="#2-安装PEM证书文件" class="headerlink" title="2. 安装PEM证书文件"></a>2. 安装PEM证书文件</h2><h3 id="2-1-在Linux系统上安装PEM证书"><a href="#2-1-在Linux系统上安装PEM证书" class="headerlink" title="2.1 在Linux系统上安装PEM证书"></a>2.1 在Linux系统上安装PEM证书</h3><p>如果您想在Linux系统上安装PEM证书，可以使用以下步骤：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp server.crt /usr/local/share/ca-certificates/</span><br><span class="line">sudo update-ca-certificates</span><br></pre></td></tr></table></figure><p>在上述命令中，“server.crt”是您的PEM证书文件名。通过将PEM证书文件复制到“&#x2F;usr&#x2F;local&#x2F;share&#x2F;ca-certificates&#x2F;”目录，您可以将PEM证书添加到系统的可信证书列表中。接下来，运行“sudo update-ca-certificates”命令以更新证书列表并使其生效。</p><h3 id="2-2-在Windows系统上安装PEM证书"><a href="#2-2-在Windows系统上安装PEM证书" class="headerlink" title="2.2 在Windows系统上安装PEM证书"></a>2.2 在Windows系统上安装PEM证书</h3><ul><li>方式一</li></ul><p>如果您想在Windows系统上安装PEM证书，可以使用以下步骤：</p><ol><li>双击PEM证书文件，打开证书向导。</li><li>在弹出窗口中，选择“安装证书”选项，并单击“下一步”。</li><li>选择“计算机帐户”选项，并单击“下一步”。</li><li>在“选择存储位置”窗口中，选择“受信任的根证书颁发机构”选项，并单击“下一步”。</li><li>单击“下一步”以确认选项，并单击“完成”以完成证书安装。</li></ol><p>现在，您的PEM证书已经安装在您的Windows系统中。</p><ul><li>方式二</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开控制面板 -&gt; 网络设置 -&gt; Internet选项 -&gt; 内容 -&gt; 证书 -&gt; 导入</span><br></pre></td></tr></table></figure><p>然后选择你需要安装的证书导入即可。</p><ul><li>方式三<ul><li>打开“开始”菜单，搜索“mmc”并打开“Microsoft Management Console”。</li><li>点击“文件”菜单，选择“添加&#x2F;删除管理单元”。</li><li>在“可用的管理单元”列表中，选择“证书”并点击“添加”。</li><li>选择“计算机帐户”并点击“下一步”。</li><li>选择“本地计算机”并点击“完成”。</li><li>在“控制台根证书存储”下，右键点击“受信任的根证书颁发机构”并选择“所有任务” &gt; “导入”。</li><li>点击“下一步”，浏览到您的Pem证书文件并选择它。</li><li>点击“下一步”，选择“将所有证书都放置在下列存储中”并点击“浏览”。</li><li>选择“受信任的根证书颁发机构”并点击“确定”。</li><li>点击“下一步”并完成证书安装。</li></ul></li></ul><h2 id="3-使用PEM证书文件"><a href="#3-使用PEM证书文件" class="headerlink" title="3. 使用PEM证书文件"></a>3. 使用PEM证书文件</h2><p>一旦您已经安装了PEM证书，您可以开始使用它。通常，您需要在应用程序或服务的配置文件中指定PEM证书的路径或名称。以下是一些示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssl_certificate /path/to/your/cert.pem;</span><br><span class="line"></span><br><span class="line">// For Node.js server</span><br><span class="line">const server = https.createServer(&#123;</span><br><span class="line">  key: fs.readFileSync(&#x27;server.key&#x27;),</span><br><span class="line">  cert: fs.readFileSync(&#x27;server.cert&#x27;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>以Nginx Web服务器和Node.js服务器为例，您可以将PEM证书文件路径或名称指定为“ssl_certificate”或“cert”选项的值。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>在本文中，您已了解如何安装PEM证书文件并在应用程序或服务中使用它们。无论您要在哪个平台上安装PEM证书，都需要按照相应的步骤来执行。</p>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 证书 </tag>
            
            <tag> PEM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自然辩证法</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E8%87%AA%E7%84%B6%E8%BE%A9%E8%AF%81%E6%B3%95/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E8%87%AA%E7%84%B6%E8%BE%A9%E8%AF%81%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>参考链接：<a href="http://www.doczj.com/doc/6110418199-11.html">2019自然辩证法课后思考题及答案_文档之家</a></p><p>[toc]</p><h2 id="第一章-自然辩证法（byself）"><a href="#第一章-自然辩证法（byself）" class="headerlink" title="第一章 自然辩证法（byself）"></a>第一章 自然辩证法（byself）</h2><h3 id="1-如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？"><a href="#1-如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？" class="headerlink" title="1.如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？"></a>1.如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？</h3><p>（1）古代朴素自然观以直观性、思辨性和猜测性的方式从整体把握认识自然界的本源和发展，但缺乏系统的、以实验为基础的科学依据，尤其是将非物质性的东西当做限于物质世界的独立存在，并认为物质世界是它的派生物，为唯心主义的产生提供了借口，最终导致人类认识的分化。</p><p>（2）机械唯物主义自然观的核心是自然界绝对不变，虽然在实证科学的基础上继承和坚持了古代朴素唯物主义的思想，但是不懂得一般与个别、运动和静止等的辩证关系，以一种片面的、孤立的和静止的方法观察自然界，挤不动的自然界的辩证法，自然不能吧唯物主义坚持到底。</p><p>（3）辩证唯物主义自然克服了以往哲学自然观的缺陷，坚持了物质世界的客观实在性的唯物主义一元论原则，突出了物质世界的整体性和矛盾性，提示了物质世界的普遍联系，强调了人类起源于自然界、依赖于自然并在把握自然界发展规律的基础上能移动地和改造自然，强调了人与自然界的和谐统一。</p><h3 id="2-如何理解系统自然观、人工自然观和生态自然观的辩证关系？"><a href="#2-如何理解系统自然观、人工自然观和生态自然观的辩证关系？" class="headerlink" title="2.如何理解系统自然观、人工自然观和生态自然观的辩证关系？"></a>2.如何理解系统自然观、人工自然观和生态自然观的辩证关系？</h3><p>第一，它们都围绕人与自然界关系的主题，丰富和发展了马克思注意自然观的本体论、认识论和方法论；它们都坚持人类与自然界、人工自然界和天然自然界、人与生态系统的辩证统一，都为实现可持续发展和生态文明建设奠定了理论基础。</p><p>第二，它们在研究人与自然界关系的各方面各有其侧重点；系统自然观为正确认识和处理人与自然地关系提供了新的思维方式，人工自然观突出并反思了人的主体性和创造性；自然生态馆站在人类文明的立场，强调了人与自然界的协调与发展。</p><p>第三，它们在研究人与自然界的关系方面相互关联；系统自然观通过系统思维方式，为人工自然观和生态自然观提供了方法论基础；人工自然观通过突出人的主体性和实践性，为系统自然观和生态自然观提供了认识论前提；生态自然观通过强调人与自然界的统一性、协调性关系为系统自然观和人工自然观指明了发展方向和目标。</p><h3 id="3-如何认识生态自然观和生态文明建设之间的辩证关系？"><a href="#3-如何认识生态自然观和生态文明建设之间的辩证关系？" class="headerlink" title="3.如何认识生态自然观和生态文明建设之间的辩证关系？"></a>3.如何认识生态自然观和生态文明建设之间的辩证关系？</h3><p>生态文明是人类文明的一种形式。它以尊重和维护生态环境为主旨，以可持续发展为根据，以未来人类的继续发展为着眼点。人类对生态文明的探索，是对人与自然和谐关系的表现。生态文明与生态自然观有着紧密的联系，生态文明是生态自然观的应有之义，生态自然观对现今世界生态文明发展及实践有着广泛的指导意义。生态文明的提出，是人们对可持续发展问题认识深化的必然结果。人类通过遵守可持续性、共同性和公平性等原则，通过实施节能减排和发展低碳经济，构建和谐社会和建设生态文明，实现人类社会与生态系统的协调发展；人与生态系统的协调发展仍应以人类为主体，仍应包括改造自然的内容，注重保护生态环境和防灾减灾；生态自然界是天然自然界和人工自然界的统一，是人类文明发展的目标，生态文明的提出，是人们对可持续发展问题认识深化的必然结果。生态自然观指出，人与自然都是生态系统中不可或缺的重要组成部分，人与自然是相互依存、和谐共处、共同促进的关系。人类的发展应该是人与社会、人与环境、当代人与后代人的协调发展。人类的发展不仅要讲究代内公平，而且要讲究代际之间的公平，不能以当代人的利益为中心，甚至为了当代人的利益而不惜牺牲后代人的利益。而必须讲究生态文明，牢固树立起可持续发展的生态文明观。</p><h3 id="4-如何理解“绿水青山就是金山银山”？"><a href="#4-如何理解“绿水青山就是金山银山”？" class="headerlink" title="4.如何理解“绿水青山就是金山银山”？"></a>4.如何理解“绿水青山就是金山银山”？</h3><p>简单的来说，”绿水青山就是金山银山”就是指生态可持续发展。蓝天白云、青山绿水是人类赖以生存的环境，是社会长远发展的最大本钱，生态优势可以变成经济优势、发展优势，形成了一种浑然一体、和谐统一的关系。因此保护绿水青山，才能保住人们赖以生存的生态环境，从而赢得长远的经济可持续发展。</p><p>习近平总书记关于绿水青山就是金山银山的辩证论是生态环境生产力理论生动、朴实和富含哲理的印证：“绿水青山可以源源不断地带来金山银山，绿水青山本身就是金山银山，我们种的常青树就是摇钱树，生态优势变成经济优势。”</p><p>“如果能够把这些生态环境优势转化为生态农业、生态工业、生态旅游等生态经济的优势，那么绿水青山也就变成了金山银山。”当然，绿水青山和金山银</p><p>山之间也有矛盾，绿水青山是真正的金不换，“绿水青山可带来金山银山，但金山银山却买不到绿水青山”。</p><p>因此，当绿水青山和金山银山之间有不可调和的矛盾时，我们宁要绿水青山，不要金山银山。要像对待生命一样对待生态环境，统筹山水林田湖草系统治理，实行最严格的生态环境保护制度，形成绿色发展方式和生活方式，坚定走生产发展、生活富裕、生态良好的文明发展道路，建设美丽中国。</p><p>绿水青山就是金山银山的理念，一头是人类赖以生存的自然环境，另一头牵着财富生产；一头连着生态环境，另一头是人类活动的产物。从人与自然是生命共同体出发，将生态环境内化为生产力的内生变量与价值目标，蕴含着尊重自然、顺应自然、保护自然，谋求人与自然和谐发展的生态理念和价值诉求。</p><p>揭示了生态环境与生产力之间的辩证统一关系，突破了把保护生态与发展生产力对立起来的僵化思维，内含了保护、改善与建设生态环境和保护与发展生产力的有机统一，鲜活地概括了有中国气派、中国风格和中国话语特色的绿色发展内涵，是中国化马克思主义理论的光辉典范。</p><h2 id="第一章-自然辩证法"><a href="#第一章-自然辩证法" class="headerlink" title="第一章 自然辩证法"></a>第一章 自然辩证法</h2><h3 id="1-如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？-1"><a href="#1-如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？-1" class="headerlink" title="1.如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？"></a>1.如何理解朴素唯物主义自然观、机械唯物主义自然观和辩证唯物主义自然观的辩证关系？</h3><p>朴素唯物主义自然观是古代自然哲学家们以科学技术为基础，概括和总结自然界及其与人类的关系形成的总的观点。它是马克思主义自然观形成的最初思想渊源。它具有①整体性和直观性，②思辨性和臆测性，③自发性和不彻底性。朴素唯物主义自然观的思想渊源是原始宗教神话自然观，其理论基础是自然哲学。朴素唯物主义自然观具有一定的缺陷：①不能彻底地坚持唯物主义，具有唯心主义因素，如泰勒斯的”水本原说”②不能满足民众的需要，掺杂着宿命和迷信等因素。③不能科学地说明自然界。</p><p>机械唯物主义自然观是近代自然科学家们以近代科学技术为基础，概括和总结自然界及其与人类的关系形成的总的观点。它是马克思主义自然观形成的重要思想渊源。它具有①机械性②不彻底性③形而上学性。机械唯物主义自然观①为辩证唯物主义自然观的形成创造了条件。他以近代自然科学为基础，强调自然界存在的客观性，物质性和发展的规律性，传承了朴素唯物主义自然观的思想传统。③为辩证唯物主义自然观的形成提供了前提。它所培植的崇尚理性的科学精神促进了辩证唯物主义自然观的形成。</p><p>辩证唯物主义自然观是马克思恩格斯以近代科学技术为基础，概括和总结自然界及其与人类关系形成的总的观点。它是马克思主义自然观形成的重要标志。辩证唯物主义自然观具有①实践性②历史性③辩证性④批判性。辩证唯物主义自然观“扬弃”了机械唯物主义自然观，在更高层次上实现了向古希腊朴素唯物主义自然观的回归。</p><p>三种自然观的发展本质是人类认识的发展，辩证唯物主义自然观是对朴素唯物主义自然观的否定之否定，是对机械唯物主义自然观的否定。任何一种自然观的产生都脱离不了当时科学的发展水平，也离不开人们的认识水平。而更先进的自然观对科学的发展又具有指导性意义。这个发展是螺旋上升的，在我们的认识中还会进行补充和丰富，在运动中发展自己。</p><h3 id="2-如何理解系统自然观、人工自然观和生态自然观的辩证关系？-1"><a href="#2-如何理解系统自然观、人工自然观和生态自然观的辩证关系？-1" class="headerlink" title="2.如何理解系统自然观、人工自然观和生态自然观的辩证关系？"></a>2.如何理解系统自然观、人工自然观和生态自然观的辩证关系？</h3><p>P42</p><h3 id="3-如何认识生态自然观和生态文明建设之间的辩证关系？-1"><a href="#3-如何认识生态自然观和生态文明建设之间的辩证关系？-1" class="headerlink" title="3.如何认识生态自然观和生态文明建设之间的辩证关系？"></a>3.如何认识生态自然观和生态文明建设之间的辩证关系？</h3><p>生态文明是人类文明的一种形式。它以尊重和维护生态环境为主旨，以可持续发展为根据，以未来人类的继续发展为着眼点。人类对生态文明的探索，是对人与自然和谐关系的表现。生态文明与生态自然观有着紧密的联系，生态文明是生态自然观的应有之义，生态自然观对现今世界生态文明发展及实践有着广泛的指导意义。生态文明的提出，是人们对可持续发展问题认识深化的必然结果。人类通过遵守可持续性、共同性和公平性等原则，通过实施节能减排和发展低碳经济，构建和谐社会和建设生态文明，实现人类社会与生态系统的协调发展；人与生态系统的协调发展仍应以人类为主体，仍应包括改造自然的内容，注重保护生态环境和防灾减灾；生态自然界是天然自然界和人工自然界的统一，是人类文明发展的目标，生态文明的提出，是人们对可持续发展问题认识深化的必然结果。生态自然观指出，人与自然都是生态系统中不可或缺的重要组成部分，人与自然是相互依存、和谐共处、共同促进的关系。人类的发展应该是人与社会、人与环境、当代人与后代人的协调发展。人类的发展不仅要讲究代内公平，而且要讲究代际之间的公平，不能以当代人的利益为中心，甚至为了当代人的利益而不惜牺牲后代人的利益。而必须讲究生态文明，牢固树立起可持续发展的生态文明观。</p><h3 id="4-如何理解“绿水青山就是金山银山”？-1"><a href="#4-如何理解“绿水青山就是金山银山”？-1" class="headerlink" title="4.如何理解“绿水青山就是金山银山”？"></a>4.如何理解“绿水青山就是金山银山”？</h3><p>“绿水青山就是金山银山”的重要思想，触及到了一个人类社会发展的大难题，即：金山银山是人的物质追求，绿水青山是人赖以生存的自然条件，这两者都是人生存和发展所需要的，而这两者对于人来说又很难兼得。自工业革命以来，人类以牺牲绿水青山来实现自己的物质追求，曾经创造了前所未有的文明奇迹。但是，这种不可持续的经济增长方式造成了许多灾难性的后果，促使人们在对传统的增长方式和发展理论进行反思的同时，开始重新研究发展理论，重新研究发展中人与自然的关系。</p><p>以我国为例，我们在过去实行的是“先增长后治污”模式，在“两座山”问题上实际上是采取了“为了金山银山可以暂时牺牲绿水青山”的做法;后来认识到这样做不仅不可持续，而且治污的代价要大于增长获得的收益，于是许多地方提出了“宁要绿水青山，不要金山银山”的口号，即下决心改变“先增长后治污”的模式，优化环境，保护生态。这样的口号，这样的做法，虽然也讲“可持续发展”，但实际上是把“可持续”与“发展”割裂开来，这不利于生产力的发展。</p><p>“绿水青山就是金山银山”，则以“就是”一词把“绿水青山”和“金山银山”辩证地连接起来，以积极的而不是悲观的态度阐明了这两者之间的关系，讲清楚了发展中人与自然的辩证统一关系绿水青山就是金山银山”这一重要思想，所表达的则是环境、生态应该是社会生产力内部的一个有机组成部分。也就是说，习近平把环境、生态纳入了社会生产力的范畴。这种态度就是马克思主义的态度，这种认识就是马克思主义的认识。。</p><p>因此，我们说习近平关于“绿水青山就是金山银山”的重要思想，以一种新颖的发展理念，坚持和发展了马克思主义创始人以积极乐观的态度认识和处理发展中人与自然关系问题的科学思想。</p><h3 id="5-简述辩证唯物主义自然观战胜机械论自然观的历史必然性。"><a href="#5-简述辩证唯物主义自然观战胜机械论自然观的历史必然性。" class="headerlink" title="5.简述辩证唯物主义自然观战胜机械论自然观的历史必然性。"></a>5.简述辩证唯物主义自然观战胜机械论自然观的历史必然性。</h3><p>机械论自然观的产生有其历史的必然性和合理性，但它用孤立的，静止的，片面的观点去看待世界，否认事物的联系和发展变化，否认事物的内部矛盾。实践是检验真理的唯一标准，机械论自然观的这些特点与近代自然科学已经相悖，应当摒弃。人类社会的大趋势是发展，在目前的历史环境下，机械论自然观的存在只会阻碍这种发展，所以必将被适应当前自然科学的辩证唯物主义自然观所取代，这是历史必然性。</p><p>P28</p><h2 id="第二章-科学技术观（byself）"><a href="#第二章-科学技术观（byself）" class="headerlink" title="第二章 科学技术观（byself）"></a>第二章 科学技术观（byself）</h2><h3 id="6-如何理解18-19世纪科学技术发展与马克思恩格斯科学技术思想产生的关系？"><a href="#6-如何理解18-19世纪科学技术发展与马克思恩格斯科学技术思想产生的关系？" class="headerlink" title="6.如何理解18.19世纪科学技术发展与马克思恩格斯科学技术思想产生的关系？"></a>6.如何理解18.19世纪科学技术发展与马克思恩格斯科学技术思想产生的关系？</h3><p>p45</p><p>从18世纪60年代起始于英国的第一头次技术革命和继之而来的产业革命，既向科学提出了新的要求，也为科学提供了新的事实，更为科学提供了新的交流方法，从而使科学在19世纪获得了长足的进步，取得了影响深远的一些重要发现，为辩证唯物主义自然观的产生提供了丰富的物质基础</p><p>19世纪的自然科学成就为辩证唯物主义自然观产生提供了科学前提。如在天文学上，1755年康德和拉普拉斯（1796年）分别提出的关于太阳系起源的星去假设。在地质学上，英国科学家莱伊尔1830年发表“地球演化学说”，在物理学上焦耳发现能量转化和守恒定律，从而动摇了形而上学的基础，在化学上1824年由维等人合成尿素，在生物上，1838年施旺提出细胞是生命 的基本结构单位，1958年达尔文创立特种起源论，对于这些重要的发现，恩格斯经过反复研究，从自然观的高度提出了运动形式及其相互转化的学说。恩格斯关于运动形式的学说把蕴含在当时诸多科学发现中的思想精华作了概念性升华，从而提供了一种观察研究自然的哲学方式</p><p>综上所述，辩证唯物主义自然观的产生反映了科学技术发展的历史必然性。</p><h3 id="7-怎样认识马克思恩格斯的科学技术思想在马克思主义理论体系中的重要地位？"><a href="#7-怎样认识马克思恩格斯的科学技术思想在马克思主义理论体系中的重要地位？" class="headerlink" title="7.怎样认识马克思恩格斯的科学技术思想在马克思主义理论体系中的重要地位？"></a>7.怎样认识马克思恩格斯的科学技术思想在马克思主义理论体系中的重要地位？</h3><p>马克思主义理论体系，是关于全世界无产阶级和全人类彻底解放的学说。它由马克思主义哲学、马克思主义政治经济学和科学社会主义三大部分组成，是马克思、恩格斯在批判地继承和吸收人类关于自然科学、思维科学、社会科学优秀成果的基础上于19世纪40年代创立的，并在实践中不断地丰富、发展和完善的无产阶级思想的科学体系。</p><p>马克思恩格斯科学技术思想表明了科学技术是推动社会发展的革命力量，通过对科学技术的理解、科学的分类、科学技术与哲学的关系、科学技术是生产力、科学技术的生产动因、科学技术的社会功能、科学技术与社会制度、科学与技术的相互关系、科学技术异化等方面观点的阐述，极大的丰富和发展了马克思主义理论，有助于指导我们正确分析科学技术及其发展的理论和现实问题。</p><h3 id="8-马恩与国外学者关于科技的本质区别p51-55"><a href="#8-马恩与国外学者关于科技的本质区别p51-55" class="headerlink" title="8.马恩与国外学者关于科技的本质区别p51-55"></a>8.马恩与国外学者关于科技的本质区别p51-55</h3><h3 id="9-如何理解科学技术一体化的特征？"><a href="#9-如何理解科学技术一体化的特征？" class="headerlink" title="9.如何理解科学技术一体化的特征？"></a>9.如何理解科学技术一体化的特征？</h3><p>在人类历史上，科学与技术经历了几次分合。科学与技术源起于人类的社会生产实践，本来是内在统一的，但随着生产力的发展，出现了脑力劳动与体力劳动的分工，一部分人从单纯的体力劳动中分化出来，专门从事政治、宗教、艺术、哲学等活动，科学与技术从此分道扬镳，科学活动由学者们承担，技术研究则由工匠们掌握。在古代，科学对技术的影响甚微，无论是自然经济条件下的农业技术，还是工匠的手工业技术，都是凭经验掌握和积累的，那时几乎没有以科学的应用为特征的技术，而只有手艺、技能——尽管这些经验可能发展到惊人的水平。</p><p>从15世纪下半叶近代自然科学产生以后，直到19世纪的上半叶，科学的实际应用才逐步显现效能。正如马克思所说：只有在资本主义条件下，才第一次产生了只有用科学方法才能解决的实际问题，才第一次达到使科学的应用成为可能和必要的那样一种规模，科学获得了成为致富手段的使用，发明成为一种特殊的职业，科学成为生产过程的因素，生产过程成为科学的应用。15世纪以后，科学实验活动融入科学研究20科学成就是在技术基础上的“技术科学化”的结果，技术可以产生科学，“技术科学化”表明:技术是科学发展的动力 ，科学需要推动技术前进；技术为科学的发展提供研究手段，特别是科学实</p><h3 id="10-为什么说科学发展表现为继承与创新的统一？（p62）"><a href="#10-为什么说科学发展表现为继承与创新的统一？（p62）" class="headerlink" title="10.为什么说科学发展表现为继承与创新的统一？（p62）"></a>10.为什么说科学发展表现为继承与创新的统一？（p62）</h3><h3 id="11-怎样认识技术发展的动力？对技术具有双刃剑作用的看法？"><a href="#11-怎样认识技术发展的动力？对技术具有双刃剑作用的看法？" class="headerlink" title="11.怎样认识技术发展的动力？对技术具有双刃剑作用的看法？"></a>11.怎样认识技术发展的动力？对技术具有双刃剑作用的看法？</h3><p>技术发展史不断证明,技术像一把双刃剑,既有有益于人类发展的一面,也有危害人类利益的一面。一方面，技术的进步推动了生产力内部各要素的变革，促进了产业结构的调整、经济形式的变化和经济增长方式的变化，实现了经济转型；变革了生产关系，增进了人类自由而全面的发展，推动人类社会进入发展的新阶段；将人类从繁重的劳动中解放出来，对人类的生活方式产生了深刻的影响。另一方面，技术的进步也产生了一些道德和伦理问题，如克隆人的伦理问题、基因治疗和基因增强的伦理问题、网络伦理问题、核伦理问题等。</p><p>因此，必须以人民为中心，大力发展事关国计民生的科学技术；必须以先进的文化来引导，协调科学文化与人文文化的冲突；必须改变单纯有利于经济增长的倾向，走经济增长与环境保护双赢之路；必须客观全面评价科学技术的风险和收益，指定恰当的科学技术公共政策。</p><h2 id="第二章-科学技术观"><a href="#第二章-科学技术观" class="headerlink" title="第二章 科学技术观"></a>第二章 科学技术观</h2><h3 id="1-如何理解18、19世纪科学技术发展与马克思、恩格斯科学技术思想产生的关系？"><a href="#1-如何理解18、19世纪科学技术发展与马克思、恩格斯科学技术思想产生的关系？" class="headerlink" title="1.如何理解18、19世纪科学技术发展与马克思、恩格斯科学技术思想产生的关系？"></a>1.如何理解18、19世纪科学技术发展与马克思、恩格斯科学技术思想产生的关系？</h3><p>18、19世纪，天文学、地理学、物理学、化学、解剖学、生物学等都有了长足的发展，特别是能量守恒与转化定律、细胞学说和生物进化论三大发现，使自然科学的发展进入了一个新时期，两次科技革命使人类进入了工业文明时代。马克思、恩格斯在总结和概括19世纪科学技术成果的基础上，形成了以辩证唯物主义为理论基础的科学技术思想。</p><h3 id="2-怎样认识马克思、恩格斯的科学技术思想在马克思主义理论体系中的地位？"><a href="#2-怎样认识马克思、恩格斯的科学技术思想在马克思主义理论体系中的地位？" class="headerlink" title="2.怎样认识马克思、恩格斯的科学技术思想在马克思主义理论体系中的地位？"></a>2.怎样认识马克思、恩格斯的科学技术思想在马克思主义理论体系中的地位？</h3><p>马克思主义科学技术观是基于马克思、恩格斯的科学技术思想，对科学基础机器发展规律的概括和总结，是马克思主义关于科学技术的本体论和认识论。</p><p>从辩证唯物主义和历史唯物主义的基本立场出发，在总体上把握马克思、恩格斯的科学技术思想；马克思主义认为科学是一般生产力，技术是现实生产力；科学是认识世界，技术是改造世界。现代科学和技术形成既有区别又有联系的体系结构。</p><h3 id="3-马克思、恩格斯和国外学者关于科学技术本质的分析有何主要差异？"><a href="#3-马克思、恩格斯和国外学者关于科学技术本质的分析有何主要差异？" class="headerlink" title="3.马克思、恩格斯和国外学者关于科学技术本质的分析有何主要差异？"></a>3.马克思、恩格斯和国外学者关于科学技术本质的分析有何主要差异？</h3><p>（1）马克思、恩格斯关于技术本质特征的分析</p><p>  马克思、恩格斯认为技术在本质上体现了“人类对自然的实践关系”，技术是人的本质力量的对象化。<br>  第一，劳动资料延长了人的自然的肢体。<br>  第二，工艺学在本质上揭示出人对自然的能动关系。<br>  第三，技术的发展引起生产关系的变革。</p><p>（2）国外学者对技术本质特征的研究</p><p>  欧美技术哲学存在工程学的和人文主义的两种技术研究路线；日本的技术论在技术的本质问题上形成了“方法技能说”、“劳动手段说”、“知识应用说”等观点。这些观点各有特色，但大都表现出对技术理解的单一性。<br>  我们需要用马克思主义科学技术观进行分析评价。马克思主义认为，技术是人类为满足自身的需要，在实践活动中根据实践经验或科学原理所创造发明的各种手段和方式方法的总和。主要体现在两个方面：一是技术活动，狭义的技术是指人类在利用自然、改造自然的劳动过程中所掌握的方法和手段；广义的技术是指人类改造自然、改造社会和改造人类自身的方法和手段。二是技术成果，包括技术理论、技能技巧、技术工艺与技术产品（物质设备）。<br>  技术在本质上体现了人对自然的实践关系，是人的本质力量的展现，属于直接生产力，是自然性和社会性、物质性和精神性、中立性与价值性、主体性和客体性、跃迁性和积累性的统一。</p><h3 id="4-如何理解科学技术一体化的特征？"><a href="#4-如何理解科学技术一体化的特征？" class="headerlink" title="4.如何理解科学技术一体化的特征？"></a>4.如何理解科学技术一体化的特征？</h3><p>（1）现代科学的体系结构由学科结构和知识结构组成</p><p>  学科结构由基础科学、技术科学、工程科学构成。知识结构由科学事实、科学概念、科学定律、科学假说、科学理论构成。现代科学的体系结构表现出现代科学的发展过程，其中学科结构形成立体的架构，知识结构各要素渗透在学科结构相对应的要素之中。基础科学、技术科学、工程科学都是系统化的知识，都会经过一个由科学事实到科学理论的形成过程。</p><p>（2）现代技术的体系结构由门类结构和形态结构组成</p><p>  门类结构由实验技术、基本技术和产业技术构成。<br>  形态结构由经验形态的技术、实体形态的技术和知识形态的技术构成。<br>  现代技术的体系结构表现出现代技术的发展过程，其中门类结构是立体的架构，形态结构的各要素同样渗透咋门类结构相对应的要素当中。实验技术、基本技术和产业技术都包含经验技能，都使用工具机器，都蕴含了知识。<br>  现代科学技术体系结构的研究表明，科学技术在各自的发展中，不但日益多样化和系统化，而且越来越呈现出科学技术一体化的特征。</p><h3 id="5-为什么说科学发展表现为继承与创新的统一？"><a href="#5-为什么说科学发展表现为继承与创新的统一？" class="headerlink" title="5.为什么说科学发展表现为继承与创新的统一？"></a>5.为什么说科学发展表现为继承与创新的统一？</h3><p>继承：市科学技术发展中的量变，它可使科学知识延续、扩大和加深。科学是个开放系统，它在时间上有继承性，在空间上有积累性。只有继承已发现的科学事实、已有理论中的正确东西，科学才能发展、不断完善。</p><p>创新：是人类对自然的认识出现新的飞跃，引起科学发展中的质变。创新是继承的必然趋势和目的。</p><p>在科学技术的发展模式及动力问题上，马克思主义认为科学发展在纵向上表现为渐进与飞跃的统一，在横向上表现为分化与综合的统一，在总体趋势上表现为继承与创新的统一。</p><p>技术的发展由社会需要、技术目的及科学进步等多种因素共同推动。其中社会需求与技术发展水平之间的矛盾是技术发展的基本动力，技术目的和技术手段之间的矛盾是技术发展的直接动力，科学进步是技术发展的重要推动力。</p><h3 id="6-怎样认识技术发展的动力？"><a href="#6-怎样认识技术发展的动力？" class="headerlink" title="6.怎样认识技术发展的动力？"></a>6.怎样认识技术发展的动力？</h3><p>马克思主义认为，技术的发展由社会需要、技术目的以及科学进步等多种因素共同推动。</p><p>（1）社会需求与技术发展水平之间的矛盾是技术发展的基本动力<br>  任何技术，最早都源于人类的需要。正是为了生存发展的需要，人类起初模仿自然，进而进行创造，发明了各种技术。同时，文化对技术发展具有明显的张力作用。先进的思想文化会推动技术的发展，而落后的思想文化则会制约和阻碍技术的发展，包括影像技术决策、技术研发以及技术成果的产业化各方面。</p><p>（2）技术目的和技术手段之间的矛盾是技术发展的直接动力<br>  技术目的就是在技术实践过程中在观念上预先建立的技术结果的主观形象，是技术实践的内在要求，影响并贯穿技术实践的全过程。技术手段即实现技术目的中介因素，包括实现技术目的的工具和实用工具的形式。技术目的的提出和实现，必须依赖于与之相匹配的技术手段。技术手段是实现技术目的的中介和保证，它包括达到技术功能要求所使用的工具以及应用工具的方式。</p><p>（3）科学进步是技术发展的重要推动力<br>  19世纪中期以后，科学走到了技术前面，成为技术发展的理论向导。科学革命导致技术革命，技术发展对科学进步的依赖程度越来越高，技术已成为科学的应用。尤其是当今社会的发展，已形成了科学技术一体化的双向互动过程。</p><h2 id="第三章-科学技术方法论"><a href="#第三章-科学技术方法论" class="headerlink" title="第三章 科学技术方法论"></a>第三章 科学技术方法论</h2><h3 id="1-如何理解马克思主义科学技术方法论与科学研究中的具体方法的关系？"><a href="#1-如何理解马克思主义科学技术方法论与科学研究中的具体方法的关系？" class="headerlink" title="1.如何理解马克思主义科学技术方法论与科学研究中的具体方法的关系？"></a>1.如何理解马克思主义科学技术方法论与科学研究中的具体方法的关系？</h3><p>马克思主义的科学技术方法论是以辩证唯物主义立场、观点为基础，吸取具体科学技术研究中的基本方法，并对其进行概括和升华的方法论。</p><p>科学技术研究，离不开辩证思维。分析与综合、归纳与演绎、从抽象到具体、历史与逻辑的统一，这些辩证思维的形式体现和贯彻在科学家、工程师的具体科学技术研究中。自觉的认识和提升这些辩证思维的形式，对于树立，马克思主义科学技术观，深入研究科学技术，建设创新型国家具有重要意义。</p><h3 id="2-如何理解辩证思维渗透在科学研究的全部过程中？"><a href="#2-如何理解辩证思维渗透在科学研究的全部过程中？" class="headerlink" title="2.如何理解辩证思维渗透在科学研究的全部过程中？"></a>2.如何理解辩证思维渗透在科学研究的全部过程中？</h3><p>马克思主义科学技术方法论的核心就是辩证思维。马克思主义科学技术方法论的基本原则就是把辩证法贯彻到科学技术研究中，以对立统一、质量互变和否定之否定的辩证思想渗透到具体的科学技术研究中，把握具体科学技术的研究过程。</p><h3 id="3-如何把握创造性思维特性？"><a href="#3-如何把握创造性思维特性？" class="headerlink" title="3.如何把握创造性思维特性？"></a>3.如何把握创造性思维特性？</h3><p>创造是科学研究和技术发明最重要特性之一。创造性思维不是在所有辩证思维和科学研究方法之外独立的一种思维方式或方法，是能够提出创见的思维，与一般性思维相比，是在思维特征方面不刻板，组合各种思维、灵活调用思维的特性。</p><p>创造性思维的特点是思维方向的求异性，思维结构的灵活性、思维进程的飞跃性、思维效果的整体性、思维表达的新颖性等。</p><p>创造性思维特别注重逻辑思维与非逻辑思维的统一、抽象思维与形象思维的辩证统一。</p><h3 id="4-注意多学科的交叉与融贯有何方法论意义？"><a href="#4-注意多学科的交叉与融贯有何方法论意义？" class="headerlink" title="4.注意多学科的交叉与融贯有何方法论意义？"></a>4.注意多学科的交叉与融贯有何方法论意义？</h3><p>移植和学科交叉或跨学科的研究方法，是创造性思维的两种非常有效的研究方法。当代科学研究和技术发明变得越来越复杂，进行移植与交叉，通过多学科或跨学科的研究，常常能够获得单一学科研究无法获得的创新成果。多学科融合或通过跨学科研究问题也是当代科学和技术解决问题的创造性方法，体现了广泛联系和发展的辩证法。</p><p>当代各门科学之间的交叉型越来越大，通过学科之间的交叉往往可以获得新的认识，带来创新。学科交叉成为一种新的思考方式和研究方法。</p><p>所谓学科交叉方法，就是两门以上的学科之间在面对同一研究对象时，从不同学科的角度进行比对研究的方法。借鉴其他学科的研究，思考本学科的问题和对象，融合其他学科的研究方法，以达到对研究对象的新认识。</p><p>所谓跨学科方法就是通过多学科的协作共同解决同一问题的方法，跨学科也是一种学科融合的方法，也可以称为多维融贯的方法。</p><h3 id="5-战略性思维对于科学研究有何意义？"><a href="#5-战略性思维对于科学研究有何意义？" class="headerlink" title="5.战略性思维对于科学研究有何意义？"></a>5.战略性思维对于科学研究有何意义？</h3><p>战略性思维是对战略科学家的思维要求。同时对于一个从事一般科学研究、技术发明和工程建设的科学家也有重要意义。习近平非常重视战略性思维的重要作用与深刻意义，是其提出的“六大思维”之一，战略性思维对于科学研究而言，非常重要。</p><p>战略性思维是高瞻远瞩、统揽全局、善于把握事物发展总体趋势和方向的思维方法，展示的是看问题的高度和深度。古人讲：“不谋万世者，不足谋一时；不谋全局者，不足谋一域。”科学家与工程师没有战略性思维、具有什么样的战略性思维，一定程度上决定着在中国特色社会主义伟大事业中的科学技术研究能登多高、能走多远、将抵达何处。战略性思维能力的强弱，取决于思考问题的高度、理论研究的深度、知识视野的广度，以及对于科学技术发展全局的时间跨度的认识与把握。</p><p>对于国家而言，科学技术的总体规划是一种科学技术研究的战略，战略科学家需要掌握国家科学技术的基本战略，按照国家需要，结合自己及其研究团队的研究确定科学研究方向。</p><h2 id="第四章-科学技术社会论"><a href="#第四章-科学技术社会论" class="headerlink" title="第四章 科学技术社会论"></a>第四章 科学技术社会论</h2><h3 id="1-为什么说“科学是一种在历史上起推动作用的、革命的力量”？"><a href="#1-为什么说“科学是一种在历史上起推动作用的、革命的力量”？" class="headerlink" title="1.为什么说“科学是一种在历史上起推动作用的、革命的力量”？"></a>1.为什么说“科学是一种在历史上起推动作用的、革命的力量”？</h3><p>   科学技术是历史发展的火车头，改变了社会历史进程，造就了新的社会形态;推动了生产力内部各要素的变革，引发了产业结构的调整、经济形式的变化和经济增长方式的转变，造就了经济转型;产生了技术异化现象，要对异化的资本主义制度展开批判，更好地发挥科学技术的社会功能。<br> 科学技术作为社会发展的动力,是马克思主义的基木观点。科学是生产力的“知识的形态”。作为生产力的科学技术，能够大大提高社会生产力水平，推动着整个人类物质生产的迅猛发展。<br> 作为强大的精神力量的科学技术，能够促进人类思想的解放，在产业革命的基础上，推动社会变革，对社会生产关系产生有力影响。<br> 作为人类最终走向白由的科学技术，能够作为解放的杠杆，增进人类精神生活的丰富性和自我发展能力，有助于实现人的全面自由的发展。</p><h3 id="2-如何看待科学技术对人的异化和对自然的异化？"><a href="#2-如何看待科学技术对人的异化和对自然的异化？" class="headerlink" title="2.如何看待科学技术对人的异化和对自然的异化？"></a>2.如何看待科学技术对人的异化和对自然的异化？</h3><p> 科技异化实质上是在资本主义制度下劳动异化和人的异化一种必然结果。由于劳动是人的最根本最现实的实践活动，是人及人类社会存在的根本方式，劳动的异化必然带来人的其他社会活动和社会关系的全面异化，科学技术也不例外，因为“宗教、家庭、国家、法、道德、科学、艺术等等，都不过是生产的一些特殊的方式，并且受生产的普遍规律的支配。”</p><p> 因此，科学技术作为劳动亦即人处理自身与自然界关系的社会活动的产物，也必然随着资本主义社会劳动的异化而表现出异化的现象。最根本的是要消灭对科学技术的资本主义利用方式，把现代科学技术从资本主义制度下解放出来。也就是说只有通过无产阶级革命来最终解决资本主义的科技异化问题。当然，在马克思看来，异化的完全克服只有在共产主义社会制度中才能最终实现。</p><h3 id="3-科学技术的社会体制和组织机构对科学技术的发展有何意义？"><a href="#3-科学技术的社会体制和组织机构对科学技术的发展有何意义？" class="headerlink" title="3.科学技术的社会体制和组织机构对科学技术的发展有何意义？"></a>3.科学技术的社会体制和组织机构对科学技术的发展有何意义？</h3><p> 科学技术的社会建制有一个历史过程。经济支持制度、法律保障体系等科学技术体制是根本，各种组织机构及其科研组织运行是保证，科学技术的伦理规范是导引。在科学技术发展应用的新阶段，科学技术的社会建制呈现出一些新特点，因此必须进行科学技术体制改革，以保证科学技术的良好运行。<br> 作为社会建制的科学技术体制是在一定社会价值观念支配下，依据相应的物质设备条件形成的一种社会组织制度，旨在支持推动人类对自然的认识和利用。科学技术的体制化以相应的职业化为核心，其内涵随着科学技术的发展而不断拓展和丰富。科学技术的社会体制包括:组织领导体制、经济支持制度、法律保障体制、交流与传播体制、人才教育培养制度等。科学技术与其他各种事业密切相关,需要建立相应的组织机构以保证科学技术活动的顺利进行。科学技术组织机构随着历史的演化而变化，具有各白的特点和功能，是实现科学技术现代化的组织保证。在科学技术社会史上形成与发展起来的组织机构有:科学技术决策、管理与咨询机构，科学技术活动组织机构，科学技术传播机构，科学技术人才培养机构。</p><blockquote><p>【以下摘白百度贴吧帖子“科学技术的社会体制化及其对科学发展的意义”】<br>科学技术体制化的内容包括:科学技术的投入体制、科技研究的结构比例、科学技术的法律制度、科技研究的管理体制。<br>科学技术的社会体制化对科学发展的意义:1、它可以积聚社会上的力量来进行柑应的科学研究;2、当代科技活动的结构中基础研究将会有大量的人员参l与j;3、明确的法律以及管理制度将会更进一步促进科学技术的发展。</p></blockquote><h3 id="4-为什么要对科学技术工作者进行伦理规范？"><a href="#4-为什么要对科学技术工作者进行伦理规范？" class="headerlink" title="4.为什么要对科学技术工作者进行伦理规范？"></a>4.为什么要对科学技术工作者进行伦理规范？</h3><p> 科学技术活动与人类其他活动一样，建立在诚信和道德的基础上。现阶段，默顿的科学的精神气质受到挑战，科学技术工作者有失范行为，需要制定相关科研诚信指南和工程师伦理准则加以规范。科学工作者进行科学研究和医学实践，尤其是进行人体实验和动物实验，应该遵循社会伦理、生命伦理、动物伦理等。技术工作者，尤其是工程师，在工程技术活动中，应该遵循一定的职业伦理和社会伦理准则，应该承担对社会、专业、雇主和同事的责任，应该对工程的环境影响负有特别的责任，规范白己的行为，为人类福祉和环境保护服务。</p><h3 id="5-如何理解科学技术文化与人文文化之间的冲突与协调？"><a href="#5-如何理解科学技术文化与人文文化之间的冲突与协调？" class="headerlink" title="5.如何理解科学技术文化与人文文化之间的冲突与协调？"></a>5.如何理解科学技术文化与人文文化之间的冲突与协调？</h3><p>(一）社会文化对科学技术的影响</p><p> 科学技术的产生和发展需要一定的社会文化环境。社会文化与科学技术文化紧密关联，并由此影响科学技术的发展及其应用。默顿在《十七世纪英格兰的科学、技术与社会》中提出的“清教主义促进英国近代科学的制度变化”，以及“李约瑟难题”——“近代科学为什么没有在中国诞生”的解答，就说明了这一点。</p><p>(二）科学文化与人文文化的协调<br>  1．要防止科学在生活世界、自然世界对人文的僭越所造成的科学文化与人文文化之间的冲突，深刻理解科学的限度，用正确的人文理念指导我们的生活。<br>  2．必须以社会先进文化来引领科学技术文化，使科学技术发展和应用为经济社会健康全面发展服务。得到广泛提倡的环境科学技术就是为了协调人与自然之间的关系所做的努力，是科学技术文化与人文文化——绿色文化的良性互动产物。</p><h3 id="6-科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？"><a href="#6-科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？" class="headerlink" title="6.科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？"></a>6.科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？</h3><p> 科学技术的风险包括环境风险、政治风险、经济风险、健康风险和伦理风险等。这些风险会引发一系列争论，造成评价和决策上的困难。习近平指出:“要加快建立科技咨询支撑行政决策的科技决策机制，加强科技决策咨询系统，建设高水平科技智库。要加快推进重大科技决策制度化，解决好实际存在的部门领导拍脑袋、科技专家看颜色行事等问题。”</p><p>要恰当进行科学技术风险评价与决策，就应该全面评价科学技术风险—收益的多个方面，批判性地考察“内部”存有争议的科学知识或技术知识，分析相互竞争的利益集团和社会结构的”外部”政治学，理解科学技术专家知识和决策的局限性、公众理解科学的必要性以及外行知识的优势，明确政府、科学技术专家以及公众在与科学技术风险相关的公共决策中的不同作用，确立公众参与决策的可能方式，从而形成最优化的科学技术公共政策模式，以达到对科学技术风险社会有效治理的目的。</p><h2 id="第五章-中国马克思主义科学技术观"><a href="#第五章-中国马克思主义科学技术观" class="headerlink" title="第五章 中国马克思主义科学技术观"></a>第五章 中国马克思主义科学技术观</h2><h3 id="1-为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？"><a href="#1-为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？" class="headerlink" title="1.为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？"></a>1.为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？</h3><p> 毛泽东、邓小平、……、胡锦涛、习近平的科学技术思想，是在中国共产党领导我国科学技术事业发展和进行社会主义现代化建设的伟大时间中，逐渐形成、发展和完善的。</p><p> 中国马克思主义科学技术观是基于马克思、恩格斯的科学技术思想，对当代科学技术机器发展规律的概括和总结，是马克思主义科学技术论的重要组成部分。</p><p> 中国马克思主义科学技术观是中国共产党人集体智慧的结晶，是对毛泽东、邓小平、……、习近平科学技术思想的概括和总结，是他们科学技术思想的理论升华和飞跃，是他们科学技术思想的凝练和精髓。</p><p> 中国马克思主义科学技术观的内容丰富，涉及了科学技术的功能、目标、机制、战略、人才和方针等重大问题，是一个科学、完整的思想理论体系。</p><h3 id="2-如何理解中国马克思主义科学技术观的理论精髓？"><a href="#2-如何理解中国马克思主义科学技术观的理论精髓？" class="headerlink" title="2.如何理解中国马克思主义科学技术观的理论精髓？"></a>2.如何理解中国马克思主义科学技术观的理论精髓？</h3><p> 中国马克思主义科学技术观概括和总结了毛泽东、邓小平、···、习近平等的科学技术思想，包括科学技术的功能观、战略观、人才观、和谐观和创新观的基木内容，体现出时代性、实践性、科学性、创新性、自主性、人本性等特征，建设中国特色的创新型国家，是中国马克思主义科学技术观的具体体现。中国马克思主义科学技术观，是马克思主义科学技术观与中国具体科学技术实践相结合的产物，是马克思主义科学技术论的重要组成部分。</p><h3 id="3-如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？"><a href="#3-如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？" class="headerlink" title="3.如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？"></a>3.如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？</h3><p> 中国马克思主义科学技术观的三个历史阶段是其各自所处的历史条件所决定的，是对时代背景实事求是的反映，因此科学技术思想都镌刻了时代的烙印，反映了时代的需求。</p><p> 习近平新时代中国特色社会主义思想中的科学技术观，是在中国特色社会主义进入新时代的历史条件下形成的。新时代之“新”，一是在于我们进入了一个新的发展阶段，发展环境、发展条件都发生了新的变化，目标任务也发生了新的变化;二是在于我们面临着新的社会主义主要矛盾;三是我们迈向新的奋斗目标。正是基于这一新时代的”新”特征时代背景，习近平立足于我贵哦科学技术与社会发展的现实需要，提出了一系列关于科学技术发展的理论观点，形成了习近平新时代中国特色社会主义科学技术观。</p>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>png和jpg格式的图片(二)</title>
      <link href="/%E6%9D%82%E8%AE%B0/Qt-images/"/>
      <url>/%E6%9D%82%E8%AE%B0/Qt-images/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在上篇文章 <a href="./png%E5%92%8Cjpg%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87.md">png和jpg格式图片</a> 中笔者就 <code>jpg</code> 和 <code>png</code> 两种格式进行了说明，但是关于 Qt 打开改后缀文件名之后图片的问题依然没有说明。要探究Qt为何不能打开改了后缀的图片文件，这个还是得从多方面去定位。前文说了，通过三种方式设置了 <code>QLabel</code> 的图片。</p><h2 id="场景复现"><a href="#场景复现" class="headerlink" title="场景复现"></a>场景复现</h2><blockquote><p>这里还是先说明一下设置不成功的场景如何复现:</p><ol><li>找一张 <code>.jpg</code> 的图片，修改后缀也就是文件属性为 <code>.png</code></li><li>通过以下三种方式中的任意一种去设置 <code>QLabel</code> 为图片。</li></ol><p>Qt 版本是 <code>5.9</code></p><p>编译器试了 <code>MSVC</code> 和 <code>mingw</code> 都不好使。</p></blockquote><h2 id="QLabel-设置图片方法"><a href="#QLabel-设置图片方法" class="headerlink" title="QLabel 设置图片方法"></a><code>QLabel</code> 设置图片方法</h2><ol><li>通过 <code>QPixmap</code>设置 <code>QLabel</code> 的图片</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPixmap <span class="title">img</span><span class="params">(<span class="string">&quot;:/Win11.png&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">ui-&gt;label-&gt;<span class="built_in">setPixmap</span>(img);</span><br><span class="line">ui-&gt;label-&gt;<span class="built_in">setScaledContents</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>通过 <code>QImage</code> 设置 <code>QLabel</code> 的图片</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QImage img;</span><br><span class="line">img.<span class="built_in">load</span>(<span class="string">&quot;:/Win11.png&quot;</span>);</span><br><span class="line">ui-&gt;label-&gt;<span class="built_in">setPixmap</span>(QPixmap::<span class="built_in">fromImage</span>(img))</span><br></pre></td></tr></table></figure><ol start="3"><li>通过 <code>QLabel.setStyleSheet()</code> 的图片</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;label-&gt;<span class="built_in">setStyleSheet</span>(<span class="built_in">QString</span>(<span class="string">&quot;QLabel&#123;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;border-image:url(:/Win11.png) 4 4 4 4 stretch stretch;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;&#125;&quot;</span>));</span><br></pre></td></tr></table></figure><p>当然还有第四种方法，通过 <code>QSvgRenderer</code> 设置：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSvgRenderer&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">QSvgRenderer <span class="title">svgRender</span><span class="params">(QString(<span class="string">&quot;:/Win11.svg&quot;</span>))</span></span>;</span><br><span class="line"><span class="function">QPixmap <span class="title">pixmap</span><span class="params">(<span class="number">20</span>,<span class="number">20</span>)</span></span>;</span><br><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;pixmap)</span></span>;</span><br><span class="line">svgRender.<span class="built_in">render</span>(&amp;painter);</span><br><span class="line">ui-&gt;label-&gt;<span class="built_in">setPixmap</span>(pixmap);</span><br></pre></td></tr></table></figure><p>场景是描述完了，可以动手尝试了</p><h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><p>接着就是去查看几种实现方式中的源码是如何是设置的了，这里先猜一下结论</p><blockquote><p>就是 <code>png</code> 和 <code>jpg</code> 格式的算法不同，格式问题导致的读取的算法不一致，因此Qt内部实现的读取图片的算法只能根据图片文件的后缀所对应的算法去读取算法，而 <code>setStyleSheet</code> 算法也是基于这么一个逻辑，因此三种读取方式都不成功。</p><p>关于图片算法的问题，在上篇文章 <a href="./png%E5%92%8Cjpg%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87.md">png和jpg格式图片</a> 中也略微提到，这个我们不深做研究，只需知道 <code>jpg</code> 和 <code>png</code> 不是同一种算法，也不通用即可。</p></blockquote><h2 id="初步验证"><a href="#初步验证" class="headerlink" title="初步验证"></a>初步验证</h2><p>因为上述几种步骤笔者都做过尝试，因此在验证过程中我们不纠结于使用哪一种方式，直接看结果。</p><ol><li>那如何去验证呢，我们还是看代码，这次我们在 Qt 的 <code>qrc</code> 文件中，去掉图片的后缀名，不带后缀属性去读取图片看看其是否可以读取成功。</li></ol><p><img src="/../../images/Qt%E5%9B%BE%E7%89%87/image-20220423143541263.png" alt="去掉后缀属性"></p><p><mark>运行结果</mark>:  <code>QLabel</code> 读取成功</p><p>如上图所示，在 <code>qrc</code> 文件中去掉图片的后缀，读取图片设置到 <code>QLabel</code> 依然是成功的。 </p><ol start="2"><li>我们接着操作，在代码中修改图片后缀为 <code>png</code>，看看这次能不能读取成功。</li></ol><img src="../../images/Qt%E5%9B%BE%E7%89%87/image-20220423143916480.png" alt="修改后缀为png" style="zoom:50%;" /><p><mark>运行结果</mark>：读取失败</p><p>如上图所示，添加后缀后反而还展示不成功了。</p><h2 id="初步验证的结果"><a href="#初步验证的结果" class="headerlink" title="初步验证的结果"></a>初步验证的结果</h2><p>这就基本上说明了：</p><blockquote><p>在 <code>Qt</code> 的内部有很大的几率是通过文件的后缀去判断调用哪个图片读取算法的。也就是说，当你人为的修改了 <code>png-&gt;jpg</code> 时，在 <code>Qt</code> 中就会出现设置图片失败的问题。目前看来，在代码没有问题，但是图片设置后不显示的情况下，最好的方式是，就是去掉图片的后缀，让 <code>Qt</code> 自己去判断调用哪个算法读取图片。</p></blockquote><h1 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h1><p>这里有关于 <code>Qt</code> 图片 <code>I\O</code> 的描述可以看看Qt帮助手册中关于图像文件读写的文档。</p><p><img src="/../../images/Qt%E5%9B%BE%E7%89%87/image-20220423152853629.png" alt="读写图片文件"></p><p>源码部分，我们只需查看两个<code>Qt</code> 类就行，个人感觉看一个就知道了。两者识别图片的算法应该是一致的。包括 <code>setStyleSheet()</code>接口中设置图片的接口应该都是一致的。 </p><blockquote><ol><li>QPixmap依赖于所在的平台的绘图引擎，故例如反锯齿等一些效果在不同的平台上可能会有不同的显示效果，QImage使用Qt自身的绘图引擎，可在不同平台上具有相同的显示效果</li><li>目前的Qt会把QPixmap都存储在graphics memory中，QImage是存储在客户端的，是独立于硬件的。在X11, Mac 以及 Symbian平台上，QPixmap 是存储在服务器端，而QImage则是存储在客户端，在Windows平台上，QPixmap和QImage都是存储在客户端，并不使用任何的GDI资源。</li><li>由于QImage是独立于硬件的，也是一种QPaintDevice，因此我们可以在另一个线程中对其进行绘制，而不需要在GUI线程中处理，使用这一方式可以很大幅度提高UI响应速度。</li></ol></blockquote><h2 id="QPixmap"><a href="#QPixmap" class="headerlink" title="QPixmap"></a>QPixmap</h2><p>查询到QPixmap的源文件，一般存放在 <code>Qt</code> 安装目录下 <code>$&#123;安装目录&#125;\5.9.9\Src\qtbase\src\gui\image</code>，文件名为 <code>qpixmap.h qpixmap.cpp</code></p><p>先看一下 <code>QPixmap</code> 的 构造函数中读取图片文件的方法。</p><ol><li><p><code>QPixmap::QPixmap(const QString&amp; fileName, const char *format, Qt::ImageConversionFlags flags)</code>的源码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QPixmap::<span class="built_in">QPixmap</span>(<span class="type">const</span> QString&amp; fileName, <span class="type">const</span> <span class="type">char</span> *format, Qt::ImageConversionFlags flags)</span><br><span class="line">    : <span class="built_in">QPaintDevice</span>()</span><br><span class="line">   &#123;</span><br><span class="line">        <span class="built_in">doInit</span>(<span class="number">0</span>, <span class="number">0</span>, QPlatformPixmap::PixmapType);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">qt_pixmap_thread_test</span>())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">load</span>(fileName, format, flags); <span class="comment">// 这里看到调用了load()的接口，接着查看load是如何实现的</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><code>load()</code>函数源码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    Loads a pixmap from the file with the given \a fileName. Returns</span></span><br><span class="line"><span class="comment">    true if the pixmap was successfully loaded; otherwise invalidates</span></span><br><span class="line"><span class="comment">    the pixmap and returns \c false.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    The loader attempts to read the pixmap using the specified \a</span></span><br><span class="line"><span class="comment">    format. If the \a format is not specified (which is the default),</span></span><br><span class="line"><span class="comment">    the loader probes the file for a header to guess the file format.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    The file name can either refer to an actual file on disk or to one</span></span><br><span class="line"><span class="comment">    of the application&#x27;s embedded resources. See the</span></span><br><span class="line"><span class="comment">    \l&#123;resources.html&#125;&#123;Resource System&#125; overview for details on how to</span></span><br><span class="line"><span class="comment">    embed pixmaps and other resource files in the application&#x27;s</span></span><br><span class="line"><span class="comment">    executable.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    If the data needs to be modified to fit in a lower-resolution</span></span><br><span class="line"><span class="comment">    result (e.g. converting from 32-bit to 8-bit), use the \a flags to</span></span><br><span class="line"><span class="comment">    control the conversion.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Note that QPixmaps are automatically added to the QPixmapCache</span></span><br><span class="line"><span class="comment">    when loaded from a file; the key used is internal and can not</span></span><br><span class="line"><span class="comment">    be acquired.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    \sa loadFromData(), &#123;QPixmap#Reading and Writing Image</span></span><br><span class="line"><span class="comment">    Files&#125;&#123;Reading and Writing Image Files&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 翻译过来就是</span></span><br><span class="line"><span class="comment">从给定的文件名的文件中加载一个像素图。如果pixmap成功加载，则为True;否则返回无效pixmap并返回\c false。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">加载器尝试使用指定的\a读取pixmap格式。如果没有指定\a格式(这是默认的)，</span></span><br><span class="line"><span class="comment">加载器探测文件的头，以猜测文件的格式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">文件名可以指向磁盘上的实际文件，也可以指向磁盘上的实际文件应用程序的嵌入式资源。看到\l&#123;resources.html&#125;&#123;Resource System&#125;概述如何嵌入pixmap和其他资源文件在应用程序的可执行文件。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如果数据需要修改以适应低分辨率结果(例如从32位转换到8位)，使用\a标志来控制转换。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">注意，qpixmap会自动添加到QPixmapCache中</span></span><br><span class="line"><span class="comment">当从文件加载时;使用的密钥是内部的，不能被收购。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">\sa loadFromData()， &#123;QPixmap#读写图像读写图像文件&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// loadFromdata的源码我也补充到了文末</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QPixmap::load</span><span class="params">(<span class="type">const</span> QString &amp;fileName, <span class="type">const</span> <span class="type">char</span> *format, Qt::ImageConversionFlags flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!fileName.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">QFileInfo <span class="title">info</span><span class="params">(fileName)</span></span>;</span><br><span class="line">        <span class="comment">// Note: If no extension is provided, we try to match the</span></span><br><span class="line">        <span class="comment">// file against known plugin extensions</span></span><br><span class="line">        <span class="keyword">if</span> (info.<span class="built_in">completeSuffix</span>().<span class="built_in">isEmpty</span>() || info.<span class="built_in">exists</span>()) &#123;</span><br><span class="line"></span><br><span class="line">            QString key = <span class="built_in">QLatin1String</span>(<span class="string">&quot;qt_pixmap&quot;</span>)</span><br><span class="line">                    % info.<span class="built_in">absoluteFilePath</span>()</span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;uint&gt;(info.<span class="built_in">lastModified</span>().<span class="built_in">toSecsSinceEpoch</span>())</span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;quint64&gt;(info.<span class="built_in">size</span>())</span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;uint&gt;(data ? data-&gt;<span class="built_in">pixelType</span>() : QPlatformPixmap::PixmapType);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (QPixmapCache::<span class="built_in">find</span>(key, <span class="keyword">this</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            data = QPlatformPixmap::<span class="built_in">create</span>(<span class="number">0</span>, <span class="number">0</span>, data ? data-&gt;<span class="built_in">pixelType</span>() : QPlatformPixmap::PixmapType);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (data-&gt;<span class="built_in">fromFile</span>(fileName, format, flags)) &#123;</span><br><span class="line">                QPixmapCache::<span class="built_in">insert</span>(key, *<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">isNull</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isQBitmap</span>())</span><br><span class="line">            *<span class="keyword">this</span> = <span class="built_in">QBitmap</span>();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            data.<span class="built_in">reset</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>一看源码是不是就清晰多了。在 <code>load()</code>函数的实现中：①判断文件名是不是为空；②不为空时，首先就是读取文件的后缀。这里我们可以细细查一下第二个 <code>if</code> 判断中 <code>QString</code> 类型的 <code>key</code> 到底是进行了一个什么操作。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString key = <span class="built_in">QLatin1String</span>(<span class="string">&quot;qt_pixmap&quot;</span>)</span><br><span class="line">                    % info.<span class="built_in">absoluteFilePath</span>() <span class="comment">// 返回文件名的绝对路径</span></span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;uint&gt;(info.<span class="built_in">lastModified</span>().<span class="built_in">toSecsSinceEpoch</span>()) <span class="comment">// 返回文件最后一次修改的日期和时间</span></span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;quint64&gt;(info.<span class="built_in">size</span>()) <span class="comment">// 返回文件的大小</span></span><br><span class="line">                    % <span class="built_in">HexString</span>&lt;uint&gt;(data ? data-&gt;<span class="built_in">pixelType</span>() : QPlatformPixmap::PixmapType); <span class="comment">// 这里的data是成员变量，就是说如果设置了data的pixelType的值就读取，没设置的话就是默认值 QPlatformPixmap::PixmapType</span></span><br></pre></td></tr></table></figure><p>上述的 <code>HexString&lt;type&gt;</code>就是 ASCII 的数组形式，<code>16进制</code> 的数组。<u>上述代码中的 <code>%</code> 操作如果不是求余的话会是什么呢。如果是求余，<code>QString</code> 会报错才是呀？？？</u></p><p>这里最终还是通过设置和查看 <code>QPixmap</code> 的内置变量 <code>data</code> 中的标志去查看当前文件是不是图片，如果是图片，则会修改当前的 <code>QPixmap</code> 指针，如果不是就会返回 <mark style="background:red;">false</mark>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (QPixmapCache::<span class="built_in">find</span>(key, <span class="keyword">this</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>这里补充一个<code>QPixmapCache</code>的demo：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*在缓存中查找与给定键关联的缓存pixmap。如果找到了pixmap，函数将pixmap设置为该pixmap并返回true;否则，它将保留pixmap并返回false。*/</span></span><br><span class="line">QPixmap pm;</span><br><span class="line"><span class="keyword">if</span> (!QPixmapCache::<span class="built_in">find</span>(<span class="string">&quot;my_big_image&quot;</span>, &amp;pm)) &#123;</span><br><span class="line">    pm.<span class="built_in">load</span>(<span class="string">&quot;bigimage.png&quot;</span>);</span><br><span class="line">    QPixmapCache::<span class="built_in">insert</span>(<span class="string">&quot;my_big_image&quot;</span>, pm);</span><br><span class="line">&#125;</span><br><span class="line">painter-&gt;<span class="built_in">drawPixmap</span>(<span class="number">0</span>, <span class="number">0</span>, pm);</span><br></pre></td></tr></table></figure><p>最终判断当前文件是不是图片应该是在 <code>data-&gt;fromFile()</code> 中实现的。</p><p>这个<code>data</code>的定义：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QExplicitlySharedDataPointer&lt;QPlatformPixmap&gt; data;</span><br></pre></td></tr></table></figure><p><mark>未完成</mark>这篇文章还在编辑中</p><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><blockquote><p>补充一下</p><p><code>load()</code>的函数有必要读一下。</p><p> <code>QPixmap::loadFromData()</code> 的源码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    \fn bool QPixmap::loadFromData(const uchar *data, uint len, const char *format, Qt::ImageConversionFlags flags)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Loads a pixmap from the \a len first bytes of the given binary \a</span></span><br><span class="line"><span class="comment">    data.  Returns \c true if the pixmap was loaded successfully;</span></span><br><span class="line"><span class="comment">    otherwise invalidates the pixmap and returns \c false.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    The loader attempts to read the pixmap using the specified \a</span></span><br><span class="line"><span class="comment">    format. If the \a format is not specified (which is the default),</span></span><br><span class="line"><span class="comment">    the loader probes the file for a header to guess the file format.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    If the data needs to be modified to fit in a lower-resolution</span></span><br><span class="line"><span class="comment">    result (e.g. converting from 32-bit to 8-bit), use the \a flags to</span></span><br><span class="line"><span class="comment">    control the conversion.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    \sa load(), &#123;QPixmap#Reading and Writing Image Files&#125;&#123;Reading and</span></span><br><span class="line"><span class="comment">    Writing Image Files&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QPixmap::loadFromData</span><span class="params">(<span class="type">const</span> uchar *buf, uint len, <span class="type">const</span> <span class="type">char</span> *format, Qt::ImageConversionFlags flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span> || buf == <span class="number">0</span>) &#123;</span><br><span class="line">        data.<span class="built_in">reset</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = QPlatformPixmap::<span class="built_in">create</span>(<span class="number">0</span>, <span class="number">0</span>, QPlatformPixmap::PixmapType);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data-&gt;<span class="built_in">fromData</span>(buf, len, format, flags))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    data.<span class="built_in">reset</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片 </tag>
            
            <tag> Qt </tag>
            
            <tag> 格式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>png和jpg格式的图片(一)</title>
      <link href="/%E6%9D%82%E8%AE%B0/png%E5%92%8Cjpg%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87/"/>
      <url>/%E6%9D%82%E8%AE%B0/png%E5%92%8Cjpg%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="jpg-和-png-图片格式"><a href="#jpg-和-png-图片格式" class="headerlink" title="jpg 和 png 图片格式"></a><code>jpg</code> 和 <code>png</code> 图片格式</h1><p>在写这篇文章之前，笔者在编写一个简单的 Qt 程序时遇到了这样一个问题：</p><blockquote><p>问题：一个<code>png</code>格式的图片改成后缀为<code>jpg</code>格式的图片时，QLabel无法读取的问题。笔者是通过<code>setStyleSheet()</code>、<code>QImage</code>、<code>QPixmap</code>的接口均尝试过将改后缀后图片设置到<code>QLabel</code>中，均以<mark style="background-color:red">失败</mark>告终。</p></blockquote><p>特此研究了一下这<code>jpg</code>和<code>png</code>两者之间的区别，后续再研究一下Qt关于相关格式图片读取的问题。</p><p>图片会有<code>jpg</code>和<code>png</code>两种格式，那么这俩种格式的图片又有着什么样的区别呢？下面就给大家分享一下。 <code>png</code>和<code>jpg</code>都是常用的图片格式，其中<code>png</code>属于无损压缩，<code>jpg</code>是有损压缩，使用中两者最明显的一个区别是:</p><ul><li>png支持透明通道</li><li>jpg的图片更适合在网络中传播和使用。</li></ul><h2 id="jpg格式"><a href="#jpg格式" class="headerlink" title="jpg格式"></a><code>jpg</code>格式</h2><blockquote><p><strong>jpg：</strong>是JPEG标准的产物，也是目前网络最为流行的图片格式，jpg格式的图片可以将图像文件压缩到最小格式，在高度压缩率的同时，可以展现是分丰富生动的图像，但是随着压缩比的增大，图片的品质会逐渐降低的。我们现在常用的jpg的标准全程为<code>JPEG 2000标准</code>，有以下几点特性：</p><ol><li>高压缩率</li><li>无损压缩和有损压缩</li><li>渐进传输</li><li>感兴趣区域压缩</li><li>码流的随机访问和处理</li><li>容错性</li><li>基于内容的描述</li></ol></blockquote><h2 id="png格式"><a href="#png格式" class="headerlink" title="png格式"></a><code>png</code>格式</h2><blockquote><p><strong>png：</strong>是一种采用无损压缩算法的位图模式，其设计目的是视图替代GIF和TIFF文件格式，同时增加一下GIF文件格式所不具备的特性。PNG使用从LZ77派生的无损数据压缩算法，一般应用于JAVA程序、网页或S60程序中，原因就是因为png的压缩比更高，生成文件体积小。png图片也有一些特性：</p><ol><li>体积小</li><li>无损压缩</li><li>索引彩色模式</li><li>更优化的网络传输显示</li><li><strong>支持透明模式</strong></li></ol></blockquote><p>关于 <code>png</code> 格式还需要说明的是：</p><p>png格式有8位、24位、32位三种形式，其中8位PNG支持两种不同的透明形式（索引透明和alpha透明），24位PNG不支持透明，32位PNG在24位基础上增加了8位透明通道，因此可展现256级透明程度。</p><p>PNG8和PNG24后面的数字则是代表这种PNG格式最多可以索引和存储的颜色值。8代表2的8次方也就是256色，而24则代表2的24次方大概有1600多万色。</p><h1 id="区别：png-和-jpg"><a href="#区别：png-和-jpg" class="headerlink" title="区别：png 和 jpg"></a>区别：<code>png</code> 和 <code>jpg</code></h1><blockquote><p>转自百度百科：</p><p>1、<a href="https://baike.baidu.com/item/JPEG">JPEG</a>可以对照片（或类似）图像生成更小的文件，这是由于JPEG采用了一种针对照片图像的特定有损编码方法，这种编码适用于低对比，图像颜色过渡平滑，噪声多，且结构不规则的情况下。如果在这种情况下用PNG代替JPEG，文件尺寸增大很多，而图像质量的提高有限。相应的，如果保存文本，线条或类似的边缘清晰，有大块相同颜色区域的图像，PNG格式的压缩效果就要比JPEG好很多，并且不会出现JPEG那样的高对比度区域的图像有损。如果图像既有清晰边缘，又有照片图像的特点，就在在这两种格式之间权衡一下了。JPEG不支持透明度。</p><p>2、由于JPEG是有损压缩，会产生迭代有损，在重复压缩和解码的过程中会不断丢失信息使图像质量下降。由于PNG是无损的，保存将要被编辑的图像来说更加合适。虽然PNG压缩照片图像也有效，但有专门针对照片图像设计的无损压缩格式，比如无损JPEG2000，Adobe DNG等。总的来说这些格式都不能做到适用所有图像。对于将要发布的图像可以保存成JPEG，用JPEG编码一次不会造成明显的图像有损。</p></blockquote><p>总结就是：</p><ol><li><code>jpg</code>格式的图片能在高度压缩率的同时，展现十分丰富生动的图像，但是随着压缩比的增大，图片的品质会逐渐降低的。而<code>png</code>图片的特性就是体积小，节约空间，与<code>jpg</code>图片相比，<code>png</code>图片时无损压缩，在不损失图片数据的情况下，可以快速的获取自己想要的图片，而且图片的质量并不会下降。</li><li><code>png</code>格式的图片可以编辑，比如图片中的字体、线条等，可以通过ps等软件更改。但是<code>jpg</code>格式的图片则不可以更改，<code>png</code>与<code>jpg</code>图片相比<code>png</code>格式的图片更大。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片 </tag>
            
            <tag> 格式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中国马克思主义科学技术观</title>
      <link href="/%E6%9D%82%E8%AE%B0/%E4%B8%AD%E5%9B%BD%E9%A9%AC%E5%85%8B%E6%80%9D%E4%B8%BB%E4%B9%89%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%E8%A7%82/"/>
      <url>/%E6%9D%82%E8%AE%B0/%E4%B8%AD%E5%9B%BD%E9%A9%AC%E5%85%8B%E6%80%9D%E4%B8%BB%E4%B9%89%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%E8%A7%82/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="第四章、科学技术社会论"><a href="#第四章、科学技术社会论" class="headerlink" title="第四章、科学技术社会论"></a>第四章、科学技术社会论</h1><h2 id="1-为什么说“科学是一种在历史上起推动作用的、革命的力量”？"><a href="#1-为什么说“科学是一种在历史上起推动作用的、革命的力量”？" class="headerlink" title="1. 为什么说“科学是一种在历史上起推动作用的、革命的力量”？"></a>1. 为什么说“科学是一种在历史上起推动作用的、革命的力量”？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;科学技术是历史发展的火车头，改变了社会历史进程，造就了新的社会形态;推动了生产力内部各要素的变革，引发了产业结构的调整、经济形式的变化和经济增长方式的转变，造就了经济转型;产生了技术异化现象，要对异化的资本主义制度展开批判，更好地发挥科学技术的社会功能。<br>&amp;nbsp;&amp;nbsp;科学技术作为社会发展的动力,是马克思主义的基木观点。科学是生产力的“知识的形态”。作为生产力的科学技术，能够大大提高社会生产力水平，推动着整个人类物质生产的迅猛发展。<br>&amp;nbsp;&amp;nbsp;作为强大的精神力量的科学技术，能够促进人类思想的解放，在产业革命的基础上，推动社会变革，对社会生产关系产生有力影响。<br>&amp;nbsp;&amp;nbsp;作为人类最终走向白由的科学技术，能够作为解放的杠杆，增进人类精神生活的丰富性和自我发展能力，有助于实现人的全面自由的发展。</p></blockquote><h2 id="2-如何看待科学技术对人的异化和对自然的异化？"><a href="#2-如何看待科学技术对人的异化和对自然的异化？" class="headerlink" title="2. 如何看待科学技术对人的异化和对自然的异化？"></a>2. 如何看待科学技术对人的异化和对自然的异化？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;科技异化实质上是在资本主义制度下劳动异化和人的异化一种必然结果。由于劳动是人的最根本最现实的实践活动，是人及人类社会存在的根本方式，劳动的异化必然带来人的其他社会活动和社会关系的全面异化，科学技术也不例外，因为“宗教、家庭、国家、法、道德、科学、艺术等等，都不过是生产的一些特殊的方式，并且受生产的普遍规律的支配。”</p><p>&amp;nbsp;&amp;nbsp;因此，科学技术作为劳动亦即人处理自身与自然界关系的社会活动的产物，也必然随着资本主义社会劳动的异化而表现出异化的现象。最根本的是要消灭对科学技术的资本主义利用方式，把现代科学技术从资本主义制度下解放出来。也就是说只有通过无产阶级革命来最终解决资本主义的科技异化问题。当然，在马克思看来，异化的完全克服只有在共产主义社会制度中才能最终实现。</p></blockquote><h2 id="3-科学技术的社会体制和组织机构对科学技术的发展有何意义？"><a href="#3-科学技术的社会体制和组织机构对科学技术的发展有何意义？" class="headerlink" title="3. 科学技术的社会体制和组织机构对科学技术的发展有何意义？"></a>3. 科学技术的社会体制和组织机构对科学技术的发展有何意义？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;科学技术的社会建制有一个历史过程。经济支持制度、法律保障体系等科学技术体制是根本，各种组织机构及其科研组织运行是保证，科学技术的伦理规范是导引。在科学技术发展应用的新阶段，科学技术的社会建制呈现出一些新特点，因此必须进行科学技术体制改革，以保证科学技术的良好运行。<br>&amp;nbsp;&amp;nbsp;作为社会建制的科学技术体制是在一定社会价值观念支配下，依据相应的物质设备条件形成的一种社会组织制度，旨在支持推动人类对自然的认识和利用。科学技术的体制化以相应的职业化为核心，其内涵随着科学技术的发展而不断拓展和丰富。科学技术的社会体制包括:组织领导体制、经济支持制度、法律保障体制、交流与传播体制、人才教育培养制度等。科学技术与其他各种事业密切相关,需要建立相应的组织机构以保证科学技术活动的顺利进行。科学技术组织机构随着历史的演化而变化，具有各白的特点和功能，是实现科学技术现代化的组织保证。在科学技术社会史上形成与发展起来的组织机构有:科学技术决策、管理与咨询机构，科学技术活动组织机构，科学技术传播机构，科学技术人才培养机构。</p><hr><p>【以下摘白百度贴吧帖子“科学技术的社会体制化及其对科学发展的意义”】<br>科学技术体制化的内容包括:科学技术的投入体制、科技研究的结构比例、科学技术的法律制度、科技研究的管理体制。<br>科学技术的社会体制化对科学发展的意义:1、它可以积聚社会上的力量来进行柑应的科学研究;2、当代科技活动的结构中基础研究将会有大量的人员参l与j;3、明确的法律以及管理制度将会更进一步促进科学技术的发展。</p></blockquote><h2 id="4-为什么要对科学技术工作者进行伦理规范？"><a href="#4-为什么要对科学技术工作者进行伦理规范？" class="headerlink" title="4. 为什么要对科学技术工作者进行伦理规范？"></a>4. 为什么要对科学技术工作者进行伦理规范？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;科学技术活动与人类其他活动一样，建立在诚信和道德的基础上。现阶段，默顿的科学的精神气质受到挑战，科学技术工作者有失范行为，需要制定相关科研诚信指南和工程师伦理准则加以规范。科学工作者进行科学研究和医学实践，尤其是进行人体实验和动物实验，应该遵循社会伦理、生命伦理、动物伦理等。技术工作者，尤其是工程师，在工程技术活动中，应该遵循一定的职业伦理和社会伦理准则，应该承担对社会、专业、雇主和同事的责任，应该对工程的环境影响负有特别的责任，规范白己的行为，为人类福祉和环境保护服务。</p></blockquote><h2 id="5-如何理解科学技术文化与人文文化之间的冲突与协调？"><a href="#5-如何理解科学技术文化与人文文化之间的冲突与协调？" class="headerlink" title="5. 如何理解科学技术文化与人文文化之间的冲突与协调？"></a>5. 如何理解科学技术文化与人文文化之间的冲突与协调？</h2><blockquote><p>(一）社会文化对科学技术的影响<br>&amp;nbsp;&amp;nbsp;科学技术的产生和发展需要一定的社会文化环境。社会文化与科学技术文化紧密关联，并由此影响科学技术的发展及其应用。默顿在《十七世纪英格兰的科学、技术与社会》中提出的“清教主义促进英国近代科学的制度变化”，以及“李约瑟难题”——“近代科学为什么没有在中国诞生”的解答，就说明了这一点。</p><p>(二）科学文化与人文文化的协调<br>&amp;nbsp;&amp;nbsp;1．要防止科学在生活世界、自然世界对人文的僭越所造成的科学文化与人文文化之间的冲突，深刻理解科学的限度，用正确的人文理念指导我们的生活。<br>&amp;nbsp;&amp;nbsp;2．必须以社会先进文化来引领科学技术文化，使科学技术发展和应用为经济社会健康全面发展服务。得到广泛提倡的环境科学技术就是为了协调人与自然之间的关系所做的努力，是科学技术文化与人文文化——绿色文化的良性互动产物。</p></blockquote><h2 id="6-科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？"><a href="#6-科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？" class="headerlink" title="6. 科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？"></a>6. 科学技术的风险有哪些？如何恰当地进行科学技术风险评价与决策？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;科学技术的风险包括环境风险、政治风险、经济风险、健康风险和伦理风险等。这些风险会引发一系列争论，造成评价和决策上的困难。习近平指出:“要加快建立科技咨询支撑行政决策的科技决策机制，加强科技决策咨询系统，建设高水平科技智库。要加快推进重大科技决策制度化，解决好实际存在的部门领导拍脑袋、科技专家看颜色行事等问题。”</p><p> 要恰当进行科学技术风险评价与决策，就应该全面评价科学技术风险—收益的多个方面，批判性地考察“内部”存有争议的科学知识或技术知识，分析相互竞争的利益集团和社会结构的”外部”政治学，理解科学技术专家知识和决策的局限性、公众理解科学的必要性以及外行知识的优势，明确政府、科学技术专家以及公众在与科学技术风险相关的公共决策中的不同作用，确立公众参与决策的可能方式，从而形成最优化的科学技术公共政策模式，以达到对科学技术风险社会有效治理的目的。</p></blockquote><h1 id="第五章、中国马克思主义科学技术观"><a href="#第五章、中国马克思主义科学技术观" class="headerlink" title="第五章、中国马克思主义科学技术观"></a>第五章、中国马克思主义科学技术观</h1><h2 id="1-为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？"><a href="#1-为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？" class="headerlink" title="1. 为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？"></a>1. 为什么说新时代中国马克思主义科学技术是一个科学、完整的思想理论体系？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;毛泽东、邓小平、……、胡锦涛、习近平的科学技术思想，是在中国共产党领导我国科学技术事业发展和进行社会主义现代化建设的伟大时间中，逐渐形成、发展和完善的。</p><p>&amp;nbsp;&amp;nbsp;中国马克思主义科学技术观是基于马克思、恩格斯的科学技术思想，对当代科学技术机器发展规律的概括和总结，是马克思主义科学技术论的重要组成部分。</p><p>&amp;nbsp;&amp;nbsp;中国马克思主义科学技术观是中国共产党人集体智慧的结晶，是对毛泽东、邓小平、……、习近平科学技术思想的概括和总结，是他们科学技术思想的理论升华和飞跃，是他们科学技术思想的凝练和精髓。</p><p>&amp;nbsp;&amp;nbsp;中国马克思主义科学技术观的内容丰富，涉及了科学技术的功能、目标、机制、战略、人才和方针等重大问题，是一个科学、完整的思想理论体系。</p></blockquote><h2 id="2-如何理解中国马克思主义科学技术观的理论精髓？"><a href="#2-如何理解中国马克思主义科学技术观的理论精髓？" class="headerlink" title="2. 如何理解中国马克思主义科学技术观的理论精髓？"></a>2. 如何理解中国马克思主义科学技术观的理论精髓？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;中国马克思主义科学技术观概括和总结了毛泽东、邓小平、···、习近平等的科学技术思想，包括科学技术的功能观、战略观、人才观、和谐观和创新观的基木内容，体现出时代性、实践性、科学性、创新性、自主性、人本性等特征，建设中国特色的创新型国家，是中国马克思主义科学技术观的具体体现。中国马克思主义科学技术观，是马克思主义科学技术观与中国具体科学技术实践相结合的产物，是马克思主义科学技术论的重要组成部分。</p></blockquote><h2 id="3-如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？"><a href="#3-如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？" class="headerlink" title="3. 如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？"></a>3. 如何理解习近平新时代中国特色社会主义思想中的科学技术观的时代意义？</h2><blockquote><p>&amp;nbsp;&amp;nbsp;中国马克思主义科学技术观的三个历史阶段是其各自所处的历史条件所决定的，是对时代背景实事求是的反映，因此科学技术思想都镌刻了时代的烙印，反映了时代的需求。</p><p>&amp;nbsp;&amp;nbsp;习近平新时代中国特色社会主义思想中的科学技术观，是在中国特色社会主义进入新时代的历史条件下形成的。新时代之“新”，一是在于我们进入了一个新的发展阶段，发展环境、发展条件都发生了新的变化，目标任务也发生了新的变化;二是在于我们面临着新的社会主义主要矛盾;三是我们迈向新的奋斗目标。正是基于这一新时代的”新”特征时代背景，习近平立足于我贵哦科学技术与社会发展的现实需要，提出了一系列关于科学技术发展的理论观点，形成了习近平新时代中国特色社会主义科学技术观。</p></blockquote><p>参考链接：</p><p><a href="http://www.doczj.com/doc/6110418199-11.html">2019自然辩证法课后思考题及答案_文档之家</a></p>]]></content>
      
      
      <categories>
          
          <category> 杂记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>释怀</title>
      <link href="/%E6%97%A5%E8%AE%B0/%E9%87%8A%E6%80%80/"/>
      <url>/%E6%97%A5%E8%AE%B0/%E9%87%8A%E6%80%80/</url>
      
        <content type="html"><![CDATA[<p>真正的成熟，大概就是，喜欢的东西还是喜欢，只是不再强求拥有了，害怕的东西还是害怕，只是敢于面对了。</p><p>成长的意义就在于，总有一天，我们要学会坦然面对生命中所有突如其来的境遇。</p><p>有的人离开，有的人走来，有的人重逢，有的人再也不见。</p><p>太阳照常升起，草木岁岁枯荣。</p><p>所有的舍不得，所有的无奈，都有释怀的一天。</p><p>你一个人，过得好吗？努力生活，就是答案。</p><p>人这一辈子，有人羡慕你，有人看不起你，有人误会你，有人讨厌你，也有人嫉妒你，不要在乎别人怎么看你。</p><p>一定要告诉自己，身体是自己的，一定要爱惜，心情也是自己的，一定要顾及，不要为了那些不值得的人和事为难自己。</p><p>把身体养好，叫体质，把心情调好，叫格局，把日子过好，叫本事。</p><p>现在这个社会，当面一套背后一套，口是心非的人多了去了，所以做好自己就行，剩下的交给良心！</p><p>有些东西，得之我幸，失之我命，选择放下，不是为了原谅别人，只是为了放过自己。</p><p>记得有人说过，一个人首先要爱自己，才有能力爱别人。</p>]]></content>
      
      
      <categories>
          
          <category> 日记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>灵魂</title>
      <link href="/%E6%97%A5%E8%AE%B0/%E7%81%B5%E9%AD%82/"/>
      <url>/%E6%97%A5%E8%AE%B0/%E7%81%B5%E9%AD%82/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="d1955ce545a181f79482f3a3906952a96712b5c89f0c11663f08e70c085728b9">411319705e21b53bb2f6c15c89490a4bd99c949e9cc067890e4786115d9455c9a9c938b70cf42818108866b63a3f2427e938731ea75f4e57749450f67d78e1d03760dc8c272a554c59fdff38ea2a654d7e178f84e81a67c7d3f6849b4b5d1dd47c521d48ed7f98a4999357d031a90fd7b5c76a3036e65f9de2988ae6982eb66ec5df782c8c7f2de0edd7d4a839e00344db9ff754f6b075e9da22f78935932493eb0d7a842a475c62518fcfdcfb86cfa44ca51017e7f00529f5afb69d6a9403d3f5eafe819952213e9b70f72686badd3b827464f499acf18f923209cd4f292db505afea1dd7f5fee8aed3eb6a26282a2574f1b3d19b33db2af20715ea9f511dab29348b02cb57b51a36e924920626adaf5e5a3eb736c6f48a79627d06fd1cb8716a092723741c2db5b5a22ac3c3a4a717687e9e2e96b40c90f6424f4479c2958c0dbfb2a12e7de5a29e8f4654834ac836beb54e065720571c2048a442f5a24d80644db38f2c0045decd9d8496df0ab91abeaa77fe275eced851b7b9cb7248f5c1db078afa9c5973833fa9b606a9938e212417b7303be61ef28811b947d4e39fe57ac8048b0111c3255230a34e19aeba8052b6b7a732718a995dc1f4d4e7d446f7f36a4ad1ecc027ae4707118ce05589badcd01015d4bd94446d96edf7bc7f8f686d62f0ceb838b42188c6300a711021406b80b0d36176e443207b4eaf0bccca0f5ab25b017a21d65fad5da89f2f3eeea88d38a0f1c314533d1e445d21328990f2e35a6101824057b9504a468b35d7e4a5a86db89ddd6046762c4f8546ea37213aa27fb413ca9add077c029459ddbac8c2979094d05ff061b4c82c2fc825749f89931e273f313b4df54b94ffa9e75debf5fb86cce7808b02469dd156eff9aaa95b19976ab9e4cd7179518e48c566fd58beb2744917d6925af8e0f77a81b13a3e32297e1ab3e2c4569ee5810b911105d500890a1bb6cf30d555015d15fba094ac1954924f7481ce3878ac54729f6f5446c65d71312337e07853243f5593476a7760370b846ca0b1b68f3ed47f4806b9d27583dc9230735c42ee0e84c9bdcd749b1c38c3ddb7c01b8ec95bedb728b119e46580a68a3f713371e0e41a85b7f413556d0b44fb7fd64085f18e719b8bd78fd39acf1903d614596991700edf77ad7e558975d9b06bec9228c4fcd8f5f929bfc8e682496207e789daf461e46a31709e228765c7ef56c40a5f069ef4692d0a7b54a56425d0d239db7792b08bb6156312c2b9561f81cf42005ee888c97ded151c9794d3fd4b4d11148221b6c8795c5980c86aa5b6ed722d2a19496b6f068466a07ffe65463ed95483aa88947ddede577dfd5259d57de823716894600cf0963ecbea2f0eef5184d615cdfa5fc1cde58f6ad216e9a3feedd43cb4165006e37ed5244bd2a8611d516abfd2ce0ced0f29debe96642ac1ab4430da9b17ee350c9902b338a46f3c9de90ee440bbe8909a734e57c86bfb2e8fbde3f29da01392b36b5581ce0d1555c46cf590188f9bd4420f013c2e52893da28fa8f579163b3136618eb06c64e75e5e080bf3f3bc268dd3bef07534642722a86205253e14b59d56c5f585870c5b650c9032baf67f3590fe4a130914fd203feb38648155fa60b06277136f7f7527f36a1d38d488d93828164acdb4f2db7f143a1bb6c739df00bdbb242b25c8083dd3299c8710a1baae8486f3f97431bef2e123b6d1eda949f6ffe704a63f1055bbc48fd97f31a6e6c82158be80bbd3c7ee4409d0ea9b5d1a3f3dde1ac63393f4dc550c433c4bd1eb0952cf1b2f377ca10eaa8c2ed724be1d2aecdf2ce5a77430b217774d72024d449a64ad6a0404c1acf6f08684a8897d25f6ff254d83d689334e8fdb081a20b0a4fe81a6a332ac489974811879f4e8a03922701e639e331f5a15cc490c7d2e2477a0936b00ffaa53a5b99d2204724f28fa011bd0d1357f99132fe4e30f7a1cbb09d05414a1f6c843b73e6a229d4b52c5a62de76f621c028d81b8b73a90cbc1590128f26e107b34740ad17f123efbb3b51fade0d5e28889390e4f70a92c149cb7275aecd85dc7fe895df7aad0320511a8b88aff9d26bb9e79f5d83f9fad45b59a01a856cfd52c1bc87a58f651ae6406ccb2e7065f67649cfe16c112d42dd9855d1d6df2eec0388852ee8598cebe131968f259c6a88584b5bbf79d7dba1db82b2e0e7c12de8b9553a9864322d89a37dc9a914617a479cbeba95f808062acda355e1cfeb44d22f0e8da8fd8174df8c8e86817ef03958169855790ee9d8b912e2fb46b9a988fa4c4e41b2bf216c805551265ec67d946144d7f4309786d0261ce22a6ecd8634eb19011dac46315d97b6cbff239b8cdf61548ec3b4c07f619453763bb8d11078048eeb0b385a7c603ec819a016943b3b5f42b4436b925fb1e6319fce0c52cc3f6c05420f3ed98a8e4ce24857f16f82d64b7bf3f28b53fe08d9afd60a883c957d9eb410d832c1278dd88b210d2b84334aaa6d0d55f850e721b9b881c77a4494c2b9ccd8f93a5b6e30d8ae29c9cdb6b35935fb852e90adc169dcb7c3b60e856ed3b614a30a492a440dc4c4c1e6c861da41f24bea39f747ed7a60c44d375e42a30ee3b850e5feae03236e23c3094c97637c46ce089f992</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 日记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常见排序算法整理（C++)</title>
      <link href="/%E6%97%A5%E8%AE%B0/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
      <url>/%E6%97%A5%E8%AE%B0/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Welcome to GDB Online.</span></span><br><span class="line"><span class="comment">GDB online is an online compiler and debugger tool for C, C++, Python, Java, PHP, Ruby, Perl,</span></span><br><span class="line"><span class="comment">C#, OCaml, VB, Swift, Pascal, Fortran, Haskell, Objective-C, Assembly, HTML, CSS, JS, SQLite, Prolog.</span></span><br><span class="line"><span class="comment">Code, Compile, Run and Debug online from anywhere in world.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 左闭右闭区间</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getRand</span><span class="params">(<span class="type">int</span> min, <span class="type">int</span> max)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ( <span class="built_in">rand</span>() % (max - min + <span class="number">1</span>) ) + min ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quickSort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> start, <span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start &gt; end)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="type">int</span> i = start, j = end;</span><br><span class="line">    <span class="type">int</span> key = nums[start];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; nums[j] &lt; key)</span><br><span class="line">            j--;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; nums[i] &gt;= key)</span><br><span class="line">            i++;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span>(i&lt;j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">swap</span>(nums[i],nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">swap</span>(nums[i], nums[start]);</span><br><span class="line">    <span class="built_in">quickSort</span>(nums, start, i<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">quickSort</span>(nums, i+<span class="number">1</span>, end);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sort</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp; nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.<span class="built_in">empty</span>() || nums.<span class="built_in">size</span>() &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quickSort</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; nums;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        nums.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(<span class="built_in">getRand</span>(<span class="number">0</span>,<span class="number">100</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sort</span>(nums);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it : nums)</span><br><span class="line">        cout &lt;&lt; it &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日记 </category>
          
          <category> 刷题记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
            <tag> 快速排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 命令脚本</title>
      <link href="/%E6%89%8B%E5%86%8C/%E8%84%9A%E6%9C%AC/linux%E5%91%BD%E4%BB%A4%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC%E6%95%B4%E7%90%86/"/>
      <url>/%E6%89%8B%E5%86%8C/%E8%84%9A%E6%9C%AC/linux%E5%91%BD%E4%BB%A4%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="ll-awk-获取文件markdown链接"><a href="#ll-awk-获取文件markdown链接" class="headerlink" title="ll + awk 获取文件markdown链接"></a><code>ll + awk</code> 获取文件markdown链接</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll | awk <span class="string">&#x27;&#123;print &quot;[&quot;$9&quot;](./&quot;$9&quot;readme.md)&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 脚本 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/%E6%89%8B%E5%86%8C/%E6%89%80%E8%A7%81%E5%8D%B3%E6%89%80%E5%BE%97_Typora%E5%8F%8A%E7%94%A8%E6%B3%95/"/>
      <url>/%E6%89%8B%E5%86%8C/%E6%89%80%E8%A7%81%E5%8D%B3%E6%89%80%E5%BE%97_Typora%E5%8F%8A%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdown介绍"><a href="#Markdown介绍" class="headerlink" title="Markdown介绍"></a>Markdown介绍</h1><p><i class="fa fa-quote-left fa-3x fa-pull-left fa-border" aria-hidden="true"></i><code>Markdown</code>是一种可以使用普通文本编辑器编写的标记语言，通过简单的标记语法，它可以使普通文本内容具有一定的格式。<br> <code>Markdown</code>语法的目标是：成为一种适用于网络的书写语言「易读易写」。并且<code>Markdown</code>兼容HTML。你可以使用HTML语言编写Markdown，如果你要部署你的个人博客，那这更是你必不可少的技能之一！！！</p><p><strong>强烈推荐typora这款markdown软件，谁用谁说好！</strong></p><p><font color=green face="华文彩云" size=5px>一款优质的Markdown编辑器,不仅仅是Markdown</font></p><p>除此之外，如果你愿意花一点点时间来了解{ post_link }</p><hr><h1 id="简述Markdown常见用法"><a href="#简述Markdown常见用法" class="headerlink" title="简述Markdown常见用法"></a>简述Markdown常见用法</h1><p>在下面，我将简单介绍几个常用的<code>markdown</code>写法。希望大家写出更好的观看效果的文章。本文一些内容是属于Hexo下buttrerfly主题的内置标签。</p><hr><p>大家可以自己下载<a href="https://typora.io/">Typora</a>尝试一下<code>markdown</code>。</p><iframe src="https://typora.io/" cols="50%,50%" heigth=500px width=100% style="width:100%;height:500px;scroll-x:auto;"></iframe><p>为什么推荐<mark>Typora</mark>,我归纳了以下几点：</p><p><font style="font-size:20px;font-weight:900;color:green;font-family:'华文彩云'">一</font> “所见即所得”（即时渲染）</p><p><font style="font-size:20px;font-weight:900;color:green;font-family:'华文彩云'">二</font> 支持图床功能，配合PicGO可以实现图片的随用随传</p><p><img src="https://tva3.sinaimg.cn/large/0072YHp3ly1gk9x8gmzdlj30v904ddg1.jpg" alt="Markdown"></p><p>如下所示，右击图片就可以上传到PicGo指定的图床。真的很好用！！！<img src="https://tva4.sinaimg.cn/large/0072YHp3ly1gk9x9cn79xj30v705jq3r.jpg" alt="Markdown" width="1123" data-width="1123" data-height="199"></p><p><font style="font-size:20px;font-weight:900;color:green;font-family:'华文彩云'">三</font> Typora还支持将<code>md文件</code>导出为多种格式的文件，目前支持以下文件:</p><img src="https://tva1.sinaimg.cn/large/0072YHp3ly1gk9x4ku3rqj304u09iq2u.jpg" alt="Markdown" width="174" data-width="174" data-height="342"><p><font style="font-size:20px;font-weight:900;color:green;font-family:'华文彩云'">四</font> 如果你还会一点CSS,那你甚至可以自定义界面样式</p><p><img src="https://tva4.sinaimg.cn/large/0072YHp3ly1gk9xloodttj306i0d1gls.jpg" alt="Markdown"></p><p><big>下面我将从以下这几个方面介绍一下Typora的一些使用方法：</big></p><ul><li><a href="#%E5%AD%97%E4%BD%93">字体</a>             <code> （&lt;small&gt;小&lt;/small&gt;     &lt;big&gt;大&lt;/big&gt;）</code></li><li><a href="#%E6%96%9C%E4%BD%93">斜体</a>                    <code> *斜体*</code></li><li><a href="#%E5%8A%A0%E7%B2%97">粗体</a>                   <code> **粗体**</code></li><li><a href="#%E6%96%9C%E4%BD%93%E5%8A%A0%E7%B2%97">斜体 + 粗体</a>          <code> ***斜体+粗体\***</code></li><li><a href="#%E5%88%A0%E9%99%A4">删除</a>                  <code>~~原价：99.9元~~</code></li><li><a href="#%E9%93%BE%E6%8E%A5">链接</a>               <code>[http://www.jianshu.com](https://www.jianshu.com)</code></li><li><a href="#%E5%88%86%E5%89%B2%E7%BA%BF">分割线</a></li><li><a href="#%E4%B8%8B%E5%88%92%E7%BA%BF">下划线</a></li><li><a href="#%E6%A0%87%E9%A2%98">标题</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8">任务列表</a></li><li><a href="#%E5%9B%BE%E7%89%87">图片</a></li><li><a href="#%E5%8C%BA%E5%9D%97%E5%BC%95%E7%94%A8">区块引用</a></li><li><a href="#%E8%A1%8C%E5%86%85%E4%BB%A3%E7%A0%81">行内代码</a>    `markdown`</li><li><a href="#%E5%88%97%E8%A1%A8">列表</a></li><li><a href="#%E8%A1%A8%E6%A0%BC">表格</a></li><li><a href="#%E8%84%9A%E6%B3%A8">脚注</a></li><li><a href="#%E9%AB%98%E4%BA%AE%3Cmark%3E">高亮</a></li></ul><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><!--tab 格式 --><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">small</span>&gt;</span></span>小号字体<span class="language-xml"><span class="tag">&lt;/<span class="name">small</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">big</span>&gt;</span></span>大号字体<span class="language-xml"><span class="tag">&lt;/<span class="name">big</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">rgb(25,26,35)</span> <span class="attr">face</span>=<span class="string">&quot;华文彩云&quot;</span> <span class="attr">size</span>=<span class="string">100px</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span></span>其他快捷方式<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><table><thead><tr><th>属性</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>color</td><td>rgb();<br>#XXXXXX<br>colorname</td><td>规定文本的颜色，可以使用<code>style</code>代替</td></tr><tr><td>face</td><td>font_family</td><td>规定文本的字体</td></tr><tr><td>size</td><td>number</td><td>规定文本的大小</td></tr></tbody></table><p><small>小号字体</small></p><p><big>大号字体</big></p><div style="text-align:center;"><font color=rgb(25,26,35) face="华文彩云" size=100px style="text-align:center">其他快捷方式</font></div><h2 id="斜体"><a href="#斜体" class="headerlink" title="斜体"></a>斜体</h2><p>西方斜体这一习惯看个人喜好吧。在文字前后各加一个<code>*</code>就👌了</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="emphasis">*斜体*</span></span><br></pre></td></tr></table></figure><p> 效果如下：<br><em>斜体</em></p><h2 id="加粗"><a href="#加粗" class="headerlink" title="加粗"></a>加粗</h2><p>在文字前后各加两个<code>**</code>就👌了</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**加粗**</span></span><br></pre></td></tr></table></figure><p>效果如下：<br> <strong>加粗</strong></p><h2 id="斜体加粗"><a href="#斜体加粗" class="headerlink" title="斜体加粗"></a>斜体加粗</h2><p>斜体文字前后各加<code>*</code>，加粗文字前后各加<code>**</code>，斜体加粗在文字前后加<code>***</code>。没毛病…</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**<span class="emphasis">*斜体加粗*</span>**</span></span><br></pre></td></tr></table></figure><p>效果如下:<br> <em><strong>斜体加粗</strong></em></p><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~~content~~</span><br></pre></td></tr></table></figure><p> 效果如下：<br><del>content</del></p><h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>链接应该是使用最多的场景了。他人有好的文字或者自己摘自哪里、都可以传送门直接过去。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">网站名</span>](<span class="link">地址</span>)</span><br><span class="line">地址</span><br></pre></td></tr></table></figure><p> 效果如下：<br><a href="mailto:example@163.com">example@163.com</a><br><a href="http://www.baidu.com/">http://www.baidu.com</a></p><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 <span class="strong">****</span></span><br><span class="line">2 <span class="strong">****</span>*</span><br><span class="line">3 ---</span><br><span class="line">以上三种写法都可以，效果一样，看个人心情使用。</span><br></pre></td></tr></table></figure><hr><hr><hr><h2 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>内容<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><u>内容</u></p><h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 一级标题</span></span><br><span class="line">···</span><br><span class="line"><span class="section">###### 六级标题 //最多支持六级标题</span></span><br></pre></td></tr></table></figure><p>效果如下：</p><p><font size=10px style="font-weight:700">一级标题</font></p><p><font size=3px style="font-weight:600">六级标题</font></p><h2 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a>任务列表</h2><p>格式：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet"> -</span> [] 待完成</span><br><span class="line"><span class="bullet">-</span> [X] 已完成</span><br></pre></td></tr></table></figure><p>效果如下：</p><ul><li><input disabled="" type="checkbox"> 待完成</li><li><input checked="" disabled="" type="checkbox"> 已完成</li></ul><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>格式为<code>![]()</code></p><p>其中图片名称可以为空。直接输入[]就可以。下面我的<code>url</code>输入的直接就文字url。所以肯定是空图片啦。Typora也可以直接把电脑本地的图片拖进来，自动生成图片链接。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">图片名</span>](<span class="link">URL</span>)</span><br></pre></td></tr></table></figure><h2 id="区块引用"><a href="#区块引用" class="headerlink" title="区块引用"></a>区块引用</h2><p>代码块，使用’`‘和<code>~</code>都可以</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">```</span></span><br><span class="line"><span class="code">代码</span></span><br><span class="line"><span class="code">```</span></span><br></pre></td></tr></table></figure><p>效果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">代码</span><br></pre></td></tr></table></figure><h2 id="行内代码"><a href="#行内代码" class="headerlink" title="行内代码"></a>行内代码</h2><p>程序猿引用代码，或者是文章中有一些关键性的名词啊，或者为了突出醒目。效果不错。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`printf(&quot;test&quot;)`</span></span><br></pre></td></tr></table></figure><p>效果如下：<br> <code>printf(&quot;test”);</code></p><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 无序项目1</span><br><span class="line"><span class="bullet">*</span> 无序项目2</span><br><span class="line"><span class="bullet">+</span> 无序项目3</span><br><span class="line"><span class="bullet">-</span> 无序二级1</span><br><span class="line"><span class="bullet">-</span> 无序二级2</span><br><span class="line"><span class="bullet">1.</span> 有序标题</span><br><span class="line"><span class="bullet">1.</span> 无序二级标题</span><br></pre></td></tr></table></figure><ul><li>无序项目1</li></ul><ul><li>无序项目2</li></ul><ul><li>无序项目3<ul><li>无序二级1</li><li>无序二级2</li></ul></li></ul><ol><li><p>有序标题</p><ol><li>无序二级标题</li></ol></li></ol><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p><kbd>ctrl+t</kbd>更方便</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| 第一格表头                       | 第二格表头             |</span><br><span class="line">| -------------------------------- | ---------------------- |</span><br><span class="line">| 内容单元格 第一列第一格          | 内容单元格第二列第一格 |</span><br><span class="line">| 内容单元格 第一列第二格 多加文字 | 内容单元格第二列第二格 |</span><br></pre></td></tr></table></figure><p>效果如下:</p><table><thead><tr><th>第一格表头</th><th>第二格表头</th></tr></thead><tbody><tr><td>内容单元格 第一列第一格</td><td>内容单元格第二列第一格</td></tr><tr><td>内容单元格 第一列第二格 多加文字</td><td>内容单元格第二列第二格</td></tr></tbody></table><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2><p><code>H~2~o</code>效果预览–&gt;H<del>2</del>o</p><h2 id="高亮-lt-mark-gt"><a href="#高亮-lt-mark-gt" class="headerlink" title="高亮&lt;mark&gt;"></a>高亮&lt;mark&gt;</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mark</span>&gt;</span></span>content<span class="language-xml"><span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><code>&lt;mark&gt;</code>标签支持全局属性，因此可以通过自定义<code>style</code>修改mark的样式。</p><p>参考这个↓：</p><p><a href="http://codingdict.com/article/1679">HTML参考手册|编程字典</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mark</span>&gt;</span></span>原始样式<span class="language-xml"><span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;font:&#x27;微软雅黑&#x27;;color:red;font-weight:900&quot;</span>&gt;</span></span>CSS样式<span class="language-xml"><span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><mark>原始样式</mark><br><mark style="font:'微软雅黑';color:green;font-weight:900;background:lightgray">CSS样式</mark></p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Visual Assist 快捷键整理</title>
      <link href="/%E6%89%8B%E5%86%8C/%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%95%B4%E7%90%86/Visual%20Assist%20%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/%E6%89%8B%E5%86%8C/%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%95%B4%E7%90%86/Visual%20Assist%20%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<p>Visual Assist 快捷键：</p><p>shift+alt+F 查找引用<br>alt+M 查看当前文件下函数列表<br>alt+up 将当前行的代码放到上一行<br>alt+down 将当前行的代码放到下一行<br>alt+O .h&#x2F;.cpp文件的切换<br>Ctrl + -：光标回到上一处<br>Ctrl + Shift + -：光标回到下一处<br>Alt + G：快速跳到定义</p><p>shift+alt+O 打开解决方案文件对话框<br>shift+alt+S 查找某个对象或是变量<br>shift+alt+Q 鼠标定位到函数名上，若是在cpp文件中，则按此快捷键会弹出右键菜单，里面有一个选项–创建声明。 <strong>与Alt+O配合会比较方便。</strong><br>shift+alt+F 找到对象的所有引用<br>shift+alt+R 找到所有对象并重命名</p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 快捷键整理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 快捷键 </tag>
            
            <tag> VA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写作协作手册</title>
      <link href="/%E6%89%8B%E5%86%8C/%E5%86%99%E4%BD%9C%E6%A0%B7%E5%BC%8F/"/>
      <url>/%E6%89%8B%E5%86%8C/%E5%86%99%E4%BD%9C%E6%A0%B7%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><blockquote><p>暂时我不想知道你在想什么！</p></blockquote><ul><li>你想知道什么？</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">const</span> <span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://img.shields.io/badge/难度-困难-red"  align="left" /><img src="https://img.shields.io/badge/难度-中等-yellow" align="left"  /><img src="https://img.shields.io/badge/难度-简单-green" align="left"  /><p><img src="https://files.mdnice.com/blue.jpg"><br><img src="https://files.mdnice.com/green.jpg" alt="绿2"><br><img src="https://files.mdnice.com/red.jpg" alt="红3"></p><h1 id="常用颜色代码"><a href="#常用颜色代码" class="headerlink" title="常用颜色代码"></a>常用颜色代码</h1><div style="background:marnoon;color:black">color=maroon</div><div style="background:grey;">color=grey</div><div style="background:silver;">color=silver</div><div style="background:lightgrey;">color=lightgrey</div><div style="background:HotPink;">color=HotPink</div><div style="background:DeepPink;">color=DeepPink</div><div style="background:VioletRed;">color=VioletRed</div><div style="background:Purple;">color=Purple</div><div style="background:navy;">color=navy</div><div style="background:Blue;">color=Blue</div><div style="background:DeepSkyBlue;">color=DeepSkyBlue</div><div style="background:LightSkyBlue;">color=LightSkyBlue</div><div style="background:aqua;">color=aqua</div><div style="background:DarkTurquoise;">color=DarkTurquoise</div><div style="background:LightSeaGreen;">color=LightSeaGreen</div><div style="background:YellowGreen;">color=YellowGreen</div><div style="background:GreenYellow;">color=GreenYellow</div><div style="background:Yellow;">color=Yellow</div><div style="background:Tomato;">color=Tomato</div><div style="background:red;">color=red</div><div style="background:fuchsia;">color=fuchsia</div><div style="background:MediumOrchid;">color=MediumOrchid</div><div style="background:DarkViolet;">color=DarkViolet</div><p><a href="https://img.shields.io/badge/%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5-fole_del.github.io-blue">https://img.shields.io/badge/个人主页-fole_del.github.io-blue</a></p><p><img src="/../images/image-20201012182346086.png" alt="色彩名"></p><p>常用模板（复杂度）</p><p><img src="https://img.shields.io/badge/-brightgreen-brightgreen" alt="brightgreen"><img src="https://img.shields.io/badge/-green-green" alt="green"><img src="https://img.shields.io/badge/-yellowgreen-yellowgreen" alt="yellowgreen"><img src="https://img.shields.io/badge/-yellow-yellow" alt="yellow"><img src="https://img.shields.io/badge/-orange-orange" alt="orange"><img src="https://img.shields.io/badge/-red-red" alt="red"><img src="https://img.shields.io/badge/-blue-blue" alt="blue"><img src="https://img.shields.io/badge/-lightgrey-lightgrey" alt="lightgrey"><br><img src="https://img.shields.io/badge/-success-success" alt="success"><img src="https://img.shields.io/badge/-important-important" alt="important"><img src="https://img.shields.io/badge/-critical-critical" alt="critical"><img src="https://img.shields.io/badge/-informational-informational" alt="informational"><img src="https://img.shields.io/badge/-inactive-inactive" alt="inactive"><br><img src="https://img.shields.io/badge/-blueviolet-blueviolet" alt="blueviolet"><img src="https://img.shields.io/badge/-ff69b4-ff69b4" alt="ff69b4"><img src="https://img.shields.io/badge/-9cf-9cf" alt="9cf"></p><table><thead><tr><th><code>?style=plastic&amp;logo=appveyor</code></th><th><img src="https://img.shields.io/badge/style-plastic-green?logo=appveyor&style=plastic" alt="plastic"></th></tr></thead><tbody><tr><td><code>?style=flat&amp;logo=appveyor</code></td><td><img src="https://img.shields.io/badge/style-flat-green?logo=appveyor&style=flat" alt="flat"></td></tr><tr><td><code>?style=flat-square&amp;logo=appveyor</code></td><td><img src="https://img.shields.io/badge/style-flat--square-green?logo=appveyor&style=flat-square" alt="flat-square"></td></tr><tr><td><code>?style=for-the-badge&amp;logo=appveyor</code></td><td><img src="https://img.shields.io/badge/style-for--the--badge-green?logo=appveyor&style=for-the-badge" alt="for-the-badge"></td></tr><tr><td><code>?style=social&amp;logo=appveyor</code></td><td><img src="https://img.shields.io/badge/style-social-green?logo=appveyor&style=social" alt="social"></td></tr></tbody></table><p><img src="https://img.shields.io/badge/%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6-n%C2%B2-red"> <img src="https://img.shields.io/badge/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6-n%C2%B2-information"></p><h1 id="其他快捷方式"><a href="#其他快捷方式" class="headerlink" title="其他快捷方式"></a><font color=rgb(25,26,35) face="华文彩云" size=100px>其他快捷方式</font></h1><p>^_^</p><p>&#x2F;* default *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #f7f7f7;border-left-color: #777;"><p>default</p></div><p>&#x2F;* success *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #eff8f0;border-left-color: #5cb85c;"><p>success</p></div><p>&#x2F;* primary *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #f5f0fa;border-left-color: #6f42c1;"><p>primary</p></div><p>&#x2F;* info *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #eef7fa;border-left-color: #428bca;"><p>info</p></div><p>&#x2F;* warning *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #fdf8ea;border-left-color: #f0ad4e;"><p>warning</p></div><p>&#x2F;* danger *&#x2F;</p><div class="note  icon custom iconfont icon-QQ2" style="background: #fcf1f2;border-left-color: #d9534f;"><p>danger</p></div><h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a><font color=rgb(25,26,35) face="华文彩云" size=100px>动画</font></h1><blockquote><p>需要注意的是在使用时需要添加<code>fas</code>的属性，如<code>&lt;span class=&quot;fas faa-wrench animated&quot;&gt;&lt;/span&gt;</code></p></blockquote><p><a href="https://www.antmoe.com/posts/a811d614/index.html#%E9%98%85%E8%AF%BB%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%83%8C%E6%99%AF%E4%B8%8E%E5%AD%97%E4%BD%93">小康博客</a></p><table><thead><tr><th align="center">On DOM load</th><th align="center">On hover</th><th align="center">On parent hover</th></tr></thead><tbody><tr><td align="center">faa-wrench animated</td><td align="center">faa-wrench animated-hover</td><td align="center">faa-wrench</td></tr><tr><td align="center">faa-ring animated</td><td align="center">faa-ring animated-hover</td><td align="center">faa-ring</td></tr><tr><td align="center">faa-horizontal animated</td><td align="center">faa-horizontal animated-hover</td><td align="center">faa-horizontal</td></tr><tr><td align="center">faa-vertical animated</td><td align="center">faa-vertical animated-hover</td><td align="center">faa-vertical</td></tr><tr><td align="center">faa-flash animated</td><td align="center">faa-flash animated-hover</td><td align="center">faa-flash</td></tr><tr><td align="center">faa-bounce animated</td><td align="center">faa-bounce animated-hover</td><td align="center">faa-bounce</td></tr><tr><td align="center">faa-spin animated</td><td align="center">faa-spin animated-hover</td><td align="center">faa-spin</td></tr><tr><td align="center">faa-float animated</td><td align="center">faa-float animated-hover</td><td align="center">faa-float</td></tr><tr><td align="center">faa-pulse animated</td><td align="center">faa-pulse animated-hover</td><td align="center">faa-pulse</td></tr><tr><td align="center">faa-shake animated</td><td align="center">faa-shake animated-hover</td><td align="center">faa-shake</td></tr><tr><td align="center">faa-tada animated</td><td align="center">faa-tada animated-hover</td><td align="center">faa-tada</td></tr><tr><td align="center">faa-passing animated</td><td align="center">faa-passing animated-hover</td><td align="center">faa-passing</td></tr><tr><td align="center">faa-passing-reverse animated</td><td align="center">faa-passing-reverse animated-hover</td><td align="center">faa-passing-reverse</td></tr><tr><td align="center">faa-burst animated</td><td align="center">faa-burst animated-hover</td><td align="center">faa-burst</td></tr><tr><td align="center">faa-falling animated</td><td align="center">faa-falling animated-hover</td><td align="center">faa-falling</td></tr><tr><td align="center">faa-rising animated</td><td align="center">faa-rising animated-hover</td><td align="center">faa-rising</td></tr></tbody></table><h1 id="外挂标签"><a href="#外挂标签" class="headerlink" title="外挂标签"></a>外挂标签</h1><h2 id="checkbox"><a href="#checkbox" class="headerlink" title="checkbox"></a>checkbox</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 纯文本测试 %&#125;</span><br><span class="line">&#123;% checkbox checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% checkbox red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% checkbox green checked, 绿色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, 黄色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, 青色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox blue checked, 蓝色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, 增加 %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, 减少 %&#125;</span><br><span class="line">&#123;% checkbox times red checked, 叉 %&#125;</span><br><span class="line">&#123;% radio 纯文本测试 %&#125;</span><br><span class="line">&#123;% radio checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% radio red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% radio green, 绿色 %&#125;</span><br><span class="line">&#123;% radio yellow, 黄色 %&#125;</span><br><span class="line">&#123;% radio cyan, 青色 %&#125;</span><br><span class="line">&#123;% radio blue, 蓝色 %&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/Markdown%E5%B7%A5%E5%85%B7%E9%9B%86/image-20210611120738604.png" alt="image-20210611120738604"></p><hr><h1 id="所有表情"><a href="#所有表情" class="headerlink" title="所有表情"></a><font color=rgb(25,26,35) face="华文彩云">所有表情</font></h1><p>:a: :ab: :abc: :abcd: :accept: :aerial_tramway: :afghanistan: :airplane: :central_african_republic: :earth_africa: :south_africa: :aland_islands: :alarm_clock: :alembic:</p><table><thead><tr><th>😄 <code>:smile:</code></th><th>😆 <code>:laughing:</code></th><th></th></tr></thead><tbody><tr><td>😊 <code>:blush:</code></td><td>😃 <code>:smiley:</code></td><td>☺️ <code>:relaxed:</code></td></tr><tr><td>😏 <code>:smirk:</code></td><td>😍 <code>:heart_eyes:</code></td><td>😘 <code>:kissing_heart:</code></td></tr><tr><td>😚 <code>:kissing_closed_eyes:</code></td><td>😳 <code>:flushed:</code></td><td>😌 <code>:relieved:</code></td></tr><tr><td>😆 <code>:satisfied:</code></td><td>😁 <code>:grin:</code></td><td>😉 <code>:wink:</code></td></tr><tr><td>😜 <code>:stuck_out_tongue_winking_eye:</code></td><td>😝 <code>:stuck_out_tongue_closed_eyes:</code></td><td>😀 <code>:grinning:</code></td></tr><tr><td>😗 <code>:kissing:</code></td><td>😙 <code>:kissing_smiling_eyes:</code></td><td>😛 <code>:stuck_out_tongue:</code></td></tr><tr><td>😴 <code>:sleeping:</code></td><td>😟 <code>:worried:</code></td><td>😦 <code>:frowning:</code></td></tr><tr><td>😧 <code>:anguished:</code></td><td>😮 <code>:open_mouth:</code></td><td>😬 <code>:grimacing:</code></td></tr><tr><td>😕 <code>:confused:</code></td><td>😯 <code>:hushed:</code></td><td>😑 <code>:expressionless:</code></td></tr><tr><td>😒 <code>:unamused:</code></td><td>😅 <code>:sweat_smile:</code></td><td>😓 <code>:sweat:</code></td></tr><tr><td>😥 <code>:disappointed_relieved:</code></td><td>😩 <code>:weary:</code></td><td>😔 <code>:pensive:</code></td></tr><tr><td>😞 <code>:disappointed:</code></td><td>😖 <code>:confounded:</code></td><td>😨 <code>:fearful:</code></td></tr><tr><td>😰 <code>:cold_sweat:</code></td><td>😣 <code>:persevere:</code></td><td>😢 <code>:cry:</code></td></tr><tr><td>😭 <code>:sob:</code></td><td>😂 <code>:joy:</code></td><td>😲 <code>:astonished:</code></td></tr><tr><td>😱 <code>:scream:</code></td><td></td><td>😫 <code>:tired_face:</code></td></tr><tr><td>😠 <code>:angry:</code></td><td>😡 <code>:rage:</code></td><td>😤 <code>:triumph:</code></td></tr><tr><td>😪 <code>:sleepy:</code></td><td>😋 <code>:yum:</code></td><td>😷 <code>:mask:</code></td></tr><tr><td>😎 <code>:sunglasses:</code></td><td>😵 <code>:dizzy_face:</code></td><td>👿 <code>:imp:</code></td></tr><tr><td>😈 <code>:smiling_imp:</code></td><td>😐 <code>:neutral_face:</code></td><td>😶 <code>:no_mouth:</code></td></tr><tr><td>😇 <code>:innocent:</code></td><td>👽 <code>:alien:</code></td><td>💛 <code>:yellow_heart:</code></td></tr><tr><td>💙 <code>:blue_heart:</code></td><td>💜 <code>:purple_heart:</code></td><td>❤️ <code>:heart:</code></td></tr><tr><td>💚 <code>:green_heart:</code></td><td>💔 <code>:broken_heart:</code></td><td>💓 <code>:heartbeat:</code></td></tr><tr><td>💗 <code>:heartpulse:</code></td><td>💕 <code>:two_hearts:</code></td><td>💞 <code>:revolving_hearts:</code></td></tr><tr><td>💘 <code>:cupid:</code></td><td>💖 <code>:sparkling_heart:</code></td><td>✨ <code>:sparkles:</code></td></tr><tr><td>⭐️ <code>:star:</code></td><td>🌟 <code>:star2:</code></td><td>💫 <code>:dizzy:</code></td></tr><tr><td>💥 <code>:boom:</code></td><td>💥 <code>:collision:</code></td><td>💢 <code>:anger:</code></td></tr><tr><td>❗️ <code>:exclamation:</code></td><td>❓ <code>:question:</code></td><td>❕ <code>:grey_exclamation:</code></td></tr><tr><td>❔ <code>:grey_question:</code></td><td>💤 <code>:zzz:</code></td><td>💨 <code>:dash:</code></td></tr><tr><td>💦 <code>:sweat_drops:</code></td><td>🎶 <code>:notes:</code></td><td>🎵 <code>:musical_note:</code></td></tr><tr><td>🔥 <code>:fire:</code></td><td>💩 <code>:hankey:</code></td><td>💩 <code>:poop:</code></td></tr><tr><td>💩 <code>:shit:</code></td><td>👍 <code>:+1:</code></td><td>👍 <code>:thumbsup:</code></td></tr><tr><td>👎 <code>:-1:</code></td><td>👎 <code>:thumbsdown:</code></td><td>👌 <code>:ok_hand:</code></td></tr><tr><td>👊 <code>:punch:</code></td><td>👊 <code>:facepunch:</code></td><td>✊ <code>:fist:</code></td></tr><tr><td>✌️ <code>:v:</code></td><td>👋 <code>:wave:</code></td><td>✋ <code>:hand:</code></td></tr><tr><td>✋ <code>:raised_hand:</code></td><td>👐 <code>:open_hands:</code></td><td>☝️ <code>:point_up:</code></td></tr><tr><td>👇 <code>:point_down:</code></td><td>👈 <code>:point_left:</code></td><td>👉 <code>:point_right:</code></td></tr><tr><td>🙌 <code>:raised_hands:</code></td><td>🙏 <code>:pray:</code></td><td>👆 <code>:point_up_2:</code></td></tr><tr><td>👏 <code>:clap:</code></td><td>💪 <code>:muscle:</code></td><td>🤘 <code>:metal:</code></td></tr><tr><td>🖕 <code>:fu:</code></td><td>🚶 <code>:walking:</code></td><td>🏃 <code>:runner:</code></td></tr><tr><td>🏃 <code>:running:</code></td><td>👫 <code>:couple:</code></td><td>👪 <code>:family:</code></td></tr><tr><td>👬 <code>:two_men_holding_hands:</code></td><td>👭 <code>:two_women_holding_hands:</code></td><td>💃 <code>:dancer:</code></td></tr><tr><td>👯 <code>:dancers:</code></td><td>🙆 <code>:ok_woman:</code></td><td>🙅 <code>:no_good:</code></td></tr><tr><td>💁 <code>:information_desk_person:</code></td><td>🙋 <code>:raising_hand:</code></td><td>👰 <code>:bride_with_veil:</code></td></tr><tr><td>🙎 <code>:person_with_pouting_face:</code></td><td>🙍 <code>:person_frowning:</code></td><td>🙇 <code>:bow:</code></td></tr><tr><td>:couplekiss: <code>:couplekiss:</code></td><td>💑 <code>:couple_with_heart:</code></td><td>💆 <code>:massage:</code></td></tr><tr><td>💇 <code>:haircut:</code></td><td>💅 <code>:nail_care:</code></td><td>👦 <code>:boy:</code></td></tr><tr><td>👧 <code>:girl:</code></td><td>👩 <code>:woman:</code></td><td>👨 <code>:man:</code></td></tr><tr><td>👶 <code>:baby:</code></td><td>👵 <code>:older_woman:</code></td><td>👴 <code>:older_man:</code></td></tr><tr><td>👱 <code>:person_with_blond_hair:</code></td><td>👲 <code>:man_with_gua_pi_mao:</code></td><td>👳 <code>:man_with_turban:</code></td></tr><tr><td>👷 <code>:construction_worker:</code></td><td>👮 <code>:cop:</code></td><td>👼 <code>:angel:</code></td></tr><tr><td>👸 <code>:princess:</code></td><td>😺 <code>:smiley_cat:</code></td><td>😸 <code>:smile_cat:</code></td></tr><tr><td>😻 <code>:heart_eyes_cat:</code></td><td>😽 <code>:kissing_cat:</code></td><td>😼 <code>:smirk_cat:</code></td></tr><tr><td>🙀 <code>:scream_cat:</code></td><td>😿 <code>:crying_cat_face:</code></td><td>😹 <code>:joy_cat:</code></td></tr><tr><td>😾 <code>:pouting_cat:</code></td><td>👹 <code>:japanese_ogre:</code></td><td>👺 <code>:japanese_goblin:</code></td></tr><tr><td>🙈 <code>:see_no_evil:</code></td><td>🙉 <code>:hear_no_evil:</code></td><td>🙊 <code>:speak_no_evil:</code></td></tr><tr><td>💂 <code>:guardsman:</code></td><td>💀 <code>:skull:</code></td><td>🐾 <code>:feet:</code></td></tr><tr><td>👄 <code>:lips:</code></td><td>💋 <code>:kiss:</code></td><td>💧 <code>:droplet:</code></td></tr><tr><td>👂 <code>:ear:</code></td><td>👀 <code>:eyes:</code></td><td>👃 <code>:nose:</code></td></tr><tr><td>👅 <code>:tongue:</code></td><td>💌 <code>:love_letter:</code></td><td>👤 <code>:bust_in_silhouette:</code></td></tr><tr><td>👥 <code>:busts_in_silhouette:</code></td><td>💬 <code>:speech_balloon:</code></td><td>💭 <code>:thought_balloon:</code></td></tr></tbody></table><p>Nature</p><table><thead><tr><th>☀️ <code>:sunny:</code></th><th>☔️ <code>:umbrella:</code></th><th>☁️ <code>:cloud:</code></th></tr></thead><tbody><tr><td>❄️ <code>:snowflake:</code></td><td>⛄️ <code>:snowman:</code></td><td>⚡️ <code>:zap:</code></td></tr><tr><td>🌀 <code>:cyclone:</code></td><td>🌁 <code>:foggy:</code></td><td>🌊 <code>:ocean:</code></td></tr><tr><td>🐱 <code>:cat:</code></td><td>🐶 <code>:dog:</code></td><td>🐭 <code>:mouse:</code></td></tr><tr><td>🐹 <code>:hamster:</code></td><td>🐰 <code>:rabbit:</code></td><td>🐺 <code>:wolf:</code></td></tr><tr><td>🐸 <code>:frog:</code></td><td>🐯 <code>:tiger:</code></td><td>🐨 <code>:koala:</code></td></tr><tr><td>🐻 <code>:bear:</code></td><td>🐷 <code>:pig:</code></td><td>🐽 <code>:pig_nose:</code></td></tr><tr><td>🐮 <code>:cow:</code></td><td>🐗 <code>:boar:</code></td><td>🐵 <code>:monkey_face:</code></td></tr><tr><td>🐒 <code>:monkey:</code></td><td>🐴 <code>:horse:</code></td><td>🐎 <code>:racehorse:</code></td></tr><tr><td>🐫 <code>:camel:</code></td><td>🐑 <code>:sheep:</code></td><td>🐘 <code>:elephant:</code></td></tr><tr><td>🐼 <code>:panda_face:</code></td><td>🐍 <code>:snake:</code></td><td>🐦 <code>:bird:</code></td></tr><tr><td>🐤 <code>:baby_chick:</code></td><td>🐥 <code>:hatched_chick:</code></td><td>🐣 <code>:hatching_chick:</code></td></tr><tr><td>🐔 <code>:chicken:</code></td><td>🐧 <code>:penguin:</code></td><td>🐢 <code>:turtle:</code></td></tr><tr><td>🐛 <code>:bug:</code></td><td>🐝 <code>:honeybee:</code></td><td>🐜 <code>:ant:</code></td></tr><tr><td>🐞 <code>:beetle:</code></td><td>🐌 <code>:snail:</code></td><td>🐙 <code>:octopus:</code></td></tr><tr><td>🐠 <code>:tropical_fish:</code></td><td>🐟 <code>:fish:</code></td><td>🐳 <code>:whale:</code></td></tr><tr><td>🐋 <code>:whale2:</code></td><td>🐬 <code>:dolphin:</code></td><td>🐄 <code>:cow2:</code></td></tr><tr><td>🐏 <code>:ram:</code></td><td>🐀 <code>:rat:</code></td><td>🐃 <code>:water_buffalo:</code></td></tr><tr><td>🐅 <code>:tiger2:</code></td><td>🐇 <code>:rabbit2:</code></td><td>🐉 <code>:dragon:</code></td></tr><tr><td>🐐 <code>:goat:</code></td><td>🐓 <code>:rooster:</code></td><td>🐕 <code>:dog2:</code></td></tr><tr><td>🐖 <code>:pig2:</code></td><td>🐁 <code>:mouse2:</code></td><td>🐂 <code>:ox:</code></td></tr><tr><td>🐲 <code>:dragon_face:</code></td><td>🐡 <code>:blowfish:</code></td><td>🐊 <code>:crocodile:</code></td></tr><tr><td>🐪 <code>:dromedary_camel:</code></td><td>🐆 <code>:leopard:</code></td><td>🐈 <code>:cat2:</code></td></tr><tr><td>🐩 <code>:poodle:</code></td><td>🐾 <code>:paw_prints:</code></td><td>💐 <code>:bouquet:</code></td></tr><tr><td>🌸 <code>:cherry_blossom:</code></td><td>🌷 <code>:tulip:</code></td><td>🍀 <code>:four_leaf_clover:</code></td></tr><tr><td>🌹 <code>:rose:</code></td><td>🌻 <code>:sunflower:</code></td><td>🌺 <code>:hibiscus:</code></td></tr><tr><td>🍁 <code>:maple_leaf:</code></td><td>🍃 <code>:leaves:</code></td><td>🍂 <code>:fallen_leaf:</code></td></tr><tr><td>🌿 <code>:herb:</code></td><td>🍄 <code>:mushroom:</code></td><td>🌵 <code>:cactus:</code></td></tr><tr><td>🌴 <code>:palm_tree:</code></td><td>🌲 <code>:evergreen_tree:</code></td><td>🌳 <code>:deciduous_tree:</code></td></tr><tr><td>🌰 <code>:chestnut:</code></td><td>🌱 <code>:seedling:</code></td><td>🌼 <code>:blossom:</code></td></tr><tr><td>🌾 <code>:ear_of_rice:</code></td><td>🐚 <code>:shell:</code></td><td>🌐 <code>:globe_with_meridians:</code></td></tr><tr><td>🌞 <code>:sun_with_face:</code></td><td>🌝 <code>:full_moon_with_face:</code></td><td>🌚 <code>:new_moon_with_face:</code></td></tr><tr><td>🌑 <code>:new_moon:</code></td><td>🌒 <code>:waxing_crescent_moon:</code></td><td>🌓 <code>:first_quarter_moon:</code></td></tr><tr><td>🌔 <code>:waxing_gibbous_moon:</code></td><td>🌕 <code>:full_moon:</code></td><td>🌖 <code>:waning_gibbous_moon:</code></td></tr><tr><td>🌗 <code>:last_quarter_moon:</code></td><td>🌘 <code>:waning_crescent_moon:</code></td><td>🌜 <code>:last_quarter_moon_with_face:</code></td></tr><tr><td>🌛 <code>:first_quarter_moon_with_face:</code></td><td>🌔 <code>:moon:</code></td><td>🌍 <code>:earth_africa:</code></td></tr><tr><td>🌎 <code>:earth_americas:</code></td><td>🌏 <code>:earth_asia:</code></td><td>🌋 <code>:volcano:</code></td></tr><tr><td>🌌 <code>:milky_way:</code></td><td>⛅️ <code>:partly_sunny:</code></td><td></td></tr></tbody></table><p>Objects</p><table><thead><tr><th>🎍 <code>:bamboo:</code></th><th>💝 <code>:gift_heart:</code></th><th>🎎 <code>:dolls:</code></th></tr></thead><tbody><tr><td>🎒 <code>:school_satchel:</code></td><td>🎓 <code>:mortar_board:</code></td><td>🎏 <code>:flags:</code></td></tr><tr><td>🎆 <code>:fireworks:</code></td><td>🎇 <code>:sparkler:</code></td><td>🎐 <code>:wind_chime:</code></td></tr><tr><td>🎑 <code>:rice_scene:</code></td><td>🎃 <code>:jack_o_lantern:</code></td><td>👻 <code>:ghost:</code></td></tr><tr><td>🎅 <code>:santa:</code></td><td>🎄 <code>:christmas_tree:</code></td><td>🎁 <code>:gift:</code></td></tr><tr><td>🔔 <code>:bell:</code></td><td>🔕 <code>:no_bell:</code></td><td>🎋 <code>:tanabata_tree:</code></td></tr><tr><td>🎉 <code>:tada:</code></td><td>🎊 <code>:confetti_ball:</code></td><td>🎈 <code>:balloon:</code></td></tr><tr><td>🔮 <code>:crystal_ball:</code></td><td>💿 <code>:cd:</code></td><td>📀 <code>:dvd:</code></td></tr><tr><td>💾 <code>:floppy_disk:</code></td><td>📷 <code>:camera:</code></td><td>📹 <code>:video_camera:</code></td></tr><tr><td>🎥 <code>:movie_camera:</code></td><td>💻 <code>:computer:</code></td><td>📺 <code>:tv:</code></td></tr><tr><td>📱 <code>:iphone:</code></td><td>☎️ <code>:phone:</code></td><td>☎️ <code>:telephone:</code></td></tr><tr><td>📞 <code>:telephone_receiver:</code></td><td>📟 <code>:pager:</code></td><td>📠 <code>:fax:</code></td></tr><tr><td>💽 <code>:minidisc:</code></td><td>📼 <code>:vhs:</code></td><td>🔉 <code>:sound:</code></td></tr><tr><td>🔈 <code>:speaker:</code></td><td>🔇 <code>:mute:</code></td><td>📢 <code>:loudspeaker:</code></td></tr><tr><td>📣 <code>:mega:</code></td><td>⌛️ <code>:hourglass:</code></td><td>⏳ <code>:hourglass_flowing_sand:</code></td></tr><tr><td>⏰ <code>:alarm_clock:</code></td><td>⌚️ <code>:watch:</code></td><td>📻 <code>:radio:</code></td></tr><tr><td>📡 <code>:satellite:</code></td><td>➿ <code>:loop:</code></td><td>🔍 <code>:mag:</code></td></tr><tr><td>🔎 <code>:mag_right:</code></td><td>🔓 <code>:unlock:</code></td><td>🔒 <code>:lock:</code></td></tr><tr><td>🔏 <code>:lock_with_ink_pen:</code></td><td>🔐 <code>:closed_lock_with_key:</code></td><td>🔑 <code>:key:</code></td></tr><tr><td>💡 <code>:bulb:</code></td><td>🔦 <code>:flashlight:</code></td><td>🔆 <code>:high_brightness:</code></td></tr><tr><td>🔅 <code>:low_brightness:</code></td><td>🔌 <code>:electric_plug:</code></td><td>🔋 <code>:battery:</code></td></tr><tr><td>📲 <code>:calling:</code></td><td>✉️ <code>:email:</code></td><td>📫 <code>:mailbox:</code></td></tr><tr><td>📮 <code>:postbox:</code></td><td>🛀 <code>:bath:</code></td><td>🛁 <code>:bathtub:</code></td></tr><tr><td>🚿 <code>:shower:</code></td><td>🚽 <code>:toilet:</code></td><td>🔧 <code>:wrench:</code></td></tr><tr><td>🔩 <code>:nut_and_bolt:</code></td><td>🔨 <code>:hammer:</code></td><td>💺 <code>:seat:</code></td></tr><tr><td>💰 <code>:moneybag:</code></td><td>💴 <code>:yen:</code></td><td>💵 <code>:dollar:</code></td></tr><tr><td>💷 <code>:pound:</code></td><td>💶 <code>:euro:</code></td><td>💳 <code>:credit_card:</code></td></tr><tr><td>💸 <code>:money_with_wings:</code></td><td>📧 <code>:e-mail:</code></td><td>📥 <code>:inbox_tray:</code></td></tr><tr><td>📤 <code>:outbox_tray:</code></td><td>✉️ <code>:envelope:</code></td><td>📨 <code>:incoming_envelope:</code></td></tr><tr><td>📯 <code>:postal_horn:</code></td><td>📪 <code>:mailbox_closed:</code></td><td>📬 <code>:mailbox_with_mail:</code></td></tr><tr><td>📭 <code>:mailbox_with_no_mail:</code></td><td>🚪 <code>:door:</code></td><td>🚬 <code>:smoking:</code></td></tr><tr><td>💣 <code>:bomb:</code></td><td>🔫 <code>:gun:</code></td><td>🔪 <code>:hocho:</code></td></tr><tr><td>💊 <code>:pill:</code></td><td>💉 <code>:syringe:</code></td><td>📄 <code>:page_facing_up:</code></td></tr><tr><td>📃 <code>:page_with_curl:</code></td><td>📑 <code>:bookmark_tabs:</code></td><td>📊 <code>:bar_chart:</code></td></tr><tr><td>📈 <code>:chart_with_upwards_trend:</code></td><td>📉 <code>:chart_with_downwards_trend:</code></td><td>📜 <code>:scroll:</code></td></tr><tr><td>📋 <code>:clipboard:</code></td><td>📆 <code>:calendar:</code></td><td>📅 <code>:date:</code></td></tr><tr><td>📇 <code>:card_index:</code></td><td>📁 <code>:file_folder:</code></td><td>📂 <code>:open_file_folder:</code></td></tr><tr><td>✂️ <code>:scissors:</code></td><td>📌 <code>:pushpin:</code></td><td>📎 <code>:paperclip:</code></td></tr><tr><td>✒️ <code>:black_nib:</code></td><td>✏️ <code>:pencil2:</code></td><td>📏 <code>:straight_ruler:</code></td></tr><tr><td>📐 <code>:triangular_ruler:</code></td><td>📕 <code>:closed_book:</code></td><td>📗 <code>:green_book:</code></td></tr><tr><td>📘 <code>:blue_book:</code></td><td>📙 <code>:orange_book:</code></td><td>📓 <code>:notebook:</code></td></tr><tr><td>📔 <code>:notebook_with_decorative_cover:</code></td><td>📒 <code>:ledger:</code></td><td>📚 <code>:books:</code></td></tr><tr><td>🔖 <code>:bookmark:</code></td><td>📛 <code>:name_badge:</code></td><td>🔬 <code>:microscope:</code></td></tr><tr><td>🔭 <code>:telescope:</code></td><td>📰 <code>:newspaper:</code></td><td>🏈 <code>:football:</code></td></tr><tr><td>🏀 <code>:basketball:</code></td><td>⚽️ <code>:soccer:</code></td><td>⚾️ <code>:baseball:</code></td></tr><tr><td>🎾 <code>:tennis:</code></td><td>🎱 <code>:8ball:</code></td><td>🏉 <code>:rugby_football:</code></td></tr><tr><td>🎳 <code>:bowling:</code></td><td>⛳️ <code>:golf:</code></td><td>🚵 <code>:mountain_bicyclist:</code></td></tr><tr><td>🚴 <code>:bicyclist:</code></td><td>🏇 <code>:horse_racing:</code></td><td>🏂 <code>:snowboarder:</code></td></tr><tr><td>🏊 <code>:swimmer:</code></td><td>🏄 <code>:surfer:</code></td><td>🎿 <code>:ski:</code></td></tr><tr><td>♠️ <code>:spades:</code></td><td>♥️ <code>:hearts:</code></td><td>♣️ <code>:clubs:</code></td></tr><tr><td>♦️ <code>:diamonds:</code></td><td>💎 <code>:gem:</code></td><td>💍 <code>:ring:</code></td></tr><tr><td>🏆 <code>:trophy:</code></td><td>🎼 <code>:musical_score:</code></td><td>🎹 <code>:musical_keyboard:</code></td></tr><tr><td>🎻 <code>:violin:</code></td><td>👾 <code>:space_invader:</code></td><td>🎮 <code>:video_game:</code></td></tr><tr><td>🃏 <code>:black_joker:</code></td><td>🎴 <code>:flower_playing_cards:</code></td><td>🎲 <code>:game_die:</code></td></tr><tr><td>🎯 <code>:dart:</code></td><td>🀄️ <code>:mahjong:</code></td><td>🎬 <code>:clapper:</code></td></tr><tr><td>📝 <code>:memo:</code></td><td>📝 <code>:pencil:</code></td><td>📖 <code>:book:</code></td></tr><tr><td>🎨 <code>:art:</code></td><td>🎤 <code>:microphone:</code></td><td>🎧 <code>:headphones:</code></td></tr><tr><td>🎺 <code>:trumpet:</code></td><td>🎷 <code>:saxophone:</code></td><td>🎸 <code>:guitar:</code></td></tr><tr><td>👞 <code>:shoe:</code></td><td>👡 <code>:sandal:</code></td><td>👠 <code>:high_heel:</code></td></tr><tr><td>💄 <code>:lipstick:</code></td><td>👢 <code>:boot:</code></td><td>👕 <code>:shirt:</code></td></tr><tr><td>👕 <code>:tshirt:</code></td><td>👔 <code>:necktie:</code></td><td>👚 <code>:womans_clothes:</code></td></tr><tr><td>👗 <code>:dress:</code></td><td>🎽 <code>:running_shirt_with_sash:</code></td><td>👖 <code>:jeans:</code></td></tr><tr><td>👘 <code>:kimono:</code></td><td>👙 <code>:bikini:</code></td><td>🎀 <code>:ribbon:</code></td></tr><tr><td>🎩 <code>:tophat:</code></td><td>👑 <code>:crown:</code></td><td>👒 <code>:womans_hat:</code></td></tr><tr><td>👞 <code>:mans_shoe:</code></td><td>🌂 <code>:closed_umbrella:</code></td><td>💼 <code>:briefcase:</code></td></tr><tr><td>👜 <code>:handbag:</code></td><td>👝 <code>:pouch:</code></td><td>👛 <code>:purse:</code></td></tr><tr><td>👓 <code>:eyeglasses:</code></td><td>🎣 <code>:fishing_pole_and_fish:</code></td><td>☕️ <code>:coffee:</code></td></tr><tr><td>🍵 <code>:tea:</code></td><td>🍶 <code>:sake:</code></td><td>🍼 <code>:baby_bottle:</code></td></tr><tr><td>🍺 <code>:beer:</code></td><td>🍻 <code>:beers:</code></td><td>🍸 <code>:cocktail:</code></td></tr><tr><td>🍹 <code>:tropical_drink:</code></td><td>🍷 <code>:wine_glass:</code></td><td>🍴 <code>:fork_and_knife:</code></td></tr><tr><td>🍕 <code>:pizza:</code></td><td>🍔 <code>:hamburger:</code></td><td>🍟 <code>:fries:</code></td></tr><tr><td>🍗 <code>:poultry_leg:</code></td><td>🍖 <code>:meat_on_bone:</code></td><td>🍝 <code>:spaghetti:</code></td></tr><tr><td>🍛 <code>:curry:</code></td><td>🍤 <code>:fried_shrimp:</code></td><td>🍱 <code>:bento:</code></td></tr><tr><td>🍣 <code>:sushi:</code></td><td>🍥 <code>:fish_cake:</code></td><td>🍙 <code>:rice_ball:</code></td></tr><tr><td>🍘 <code>:rice_cracker:</code></td><td>🍚 <code>:rice:</code></td><td>🍜 <code>:ramen:</code></td></tr><tr><td>🍲 <code>:stew:</code></td><td>🍢 <code>:oden:</code></td><td>🍡 <code>:dango:</code></td></tr><tr><td>🥚 <code>:egg:</code></td><td>🍞 <code>:bread:</code></td><td>🍩 <code>:doughnut:</code></td></tr><tr><td>🍮 <code>:custard:</code></td><td>🍦 <code>:icecream:</code></td><td>🍨 <code>:ice_cream:</code></td></tr><tr><td>🍧 <code>:shaved_ice:</code></td><td>🎂 <code>:birthday:</code></td><td>🍰 <code>:cake:</code></td></tr><tr><td>🍪 <code>:cookie:</code></td><td>🍫 <code>:chocolate_bar:</code></td><td>🍬 <code>:candy:</code></td></tr><tr><td>🍭 <code>:lollipop:</code></td><td>🍯 <code>:honey_pot:</code></td><td>🍎 <code>:apple:</code></td></tr><tr><td>🍏 <code>:green_apple:</code></td><td>🍊 <code>:tangerine:</code></td><td>🍋 <code>:lemon:</code></td></tr><tr><td>🍒 <code>:cherries:</code></td><td>🍇 <code>:grapes:</code></td><td>🍉 <code>:watermelon:</code></td></tr><tr><td>🍓 <code>:strawberry:</code></td><td>🍑 <code>:peach:</code></td><td>🍈 <code>:melon:</code></td></tr><tr><td>🍌 <code>:banana:</code></td><td>🍐 <code>:pear:</code></td><td>🍍 <code>:pineapple:</code></td></tr><tr><td>🍠 <code>:sweet_potato:</code></td><td>🍆 <code>:eggplant:</code></td><td>🍅 <code>:tomato:</code></td></tr><tr><td>🌽 <code>:corn:</code></td><td></td><td></td></tr></tbody></table><p>Places</p><table><thead><tr><th>🏠 <code>:house:</code></th><th>🏡 <code>:house_with_garden:</code></th><th>🏫 <code>:school:</code></th></tr></thead><tbody><tr><td>🏢 <code>:office:</code></td><td>🏣 <code>:post_office:</code></td><td>🏥 <code>:hospital:</code></td></tr><tr><td>🏦 <code>:bank:</code></td><td>🏪 <code>:convenience_store:</code></td><td>🏩 <code>:love_hotel:</code></td></tr><tr><td>🏨 <code>:hotel:</code></td><td>💒 <code>:wedding:</code></td><td>⛪️ <code>:church:</code></td></tr><tr><td>🏬 <code>:department_store:</code></td><td>🏤 <code>:european_post_office:</code></td><td>🌇 <code>:city_sunrise:</code></td></tr><tr><td>🌆 <code>:city_sunset:</code></td><td>🏯 <code>:japanese_castle:</code></td><td>🏰 <code>:european_castle:</code></td></tr><tr><td>⛺️ <code>:tent:</code></td><td>🏭 <code>:factory:</code></td><td>🗼 <code>:tokyo_tower:</code></td></tr><tr><td>🗾 <code>:japan:</code></td><td>🗻 <code>:mount_fuji:</code></td><td>🌄 <code>:sunrise_over_mountains:</code></td></tr><tr><td>🌅 <code>:sunrise:</code></td><td>🌠 <code>:stars:</code></td><td>🗽 <code>:statue_of_liberty:</code></td></tr><tr><td>🌉 <code>:bridge_at_night:</code></td><td>🎠 <code>:carousel_horse:</code></td><td>🌈 <code>:rainbow:</code></td></tr><tr><td>🎡 <code>:ferris_wheel:</code></td><td>⛲️ <code>:fountain:</code></td><td>🎢 <code>:roller_coaster:</code></td></tr><tr><td>🚢 <code>:ship:</code></td><td>🚤 <code>:speedboat:</code></td><td>⛵️ <code>:boat:</code></td></tr><tr><td>⛵️ <code>:sailboat:</code></td><td>🚣 <code>:rowboat:</code></td><td>⚓️ <code>:anchor:</code></td></tr><tr><td>🚀 <code>:rocket:</code></td><td>✈️ <code>:airplane:</code></td><td>🚁 <code>:helicopter:</code></td></tr><tr><td>🚂 <code>:steam_locomotive:</code></td><td>🚊 <code>:tram:</code></td><td>🚞 <code>:mountain_railway:</code></td></tr><tr><td>🚲 <code>:bike:</code></td><td>🚡 <code>:aerial_tramway:</code></td><td>🚟 <code>:suspension_railway:</code></td></tr><tr><td>🚠 <code>:mountain_cableway:</code></td><td>🚜 <code>:tractor:</code></td><td>🚙 <code>:blue_car:</code></td></tr><tr><td>🚘 <code>:oncoming_automobile:</code></td><td>🚗 <code>:car:</code></td><td>🚗 <code>:red_car:</code></td></tr><tr><td>🚕 <code>:taxi:</code></td><td>🚖 <code>:oncoming_taxi:</code></td><td>🚛 <code>:articulated_lorry:</code></td></tr><tr><td>🚌 <code>:bus:</code></td><td>🚍 <code>:oncoming_bus:</code></td><td>🚨 <code>:rotating_light:</code></td></tr><tr><td>🚓 <code>:police_car:</code></td><td>🚔 <code>:oncoming_police_car:</code></td><td>🚒 <code>:fire_engine:</code></td></tr><tr><td>🚑 <code>:ambulance:</code></td><td>🚐 <code>:minibus:</code></td><td>🚚 <code>:truck:</code></td></tr><tr><td>🚋 <code>:train:</code></td><td>🚉 <code>:station:</code></td><td>🚆 <code>:train2:</code></td></tr><tr><td>🚅 <code>:bullettrain_front:</code></td><td>🚄 <code>:bullettrain_side:</code></td><td>🚈 <code>:light_rail:</code></td></tr><tr><td>🚝 <code>:monorail:</code></td><td>🚃 <code>:railway_car:</code></td><td>🚎 <code>:trolleybus:</code></td></tr><tr><td>🎫 <code>:ticket:</code></td><td>⛽️ <code>:fuelpump:</code></td><td>🚦 <code>:vertical_traffic_light:</code></td></tr><tr><td>🚥 <code>:traffic_light:</code></td><td>⚠️ <code>:warning:</code></td><td>🚧 <code>:construction:</code></td></tr><tr><td>🔰 <code>:beginner:</code></td><td>🏧 <code>:atm:</code></td><td>🎰 <code>:slot_machine:</code></td></tr><tr><td>🚏 <code>:busstop:</code></td><td>💈 <code>:barber:</code></td><td>♨️ <code>:hotsprings:</code></td></tr><tr><td>🏁 <code>:checkered_flag:</code></td><td>🎌 <code>:crossed_flags:</code></td><td>🏮 <code>:izakaya_lantern:</code></td></tr><tr><td>🗿 <code>:moyai:</code></td><td>🎪 <code>:circus_tent:</code></td><td>🎭 <code>:performing_arts:</code></td></tr><tr><td>📍 <code>:round_pushpin:</code></td><td>🚩 <code>:triangular_flag_on_post:</code></td><td>🇯🇵 <code>:jp:</code></td></tr><tr><td>🇰🇷 <code>:kr:</code></td><td>🇨🇳 <code>:cn:</code></td><td>🇺🇸 <code>:us:</code></td></tr><tr><td>🇫🇷 <code>:fr:</code></td><td>🇪🇸 <code>:es:</code></td><td>🇮🇹 <code>:it:</code></td></tr><tr><td>🇷🇺 <code>:ru:</code></td><td>🇬🇧 <code>:gb:</code></td><td>🇬🇧 <code>:uk:</code></td></tr><tr><td>🇩🇪 <code>:de:</code></td><td></td><td></td></tr></tbody></table><p>Symbols</p><table><thead><tr><th>1️⃣ <code>:one:</code></th><th>2️⃣ <code>:two:</code></th><th>3️⃣ <code>:three:</code></th></tr></thead><tbody><tr><td>4️⃣ <code>:four:</code></td><td>5️⃣ <code>:five:</code></td><td>6️⃣ <code>:six:</code></td></tr><tr><td>7️⃣ <code>:seven:</code></td><td>8️⃣ <code>:eight:</code></td><td>9️⃣ <code>:nine:</code></td></tr><tr><td>🔟 <code>:keycap_ten:</code></td><td>🔢 <code>:1234:</code></td><td>0️⃣ <code>:zero:</code></td></tr><tr><td>#️⃣ <code>:hash:</code></td><td>🔣 <code>:symbols:</code></td><td>◀️ <code>:arrow_backward:</code></td></tr><tr><td>⬇️ <code>:arrow_down:</code></td><td>▶️ <code>:arrow_forward:</code></td><td>⬅️ <code>:arrow_left:</code></td></tr><tr><td>🔠 <code>:capital_abcd:</code></td><td>🔡 <code>:abcd:</code></td><td>🔤 <code>:abc:</code></td></tr><tr><td>↙️ <code>:arrow_lower_left:</code></td><td>↘️ <code>:arrow_lower_right:</code></td><td>➡️ <code>:arrow_right:</code></td></tr><tr><td>⬆️ <code>:arrow_up:</code></td><td>↖️ <code>:arrow_upper_left:</code></td><td>↗️ <code>:arrow_upper_right:</code></td></tr><tr><td>⏬ <code>:arrow_double_down:</code></td><td>⏫ <code>:arrow_double_up:</code></td><td>🔽 <code>:arrow_down_small:</code></td></tr><tr><td>⤵️ <code>:arrow_heading_down:</code></td><td>⤴️ <code>:arrow_heading_up:</code></td><td>↩️<code>:leftwards_arrow_with_hook:</code></td></tr><tr><td>↪️ <code>:arrow_right_hook:</code></td><td>↔️ <code>:left_right_arrow:</code></td><td>↕️ <code>:arrow_up_down:</code></td></tr><tr><td>🔼 <code>:arrow_up_small:</code></td><td>🔃 <code>:arrows_clockwise:</code></td><td>🔄 <code>:arrows_counterclockwise:</code></td></tr><tr><td>⏪ <code>:rewind:</code></td><td>⏩ <code>:fast_forward:</code></td><td>ℹ️ <code>:information_source:</code></td></tr><tr><td>🆗 <code>:ok:</code></td><td>🔀 <code>:twisted_rightwards_arrows:</code></td><td>🔁 <code>:repeat:</code></td></tr><tr><td>🔂 <code>:repeat_one:</code></td><td>🆕 <code>:new:</code></td><td>🔝 <code>:top:</code></td></tr><tr><td>🆙 <code>:up:</code></td><td>🆒 <code>:cool:</code></td><td>🆓 <code>:free:</code></td></tr><tr><td>🆖 <code>:ng:</code></td><td>🎦 <code>:cinema:</code></td><td>🈁 <code>:koko:</code></td></tr><tr><td>📶 <code>:signal_strength:</code></td><td>🈹 <code>:u5272:</code></td><td>🈴 <code>:u5408:</code></td></tr><tr><td>🈺 <code>:u55b6:</code></td><td>🈯️ <code>:u6307:</code></td><td>🈷️ <code>:u6708:</code></td></tr><tr><td>🈶 <code>:u6709:</code></td><td>🈵 <code>:u6e80:</code></td><td>🈚️ <code>:u7121:</code></td></tr><tr><td>🈸 <code>:u7533:</code></td><td>🈳 <code>:u7a7a:</code></td><td>🈲 <code>:u7981:</code></td></tr><tr><td>🈂️ <code>:sa:</code></td><td>🚻 <code>:restroom:</code></td><td>🚹 <code>:mens:</code></td></tr><tr><td>🚺 <code>:womens:</code></td><td>🚼 <code>:baby_symbol:</code></td><td>🚭 <code>:no_smoking:</code></td></tr><tr><td>🅿️ <code>:parking:</code></td><td>♿️ <code>:wheelchair:</code></td><td>🚇 <code>:metro:</code></td></tr><tr><td>🛄 <code>:baggage_claim:</code></td><td>🉑 <code>:accept:</code></td><td>🚾 <code>:wc:</code></td></tr><tr><td>🚰 <code>:potable_water:</code></td><td>🚮 <code>:put_litter_in_its_place:</code></td><td>㊙️ <code>:secret:</code></td></tr><tr><td>㊗️ <code>:congratulations:</code></td><td>Ⓜ️ <code>:m:</code></td><td>🛂 <code>:passport_control:</code></td></tr><tr><td>🛅 <code>:left_luggage:</code></td><td>🛃 <code>:customs:</code></td><td>🉐 <code>:ideograph_advantage:</code></td></tr><tr><td>🆑 <code>:cl:</code></td><td>🆘 <code>:sos:</code></td><td>🆔 <code>:id:</code></td></tr><tr><td>🚫 <code>:no_entry_sign:</code></td><td>🔞 <code>:underage:</code></td><td>📵 <code>:no_mobile_phones:</code></td></tr><tr><td>🚯 <code>:do_not_litter:</code></td><td>🚱 <code>:non-potable_water:</code></td><td>🚳 <code>:no_bicycles:</code></td></tr><tr><td>🚷 <code>:no_pedestrians:</code></td><td>🚸 <code>:children_crossing:</code></td><td>⛔️ <code>:no_entry:</code></td></tr><tr><td>✳️ <code>:eight_spoked_asterisk:</code></td><td>✴️ <code>:eight_pointed_black_star:</code></td><td>💟 <code>:heart_decoration:</code></td></tr><tr><td>🆚 <code>:vs:</code></td><td>📳 <code>:vibration_mode:</code></td><td>📴 <code>:mobile_phone_off:</code></td></tr><tr><td>💹 <code>:chart:</code></td><td>💱 <code>:currency_exchange:</code></td><td>♈️ <code>:aries:</code></td></tr><tr><td>♉️ <code>:taurus:</code></td><td>♊️ <code>:gemini:</code></td><td>♋️ <code>:cancer:</code></td></tr><tr><td>♌️ <code>:leo:</code></td><td>♍️ <code>:virgo:</code></td><td>♎️ <code>:libra:</code></td></tr><tr><td>♏️ <code>:scorpius:</code></td><td>♐️ <code>:sagittarius:</code></td><td>♑️ <code>:capricorn:</code></td></tr><tr><td>♒️ <code>:aquarius:</code></td><td>♓️ <code>:pisces:</code></td><td>⛎ <code>:ophiuchus:</code></td></tr><tr><td>🔯 <code>:six_pointed_star:</code></td><td>❎<code>:negative_squared_cross_mark:</code></td><td>🅰️ <code>:a:</code></td></tr><tr><td>🅱️ <code>:b:</code></td><td>🆎 <code>:ab:</code></td><td>🅾️ <code>:o2:</code></td></tr><tr><td>💠<code>:diamond_shape_with_a_dot_inside:</code></td><td>♻️ <code>:recycle:</code></td><td>🔚 <code>:end:</code></td></tr><tr><td>🔛 <code>:on:</code></td><td>🔜 <code>:soon:</code></td><td>🕐 <code>:clock1:</code></td></tr><tr><td>🕜 <code>:clock130:</code></td><td>🕙 <code>:clock10:</code></td><td>🕥 <code>:clock1030:</code></td></tr><tr><td>🕚 <code>:clock11:</code></td><td>🕦 <code>:clock1130:</code></td><td>🕛 <code>:clock12:</code></td></tr><tr><td>🕧 <code>:clock1230:</code></td><td>🕑 <code>:clock2:</code></td><td>🕝 <code>:clock230:</code></td></tr><tr><td>🕒 <code>:clock3:</code></td><td>🕞 <code>:clock330:</code></td><td>🕓 <code>:clock4:</code></td></tr><tr><td>🕟 <code>:clock430:</code></td><td>🕔 <code>:clock5:</code></td><td>🕠 <code>:clock530:</code></td></tr><tr><td>🕕 <code>:clock6:</code></td><td>🕡 <code>:clock630:</code></td><td>🕖 <code>:clock7:</code></td></tr><tr><td>🕢 <code>:clock730:</code></td><td>🕗 <code>:clock8:</code></td><td>🕣 <code>:clock830:</code></td></tr><tr><td>🕘 <code>:clock9:</code></td><td>🕤 <code>:clock930:</code></td><td>💲 <code>:heavy_dollar_sign:</code></td></tr><tr><td>©️ <code>:copyright:</code></td><td>®️ <code>:registered:</code></td><td>™️ <code>:tm:</code></td></tr><tr><td>❌ <code>:x:</code></td><td>❗️ <code>:heavy_exclamation_mark:</code></td><td>‼️ <code>:bangbang:</code></td></tr><tr><td>⁉️ <code>:interrobang:</code></td><td>⭕️ <code>:o:</code></td><td>✖️ <code>:heavy_multiplication_x:</code></td></tr><tr><td>➕ <code>:heavy_plus_sign:</code></td><td>➖ <code>:heavy_minus_sign:</code></td><td>➗ <code>:heavy_division_sign:</code></td></tr><tr><td>💮 <code>:white_flower:</code></td><td>💯 <code>:100:</code></td><td>✔️ <code>:heavy_check_mark:</code></td></tr><tr><td>☑️ <code>:ballot_box_with_check:</code></td><td>🔘 <code>:radio_button:</code></td><td>🔗 <code>:link:</code></td></tr><tr><td>➰ <code>:curly_loop:</code></td><td>〰️ <code>:wavy_dash:</code></td><td>〽️ <code>:part_alternation_mark:</code></td></tr><tr><td>🔱 <code>:trident:</code></td><td>:black_square: <code>:black_square:</code></td><td>:white_square: <code>:white_square:</code></td></tr><tr><td>✅ <code>:white_check_mark:</code></td><td>🔲 <code>:black_square_button:</code></td><td>🔳 <code>:white_square_button:</code></td></tr><tr><td>⚫️ <code>:black_circle:</code></td><td>⚪️ <code>:white_circle:</code></td><td>🔴 <code>:red_circle:</code></td></tr><tr><td>🔵 <code>:large_blue_circle:</code></td><td>🔷 <code>:large_blue_diamond:</code></td><td>🔶 <code>:large_orange_diamond:</code></td></tr><tr><td>🔹 <code>:small_blue_diamond:</code></td><td>🔸 <code>:small_orange_diamond:</code></td><td>🔺 <code>:small_red_triangle:</code></td></tr><tr><td>🔻 <code>:small_red_triangle_down:</code></td><td></td><td></td></tr></tbody></table><h1 id="span-list"><a href="#span-list" class="headerlink" title="span list"></a>span list</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fas faa-ring animated-hover&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom:3px solid green&quot;</span>&gt;</span>《半小时漫画中国哲学史》<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">2</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>  <span class="attr">style</span>=<span class="string">&quot;text-align:center;font-size:20px;font:30px 书体坊兰亭体;color:blueviolent;word-spacing:30px;&quot;</span>&gt;</span>“ 既许一人以偏爱，愿尽余生之慷慨 ”<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">3</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;&quot;</span>&gt;</span>[data.json文件链接](https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA )<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> 4  </span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;background:royalBlue;border-bottom:lightblue 2px solid;color:white;font-family:consolas&quot;</span>&gt;</span>当使用重做日志文件来进行数据库恢复时，ORACLE将读取其中的重做记录(包括其中的修改向量)，并且将这些修改用于相关的块中。<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">5</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900&quot;</span>&gt;</span>存储结构管理主要就是通过对表空间的管理来实现的<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">6</span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;background:green;border-radius:10px;color:white&quot;</span>&gt;</span>效果如下：<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">7</span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">10px</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:700;font-family:&#x27;华文彩云&#x27;;color:rgb(100,190,100)&quot;</span>&gt;</span>基本语言(一)<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">8</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom: 2px dashed #000000&quot;</span>&gt;</span>代码段、数据段、BSS段、堆区、文件映射区以及栈区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">9</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background:black;font:conloas;color:white;&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;nbsp;</span>数组长度为：3<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;nbsp;</span>请按任意键继续. . .</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">10</span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;color:white;background:red;font-weight:600;border_radius:100px&quot;</span>&gt;</span>但效率更高<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><ol><li><span class="fas faa-ring animated-hover" style="border-bottom:3px solid green">《半小时漫画中国哲学史》</span></li></ol><hr><ol start="2"><li><span  style="text-align:center;font-size:20px;font:30px 书体坊兰亭体;color:blueviolent;word-spacing:30px;">“ 既许一人以偏爱，愿尽余生之慷慨 ”</span></li></ol><hr><ol start="3"><li><span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;"><a href="https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA">data.json文件链接</a></span></li></ol><hr><ol start="4"><li><mark style="background:royalBlue;border-bottom:lightblue 2px solid;color:white;font-family:consolas">当使用重做日志文件来进行数据库恢复时，ORACLE将读取其中的重做记录(包括其中的修改向量)，并且将这些修改用于相关的块中。</mark></li></ol><hr><ol start="5"><li><span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">存储结构管理主要就是通过对表空间的管理来实现的</span></li></ol><hr><ol start="6"><li><mark style="background:green;border-radius:10px;color:white;padding: 5px">效果如下：</mark></li></ol><hr><ol start="7"><li><font size=10px style="font-weight:700;font-family:'华文彩云';color:rgb(100,190,100)">基本语言(一)</font></li></ol><hr><ol start="8"><li><span style="border-bottom: 2px dashed #000000">代码段、数据段、BSS段、堆区、文件映射区以及栈区</span></li></ol><hr><ol start="9"><li><div style="background:black;font:conloas;color:white;">&nbsp; 数组长度为：3 <br>&nbsp; 请按任意键继续. . .</div></li><li><p><mark style="color:white;background:red;font-weight:600;border_radius:100px">但效率更高</mark></p></li></ol><h1 id="For-the-Badge"><a href="#For-the-Badge" class="headerlink" title="For the Badge"></a>For the Badge</h1><p><a href="https://forthebadge.com/">For the Badge</a></p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用变量名缩写</title>
      <link href="/%E6%89%8B%E5%86%8C/%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F%E5%90%8D%E7%BC%A9%E5%86%99/"/>
      <url>/%E6%89%8B%E5%86%8C/%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F%E5%90%8D%E7%BC%A9%E5%86%99/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>变量名</th><th>缩写</th></tr></thead><tbody><tr><td>addition</td><td>add</td></tr><tr><td>address</td><td>addr</td></tr><tr><td>administrator</td><td>adm</td></tr><tr><td>answer</td><td>ans</td></tr><tr><td>application</td><td>app</td></tr><tr><td>arguments</td><td>args</td></tr><tr><td>array</td><td>arr</td></tr><tr><td>assemble</td><td>asm</td></tr><tr><td>asynchronization</td><td>asyn</td></tr><tr><td>attribute</td><td>attr</td></tr><tr><td>authority&#x2F;authorize</td><td>auth</td></tr><tr><td>average</td><td>avg</td></tr><tr><td>begin</td><td>beg</td></tr><tr><td>bitmap</td><td>bmp</td></tr><tr><td>break</td><td>brk</td></tr><tr><td>buffer</td><td>buf&#x2F;buff</td></tr><tr><td>button</td><td>btn</td></tr><tr><td>calculate</td><td>calc</td></tr><tr><td>calendar</td><td>cal</td></tr><tr><td>character</td><td>char</td></tr><tr><td>click</td><td>clk</td></tr><tr><td>clock</td><td>clk</td></tr><tr><td>color</td><td>clr</td></tr><tr><td>column</td><td>col</td></tr><tr><td>command</td><td>cmd</td></tr><tr><td>compare</td><td>cmp</td></tr><tr><td>config</td><td>conf</td></tr><tr><td>configuration</td><td>cfg</td></tr><tr><td>container</td><td>cntr</td></tr><tr><td>control</td><td>ctrl</td></tr><tr><td>coordinates</td><td>coord</td></tr><tr><td>copy</td><td>cpy</td></tr><tr><td>count</td><td>cnt</td></tr><tr><td>current</td><td>cur</td></tr><tr><td>cylinder</td><td>cyl</td></tr><tr><td>database</td><td>db</td></tr><tr><td>debug</td><td>dbg</td></tr><tr><td>decrease</td><td>dec</td></tr><tr><td>default</td><td>def</td></tr><tr><td>define</td><td>def</td></tr><tr><td>delete</td><td>del</td></tr><tr><td>department</td><td>dept</td></tr><tr><td>dependency&#x2F;dependent&#x2F;depends</td><td>dep</td></tr><tr><td>destination</td><td>dst&#x2F;dest</td></tr><tr><td>develop</td><td>dev</td></tr><tr><td>device</td><td>dev</td></tr><tr><td>dialog</td><td>dlg</td></tr><tr><td>dictionary</td><td>dict</td></tr><tr><td>display</td><td>disp</td></tr><tr><td>division</td><td>div</td></tr><tr><td>document</td><td>doc</td></tr><tr><td>double</td><td>dbl</td></tr><tr><td>driver</td><td>drv</td></tr><tr><td>duplicate&#x2F;duplication</td><td>dup</td></tr><tr><td>educate&#x2F;education</td><td>edu</td></tr><tr><td>equal&#x2F;equality&#x2F;equivalence&#x2F;equivalent</td><td>eq</td></tr><tr><td>error</td><td>err</td></tr><tr><td>escape</td><td>esc</td></tr><tr><td>execute</td><td>exec</td></tr><tr><td>extend</td><td>ext</td></tr><tr><td>float</td><td>flt</td></tr><tr><td>frame</td><td>frm</td></tr><tr><td>frequency</td><td>freq</td></tr><tr><td>function</td><td>func</td></tr><tr><td>government</td><td>gov</td></tr><tr><td>group</td><td>grp</td></tr><tr><td>hexadecimal</td><td>hex</td></tr><tr><td>horizontal</td><td>horz</td></tr><tr><td>image</td><td>img</td></tr><tr><td>implement</td><td>impl</td></tr><tr><td>increment</td><td>inc</td></tr><tr><td>index</td><td>idx</td></tr><tr><td>individual</td><td>indv</td></tr><tr><td>information</td><td>info</td></tr><tr><td>initialize</td><td>init</td></tr><tr><td>insert</td><td>ins</td></tr><tr><td>instance</td><td>ins</td></tr><tr><td>interrupt</td><td>intr</td></tr><tr><td>iterator</td><td>it</td></tr><tr><td>lable</td><td>lbl</td></tr><tr><td>length</td><td>len</td></tr><tr><td>library</td><td>lib</td></tr><tr><td>link</td><td>lnk</td></tr><tr><td>list</td><td>lst</td></tr><tr><td>maximum</td><td>max</td></tr><tr><td>memory</td><td>mem</td></tr><tr><td>message</td><td>msg</td></tr><tr><td>middle</td><td>mid</td></tr><tr><td>minimum</td><td>min</td></tr><tr><td>multiplication</td><td>mul</td></tr><tr><td>navigation</td><td>nav</td></tr><tr><td>negative</td><td>neg</td></tr><tr><td>number</td><td>num</td></tr><tr><td>object</td><td>obj</td></tr><tr><td>offset</td><td>ofs</td></tr><tr><td>operator</td><td>opr</td></tr><tr><td>optimization</td><td>opt</td></tr><tr><td>organization</td><td>org</td></tr><tr><td>original</td><td>orig</td></tr></tbody></table><table><thead><tr><th>变量名</th><th>缩写</th></tr></thead><tbody><tr><td>package</td><td>pkg</td></tr><tr><td>parameter</td><td>param</td></tr><tr><td>password</td><td>pwd</td></tr><tr><td>picture</td><td>pic</td></tr><tr><td>point</td><td>pt</td></tr><tr><td>pointer</td><td>ptr</td></tr><tr><td>position</td><td>pos</td></tr><tr><td>positive</td><td>pos</td></tr><tr><td>previous</td><td>pre</td></tr><tr><td>print</td><td>prn</td></tr><tr><td>program</td><td>prg</td></tr><tr><td>properties</td><td>props</td></tr><tr><td>public</td><td>pub</td></tr><tr><td>receive&#x2F;received</td><td>recv</td></tr><tr><td>record</td><td>rec</td></tr><tr><td>reference</td><td>ref</td></tr><tr><td>register</td><td>reg</td></tr><tr><td>request</td><td>req</td></tr><tr><td>resource</td><td>res</td></tr><tr><td>result</td><td>res</td></tr><tr><td>response</td><td>rsp</td></tr><tr><td>return</td><td>ret</td></tr><tr><td>screen</td><td>scr</td></tr><tr><td>second</td><td>sec</td></tr><tr><td>segment</td><td>seg</td></tr><tr><td>select</td><td>sel</td></tr><tr><td>semaphore</td><td>sem</td></tr><tr><td>sequence</td><td>seq</td></tr><tr><td>server</td><td>srv</td></tr><tr><td>signal</td><td>sig</td></tr><tr><td>source</td><td>src</td></tr><tr><td>stack</td><td>stk</td></tr><tr><td>standard</td><td>std</td></tr><tr><td>statistic</td><td>stat</td></tr><tr><td>status</td><td>stat</td></tr><tr><td>storage</td><td>stg</td></tr><tr><td>string</td><td>str</td></tr><tr><td>student</td><td>stu</td></tr><tr><td>subtraction</td><td>sub</td></tr><tr><td>summation&#x2F;summary</td><td>sum</td></tr><tr><td>synchronize</td><td>sync</td></tr><tr><td>system</td><td>sys</td></tr><tr><td>table</td><td>tbl</td></tr><tr><td>temporary</td><td>tmp&#x2F;temp</td></tr><tr><td>test</td><td>tst</td></tr><tr><td>text</td><td>txt</td></tr><tr><td>time stamp</td><td>ts</td></tr><tr><td>total</td><td>tot</td></tr><tr><td>translate</td><td>trans</td></tr><tr><td>update</td><td>upd</td></tr><tr><td>upgrade</td><td>upg</td></tr><tr><td>unknown</td><td>unk</td></tr><tr><td>user</td><td>usr</td></tr><tr><td>utility</td><td>util</td></tr><tr><td>value</td><td>val</td></tr><tr><td>variable</td><td>var</td></tr><tr><td>version</td><td>ver</td></tr><tr><td>vertical</td><td>vert</td></tr><tr><td>window</td><td>win</td></tr><tr><td>thread</td><td>thrd</td></tr><tr><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 变量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fork快捷键整理</title>
      <link href="/%E6%89%8B%E5%86%8C/%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%95%B4%E7%90%86/Fork/"/>
      <url>/%E6%89%8B%E5%86%8C/%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%95%B4%E7%90%86/Fork/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="Fork-快捷键"><a href="#Fork-快捷键" class="headerlink" title="Fork 快捷键"></a>Fork 快捷键</h1><h5 id="General-Navigation"><a href="#General-Navigation" class="headerlink" title="General Navigation"></a>General Navigation</h5><ul><li>Ctrl1 - Show Changes view (second press will focus commit field)</li><li>Ctrl2 - Show All Commits view (second press will jump to HEAD)</li><li>Ctrl0 - Reveal HEAD</li><li>CtrlP - Show Quick Launch window</li><li>CtrlTab - Select next tab</li><li>CtrlShiftTab - Select previous tab</li><li>CtrlT - Open new tab</li><li>CtrlW - Close current tab</li><li>Ctrl&#x3D;&#x2F;Ctrl- Zoom in&#x2F; Zoom out</li><li>Ctrl, - Open Fork preferences</li></ul><h5 id="All-Commits-View"><a href="#All-Commits-View" class="headerlink" title="All Commits View"></a>All Commits View</h5><ul><li>Ctrl0 - Jump to HEAD</li><li>CtrlF - Commit search</li><li><ul><li>Enter, F3 - Jump to next search result</li></ul></li><li><ul><li>ShiftEnter, ShiftF3 - Jump to previous search result</li></ul></li><li>CtrlC - Copy commit info</li><li>Delete - Remove branch&#x2F;stash</li><li>CtrlShiftA - Filter by active branch</li></ul><h5 id="Changes-View"><a href="#Changes-View" class="headerlink" title="Changes View"></a>Changes View</h5><ul><li>CtrlEnter - Commit</li><li>CtrlShiftEnter - Commit and push</li><li>Ctrl1 - Focus commit message field</li><li>CtrlF - Filter</li><li>Enter, CtrlShiftS - Stage&#x2F;unstage selected file (or lines)</li><li>CtrlAltShiftS - Stage&#x2F;unstage all files</li><li>Backspace, CtrlShiftD - Discard selected file (or lines)</li><li>CtrlO - Open selected file</li><li>CtrlD - Open selected file in external diff tool</li><li>CtrlC - Copy selected file full path</li></ul><h5 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h5><ul><li>F5 - Refresh</li><li>CtrlShiftN - Init new repository</li><li>CtrlN - Clone new repository</li><li>CtrlO - Open repository</li><li>CtrlShiftF - Fetch</li><li>CtrlAltShiftF (Ctrl + click on button) - Quick Fetch</li><li>CtrlShiftL - Pull</li><li>CtrlAltShiftL (Ctrl + click on button) - Quick Pull</li><li>CtrlShiftP - Push</li><li>CtrlAltShiftP (Ctrl + click on button) - Quick Push</li><li>CtrlShiftB - New branch</li><li>CtrlShiftT - New tag</li><li>CtrlShiftH - Create stash</li><li>CtrlAltO - Open in File Explorer</li><li>CtrlAltT - Open in Terminal</li></ul><h5 id="Repository-Manager"><a href="#Repository-Manager" class="headerlink" title="Repository Manager"></a>Repository Manager</h5><ul><li>F2 - Rename Repository</li><li>Delete - Remove Repository</li><li>Enter - Open Repository</li></ul>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 快捷键整理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 快捷键 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wiki自动更新脚本</title>
      <link href="/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E8%84%9A%E6%9C%AC/"/>
      <url>/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">:reInput</span><br><span class="line"></span><br><span class="line">echo                                      Git自动更新脚本（输入序号选择命令）</span><br><span class="line">echo ===================================================================================</span><br><span class="line">echo 1 （:memo: 更新文档）</span><br><span class="line">echo 2 （:fire:）</span><br><span class="line">echo 3 （:wrench: 部署）</span><br><span class="line">echo 4 （:bug:）</span><br><span class="line">echo 5 （手动添加commit信息）</span><br><span class="line">echo ===================================================================================</span><br><span class="line">echo.</span><br><span class="line"></span><br><span class="line">echo=</span><br><span class="line">choice /c:12345 /m:&quot;请输入Git 数字命令更新变动：&quot;</span><br><span class="line">if %errorlevel% == 1 set change=&quot;:memo: 更新文档&quot;</span><br><span class="line">if %errorlevel% == 2 set change=&quot;:bug:&quot;</span><br><span class="line">if %errorlevel% == 3 set change=&quot;:wrench: 部署&quot;</span><br><span class="line">if %errorlevel% == 4 set change=&quot;:bug:&quot;</span><br><span class="line">if %errorlevel% == 5 set /p change=&quot;请输入Commit信息：&quot;</span><br><span class="line"></span><br><span class="line">if %change%==&quot;&quot; (</span><br><span class="line">cls</span><br><span class="line">echo -------</span><br><span class="line">echo 提交信息不能为空！</span><br><span class="line">echo -------</span><br><span class="line">goto reInput </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">echo.</span><br><span class="line"></span><br><span class="line">:: cd &quot;D:\\wiki\\&quot;</span><br><span class="line"></span><br><span class="line">git pull</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m %change%</span><br><span class="line"></span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line">echo.</span><br><span class="line">echo ===================================================================================</span><br><span class="line">echo                                      更新完毕</span><br><span class="line">echo.</span><br><span class="line">title &quot; update SUCCESS&quot;</span><br><span class="line">pause</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 个人配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 自定义 </tag>
            
            <tag> Config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typora bluebook 自定义修改主题代码</title>
      <link href="/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/typora%E4%B8%BB%E9%A2%98%E8%87%AA%E5%AE%9A%E4%B9%89/"/>
      <url>/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/typora%E4%B8%BB%E9%A2%98%E8%87%AA%E5%AE%9A%E4%B9%89/</url>
      
        <content type="html"><![CDATA[<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><ol><li>修改了目录中 代码块 的颜色</li><li>修改了编辑页面的最小宽度</li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义表格 */</span></span><br><span class="line"><span class="selector-tag">tr</span><span class="selector-class">.md-end-block</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: dodgerblue;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** Custom fonts ***/</span></span><br><span class="line"><span class="keyword">@import</span> url(<span class="string">&#x27;./blubook/fonts.css&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** Color setting ***/</span></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attr">--side-bar-bg-color</span>: <span class="number">#183055</span>;</span><br><span class="line">  <span class="attr">--active-file-bg-color</span>: <span class="number">#2f4566</span>;</span><br><span class="line">  <span class="attr">--active-file-text-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attr">--active-file-border-color</span>: <span class="number">#757575</span>;</span><br><span class="line">  <span class="attr">--active-search-item-bg-color</span>: <span class="number">#23242b</span>;</span><br><span class="line">  <span class="attr">--item-hover-bg-color</span>: <span class="number">#ececec</span>;</span><br><span class="line">  <span class="attr">--item-hover-text-color</span>: <span class="number">#000000</span>;</span><br><span class="line">  <span class="attr">--control-text-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attr">--window-border</span>: <span class="number">1px</span> solid <span class="number">#183055</span>;</span><br><span class="line">  <span class="attr">--code-cursor</span>: <span class="number">#f0f0f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** Btn in search bar ***/</span></span><br><span class="line"><span class="selector-id">#filesearch-case-option-btn</span>,</span><br><span class="line"><span class="selector-id">#filesearch-word-option-btn</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--side-bar-bg-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** #write basic ******/</span></span><br><span class="line"><span class="selector-id">#write</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: static;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">700px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">  <span class="attribute">transform</span>: none;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** #write h1-h6 ******/</span></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h3</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h4</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-id">#write</span> pre &#123;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="built_in">calc</span>(<span class="number">100%</span> + <span class="number">10px</span>);</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#b4b4b4</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-variant</span>: <span class="string">&#x27;small-caps&#x27;</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: auto;</span><br><span class="line">  <span class="attribute">float</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2.2rem</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H1&#x27;</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H2&#x27;</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: .<span class="number">85rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.6rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H3&#x27;</span>;</span><br><span class="line">  <span class="attribute">top</span>: .<span class="number">44rem</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">3px</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h4</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.4rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H4&#x27;</span>;</span><br><span class="line">  <span class="attribute">top</span>: .<span class="number">4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: .<span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H5&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;H6&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-class">.md-focus</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--heading-char-color);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">1.642857143rem</span>;</span><br><span class="line">  <span class="attribute">top</span>: .<span class="number">357142857rem</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">9px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Global Style ******/</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Glow Sans SC&#x27;</span>, -apple-system, sans-serif;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">text-rendering</span>: geometricPrecision;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -webkit-text-size-adjust: <span class="number">100%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#242A31</span>;</span><br><span class="line">  <span class="comment">/* width: 100%; */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1rem</span>;</span><br><span class="line">  text-size-adjust: <span class="number">100%</span>;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">  -webkit-text-size-adjust: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hr &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#e6ecf1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">2px</span> solid <span class="number">#e6ecf1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">80%</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0.2rem</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** ul ol Style ******/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ul</span>&gt;<span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: circle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ul</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ul</span>&gt;<span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: square;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>,</span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: decimal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: lower-alpha</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span>&gt;<span class="selector-tag">ol</span>&gt;<span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: lower-roman</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Table Style ******/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: initial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#dfe2e5</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>n),</span><br><span class="line"><span class="selector-tag">thead</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f7f9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">th</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#dfe2e5</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">13px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#dfe2e5</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">13px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">th</span><span class="selector-pseudo">:first</span>-child,</span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">td</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">th</span><span class="selector-pseudo">:last-child</span>,</span><br><span class="line"><span class="selector-tag">table</span> <span class="selector-tag">tr</span> <span class="selector-tag">td</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** YAML Style ******/</span></span><br><span class="line">pre<span class="selector-class">.md-meta-block</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: .<span class="number">85rem</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#5d5d5d</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: .<span class="number">8rem</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: pre-wrap;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f5f7f9</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Global Text ******/</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;Glow Sans SC&quot;</span>, -apple-system, sans-serif;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">59</span>, <span class="number">69</span>, <span class="number">78</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="comment">/* color: rgb(164, 78, 237); */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">56</span>, <span class="number">132</span>, <span class="number">254</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">  <span class="attribute">text-decoration-style</span>: none;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">0</span> <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">56</span>, <span class="number">132</span>, <span class="number">254</span>);</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">  <span class="attribute">text-decoration-style</span>: solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">strong</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">mark</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#87CEFA</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.6rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h4</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h5</span>,</span><br><span class="line"><span class="selector-tag">h6</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Print header ******/</span></span><br><span class="line"><span class="keyword">@media</span> print &#123;</span><br><span class="line">  <span class="selector-class">.typora-export</span> * &#123;</span><br><span class="line">    -webkit-print-<span class="attribute">color</span>-adjust: exact;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#write</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** #write Code Fences ******/</span></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-class">.md-fences</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: initial;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">1rem</span> <span class="number">0</span> <span class="number">1rem</span> <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.43rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">  <span class="attribute">word-wrap</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-class">.CodeMirror-wrap</span> <span class="selector-class">.CodeMirror-code</span> pre &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.55rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-class">.CodeMirror-cursors</span> <span class="selector-class">.CodeMirror-cursor</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--code-cursor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">code</span>,</span><br><span class="line">tt &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.92rem</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f5f7f9</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-class">.md-footnote</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--main-<span class="number">5</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--main-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span><span class="selector-class">.CodeMirror</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-gutters</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.75rem</span> <span class="number">0.15rem</span> <span class="number">0.75rem</span> <span class="number">0.15rem</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#183055</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f8f8f2</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.code-tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">28</span>, <span class="number">36</span>, .<span class="number">3</span>);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eef2f2</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#183055</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-fences</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: .<span class="number">9rem</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">page-break-inside</span>: avoid;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">  <span class="attribute">overflow</span>: visible;</span><br><span class="line">  <span class="attribute">white-space</span>: pre;</span><br><span class="line">  <span class="attribute">background</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-fences</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f8f8f8</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-fences</span>,</span><br><span class="line">tt &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="comment">/* color: #f0f0f0; */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Sidebar ******/</span></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> * &#123;</span><br><span class="line">  <span class="comment">/* color: #f0f0f0; */</span></span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">code</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3399CC</span><span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-class">.file-tree-node</span><span class="selector-class">.file-library-file-node</span><span class="selector-class">.active</span> <span class="selector-class">.file-node-background</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">5px</span> solid <span class="number">#3884ff</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-files-menu</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list-item</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="built_in">var</span>(--window-border);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list-item</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="built_in">var</span>(--window-border);</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: top .<span class="number">5s</span>;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: top .<span class="number">5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list-item</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2f4566</span>;</span><br><span class="line">  <span class="comment">/* background: var(--active-file-bg-color); */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--active-file-text-color);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list-item</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.active</span>) &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: .<span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-node-content</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: default;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--control-text-color);</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2.2rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ty-on-drag-enter</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#2f4566</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--item-hover-text-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-node-content</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2f4566</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.active</span> <span class="selector-class">.file-node-content</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-node-content</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-node-icon</span>,</span><br><span class="line"><span class="selector-class">.file-node-open-state</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-node-icon</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.file-list-item-file-name</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar-footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--side-bar-bg-color);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> <span class="number">#555</span> solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.html-for-mac</span> <span class="selector-id">#file-library-search-input</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">16px</span> <span class="number">0px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/* -webkit-flex: 1; */</span></span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#bbc0ca</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="comment">/* transform: translateY(-3px); */</span></span><br><span class="line">  <span class="comment">/* overflow: auto; */</span></span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-class">.sidebar-footer-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#021d43</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#outline-content</span> <span class="selector-class">.outline-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#202020</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-id">#sidebar-files-menu</span> <span class="selector-class">.show</span>+<span class="selector-class">.menuitem-group-label</span><span class="selector-class">.show</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#202020</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#19191c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-id">#sidebar-files-menu</span> <span class="selector-tag">li</span>&gt;<span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#021d43</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-id">#sidebar-files-menu</span> <span class="selector-class">.ty-side-sort-btn</span><span class="selector-class">.active</span>,</span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-id">#sidebar-files-menu</span> <span class="selector-class">.ty-side-sort-btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3884FF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-id">#ty-sidebar-footer</span> <span class="selector-id">#sidebar-files-menu</span> <span class="selector-class">.ty-side-sort-btn</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#001129</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-class">.file-list-item</span><span class="selector-class">.file-library-node</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.active</span>)<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#243959</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-sidebar</span> <span class="selector-class">.file-tree-node</span><span class="selector-class">.file-library-file-node</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.active</span>)<span class="selector-pseudo">:hover</span> <span class="selector-class">.file-node-background</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#243959</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Quote style ******/</span></span><br><span class="line"><span class="selector-tag">blockquote</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="comment">/*  margin: 1rem 1 1rem 2rem; */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#827676</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f7f9</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">blockquote</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0rem</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: .<span class="number">30rem</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#3884ff</span>;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** task list style ******/</span></span><br><span class="line"><span class="selector-class">.task-list</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">0.2rem</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.6rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">calc</span>(<span class="number">1rem</span> + <span class="number">1px</span>);</span><br><span class="line">  -webkit-appearance: initial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid<span class="number">#0185ff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  <span class="attribute">transition</span>: background-color <span class="number">200ms</span> ease-in-out;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-pseudo">:checked</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-attr">[checked]</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#0185ff</span>;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: background-color <span class="number">200ms</span> ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-pseudo">:checked</span><span class="selector-pseudo">:after</span>,</span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-attr">[checked]</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: opacity <span class="number">0.05s</span> ease-in-out;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: opacity <span class="number">0.05s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.05s</span> ease-in-out;</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">  -moz-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0.25rem</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0.19rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0.6rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0.375rem</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Source style ******/</span></span><br><span class="line"><span class="selector-class">.typora-sourceview-on</span> <span class="selector-id">#write</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: inherit;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mac-seamless-mode</span> <span class="selector-id">#typora-source</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">20px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-gutters</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: initial <span class="meta">!important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-lines</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">800px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-wrap</span> <span class="selector-class">.CodeMirror-scroll</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.CodeMirror-activeline</span> <span class="selector-class">.cm-trailing-space-new-line</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: .<span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.CodeMirror-activeline</span> <span class="selector-class">.cm-starttab</span> <span class="selector-class">.cm-tab</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=</span>);</span><br><span class="line">  <span class="attribute">background-position</span>: right;</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.CodeMirror-activeline</span> <span class="selector-class">.cm-startspace</span><span class="selector-pseudo">:after</span>,</span><br><span class="line"><span class="selector-class">.CodeMirror-activeline</span> <span class="selector-class">.cm-trailing-space-new-line</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: .<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-vscrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-gutter-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">6ch</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">4ch</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">  <span class="attribute">font-family</span>: monospace;</span><br><span class="line">  <span class="attribute">font-size</span>: .<span class="number">8rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: .<span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">opacity</span>: .<span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-linenumber</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: auto <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-sizer</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">0</span> <span class="meta">!important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-gutter</span> &#123;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">4ch</span> <span class="meta">!important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-activeline</span> <span class="selector-class">.CodeMirror-linenumber</span>,</span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-linenumber</span><span class="selector-class">.CodeMirror-linenumber-show</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: visible</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-code</span>&gt;<span class="selector-class">.CodeMirror-activeline</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-code</span>&gt;<span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-code</span>&gt;<span class="selector-pseudo">:last-child</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#typora-source</span> <span class="selector-class">.CodeMirror-code</span>&gt;<span class="selector-pseudo">:nth-child</span>(<span class="number">10</span>n)<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: visible</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header1</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header2</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header3</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.6rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header4</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header5</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header6</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-atom</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.cm-s-inner</span>) &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-header</span>,</span><br><span class="line"><span class="selector-class">.cm-s-typora-default</span> <span class="selector-class">.cm-property</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#183055</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pre<span class="selector-class">.CodeMirror-line</span> &#123;</span><br><span class="line">  <span class="attribute">page-break-inside</span>: avoid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Code style ******/</span></span><br><span class="line"><span class="selector-tag">code</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: .<span class="number">9rem</span>;</span><br><span class="line">  <span class="comment">/*   color: #333333; /*  #537AA2;  </span></span><br><span class="line"><span class="comment">      border: 1px solid #d0d0d0;  */</span></span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Cascadia Code&#x27;</span>, Consolas, <span class="string">&#x27;Noto Sans SC&#x27;</span>, <span class="string">&#x27;Courier New&#x27;</span>, monospace;</span><br><span class="line">  <span class="attribute">padding</span>: .<span class="number">2rem</span> .<span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f5f7f9</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">code</span>,</span><br><span class="line">pre &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">95%</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Cascadia Code&#x27;</span>, Consolas, <span class="string">&#x27;Noto Sans SC&#x27;</span>, <span class="string">&#x27;Courier New&#x27;</span>, monospace;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: initial;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: initial</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** The flow chart ******/</span></span><br><span class="line">pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=sequence]</span><span class="selector-class">.md-focus</span> <span class="selector-class">.md-diagram-panel</span>,</span><br><span class="line">pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=flow]</span><span class="selector-class">.md-focus</span> <span class="selector-class">.md-diagram-panel</span>,</span><br><span class="line">pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=mermaid]</span><span class="selector-class">.md-focus</span> <span class="selector-class">.md-diagram-panel</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: -webkit-sticky;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#777</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.code-tooltip</span> <span class="selector-class">.ty-input</span>,</span><br><span class="line"><span class="selector-class">.code-tooltip</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">140px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.enable-diagrams</span> pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=sequence]</span> <span class="selector-class">.code-tooltip</span>,</span><br><span class="line"><span class="selector-class">.enable-diagrams</span> pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=flow]</span> <span class="selector-class">.code-tooltip</span>,</span><br><span class="line"><span class="selector-class">.enable-diagrams</span> pre<span class="selector-class">.md-fences</span><span class="selector-attr">[lang=mermaid]</span> <span class="selector-class">.code-tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: -<span class="number">2.2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Windows contral ******/</span></span><br><span class="line"><span class="selector-class">.megamenu-menu-list</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-class">.active</span>,</span><br><span class="line"><span class="selector-class">.megamenu-menu-list</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.saved</span>) <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#285e8e</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Fix ******/</span></span><br><span class="line"><span class="selector-class">.md-tab</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">white-space</span>: pre;</span><br><span class="line">  <span class="attribute">font-family</span>: initial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.md-mathjax-preview</span><span class="selector-class">.mathjax-candidate</span><span class="selector-class">.mathjax-candidate-show</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: white <span class="meta">!important</span>;</span><br><span class="line">  -webkit-user-modify: read-only;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mathjax-candidate</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">padding-top</span>: inherit;</span><br><span class="line">  <span class="attribute">overflow-x</span>: auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">background-color</span>: inherit;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#write</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">6.5px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-list</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-task-list-item</span>&gt;<span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">0.2rem</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.6rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">calc</span>(<span class="number">1rem</span> + <span class="number">1px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.auto-suggest-container</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  -webkit-user-select: none;</span><br><span class="line">  user-select: none;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">124px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.auto-suggest-container</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">1</span>);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: .<span class="number">9rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">6px</span> <span class="number">4px</span> <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** Code highlight ******/</span></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-guttermarker</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-guttermarker-subtle</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-linenumber</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#596774</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-cursor</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#f8f8f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-tag">div</span><span class="selector-class">.CodeMirror-selected</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.15</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span><span class="selector-class">.CodeMirror-focused</span> <span class="selector-tag">div</span><span class="selector-class">.CodeMirror-selected</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span><span class="selector-pseudo">::selection</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">::selection</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span>&gt;<span class="selector-tag">span</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">::selection</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-line</span>::-moz-selection,</span><br><span class="line">.cm-s-inner .CodeMirror-line&gt;span::-moz-selection,</span><br><span class="line">.cm-s-inner .CodeMirror-line&gt;span&gt;span::-moz-selection &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-activeline-background</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-keyword</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">199</span>, <span class="number">146</span>, <span class="number">234</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-operator</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">233</span>, <span class="number">237</span>, <span class="number">237</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-2</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#80CBC4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-3</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#82B1FF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-builtin</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#DECB6B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-atom</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#F77669</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-number</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#F77669</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-def</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">233</span>, <span class="number">237</span>, <span class="number">237</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-string</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#C3E88D</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-string-2</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#80CBC4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-comment</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#aebcc2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#82B1FF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-tag</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#80CBC4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-meta</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#80CBC4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-attribute</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFCB6B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-property</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#80CBAE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-qualifier</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#DECB6B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-variable-3</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#DECB6B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-tag</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">83</span>, <span class="number">112</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-error</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">1.0</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#EC5F67</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.CodeMirror-matchingbracket</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">  <span class="attribute">color</span>: white <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cm-s-inner</span> <span class="selector-class">.cm-header</span>,</span><br><span class="line"><span class="selector-class">.cm-s-inner</span><span class="selector-class">.cm-header</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#334EEA</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md-fences</span> <span class="selector-class">.code-tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#263238</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 个人配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 自定义 </tag>
            
            <tag> themes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数声明</title>
      <link href="/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E5%87%BD%E6%95%B0%E6%96%87%E4%BB%B6TODO%E5%A3%B0%E6%98%8E/"/>
      <url>/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/%E5%87%BD%E6%95%B0%E6%96%87%E4%BB%B6TODO%E5%A3%B0%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<h1 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">* @fn           $MethodName$</span><br><span class="line">* @brief        </span><br><span class="line">* @param[in]    </span><br><span class="line">* @param[out]   </span><br><span class="line">* @return       </span><br><span class="line">*               </span><br><span class="line">* @detail      </span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h1 id="文件声明"><a href="#文件声明" class="headerlink" title="文件声明"></a>文件声明</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/********************************************************************************</span><br><span class="line"> *</span><br><span class="line"> *        Copyright (C) 2022 QIANXIN</span><br><span class="line"> *        All rights reserved</span><br><span class="line"> *</span><br><span class="line"> *        filename:    $FILE$</span><br><span class="line"> *        description: </span><br><span class="line"> *</span><br><span class="line"> *        created by  shi.mingming on $DATE$</span><br><span class="line"> *</span><br><span class="line"> ********************************************************************************/</span><br></pre></td></tr></table></figure><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// TODO(shimingming@qianxin.com): what: when:? how:？</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 个人配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3-hexo 主题快捷键</title>
      <link href="/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/3-hexo%E4%B8%BB%E9%A2%98%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/%E6%89%8B%E5%86%8C/%E4%B8%AA%E4%BA%BA%E9%85%8D%E7%BD%AE/3-hexo%E4%B8%BB%E9%A2%98%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<p>快捷键为vim风格的。按键可能与vimium（chrome插件）的快捷键有冲突，插件设置屏蔽掉此站的快捷键即可</p><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><h3 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h3><table><thead><tr><th align="left">Key</th><th align="left">Descption</th></tr></thead><tbody><tr><td align="left">s&#x2F;S</td><td align="left">全屏&#x2F;取消全屏</td></tr><tr><td align="left">w&#x2F;W</td><td align="left">打开&#x2F;关闭文章目录</td></tr><tr><td align="left">i&#x2F;I</td><td align="left">获取搜索框焦点</td></tr><tr><td align="left">j&#x2F;J</td><td align="left">向下滑动</td></tr><tr><td align="left">k&#x2F;K</td><td align="left">向上滑动</td></tr><tr><td align="left">gg&#x2F;GG</td><td align="left">到最顶端</td></tr><tr><td align="left">shift+G&#x2F;g</td><td align="left">到最下端</td></tr></tbody></table><h3 id="搜索框"><a href="#搜索框" class="headerlink" title="搜索框"></a>搜索框</h3><table><thead><tr><th align="left">Key</th><th align="left">Descption</th></tr></thead><tbody><tr><td align="left">ESC</td><td align="left">1.如果输入框有内容，清除内容 2.如果输入框无内容，失去焦点</td></tr><tr><td align="left">下</td><td align="left">向下选择文章</td></tr><tr><td align="left">上</td><td align="left">向上选择文章</td></tr><tr><td align="left">回车</td><td align="left">打开当前选中的文章，若没有，则默认打开第一个</td></tr></tbody></table><h3 id="关闭快捷键"><a href="#关闭快捷键" class="headerlink" title="关闭快捷键"></a>关闭快捷键</h3><p>在主题下 <code>_config.yml</code> 中 找到 <code>shortcutKey</code> 设为 <code>false</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shortcutKey: false</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> 个人配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 快捷键 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>winDbg 调试手册</title>
      <link href="/%E6%89%8B%E5%86%8C/WinDbg/%E8%B0%83%E8%AF%95%E6%89%8B%E5%86%8C/"/>
      <url>/%E6%89%8B%E5%86%8C/WinDbg/%E8%B0%83%E8%AF%95%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>相关工具整理：</p><ol><li>API Monitor</li><li>PCHunter工具</li><li>windbg脚本</li></ol></blockquote><p>分析32位</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.load wow64exts</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> WinDbg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windbg </tag>
            
            <tag> 调试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Typora Emoji</title>
      <link href="/%E6%89%8B%E5%86%8C/Typora%20Emoji/"/>
      <url>/%E6%89%8B%E5%86%8C/Typora%20Emoji/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="People"><a href="#People" class="headerlink" title="People"></a>People</h1><table><thead><tr><th>😄 <code>:smile:</code></th><th>😆 <code>:laughing:</code></th><th></th></tr></thead><tbody><tr><td>😊 <code>:blush:</code></td><td>😃 <code>:smiley:</code></td><td>☺️ <code>:relaxed:</code></td></tr><tr><td>😏 <code>:smirk:</code></td><td>😍 <code>:heart_eyes:</code></td><td>😘 <code>:kissing_heart:</code></td></tr><tr><td>😚 <code>:kissing_closed_eyes:</code></td><td>😳 <code>:flushed:</code></td><td>😌 <code>:relieved:</code></td></tr><tr><td>😆 <code>:satisfied:</code></td><td>😁 <code>:grin:</code></td><td>😉 <code>:wink:</code></td></tr><tr><td>😜 <code>:stuck_out_tongue_winking_eye:</code></td><td>😝 <code>:stuck_out_tongue_closed_eyes:</code></td><td>😀 <code>:grinning:</code></td></tr><tr><td>😗 <code>:kissing:</code></td><td>😙 <code>:kissing_smiling_eyes:</code></td><td>😛 <code>:stuck_out_tongue:</code></td></tr><tr><td>😴 <code>:sleeping:</code></td><td>😟 <code>:worried:</code></td><td>😦 <code>:frowning:</code></td></tr><tr><td>😧 <code>:anguished:</code></td><td>😮 <code>:open_mouth:</code></td><td>😬 <code>:grimacing:</code></td></tr><tr><td>😕 <code>:confused:</code></td><td>😯 <code>:hushed:</code></td><td>😑 <code>:expressionless:</code></td></tr><tr><td>😒 <code>:unamused:</code></td><td>😅 <code>:sweat_smile:</code></td><td>😓 <code>:sweat:</code></td></tr><tr><td>😥 <code>:disappointed_relieved:</code></td><td>😩 <code>:weary:</code></td><td>😔 <code>:pensive:</code></td></tr><tr><td>😞 <code>:disappointed:</code></td><td>😖 <code>:confounded:</code></td><td>😨 <code>:fearful:</code></td></tr><tr><td>😰 <code>:cold_sweat:</code></td><td>😣 <code>:persevere:</code></td><td>😢 <code>:cry:</code></td></tr><tr><td>😭 <code>:sob:</code></td><td>😂 <code>:joy:</code></td><td>😲 <code>:astonished:</code></td></tr><tr><td>😱 <code>:scream:</code></td><td>😫 <code>:tired_face:</code></td><td></td></tr><tr><td>😠 <code>:angry:</code></td><td>😡 <code>:rage:</code></td><td>😤 <code>:triumph:</code></td></tr><tr><td>😪 <code>:sleepy:</code></td><td>😋 <code>:yum:</code></td><td>😷 <code>:mask:</code></td></tr><tr><td>😎 <code>:sunglasses:</code></td><td>😵 <code>:dizzy_face:</code></td><td>👿 <code>:imp:</code></td></tr></tbody></table><p>显示详细信息</p><table><thead><tr><th>😈 <code>:smiling_imp:</code></th><th>😐 <code>:neutral_face:</code></th><th>😶 <code>:no_mouth:</code></th></tr></thead><tbody><tr><td>😇 <code>:innocent:</code></td><td>👽 <code>:alien:</code></td><td>💛 <code>:yellow_heart:</code></td></tr><tr><td>💙 <code>:blue_heart:</code></td><td>💜 <code>:purple_heart:</code></td><td>❤️ <code>:heart:</code></td></tr><tr><td>💚 <code>:green_heart:</code></td><td>💔 <code>:broken_heart:</code></td><td>💓 <code>:heartbeat:</code></td></tr><tr><td>💗 <code>:heartpulse:</code></td><td>💕 <code>:two_hearts:</code></td><td>💞 <code>:revolving_hearts:</code></td></tr><tr><td>💘 <code>:cupid:</code></td><td>💖 <code>:sparkling_heart:</code></td><td>✨ <code>:sparkles:</code></td></tr><tr><td>⭐️ <code>:star:</code></td><td>🌟 <code>:star2:</code></td><td>💫 <code>:dizzy:</code></td></tr><tr><td>💥 <code>:boom:</code></td><td>💥 <code>:collision:</code></td><td>💢 <code>:anger:</code></td></tr><tr><td>❗️ <code>:exclamation:</code></td><td>❓ <code>:question:</code></td><td>❕ <code>:grey_exclamation:</code></td></tr><tr><td>❔ <code>:grey_question:</code></td><td>💤 <code>:zzz:</code></td><td>💨 <code>:dash:</code></td></tr><tr><td>💦 <code>:sweat_drops:</code></td><td>🎶 <code>:notes:</code></td><td>🎵 <code>:musical_note:</code></td></tr><tr><td>🔥 <code>:fire:</code></td><td>💩 <code>:hankey:</code></td><td>💩 <code>:poop:</code></td></tr><tr><td>💩 <code>:shit:</code></td><td>👍 <code>:+1:</code></td><td>👍 <code>:thumbsup:</code></td></tr><tr><td>👎 <code>:-1:</code></td><td>👎 <code>:thumbsdown:</code></td><td>👌 <code>:ok_hand:</code></td></tr><tr><td>👊 <code>:punch:</code></td><td>👊 <code>:facepunch:</code></td><td>✊ <code>:fist:</code></td></tr><tr><td>✌️ <code>:v:</code></td><td>👋 <code>:wave:</code></td><td>✋ <code>:hand:</code></td></tr><tr><td>✋ <code>:raised_hand:</code></td><td>👐 <code>:open_hands:</code></td><td>☝️ <code>:point_up:</code></td></tr><tr><td>👇 <code>:point_down:</code></td><td>👈 <code>:point_left:</code></td><td>👉 <code>:point_right:</code></td></tr><tr><td>🙌 <code>:raised_hands:</code></td><td>🙏 <code>:pray:</code></td><td>👆 <code>:point_up_2:</code></td></tr><tr><td>👏 <code>:clap:</code></td><td>💪 <code>:muscle:</code></td><td>🤘 <code>:metal:</code></td></tr><tr><td>🖕 <code>:fu:</code></td><td>🚶 <code>:walking:</code></td><td>🏃 <code>:runner:</code></td></tr><tr><td>🏃 <code>:running:</code></td><td>👫 <code>:couple:</code></td><td>👪 <code>:family:</code></td></tr><tr><td>👬 <code>:two_men_holding_hands:</code></td><td>👭 <code>:two_women_holding_hands:</code></td><td>💃 <code>:dancer:</code></td></tr><tr><td>👯 <code>:dancers:</code></td><td>🙆 <code>:ok_woman:</code></td><td>🙅 <code>:no_good:</code></td></tr><tr><td>💁 <code>:information_desk_person:</code></td><td>🙋 <code>:raising_hand:</code></td><td>👰 <code>:bride_with_veil:</code></td></tr><tr><td>🙎 <code>:person_with_pouting_face:</code></td><td>🙍 <code>:person_frowning:</code></td><td>🙇 <code>:bow:</code></td></tr><tr><td>💏 <code>:couplekiss:</code></td><td>💑 <code>:couple_with_heart:</code></td><td>💆 <code>:massage:</code></td></tr><tr><td>💇 <code>:haircut:</code></td><td>💅 <code>:nail_care:</code></td><td>👦 <code>:boy:</code></td></tr><tr><td>👧 <code>:girl:</code></td><td>👩 <code>:woman:</code></td><td>👨 <code>:man:</code></td></tr><tr><td>👶 <code>:baby:</code></td><td>👵 <code>:older_woman:</code></td><td>👴 <code>:older_man:</code></td></tr><tr><td>👱 <code>:person_with_blond_hair:</code></td><td>👲 <code>:man_with_gua_pi_mao:</code></td><td>👳 <code>:man_with_turban:</code></td></tr><tr><td>👷 <code>:construction_worker:</code></td><td>👮 <code>:cop:</code></td><td>👼 <code>:angel:</code></td></tr><tr><td>👸 <code>:princess:</code></td><td>😺 <code>:smiley_cat:</code></td><td>😸 <code>:smile_cat:</code></td></tr><tr><td>😻 <code>:heart_eyes_cat:</code></td><td>😽 <code>:kissing_cat:</code></td><td>😼 <code>:smirk_cat:</code></td></tr><tr><td>🙀 <code>:scream_cat:</code></td><td>😿 <code>:crying_cat_face:</code></td><td>😹 <code>:joy_cat:</code></td></tr><tr><td>😾 <code>:pouting_cat:</code></td><td>👹 <code>:japanese_ogre:</code></td><td>👺 <code>:japanese_goblin:</code></td></tr><tr><td>🙈 <code>:see_no_evil:</code></td><td>🙉 <code>:hear_no_evil:</code></td><td>🙊 <code>:speak_no_evil:</code></td></tr><tr><td>💂 <code>:guardsman:</code></td><td>💀 <code>:skull:</code></td><td>🐾 <code>:feet:</code></td></tr><tr><td>👄 <code>:lips:</code></td><td>💋 <code>:kiss:</code></td><td>💧 <code>:droplet:</code></td></tr><tr><td>👂 <code>:ear:</code></td><td>👀 <code>:eyes:</code></td><td>👃 <code>:nose:</code></td></tr><tr><td>👅 <code>:tongue:</code></td><td>💌 <code>:love_letter:</code></td><td>👤 <code>:bust_in_silhouette:</code></td></tr><tr><td>👥 <code>:busts_in_silhouette:</code></td><td>💬 <code>:speech_balloon:</code></td><td>💭 <code>:thought_balloon:</code></td></tr></tbody></table><p>显示详细信息</p><h1 id="Nature"><a href="#Nature" class="headerlink" title="Nature"></a>Nature</h1><table><thead><tr><th>☀️ <code>:sunny:</code></th><th>☔️ <code>:umbrella:</code></th><th>☁️ <code>:cloud:</code></th></tr></thead><tbody><tr><td>❄️ <code>:snowflake:</code></td><td>⛄️ <code>:snowman:</code></td><td>⚡️ <code>:zap:</code></td></tr><tr><td>🌀 <code>:cyclone:</code></td><td>🌁 <code>:foggy:</code></td><td>🌊 <code>:ocean:</code></td></tr><tr><td>🐱 <code>:cat:</code></td><td>🐶 <code>:dog:</code></td><td>🐭 <code>:mouse:</code></td></tr><tr><td>🐹 <code>:hamster:</code></td><td>🐰 <code>:rabbit:</code></td><td>🐺 <code>:wolf:</code></td></tr><tr><td>🐸 <code>:frog:</code></td><td>🐯 <code>:tiger:</code></td><td>🐨 <code>:koala:</code></td></tr><tr><td>🐻 <code>:bear:</code></td><td>🐷 <code>:pig:</code></td><td>🐽 <code>:pig_nose:</code></td></tr><tr><td>🐮 <code>:cow:</code></td><td>🐗 <code>:boar:</code></td><td>🐵 <code>:monkey_face:</code></td></tr><tr><td>🐒 <code>:monkey:</code></td><td>🐴 <code>:horse:</code></td><td>🐎 <code>:racehorse:</code></td></tr><tr><td>🐫 <code>:camel:</code></td><td>🐑 <code>:sheep:</code></td><td>🐘 <code>:elephant:</code></td></tr><tr><td>🐼 <code>:panda_face:</code></td><td>🐍 <code>:snake:</code></td><td>🐦 <code>:bird:</code></td></tr><tr><td>🐤 <code>:baby_chick:</code></td><td>🐥 <code>:hatched_chick:</code></td><td>🐣 <code>:hatching_chick:</code></td></tr><tr><td>🐔 <code>:chicken:</code></td><td>🐧 <code>:penguin:</code></td><td>🐢 <code>:turtle:</code></td></tr><tr><td>🐛 <code>:bug:</code></td><td>🐝 <code>:honeybee:</code></td><td>🐜 <code>:ant:</code></td></tr><tr><td>🐞 <code>:beetle:</code></td><td>🐌 <code>:snail:</code></td><td>🐙 <code>:octopus:</code></td></tr><tr><td>🐠 <code>:tropical_fish:</code></td><td>🐟 <code>:fish:</code></td><td>🐳 <code>:whale:</code></td></tr><tr><td>🐋 <code>:whale2:</code></td><td>🐬 <code>:dolphin:</code></td><td>🐄 <code>:cow2:</code></td></tr><tr><td>🐏 <code>:ram:</code></td><td>🐀 <code>:rat:</code></td><td>🐃 <code>:water_buffalo:</code></td></tr><tr><td>🐅 <code>:tiger2:</code></td><td>🐇 <code>:rabbit2:</code></td><td>🐉 <code>:dragon:</code></td></tr><tr><td>🐐 <code>:goat:</code></td><td>🐓 <code>:rooster:</code></td><td>🐕 <code>:dog2:</code></td></tr><tr><td>🐖 <code>:pig2:</code></td><td>🐁 <code>:mouse2:</code></td><td>🐂 <code>:ox:</code></td></tr><tr><td>🐲 <code>:dragon_face:</code></td><td>🐡 <code>:blowfish:</code></td><td>🐊 <code>:crocodile:</code></td></tr><tr><td>🐪 <code>:dromedary_camel:</code></td><td>🐆 <code>:leopard:</code></td><td>🐈 <code>:cat2:</code></td></tr><tr><td>🐩 <code>:poodle:</code></td><td>🐾 <code>:paw_prints:</code></td><td>💐 <code>:bouquet:</code></td></tr><tr><td>🌸 <code>:cherry_blossom:</code></td><td>🌷 <code>:tulip:</code></td><td>🍀 <code>:four_leaf_clover:</code></td></tr><tr><td>🌹 <code>:rose:</code></td><td>🌻 <code>:sunflower:</code></td><td>🌺 <code>:hibiscus:</code></td></tr><tr><td>🍁 <code>:maple_leaf:</code></td><td>🍃 <code>:leaves:</code></td><td>🍂 <code>:fallen_leaf:</code></td></tr><tr><td>🌿 <code>:herb:</code></td><td>🍄 <code>:mushroom:</code></td><td>🌵 <code>:cactus:</code></td></tr><tr><td>🌴 <code>:palm_tree:</code></td><td>🌲 <code>:evergreen_tree:</code></td><td>🌳 <code>:deciduous_tree:</code></td></tr><tr><td>🌰 <code>:chestnut:</code></td><td>🌱 <code>:seedling:</code></td><td>🌼 <code>:blossom:</code></td></tr><tr><td>🌾 <code>:ear_of_rice:</code></td><td>🐚 <code>:shell:</code></td><td>🌐 <code>:globe_with_meridians:</code></td></tr><tr><td>🌞 <code>:sun_with_face:</code></td><td>🌝 <code>:full_moon_with_face:</code></td><td>🌚 <code>:new_moon_with_face:</code></td></tr><tr><td>🌑 <code>:new_moon:</code></td><td>🌒 <code>:waxing_crescent_moon:</code></td><td>🌓 <code>:first_quarter_moon:</code></td></tr><tr><td>🌔 <code>:waxing_gibbous_moon:</code></td><td>🌕 <code>:full_moon:</code></td><td>🌖 <code>:waning_gibbous_moon:</code></td></tr><tr><td>🌗 <code>:last_quarter_moon:</code></td><td>🌘 <code>:waning_crescent_moon:</code></td><td>🌜 <code>:last_quarter_moon_with_face:</code></td></tr><tr><td>🌛 <code>:first_quarter_moon_with_face:</code></td><td>🌔 <code>:moon:</code></td><td>🌍 <code>:earth_africa:</code></td></tr><tr><td>🌎 <code>:earth_americas:</code></td><td>🌏 <code>:earth_asia:</code></td><td>🌋 <code>:volcano:</code></td></tr><tr><td>🌌 <code>:milky_way:</code></td><td>⛅️ <code>:partly_sunny:</code></td><td></td></tr></tbody></table><p>显示详细信息</p><h1 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h1><table><thead><tr><th>🎍 <code>:bamboo:</code></th><th>💝 <code>:gift_heart:</code></th><th>🎎 <code>:dolls:</code></th></tr></thead><tbody><tr><td>🎒 <code>:school_satchel:</code></td><td>🎓 <code>:mortar_board:</code></td><td>🎏 <code>:flags:</code></td></tr><tr><td>🎆 <code>:fireworks:</code></td><td>🎇 <code>:sparkler:</code></td><td>🎐 <code>:wind_chime:</code></td></tr><tr><td>🎑 <code>:rice_scene:</code></td><td>🎃 <code>:jack_o_lantern:</code></td><td>👻 <code>:ghost:</code></td></tr><tr><td>🎅 <code>:santa:</code></td><td>🎄 <code>:christmas_tree:</code></td><td>🎁 <code>:gift:</code></td></tr><tr><td>🔔 <code>:bell:</code></td><td>🔕 <code>:no_bell:</code></td><td>🎋 <code>:tanabata_tree:</code></td></tr><tr><td>🎉 <code>:tada:</code></td><td>🎊 <code>:confetti_ball:</code></td><td>🎈 <code>:balloon:</code></td></tr><tr><td>🔮 <code>:crystal_ball:</code></td><td>💿 <code>:cd:</code></td><td>📀 <code>:dvd:</code></td></tr><tr><td>💾 <code>:floppy_disk:</code></td><td>📷 <code>:camera:</code></td><td>📹 <code>:video_camera:</code></td></tr><tr><td>🎥 <code>:movie_camera:</code></td><td>💻 <code>:computer:</code></td><td>📺 <code>:tv:</code></td></tr><tr><td>📱 <code>:iphone:</code></td><td>☎️ <code>:phone:</code></td><td>☎️ <code>:telephone:</code></td></tr><tr><td>📞 <code>:telephone_receiver:</code></td><td>📟 <code>:pager:</code></td><td>📠 <code>:fax:</code></td></tr><tr><td>💽 <code>:minidisc:</code></td><td>📼 <code>:vhs:</code></td><td>🔉 <code>:sound:</code></td></tr><tr><td>🔈 <code>:speaker:</code></td><td>🔇 <code>:mute:</code></td><td>📢 <code>:loudspeaker:</code></td></tr><tr><td>📣 <code>:mega:</code></td><td>⌛️ <code>:hourglass:</code></td><td>⏳ <code>:hourglass_flowing_sand:</code></td></tr><tr><td>⏰ <code>:alarm_clock:</code></td><td>⌚️ <code>:watch:</code></td><td>📻 <code>:radio:</code></td></tr><tr><td>📡 <code>:satellite:</code></td><td>➿ <code>:loop:</code></td><td>🔍 <code>:mag:</code></td></tr><tr><td>🔎 <code>:mag_right:</code></td><td>🔓 <code>:unlock:</code></td><td>🔒 <code>:lock:</code></td></tr><tr><td>🔏 <code>:lock_with_ink_pen:</code></td><td>🔐 <code>:closed_lock_with_key:</code></td><td>🔑 <code>:key:</code></td></tr><tr><td>💡 <code>:bulb:</code></td><td>🔦 <code>:flashlight:</code></td><td>🔆 <code>:high_brightness:</code></td></tr><tr><td>🔅 <code>:low_brightness:</code></td><td>🔌 <code>:electric_plug:</code></td><td>🔋 <code>:battery:</code></td></tr><tr><td>📲 <code>:calling:</code></td><td>✉️ <code>:email:</code></td><td>📫 <code>:mailbox:</code></td></tr><tr><td>📮 <code>:postbox:</code></td><td>🛀 <code>:bath:</code></td><td>🛁 <code>:bathtub:</code></td></tr><tr><td>🚿 <code>:shower:</code></td><td>🚽 <code>:toilet:</code></td><td>🔧 <code>:wrench:</code></td></tr><tr><td>🔩 <code>:nut_and_bolt:</code></td><td>🔨 <code>:hammer:</code></td><td>💺 <code>:seat:</code></td></tr><tr><td>💰 <code>:moneybag:</code></td><td>💴 <code>:yen:</code></td><td>💵 <code>:dollar:</code></td></tr><tr><td>💷 <code>:pound:</code></td><td>💶 <code>:euro:</code></td><td>💳 <code>:credit_card:</code></td></tr><tr><td>💸 <code>:money_with_wings:</code></td><td>📧 <code>:e-mail:</code></td><td>📥 <code>:inbox_tray:</code></td></tr><tr><td>📤 <code>:outbox_tray:</code></td><td>✉️ <code>:envelope:</code></td><td>📨 <code>:incoming_envelope:</code></td></tr><tr><td>📯 <code>:postal_horn:</code></td><td>📪 <code>:mailbox_closed:</code></td><td>📬 <code>:mailbox_with_mail:</code></td></tr><tr><td>📭 <code>:mailbox_with_no_mail:</code></td><td>🚪 <code>:door:</code></td><td>🚬 <code>:smoking:</code></td></tr><tr><td>💣 <code>:bomb:</code></td><td>🔫 <code>:gun:</code></td><td>🔪 <code>:hocho:</code></td></tr><tr><td>💊 <code>:pill:</code></td><td>💉 <code>:syringe:</code></td><td>📄 <code>:page_facing_up:</code></td></tr><tr><td>📃 <code>:page_with_curl:</code></td><td>📑 <code>:bookmark_tabs:</code></td><td>📊 <code>:bar_chart:</code></td></tr><tr><td>📈 <code>:chart_with_upwards_trend:</code></td><td>📉 <code>:chart_with_downwards_trend:</code></td><td>📜 <code>:scroll:</code></td></tr><tr><td>📋 <code>:clipboard:</code></td><td>📆 <code>:calendar:</code></td><td>📅 <code>:date:</code></td></tr><tr><td>📇 <code>:card_index:</code></td><td>📁 <code>:file_folder:</code></td><td>📂 <code>:open_file_folder:</code></td></tr><tr><td>✂️ <code>:scissors:</code></td><td>📌 <code>:pushpin:</code></td><td>📎 <code>:paperclip:</code></td></tr><tr><td>✒️ <code>:black_nib:</code></td><td>✏️ <code>:pencil2:</code></td><td>📏 <code>:straight_ruler:</code></td></tr><tr><td>📐 <code>:triangular_ruler:</code></td><td>📕 <code>:closed_book:</code></td><td>📗 <code>:green_book:</code></td></tr><tr><td>📘 <code>:blue_book:</code></td><td>📙 <code>:orange_book:</code></td><td>📓 <code>:notebook:</code></td></tr><tr><td>📔 <code>:notebook_with_decorative_cover:</code></td><td>📒 <code>:ledger:</code></td><td>📚 <code>:books:</code></td></tr><tr><td>🔖 <code>:bookmark:</code></td><td>📛 <code>:name_badge:</code></td><td>🔬 <code>:microscope:</code></td></tr><tr><td>🔭 <code>:telescope:</code></td><td>📰 <code>:newspaper:</code></td><td>🏈 <code>:football:</code></td></tr><tr><td>🏀 <code>:basketball:</code></td><td>⚽️ <code>:soccer:</code></td><td>⚾️ <code>:baseball:</code></td></tr><tr><td>🎾 <code>:tennis:</code></td><td>🎱 <code>:8ball:</code></td><td>🏉 <code>:rugby_football:</code></td></tr><tr><td>🎳 <code>:bowling:</code></td><td>⛳️ <code>:golf:</code></td><td>🚵 <code>:mountain_bicyclist:</code></td></tr><tr><td>🚴 <code>:bicyclist:</code></td><td>🏇 <code>:horse_racing:</code></td><td>🏂 <code>:snowboarder:</code></td></tr><tr><td>🏊 <code>:swimmer:</code></td><td>🏄 <code>:surfer:</code></td><td>🎿 <code>:ski:</code></td></tr><tr><td>♠️ <code>:spades:</code></td><td>♥️ <code>:hearts:</code></td><td>♣️ <code>:clubs:</code></td></tr><tr><td>♦️ <code>:diamonds:</code></td><td>💎 <code>:gem:</code></td><td>💍 <code>:ring:</code></td></tr><tr><td>🏆 <code>:trophy:</code></td><td>🎼 <code>:musical_score:</code></td><td>🎹 <code>:musical_keyboard:</code></td></tr><tr><td>🎻 <code>:violin:</code></td><td>👾 <code>:space_invader:</code></td><td>🎮 <code>:video_game:</code></td></tr><tr><td>🃏 <code>:black_joker:</code></td><td>🎴 <code>:flower_playing_cards:</code></td><td>🎲 <code>:game_die:</code></td></tr><tr><td>🎯 <code>:dart:</code></td><td>🀄️ <code>:mahjong:</code></td><td>🎬 <code>:clapper:</code></td></tr><tr><td>📝 <code>:memo:</code></td><td>📝 <code>:pencil:</code></td><td>📖 <code>:book:</code></td></tr><tr><td>🎨 <code>:art:</code></td><td>🎤 <code>:microphone:</code></td><td>🎧 <code>:headphones:</code></td></tr><tr><td>🎺 <code>:trumpet:</code></td><td>🎷 <code>:saxophone:</code></td><td>🎸 <code>:guitar:</code></td></tr><tr><td>👞 <code>:shoe:</code></td><td>👡 <code>:sandal:</code></td><td>👠 <code>:high_heel:</code></td></tr><tr><td>💄 <code>:lipstick:</code></td><td>👢 <code>:boot:</code></td><td>👕 <code>:shirt:</code></td></tr><tr><td>👕 <code>:tshirt:</code></td><td>👔 <code>:necktie:</code></td><td>👚 <code>:womans_clothes:</code></td></tr><tr><td>👗 <code>:dress:</code></td><td>🎽 <code>:running_shirt_with_sash:</code></td><td>👖 <code>:jeans:</code></td></tr><tr><td>👘 <code>:kimono:</code></td><td>👙 <code>:bikini:</code></td><td>🎀 <code>:ribbon:</code></td></tr><tr><td>🎩 <code>:tophat:</code></td><td>👑 <code>:crown:</code></td><td>👒 <code>:womans_hat:</code></td></tr><tr><td>👞 <code>:mans_shoe:</code></td><td>🌂 <code>:closed_umbrella:</code></td><td>💼 <code>:briefcase:</code></td></tr><tr><td>👜 <code>:handbag:</code></td><td>👝 <code>:pouch:</code></td><td>👛 <code>:purse:</code></td></tr><tr><td>👓 <code>:eyeglasses:</code></td><td>🎣 <code>:fishing_pole_and_fish:</code></td><td>☕️ <code>:coffee:</code></td></tr><tr><td>🍵 <code>:tea:</code></td><td>🍶 <code>:sake:</code></td><td>🍼 <code>:baby_bottle:</code></td></tr><tr><td>🍺 <code>:beer:</code></td><td>🍻 <code>:beers:</code></td><td>🍸 <code>:cocktail:</code></td></tr><tr><td>🍹 <code>:tropical_drink:</code></td><td>🍷 <code>:wine_glass:</code></td><td>🍴 <code>:fork_and_knife:</code></td></tr><tr><td>🍕 <code>:pizza:</code></td><td>🍔 <code>:hamburger:</code></td><td>🍟 <code>:fries:</code></td></tr><tr><td>🍗 <code>:poultry_leg:</code></td><td>🍖 <code>:meat_on_bone:</code></td><td>🍝 <code>:spaghetti:</code></td></tr><tr><td>🍛 <code>:curry:</code></td><td>🍤 <code>:fried_shrimp:</code></td><td>🍱 <code>:bento:</code></td></tr><tr><td>🍣 <code>:sushi:</code></td><td>🍥 <code>:fish_cake:</code></td><td>🍙 <code>:rice_ball:</code></td></tr><tr><td>🍘 <code>:rice_cracker:</code></td><td>🍚 <code>:rice:</code></td><td>🍜 <code>:ramen:</code></td></tr><tr><td>🍲 <code>:stew:</code></td><td>🍢 <code>:oden:</code></td><td>🍡 <code>:dango:</code></td></tr><tr><td>🥚 <code>:egg:</code></td><td>🍞 <code>:bread:</code></td><td>🍩 <code>:doughnut:</code></td></tr><tr><td>🍮 <code>:custard:</code></td><td>🍦 <code>:icecream:</code></td><td>🍨 <code>:ice_cream:</code></td></tr><tr><td>🍧 <code>:shaved_ice:</code></td><td>🎂 <code>:birthday:</code></td><td>🍰 <code>:cake:</code></td></tr><tr><td>🍪 <code>:cookie:</code></td><td>🍫 <code>:chocolate_bar:</code></td><td>🍬 <code>:candy:</code></td></tr><tr><td>🍭 <code>:lollipop:</code></td><td>🍯 <code>:honey_pot:</code></td><td>🍎 <code>:apple:</code></td></tr><tr><td>🍏 <code>:green_apple:</code></td><td>🍊 <code>:tangerine:</code></td><td>🍋 <code>:lemon:</code></td></tr><tr><td>🍒 <code>:cherries:</code></td><td>🍇 <code>:grapes:</code></td><td>🍉 <code>:watermelon:</code></td></tr><tr><td>🍓 <code>:strawberry:</code></td><td>🍑 <code>:peach:</code></td><td>🍈 <code>:melon:</code></td></tr><tr><td>🍌 <code>:banana:</code></td><td>🍐 <code>:pear:</code></td><td>🍍 <code>:pineapple:</code></td></tr><tr><td>🍠 <code>:sweet_potato:</code></td><td>🍆 <code>:eggplant:</code></td><td>🍅 <code>:tomato:</code></td></tr><tr><td>🌽 <code>:corn:</code></td><td></td><td></td></tr></tbody></table><p>显示详细信息</p><h1 id="Places"><a href="#Places" class="headerlink" title="Places"></a>Places</h1><table><thead><tr><th>🏠 <code>:house:</code></th><th>🏡 <code>:house_with_garden:</code></th><th>🏫 <code>:school:</code></th></tr></thead><tbody><tr><td>🏢 <code>:office:</code></td><td>🏣 <code>:post_office:</code></td><td>🏥 <code>:hospital:</code></td></tr><tr><td>🏦 <code>:bank:</code></td><td>🏪 <code>:convenience_store:</code></td><td>🏩 <code>:love_hotel:</code></td></tr><tr><td>🏨 <code>:hotel:</code></td><td>💒 <code>:wedding:</code></td><td>⛪️ <code>:church:</code></td></tr><tr><td>🏬 <code>:department_store:</code></td><td>🏤 <code>:european_post_office:</code></td><td>🌇 <code>:city_sunrise:</code></td></tr><tr><td>🌆 <code>:city_sunset:</code></td><td>🏯 <code>:japanese_castle:</code></td><td>🏰 <code>:european_castle:</code></td></tr><tr><td>⛺️ <code>:tent:</code></td><td>🏭 <code>:factory:</code></td><td>🗼 <code>:tokyo_tower:</code></td></tr><tr><td>🗾 <code>:japan:</code></td><td>🗻 <code>:mount_fuji:</code></td><td>🌄 <code>:sunrise_over_mountains:</code></td></tr><tr><td>🌅 <code>:sunrise:</code></td><td>🌠 <code>:stars:</code></td><td>🗽 <code>:statue_of_liberty:</code></td></tr><tr><td>🌉 <code>:bridge_at_night:</code></td><td>🎠 <code>:carousel_horse:</code></td><td>🌈 <code>:rainbow:</code></td></tr><tr><td>🎡 <code>:ferris_wheel:</code></td><td>⛲️ <code>:fountain:</code></td><td>🎢 <code>:roller_coaster:</code></td></tr><tr><td>🚢 <code>:ship:</code></td><td>🚤 <code>:speedboat:</code></td><td>⛵️ <code>:boat:</code></td></tr><tr><td>⛵️ <code>:sailboat:</code></td><td>🚣 <code>:rowboat:</code></td><td>⚓️ <code>:anchor:</code></td></tr><tr><td>🚀 <code>:rocket:</code></td><td>✈️ <code>:airplane:</code></td><td>🚁 <code>:helicopter:</code></td></tr><tr><td>🚂 <code>:steam_locomotive:</code></td><td>🚊 <code>:tram:</code></td><td>🚞 <code>:mountain_railway:</code></td></tr><tr><td>🚲 <code>:bike:</code></td><td>🚡 <code>:aerial_tramway:</code></td><td>🚟 <code>:suspension_railway:</code></td></tr><tr><td>🚠 <code>:mountain_cableway:</code></td><td>🚜 <code>:tractor:</code></td><td>🚙 <code>:blue_car:</code></td></tr><tr><td>🚘 <code>:oncoming_automobile:</code></td><td>🚗 <code>:car:</code></td><td>🚗 <code>:red_car:</code></td></tr><tr><td>🚕 <code>:taxi:</code></td><td>🚖 <code>:oncoming_taxi:</code></td><td>🚛 <code>:articulated_lorry:</code></td></tr><tr><td>🚌 <code>:bus:</code></td><td>🚍 <code>:oncoming_bus:</code></td><td>🚨 <code>:rotating_light:</code></td></tr><tr><td>🚓 <code>:police_car:</code></td><td>🚔 <code>:oncoming_police_car:</code></td><td>🚒 <code>:fire_engine:</code></td></tr><tr><td>🚑 <code>:ambulance:</code></td><td>🚐 <code>:minibus:</code></td><td>🚚 <code>:truck:</code></td></tr><tr><td>🚋 <code>:train:</code></td><td>🚉 <code>:station:</code></td><td>🚆 <code>:train2:</code></td></tr><tr><td>🚅 <code>:bullettrain_front:</code></td><td>🚄 <code>:bullettrain_side:</code></td><td>🚈 <code>:light_rail:</code></td></tr><tr><td>🚝 <code>:monorail:</code></td><td>🚃 <code>:railway_car:</code></td><td>🚎 <code>:trolleybus:</code></td></tr><tr><td>🎫 <code>:ticket:</code></td><td>⛽️ <code>:fuelpump:</code></td><td>🚦 <code>:vertical_traffic_light:</code></td></tr><tr><td>🚥 <code>:traffic_light:</code></td><td>⚠️ <code>:warning:</code></td><td>🚧 <code>:construction:</code></td></tr><tr><td>🔰 <code>:beginner:</code></td><td>🏧 <code>:atm:</code></td><td>🎰 <code>:slot_machine:</code></td></tr><tr><td>🚏 <code>:busstop:</code></td><td>💈 <code>:barber:</code></td><td>♨️ <code>:hotsprings:</code></td></tr><tr><td>🏁 <code>:checkered_flag:</code></td><td>🎌 <code>:crossed_flags:</code></td><td>🏮 <code>:izakaya_lantern:</code></td></tr><tr><td>🗿 <code>:moyai:</code></td><td>🎪 <code>:circus_tent:</code></td><td>🎭 <code>:performing_arts:</code></td></tr><tr><td>📍 <code>:round_pushpin:</code></td><td>🚩 <code>:triangular_flag_on_post:</code></td><td>🇯🇵 <code>:jp:</code></td></tr><tr><td>🇰🇷 <code>:kr:</code></td><td>🇨🇳 <code>:cn:</code></td><td>🇺🇸 <code>:us:</code></td></tr><tr><td>🇫🇷 <code>:fr:</code></td><td>🇪🇸 <code>:es:</code></td><td>🇮🇹 <code>:it:</code></td></tr><tr><td>🇷🇺 <code>:ru:</code></td><td>🇬🇧 <code>:gb:</code></td><td>🇬🇧 <code>:uk:</code></td></tr><tr><td>🇩🇪 <code>:de:</code></td><td></td><td></td></tr></tbody></table><p>显示详细信息</p><h1 id="Symbols"><a href="#Symbols" class="headerlink" title="Symbols"></a>Symbols</h1><table><thead><tr><th>1️⃣ <code>:one:</code></th><th>2️⃣ <code>:two:</code></th><th>3️⃣ <code>:three:</code></th></tr></thead><tbody><tr><td>4️⃣ <code>:four:</code></td><td>5️⃣ <code>:five:</code></td><td>6️⃣ <code>:six:</code></td></tr><tr><td>7️⃣ <code>:seven:</code></td><td>8️⃣ <code>:eight:</code></td><td>9️⃣ <code>:nine:</code></td></tr><tr><td>🔟 <code>:keycap_ten:</code></td><td>🔢 <code>:1234:</code></td><td>0️⃣ <code>:zero:</code></td></tr><tr><td>#️⃣ <code>:hash:</code></td><td>🔣 <code>:symbols:</code></td><td>◀️ <code>:arrow_backward:</code></td></tr><tr><td>⬇️ <code>:arrow_down:</code></td><td>▶️ <code>:arrow_forward:</code></td><td>⬅️ <code>:arrow_left:</code></td></tr><tr><td>🔠 <code>:capital_abcd:</code></td><td>🔡 <code>:abcd:</code></td><td>🔤 <code>:abc:</code></td></tr><tr><td>↙️ <code>:arrow_lower_left:</code></td><td>↘️ <code>:arrow_lower_right:</code></td><td>➡️ <code>:arrow_right:</code></td></tr><tr><td>⬆️ <code>:arrow_up:</code></td><td>↖️ <code>:arrow_upper_left:</code></td><td>↗️ <code>:arrow_upper_right:</code></td></tr><tr><td>⏬ <code>:arrow_double_down:</code></td><td>⏫ <code>:arrow_double_up:</code></td><td>🔽 <code>:arrow_down_small:</code></td></tr><tr><td>⤵️ <code>:arrow_heading_down:</code></td><td>⤴️ <code>:arrow_heading_up:</code></td><td>↩️<code>:leftwards_arrow_with_hook:</code></td></tr><tr><td>↪️ <code>:arrow_right_hook:</code></td><td>↔️ <code>:left_right_arrow:</code></td><td>↕️ <code>:arrow_up_down:</code></td></tr><tr><td>🔼 <code>:arrow_up_small:</code></td><td>🔃 <code>:arrows_clockwise:</code></td><td>🔄 <code>:arrows_counterclockwise:</code></td></tr><tr><td>⏪ <code>:rewind:</code></td><td>⏩ <code>:fast_forward:</code></td><td>ℹ️ <code>:information_source:</code></td></tr><tr><td>🆗 <code>:ok:</code></td><td>🔀 <code>:twisted_rightwards_arrows:</code></td><td>🔁 <code>:repeat:</code></td></tr><tr><td>🔂 <code>:repeat_one:</code></td><td>🆕 <code>:new:</code></td><td>🔝 <code>:top:</code></td></tr><tr><td>🆙 <code>:up:</code></td><td>🆒 <code>:cool:</code></td><td>🆓 <code>:free:</code></td></tr><tr><td>🆖 <code>:ng:</code></td><td>🎦 <code>:cinema:</code></td><td>🈁 <code>:koko:</code></td></tr><tr><td>📶 <code>:signal_strength:</code></td><td>🈹 <code>:u5272:</code></td><td>🈴 <code>:u5408:</code></td></tr><tr><td>🈺 <code>:u55b6:</code></td><td>🈯️ <code>:u6307:</code></td><td>🈷️ <code>:u6708:</code></td></tr><tr><td>🈶 <code>:u6709:</code></td><td>🈵 <code>:u6e80:</code></td><td>🈚️ <code>:u7121:</code></td></tr><tr><td>🈸 <code>:u7533:</code></td><td>🈳 <code>:u7a7a:</code></td><td>🈲 <code>:u7981:</code></td></tr><tr><td>🈂️ <code>:sa:</code></td><td>🚻 <code>:restroom:</code></td><td>🚹 <code>:mens:</code></td></tr><tr><td>🚺 <code>:womens:</code></td><td>🚼 <code>:baby_symbol:</code></td><td>🚭 <code>:no_smoking:</code></td></tr><tr><td>🅿️ <code>:parking:</code></td><td>♿️ <code>:wheelchair:</code></td><td>🚇 <code>:metro:</code></td></tr><tr><td>🛄 <code>:baggage_claim:</code></td><td>🉑 <code>:accept:</code></td><td>🚾 <code>:wc:</code></td></tr><tr><td>🚰 <code>:potable_water:</code></td><td>🚮 <code>:put_litter_in_its_place:</code></td><td>㊙️ <code>:secret:</code></td></tr><tr><td>㊗️ <code>:congratulations:</code></td><td>Ⓜ️ <code>:m:</code></td><td>🛂 <code>:passport_control:</code></td></tr><tr><td>🛅 <code>:left_luggage:</code></td><td>🛃 <code>:customs:</code></td><td>🉐 <code>:ideograph_advantage:</code></td></tr><tr><td>🆑 <code>:cl:</code></td><td>🆘 <code>:sos:</code></td><td>🆔 <code>:id:</code></td></tr><tr><td>🚫 <code>:no_entry_sign:</code></td><td>🔞 <code>:underage:</code></td><td>📵 <code>:no_mobile_phones:</code></td></tr><tr><td>🚯 <code>:do_not_litter:</code></td><td>🚱 <code>:non-potable_water:</code></td><td>🚳 <code>:no_bicycles:</code></td></tr><tr><td>🚷 <code>:no_pedestrians:</code></td><td>🚸 <code>:children_crossing:</code></td><td>⛔️ <code>:no_entry:</code></td></tr><tr><td>✳️ <code>:eight_spoked_asterisk:</code></td><td>✴️ <code>:eight_pointed_black_star:</code></td><td>💟 <code>:heart_decoration:</code></td></tr><tr><td>🆚 <code>:vs:</code></td><td>📳 <code>:vibration_mode:</code></td><td>📴 <code>:mobile_phone_off:</code></td></tr><tr><td>💹 <code>:chart:</code></td><td>💱 <code>:currency_exchange:</code></td><td>♈️ <code>:aries:</code></td></tr><tr><td>♉️ <code>:taurus:</code></td><td>♊️ <code>:gemini:</code></td><td>♋️ <code>:cancer:</code></td></tr><tr><td>♌️ <code>:leo:</code></td><td>♍️ <code>:virgo:</code></td><td>♎️ <code>:libra:</code></td></tr><tr><td>♏️ <code>:scorpius:</code></td><td>♐️ <code>:sagittarius:</code></td><td>♑️ <code>:capricorn:</code></td></tr><tr><td>♒️ <code>:aquarius:</code></td><td>♓️ <code>:pisces:</code></td><td>⛎ <code>:ophiuchus:</code></td></tr><tr><td>🔯 <code>:six_pointed_star:</code></td><td>❎<code>:negative_squared_cross_mark:</code></td><td>🅰️ <code>:a:</code></td></tr><tr><td>🅱️ <code>:b:</code></td><td>🆎 <code>:ab:</code></td><td>🅾️ <code>:o2:</code></td></tr><tr><td>💠<code>:diamond_shape_with_a_dot_inside:</code></td><td>♻️ <code>:recycle:</code></td><td>🔚 <code>:end:</code></td></tr><tr><td>🔛 <code>:on:</code></td><td>🔜 <code>:soon:</code></td><td>🕐 <code>:clock1:</code></td></tr><tr><td>🕜 <code>:clock130:</code></td><td>🕙 <code>:clock10:</code></td><td>🕥 <code>:clock1030:</code></td></tr><tr><td>🕚 <code>:clock11:</code></td><td>🕦 <code>:clock1130:</code></td><td>🕛 <code>:clock12:</code></td></tr><tr><td>🕧 <code>:clock1230:</code></td><td>🕑 <code>:clock2:</code></td><td>🕝 <code>:clock230:</code></td></tr><tr><td>🕒 <code>:clock3:</code></td><td>🕞 <code>:clock330:</code></td><td>🕓 <code>:clock4:</code></td></tr><tr><td>🕟 <code>:clock430:</code></td><td>🕔 <code>:clock5:</code></td><td>🕠 <code>:clock530:</code></td></tr><tr><td>🕕 <code>:clock6:</code></td><td>🕡 <code>:clock630:</code></td><td>🕖 <code>:clock7:</code></td></tr><tr><td>🕢 <code>:clock730:</code></td><td>🕗 <code>:clock8:</code></td><td>🕣 <code>:clock830:</code></td></tr><tr><td>🕘 <code>:clock9:</code></td><td>🕤 <code>:clock930:</code></td><td>💲 <code>:heavy_dollar_sign:</code></td></tr><tr><td>©️ <code>:copyright:</code></td><td>®️ <code>:registered:</code></td><td>™️ <code>:tm:</code></td></tr><tr><td>❌ <code>:x:</code></td><td>❗️ <code>:heavy_exclamation_mark:</code></td><td>‼️ <code>:bangbang:</code></td></tr><tr><td>⁉️ <code>:interrobang:</code></td><td>⭕️ <code>:o:</code></td><td>✖️ <code>:heavy_multiplication_x:</code></td></tr><tr><td>➕ <code>:heavy_plus_sign:</code></td><td>➖ <code>:heavy_minus_sign:</code></td><td>➗ <code>:heavy_division_sign:</code></td></tr><tr><td>💮 <code>:white_flower:</code></td><td>💯 <code>:100:</code></td><td>✔️ <code>:heavy_check_mark:</code></td></tr><tr><td>☑️ <code>:ballot_box_with_check:</code></td><td>🔘 <code>:radio_button:</code></td><td>🔗 <code>:link:</code></td></tr><tr><td>➰ <code>:curly_loop:</code></td><td>〰️ <code>:wavy_dash:</code></td><td>〽️ <code>:part_alternation_mark:</code></td></tr><tr><td>🔱 <code>:trident:</code></td><td>:black_square: <code>:black_square:</code></td><td>:white_square: <code>:white_square:</code></td></tr><tr><td>✅ <code>:white_check_mark:</code></td><td>🔲 <code>:black_square_button:</code></td><td>🔳 <code>:white_square_button:</code></td></tr><tr><td>⚫️ <code>:black_circle:</code></td><td>⚪️ <code>:white_circle:</code></td><td>🔴 <code>:red_circle:</code></td></tr><tr><td>🔵 <code>:large_blue_circle:</code></td><td>🔷 <code>:large_blue_diamond:</code></td><td>🔶 <code>:large_orange_diamond:</code></td></tr><tr><td>🔹 <code>:small_blue_diamond:</code></td><td>🔸 <code>:small_orange_diamond:</code></td><td>🔺 <code>:small_red_triangle:</code></td></tr><tr><td>🔻 <code>:small_red_triangle_down:</code></td><td></td><td></td></tr></tbody></table><p>显示详细信息</p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UML 片段说明</title>
      <link href="/%E6%89%8B%E5%86%8C/UML/%E7%89%87%E6%AE%B5%E8%AF%B4%E6%98%8E/"/>
      <url>/%E6%89%8B%E5%86%8C/UML/%E7%89%87%E6%AE%B5%E8%AF%B4%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>片断类型</th><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>Opt</td><td>选项</td><td>包含一个可能发生或可能不发生的序列。 能够在临界中指定序列发生的条件。</td></tr><tr><td>Alt</td><td>抉择</td><td>包含一个片断列表，这些片断包含备选消息序列。 在任何场合下只发生一个序列。能够在每一个片断中设置一个临界来指示该片断能够运行的条件。 else 的临界指示其余任何临界都不为 True 时应运行的片断。 若是全部临界都为 False 而且没有 else，则不执行任何片断。</td></tr><tr><td>Loop</td><td>循环</td><td>片断重复必定次数。 能够在临界中指示片断重复的条件。Loop 组合片断具备“Min”和“Max”属性，它们指示片断能够重复的最小和最大次数。 默认值是无限制。</td></tr><tr><td>Break</td><td>中断</td><td>若是执行此片断，则放弃序列的其他部分。 可使用临界来指示发生中断的条件。</td></tr><tr><td>Par</td><td>并行</td><td>并行处理。 片断中的事件能够交错。</td></tr><tr><td>Critical</td><td>关键</td><td>用在 Par 或 Seq 片断中。 指示此片断中的消息不得与其余消息交错。</td></tr><tr><td>Seq</td><td>弱顺序</td><td>有两个或更多操做数片断。 涉及同一辈子命线的消息必须以片断的顺序发生。 若是消息涉及的生命线不一样，来自不一样片断的消息可能会并行交错。</td></tr><tr><td>Strict</td><td>强顺序</td><td>有两个或更多操做数片断。 这些片断必须按给定顺序发生。</td></tr></tbody></table><p>10.40.61.20&#x2F;255.255.255.0|192.168.160.1&#x2F;255.255.255.0|192.168.142.1&#x2F;255.255.255.0</p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> UML </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Readme 工具使用手册</title>
      <link href="/%E6%89%8B%E5%86%8C/Readme%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/"/>
      <url>/%E6%89%8B%E5%86%8C/Readme%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="ReadMe"><a href="#ReadMe" class="headerlink" title="ReadMe"></a>ReadMe</h1><blockquote><p>readme 是一个自动生成 <code>readme</code> 的工具</p><p>开源项目地址：<a href="https://github.com/kefranabg/readme-md-generator">https://github.com/kefranabg/readme-md-generator</a></p><p>开源项目作者：Franck Abgrall</p></blockquote><h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><h2 id="npx-用法"><a href="#npx-用法" class="headerlink" title="npx 用法"></a>npx 用法</h2><p>Make sure you have npx installed (npx is shipped by default since npm 5.2.0)</p><p>Just run the following command at the root of your project and answer questions:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx readme-md-generator</span><br></pre></td></tr></table></figure><p>Or use default values for all questions (-y):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx readme-md-generator -y</span><br></pre></td></tr></table></figure><p>Use your own ejs README template (-p):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx readme-md-generator -p path/to/my/own/template.md</span><br></pre></td></tr></table></figure><p>You can find ejs README template examples here.、</p><h2 id="Windows-系统使用"><a href="#Windows-系统使用" class="headerlink" title="Windows 系统使用"></a>Windows 系统使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readme</span><br></pre></td></tr></table></figure><p>Or use default values for all questions (-y):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readme -y</span><br></pre></td></tr></table></figure><p>Use your own ejs README template (-p):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readme -p D:my/own/template.md</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端样式配置 style</title>
      <link href="/%E6%89%8B%E5%86%8C/SpanStyleList/"/>
      <url>/%E6%89%8B%E5%86%8C/SpanStyleList/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fas faa-ring animated-hover&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom:3px solid green&quot;</span>&gt;</span>《半小时漫画中国哲学史》<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">2</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>  <span class="attr">style</span>=<span class="string">&quot;text-align:center;font-size:20px;font:30px 书体坊兰亭体;color:blueviolent;word-spacing:30px;&quot;</span>&gt;</span>“ 既许一人以偏爱，愿尽余生之慷慨 ”<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">3</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;&quot;</span>&gt;</span>[data.json文件链接](https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA )<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> 4  </span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;background:royalBlue;border-bottom:lightblue 2px solid;color:white;font-family:consolas&quot;</span>&gt;</span>当使用重做日志文件来进行数据库恢复时，ORACLE将读取其中的重做记录(包括其中的修改向量)，并且将这些修改用于相关的块中。<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">5</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900&quot;</span>&gt;</span>存储结构管理主要就是通过对表空间的管理来实现的<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">6</span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;background:green;border-radius:10px;color:white&quot;</span>&gt;</span>效果如下：<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">7</span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">10px</span> <span class="attr">style</span>=<span class="string">&quot;font-weight:700;font-family:&#x27;华文彩云&#x27;;color:rgb(100,190,100)&quot;</span>&gt;</span>基本语言(一)<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">8</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;border-bottom: 2px dashed #000000&quot;</span>&gt;</span>代码段、数据段、BSS段、堆区、文件映射区以及栈区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">9</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background:black;font:conloas;color:white;&quot;</span>&gt;</span></span><br><span class="line"> 数组长度为：3<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> 请按任意键继续. . .</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">10</span><br><span class="line"><span class="tag">&lt;<span class="name">mark</span> <span class="attr">style</span>=<span class="string">&quot;color:white;background:red;font-weight:600;border_radius:100px&quot;</span>&gt;</span>但效率更高<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">11</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">summary</span>&gt;</span>更多<span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p><span class="fas faa-ring animated-hover" style="border-bottom:3px solid green">《半小时漫画中国哲学史》</span></p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p><span  style="text-align:center;font-size:20px;font:30px 书体坊兰亭体;color:blueviolent;word-spacing:30px;">“ 既许一人以偏爱，愿尽余生之慷慨 ”</span></p><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p><span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;"><a href="https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA">data.json文件链接</a></span> </p><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p><mark style="background:royalBlue;border-bottom:lightblue 2px solid;color:white;font-family:consolas">当使用重做日志文件来进行数据库恢复时，ORACLE将读取其中的重做记录(包括其中的修改向量)，并且将这些修改用于相关的块中。</mark></p><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><p><span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">存储结构管理主要就是通过对表空间的管理来实现的</span></p><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p><mark style="background:green;border-radius:10px;color:white">效果如下：</mark></p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p><font size=10px style="font-weight:700;font-family:'华文彩云';color:rgb(100,190,100)">基本语言(一)</font></p><h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><p><span style="border-bottom: 2px dashed #000000">代码段、数据段、BSS段、堆区、文件映射区以及栈区</span></p><h1 id="9"><a href="#9" class="headerlink" title="9"></a>9</h1><div style="background:black;font:conloas;color:white;"> 数组长度为：3<br> 请按任意键继续. . .</div><h1 id="10"><a href="#10" class="headerlink" title="10"></a>10</h1><p><mark style="color:white;background:red;font-weight:600;border_radius:100px">但效率更高</mark></p><h1 id="11-折叠"><a href="#11-折叠" class="headerlink" title="11 折叠"></a>11 折叠</h1><details>  <summary>更多</summary>  1. 列表1<br>  2. 列表2</details>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 样式 </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过 Commit 关闭 Issue</title>
      <link href="/%E6%89%8B%E5%86%8C/Git/%E5%85%B3%E9%97%ADissue/"/>
      <url>/%E6%89%8B%E5%86%8C/Git/%E5%85%B3%E9%97%ADissue/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="commit关闭issue"><a href="#commit关闭issue" class="headerlink" title="commit关闭issue"></a>commit关闭issue</h1><p>如果要在相同仓库关闭一个Issue（工单），可以使用下面列表中的关键词并在其后面加上Issue编号的应用（#+issue编号）。</p><p>例如一个提交信息中包含 Fixes #45 ，那么一旦这次提交被合并到默认分支，仓库中的45号issue就会自动关闭。</p><h2 id="Issue-关键字"><a href="#Issue-关键字" class="headerlink" title="Issue 关键字"></a>Issue 关键字</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">close</span><br><span class="line">closes</span><br><span class="line">closed</span><br><span class="line">fix</span><br><span class="line">fixes</span><br><span class="line">fixed</span><br><span class="line">resolve</span><br><span class="line">resolves</span><br><span class="line">resolved</span><br></pre></td></tr></table></figure><h2 id="关闭多个issues"><a href="#关闭多个issues" class="headerlink" title="关闭多个issues"></a>关闭多个issues</h2><p>如果你在commit的开头使用多个上述关键字加issue的引用的话，你就可以关闭多个issues。<br>例如，This closes #34, closes #23, and closes example_user&#x2F;example_repo#42将会关闭同一个仓库的34和23号issue以及 example_user&#x2F;example_repo 仓库的42号issue。</p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> Git </tag>
            
            <tag> Issue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 速查手册</title>
      <link href="/%E6%89%8B%E5%86%8C/Git/Git%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/"/>
      <url>/%E6%89%8B%E5%86%8C/Git/Git%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="查看远程仓"><a href="#查看远程仓" class="headerlink" title="查看远程仓"></a>查看远程仓</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure><h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看本地分支</span></span><br><span class="line">git branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看远程分支</span></span><br><span class="line">git branch -r</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有分支</span></span><br><span class="line">git branch -a</span><br></pre></td></tr></table></figure><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除远程分支</span></span><br><span class="line">git push origin --delete [branch_name]</span><br><span class="line"></span><br><span class="line">2. 删除本地分支区别</span><br><span class="line">git branch -d 会在删除前检查merge状态（其与上游分支或者与head）。</span><br><span class="line">git branch -D 是git branch --delete --force的简写，它会直接删除。</span><br><span class="line"></span><br><span class="line">共同点</span><br><span class="line">都是删除本地分支的方法（与删除远程分支命令相独立，要想本地和远程都删除，必须得运行两个命令）。</span><br><span class="line"></span><br><span class="line">3. git查看分支：</span><br><span class="line">查看本地分支 git branch</span><br><span class="line">查看远程分支 git branch -r</span><br><span class="line">查看本地和远程分支 git branch -a</span><br><span class="line"></span><br><span class="line">4.git删除分支：</span><br><span class="line">删除本地分支 git branch -d 本地分支名</span><br><span class="line">删除远程分支 git push origin --delete 远程分支名</span><br><span class="line">推送空分支到远程（删除远程分支另一种实现）git push origin :远程分支</span><br></pre></td></tr></table></figure><h1 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看git config</span></span><br><span class="line">git config -l </span><br></pre></td></tr></table></figure><h1 id="stash"><a href="#stash" class="headerlink" title="stash"></a>stash</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br><span class="line"></span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure><h1 id="拉取"><a href="#拉取" class="headerlink" title="拉取"></a>拉取</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取远端分支到本地分支 Develop分支到本地Develop分支</span></span><br><span class="line">git fetch origin Develop:Develop</span><br></pre></td></tr></table></figure><h1 id="查看已push但未提交的内容"><a href="#查看已push但未提交的内容" class="headerlink" title="查看已push但未提交的内容"></a>查看已push但未提交的内容</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry -v</span><br></pre></td></tr></table></figure><h1 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h1><h2 id="合并某个分支上的某一个文件"><a href="#合并某个分支上的某一个文件" class="headerlink" title="合并某个分支上的某一个文件"></a>合并某个分支上的某一个文件</h2><ol><li>切换到当前分支（即：要合并文件到的分支）</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout current_branch</span><br></pre></td></tr></table></figure><ol start="2"><li>合并指定分支上的文件到当前分支</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --patch zhiding_branch f.txt</span><br></pre></td></tr></table></figure><p>合并 <code>zhiding_branch</code> 分支上的 <code>f.txt</code> 文件到 <code>current_branch</code></p><h1 id="git-log-最强语句"><a href="#git-log-最强语句" class="headerlink" title="git log 最强语句"></a>git log 最强语句</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global alias.lg &quot;log --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit --date=relative&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 配置多账号</title>
      <link href="/%E6%89%8B%E5%86%8C/Git/Git%E9%85%8D%E7%BD%AE%E5%A4%9A%E8%B4%A6%E5%8F%B7/"/>
      <url>/%E6%89%8B%E5%86%8C/Git/Git%E9%85%8D%E7%BD%AE%E5%A4%9A%E8%B4%A6%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="生成多个密钥"><a href="#生成多个密钥" class="headerlink" title="生成多个密钥"></a>生成多个密钥</h1><ol><li><p>生成多个密钥，生成时修改密钥文件的文件名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;邮箱&quot;</span></span><br></pre></td></tr></table></figure><p>注意上述命令执行完之后第一个输入要求的是输入的保存的文件名</p><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;holdyounger@163.com&quot;</span></span><br><span class="line"><span class="comment"># 保存的时候可以选择保存文件的名称设置为 fork_hodlyounger_ssh_key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接着执行另外一个账号</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;公司邮箱&quot;</span></span><br><span class="line"><span class="comment"># 保存的时候可以选择保存文件的名称设置为 id_rsa</span></span><br></pre></td></tr></table></figure></li><li><p>添加密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换</span></span><br><span class="line">ssh-agent bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line">ssh-add ~/.ssh/fork_hodlyounger_ssh_key</span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></li><li><p>将密钥添加到账户中</p><p>使用 <code>cat</code> 查看对应账户的 <code>pub</code> 文件。将其内容添加到账户中。</p></li><li><p>添加本地配置文件</p><blockquote><p>添加本地配置文件用以区分密钥在哪个git中使用，配置如下所示<br>配置文件更详细的说明可以参考这篇文章 <a href="https://www.cnblogs.com/nhdlb/p/16718642.html">Git：单台电脑同时配置多个git账号 - 怒吼的萝卜 - 博客园</a></p></blockquote><p>新建config文件，文件内容如下所示。</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个是我私人的GitHub</span></span><br><span class="line">Host github</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile  ~/.ssh/fork_hodlyounger_ssh_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个是公司的GitLab</span></span><br><span class="line">Host git-biz.cn</span><br><span class="line">HostName git-biz.cn</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>配置文件补充说明</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里是自定义的host简称，以后连接远程服务器就可以用命令ssh myhost</span></span><br><span class="line">Host</span><br><span class="line"><span class="comment"># 主机名可用ip也可以是域名(如:github.com或者bitbucket.org)</span></span><br><span class="line">HostName</span><br><span class="line"><span class="comment"># 服务器open-ssh端口（默认：22,默认时一般不写此行）</span></span><br><span class="line">Port</span><br><span class="line"><span class="comment"># 配置登录时用什么权限认证</span></span><br><span class="line"><span class="comment"># 可设为(publickey, password publickey, keyboard-interactive 等)</span></span><br><span class="line">PreferredAuthentications</span><br><span class="line"><span class="comment"># 证书文件路径（如~/.ssh/id_rsa_*)</span></span><br><span class="line">IdentityFile</span><br><span class="line"><span class="comment"># 云端仓库登录用户名</span></span><br><span class="line">User</span><br></pre></td></tr></table></figure><h1 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h1><p>   简单点就是ssh：</p>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T <span class="string">&quot;holdyoungere@163.com&quot;</span></span><br></pre></td></tr></table></figure><p>   返回 <code>Hi (用户名)! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code> 开头样式的表示添加密钥成功了。</p>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 多账号 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git emoji手册</title>
      <link href="/%E6%89%8B%E5%86%8C/Git%20emoji%E6%89%8B%E5%86%8C/"/>
      <url>/%E6%89%8B%E5%86%8C/Git%20emoji%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th align="center">emoji</th><th align="center">emoji 代码</th><th align="center">commit 说明</th></tr></thead><tbody><tr><td align="center">🎨 (调色板)</td><td align="center"><code>:art:</code></td><td align="center">改进代码结构 &#x2F; 代码格式</td></tr><tr><td align="center">⚡️ (闪电) 🐎 (赛马)</td><td align="center"><code>:zap:</code> <code>:racehorse:</code></td><td align="center">提升性能</td></tr><tr><td align="center">🔥 (火焰)</td><td align="center"><code>:fire:</code></td><td align="center">移除代码或文件</td></tr><tr><td align="center">🐛 (bug)</td><td align="center"><code>:bug:</code></td><td align="center">修复 bug</td></tr><tr><td align="center">🚑 (急救车)</td><td align="center"><code>:ambulance:</code></td><td align="center">重要补丁</td></tr><tr><td align="center">✨ (火花)</td><td align="center"><code>:sparkles:</code></td><td align="center">引入新功能</td></tr><tr><td align="center">📝 (备忘录)</td><td align="center"><code>:memo:</code></td><td align="center">撰写文档</td></tr><tr><td align="center">🚀 (火箭)</td><td align="center"><code>:rocket:</code></td><td align="center">部署功能</td></tr><tr><td align="center">💄 (口红)</td><td align="center"><code>:lipstick:</code></td><td align="center">更新 UI 和样式文件</td></tr><tr><td align="center">🎉 (庆祝)</td><td align="center"><code>:tada:</code></td><td align="center">初次提交</td></tr><tr><td align="center">✅ (白色复选框)</td><td align="center"><code>:white_check_mark:</code></td><td align="center">更新测试</td></tr><tr><td align="center">🔒 (锁)</td><td align="center"><code>:lock:</code></td><td align="center">修复安全问题</td></tr><tr><td align="center">🍎 (苹果)</td><td align="center"><code>:apple:</code></td><td align="center">修复 macOS 下的问题</td></tr><tr><td align="center">🐧 (企鹅)</td><td align="center"><code>:penguin:</code></td><td align="center">修复 Linux 下的问题</td></tr><tr><td align="center">🏁 (旗帜)</td><td align="center"><code>:checkered_flag:</code></td><td align="center">修复 Windows 下的问题</td></tr><tr><td align="center">🤖（机器人）</td><td align="center"><code>:robot:</code></td><td align="center">修复 Android 下的问题</td></tr><tr><td align="center">🍏 (绿苹果)</td><td align="center"><code>:green_apple:</code></td><td align="center">修复 iOS 下的问题</td></tr><tr><td align="center">🔖 (书签)</td><td align="center"><code>:bookmark:</code></td><td align="center">发行 &#x2F; 版本标签</td></tr><tr><td align="center">🚨 (警车灯)</td><td align="center"><code>:rotating_light:</code></td><td align="center">移除 linter 警告</td></tr><tr><td align="center">🚧 (施工)</td><td align="center"><code>:construction:</code></td><td align="center">工作进行中</td></tr><tr><td align="center">👷 (工人)</td><td align="center"><code>:construction_worker:</code></td><td align="center">添加 CI 构建系统</td></tr><tr><td align="center">💚 (绿心)</td><td align="center"><code>:green_heart:</code></td><td align="center">修复 CI 构建问题</td></tr><tr><td align="center">⬆️ (上升箭头)</td><td align="center"><code>:arrow_up:</code></td><td align="center">升级依赖</td></tr><tr><td align="center">⬇️ (下降箭头)</td><td align="center"><code>:arrow_down:</code></td><td align="center">降级依赖</td></tr><tr><td align="center">📌 (图钉)</td><td align="center"><code>:pushpin:</code></td><td align="center">将依赖项固定到特定版本</td></tr><tr><td align="center">📈 (上升趋势图)</td><td align="center"><code>:chart_with_upwards_trend:</code></td><td align="center">添加分析或跟踪代码</td></tr><tr><td align="center">♻️ （回收）</td><td align="center"><code>:recycle:</code></td><td align="center">重构代码</td></tr><tr><td align="center">🐳 (鲸鱼)</td><td align="center"><code>:whale:</code></td><td align="center">Docker 相关工作</td></tr><tr><td align="center">🌐 (带子午线的地球仪)</td><td align="center"><code>:globe_with_meridians:</code></td><td align="center">国际化与本地化</td></tr><tr><td align="center">➕ (加号)</td><td align="center"><code>:heavy_plus_sign:</code></td><td align="center">增加一个依赖</td></tr><tr><td align="center">➖ (减号)</td><td align="center"><code>:heavy_minus_sign:</code></td><td align="center">减少一个依赖</td></tr><tr><td align="center">🔧 (扳手)</td><td align="center"><code>:wrench:</code></td><td align="center">修改配置文件</td></tr><tr><td align="center">🔨 (锤子)</td><td align="center"><code>:hammer:</code></td><td align="center">重大重构</td></tr><tr><td align="center">✏️ (铅笔)</td><td align="center"><code>:pencil2:</code></td><td align="center">修复 typo</td></tr><tr><td align="center">💩 (粑粑…)</td><td align="center"><code>:hankey:</code></td><td align="center">写了辣鸡代码需要优化</td></tr><tr><td align="center">⏪ (倒带)</td><td align="center"><code>:rewind:</code></td><td align="center">恢复更改</td></tr><tr><td align="center">🔀 (交叉向右的箭头)</td><td align="center"><code>:twisted_rightwards_arrows:</code></td><td align="center">合并分支</td></tr><tr><td align="center">📦 (包裹)</td><td align="center"><code>:package:</code></td><td align="center">更新编译的文件或包</td></tr><tr><td align="center">👽 (外星人)</td><td align="center"><code>:alien:</code></td><td align="center">由于外部 API 更改而更新代码</td></tr><tr><td align="center">🚚 (货车)</td><td align="center"><code>:truck:</code></td><td align="center">移动或者重命名文件</td></tr><tr><td align="center">📄 (正面朝上的页面)</td><td align="center"><code>:page_facing_up:</code></td><td align="center">增加或更新许可证书</td></tr><tr><td align="center">💥 (爆炸)</td><td align="center"><code>:boom:</code></td><td align="center">引入突破性的变化</td></tr><tr><td align="center">🍱 (铅笔)</td><td align="center"><code>:bento:</code></td><td align="center">增加或更新资源</td></tr><tr><td align="center">👌 (OK 手势)</td><td align="center"><code>:ok_hand:</code></td><td align="center">由于代码审查更改而更新代码</td></tr><tr><td align="center">♿️ (轮椅)</td><td align="center"><code>:wheelchair:</code></td><td align="center">改善无障碍交互</td></tr><tr><td align="center">💡 (灯泡)</td><td align="center"><code>:bulb:</code></td><td align="center">给代码添加注释</td></tr><tr><td align="center">🍻 (啤酒)</td><td align="center"><code>:beers:</code></td><td align="center">醉醺醺地写代码…</td></tr><tr><td align="center">💬 (消息气泡)</td><td align="center"><code>:speech_balloon:</code></td><td align="center">更新文本文档</td></tr><tr><td align="center">🗃 (卡片文件盒)</td><td align="center"><code>:card_file_box:</code></td><td align="center">执行与数据库相关的更改</td></tr><tr><td align="center">🔊 (音量大)</td><td align="center"><code>:loud_sound:</code></td><td align="center">增加日志</td></tr><tr><td align="center">🔇 (静音)</td><td align="center"><code>:mute:</code></td><td align="center">移除日志</td></tr><tr><td align="center">👥 (轮廓中的半身像)</td><td align="center"><code>:busts_in_silhouette:</code></td><td align="center">增加贡献者</td></tr><tr><td align="center">🚸 (孩童通行)</td><td align="center"><code>:children_crossing:</code></td><td align="center">优化用户体验、可用性</td></tr><tr><td align="center">🏗 (建筑建造)</td><td align="center"><code>:building_construction:</code></td><td align="center">结构变动</td></tr><tr><td align="center">📱 (iPhone)</td><td align="center"><code>:iphone:</code></td><td align="center">做响应式设计</td></tr><tr><td align="center">🤡 (小丑脸)</td><td align="center"><code>:clown_face:</code></td><td align="center">嘲弄事物（直译，这个没明白）</td></tr><tr><td align="center">🥚 (鸡蛋)</td><td align="center"><code>:egg:</code></td><td align="center">增加彩蛋</td></tr><tr><td align="center">🙈 (看不见邪恶)</td><td align="center"><code>:see_no_evil:</code></td><td align="center">增加或更改 gitignore</td></tr><tr><td align="center">📸 (照相机闪光灯)</td><td align="center"><code>:camera_flash:</code></td><td align="center">增加或更新截图</td></tr><tr><td align="center">⚗️ (蒸馏器)</td><td align="center"><code>:alembic:</code></td><td align="center">尝试新东西</td></tr><tr><td align="center">🔍 (放大镜)</td><td align="center"><code>:mag:</code></td><td align="center">SEO 优化</td></tr><tr><td align="center">☸️ (船的方向盘)</td><td align="center"><code>:wheel_of_dharma:</code></td><td align="center">关于 Kubernetes 的工作</td></tr><tr><td align="center">🏷 (标签)</td><td align="center"><code>:label:</code></td><td align="center">增加类型（FLow、Typescript）</td></tr><tr><td align="center">🌱(听诊器)</td><td align="center"><code>:seedling:</code></td><td align="center">添加或更新种子文件</td></tr><tr><td align="center">🧵 (毛线圈)</td><td align="center"><code>:thread:</code></td><td align="center">添加或更新与多线程或并发性相关的代码</td></tr><tr><td align="center">🦺(安全马甲)</td><td align="center"><code>:safety_vest:</code></td><td align="center">添加或更新与验证相关的代码</td></tr><tr><td align="center">🧑‍💻(程序)</td><td align="center"><code>:technologist:</code></td><td align="center">改善开发者体验 :technologist:</td></tr><tr><td align="center">🧱(砖)</td><td align="center"><code>:bricks:</code></td><td align="center">基础设施相关的变化</td></tr><tr><td align="center">🩺(听诊器)</td><td align="center"><code>:stethoscope:</code></td><td align="center">添加或更新运行状况检查</td></tr><tr><td align="center">👔(衬衫)</td><td align="center"><code>:necktie:</code></td><td align="center">添加或更新业务逻辑</td></tr><tr><td align="center">🧪(试管)</td><td align="center"><code>:test_tube:</code></td><td align="center">添加失败的测试</td></tr><tr><td align="center">⚰️(棺椁)</td><td align="center"><code>:coffin:</code></td><td align="center">删除死代码</td></tr><tr><td align="center">🧐(观察)</td><td align="center"><code>:monocle_face:</code></td><td align="center">数据探索&#x2F;检查</td></tr><tr><td align="center">🩹(创可贴)</td><td align="center"><code>:adhesive_bandage:</code></td><td align="center">简单修复非关键问题</td></tr><tr><td align="center">🛂(鉴权)</td><td align="center"><code>:passport_control:</code></td><td align="center">处理与授权、角色和权限相关的代码</td></tr><tr><td align="center">🗑️(垃圾桶)</td><td align="center"><code>:wastebasket:</code></td><td align="center">需要清理的废弃代码</td></tr><tr><td align="center">💫(动画)</td><td align="center"><code>:dizzy:</code></td><td align="center">添加或更新动画和过渡</td></tr><tr><td align="center">🥅(足球门)</td><td align="center"><code>:goal_net:</code></td><td align="center">捕获异常</td></tr><tr><td align="center">🚩(旗帜)</td><td align="center"><code>:triangular_flag_on_post:</code></td><td align="center">添加、更新或删除功能标志</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>英雄联盟语录</title>
      <link href="/%E6%89%8B%E5%86%8C/Game/LOL/"/>
      <url>/%E6%89%8B%E5%86%8C/Game/LOL/</url>
      
        <content type="html"><![CDATA[<ol><li>仁义道德，也是一种奢侈。——亚索</li><li>千军万马一将在，探囊取物有何难。——皇子</li><li>落叶的一生，只是为了归根么。——亚索</li><li>我对你的爱就如闪电，狂暴而剧烈，飞出的飞镖，是我向你传达的思念。——狂暴之心</li><li>且听风吟，御剑于心。——亚索</li><li>一曲终了，繁花散尽，伊人已逝，只余一声空叹。——死亡颂唱者</li><li>我只是部落遗子，你确是高贵公主，我愿把我生命的力量化为三刀为你而战，只为证明我，配的上你。——蛮族之王</li><li>我对你的爱就如闪电，狂暴而剧烈，飞出的飞镖是向你传达的思念。——狂暴之心</li><li>无情的岁月慢慢的侵蚀你我的生命，在这尽头请允许我为你弹下那回忆的肖邦。——琴瑟仙女</li><li>从我手中脱离的刀刃一直在飞舞，我不断的变强，只是为了守护我们的家园，我等候你的归来。——刀锋意志</li><li>放马过来吧！你会死的很光荣的！——盖伦</li><li>即使一无所有，也要未雨绸缪！——法外狂徒</li><li>征战沙场，只为守护我们的家园。只为解甲归田后，可以在墓前守护你一辈子。——德邦</li><li>我们不受岁月左右。——马尔扎哈</li><li>我可以想去哪就去哪，但是我只想进入你的心里。——祖安狂人</li><li>想要再来一发吗，我可不会留下任何悬念。——女警</li><li>体型并不能说明一切！——提莫</li><li>妩媚倾城的面容，我蛊惑万千众生，孰不知，心里，早有了一个人。却只能无尽的思念，你送我的宝珠，我一直带着，只因为我能看见你的身影。——九尾妖狐</li><li>规则就是用来打破的！——金克丝</li><li>你的遗体将慢慢消散，化为永恒，就像沙漠中的沙砾那样。——狗头</li><li>不管是怎么样的天气，不管是什么样的环境，不管有什么样的危险，我的伙伴，雪人，一直都会陪着我。——雪人骑士</li><li>世界上最痛苦的事情，莫过于爱你，却不能对你说出，我只能倾注于我的琴，让我的旋律诉说我的爱。——琴瑟仙女</li><li>下了手中的武器，我知道你已厌倦。目送你离开，我亮起黄昏的路灯，照亮你回家的路。——武器大师</li><li>他们会像迎接英雄一般迎接你们。——暗裔剑魔</li><li>这个故事还没有完结。——亚索</li><li>我宁愿犯错误，也不愿什么都不做。——艾克</li><li>断剑重铸之日，其势归来之时！——瑞文</li><li>我追逐的是你的背影，我跟随的是你的微笑，就算暴风雨到来我依然能在你左右。——雷霆咆哮</li><li>只有蠢货才会犹豫不决。——卡特琳娜</li><li>入体冰凉的月光都比不上你绝情的目光，为了击碎你伪装的表面，我只能用尽全身力气挥出那惊鸿的半月弧光。——皎月女神</li><li>念当年有爱的我，可惜啊，你们看不到啦。——水晶先锋</li><li>夜，雪花飘落；我，孤独风中；凛冽的寒风，割裂着我的皮肤。不知绝对的零度是否能冻结对你的思念。——雪人骑士</li><li>人生最痛苦的事莫过于你明知要失去，却还没发生。——基兰</li><li>即使是一无所有的人也会为自己所珍惜的一切而献出生命。——暗裔剑魔</li><li>人们向往天堂，可天堂没有你。于是我堕落凡间追寻你的脚步，只因有你的地方才是天堂。——堕落天使</li><li>这只是一场战役，而我，已经赢下了战争！——丽桑卓</li><li>我来自深海，我没有朋友，大家都不和我玩，只有巨鲨是我的朋友，你愿意和它一起玩吗？——潮汐海灵</li><li>征战沙场，只为守护我们的家园。只为解甲归田后，可以在墓前守护你一辈子。——德邦总管</li><li>哼，一个能打的都没有！——武器大师</li><li>别看我的眼睛，里面只有愤怒和痛苦。我诅咒着一切，也诅咒着自己。——魔蛇之拥</li><li>我一直急速前行，穿梭于人人之间，试图叫应接不暇的风景让我褪去对你的思念。——无极剑圣</li><li>太阳不会揭露真相。它的光芒只会让人灼伤和致盲。——黛安娜</li><li>我一直急速前行穿梭于人人之间试图叫应接不暇的风景让我褪去对你的思念——无极剑圣</li><li>死后能做的最棒的事情是什么？就是碾碎你的敌人，看着他们先你一步而去，并聆听他们怯懦的哭喊。——赛恩</li><li>你有一双摄人心魄的眼睛。我非常喜欢。——赏金猎人</li><li>命运已做出了它的选择！——赵信</li><li>你总说我太小，但是出现危险我都会跳跃到你身边，将危险推开。用手中的炮筒，守护我小小的爱。——麦林炮手</li><li>你们不能逮捕我，我爹是瓦罗兰的抗把子。——奥拉夫</li><li>悄悄的我走了，正如我悄悄的来；我摸一摸戒指，再带走一次五杀。——剑圣</li><li>你们知道最强的武器是什么？没错，就是补丁！——武器大师</li><li>我在时光中穿梭，只为找回曾经美好的时光。——时光守护者</li><li>你们这种战斗力，我建议你们还是投降算了。——拉克丝</li><li>炙热的铁拳砸不开你面前的牢笼，不甘放弃的努力，只为了有一天能砸开牢笼见你一面。——皮城执法官</li><li>想攻击我？先试试和影子玩拳击吧。——暗夜猎手</li><li>我疯狂的奔跑，只想为你承受一切的伤害，我竖起了山丘，不愿你看见我丑陋的脸庞。——诅咒巨魔</li><li>哪一个比较沉重，你的剑刃，还是你的过去？——亚索</li><li>物是人非，可我依旧穿着嫁衣，在黑夜中寻找你的身影。你我的约定我一直记得，那一道道璀璨的光束，都是为你所亮。——寡妇制造者</li><li>断剑可以重铸，破镜是否可以重圆？心碎可以可以无痕？——放逐之刃</li><li>不要测试你的运气，召唤师！——卡特琳娜</li><li>曾经，我们错过了，但是，我希望你的未来有我，有我来守护着你。——未来守护者</li><li>没有你的世界，我感到孤独。我一次次地想随你而去，但是又一次次地重生。长生不死对我而言是一件多么痛苦的事情。——暗裔剑魔</li><li>吾之荣耀，离别已久。——亚索</li><li>这场流星雨，只是想给你看，没想到却是伤害了你。——众星之子</li><li>你将忘记呼吸，你将忘记爱情。——卡尔萨斯</li><li>在瓦罗兰，我是一个无恶不作的大海盗。而成为海盗的原因是为你保驾护航。——海盗船长</li><li>外表可是具有欺骗性的。——妖姬</li><li>那拿枪的海盗，是记忆里的核心；浩空里的流星，在我的脑海闪过。——赏金猎人</li><li>守护你是我最后的希望，束缚着的是思念，丢弃的是无奈，最后我会留下一个圈摆放你我的回忆，直到我也干枯，你也远去！——扭曲树精</li><li>时间不在于你拥有多少，而在于你怎样使用。——艾克</li><li>我每向你射出一支箭，便代表我对你的爱多一分，而你，是否会接受我万千的爱？——寒冰射手</li><li>我一直急速前行，穿梭于人人之间。试图借应接不暇的风景让我褪去对你的思念。——无极剑圣</li><li>死亡如风，常伴吾身。——亚索</li><li>顺我者昌，逆我者亡，此乃天意。——卡牌</li><li>即使丑陋的外表也掩盖不了我对召唤师的感激之情，即使在很危险的情况下我也会挺身而出。——诅咒巨魔</li><li>那双枪下的弹幕，不是烟花，是琴上律；爆发在好运间，释放着海盗似的野。——赏金猎人</li><li>人终归是要死的，为什么不选择一种死亡的方式呢？——卡尔萨斯</li><li>过去那个爱笑的我已经不在了，现在的我只剩下魔法与记忆以及这个丑陋不堪的身躯，孤独的在这个世界徘徊。——水晶先锋</li><li>这不仅仅只是屠杀，而是我的杰作。——暗裔剑魔</li><li>我是一个影子，当我潜入阴影之中，没有人能够看见我，但是我希望你是个例外！——影流之主</li><li>甲板上的脚印，稳稳的在船上蔓延；在碧海的波浪里，我如愿做一条飞鱼！——赏金猎人</li><li>朋友，有我在你就是不死的。即使我死了。也要让你活着离开。——众星之子</li><li>我没有过多的抱怨，漫天的乌鸦都是我的朋友，有这个，就足够了——末日使者</li><li>我的剑比什么都重要，除了美酒。——亚索</li><li>我也希望变成蝴蝶的那一天，不再灰色，不再痛苦。不会再让我丑陋的外表吓到美丽的你。——深渊巨口</li><li>我愚蠢的以为，头上的金箍圈可以圈住你所有的爱，可惜我手中的金箍棒改变不了那个开始，也决定不了这个结局，根本没有齐天大圣，我只是一只猴子。——齐天大圣</li><li>冰冷的锁链，无情的束缚，黑色的羽毛，血色的双眼，所有的一切都是因为那颗冷寂的心。——堕落天使</li><li>狂野将使他们感到畏惧。——豹女</li><li>我不顾一切的冲出去……为你开辟一条安稳的路。我满腔热血的拍打着……为你抛开任何绊脚的石。最后，我坦然微笑着用躯体为你抵挡一切……因为我的身体上旋转着我们的誓言！——牛头酋长</li><li>我不会怀着耻辱而死！——亚索</li><li>断刃可以修复，残心如何弥补。——放逐之刃</li><li>冰封千年的心，只为等待那瞬间的融化。日夜凄美的呼唤。也换不回你微笑的回眸。——冰晶凤凰</li><li>树叶的一生只是为了归根么？——疾风剑豪</li><li>闭上眼睛，你会看到更多。——仙灵女巫璐璐</li><li>炽热的铁拳砸不开你面前的牢笼，不甘放弃的努力，只为了有一天能砸开牢笼见你一面。——皮城执法官蔚</li><li>我能在空气中嗅到敌人的味道，我很努力了，可是，为什么还是找不到你的踪迹呢！——嗜血猎手</li><li>放下了手中的武器，我知道你已厌倦，目送你离开，亮起黄昏的路灯，照亮你回家的路。——武器大师</li><li>你一直在畏惧我的毒刺，别怕，让我用我的毒刺把你牵引到我的身边。——水晶先锋</li><li>追逐的是你的背影，我跟随的是你的微笑，就算黑夜到来我依然能在你左右。——永恒梦魇</li><li>我日复一日地把自己弄得伤痕累累，只是为了看到你为我查看伤口时的柔情。——阿木木</li><li>像英雄一样战斗，或者像懦夫一样死去。——暗裔剑魔</li><li>我和战争一样永恒。——暗裔剑魔</li><li>我筑起高墙，只为了跟你锁在一起，不离不弃。——皇子</li><li>谁说笑着就是愉悦，在我微笑的面具下，是已为你风干了伤痕的心，之所以逗万千人开心，只不过是为了等你转世之后对我的，轻浅一笑。——恶魔小丑</li><li>明日安在，无人能允。——亚索</li><li>在无人注视的角落，独自默默的弹奏。琴音带着我的思恋，妄图拉住你转身而去的袖角。——琴瑟仙女</li><li>生命，不过只是一场骗局，从你开始呼吸的那一刻起，你就已经在慢慢死亡了。——死亡颂唱者</li><li>这场战争，将会是我的杰作！——暗裔剑魔</li><li>无形之刃，最为致命。——劫</li><li>妩媚倾城的面容，我蛊惑万千众生。殊不知心里早有了一个人，却只能无尽的思念。你送我的宝珠我一直带着，只因为我能看见你的身影。——九尾妖狐</li><li>永远不要质疑我的忠诚，你不会了解我为之忍受的一切。——卡特琳娜</li><li>如果你赢不了，试试换一把大点的剑！通常都有用。——咆啸深渊</li><li>我披上坚甲，挡在你前面。万千的关心，只化为一句小心。——披甲龙龟</li><li>大地的融化，海水的暴涨，星辰的坠落。我虚空的眼睛无法先知你的足迹。——虚空先知</li><li>我在时空中穿梭，只为找回曾经美好的时光……——时光老人</li><li>在诺克萨斯有一个残忍的杀手，但是你们都不明白他其实是为了国家在战斗，他的苦楚有几人懂？——诺克萨之手</li><li>有我在就不允许别人伤害你，即使我死了，也要你活着离开。——众星之子</li><li>刀光剑影，铁石心肠，只有你知道在隐雾下的我，还是那么脆弱，容易感伤。——刀锋之影</li><li>如果我俩角色互换，我会让你看看，什么叫残忍！——维嘉</li><li>我没有过多的抱怨，漫天的乌鸦都是我的朋友，有这个，就足够了。——末日使者</li><li>世间万物，表里如一者，又有几何？——婕拉</li><li>卑微的我拿起手弩隐匿在你的左右，守护着你，即使你永远也不知道。——瘟疫之源</li><li>每一张牌，都是对你的思念。我赌赢了所有，却赢不回你的爱。——卡牌大师</li><li>那手中的冥火，是坦克中的噩梦；无极里的鬼影，在我的身边穿梭。——剑圣</li><li>每一张牌，都是对你的一份思念，我赌赢了所有，却赢不回你的爱。——卡牌大师</li><li>行走于虚空，我彷徨，我迷茫。我不知何去何从，只有飘飘荡荡。——虚空行者</li><li>不要错把仁慈当做弱小。——冰女</li><li>我们该怎么进行，这令人预约的折磨呢？——魂锁典狱长</li><li>我一路种下了蘑菇，只为让你知道回家的路。——迅捷斥候</li><li>邪恶的外表，其实并不是我的内心。你总是说我困住了你，你会为我停留么？——邪恶小法师</li><li>心怀恐惧的死去，或者手染鲜血的获胜。——暗裔剑魔</li><li>恩……你们的肉非常可口。–嗜血猎手</li><li>我是一个影子，当我潜入阴影之中，没有人能够看见我，但是，我希望你是个例外！–影流之主</li><li>液压系统已开启。–首领之傲</li><li>我披上坚甲，挡在你的身前，万千的关心只化为一句：小心。–披甲龙龟</li><li>让我们合伙干吧！–猩红收割者</li><li>要协调。–琴瑟仙女</li><li>你一直在畏惧我的毒刺，别怕，让我用我的毒刺把你牵引到我的身边。–水晶先锋</li><li>我敢打赌，你的味道和鸡肉差不多。–策士统领</li><li>众星啊……我……回来……了……–众星之子</li><li>面具的笑容，遮挡不住我的悲伤，谁能看到我面具下的眼泪。–恶魔小丑</li><li>妩媚倾城的面容，我蛊惑万千众生，孰不知心里早已有了一个人，却只能无尽的思念，你送我的宝珠我一直带着，只因为我能看见你的身影。–九尾妖狐</li><li>你要来几发么？–寒冰射手</li><li>野性的本能，指引着我们的拳头。–野兽之灵</li><li>血块变厚了。–猩红收割者</li><li>我可以在空气中嗅到敌人的味道，我很努力了，可是，为什么还是找不到你的踪迹。–嗜血猎手</li><li>我们的本能如同剃刀般锋利！–野兽之灵</li><li>命运已做出了它的选择！–德邦总管</li><li>恶作剧的对象，是你哟！–恶魔小丑</li><li>没错，我知道我让你无法呼吸。–风暴女神</li><li>在无尽的虚空中，我感到了前所未有的孤独，我可以掠夺任何生命，但是却掠夺他们的心。–虚空掠夺者</li><li>现在他们可以死了！–蛮族之王</li><li>听我说，召唤师。我并没有兄弟，也不认识特斯拉！我的瞬移以及分身靠的都是魔法！–恶魔小丑</li><li>我的剑刃不但准，而且狠！–刀锋意志</li><li>愿意送我点血吗？–猩红收割者</li><li>艾欧尼亚不会灭亡。–刀锋意志</li><li>血液正在慢慢滴落。–猩红收割者</li><li>当黑色的玫瑰悄悄绽放，除了镜花水月，又有谁能了解我的心。–诡术妖姬</li><li>瞧瞧你的背后~–恶魔小丑</li><li>刀光剑影，铁石心肠，只有你知道在隐雾下的我，还是那么脆弱，容易感伤。–刀锋之影</li><li>血流成河！–猩红收割者</li><li>团结起来吧，我们必将凯旋。–天启者</li><li>击鼓，进军！–德邦总管</li><li>我没有过多的抱怨，漫天的乌鸦都是我的朋友，有这个就足够了。–末日使者</li><li>我会尽情享受他们的骨头的。–嗜血猎手</li><li>他们的胜利必将成为奢望！–刀锋意志</li><li>你们打架的时候总是这么不给力么？–众星之子</li><li>缓慢的步伐，踉跄的脚步，满嘴的胡话，还有嘴角那一抹苦涩的微笑，为何酒精都不能解脱我对你的思念。–酒桶</li><li>没有地方可以安生！–扭曲树精</li><li>你笑我为何拿上锤和盾，你说有你在，我不会受到伤害。可是你不知道，让我受伤的人，是你。–钢铁大使</li><li>收获之月，多美妙的名字啊。–猩红收割者</li><li>宝石们显露着它们的锋芒。–宝石骑士</li><li>你们只是玻璃制品，一碰就碎。–宝石骑士</li><li>我很想陪伴在你的身边，只是你不允许，没关系，在你需要帮助时，我还是会出现在你的身边。–暮光之眼</li><li>提莫队长正在待命！–迅捷斥候</li><li>要优美。–琴瑟仙女</li><li>我追逐的是你的背影，我跟随的是你的微笑，就算暴风雨到来，我依然在你的左右。–雷霆咆哮</li><li>下了手中的武器，我知道你已厌倦，目送你离开，亮的起黄昏的路灯，照亮你回家的路。–武器大师</li><li>为荣誉而战！–战争女神</li><li>您果然深思熟虑，召唤师。–暮光之眼</li><li>噢，你想要什么？–瘟疫之源</li><li>精彩的二重唱。–琴瑟仙女</li><li>我的剑刃从不颤抖。–刀锋意志</li><li>只有飞速的旋转，才可以止住我的泪水，忘记你的模样。–不祥之刃</li><li>给我找些更强的敌人！–嘉文四世</li><li>可以接受的冒险。–策士统领</li><li>让我来引领您走向胜利。–众星之子</li><li>选牌吧！–卡牌大师</li><li>我喜欢有心脏的勇士，并且绝对不会让他们过期。–猩红收割者</li><li>我知道自己一身的痛苦，我没有选择，我只有带着你的灵魂离去。–金属大师</li><li>将他们冲散！–牛头酋长</li><li>在漆黑的夜里你需要一道光照亮夜行的路，我燃烧了自己，但也造就了你我不能相拥。–复仇焰魂</li><li>当水晶箭射像你的时候，请不要害怕，只是为了让你片刻的驻足，好让我追赶你的脚步。–寒冰射手</li><li>目标已被标记。–暮光之眼</li><li>保护忠良！–嘉文四世</li><li>哪里有战斗，哪里就有我。–天启者</li><li>是啊！哈哈哈哈哈！–邪恶小法师</li><li>一曲终了，繁花散尽，伊人已逝，只余一声空叹。–死亡颂唱者</li><li>魔法！它在召唤我！–邪恶小法师</li><li>我来自深海，我没有朋友，大家都不和我玩，只有巨鲨是我的朋友，你愿意和他一起玩吗？–潮夕海灵</li><li>我是魔鬼！不许笑！–邪恶小法师</li><li>一切尽在卡牌之中。–卡牌大师</li><li>是摇，还是不摇，这是一个问题。–炼金术士</li><li>吃我一记重击！–亡灵勇士</li><li>中场休息时间！–琴瑟仙女</li><li>我想我会让你难受一阵子的！–宝石骑士</li><li>我用意念传达给您。–琴瑟仙女</li><li>这首是慢板曲，召唤师。–琴瑟仙女</li><li>完美的节拍。–琴瑟仙女</li><li>我会悼念你的。–宝石骑士</li><li>如果善待动物协会问起来的话，我们就说这些皮毛是仿制的。–野兽之灵</li><li>我宁愿相信一切，也不愿再相信世人，只有野兽能告诉我什么叫感情。–野兽之灵</li><li>忠诚之心永不停息。–首领之傲</li><li>我的&#96;道路，清澈无比。–众星之子</li><li>我会下达命令。–策士统领</li><li>俺很生气，后果很严重！–牛头酋长</li><li>视死如归，就在今天！–嘉文四世</li><li>正做着呢！–卡牌大师</li><li>如果我能休息就好了。–扭曲树精</li><li>要象征美好时光，请找琥珀。–宝石骑士</li><li>你是没有机会赢我的。–蛮族之王</li><li>没有退路了！–刀锋意志</li><li>亡命天涯，只是为了追寻你的足迹。却不想命运的捉弄，总是让你我天各一方。–法外狂徒</li><li>永恒痛苦的赠品。–首领之傲</li><li>战斗吧！–战争女神</li><li>这就是我收养那些流浪剑刃的结果。–刀锋意志</li><li>我好想射点儿什么！–麦林炮手</li><li>狩猎的时候到了。–嗜血猎手</li><li>我也试图终结过这困扰，但它总会卷土重来。–扭曲树精</li><li>执行均衡之令。–暮光之眼</li><li>德玛西亚，永世长存！–嘉文四世</li><li>是，长官！–迅捷斥候</li><li>不要否认你的本能，召唤师。–野兽之灵</li><li>你我的约定，我一直记得。那一道道璀璨的光辉，都是为你所亮。–光辉女郎</li><li>我愚蠢的以为，头上的金箍圈可以圈住你所有的爱，可是我手中的金箍棒改变不了那个开始，也决定不了这个结局，根本没有齐天大圣，我只是一只猴子。–齐天大圣</li><li>这很好玩吖！–恶魔小丑</li><li>我对你的爱就如闪电，狂暴而剧烈，飞出的飞镖，是我向你传达的思念。–狂暴之心</li><li>我醒来了，但是什么都不记得，我很害怕，我包裹住自己的身体，独自在黑暗中哭泣。–殇之木乃伊</li><li>为了内心的安宁。–众星之子</li><li>像节拍器一样准确无误。–琴瑟仙女</li><li>稳步前进！–刀锋意志</li><li>来次魔术戏法，咋样？–恶魔小丑</li><li>你的亲友们正在饱受折磨！–邪恶小法师</li><li>物是人非，可是我依然穿着嫁衣，在黑暗中寻找你的身影。–寡妇制造者</li><li>好极了！–猩红收割者</li><li>我不顾一切的冲出去，为你开辟一条安稳的路，我满腔热血的拍打着，为你抛开任何绊脚的石，最后，我坦然的微笑着用我的身体为你抵挡一切…因为我的身体上旋转着我们的誓言。–牛头酋长</li><li>你们跌倒了没？崩溃了么？–麦林炮手</li><li>胜利在望。–策士统领</li><li>攘除奸邪！–嘉文四世</li><li>我自人类诞生，却被人类抛弃，孤独的徘徊于世间，却与世间格格不入，于是我只能试图抓住每个遇到的生命，去倾诉那颗从不被理解的心。–蒸气机器人</li><li>为了父王！–嘉文四世</li><li>这局胜负已定。–嗜血猎手</li><li>漫天的冰雪冻结了我的心，但它冻结不了我心中的正义，我愿用我严寒的身躯冰冻这世间的邪恶。–冰晶凤凰</li><li>奉吾王之命！–德邦总管</li><li>我对你的爱就如闪电，狂暴而剧烈，飞出的飞镖是对你的思念。–狂暴之心</li><li>你必须跟着俺！–牛头酋长</li><li>开战吧！–蛮族之王</li><li>从我手中脱离的刀刃一直在飞舞，我不断在变强，只是为了守护我们的家园，等候你的归来。–刀锋意志</li><li>真正的意志是不会被击败的！–刀锋意志</li><li>我也希望变成蝴蝶的那一天，不再灰色，不再痛苦，不再让我丑陋的外表吓到美丽的你。–深渊巨口</li><li>我会在那儿的。–瘟疫之源</li><li>我可以想去哪里就去哪里，但是我只想去你心里。–祖安狂人</li><li>随心而动，随刃而行！–蛮族之王</li><li>我的目标很纯粹。–策士统领</li><li>我觉得我……变回人类了……–嗜血猎手</li><li>是的，只要998，就能让你爽到不能呼吸哟。–风暴女神</li><li>我们不知道何为怜悯，即使对象是你！–野兽之灵</li><li>你已经死了……只是你还没发觉而已。–暮光之眼</li><li>生存，就是折磨。–首领之傲</li><li>诺克萨斯人从来不会闲逛。–策士统领</li><li>哦好的，好的！–瘟疫之源</li><li>非常荣幸。–暮光之眼</li><li>有情况！–迅捷斥候</li><li>入体冰凉的月光，都比不上你绝情的目光。为了击碎你伪装的表面，我只能用尽全身力气挥出那惊鸿的半月弧光。——皎月女神</li><li>我束缚住了你的人，却束缚不住你的心。所以我只能远远跳离你身边，因为我知道，离你越近，我的心就会越痛。——皮城女警</li><li>沙漠中的太阳，是我对你爱的象征。——沙漠死神</li><li>在无人注视的角落，独自默默的弹奏。琴音带着我的思恋，妄图拉住你转身而去的袖角。——琴瑟仙女</li><li>我追逐的是你的背影，我跟随的是你的微笑。就算暴风雨到来，我依然能在你左右。——雷霆咆哮</li><li>默默的在背后望着你的背影，当你有危险时我会毫不犹豫的从天而降。哪怕双腿震得生疼，我依然会咬紧牙关再次跳向对手，抛出手中的战矛。哪怕是死，我也要保护你的安全。——战争之王</li><li>别看我的眼睛，里面只有愤怒和痛苦。我诅咒着一切，也诅咒着自己。——魔蛇之拥</li><li>金色的长驽陪伴我的一生，沾满鲜血的双手却磨灭不了心中的伤痛，我翻腾着身影在人群中闪烁，寻找一句最真心的问候。然后我悄悄的隐没、隐没，隐没在那孤寂的草丛……——暗夜猎手</li><li>行走于虚空，我彷徨，我迷茫。我不知何去何从，只有飘飘荡荡。——虚空行者</li><li>逝于晨，诞于暮。追寻着芳香的血液，环于世与墓之间。——猩红收割着</li><li>尘封千年，肉体早已湮灭，意识已然不清。探索了全部魔法的奥秘，只为能开辟虚空，寻找早已失去的你。——远古巫灵</li><li>你总说我太小，但是出现危险我都会跳跃到你身边，将危险推开。用手中的炮筒，守护我小小的爱。——麦林炮手</li><li>炙热的铁拳砸不开你面前的牢笼，不甘放弃的努力，只为了有一天能砸开牢笼见你一面。——皮城执法官</li></ol>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> Game </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 语录 </tag>
            
            <tag> LOL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见编程命名缩写</title>
      <link href="/%E6%89%8B%E5%86%8C/En/%E5%B8%B8%E8%A7%81%E5%91%BD%E5%90%8D%E7%BC%A9%E5%86%99/"/>
      <url>/%E6%89%8B%E5%86%8C/En/%E5%B8%B8%E8%A7%81%E5%91%BD%E5%90%8D%E7%BC%A9%E5%86%99/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>通用</th><th>缩写</th><th>翻译</th><th>控件</th><th>缩写</th><th>翻译</th></tr></thead><tbody><tr><td>address</td><td>addr</td><td>地址</td><td>calendar</td><td>cdr</td><td>日历</td></tr><tr><td>application</td><td>app</td><td>应用程序</td><td>messageDialog</td><td>msgdlg</td><td>消息框</td></tr><tr><td>asynchronization</td><td>asyn</td><td>异步</td><td>drawer</td><td>drw</td><td>抽屉</td></tr><tr><td>average</td><td>avg</td><td>平均数</td><td>buttonGroup</td><td>btngrp</td><td>按钮分组</td></tr><tr><td>bitmap</td><td>bmp</td><td>位图</td><td>checkBox</td><td>chk</td><td>复选框</td></tr><tr><td>buffer</td><td>buf</td><td>缓冲区</td><td>container</td><td>cntr</td><td>容器</td></tr><tr><td>character</td><td>char</td><td>字符</td><td>button</td><td>btn</td><td>按钮</td></tr><tr><td>color</td><td>clr</td><td>颜色</td><td>comboBox</td><td>cmb</td><td>下拉框</td></tr><tr><td>command</td><td>cmd</td><td>命令</td><td>lable</td><td>lbl</td><td>标签</td></tr><tr><td>delete</td><td>del</td><td>删除</td><td>progressBar</td><td>prg</td><td>进度条</td></tr><tr><td>destination</td><td>dest&#x2F;dst</td><td>目的地</td><td>pageIndicator</td><td>pgindic</td><td>Tab分页控件</td></tr><tr><td>decrease</td><td>dec</td><td>减少</td><td>radioButton</td><td>rdo</td><td>单选框</td></tr><tr><td>device</td><td>dev</td><td>设备</td><td>rangeSlider</td><td>rngsld</td><td>滑块</td></tr><tr><td>different</td><td>diff</td><td>不同的</td><td>scrollView</td><td>svw</td><td>视图滚动</td></tr><tr><td>directory</td><td>dir</td><td>目录</td><td>scrollBar</td><td>vsb(垂直)&#x2F;hsb(水平)</td><td>滚动条</td></tr><tr><td>document</td><td>doc</td><td>文档</td><td>slider</td><td>sld</td><td>滑动器</td></tr><tr><td>dynamic</td><td>dyna</td><td>动态的</td><td>spinBox</td><td>spn</td><td>旋转框</td></tr><tr><td>environment</td><td>env</td><td>环境</td><td>splitView</td><td>spltvw</td><td>分割视图</td></tr><tr><td>error</td><td>err</td><td>错误</td><td>stackView</td><td>stackvw</td><td>堆栈视图</td></tr><tr><td>execute</td><td>exec</td><td>执行</td><td>statusBar</td><td>statbr</td><td>状态条</td></tr><tr><td>group</td><td>grp</td><td>组</td><td>swipeView</td><td>swpvw</td><td>滑动控件</td></tr><tr><td>image</td><td>img</td><td>图像</td><td>switch</td><td>sw</td><td>开关</td></tr><tr><td>information</td><td>info</td><td>信息</td><td>tabBar</td><td>tbbr</td><td>tab栏</td></tr><tr><td>initialize</td><td>init</td><td>初始化</td><td>textField</td><td>txtfld</td><td>文本输入框</td></tr><tr><td>library</td><td>lib</td><td>库</td><td>toolBar</td><td>tlbr</td><td>工具栏</td></tr><tr><td>maximum</td><td>max</td><td>最大值</td><td>toolTip</td><td>tltp</td><td>提示框</td></tr><tr><td>minimum</td><td>min</td><td>最小值</td><td>toolButton</td><td>tlbtn</td><td>工具按钮</td></tr><tr><td>message</td><td>msg</td><td>消息</td><td>treeView</td><td>trvw</td><td>树形视图</td></tr><tr><td>number</td><td>num</td><td>数字，数，数量</td><td>layout</td><td>lyt</td><td>布局</td></tr><tr><td>object</td><td>obj</td><td>对象</td><td>mainMenu</td><td>mmnu</td><td>菜单栏</td></tr><tr><td>parameter</td><td>Param</td><td>参数(形参)</td><td>groupBox</td><td>gbx</td><td>组合框</td></tr><tr><td>package</td><td>pkg</td><td>打包</td><td>pictureBox</td><td>pic</td><td>图片框</td></tr><tr><td>position</td><td>pos</td><td>位置</td><td>listView</td><td>lvw</td><td>列表视图</td></tr><tr><td>previous</td><td>pre</td><td>前一个</td><td>window</td><td>win(wnd)</td><td>窗口</td></tr><tr><td>process&#x2F;Procedure</td><td>proc</td><td>进程&#x2F;过程</td><td>form</td><td>frm</td><td>表单</td></tr><tr><td>pointer</td><td>ptr</td><td>指针</td><td>textBox</td><td>txt</td><td>文本框</td></tr><tr><td>password</td><td>pwd</td><td>密码</td><td>linkLabel</td><td>llbl</td><td>超链接标签框</td></tr><tr><td>public</td><td>pub</td><td>公共的</td><td>dialog</td><td>dlg</td><td>对话框</td></tr><tr><td>reference</td><td>ref</td><td>引用</td><td>scrollIndicator</td><td>scrlindic</td><td>滚动指示器</td></tr><tr><td>source</td><td>src</td><td>源</td><td></td><td></td><td></td></tr><tr><td>string</td><td>str</td><td>字符串</td><td></td><td></td><td></td></tr><tr><td>summation</td><td>sum</td><td>和</td><td></td><td></td><td></td></tr><tr><td>synchronization</td><td>sync</td><td>同步</td><td></td><td></td><td></td></tr><tr><td>system</td><td>sys</td><td>系统</td><td></td><td></td><td></td></tr><tr><td>table</td><td>tbl</td><td>表格</td><td></td><td></td><td></td></tr><tr><td>temporary</td><td>tmp</td><td>临时</td><td></td><td></td><td></td></tr><tr><td>text</td><td>txt</td><td>文本</td><td></td><td></td><td></td></tr><tr><td>variable</td><td>var</td><td>变量</td><td></td><td></td><td></td></tr><tr><td>addition</td><td>add</td><td>加法&#x2F;添加</td><td></td><td></td><td></td></tr><tr><td>argument</td><td>arg</td><td>实参</td><td></td><td></td><td></td></tr><tr><td>array</td><td>arr</td><td>数组</td><td></td><td></td><td></td></tr><tr><td>calculate</td><td>calc</td><td>计算</td><td></td><td></td><td></td></tr><tr><td>configuration</td><td>config</td><td>配置</td><td></td><td></td><td></td></tr><tr><td>column</td><td>col</td><td>列</td><td></td><td></td><td></td></tr><tr><td>control</td><td>ctrl</td><td>控制</td><td></td><td></td><td></td></tr><tr><td>hexadecimal</td><td>hex</td><td>十六进制</td><td></td><td></td><td></td></tr><tr><td>original</td><td>orig</td><td>原件</td><td></td><td></td><td></td></tr><tr><td>return</td><td>rtn</td><td>返回</td><td></td><td></td><td></td></tr><tr><td>repeat</td><td>rpt</td><td>重复</td><td></td><td></td><td></td></tr><tr><td>signal</td><td>sig</td><td>信号</td><td></td><td></td><td></td></tr><tr><td>status</td><td>stat</td><td>状态</td><td></td><td></td><td></td></tr><tr><td>stack</td><td>stk</td><td>栈区</td><td></td><td></td><td></td></tr><tr><td>standard</td><td>std</td><td>标准</td><td></td><td></td><td></td></tr><tr><td>trigger</td><td>trig</td><td>触发</td><td></td><td></td><td></td></tr><tr><td>background</td><td>bg</td><td>背景</td><td></td><td></td><td></td></tr><tr><td>escape</td><td>esc</td><td>退出</td><td></td><td></td><td></td></tr><tr><td>user</td><td>usr</td><td>用户</td><td></td><td></td><td></td></tr><tr><td>list</td><td>lst</td><td>列表</td><td></td><td></td><td></td></tr><tr><td>server</td><td>srv</td><td>服务</td><td></td><td></td><td></td></tr><tr><td>manager</td><td>mgr</td><td>管理者</td><td></td><td></td><td></td></tr><tr><td>insert</td><td>ins</td><td>插入</td><td></td><td></td><td></td></tr><tr><td>point</td><td>pt</td><td>点</td><td></td><td></td><td></td></tr><tr><td>function</td><td>func</td><td>函数</td><td></td><td></td><td></td></tr><tr><td>back</td><td>bk</td><td>返回</td><td></td><td></td><td></td></tr><tr><td>break</td><td>brk</td><td>间断</td><td></td><td></td><td></td></tr><tr><td>date</td><td>dat</td><td>日期</td><td></td><td></td><td></td></tr><tr><td>edit</td><td>edt</td><td>编辑</td><td></td><td></td><td></td></tr><tr><td>flag</td><td>flg</td><td>标志</td><td></td><td></td><td></td></tr><tr><td>grid</td><td>grd</td><td>网格</td><td></td><td></td><td></td></tr><tr><td>increment</td><td>inc</td><td>增量</td><td></td><td></td><td></td></tr><tr><td>length</td><td>len</td><td>长度</td><td></td><td></td><td></td></tr><tr><td>oracle</td><td>ora</td><td>甲骨文数据库</td><td></td><td></td><td></td></tr><tr><td>panorama</td><td>pano</td><td>全景</td><td></td><td></td><td></td></tr><tr><td>print</td><td>prn</td><td>打印</td><td></td><td></td><td></td></tr><tr><td>program</td><td>prg</td><td>程序</td><td></td><td></td><td></td></tr><tr><td>statistic</td><td>stat</td><td>统计</td><td></td><td></td><td></td></tr><tr><td>administrator</td><td>adm</td><td>管理员</td><td></td><td></td><td></td></tr><tr><td>database</td><td>db</td><td>数据库</td><td></td><td></td><td></td></tr><tr><td>change</td><td>chg</td><td>改变</td><td></td><td></td><td></td></tr><tr><td>click</td><td>clk</td><td>点击</td><td></td><td></td><td></td></tr><tr><td>compare</td><td>cmp</td><td>比较</td><td></td><td></td><td></td></tr><tr><td>coordinates</td><td>coord</td><td>坐标</td><td></td><td></td><td></td></tr><tr><td>copy</td><td>cpy</td><td>复制</td><td></td><td></td><td></td></tr><tr><td>current</td><td>cur</td><td>当前的</td><td></td><td></td><td></td></tr><tr><td>dictionary</td><td>dict</td><td>字典</td><td></td><td></td><td></td></tr><tr><td>display</td><td>disp</td><td>显示</td><td></td><td></td><td></td></tr><tr><td>driver</td><td>drv</td><td>驱动</td><td></td><td></td><td></td></tr><tr><td>extend</td><td>ex&#x2F;ext</td><td>扩展</td><td></td><td></td><td></td></tr><tr><td>frame</td><td>frm</td><td>框架&#x2F;帧</td><td></td><td></td><td></td></tr><tr><td>index</td><td>idx&#x2F;ndx</td><td>索引</td><td></td><td></td><td></td></tr><tr><td>horizontal</td><td>horz</td><td>水平</td><td></td><td></td><td></td></tr><tr><td>instance</td><td>ins</td><td>实例</td><td></td><td></td><td></td></tr><tr><td>increase</td><td>inc</td><td>增加</td><td></td><td></td><td></td></tr><tr><td>link</td><td>lnk</td><td>链接</td><td></td><td></td><td></td></tr><tr><td>middle</td><td>mid</td><td>中间</td><td></td><td></td><td></td></tr><tr><td>multiply</td><td>mul</td><td>乘</td><td></td><td></td><td></td></tr><tr><td>resource</td><td>res</td><td>资源</td><td></td><td></td><td></td></tr><tr><td>select</td><td>sel</td><td>选择</td><td></td><td></td><td></td></tr><tr><td>test</td><td>tst</td><td>测试</td><td></td><td></td><td></td></tr><tr><td>vertical</td><td>vert</td><td>垂直</td><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>英文术语</th><th>描述</th></tr></thead><tbody><tr><td>abstract</td><td>抽象的</td></tr><tr><td>abstraction</td><td>抽象性</td></tr><tr><td>access</td><td>访问</td></tr><tr><td>access level</td><td>访问级别</td></tr><tr><td>access function</td><td>访问函数</td></tr><tr><td>adapter</td><td>适配器</td></tr><tr><td>address</td><td>地址</td></tr><tr><td>address-of operator</td><td>取地址操作符</td></tr><tr><td>aggregation</td><td>聚合</td></tr><tr><td>algorithm</td><td>算法</td></tr><tr><td>allocate</td><td>分配</td></tr><tr><td>allocator</td><td>分配器</td></tr><tr><td>application</td><td>应用程序</td></tr><tr><td>architecture</td><td>体系结构</td></tr><tr><td>argument</td><td>实参</td></tr><tr><td>array</td><td>数组</td></tr><tr><td>arrow operator</td><td>箭头操作符</td></tr><tr><td>assembly language</td><td>汇编语言</td></tr><tr><td>assert(-ion)</td><td>断言</td></tr><tr><td>assign(-ment)</td><td>赋值</td></tr><tr><td>assignment operator</td><td>赋值操作符</td></tr><tr><td>base class</td><td>基类</td></tr><tr><td>base type</td><td>基类型</td></tr><tr><td>binary search</td><td>二分查找</td></tr><tr><td>binary tree</td><td>二叉树</td></tr><tr><td>binary operator</td><td>二元操作符</td></tr><tr><td>binding</td><td>绑定</td></tr><tr><td>bit</td><td>位</td></tr><tr><td>bitwise</td><td>以 bit 为单元逐一……</td></tr><tr><td>block</td><td>区块</td></tr><tr><td>boolean</td><td>布尔值</td></tr><tr><td>breakpoint</td><td>断点</td></tr><tr><td>build</td><td>构建</td></tr><tr><td>build-in</td><td>内置</td></tr><tr><td>bus</td><td>总线</td></tr><tr><td>byte</td><td>字节</td></tr><tr><td>cache</td><td>高速缓存（区）</td></tr><tr><td>call</td><td>调用</td></tr><tr><td>callback</td><td>回调</td></tr><tr><td>call operator</td><td>call 操作符</td></tr><tr><td>character</td><td>字符</td></tr><tr><td>child class</td><td>子类</td></tr><tr><td>class</td><td>类</td></tr><tr><td>class template</td><td>类模板</td></tr><tr><td>client</td><td>客户（端）</td></tr><tr><td>code</td><td>代码</td></tr><tr><td>compatible</td><td>兼容</td></tr><tr><td>compiler time</td><td>编译期</td></tr><tr><td>compiler</td><td>编译器</td></tr><tr><td>component</td><td>组件</td></tr><tr><td>composition</td><td>复合</td></tr><tr><td>concrete</td><td>具象的</td></tr><tr><td>concurrent</td><td>并发</td></tr><tr><td>configuration</td><td>配置</td></tr><tr><td>connection</td><td>连接</td></tr><tr><td>constraint</td><td>约束（条件）</td></tr><tr><td>construct</td><td>构件</td></tr><tr><td>container</td><td>容器</td></tr><tr><td>const</td><td>C++ 关键字，constant 的缩写</td></tr><tr><td>constant</td><td>常量</td></tr><tr><td>constructor</td><td>构造函数</td></tr><tr><td>copy</td><td>拷贝（动词&#x2F;名词），副本（名词）</td></tr><tr><td>create</td><td>创建</td></tr><tr><td>custom</td><td>定制</td></tr><tr><td>data</td><td>数据</td></tr><tr><td>database</td><td>数据库</td></tr><tr><td>data member</td><td>数据成员（变量）</td></tr><tr><td>data structure</td><td>数据结构</td></tr><tr><td>debug</td><td>调试</td></tr><tr><td>debugger</td><td>调试器</td></tr><tr><td>declaration</td><td>声明式</td></tr><tr><td>default</td><td>缺省（默认）</td></tr><tr><td>definition</td><td>定义式</td></tr><tr><td>delegate</td><td>委托</td></tr><tr><td>dereference</td><td>提领（解参考）</td></tr><tr><td>derived class</td><td>派生类</td></tr><tr><td>design pattern</td><td>设计模式</td></tr><tr><td>destroy</td><td>销毁</td></tr><tr><td>destructor</td><td>析构函数</td></tr><tr><td>directive</td><td>指示符</td></tr><tr><td>document</td><td>文档</td></tr><tr><td>dynamic binding</td><td>动态绑定</td></tr><tr><td>entity</td><td>物体</td></tr><tr><td>encapsulation</td><td>封装</td></tr><tr><td>enum(-eration)</td><td>枚举</td></tr><tr><td>equality</td><td>相等</td></tr><tr><td>equivalence</td><td>等价</td></tr><tr><td>evaluate</td><td>核定、核算</td></tr><tr><td>exception</td><td>异常</td></tr><tr><td>explicit</td><td>显式</td></tr><tr><td>expression</td><td>表达式</td></tr><tr><td>file</td><td>文件</td></tr><tr><td>framework</td><td>框架</td></tr><tr><td>full specialization</td><td>全特化</td></tr><tr><td>function</td><td>函数</td></tr><tr><td>function object</td><td>函数对象</td></tr><tr><td>function template</td><td>函数模板</td></tr><tr><td>generic</td><td>泛型、泛化、一般化</td></tr><tr><td>getter</td><td>取值函数</td></tr><tr><td>global</td><td>全局的</td></tr><tr><td>handle</td><td>句柄</td></tr><tr><td>handler</td><td>处理函数</td></tr><tr><td>hash table</td><td>哈希表、散列表</td></tr><tr><td>header(file)</td><td>头文件</td></tr><tr><td>heap</td><td>堆</td></tr><tr><td>hierarchy</td><td>继承体系</td></tr><tr><td>identifier</td><td>标识符</td></tr><tr><td>implement(-ation)</td><td>实现</td></tr><tr><td>implicit</td><td>隐喻的、暗自的、隐式</td></tr><tr><td>information</td><td>信息</td></tr><tr><td>inheritance</td><td>继承</td></tr><tr><td>inline</td><td>内联</td></tr><tr><td>initialization list</td><td>初始化列表</td></tr><tr><td>initialize</td><td>初始化</td></tr><tr><td>instance</td><td>实体</td></tr><tr><td>instantiate</td><td>实体化</td></tr><tr><td>interface</td><td>接口</td></tr><tr><td>Internet</td><td>互联网</td></tr><tr><td>interpreter</td><td>解释器</td></tr><tr><td>invariants</td><td>恒常性</td></tr><tr><td>invoke</td><td>调用</td></tr><tr><td>iterator</td><td>迭代器</td></tr><tr><td>library</td><td>程序库</td></tr><tr><td>linker</td><td>连接器</td></tr><tr><td>literal</td><td>字面常量</td></tr><tr><td>list</td><td>链表</td></tr><tr><td>load</td><td>装载</td></tr><tr><td>local</td><td>局部的</td></tr><tr><td>lock</td><td>机锁</td></tr><tr><td>loop</td><td>循环</td></tr><tr><td>lvalue</td><td>左值</td></tr><tr><td>macro</td><td>宏</td></tr><tr><td>member</td><td>成员</td></tr><tr><td>member function</td><td>成员函数</td></tr><tr><td>memory</td><td>内存</td></tr><tr><td>memory leak</td><td>内存泄漏</td></tr><tr><td>meta</td><td>元</td></tr><tr><td>meta-programming</td><td>元编程</td></tr><tr><td>modeling</td><td>塑膜</td></tr><tr><td>module</td><td>模块</td></tr><tr><td>modifier</td><td>修饰符</td></tr><tr><td>multi-tasking</td><td>多任务</td></tr><tr><td>namespace</td><td>命名空间</td></tr><tr><td>native</td><td>固有的</td></tr><tr><td>nested</td><td>嵌套的</td></tr><tr><td>object</td><td>对象</td></tr><tr><td>object based</td><td>基于对象的</td></tr><tr><td>object model</td><td>对象模型</td></tr><tr><td>object oriented</td><td>面对对象</td></tr><tr><td>operand</td><td>操作数</td></tr><tr><td>operating system</td><td>操作系统</td></tr><tr><td>operator</td><td>操作符</td></tr><tr><td>overflow</td><td>溢出</td></tr><tr><td>overhead</td><td>额外开销</td></tr><tr><td>overload</td><td>重载</td></tr><tr><td>override</td><td>覆写</td></tr><tr><td>package</td><td>包</td></tr><tr><td>parallel</td><td>并行</td></tr><tr><td>parameter</td><td>参数、形参</td></tr><tr><td>parent class</td><td>父类</td></tr><tr><td>parse</td><td>解析</td></tr><tr><td>partial specialization</td><td>偏特化</td></tr><tr><td>pass by reference</td><td>按址传递</td></tr><tr><td>pass by value</td><td>按值传递</td></tr><tr><td>pattern</td><td>模式</td></tr><tr><td>placement delete</td><td>（某种特殊形式的 delete operatoe）</td></tr><tr><td>placement new</td><td>（某种特殊形式的 new operatoe）</td></tr><tr><td>pointer</td><td>指针</td></tr><tr><td>polymorphism</td><td>多态</td></tr><tr><td>preprocessor</td><td>预处理器</td></tr><tr><td>print</td><td>打印</td></tr><tr><td>printer</td><td>打印机</td></tr><tr><td>process</td><td>进程</td></tr><tr><td>program</td><td>程序</td></tr><tr><td>programer</td><td>程序员</td></tr><tr><td>programming</td><td>编程</td></tr><tr><td>project</td><td>项目</td></tr><tr><td>pseudo code</td><td>伪代码</td></tr><tr><td>quality</td><td>质量</td></tr><tr><td>queue</td><td>队列</td></tr><tr><td>raw</td><td>原始的、未经处理的</td></tr><tr><td>recursive</td><td>递归</td></tr><tr><td>refer to</td><td>指向、指称</td></tr><tr><td>reference</td><td>引用</td></tr><tr><td>regular expression</td><td>正则表达式</td></tr><tr><td>resolve</td><td>解析</td></tr><tr><td>return</td><td>返回</td></tr><tr><td>return type</td><td>返回类型</td></tr><tr><td>return value</td><td>返回值</td></tr><tr><td>runtime</td><td>运行期</td></tr><tr><td>rvalue</td><td>右值</td></tr><tr><td>save</td><td>保存</td></tr><tr><td>schedule</td><td>调度</td></tr><tr><td>scheduler</td><td>调度器</td></tr><tr><td>scope</td><td>作用域</td></tr><tr><td>search</td><td>查找</td></tr><tr><td>semantics</td><td>语义</td></tr><tr><td>setter</td><td>设值函数</td></tr><tr><td>signature</td><td>签名</td></tr><tr><td>smart pointer</td><td>智能指针</td></tr><tr><td>specialization</td><td>特化</td></tr><tr><td>source</td><td>源码</td></tr><tr><td>stack</td><td>栈</td></tr><tr><td>standard library</td><td>标准程序库</td></tr><tr><td>statement</td><td>语句</td></tr><tr><td>static</td><td>静态的</td></tr><tr><td>string</td><td>字符串</td></tr><tr><td>subtype</td><td>子类型</td></tr><tr><td>support</td><td>支持</td></tr><tr><td>template</td><td>模板</td></tr><tr><td>temporary object</td><td>临时对象</td></tr><tr><td>text</td><td>文本</td></tr><tr><td>thread</td><td>线程</td></tr><tr><td>thread safe</td><td>多线程安全</td></tr><tr><td>throw</td><td>抛出</td></tr><tr><td>token</td><td>语汇单元</td></tr><tr><td>type</td><td>类型</td></tr><tr><td>unary function</td><td>单参函数</td></tr><tr><td>underflow</td><td>下溢</td></tr><tr><td>unqualified</td><td>未经资格修饰</td></tr><tr><td>user</td><td>用户</td></tr><tr><td>user interface</td><td>用户界面</td></tr><tr><td>value</td><td>值</td></tr><tr><td>variable</td><td>变量</td></tr><tr><td>vector</td><td>矢量</td></tr><tr><td>virtual function</td><td>虚拟函数</td></tr><tr><td>virtual machine</td><td>虚拟机</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> En </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 速查 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《深入理解Windows操作系统》一书附录中英语单词整理</title>
      <link href="/%E6%89%8B%E5%86%8C/En/CodeEn_from_Windows/"/>
      <url>/%E6%89%8B%E5%86%8C/En/CodeEn_from_Windows/</url>
      
        <content type="html"><![CDATA[<blockquote><p>摘自《深入理解Windows操作系统》附录章节的英语对照。</p></blockquote><h1 id="《深入理解Windows操作系统》术语对照表"><a href="#《深入理解Windows操作系统》术语对照表" class="headerlink" title="《深入理解Windows操作系统》术语对照表"></a>《深入理解Windows操作系统》术语对照表</h1><table><thead><tr><th>英文</th><th>对照</th></tr></thead><tbody><tr><td>access token</td><td>访问令牌</td></tr><tr><td>access validation</td><td>访问验证</td></tr><tr><td>access-control entry，ACE</td><td>访问控制项</td></tr><tr><td>access-control list，ACL</td><td>访间控制列表</td></tr><tr><td>Active Directory</td><td>活动目录</td></tr><tr><td>Address Windowing Extension，AWE</td><td>地址窗口 context switch 环境切换扩展</td></tr><tr><td>affinity</td><td>亲和性</td></tr><tr><td>alert</td><td>警醒</td></tr><tr><td>assertion</td><td>断言</td></tr><tr><td>asymmetric multiprocessing，ASMP</td><td>非对称多处理</td></tr><tr><td>asynchronous procedure call，APC</td><td>异步过程调用</td></tr><tr><td>attach</td><td>附载</td></tr><tr><td>authentication</td><td>认证</td></tr><tr><td>balance set manager</td><td>平衡集管理器</td></tr><tr><td>bin</td><td>巢箱</td></tr><tr><td>bind， binding</td><td>绑定</td></tr><tr><td>blue screen</td><td>蓝屏</td></tr><tr><td>boost</td><td>提升</td></tr><tr><td>boot</td><td>引导</td></tr><tr><td>boot partition</td><td>引导分区</td></tr><tr><td>boot sector</td><td>引导扇区</td></tr><tr><td>boot volume</td><td>引导卷</td></tr><tr><td>bucket</td><td>桶</td></tr><tr><td>bug check</td><td>错误检查</td></tr><tr><td>bus driver</td><td>总线型驱动程序</td></tr><tr><td>cable</td><td>线缆</td></tr><tr><td>cache manager</td><td>缓存管理器</td></tr><tr><td>cache miss</td><td>缓存未命中</td></tr><tr><td>Careful Write file system</td><td>谨慎写文件系统</td></tr><tr><td>catalog file</td><td>编目文件</td></tr><tr><td>cel</td><td>巢室</td></tr><tr><td>change journal</td><td>变化日志</td></tr><tr><td>class driver</td><td>类驱动程序</td></tr><tr><td>cluster</td><td>簇（用于磁盘存储单元），集群</td></tr><tr><td>COM</td><td>组件对象模型</td></tr><tr><td>committed memory</td><td>提交的内存</td></tr><tr><td>Common Internet File System， CIFS Internet</td><td>文件系统</td></tr><tr><td>compatibility</td><td>兼容性</td></tr><tr><td>concurrency</td><td>并发性</td></tr><tr><td>context</td><td>环境</td></tr><tr><td>copy-on-write</td><td>写时复制</td></tr><tr><td>crash analysis</td><td>崩溃分析</td></tr><tr><td>crash dump</td><td>崩溃转储</td></tr><tr><td>credential</td><td>凭证</td></tr><tr><td>critical section</td><td>临界区</td></tr><tr><td>cryptographic service provider，CSP</td><td>密码服务提供者</td></tr><tr><td>cyclic redundancy checksum， CRC</td><td>循环冗余检验和</td></tr><tr><td>DCOM</td><td>分布式组件对象模型</td></tr><tr><td>deadlock</td><td>死锁</td></tr><tr><td>debugger</td><td>调试器</td></tr><tr><td>deferred procedure call，DPC</td><td>延迟过程调用</td></tr><tr><td>defragmenter</td><td>碎片整理器</td></tr><tr><td>deliver</td><td>交付（针对APC&amp;DPC）</td></tr><tr><td>dependency</td><td>相依性</td></tr><tr><td>desktop</td><td>桌面</td></tr><tr><td>device driver</td><td>设备驱动程序</td></tr><tr><td>Device Enumeration</td><td>设备列举</td></tr><tr><td>Discretionary access control，DAC</td><td>自主访问控制</td></tr><tr><td>disk spanning</td><td>磁盘跨展</td></tr><tr><td>dismount</td><td>卸载</td></tr><tr><td>dispatcher</td><td>分发器</td></tr><tr><td>dispatching</td><td>分发</td></tr><tr><td>Distributed File System，DFS</td><td>分布式文件系统</td></tr><tr><td>docking station</td><td>插接站</td></tr><tr><td>double-freeing</td><td>两次释放</td></tr><tr><td>drive letter</td><td>驱动器字母</td></tr><tr><td>Driver Verifier</td><td>驱动程序检验器</td></tr><tr><td>dynamic link library，DLL</td><td>动态链接库</td></tr><tr><td>Encrypting File System， EFS</td><td>加密文件系统</td></tr><tr><td>environment subsystem</td><td>环境子系统</td></tr><tr><td>ETW， Event Tracing for Windows Windows</td><td>事件跟踪</td></tr><tr><td>event</td><td>事件</td></tr><tr><td>Event Log</td><td>事件日志</td></tr><tr><td>exception</td><td>异常</td></tr><tr><td>exception dispatching</td><td>异常分发</td></tr><tr><td>exception frame</td><td>异常帧</td></tr><tr><td>exception handler</td><td>异常处理器</td></tr><tr><td>exception handling</td><td>异常处理</td></tr><tr><td>executive</td><td>执行体</td></tr><tr><td>executive object</td><td>执行体对象</td></tr><tr><td>extended partition</td><td>扩展分区</td></tr><tr><td>extensibility</td><td>扩展性</td></tr><tr><td>Extensible Firmware Interface，EFI</td><td>可扩展的固件接口</td></tr><tr><td>fast mutex</td><td>快速互斥体</td></tr><tr><td>fault tolerance</td><td>容错</td></tr><tr><td>fiber</td><td>纤程</td></tr><tr><td>fibre channel</td><td>光纤通道</td></tr><tr><td>file allocation table</td><td>文件分配表</td></tr><tr><td>file encryption key，FEK</td><td>文件加密密钥</td></tr><tr><td>file mapping object</td><td>文件映射对象</td></tr><tr><td>file system driver， FSD</td><td>文件系统驱动程序</td></tr><tr><td>file system recognizer</td><td>文件系统识别器</td></tr><tr><td>filter driver</td><td>过滤型驱动程序</td></tr><tr><td>firmware</td><td>固件</td></tr><tr><td>footprint</td><td>印迹</td></tr><tr><td>free list</td><td>空闲（页面）列表</td></tr><tr><td>function driver</td><td>功能型驱动程序</td></tr><tr><td>GINA</td><td>图形化标识和认证</td></tr><tr><td>Group Policy</td><td>组策略</td></tr><tr><td>guard page</td><td>守护页面</td></tr><tr><td>GUID</td><td>全局唯一标识符</td></tr><tr><td>GUID Partition Table，GPT GUID</td><td>分区表</td></tr><tr><td>handle</td><td>句柄</td></tr><tr><td>handle table</td><td>句柄表</td></tr><tr><td>handler</td><td>处理器</td></tr><tr><td>hardware abstraction layer</td><td>硬件抽象层（HAL）</td></tr><tr><td>heap manager</td><td>堆管理器</td></tr><tr><td>hive</td><td>储巢</td></tr><tr><td>hotfix</td><td>热补丁</td></tr><tr><td>Hyper-Threading</td><td>超线程</td></tr><tr><td>I&#x2F;O request packet，IRP I&#x2F;O</td><td>请求包</td></tr><tr><td>idle process</td><td>空闲进程</td></tr><tr><td>idle thread</td><td>空闲线程</td></tr><tr><td>impersonation</td><td>模仿</td></tr><tr><td>inter-processor interrupt，IPI</td><td>处理器间的中断</td></tr><tr><td>interrupt controller</td><td>中断控制器</td></tr><tr><td>interrupt dispatch table</td><td>中断分发表</td></tr><tr><td>interrupt handler</td><td>中断处理器</td></tr><tr><td>interrupt request level，IRQL</td><td>中断请求级别</td></tr><tr><td>Interrupt service routine，ISR</td><td>中断服务例程</td></tr><tr><td>interupt</td><td>中断</td></tr><tr><td>job</td><td>作业</td></tr><tr><td>junction</td><td>交接</td></tr><tr><td>kernel</td><td>内核</td></tr><tr><td>kernel mode</td><td>内核模式</td></tr><tr><td>kernel object</td><td>内核对象</td></tr><tr><td>key ring</td><td>密钥环</td></tr><tr><td>keystroke</td><td>键击</td></tr><tr><td>last known good，LKG</td><td>最后已知的好配置，最后已知的好控制集</td></tr><tr><td>lazy write file system</td><td>延迟写文件系统</td></tr><tr><td>lazy writer</td><td>延迟写出器</td></tr><tr><td>Lightweight Directory Acess Protocol, LDAP</td><td>轻量的目录访问协议</td></tr><tr><td>local procedure call，LPC</td><td>本地过程调用</td></tr><tr><td>local security authentication</td><td>本地安全认证</td></tr><tr><td>lock convoy</td><td>锁封护</td></tr><tr><td>loCompletion I&#x2F;O</td><td>完成</td></tr><tr><td>logical cluster number.LCN</td><td>逻辑簇号</td></tr><tr><td>Logical Disk Manager.LDM</td><td>逻辑磁盘管理器</td></tr><tr><td>logical prefetcher</td><td>逻辑预取器</td></tr><tr><td>logical sequence number，LSN</td><td>逻辑序列号</td></tr><tr><td>logon</td><td>登录</td></tr><tr><td>look-aside list</td><td>预读列表</td></tr><tr><td>Low Fragmentation Heap，LFH</td><td>低碎片堆</td></tr><tr><td>LUID</td><td>本地唯一标识符</td></tr><tr><td>mailslot</td><td>邮件槽</td></tr><tr><td>managed code</td><td>托管代码</td></tr><tr><td>manifest</td><td>清单</td></tr><tr><td>mapped file</td><td>映射的文件</td></tr><tr><td>master boot record.MBR</td><td>主引导记录</td></tr><tr><td>master file table</td><td>主文件表</td></tr><tr><td>mechanism</td><td>机制</td></tr><tr><td>memory</td><td>内存</td></tr><tr><td>memory descriptor list.MDL</td><td>内存描述符列表</td></tr><tr><td>memory mapped file</td><td>内存映射文件</td></tr><tr><td>metadata</td><td>元数据</td></tr><tr><td>microkernel</td><td>微内核</td></tr><tr><td>minidump</td><td>小转储</td></tr><tr><td>miniport</td><td>小端口</td></tr><tr><td>miniport driver</td><td>小端口驱动程序</td></tr><tr><td>mirrored volume</td><td>镜像卷</td></tr><tr><td>MMC snap-in MMC</td><td>加载件</td></tr><tr><td>modified page writer</td><td>已修改页面写出器</td></tr><tr><td>mount</td><td>挂载</td></tr><tr><td>mount point</td><td>挂载点</td></tr><tr><td>multimaster replication</td><td>多主复制</td></tr><tr><td>Multiple Provider Router</td><td>多提供者转发器</td></tr><tr><td>Multiple UNC Provider，MUP</td><td>多UNC提供者</td></tr><tr><td>multiprocessing</td><td>多处理</td></tr><tr><td>multitasking</td><td>多任务</td></tr><tr><td>mutant</td><td>突变体</td></tr><tr><td>mutex</td><td>互斥体</td></tr><tr><td>named pipe</td><td>命名管道</td></tr><tr><td>native</td><td>原生的</td></tr><tr><td>network address translation.NAT</td><td>网络地址转译</td></tr><tr><td>Network Driver Interface Specification, NDIS</td><td>网络驱动程序接口规范</td></tr><tr><td>Network Monitor</td><td>网络监视器</td></tr><tr><td>network share</td><td>网络共享体</td></tr><tr><td>NTFS object atribute NTFS</td><td>对象属性</td></tr><tr><td>NUMA（non-uniform memory architecture）</td><td>非一致的内存结构</td></tr><tr><td>objcct manager</td><td>对象管理器</td></tr><tr><td>object linking and embedding. OLE</td><td>对象链接和嵌入</td></tr><tr><td>ommit</td><td>提交</td></tr><tr><td>on-disk structure</td><td>磁盘上的结构</td></tr><tr><td>Open System Interconnection， OSI</td><td>开放系统互联</td></tr><tr><td>opportunistic locking，oplock</td><td>机会锁</td></tr><tr><td>overlapped</td><td>可重叠的</td></tr><tr><td>page</td><td>页面</td></tr><tr><td>page directory</td><td>页目录</td></tr><tr><td>page directory entry，PDE</td><td>页目录项</td></tr><tr><td>page fault</td><td>页面错误</td></tr><tr><td>page file，paging file</td><td>页面文件</td></tr><tr><td>page frame number，PFN</td><td>页面帧编号</td></tr><tr><td>page table</td><td>页表</td></tr><tr><td>page table entry，PTE</td><td>页表项</td></tr><tr><td>pageable</td><td>换页的</td></tr><tr><td>paged pool， nonpaged pool</td><td>换页内存池，非换页内存池</td></tr><tr><td>pager</td><td>换页器</td></tr><tr><td>parition</td><td>分区</td></tr><tr><td>partition table</td><td>分区表</td></tr><tr><td>payload</td><td>有效载荷</td></tr><tr><td>Performance Monitor</td><td>性能监视器</td></tr><tr><td>Performance tool</td><td>性能工具</td></tr><tr><td>Physical Address Extension，PAE</td><td>物理地址扩展</td></tr><tr><td>placement policy</td><td>放置策略</td></tr><tr><td>plug and play</td><td>即插即用</td></tr><tr><td>pool tracking</td><td>内存池跟踪</td></tr><tr><td>port driver</td><td>端口驱动程序</td></tr><tr><td>portability</td><td>可移植性</td></tr><tr><td>preempt</td><td>抢占</td></tr><tr><td>preemptive</td><td>抢先式</td></tr><tr><td>prefetcher</td><td>预取器</td></tr><tr><td>principal</td><td>安全个体</td></tr><tr><td>priority boost</td><td>优先级提升</td></tr><tr><td>priority inversion</td><td>优先级倒置</td></tr><tr><td>privilege</td><td>特权</td></tr><tr><td>procedure</td><td>过程</td></tr><tr><td>process</td><td>进程</td></tr><tr><td>Process environment block，PEB</td><td>进程环境块</td></tr><tr><td>process explorer</td><td>进程管理器（视上下文</td></tr><tr><td>process manager</td><td>进程管理器（视上下文</td></tr><tr><td>processor</td><td>处理器</td></tr><tr><td>profile</td><td>轮廓，性能剖析</td></tr><tr><td>prototype page table entry，prototype PTE</td><td>原型页表项</td></tr><tr><td>push lock</td><td>推锁</td></tr><tr><td>quality of service，QOS</td><td>服务质量</td></tr><tr><td>quantum</td><td>时限</td></tr><tr><td>quantum boosting</td><td>时限增大</td></tr><tr><td>queue</td><td>队列</td></tr><tr><td>quota</td><td>配额</td></tr><tr><td>quota charges</td><td>配额花费</td></tr><tr><td>RAM Optimizer RAM</td><td>优化器</td></tr><tr><td>read-ahead</td><td>预读</td></tr><tr><td>record</td><td>记录</td></tr><tr><td>recoverability</td><td>可恢复性</td></tr><tr><td>Recovery Console</td><td>恢复控制台</td></tr><tr><td>redirector</td><td>重定向器</td></tr><tr><td>redo</td><td>重做</td></tr><tr><td>reference count</td><td>引用计数</td></tr><tr><td>reference monitor</td><td>引用监视器</td></tr><tr><td>registry</td><td>注册表</td></tr><tr><td>registry key</td><td>注册表键</td></tr><tr><td>registry value</td><td>注册表值</td></tr><tr><td>reliability</td><td>可靠性</td></tr><tr><td>Remote Direct Memory Access， RDMA</td><td>远程直接内存访问</td></tr><tr><td>Remote NDIS</td><td>外接NDIS</td></tr><tr><td>remote procedure call，RPC</td><td>远过程调用</td></tr><tr><td>reparse</td><td>重解析</td></tr><tr><td>reparse point</td><td>重解析点</td></tr><tr><td>reserved memory</td><td>保留的内存</td></tr><tr><td>resource accounting</td><td>资源记账</td></tr><tr><td>resource gate</td><td>资源门控</td></tr><tr><td>Resource Reservation Protocol，RSVP</td><td>资源预留协议</td></tr><tr><td>robustness</td><td>健壮性</td></tr><tr><td>routine</td><td>例程</td></tr><tr><td>run</td><td>行串（用于NTFS结构中）</td></tr><tr><td>scalability</td><td>可伸缩性</td></tr><tr><td>scatter&#x2F;gather LI&#x2F;O</td><td>分散&#x2F;聚集 I&#x2F;O</td></tr><tr><td>scheduler</td><td>调度器</td></tr><tr><td>schema</td><td>表结构</td></tr><tr><td>secondary object namespace</td><td>从属对象名字空间</td></tr><tr><td>section object</td><td>内存区对象</td></tr><tr><td>section， memory section</td><td>内存区</td></tr><tr><td>sector sparing</td><td>扇区备用</td></tr><tr><td>secure attention sequence.SAS</td><td>安全注意序列</td></tr><tr><td>Security Accounts Manager， SAM</td><td>安全账户管</td></tr><tr><td>security credential</td><td>安全凭证</td></tr><tr><td>Security descriptor</td><td>安全描述符</td></tr><tr><td>security identifier， SID</td><td>安全标识符</td></tr><tr><td>security quality of service， SQOS</td><td>安全服务质量</td></tr><tr><td>Security reference monitor</td><td>安全引用监视器</td></tr><tr><td>Security Support Provider Interface，SSPI</td><td>安全支持提供者接口</td></tr><tr><td>security validation</td><td>安全验证</td></tr><tr><td>Semaphore</td><td>信号量</td></tr><tr><td>serial port</td><td>串行口</td></tr><tr><td>server</td><td>服务器</td></tr><tr><td>service</td><td>服务</td></tr><tr><td>Service Control Manager，SCM</td><td>服务控制管理器</td></tr><tr><td>service descriptor table</td><td>服务描述符表</td></tr><tr><td>Service Pack</td><td>服务补丁包</td></tr><tr><td>session manager</td><td>会话管理器</td></tr><tr><td>session namespace</td><td>会话名字空间</td></tr><tr><td>shared memory</td><td>共享的内存</td></tr><tr><td>shim</td><td>铺垫</td></tr><tr><td>shutdown</td><td>停机</td></tr><tr><td>socket</td><td>套接字</td></tr><tr><td>sof fault</td><td>软错误</td></tr><tr><td>Software Restriction Policy</td><td>软件限制策略</td></tr><tr><td>spanned volume</td><td>跨距卷</td></tr><tr><td>spin-down</td><td>停止旋转</td></tr><tr><td>spinlock</td><td>自旋锁</td></tr><tr><td>splash screen</td><td>启动屏幕</td></tr><tr><td>stack frame</td><td>栈帧</td></tr><tr><td>stack location</td><td>栈单元</td></tr><tr><td>stack overrun</td><td>栈溢出</td></tr><tr><td>stack trash</td><td>栈破坏</td></tr><tr><td>standby list</td><td>备用（页面）列表</td></tr><tr><td>startup</td><td>启动</td></tr><tr><td>starvation</td><td>饥饿</td></tr><tr><td>storage area network，SAN</td><td>存储区域网络</td></tr><tr><td>striped volume</td><td>条带卷</td></tr><tr><td>stub</td><td>存根</td></tr><tr><td>symbolic link</td><td>符号链接</td></tr><tr><td>symmetric multiprocessing， SMP</td><td>对称多处理</td></tr><tr><td>synchronization</td><td>同步</td></tr><tr><td>system service</td><td>系统服务</td></tr><tr><td>system service call</td><td>系统服务调用理器</td></tr><tr><td>system service dispatching</td><td>系统服务分发</td></tr><tr><td>system volume</td><td>系统卷</td></tr><tr><td>targeted DPC</td><td>定向的DPC（与特定的CPU相关联）</td></tr><tr><td>Task Manager</td><td>任务管理器</td></tr><tr><td>task ofloading</td><td>任务外移</td></tr><tr><td>TDI transport TD</td><td>1传输器</td></tr><tr><td>terminal service</td><td>终端服务</td></tr><tr><td>thread</td><td>线程</td></tr><tr><td>Thread environment block，TEB</td><td>线程环境块</td></tr><tr><td>thread scheduling</td><td>线程调度</td></tr><tr><td>thread-thrashing</td><td>线程频繁轮换</td></tr><tr><td>tick</td><td>嘀嗒</td></tr><tr><td>time slice</td><td>时间片</td></tr><tr><td>timer</td><td>定时器</td></tr><tr><td>TLS</td><td>线程局部存储区</td></tr><tr><td>transaction</td><td>事务</td></tr><tr><td>transition</td><td>转移，转换</td></tr><tr><td>Translation Look-aside Buffer，TLB</td><td>地址转译快查缓冲区</td></tr><tr><td>Transport Driver Interface， TDI</td><td>传输驱动程序接口</td></tr><tr><td>trap</td><td>捕获（动词），陷阱（名词）</td></tr><tr><td>trap frame</td><td>陷阱帧</td></tr><tr><td>trap handler</td><td>陷阱处理器</td></tr><tr><td>trigger</td><td>触发器</td></tr><tr><td>trim</td><td>修剪</td></tr><tr><td>truncate</td><td>截断、截短</td></tr><tr><td>undo</td><td>撤销</td></tr><tr><td>unicast</td><td>单播</td></tr><tr><td>Universal Disk Format， UDF</td><td>通用磁盘格式</td></tr><tr><td>Universal Naming Convention， UNC</td><td>统一命名规范</td></tr><tr><td>Universal Plug and Play.UPnP</td><td>通用即插即用</td></tr><tr><td>unmanaged code</td><td>非托管代码</td></tr><tr><td>user mode</td><td>用户模式</td></tr><tr><td>view</td><td>视图（确切含义视上下文）</td></tr><tr><td>virtual address control block，VACB</td><td>虚拟地址控制块</td></tr><tr><td>Virtual address descriptor，VAD</td><td>虚拟地址描述符</td></tr><tr><td>virtual cluster number，VCN</td><td>虚拟簇号</td></tr><tr><td>volatile</td><td>易失的、易失性</td></tr><tr><td>window station</td><td>窗口站</td></tr><tr><td>Windows</td><td>管理规范</td></tr><tr><td>Windows Driver Model， WDM Windows</td><td>驱动程序模型</td></tr><tr><td>Windows Error Reporting Windows</td><td>错误报告</td></tr><tr><td>Windows File Protection， WFP Windows</td><td>文件保护机制</td></tr><tr><td>Windows Global Flags Windows</td><td>全局标志</td></tr><tr><td>Windows Internet</td><td>名称服务</td></tr><tr><td>Windows Internet Name Service</td><td>WINS，Windows管理规范</td></tr><tr><td>Windows Management Instrumentation</td><td>Windows管理规范</td></tr><tr><td>Windows Sockets Direct， WSD Windows</td><td>套接字直接访问</td></tr><tr><td>working set</td><td>工作集</td></tr><tr><td>working set trimming</td><td>工作集修剪</td></tr><tr><td>write throtling</td><td>写节流</td></tr><tr><td>write-behind</td><td>滞后写</td></tr><tr><td>write-through</td><td>直写</td></tr><tr><td>yield</td><td>放弃</td></tr><tr><td>zero list</td><td>零（页面）列表</td></tr><tr><td>zero page thread</td><td>零页面线程</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> En </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 《深入理解Windows操作系统》 </tag>
            
            <tag> 英语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编程常用英语词汇</title>
      <link href="/%E6%89%8B%E5%86%8C/En/CodeEn/"/>
      <url>/%E6%89%8B%E5%86%8C/En/CodeEn/</url>
      
        <content type="html"><![CDATA[<h1 id="编程常用英语整理"><a href="#编程常用英语整理" class="headerlink" title="编程常用英语整理"></a>编程常用英语整理</h1><h2 id="一、交互式环境与print输出"><a href="#一、交互式环境与print输出" class="headerlink" title="一、交互式环境与print输出"></a>一、交互式环境与print输出</h2><p>1、print：打印&#x2F;输出<br>2、coding：编码<br>3、syntax：语法<br>4、error：错误<br>5、invalid：无效<br>6、identifier：名称&#x2F;标识符<br>7、character ：字符</p><h2 id="二、字符串的操作"><a href="#二、字符串的操作" class="headerlink" title="二、字符串的操作"></a>二、字符串的操作</h2><p>1、user：用户<br>2、name：姓名&#x2F;名称<br>3、attribute：字段&#x2F;属性<br>4、value：值</p><h2 id="三、重复-x2F-转换-x2F-替换-x2F-原始字符串"><a href="#三、重复-x2F-转换-x2F-替换-x2F-原始字符串" class="headerlink" title="三、重复&#x2F;转换&#x2F;替换&#x2F;原始字符串"></a>三、重复&#x2F;转换&#x2F;替换&#x2F;原始字符串</h2><p>1、upper：上面<br>2、lower：下面<br>3、capitalize：用大写字母写或印刷<br>4、title：标题<br>5、replace：替换<br>6、old：旧的<br>7、new：新的<br>8、count：计数<br>9、swap：互换<br>10、case：情形<br>11、path：路径<br>12、new：新的\新建<br>13、project：项目<br>14、test：测试<br>15、file：文件<br>16、data：数据</p><h2 id="四、去除-x2F-查询-x2F-计数"><a href="#四、去除-x2F-查询-x2F-计数" class="headerlink" title="四、去除&#x2F;查询&#x2F;计数"></a>四、去除&#x2F;查询&#x2F;计数</h2><p>1、strip：去除<br>2、index：索引<br>3、find：查找<br>4、count：计数<br>5、start：开始<br>6、end：结束<br>7、chars：字符<br>8、sub：附属</p><h2 id="五、获取输入-x2F-格式化"><a href="#五、获取输入-x2F-格式化" class="headerlink" title="五、获取输入&#x2F;格式化"></a>五、获取输入&#x2F;格式化</h2><p>1、input：输入<br>2、prompt：提示<br>3、ID：身份证<br>4、format：格式化<br>5、args（argument）：参数<br>6、kwargs：关键字参数<br>7、year：年<br>8、month：月<br>9、day：日</p><h2 id="六、元祖"><a href="#六、元祖" class="headerlink" title="六、元祖"></a>六、元祖</h2><p>1、tuple：元组<br>2、max：最大<br>3、min：最小<br>4、iterable：可迭代<br>5、key：关键字<br>6、function：方法&#x2F;函数<br>7、stop：停止<br>8、object：对象</p><h2 id="七、列表"><a href="#七、列表" class="headerlink" title="七、列表"></a>七、列表</h2><p>1、list：列表<br>2、reverse：反向<br>3、true：真<br>4、false：假<br>5、append：附加<br>6、extend：扩展<br>7、insert：插入<br>8、pop：取出<br>9、remove：移除<br>10、del（delete）：删除<br>11、clear：清除<br>12、sort：排序</p><h2 id="八、集合"><a href="#八、集合" class="headerlink" title="八、集合"></a>八、集合</h2><p>1、set：集合&#x2F;设置<br>2、add：添加<br>3、update：更新<br>4、discard：丢弃<br>5、intersection：相交<br>6、union：联合<br>7、difference：差数<br>8、symmetric：对称<br>9、in：在…里面<br>10、not：不&#x2F;不是<br>11、disjoint：不相交<br>12、subset：子集<br>13、superset：父集&#x2F;超集<br>14、copy：复制</p><h2 id="九、字典"><a href="#九、字典" class="headerlink" title="九、字典"></a>九、字典</h2><p>1、dict：字典<br>2、key：键&#x2F;关键字<br>3、value：值<br>4、item：项<br>5、mapping：映射<br>6、seq（sequence）：序列<br>7、from：从&#x2F;来自<br>8、get：获取<br>9、default：默认<br>10、none：没有<br>11、arg：可变元素<br>12、kwargs（keyword args）：可变关键字元素</p><h2 id="十、常用的一些必备的英语单词"><a href="#十、常用的一些必备的英语单词" class="headerlink" title="十、常用的一些必备的英语单词"></a>十、常用的一些必备的英语单词</h2><ul><li>Projects ：项目</li><li>Process finished with exit code 0     进程结束，退出代码为0，一般是执行成功的过程</li><li>Process：  过程</li><li>code ：代码</li><li>Traceback：回溯</li><li>File：文件</li><li>line：行</li><li>module：模块[‘mɑdʒul]</li><li>NameError：名称错误</li><li>is not defined：没有定义</li><li>SyntaxError：语法错误</li><li>literal：文字，文字的</li><li>string：字符串</li><li>scanning：扫描</li><li>EOL ：寿命终止</li><li>IndentationError：缩减错误</li><li>unindent：取消缩进</li><li>match：匹配</li><li>indentation：缩进 [,ɪndɛn’teʃən]缩进</li><li>unindent does not match any outer indentation level： 未缩进不匹配任何外部缩进级别</li><li>invalid syntax：无效的语法</li></ul><h2 id="十一、扇贝"><a href="#十一、扇贝" class="headerlink" title="十一、扇贝"></a>十一、扇贝</h2><p>扇贝上有专门整理好的pyhon常用单词，但是要支付199贝壳。</p><p>我写了个爬虫，免199贝壳去支付…拿下网页的单词，下面是代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;vocabulary.doc&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spider</span>(<span class="params">url</span>):</span><br><span class="line"></span><br><span class="line">    res = requests.get(url).text</span><br><span class="line"></span><br><span class="line">    pattern = <span class="string">&#x27;&lt;strong&gt;([a-z,A-Z]*?)&lt;/strong&gt;\s*&lt;/td&gt;\s*&lt;td class=&quot;span10&quot;&gt;(.*?)&lt;/td&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">    vocabulary_list = re.findall(pattern, res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> vocabulary <span class="keyword">in</span> vocabulary_list:</span><br><span class="line"></span><br><span class="line"> file.writelines((vocabulary[<span class="number">0</span>].strip(<span class="string">&#x27;&#x27;</span>), vocabulary[<span class="number">1</span>].strip(<span class="string">&#x27;&#x27;</span>), <span class="string">&quot;\n&quot;</span>))</span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;[词串： list 1](https://www.shanbay.com/wordlist/104899/202159/?page=)&quot;</span>,</span><br><span class="line"></span><br><span class="line">     <span class="string">&quot;[词串： list 2](https://www.shanbay.com/wordlist/104899/202162/?page=)&quot;</span>,</span><br><span class="line"></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line"></span><br><span class="line"> url = <span class="string">&quot;[词串： list 1](https://www.shanbay.com/wordlist/104899/202159/?page=)&quot;</span> + <span class="built_in">str</span>(i)</span><br><span class="line"></span><br><span class="line"> spider(url)</span><br><span class="line"></span><br><span class="line">file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>会生成一个word的结果文档在代码运行的同一目录下，结果如下，没有可以排版，最好是放在excel下。</p><h2 id="十二、程序员常用单词600个"><a href="#十二、程序员常用单词600个" class="headerlink" title="十二、程序员常用单词600个"></a>十二、程序员常用单词600个</h2><h3 id="A"><a href="#A" class="headerlink" title="A"></a>A</h3><table><thead><tr><th>application</th><th>应用程式 应用、应用程序</th></tr></thead><tbody><tr><td>application framework</td><td>应用程式框架、应用框架 应用程序框架</td></tr><tr><td>architecture</td><td>架构、系统架构 <a href="https://www.zhihu.com/search?q=%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">体系结构</a></td></tr><tr><td>argument</td><td>引数（传给函式的值）。叁见 parameter 叁数、实质叁数、实叁、自变量</td></tr><tr><td>array</td><td>阵列 数组</td></tr><tr><td>arrow operator arrow</td><td>（箭头）运算子 箭头操作符</td></tr><tr><td>assembly</td><td>装配件</td></tr><tr><td>assembly language</td><td>组合语言 汇编语言</td></tr><tr><td>assert</td><td>(ion) 断言</td></tr><tr><td>assign</td><td>指派、指定、设值、赋值 赋值</td></tr><tr><td>assignment</td><td>指派、指定 赋值、分配</td></tr><tr><td>assignment operator</td><td>指派（赋值）运算子 &#x3D; 赋值操作符</td></tr><tr><td>associated</td><td>相应的、相关的 相关的、关联、相应的</td></tr><tr><td>associative container</td><td>关联式容器（对应 sequential container） 关联式容器</td></tr><tr><td>atomic</td><td>不可分割的 原子的</td></tr><tr><td>attribute</td><td>属性 属性、特性</td></tr><tr><td>audio</td><td>音讯 音频</td></tr><tr><td>A.I.</td><td>人工智慧 人工智能</td></tr></tbody></table><h3 id="B"><a href="#B" class="headerlink" title="B"></a>B</h3><table><thead><tr><th>background</th><th>背景 背景（用於图形着色） 后台（用於行程）</th></tr></thead><tbody><tr><td>backward compatible</td><td>回溯相容 向下兼容</td></tr><tr><td>bandwidth</td><td>频宽 带宽</td></tr><tr><td>base class</td><td>基础类别 基类</td></tr><tr><td>base type</td><td>基础型别 (等同於 base class)</td></tr><tr><td>batch</td><td>批次（意思是整批作业） 批处理</td></tr><tr><td>benefit</td><td>利益 收益</td></tr><tr><td>best viable function</td><td>最佳可行函式 最佳可行函式 （从 viable functions 中挑出的最佳吻合者）</td></tr><tr><td>binary search</td><td>二分搜寻法 二分查找</td></tr><tr><td>binary tree</td><td>二元树 二叉树</td></tr><tr><td>binary function</td><td>二元函式 双叁函数</td></tr><tr><td>binary operator</td><td>二元运算子 二元操作符</td></tr><tr><td>binding</td><td>系结 绑定</td></tr><tr><td>bit</td><td>位元 位</td></tr><tr><td>bit field</td><td>位元栏 位域</td></tr><tr><td>bitmap</td><td>位元图 位图</td></tr><tr><td>bitwise</td><td>以 bit 为单元逐一┅</td></tr><tr><td>bitwise copy</td><td>以 bit 为单元进行复制；位元逐一复制 位拷贝</td></tr><tr><td>block</td><td>区块,区段 块、区块、语句块</td></tr><tr><td>boolean</td><td><a href="https://www.zhihu.com/search?q=%E5%B8%83%E6%9E%97%E5%80%BC&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">布林值</a>（真假值，true 或 false） <a href="https://www.zhihu.com/search?q=%E5%B8%83%E5%B0%94%E5%80%BC&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">布尔值</a></td></tr><tr><td>border</td><td>边框、框线 边框</td></tr><tr><td>brace</td><td>(curly brace) 大括弧、大括号 花括弧、花括号</td></tr><tr><td>bracket</td><td>(square brakcet) 中括弧、中括号 方括弧、方括号</td></tr><tr><td>breakpoint</td><td>中断点 断点</td></tr><tr><td>build</td><td>建造、构筑、建置（MS 用语）</td></tr><tr><td>build－in</td><td>内建 内置</td></tr><tr><td>bus</td><td><a href="https://www.zhihu.com/search?q=%E6%B1%87%E6%B5%81%E6%8E%92&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">汇流排</a> 总线</td></tr><tr><td>business</td><td>商务,业务 业务</td></tr><tr><td>buttons</td><td>按钮 按钮</td></tr><tr><td>byte</td><td>位元组（由 8 bits 组成） 字节</td></tr></tbody></table><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><table><thead><tr><th>cache</th><th>快取 高速缓存</th></tr></thead><tbody><tr><td>call</td><td>呼叫、叫用 调用</td></tr><tr><td>callback</td><td>回呼 回调</td></tr><tr><td>call operator call</td><td>（函式呼叫）运算子调用操作符  （同 function call operator）</td></tr><tr><td>candidate function</td><td>候选函式 候选函数  （在函式多载决议程序中出现的候选函式）</td></tr><tr><td>chain</td><td>串链（例 chain of function calls） 链</td></tr><tr><td>character</td><td>字元 字符</td></tr><tr><td>check box</td><td>核取方块 (i.e. check button) 复选框</td></tr><tr><td>checked exception</td><td>可控式异常(Java)</td></tr><tr><td>check button</td><td>方钮 (i.e. check box) 复选按钮</td></tr><tr><td>child class</td><td>子类别（或称为derived class, subtype） 子类</td></tr><tr><td>class</td><td>类别 类</td></tr><tr><td>class body</td><td>类别本体 类体</td></tr><tr><td>class declaration</td><td>类别宣告、类别宣告式 类声明</td></tr><tr><td>class definition</td><td>类别定义、类别定义式 类定义</td></tr><tr><td>class derivation list</td><td>类别衍化列 类继承列表</td></tr><tr><td>class head</td><td>类别表头 类头</td></tr><tr><td>class hierarchy</td><td>类别继承体系, 类别阶层 类层次体系</td></tr><tr><td>class library</td><td>类别程式库、类别库 类库</td></tr><tr><td>class template</td><td>类别模板、类别范本 类模板</td></tr><tr><td>class template partial specializations</td><td>类别模板偏特化 类模板部分特化</td></tr><tr><td>class template specializations</td><td>类别模板特化 类模板特化</td></tr><tr><td>cleanup</td><td>清理、善后 清理、清除</td></tr><tr><td>client</td><td>客端、客户端、客户 客户</td></tr><tr><td>client－server</td><td>主从架构 客户&#x2F;服务器</td></tr><tr><td>clipboard</td><td>剪贴簿 剪贴板</td></tr><tr><td>clone</td><td>复制 克隆</td></tr><tr><td>collection</td><td>群集 集合</td></tr><tr><td>combo box</td><td>复合方块、复合框 组合框</td></tr><tr><td>command line</td><td>命令列 命令行 (系统文字模式下的整行执行命令)</td></tr><tr><td>communication</td><td>通讯 通讯</td></tr><tr><td>compatible</td><td>相容 兼容</td></tr><tr><td>compile time</td><td>编译期 编译期、编译时</td></tr><tr><td>compiler</td><td>编译器 编译器</td></tr><tr><td>component</td><td>组件 组件</td></tr><tr><td>composition</td><td>复合、合成、组合 组合</td></tr><tr><td>computer</td><td>电脑、计算机 计算机、电脑</td></tr><tr><td>concept</td><td>概念 概念</td></tr><tr><td>concrete</td><td>具象的 实在的</td></tr><tr><td>concurrent</td><td>并行 并发</td></tr><tr><td>configuration</td><td>组态 配置</td></tr><tr><td>connection</td><td>连接，连线（网络,资料库） 连接</td></tr><tr><td>constraint</td><td>约束（条件）</td></tr><tr><td>construct</td><td>构件 构件</td></tr><tr><td>container</td><td>容器 容器（存放资料的某种结构如 list, vector…）</td></tr><tr><td>containment</td><td>内含 包容</td></tr><tr><td>context</td><td>背景关系、周遭环境、上下脉络 环境、上下文</td></tr><tr><td>control</td><td><a href="https://www.zhihu.com/search?q=%E6%8E%A7%E5%88%B6%E5%85%83%E4%BB%B6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">控制元件</a>、控件 控件</td></tr><tr><td>console</td><td>主控台 控制台</td></tr><tr><td>const</td><td>常数（constant 的缩写，C++ 关键字）</td></tr><tr><td>constant</td><td>常数（相对於 variable） 常量</td></tr><tr><td>constructor</td><td>(ctor） 建构式 构造函数 （与class 同名的一种 member functions）</td></tr><tr><td>copy</td><td>(v) 复制、拷贝 拷贝</td></tr><tr><td>copy</td><td>(n) 复件, 副本</td></tr><tr><td>cover</td><td>涵盖 覆盖</td></tr><tr><td>create</td><td>创建、建立、产生、生成 创建</td></tr><tr><td>creation</td><td>产生、生成 创建</td></tr><tr><td>cursor</td><td>游标 光标</td></tr><tr><td>custom</td><td>订制、自定 定制</td></tr></tbody></table><h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><table><thead><tr><th>data</th><th>资料 数据</th></tr></thead><tbody><tr><td>database</td><td>资料库 数据库</td></tr><tr><td>database schema</td><td>数据库结构纲目</td></tr><tr><td>data member</td><td>资料成员、成员变数 数据成员、成员变量</td></tr><tr><td>data structure</td><td>资料结构 数据结构</td></tr><tr><td>datagram</td><td>资料元 数据报文</td></tr><tr><td>dead lock</td><td>死结 死锁</td></tr><tr><td>debug</td><td>除错 调试</td></tr><tr><td>debugger</td><td>除错器 调试器</td></tr><tr><td>declaration</td><td>宣告、宣告式 声明</td></tr><tr><td>deduction</td><td>推导（例：template argument deduction） 推导、推断</td></tr><tr><td>default</td><td>预设 缺省、默认</td></tr><tr><td>defer</td><td>延缓 推迟</td></tr><tr><td>define</td><td>定义 预定义</td></tr><tr><td>definition</td><td>定义、定义区、定义式 定义</td></tr><tr><td>delegate</td><td>委派、委托、委任 委托</td></tr><tr><td>delegation</td><td>（同上）</td></tr><tr><td>demarshal</td><td>反编列 散集</td></tr><tr><td>dereference</td><td>提领（取出指标所指物体的内容） 解叁考</td></tr><tr><td>dereference operator dereference</td><td>（提领）运算子 * 解叁考操作符</td></tr><tr><td>derived class</td><td>衍生类别 派生类</td></tr><tr><td>design by contract</td><td>契约式设计</td></tr><tr><td>design pattern</td><td>设计范式、设计样式 设计模式 ※ 最近我比较喜欢「设计范式」一词</td></tr><tr><td>destroy</td><td>摧毁、销毁</td></tr><tr><td>destructor</td><td>解构式 <a href="https://www.zhihu.com/search?q=%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">析构函数</a></td></tr><tr><td>device</td><td>装置、设备 设备</td></tr><tr><td>dialog</td><td>对话窗、对话盒 对话框</td></tr><tr><td>directive</td><td>指令（例：using directive） (编译)指示符</td></tr><tr><td>directory</td><td>目录 目录</td></tr><tr><td>disk</td><td>碟 盘</td></tr><tr><td>dispatch</td><td>分派 分派</td></tr><tr><td>distributed computing</td><td>分布式计算 (<a href="https://www.zhihu.com/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E7%94%B5%E7%AE%97&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">分布式电算</a>) 分布式计算 分散式计算 (分散式电算)</td></tr><tr><td>document</td><td>文件 文档</td></tr><tr><td>dot operator dot</td><td>（句点）运算子 . (圆)点操作符</td></tr><tr><td>driver</td><td>驱动程式 驱动（程序）</td></tr><tr><td>dynamic binding</td><td>动态系结 动态绑定</td></tr></tbody></table><h3 id="E"><a href="#E" class="headerlink" title="E"></a>E</h3><table><thead><tr><th>efficiency</th><th>效率 效率</th></tr></thead><tbody><tr><td>efficient</td><td>高效 高效</td></tr><tr><td>end user</td><td>终端用户</td></tr><tr><td>entity</td><td>物体 实体、物体</td></tr><tr><td>encapsulation</td><td>封装 封装</td></tr><tr><td>enclosing class</td><td>外围类别（与巢状类别 nested class 有关）外围类</td></tr><tr><td>enum</td><td>(enumeration) 列举（一种 C++ 资料型别） 枚举</td></tr><tr><td>enumerators</td><td>列举元（enum 型别中的成员） 枚举成员、枚举器</td></tr><tr><td>equal</td><td>相等 相等</td></tr><tr><td>equality</td><td>相等性 相等性</td></tr><tr><td>equality operator equality</td><td>（等号）运算子 &#x3D;&#x3D; 等号操作符</td></tr><tr><td>equivalence</td><td>等价性、等同性、对等性 等价性</td></tr><tr><td>equivalent</td><td>等价、等同、对等 等价</td></tr><tr><td>escape code</td><td>转义码 转义码</td></tr><tr><td>evaluate</td><td>评估、求值、核定 评估</td></tr><tr><td>event</td><td>事件 事件</td></tr><tr><td>event driven</td><td>事件驱动的 事件驱动的</td></tr><tr><td>exception</td><td>异常情况 异常</td></tr><tr><td>exception declaration</td><td>异常宣告（ref. C++ Primer 3&#x2F;e, 11.3） 异常声明</td></tr><tr><td>exception handling</td><td>异常处理、异常处理机制 异常处理、异常处理机制</td></tr><tr><td>exception specification</td><td>异常规格（ref. C++ Primer 3&#x2F;e, 11.4） 异常规范</td></tr><tr><td>exit</td><td>退离（指离开函式时的那一个执行点） 退出</td></tr><tr><td>explicit</td><td>明白的、明显的、显式 显式</td></tr><tr><td>export</td><td>汇出 引出、导出</td></tr><tr><td>expression</td><td>运算式、算式 表达式</td></tr></tbody></table><h3 id="F"><a href="#F" class="headerlink" title="F"></a>F</h3><table><thead><tr><th>facility</th><th>设施、设备 设施、设备</th></tr></thead><tbody><tr><td>feature</td><td>特性</td></tr><tr><td>field</td><td>栏位,资料栏（Java） 字段, 值域（Java）</td></tr><tr><td>file</td><td>档案 文件</td></tr><tr><td>firmware</td><td>韧体 固件</td></tr><tr><td>flag</td><td>旗标 标记</td></tr><tr><td>flash memory</td><td>快闪记忆体 闪存</td></tr><tr><td>flexibility</td><td>弹性 灵活性</td></tr><tr><td>flush</td><td>清理、扫清 刷新</td></tr><tr><td>font</td><td>字型 字体</td></tr><tr><td>form</td><td>表单（programming 用语） 窗体</td></tr><tr><td>formal parameter</td><td>形式叁数 形式叁数</td></tr><tr><td>forward declaration</td><td>前置宣告 前置声明</td></tr><tr><td>forwarding</td><td>转呼叫,转发 转发</td></tr><tr><td>forwarding function</td><td>转呼叫函式,转发函式 转发函数</td></tr><tr><td>fractal</td><td>碎形 分形</td></tr><tr><td>framework</td><td>框架 框架</td></tr><tr><td>full specialization</td><td>全特化（ref. partial specialization）</td></tr><tr><td>function</td><td>函式、函数 函数</td></tr><tr><td>function call operator</td><td>同 call operator</td></tr><tr><td>function object</td><td>函式物件（ref. C++ Primer 3&#x2F;e, 12.3） 函数对象</td></tr><tr><td>function overloaded resolution</td><td>函式多载决议程序 函数重载解决（方案）</td></tr><tr><td>functionality</td><td>功能、机能 功能</td></tr><tr><td>function template</td><td>函式模板、函式范本 函数模板</td></tr><tr><td>functor</td><td>仿函式 仿函式、函子</td></tr></tbody></table><h3 id="G"><a href="#G" class="headerlink" title="G"></a>G</h3><table><thead><tr><th>game</th><th>游戏 游戏</th></tr></thead><tbody><tr><td>generate</td><td>生成</td></tr><tr><td>generic</td><td>泛型、一般化的 一般化的、通用的、泛化</td></tr><tr><td>generic algorithm</td><td>泛型演算法 通用算法</td></tr><tr><td>getter</td><td>(相对於 setter) 取值函式</td></tr><tr><td>global</td><td>全域的（对应於 local） 全局的</td></tr><tr><td>global object</td><td>全域物件 全局对象</td></tr><tr><td>global scope resolution operator</td><td>全域生存空间（范围决议）运算子 :: 全局范围解析操作符</td></tr><tr><td>group</td><td>群组</td></tr><tr><td>group box</td><td>群组方块 分组框</td></tr><tr><td>guard clause</td><td>卫述句 (Refactoring, p250) 卫语句</td></tr><tr><td>GUI</td><td>图形介面 图形界面</td></tr></tbody></table><h3 id="H"><a href="#H" class="headerlink" title="H"></a>H</h3><table><thead><tr><th>hand shaking</th><th>握手协商</th></tr></thead><tbody><tr><td>handle</td><td>识别码、识别号、号码牌、权柄 句柄</td></tr><tr><td>handler</td><td>处理常式 处理函数</td></tr><tr><td>hard－coded</td><td>编死的 硬编码的</td></tr><tr><td>hard－copy</td><td>硬拷图 屏幕截图</td></tr><tr><td>hard disk</td><td>硬碟 硬盘</td></tr><tr><td>hardware</td><td>硬体 硬件</td></tr><tr><td>hash table</td><td>杂凑表 哈希表、散列表</td></tr><tr><td>header file</td><td>表头档、标头档 头文件</td></tr><tr><td>heap</td><td>堆积 堆</td></tr><tr><td>hierarchy</td><td>阶层体系 层次结构（体系）</td></tr><tr><td>hook</td><td>挂钩 钩子</td></tr><tr><td>hyperlink</td><td>超链结 超链接</td></tr></tbody></table><h3 id="I"><a href="#I" class="headerlink" title="I"></a>I</h3><table><thead><tr><th>icon</th><th>图示、图标 图标</th></tr></thead><tbody><tr><td>IDE</td><td>整合开发环境 集成开发环境</td></tr><tr><td>identifier</td><td>识别字、识别符号 标识符</td></tr><tr><td>if and only if</td><td>若且唯若 当且仅当</td></tr><tr><td>Illinois</td><td>伊利诺 伊利诺斯</td></tr><tr><td>image</td><td>影像 图象</td></tr><tr><td>immediate base</td><td>直接的（紧临的）上层 base class。 直接上层基类</td></tr><tr><td>immediate derived</td><td>直接的（紧临的）下层 derived class。 直接下层派生类</td></tr><tr><td>immutability</td><td>不变性</td></tr><tr><td>immutable</td><td>不可变（的）</td></tr><tr><td>implement</td><td>实作、实现 实现</td></tr><tr><td>implementation</td><td>实作品、实作体、实作码、实件 实现</td></tr><tr><td>implicit</td><td>隐喻的、暗自的、隐式 隐式</td></tr><tr><td>import</td><td>汇入 导入</td></tr><tr><td>increment operator</td><td>累加运算子 ++ 增加操作符</td></tr><tr><td>infinite loop</td><td>无穷回圈 无限循环</td></tr><tr><td>infinite recursive</td><td>无穷递回 无限递归</td></tr><tr><td>information</td><td>资讯 信息</td></tr><tr><td>infrastructure</td><td>公共基础建设</td></tr><tr><td>inheritance</td><td>继承、继承机制 继承、继承机制</td></tr><tr><td>inline</td><td>行内 内联</td></tr><tr><td>inline expansion</td><td>行内展开 内联展开</td></tr><tr><td>initialization</td><td>初始化（动作） 初始化</td></tr><tr><td>initialization list</td><td>初值列 初始值列表</td></tr><tr><td>initialize</td><td>初始化 初始化</td></tr><tr><td>inner class</td><td>内隐类别 内嵌类</td></tr><tr><td>instance</td><td>实体 实例 （根据某种表述而实际产生的「东西」）</td></tr><tr><td>instantiated</td><td>具现化、实体化（常应用於 template） 实例化</td></tr><tr><td>instantiation</td><td>具现体、具现化实体（常应用於 template） 实例</td></tr><tr><td>integer</td><td>(integral) 整数（的） 整型（的）</td></tr><tr><td>integrate</td><td>整合 集成</td></tr><tr><td>interacts</td><td>交谈、互动 交互</td></tr><tr><td>interface</td><td>介面 接口</td></tr><tr><td>for GUI</td><td>介面 界面</td></tr><tr><td>interpreter</td><td>直译器 解释器</td></tr><tr><td>invariants</td><td>恒常性,约束条件 约束条件</td></tr><tr><td>invoke</td><td>唤起 调用</td></tr><tr><td>iterate</td><td>迭代（回圈一个轮回一个轮回地进行） 迭代</td></tr><tr><td>iterative</td><td>反覆的，迭代的</td></tr><tr><td>iterator</td><td>迭代器（一种泛型指标） 迭代器</td></tr><tr><td>iteration</td><td>迭代（回圈每次轮回称为一个 iteration） 迭代</td></tr><tr><td>item</td><td>项目、条款 项、条款、项目</td></tr></tbody></table><h3 id="L"><a href="#L" class="headerlink" title="L"></a>L</h3><table><thead><tr><th>laser</th><th>雷射 激光</th></tr></thead><tbody><tr><td>level</td><td>阶 层 (级) 例 high level 高阶 高层</td></tr><tr><td>library</td><td>程式库、函式库 库、函数库</td></tr><tr><td>lifetime</td><td>生命期、寿命 生命期、寿命</td></tr><tr><td>link</td><td>联结、连结 连接,链接</td></tr><tr><td>linker</td><td>联结器、连结器 连接器</td></tr><tr><td>literal constant</td><td>字面常数（例 3.14 或 “hi” 这等常数值） 字面常数</td></tr><tr><td>list</td><td>串列（linked－list） 列表、表、链表</td></tr><tr><td>list box</td><td>列表方块、列表框 列表框</td></tr><tr><td>load</td><td>载入 装载</td></tr><tr><td>loader</td><td>载入器 装载器、载入器</td></tr><tr><td>local</td><td>区域的（对应於 global） 局部的</td></tr><tr><td>local object</td><td>区域物件 局部对象</td></tr><tr><td>lock</td><td>机锁</td></tr><tr><td>loop</td><td>回圈 循环</td></tr><tr><td>lvalue</td><td>左值 左值</td></tr></tbody></table><h3 id="M"><a href="#M" class="headerlink" title="M"></a>M</h3><table><thead><tr><th>macro</th><th>巨集 宏</th></tr></thead><tbody><tr><td>magic number</td><td>魔术数字 魔法数</td></tr><tr><td>maintain</td><td>维护 维护</td></tr><tr><td>manipulator</td><td>操纵器（iostream 预先定义的一种东西） 操纵器</td></tr><tr><td>marshal</td><td>编列 列集 叁考 demarshal</td></tr><tr><td>mechanism</td><td>机制 机制</td></tr><tr><td>member</td><td>成员 成员</td></tr><tr><td>member access operator</td><td>成员取用运算子（有 dot 和 arrow 两种） 成员存取操作符</td></tr><tr><td>member function</td><td>成员函式 成员函数</td></tr><tr><td>member initialization list</td><td>成员初值列 成员初始值列表</td></tr><tr><td>memberwise</td><td>以 member 为单元┅、members 逐一┅ 以成员为单位</td></tr><tr><td>memberwise copy</td><td>以 members 为单元逐一复制</td></tr><tr><td>memory</td><td>记忆体 内存</td></tr><tr><td>menu</td><td>表单、选单 菜单</td></tr><tr><td>message</td><td>讯息 消息</td></tr><tr><td>message based</td><td>以讯息为基础的 基於消息的</td></tr><tr><td>message loop</td><td>讯息回圈 消息环</td></tr><tr><td>method</td><td>(Java) 方法、行为、函式 方法</td></tr><tr><td>meta</td><td></td></tr><tr><td>micro</td><td>微</td></tr><tr><td>middleware</td><td>中介层 中间件</td></tr><tr><td>modeling</td><td>模塑</td></tr><tr><td>modeling language</td><td>塑模语言，建模语言</td></tr><tr><td>modem</td><td>数据机 <a href="https://www.zhihu.com/search?q=%E8%B0%83%E5%88%B6%E8%A7%A3%E8%B0%83%E5%99%A8&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">调制解调器</a></td></tr><tr><td>module</td><td>模组 模块</td></tr><tr><td>modifier</td><td>饰词 <a href="https://www.zhihu.com/search?q=%E4%BF%AE%E9%A5%B0%E7%AC%A6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">修饰符</a></td></tr><tr><td>most derived class</td><td>最末层衍生类别 最底层的派生类</td></tr><tr><td>mouse</td><td>滑鼠 鼠标</td></tr><tr><td>mutable</td><td>可变的 可变的</td></tr><tr><td>multi－tasking</td><td>多工 多任务</td></tr></tbody></table><h3 id="N"><a href="#N" class="headerlink" title="N"></a>N</h3><table><thead><tr><th>namespace</th><th>命名空间 名字空间、命名空间</th></tr></thead><tbody><tr><td>native</td><td>原生的 本地的、固有的</td></tr><tr><td>nested class</td><td>巢状类别 嵌套类</td></tr><tr><td>network</td><td>网路 网络</td></tr><tr><td>network card</td><td>网路卡 网卡</td></tr></tbody></table><h3 id="O"><a href="#O" class="headerlink" title="O"></a>O</h3><table><thead><tr><th>object</th><th>物件 对象</th></tr></thead><tbody><tr><td>object based</td><td>以物件为基础的 基於对象的</td></tr><tr><td>object file</td><td>目的档 目标文件</td></tr><tr><td>object model</td><td>物件模型 对象模型</td></tr><tr><td>object oriented</td><td>物件导向的 面向对象的</td></tr><tr><td>online</td><td>线上 在线</td></tr><tr><td>opaque</td><td>不透明的</td></tr><tr><td>operand</td><td>运算元 操作数</td></tr><tr><td>operating system</td><td>(OS) 作业系统 操作系统</td></tr><tr><td>operation</td><td>操作、操作行为 操作</td></tr><tr><td>operator</td><td>运算子 操作符、运算符</td></tr><tr><td>option</td><td>选项，可选方案 选项</td></tr><tr><td>ordinary</td><td>常规的 常规的</td></tr><tr><td>overflow</td><td>上限溢位（相对於 underflow） 溢出（underflow:下溢）</td></tr><tr><td>overhead</td><td>额外负担、额外开销 额外开销</td></tr><tr><td>overload</td><td>多载化、多载化、重载 重载</td></tr><tr><td>overloaded function</td><td>多载化函式 重载的函数</td></tr><tr><td>overloaded operator</td><td>多载化运算子 被重载的操作符</td></tr><tr><td>overloaded set</td><td>多载集合 重载集合</td></tr><tr><td>override</td><td>改写、覆写 重载、改写、重新定义 （在 derived class 中重新定义虚拟函式</td></tr></tbody></table><h3 id="P"><a href="#P" class="headerlink" title="P"></a>P</h3><table><thead><tr><th>package</th><th>套件 包</th></tr></thead><tbody><tr><td>pair</td><td>对组</td></tr><tr><td>palette</td><td>调色盘、组件盘、工具箱</td></tr><tr><td>pane</td><td>窗格 窗格（有时为嵌板之意，例 Java Content Pane）</td></tr><tr><td>parallel</td><td>平行 并行</td></tr><tr><td>parameter</td><td>叁数（函式叁数列上的变数） 叁数、形式叁数、形叁</td></tr><tr><td>parameter list</td><td>叁数列 叁数列表</td></tr><tr><td>parent class</td><td>父类别（或称 base class） 父类</td></tr><tr><td>parentheses</td><td>小括弧、小括号 圆括弧、圆括号</td></tr><tr><td>parse</td><td>解析 解析</td></tr><tr><td>part</td><td>零件 部件</td></tr><tr><td>partial specialization</td><td>偏特化（ref. C++ Primer 3&#x2F;e, 16.10） 局部特化 （ref. full specialization）</td></tr><tr><td>pass by address</td><td>传址（函式引数的传递方式）（非正式用语）传地址</td></tr><tr><td>pass by reference</td><td>传址（函式引数的一种传递方式） 传地址, 按引用传递</td></tr><tr><td>pass by value</td><td>传值（函式引数的一种传递方式） 按值传递</td></tr><tr><td>pattern</td><td>范式、样式 模式</td></tr><tr><td>performance</td><td>效率、性能兼而有之 性能</td></tr><tr><td>persistence</td><td>永续性 持久性</td></tr><tr><td>pixel</td><td>图素、像素 像素</td></tr><tr><td>placement delete</td><td>ref. C++ Primer3&#x2F;e, 15.8.2</td></tr><tr><td>placement new</td><td>ref. C++ Primer 3&#x2F;e, 15.8.2</td></tr><tr><td>platform</td><td>平台 平台</td></tr><tr><td>pointer</td><td>指标 指针 址位器（和址叁器 reference 形成对映，满好）</td></tr><tr><td>poll</td><td>轮询 轮询</td></tr><tr><td>polymorphism</td><td>多型 多态</td></tr><tr><td>pop up</td><td>冒起式、弹出式 弹出式</td></tr><tr><td>port</td><td>埠 端口</td></tr><tr><td>postfix</td><td>后置式、后序式 后置式</td></tr><tr><td>precedence</td><td>优先序（通常用於运算子的优先执行次序）</td></tr><tr><td>prefix</td><td>前置式、前序式 前置式</td></tr><tr><td>preprocessor</td><td>前处理器 预处理器</td></tr><tr><td>prime</td><td>质数 素数</td></tr><tr><td>primitive type</td><td>基本型别 (不同於 base class,基础类别)</td></tr><tr><td>print</td><td>列印 打印</td></tr><tr><td>printer</td><td>印表机 打印机</td></tr><tr><td>priority</td><td>优先权 (通常用於执行绪获得 CPU 时间的优先次序）</td></tr><tr><td>procedure</td><td>程序 过程</td></tr><tr><td>procedural</td><td>程序性的、程序式的 过程式的、过程化的</td></tr><tr><td>process</td><td>行程 进程</td></tr><tr><td>profile</td><td>评测 评测</td></tr><tr><td>profiler</td><td>效能（效率）评测器 效能（性能）评测器</td></tr><tr><td>programmer</td><td>程式员 程序员</td></tr><tr><td>programming</td><td>编程、程式设计、程式化 编程</td></tr><tr><td>progress bar</td><td>进度指示器 进度指示器</td></tr><tr><td>project</td><td>专案 项目、工程</td></tr><tr><td>property</td><td>属性</td></tr><tr><td>protocol</td><td>协定 协议</td></tr><tr><td>pseudo code</td><td>假码、虚拟码、伪码 伪码</td></tr></tbody></table><h3 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h3><table><thead><tr><th>qualified</th><th>经过资格修饰（例如加上 scope 运算子） 限定</th></tr></thead><tbody><tr><td>qualifier</td><td>资格修饰词、饰词 限定修饰词</td></tr><tr><td>quality</td><td>品质 质量</td></tr><tr><td>queue</td><td>伫列 队列</td></tr></tbody></table><h3 id="R"><a href="#R" class="headerlink" title="R"></a>R</h3><table><thead><tr><th>radian</th><th>径度 弧度</th></tr></thead><tbody><tr><td>radio button</td><td>圆钮 单选按钮</td></tr><tr><td>raise</td><td>引发（常用来表示发出一个 exception） 引起、引发</td></tr><tr><td>random number</td><td>随机数、乱数 随机数</td></tr><tr><td>range</td><td>范围、区间（用於 STL 时） 范围、区间</td></tr><tr><td>rank</td><td>等级、分等（ref. C++Primer 3&#x2F;e 9,15章） 等级</td></tr><tr><td>raw</td><td>生鲜的、未经处理的 未经处理的</td></tr><tr><td>record</td><td>记录 记录</td></tr><tr><td>recordset</td><td>记录集 记录集</td></tr><tr><td>recursive</td><td>递回 递归</td></tr><tr><td>re－direction</td><td>重导向 重定向</td></tr><tr><td>refactoring</td><td>重构、重整 重构</td></tr><tr><td>refer</td><td>取用 叁考</td></tr><tr><td>refer to</td><td>指向、指涉、指代</td></tr><tr><td>reference</td><td>（C++ 中类似指标的东西，相当於 “化身”） 引用、叁考 址叁器, see pointer</td></tr><tr><td>register</td><td>暂存器 寄存器</td></tr><tr><td>reflection</td><td>反射 反射、映像</td></tr><tr><td>relational database</td><td>关联式资料库 关系数据库</td></tr><tr><td>represent</td><td>表述，表现 表述，表现</td></tr><tr><td>resolve</td><td>决议（为算式中的符号名称寻找 解析 对应之宣告式的过程）</td></tr><tr><td>resolution</td><td>决议程序、决议过程 解析过程</td></tr><tr><td>resolution</td><td>解析度 分辨率</td></tr><tr><td>restriction</td><td>局限</td></tr><tr><td>return</td><td>传回、回返 返回</td></tr><tr><td>return type</td><td>回返型别 返回类型</td></tr><tr><td>return value</td><td>回返值 返回值</td></tr><tr><td>robust</td><td>强固、稳健 健壮</td></tr><tr><td>robustness</td><td>强固性、稳健性 健壮性</td></tr><tr><td>routine</td><td>常式 例程</td></tr><tr><td>runtime</td><td>执行期 运行期、运行时</td></tr><tr><td>common language runtime</td><td>(CLR) 译为「通用语言执行层」</td></tr><tr><td>rvalue</td><td>右值 右值</td></tr></tbody></table><h3 id="S"><a href="#S" class="headerlink" title="S"></a>S</h3><table><thead><tr><th>save</th><th>储存 存储</th></tr></thead><tbody><tr><td>schedule</td><td>排程 调度</td></tr><tr><td>scheduler</td><td>排程器 调度程序</td></tr><tr><td>scheme</td><td>结构纲目、组织纲目</td></tr><tr><td>scroll bar</td><td>卷轴 滚动条</td></tr><tr><td>scope</td><td>生存空间、生存范围、范畴、<a href="https://www.zhihu.com/search?q=%E4%BD%9C%E7%94%A8%E5%9F%9F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">作用域</a> 生存空间</td></tr><tr><td>scope operator</td><td>生存空间（范围决议）运算子 :: 生存空间操作符</td></tr><tr><td>scope resolution operator</td><td>生存空间决议运算子 生存空间解析操作符 （与scope operator同）</td></tr><tr><td>screen</td><td>萤幕 屏幕</td></tr><tr><td>search</td><td>搜寻 查找</td></tr><tr><td>semantics</td><td>语意 语义</td></tr><tr><td>sequential container</td><td>序列式容器 顺序式容器 （对应於 associative container）</td></tr><tr><td>server</td><td>伺服器、伺服端 服务器、服务端</td></tr><tr><td>serial</td><td>串行</td></tr><tr><td>serialization</td><td>次第读写,<a href="https://www.zhihu.com/search?q=%E5%BA%8F%E5%88%97%E5%8C%96&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2242475745%22%7D">序列化</a> 序列化 (serialize)</td></tr><tr><td>setter</td><td>(相对於 getter) 设值函式</td></tr><tr><td>signal</td><td>信号</td></tr><tr><td>signature</td><td>标记式、签名式、署名式 签名</td></tr><tr><td>slider</td><td>滚轴 滑块</td></tr><tr><td>slot</td><td>条孔、槽 槽</td></tr><tr><td>smart pointer</td><td>灵巧指标、精灵指标 智能指针</td></tr><tr><td>snapshot</td><td>萤幕快照（图） 屏幕截图</td></tr><tr><td>specialization</td><td>特殊化、特殊化定义、特殊化宣告 特化</td></tr><tr><td>specification</td><td>规格 规格、规范</td></tr><tr><td>splitter</td><td>分裂视窗 切分窗口</td></tr><tr><td>software</td><td>软体 软件</td></tr><tr><td>solution</td><td>解法,解决方案 方案</td></tr><tr><td>source</td><td>原始码 源码、源代码</td></tr><tr><td>stack</td><td>堆叠 栈</td></tr><tr><td>stack unwinding</td><td>堆叠辗转开解（此词用於 exception 主题） 栈辗转开解 *</td></tr><tr><td>standard library</td><td>标准程式库</td></tr><tr><td>standard template library</td><td>标准模板程式库</td></tr><tr><td>statement</td><td>述句 语句、声明</td></tr><tr><td>status bar</td><td>状态列、状态栏 状态条</td></tr><tr><td>STL</td><td>见 standard template library</td></tr><tr><td>stream</td><td>资料流、串流 流</td></tr><tr><td>string</td><td>字串 字符串</td></tr><tr><td>subroutine</td><td>子路由</td></tr><tr><td>subscript operator</td><td>下标运算子 [ ] 下标操作符</td></tr><tr><td>subtype</td><td>子型别 子类型</td></tr><tr><td>support</td><td>支援 支持</td></tr><tr><td>suspend</td><td>虚悬 挂起</td></tr><tr><td>symbol</td><td>符号 记号</td></tr><tr><td>syntax</td><td>语法 语法</td></tr></tbody></table><h3 id="T"><a href="#T" class="headerlink" title="T"></a>T</h3><table><thead><tr><th>tag</th><th>标签 标记 索引标签,页签</th></tr></thead><tbody><tr><td>target</td><td>标的（例 target pointer：标的指标） 目标</td></tr><tr><td>task switch</td><td>工作切换 任务切换</td></tr><tr><td>template</td><td>模板、范本 模板</td></tr><tr><td>template argument deduction</td><td>模板引数推导 模板叁数推导</td></tr><tr><td>template explicit specialization</td><td>模板显式特化（版本） 模板显式特化</td></tr><tr><td>template parameter</td><td>模板叁数 模板叁数</td></tr><tr><td>temporary object</td><td>暂时物件 临时对象</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> En </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> 英语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Curl 请求 Https</title>
      <link href="/%E6%89%8B%E5%86%8C/Curl/curl%E8%AF%B7%E6%B1%82https/"/>
      <url>/%E6%89%8B%E5%86%8C/Curl/curl%E8%AF%B7%E6%B1%82https/</url>
      
        <content type="html"><![CDATA[<p>使用 curl 发送 https 请求时，如下命令就会报错：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &quot;https://www.baidu.com&quot;</span><br></pre></td></tr></table></figure><p>错误代码：</p><div style="background:black;font:conloas;color:white;">curl: (60) SSL certificate problem: unable to get local issuer certificateMore details here: https://curl.haxx.se/docs/sslcerts.html </div><p>一般的解决办法就是下载CA证书。但是使用C++代码调用 <code>libcurl</code> 发送 https 请求，只需要在设置一下这个就可以关闭 ssl 验证，从而能够发送 https 请求。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">curl_easy_setopt</span>(curl, CURLOPT_SSL_VERIFYPEER, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
          <category> Curl </category>
          
      </categories>
      
      
        <tags>
            
            <tag> curl </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CMakeList</title>
      <link href="/%E6%89%8B%E5%86%8C/CMake%E4%BD%BF%E7%94%A8/"/>
      <url>/%E6%89%8B%E5%86%8C/CMake%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： CMake 使用手册</p></blockquote><p>[toc]</p><h1 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 手册 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>使用 osquery 查询系统uuid和系统信息</title>
      <link href="/%E5%B7%A5%E5%85%B7/osquery/%E6%9F%A5%E8%AF%A2uuid%E5%92%8C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/"/>
      <url>/%E5%B7%A5%E5%85%B7/osquery/%E6%9F%A5%E8%AF%A2uuid%E5%92%8C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="查询uuid"><a href="#查询uuid" class="headerlink" title="查询uuid"></a>查询uuid</h1><h2 id="方法一-见查询信息"><a href="#方法一-见查询信息" class="headerlink" title="方法一 见查询信息"></a>方法一 见<a href="#sysinfo">查询信息</a></h2><h2 id="方法二-通过注册表"><a href="#方法二-通过注册表" class="headerlink" title="方法二 通过注册表"></a>方法二 通过注册表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> data <span class="keyword">from</span> registry <span class="keyword">where</span> key <span class="operator">=</span><span class="string">&#x27;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography&#x27;</span> <span class="keyword">AND</span> name<span class="operator">=</span><span class="string">&#x27;MachineGuid&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> data <span class="keyword">FROM</span> registry <span class="keyword">WHERE</span> path<span class="operator">=</span><span class="string">&#x27;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MachineGuid&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://img2023.cnblogs.com/blog/2166070/202307/2166070-20230710100249111-804875540.png" alt="img"></p><h1 id="查询系统版本号和windows版本"><a href="#查询系统版本号和windows版本" class="headerlink" title="查询系统版本号和windows版本"></a>查询系统版本号和windows版本</h1><h2 id="方法一-直接查询"><a href="#方法一-直接查询" class="headerlink" title="方法一 直接查询"></a>方法一 <a id="sysinfo"></a>直接查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uuid, computer_name, hardware_model, hardware_serial <span class="keyword">FROM</span> system_info;</span><br></pre></td></tr></table></figure><p><img src="https://img2023.cnblogs.com/blog/2166070/202307/2166070-20230710100234639-1950797265.png" alt="img"></p><h2 id="方法二-通过注册表-1"><a href="#方法二-通过注册表-1" class="headerlink" title="方法二 通过注册表"></a>方法二 通过注册表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> data </span><br><span class="line"><span class="keyword">FROM</span> registry </span><br><span class="line"><span class="keyword">WHERE</span> key <span class="operator">=</span> <span class="string">&#x27;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> name <span class="keyword">IN</span>(<span class="string">&#x27;CurrentMajorVersionNumber&#x27;</span>,<span class="string">&#x27;CurrentMinorVersionNumber&#x27;</span>, <span class="string">&#x27;CurrentBuildNumber&#x27;</span>, <span class="string">&#x27;ProductName&#x27;</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">   <span class="keyword">CASE</span> name</span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;ProductName&#x27;</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;CurrentMajorVersionNumber&#x27;</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;CurrentMinorVersionNumber&#x27;</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;CurrentBuildNumber&#x27;</span> <span class="keyword">THEN</span> <span class="number">4</span></span><br><span class="line">      <span class="keyword">ELSE</span> <span class="number">3</span></span><br><span class="line">   <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p><img src="https://img2023.cnblogs.com/blog/2166070/202307/2166070-20230710100158910-1063727182.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
          <category> osquery </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> osquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动生成 readme 文档</title>
      <link href="/%E5%B7%A5%E5%85%B7/ReadneGenerator/"/>
      <url>/%E5%B7%A5%E5%85%B7/ReadneGenerator/</url>
      
        <content type="html"><![CDATA[<blockquote><p>开源地址： <a href="https://github.com/kefranabg/readme-md-generator">https://github.com/kefranabg/readme-md-generator</a></p></blockquote><p>自动生成 readme 的开源工具</p><p>安装方式：npm i -g readme-md-generator</p><p>npm版本要大于8</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%B7%A5%E5%85%B7/images/ReadneGenerator/readme-generate.jpeg" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> readme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用SM3加密文件</title>
      <link href="/%E5%B7%A5%E5%85%B7/OpenSSL/%E4%BD%BF%E7%94%A8sm3%E5%8A%A0%E5%AF%86%E6%96%87%E4%BB%B6/"/>
      <url>/%E5%B7%A5%E5%85%B7/OpenSSL/%E4%BD%BF%E7%94%A8sm3%E5%8A%A0%E5%AF%86%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>以下是使用 OpenSSL 库进行 SM3 消息摘要和文件加密的 C++ 示例代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/evp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/sha.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/sm3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算字符串的 SM3 摘要值</span></span><br><span class="line"><span class="function">std::string <span class="title">sm3_hash_string</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> md[SM3_DIGEST_LENGTH];</span><br><span class="line">    <span class="built_in">SM3</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*&gt;(str.<span class="built_in">data</span>()), str.<span class="built_in">size</span>(), md);</span><br><span class="line">    <span class="function">std::string <span class="title">hash_str</span><span class="params">(<span class="keyword">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(md), SM3_DIGEST_LENGTH)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> hash_str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算文件的 SM3 摘要值</span></span><br><span class="line"><span class="function">std::string <span class="title">sm3_hash_file</span><span class="params">(<span class="type">const</span> std::string&amp; file_path)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> md[SM3_DIGEST_LENGTH];</span><br><span class="line">    <span class="function">std::ifstream <span class="title">input</span><span class="params">(file_path, std::ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (input) &#123;</span><br><span class="line">        EVP_MD_CTX* mdctx = <span class="built_in">EVP_MD_CTX_new</span>();</span><br><span class="line">        <span class="built_in">EVP_DigestInit_ex</span>(mdctx, <span class="built_in">EVP_sm3</span>(), <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> buf_size = <span class="number">4096</span>;</span><br><span class="line">        <span class="type">char</span> buf[buf_size];</span><br><span class="line">        <span class="keyword">while</span> (input.<span class="built_in">read</span>(buf, buf_size)) &#123;</span><br><span class="line">            <span class="built_in">EVP_DigestUpdate</span>(mdctx, buf, buf_size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">size_t</span> remain_size = input.<span class="built_in">gcount</span>();</span><br><span class="line">        <span class="built_in">EVP_DigestUpdate</span>(mdctx, buf, remain_size);</span><br><span class="line">        <span class="built_in">EVP_DigestFinal_ex</span>(mdctx, md, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">EVP_MD_CTX_free</span>(mdctx);</span><br><span class="line">        input.<span class="built_in">close</span>();</span><br><span class="line">        <span class="function">std::string <span class="title">hash_str</span><span class="params">(<span class="keyword">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(md), SM3_DIGEST_LENGTH)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> hash_str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;fail to open file &quot;</span> + file_path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用密码对文件进行加密</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt_file</span><span class="params">(<span class="type">const</span> std::string&amp; input_file_path, <span class="type">const</span> std::string&amp; output_file_path, <span class="type">const</span> std::string&amp; password)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">input</span><span class="params">(input_file_path, std::ios::binary)</span></span>;</span><br><span class="line">    <span class="function">std::ofstream <span class="title">output</span><span class="params">(output_file_path, std::ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (input &amp;&amp; output) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> key_len = EVP_MAX_KEY_LENGTH;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> iv_len = EVP_MAX_IV_LENGTH;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> key[key_len];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> iv[iv_len];</span><br><span class="line">        <span class="built_in">EVP_BytesToKey</span>(<span class="built_in">EVP_aes_256_cbc</span>(), <span class="built_in">EVP_sm3</span>(), <span class="literal">nullptr</span>, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*&gt;(password.<span class="built_in">data</span>()), password.<span class="built_in">size</span>(), <span class="number">1</span>, key, iv);</span><br><span class="line">        EVP_CIPHER_CTX* ctx = <span class="built_in">EVP_CIPHER_CTX_new</span>();</span><br><span class="line">        <span class="built_in">EVP_EncryptInit_ex</span>(ctx, <span class="built_in">EVP_aes_256_cbc</span>(), <span class="literal">nullptr</span>, key, iv);</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> buf_size = <span class="number">4096</span>;</span><br><span class="line">        <span class="type">char</span> buf[buf_size];</span><br><span class="line">        <span class="keyword">while</span> (input.<span class="built_in">read</span>(buf, buf_size)) &#123;</span><br><span class="line">            <span class="type">int</span> len = input.<span class="built_in">gcount</span>();</span><br><span class="line">            <span class="type">int</span> out_len = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">EVP_EncryptUpdate</span>(ctx, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>*&gt;(buf), &amp;out_len, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>*&gt;(buf), len);</span><br><span class="line">            output.<span class="built_in">write</span>(buf, out_len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> len = input.<span class="built_in">gcount</span>();</span><br><span class="line">        <span class="type">int</span> out_len = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">EVP_EncryptFinal_ex</span>(ctx, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>*&gt;(buf), &amp;out_len);</span><br><span class="line">        output.<span class="built_in">write</span>(buf, out_len);</span><br><span class="line">        <span class="built_in">EVP_CIPHER_CTX_free</span>(ctx);</span><br><span class="line">        input.<span class="built_in">close</span>();</span><br><span class="line">        output.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;fail to open input/output file.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string str = <span class="string">&quot;message to be hashed&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;SM3 hash of string \&quot;&quot;</span> &lt;&lt; str &lt;&lt; <span class="string">&quot;\&quot;: &quot;</span> &lt;&lt; <span class="built_in">sm3_hash_string</span>(str) &lt;&lt; std::endl;</span><br><span class="line">    std::string file_path = <span class="string">&quot;test.txt&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;SM3 hash of file \&quot;&quot;</span> &lt;&lt; file_path &lt;&lt; <span class="string">&quot;\&quot;: &quot;</span> &lt;&lt; <span class="built_in">sm3_hash_file</span>(file_path) &lt;&lt; std::endl;</span><br><span class="line">    std::string password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">encrypt_file</span>(file_path, <span class="string">&quot;test_encrypted.txt&quot;</span>, password);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码中，使用 SM3 函数对字符串或文件内容进行摘要；使用 EVP_BytesToKey 函数生成密码加密密钥和初始化向量，并使用 EVP_EncryptInit_ex 函数初始化加密上下文，在循环中调用 EVP_EncryptUpdate 函数对文件进行逐块加密，最后调用 EVP_EncryptFinal_ex 函数完成加密过程，将结果写入新的加密文件中。</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
          <category> OpenSSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 加密 </tag>
            
            <tag> SM3 </tag>
            
            <tag> OpenSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/index/"/>
      <url>/index/</url>
      
        <content type="html"><![CDATA[<p>学习|记录|分享</p><p>🤗🙂🤩🤔🤨😗🥰😘😀😁😂🤣😃😄😅😆😗🥰😘😍😎😋😊😉😙😚😐😑😶🙄🙂🤗😏🤩😣🤔😥🤨😮😛😌😴😫🥱😪😯🤐😜😝🤤😒😓😔😕🙃🤑😲☹🙁😞😖😟😤😬🤯😩😨😧😦😭😢😰😱🥵🥶😳🤪😵🥴🤮🤢🤕🤒😷🤬😡😠🤧😇🥳🥺🤠🤡🤥🤫💀👺👹👿😈🤓🧐🤭☠👻👽👾🤖💩😺😸🐱‍👤😾😿🙀😽😼😻😹</p><blockquote><p>个人维护的wiki，涉及工作、学习中用到的技术和方案以及工具</p></blockquote><p><a href="https://holdyounger.github.io/resume/?template=template1&user=holdyounger">我的简历</a></p><p><a href="readme">📚 文章列表</a></p><p><a href="../../xmind/">👉 Xmind文件</a></p><p><a href="../../music/">🎵 音乐</a></p><p><a href="../../Cover/">🎨 封面</a></p><p><a href="../../resour/">🔎 资源</a></p><p><a href="../../UML/">🎨 UML</a></p><p><a href="../../Demo/">📺 Code</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/readme/"/>
      <url>/readme/</url>
      
        <content type="html"><![CDATA[<p><a href="../index">🏠 返回</a></p><h1 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/143">Qt 鼠标 hover 操作时弹出文字气泡</a></li><li><a href="https://github.com/holdyounger/Issue/issues/142">Qt Http 下载（转载）</a></li><li><a href="https://github.com/holdyounger/Issue/issues/141">png和jpg格式的图片(二)</a></li><li><a href="https://github.com/holdyounger/Issue/issues/140">Qt 重启</a></li><li><a href="https://github.com/holdyounger/Issue/issues/125">Qt 圆形进度条</a></li><li><a href="https://github.com/holdyounger/Issue/issues/124">Qt动画类</a></li><li><a href="https://github.com/holdyounger/Issue/issues/123">Qt获取控件位置</a></li><li><a href="https://github.com/holdyounger/Issue/issues/122">Qt 截图</a></li><li><a href="https://github.com/holdyounger/Issue/issues/121">Qt在Win系统上的消息通知</a></li><li><a href="https://github.com/holdyounger/Issue/issues/120">Qt 自定义气泡</a></li><li><a href="https://github.com/holdyounger/Issue/issues/127">Qt插件——使用 QtCipherSqlitePlugin 对数据库进行加密</a></li><li><a href="https://github.com/holdyounger/Issue/issues/110">Qt常用基础代码汇总</a></li><li><a href="https://github.com/holdyounger/Issue/issues/116">QListWidget 用法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/119">【一文搞懂】qss</a></li><li><a href="https://github.com/holdyounger/Issue/issues/118">使用 QWebEngineView 加载网页慢的问题</a></li><li><a href="https://github.com/holdyounger/Issue/issues/117">窗体不显示或半透明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/77">QTableWidget 遍历</a></li><li><a href="https://github.com/holdyounger/Issue/issues/75">Qt窗口适配系统缩放</a></li><li><a href="https://github.com/holdyounger/Issue/issues/74">QLineEdit 修改部分文本样式</a></li><li><a href="https://github.com/holdyounger/Issue/issues/73">QStackWidget动画2</a></li><li><a href="https://github.com/holdyounger/Issue/issues/72">Qt 因为槽函数问题或者逻辑问题导致重复new问题解决办法及建议</a></li><li><a href="https://github.com/holdyounger/Issue/issues/71">Qt任务栏显示进度条</a></li><li><a href="https://github.com/holdyounger/Issue/issues/70">QStackWidget动画（1）</a></li><li><a href="https://github.com/holdyounger/Issue/issues/69">Qt 启动动画</a></li><li><a href="https://github.com/holdyounger/Issue/issues/68">Qt 动画效果 （抖动、下坠、透明度）</a></li><li><a href="https://github.com/holdyounger/Issue/issues/43">Qt事件过滤器（eventFilter）</a></li><li><a href="https://github.com/holdyounger/Issue/issues/42">Qt图片旋转</a></li><li><a href="https://github.com/holdyounger/Issue/issues/41">Qt 窗口居中显示</a></li><li><a href="https://github.com/holdyounger/Issue/issues/40">Qt实现窗口拖拽</a></li><li><a href="https://github.com/holdyounger/Issue/issues/39">Qt 国际化</a></li></ol><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/133">Linux RPC</a></li><li><a href="https://github.com/holdyounger/Issue/issues/132">Linux查询是否安装了某个软件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/131">5 环境变量与文件查找</a></li><li><a href="https://github.com/holdyounger/Issue/issues/130">Linux基础入门15 Linux进程概念</a></li><li><a href="https://github.com/holdyounger/Issue/issues/67">Linux内核2 跟踪分析Linux内核的启动过程</a></li><li><a href="https://github.com/holdyounger/Issue/issues/66">ls命令详解</a></li><li><a href="https://github.com/holdyounger/Issue/issues/65">Linux 内核分析配套实验</a></li><li><a href="https://github.com/holdyounger/Issue/issues/64">linux 内核1 完成一个简单的时间片轮转躲到程序内核代码</a></li></ol><h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/111">Readme 工具使用手册</a></li><li><a href="https://github.com/holdyounger/Issue/issues/138">自动生成 readme 文档</a></li></ol><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/59">Procmon 过滤用法</a></li><li><a href="https://github.com/holdyounger/Issue/issues/58">Win7 使用未签名驱动程序</a></li><li><a href="https://github.com/holdyounger/Issue/issues/57">FormatMessage函数的使用</a></li><li><a href="https://github.com/holdyounger/Issue/issues/56">Windows聚焦不更新</a></li><li><a href="https://github.com/holdyounger/Issue/issues/55">监控系统事件（网卡）</a></li><li><a href="https://github.com/holdyounger/Issue/issues/106">winuser说明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/105">cmd——route</a></li><li><a href="https://github.com/holdyounger/Issue/issues/113">热补丁支持</a></li><li><a href="https://github.com/holdyounger/Issue/issues/109">网络连接事件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/108">监控路由事件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/107">一个完整的wfp驱动</a></li><li><a href="https://github.com/holdyounger/Issue/issues/104">提权工具 psExec.exe</a></li><li><a href="https://github.com/holdyounger/Issue/issues/103">批处理获取ip到剪切板</a></li><li><a href="https://github.com/holdyounger/Issue/issues/102">服务中以管理员&amp;#92;普通权限启动进程</a></li><li><a href="https://github.com/holdyounger/Issue/issues/101">Windows 降权</a></li><li><a href="https://github.com/holdyounger/Issue/issues/100">使用 UMDH 定位用户模式内存泄漏</a></li><li><a href="https://github.com/holdyounger/Issue/issues/99">iphepler 接口整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/98">提权</a></li><li><a href="https://github.com/holdyounger/Issue/issues/97">监控指定网卡事件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/96">C++ 通过 COM 组件 启用&amp;#92;禁用&amp;#92;查看 网卡状态</a></li><li><a href="https://github.com/holdyounger/Issue/issues/95">操作网卡类</a></li><li><a href="https://github.com/holdyounger/Issue/issues/94">监控网卡事件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/93">使用 winsock2 相关函数</a></li><li><a href="https://github.com/holdyounger/Issue/issues/61">加载动态库 (loadlibrary)</a></li><li><a href="https://github.com/holdyounger/Issue/issues/134">windows 查看进程启动参数命令行</a></li><li><a href="https://github.com/holdyounger/Issue/issues/25">【管道】（二） 管道通信</a></li><li><a href="https://github.com/holdyounger/Issue/issues/24">【管道】（一） 初识管道</a></li></ol><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/115">字符串类型转换整理(char、TCHAR、string、wstring、CString、WCHAR)</a></li><li><a href="https://github.com/holdyounger/Issue/issues/114">密钥分配</a></li><li><a href="https://github.com/holdyounger/Issue/issues/112">第7章 网络安全</a></li><li><a href="https://github.com/holdyounger/Issue/issues/92">常用写法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/91">内存泄漏分析实战</a></li><li><a href="https://github.com/holdyounger/Issue/issues/90">友元</a></li><li><a href="https://github.com/holdyounger/Issue/issues/89">UML 片段说明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/88">配置多个账号</a></li><li><a href="https://github.com/holdyounger/Issue/issues/87">3-hexo 主题快捷键</a></li><li><a href="https://github.com/holdyounger/Issue/issues/86">函数声明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/84">&lt;2&gt; const 关键字</a></li><li><a href="https://github.com/holdyounger/Issue/issues/83">&lt;3&gt; 确定对象使用前初始化</a></li><li><a href="https://github.com/holdyounger/Issue/issues/82">返回值类型的规范</a></li><li><a href="https://github.com/holdyounger/Issue/issues/81">&lt;4&gt; 了解C++默认创建并调用的函数</a></li><li><a href="https://github.com/holdyounger/Issue/issues/80">OSI参考模型</a></li><li><a href="https://github.com/holdyounger/Issue/issues/79">三黑豆浆</a></li><li><a href="https://github.com/holdyounger/Issue/issues/78">C++ 枚举</a></li><li><a href="https://github.com/holdyounger/Issue/issues/76">typora bluebook 自定义修改主题代码</a></li><li><a href="https://github.com/holdyounger/Issue/issues/63">tcp.flags 说明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/62">Xcode 下载与安装</a></li><li><a href="https://github.com/holdyounger/Issue/issues/60">UnSplash 获取随机图片的API</a></li><li><a href="https://github.com/holdyounger/Issue/issues/54">系统锁</a></li><li><a href="https://github.com/holdyounger/Issue/issues/53">管道demo</a></li><li><a href="https://github.com/holdyounger/Issue/issues/52">libevent——evconnlistener_new_bind(1)</a></li><li><a href="https://github.com/holdyounger/Issue/issues/51">《深入理解Windows操作系统》一书附录中英语单词整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/50">Curl 请求 Https</a></li><li><a href="https://github.com/holdyounger/Issue/issues/37">正则表达式反向引用</a></li><li><a href="https://github.com/holdyounger/Issue/issues/36">切换shell</a></li><li><a href="https://github.com/holdyounger/Issue/issues/35">IPv6</a></li><li><a href="https://github.com/holdyounger/Issue/issues/34">socket 长连接</a></li><li><a href="https://github.com/holdyounger/Issue/issues/33">TCP&#x2F;IP的四元组、五元组、七元组</a></li><li><a href="https://github.com/holdyounger/Issue/issues/32">Curl使用的一些demo，记录</a></li><li><a href="https://github.com/holdyounger/Issue/issues/31">临时文件</a></li><li><a href="https://github.com/holdyounger/Issue/issues/30">png和jpg格式的图片(一)</a></li><li><a href="https://github.com/holdyounger/Issue/issues/29">自然辩证法</a></li><li><a href="https://github.com/holdyounger/Issue/issues/28">QAction Icon 大小问题</a></li><li><a href="https://github.com/holdyounger/Issue/issues/27">文件大小换算方法</a></li><li><a href="https://github.com/holdyounger/Issue/issues/26">GO HACK PE文件分析</a></li><li><a href="https://github.com/holdyounger/Issue/issues/23">try-catch块</a></li><li><a href="https://github.com/holdyounger/Issue/issues/22">Lambda表达式</a></li><li><a href="https://github.com/holdyounger/Issue/issues/21">using 用法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/20">动态声明子类</a></li><li><a href="https://github.com/holdyounger/Issue/issues/19">各种宏定义用法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/18">文件后缀校验</a></li><li><a href="https://github.com/holdyounger/Issue/issues/17">Json11 C++ 用法总结</a></li><li><a href="https://github.com/holdyounger/Issue/issues/16">⏰ 时间处理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/15">visual studio 编译告警常见处理手段</a></li><li><a href="https://github.com/holdyounger/Issue/issues/14">TypeScript</a></li><li><a href="https://github.com/holdyounger/Issue/issues/13">中国马克思主义科学技术观</a></li><li><a href="https://github.com/holdyounger/Issue/issues/12">TODO</a></li><li><a href="https://github.com/holdyounger/Issue/issues/4">using 用法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/3">动态声明子类</a></li><li><a href="https://github.com/holdyounger/Issue/issues/2">各种宏定义用法整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/1">文件后缀校验</a></li><li><a href="https://github.com/holdyounger/Issue/issues/137">【不敢说一文搞懂】VLD 内存泄漏定位</a></li><li><a href="https://github.com/holdyounger/Issue/issues/136">共享文件夹</a></li><li><a href="https://github.com/holdyounger/Issue/issues/129">libevent http server</a></li><li><a href="https://github.com/holdyounger/Issue/issues/128">OSI七层网络协议模型各层协议</a></li><li><a href="https://github.com/holdyounger/Issue/issues/126">音频房间创建及连接说明</a></li><li><a href="https://github.com/holdyounger/Issue/issues/139">声网参赛经历记录——白板插件开发(前端)</a></li></ol><h1 id="手册"><a href="#手册" class="headerlink" title="手册"></a>手册</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/11">代码规范</a></li><li><a href="https://github.com/holdyounger/Issue/issues/10">git emoji手册</a></li><li><a href="https://github.com/holdyounger/Issue/issues/9">Typora Emoji</a></li><li><a href="https://github.com/holdyounger/Issue/issues/8">Visual Assist 快捷键整理</a></li><li><a href="https://github.com/holdyounger/Issue/issues/7">前端样式配置 style</a></li><li><a href="https://github.com/holdyounger/Issue/issues/6">常用变量名缩写</a></li><li><a href="https://github.com/holdyounger/Issue/issues/5">写作协作手册</a></li><li><a href="https://github.com/holdyounger/Issue/issues/49">Git 速查手册</a></li><li><a href="https://github.com/holdyounger/Issue/issues/48">常见编程命名缩写</a></li><li><a href="https://github.com/holdyounger/Issue/issues/47">编程常用英语词汇</a></li><li><a href="https://github.com/holdyounger/Issue/issues/46">winDbg 调试手册</a></li><li><a href="https://github.com/holdyounger/Issue/issues/45">英雄联盟语录</a></li><li><a href="https://github.com/holdyounger/Issue/issues/44">随机字符串</a></li><li><a href="https://github.com/holdyounger/Issue/issues/38">SQLite3 数据库加密</a></li></ol><h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/85">Wiki自动更新脚本</a></li></ol><h1 id="CPP"><a href="#CPP" class="headerlink" title="CPP"></a>CPP</h1><ol><li><a href="https://github.com/holdyounger/Issue/issues/135">C++ 常见错误——无法解析的外部符号</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>代码规范</title>
      <link href="/QIANXIN/safecode/"/>
      <url>/QIANXIN/safecode/</url>
      
        <content type="html"><![CDATA[<h1 id="TrustClient-相关"><a href="#TrustClient-相关" class="headerlink" title="TrustClient 相关"></a>TrustClient 相关</h1><h2 id="1）-win-api使用宏控制"><a href="#1）-win-api使用宏控制" class="headerlink" title="1） win api使用宏控制"></a>1） win api使用宏控制</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> Q_OS_WIN</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h1 id="内存相关"><a href="#内存相关" class="headerlink" title="内存相关"></a>内存相关</h1><h2 id="函数段"><a href="#函数段" class="headerlink" title="函数段"></a>函数段</h2><ol><li>申请内存</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">zallloc</span><span class="params">(<span class="type">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">void</span> *p = <span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="keyword">if</span>(p) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(p, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="常用的宏"><a href="#常用的宏" class="headerlink" title="常用的宏"></a>常用的宏</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> safe_free(p) &#123;\</span></span><br><span class="line"><span class="meta">free(p);\</span></span><br><span class="line"><span class="meta">p = NULL;\</span></span><br><span class="line"><span class="meta">&#125;\</span></span><br></pre></td></tr></table></figure><h1 id="线程的资源竞争"><a href="#线程的资源竞争" class="headerlink" title="线程的资源竞争"></a>线程的资源竞争</h1><ol><li>对<code>链表、边界资源、临界区域</code>的操作一定要<mark style="background-color:red">加锁</mark></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::mutex mtx; <span class="comment">// 保护counter</span></span><br><span class="line"></span><br><span class="line">mtx.<span class="built_in">lock</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要进行的资源操作</span></span><br><span class="line"><span class="built_in">todo</span>();</span><br><span class="line"></span><br><span class="line">mtx.<span class="built_in">unlock</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> QIANXIN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TODO</title>
      <link href="/TODO/index/"/>
      <url>/TODO/index/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><hr><h1 id="reinterpret-cast-lt-gt"><a href="#reinterpret-cast-lt-gt" class="headerlink" title="reinterpret_cast&lt;&gt;()"></a>reinterpret_cast&lt;&gt;()</h1><blockquote><ol><li>2022年7月20日18:07:34</li></ol></blockquote><h1 id="declspec-selectany"><a href="#declspec-selectany" class="headerlink" title="__declspec(selectany)"></a>__declspec(selectany)</h1><blockquote><ol><li>2022年7月20日18:08:56</li></ol></blockquote><h1 id="qt-http-上传和下载资源的进度条显示"><a href="#qt-http-上传和下载资源的进度条显示" class="headerlink" title="qt http 上传和下载资源的进度条显示"></a>qt http 上传和下载资源的进度条显示</h1><blockquote><ol><li><blockquote><p>2022年7月20日18:09:11 关于qt的http上传和下载资源的进度条显示_yangkping123的博客-CSDN博客<br><a href="https://blog.csdn.net/yangkping123/article/details/46804181?utm_source=blogxgwz5">https://blog.csdn.net/yangkping123/article/details/46804181?utm_source=blogxgwz5</a></p></blockquote></li><li><p>2022年7月20日18:09:28</p></li></ol></blockquote><h1 id="windows-DEP"><a href="#windows-DEP" class="headerlink" title="windows DEP"></a>windows DEP</h1><blockquote><p>2022年7月20日18:00:14</p></blockquote><h1 id="qt第五个参数"><a href="#qt第五个参数" class="headerlink" title="qt第五个参数"></a>qt第五个参数</h1><blockquote><ol><li>2022年7月20日18:10:00</li><li></li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> TODO </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>rapidjson 使用整理</title>
      <link href="/OpenSource/RapidJson/"/>
      <url>/OpenSource/RapidJson/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述: rapidjson使用整理</p></blockquote><p><a href="http://rapidjson.org/zh-cn/">RapidJSON: 首页</a></p><p>[toc]</p>]]></content>
      
      
      <categories>
          
          <category> OpenSource </category>
          
      </categories>
      
      
        <tags>
            
            <tag> json </tag>
            
            <tag> opensource </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnSplash 获取随机图片的API</title>
      <link href="/OpenSource/API/Unsplash%20API/"/>
      <url>/OpenSource/API/Unsplash%20API/</url>
      
        <content type="html"><![CDATA[<p>我经常会使用 unsplash， 这里面的图片非常清爽，我的大多数文章的图片都是在这个网上找的，虽然也有同类型网站，但是用过一段时间以后基本都放弃了，图片质量参差不齐，筛选过程太费劲。</p><p>但是 unsplash 访问速度是个大问题，我经常会因为图片无法加载而被劝退。</p><p>今天一时手痒，顺手搜了 unsplash api 这个关键字，看官方有没有提供相关的 api 服务，还真有！</p><p>unsplash 提供了 2 个版本的 API。 一个是简单版，主要是给小型应用，流量比较少的 app 使用，可以通过 source.unsplash.com 进入；一个是进阶版的开发者中心 API, 支持更多流量的 app 使用，可以通过 unsplash.com&#x2F;developers 进入。</p><h3 id="Source-API"><a href="#Source-API" class="headerlink" title="Source API"></a>Source API</h3><p>source api 提供的功能比较简单。如果想获取一张随机图片，可以访问地址：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/random</span><br></pre></td></tr></table></figure><p>这个地址会重定向到一张图片的地址，可以通过响应直接获取到一张图片。</p><p>如果图片太大，加载速度也会比较慢。你可以在 url 后面添加尺寸，控制返回的图片大小：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/random/800x600</span><br></pre></td></tr></table></figure><p>如果原图片不是这种长宽比，unsplash 会对图片进行裁剪，某些部分就会丢失。如果你想保持图片的原始比例，可以把高度设成 0 ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/random/800x0</span><br></pre></td></tr></table></figure><blockquote><p>小提示</p><p>无论是什么 API, 你都可以在最后使用 &#x2F;800x0 这样的方式控制图片的大小。</p></blockquote><p>你可以指定获取某位作者的图片。比如我特别喜欢 Raamin ka 拍摄的照片。</p><p>我可以把它的用户名小写以后再去掉空格，添加到 &#x2F;user 的后面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/user/raaminka</span><br></pre></td></tr></table></figure><p>这样我就能获取到这位作者拍摄的随机妹子照片了。不要忘了，你同样是可以控制图片尺寸的。</p><p>获取某个用户喜欢的照片：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/user/raaminka/like</span><br></pre></td></tr></table></figure><p>unsplash api 还支持搜索。通常来说，我都会根据要写的文章的主题在 unsplash 上搜索图片。比如我要写一篇关于加密的文章，那我就会去搜索 encryption 相关的图片：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/800x0/?encryption</span><br></pre></td></tr></table></figure><p>你也可以组合多个不同的关键字。如果没有图片同时包含这些关键字，则会优先匹配最后的关键字。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/800x0/?encryption,girl</span><br></pre></td></tr></table></figure><p>现在我们每次访问同一个 API, 得到图片都不一样，因为是随机生成的。但是如果我们在每个 API 的后面添加 &#x2F;daily 或者 &#x2F;weekly， 则可以得到固定的一张图。需要注意，这并不是说这些图片更加热门或者质量更高，只是每天&#x2F;每周保持不变的随机图片而已。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://source.unsplash.com/800x0/daily?sports</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OpenSource </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片 </tag>
            
            <tag> 资源 </tag>
            
            <tag> Unsplash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libevent——evconnlistener_new_bind(1)</title>
      <link href="/OpenSource/libevent/evconnlistener_new_bind(1)/"/>
      <url>/OpenSource/libevent/evconnlistener_new_bind(1)/</url>
      
        <content type="html"><![CDATA[<p>libevent封装了监听套接字，将套接字和<code>struct event</code>统一管理。</p><p>官方的解释是：</p><blockquote><p>The evonnlistener mechanism gives you a way to listen for and accept incoming TCP connections</p></blockquote><p>首先还是学习怎么去使用<code>evconnlistener</code></p><h2 id="（一）接口"><a href="#（一）接口" class="headerlink" title="（一）接口"></a>（一）接口</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evconnlistener</span> *<span class="built_in">evconnlistener_new</span>(<span class="keyword">struct</span> event_base*base,evconnlistener_cb cb,</span><br><span class="line"><span class="type">void</span> *ptr,<span class="type">unsigned</span> flags ,<span class="type">int</span> backlog,<span class="type">evutil_socket_t</span> fd);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evconnlistener</span>*<span class="built_in">evconnlistener_new_bind</span>(<span class="keyword">struct</span> event_base*base,evconnlistener_cb cb,</span><br><span class="line"><span class="type">void</span> *ptr,<span class="type">unsigned</span> flags,<span class="type">int</span> backlog,<span class="type">const</span> <span class="keyword">struct</span> sockaddr*sa,<span class="type">int</span> socklen);</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">evconnlistener_free</span><span class="params">(<span class="keyword">struct</span> evconnlistener*lev)</span></span></span><br><span class="line"><span class="function"><span class="comment">//其中callback的定义如下：</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*evconnlistener_cb)</span><span class="params">(<span class="keyword">struct</span> evconnlistener *listener,<span class="type">evutil_socket_t</span> sock,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">struct</span> sockaddr*addr,<span class="type">int</span> len,<span class="type">void</span> *ptr)</span></span>;</span><br><span class="line"><span class="comment">//enable 和 disable</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">evconnlistener_disable</span><span class="params">(<span class="keyword">struct</span> evconnlistener *lev)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">evconnlistener_enable</span><span class="params">(<span class="keyword">struct</span> evconnlistener *lev)</span></span>;</span><br><span class="line"><span class="comment">//调整callback</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">evconnlistener_set_cb</span><span class="params">(<span class="keyword">struct</span> evconnlistener*lev,evconnlistener_cb cb,<span class="type">void</span> *arg)</span></span></span><br><span class="line"><span class="function"><span class="comment">//检查evconnlistener</span></span></span><br><span class="line"><span class="function"><span class="type">evutil_socket_t</span> <span class="title">evconnlistener_get_fd</span><span class="params">(<span class="keyword">struct</span> evconnlistener *lev)</span></span></span><br><span class="line"><span class="function"><span class="keyword">struct</span> event_base *<span class="title">evconnlistener_get_base</span><span class="params">(<span class="keyword">struct</span> evconnlistener*lev)</span></span></span><br></pre></td></tr></table></figure><p><code>evconnlistener</code>是对  <u>套接字和<code>event</code></u> 的封装，可以想见，在这些接口中，除了调用<code>socket api</code>之外，还会关联套接子到<code>event</code>上进而注册到<code>event_base</code>上去</p><p>不过接口封装好了这些行为，只需要了解这些参数的含义即可。</p><blockquote><p>base：即event_base<br>cb：当有新连接时调用的回调函数<br>ptr：callback的参数<br>flags：控制listner的行为<br>backlog：同 listen(2)中backlog的含义<br>fd：已经bind的fd，传入api让libevent做listen调用</p></blockquote><h2 id="（二）例子"><a href="#（二）例子" class="headerlink" title="（二）例子"></a>（二）例子</h2><p>使用<code>evconnlistener</code>管理监听套接字构建一个简单的 <mark>echo server</mark><br>代码也可参考gayhub</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;event2/listener.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;event2/bufferevent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;event2/buffer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> </span></span><br><span class="line"><span class="function"><span class="title">echo_read_cb</span><span class="params">(<span class="keyword">struct</span> bufferevent*bev,<span class="type">void</span>*ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evbuffer</span>*input=<span class="built_in">bufferevent_get_input</span>(bev);</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evbuffer</span>*output=<span class="built_in">bufferevent_get_output</span>(bev);</span><br><span class="line">    <span class="built_in">evbuffer_add_buffer</span>(output,input);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">echo_event_cb</span><span class="params">(<span class="keyword">struct</span> bufferevent*bev,<span class="type">short</span> events,<span class="type">void</span>*ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(events&amp;BEV_EVENT_ERROR)</span><br><span class="line">    <span class="built_in">perror</span>(<span class="string">&quot;Error from bufferevent&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(events&amp;(BEV_EVENT_EOF|BEV_EVENT_ERROR))</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">bufferevent_free</span>(bev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">accept_error_cb</span><span class="params">(<span class="keyword">struct</span> evconnlistener*listener,<span class="type">void</span>*ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">event_base</span>*base=<span class="built_in">evconnlistener_get_base</span>(listener);</span><br><span class="line">    <span class="built_in">event_base_loopexit</span>(base,<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">accept_conn_cb</span><span class="params">(<span class="keyword">struct</span> evconnlistener*listener,<span class="type">evutil_socket_t</span> fd,<span class="keyword">struct</span> sockaddr*address,<span class="type">int</span> socklen,<span class="type">void</span>*ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">event_base</span>*base=<span class="built_in">evconnlistener_get_base</span>(listener);</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">bufferevent</span>*bev = <span class="built_in">bufferevent_socket_new</span>(base,</span><br><span class="line">        fd,</span><br><span class="line">        BEV_OPT_CLOSE_ON_FREE);</span><br><span class="line">    <span class="built_in">bufferevent_setcb</span>(bev,echo_read_cb,<span class="literal">NULL</span>,echo_event_cb,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">bufferevent_enable</span>(bev,EV_READ|EV_WRITE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>**argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">event_base</span> *base;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evconnlistener</span> *listener;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> sin;</span><br><span class="line">    <span class="type">int</span> port = <span class="number">1025</span>;</span><br><span class="line">    base = <span class="built_in">event_base_new</span>();</span><br><span class="line">    <span class="built_in">assert</span>(base!=<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;sin,<span class="number">0</span>,<span class="built_in">sizeof</span>(sin));</span><br><span class="line">    sin.sin_family=AF_INET;</span><br><span class="line">    sin.sin_addr.s_addr=<span class="built_in">htonl</span>(<span class="number">0</span>);</span><br><span class="line">    sin.sin_port=<span class="built_in">htons</span>(port);</span><br><span class="line">    listener=<span class="built_in">evconnlistener_new_bind</span>(base,<span class="comment">//event_base</span></span><br><span class="line">        accept_conn_cb,<span class="comment">//cb</span></span><br><span class="line">        <span class="literal">NULL</span>,<span class="comment">// ptr</span></span><br><span class="line">        LEV_OPT_CLOSE_ON_FREE|LEV_OPT_REUSEABLE,<span class="comment">//flag</span></span><br><span class="line">        <span class="number">-1</span>,<span class="comment">//backlog</span></span><br><span class="line">        (<span class="keyword">struct</span> sockaddr*)&amp;sin,</span><br><span class="line">        <span class="built_in">sizeof</span>(sin));</span><br><span class="line">    <span class="built_in">assert</span>(listener!=<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">evconnlistener_set_error_cb</span>(listener,accept_error_cb);</span><br><span class="line">    <span class="built_in">event_base_dispatch</span>(base);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="（三）源码"><a href="#（三）源码" class="headerlink" title="（三）源码"></a>（三）源码</h2><p>看看evconnlistenr做了哪些封装</p><h3 id="3-1结构体"><a href="#3-1结构体" class="headerlink" title="3.1结构体"></a><strong>3.1结构体</strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">evconnlistener</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">evconnlistener_ops</span> *ops; <span class="comment">//一些回调函数</span></span><br><span class="line">    <span class="type">void</span> *lock;</span><br><span class="line">    evconnlistener_cb cb;<span class="comment">//</span></span><br><span class="line">    evconnlistener_errorcb errorcb;</span><br><span class="line">    <span class="type">void</span> *user_data;<span class="comment">//</span></span><br><span class="line">    <span class="type">unsigned</span> flags;</span><br><span class="line">    <span class="type">short</span> refcnt;</span><br><span class="line">    <span class="type">unsigned</span> enabled : <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evconnlistener_event</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evconnlistener</span> base;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">event</span> listener;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>evconnlistener</code>结构体将一些基本的回调函数、用户数据等封装，然后<code>evconnlistener_event</code>将这些东西和<code>struct event</code>封装在一起</p><h3 id="3-2创建一个evconnlistener"><a href="#3-2创建一个evconnlistener" class="headerlink" title="3.2创建一个evconnlistener"></a><strong>3.2创建一个evconnlistener</strong></h3><p>看一下初始化有哪些内容：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">evconnlistener</span> *</span><br><span class="line"><span class="built_in">evconnlistener_new</span>(<span class="keyword">struct</span> event_base *base,</span><br><span class="line">    evconnlistener_cb cb, <span class="type">void</span> *ptr, <span class="type">unsigned</span> flags, <span class="type">int</span> backlog,</span><br><span class="line">    <span class="type">evutil_socket_t</span> fd)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evconnlistener_event</span> *lev;</span><br><span class="line">    <span class="keyword">if</span> (backlog &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">listen</span>(fd, backlog) &lt; <span class="number">0</span>)<span class="comment">//调用listen</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (backlog &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">listen</span>(fd, <span class="number">128</span>) &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    lev = <span class="built_in">mm_calloc</span>(<span class="number">1</span>, <span class="built_in">sizeof</span>(<span class="keyword">struct</span> evconnlistener_event));</span><br><span class="line">    <span class="keyword">if</span> (!lev)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">//lev-&gt;base是一个evconnlistener结构体</span></span><br><span class="line">    lev-&gt;base.ops = &amp;evconnlistener_event_ops;<span class="comment">//设置ops参数</span></span><br><span class="line">    lev-&gt;base.cb = cb;<span class="comment">//设置回调</span></span><br><span class="line">    lev-&gt;base.user_data = ptr;<span class="comment">//ptr</span></span><br><span class="line">    lev-&gt;base.flags = flags;<span class="comment">//flag</span></span><br><span class="line">    lev-&gt;base.refcnt = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (flags &amp; LEV_OPT_THREADSAFE) &#123;</span><br><span class="line">        <span class="built_in">EVTHREAD_ALLOC_LOCK</span>(lev-&gt;base.lock, EVTHREAD_LOCKTYPE_RECURSIVE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将fd关联到struct event上去 lev-&gt;listener是struct event结构体</span></span><br><span class="line">    <span class="comment">//这样assigh将listener_read_cb设置到event的cb中，并将struct evconnlistner做为参数</span></span><br><span class="line">    <span class="comment">//这是一个比较复杂的过程，首先由于event激活，将先调用listener_read_cb</span></span><br><span class="line">    <span class="comment">//在listener_read_cb通过传入的struct evconnlistner调用用户自定义回调</span></span><br><span class="line">    <span class="built_in">event_assign</span>(&amp;lev-&gt;listener, base, fd, EV_READ|EV_PERSIST,</span><br><span class="line">        listener_read_cb, lev);</span><br><span class="line">        <span class="comment">//这里底层调用event_enable</span></span><br><span class="line">    <span class="built_in">evconnlistener_enable</span>(&amp;lev-&gt;base);</span><br><span class="line">    <span class="keyword">return</span> &amp;lev-&gt;base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在另外一个接口<code>evconnlistener_new_bind</code>中由于指定了套接字结构体，因此在底层还调用了<code>bind</code></p><h3 id="3-3-listener-read-cb"><a href="#3-3-listener-read-cb" class="headerlink" title="3.3 listener_read_cb"></a><strong>3.3 listener_read_cb</strong></h3><p>这个底层的回调函数先于用户回调函数调用，在这个回调中会调用用户回调，并且会将已连接的套接字作为参数传入用户回调，<br>这也正是<code>evconnlistener</code>的精髓，无需要用户进行<code>listen、bind、accept</code>等操作</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">listener_read_cb</span><span class="params">(<span class="type">evutil_socket_t</span> fd, <span class="type">short</span> what, <span class="type">void</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">evconnlistener</span> *lev = p;</span><br><span class="line">    <span class="type">int</span> err;</span><br><span class="line">    evconnlistener_cb cb;</span><br><span class="line">    evconnlistener_errorcb errorcb;</span><br><span class="line">    <span class="type">void</span> *user_data;</span><br><span class="line">    <span class="built_in">LOCK</span>(lev);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_storage</span> ss;</span><br><span class="line">        <span class="type">socklen_t</span> socklen = <span class="built_in">sizeof</span>(ss);</span><br><span class="line">        <span class="type">evutil_socket_t</span> new_fd = <span class="built_in">accept</span>(fd, (<span class="keyword">struct</span> sockaddr*)&amp;ss, &amp;socklen);<span class="comment">//accept</span></span><br><span class="line">        <span class="keyword">if</span> (new_fd &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (socklen == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/* This can happen with some older linux kernels in</span></span><br><span class="line"><span class="comment">             * response to nmap. */</span></span><br><span class="line">            <span class="built_in">evutil_closesocket</span>(new_fd);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(lev-&gt;flags &amp; LEV_OPT_LEAVE_SOCKETS_BLOCKING))</span><br><span class="line">            <span class="built_in">evutil_make_socket_nonblocking</span>(new_fd);<span class="comment">//non blocking</span></span><br><span class="line">        <span class="keyword">if</span> (lev-&gt;cb == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">UNLOCK</span>(lev);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ++lev-&gt;refcnt;</span><br><span class="line">        cb = lev-&gt;cb;<span class="comment">//拿到用户回调</span></span><br><span class="line">        user_data = lev-&gt;user_data;</span><br><span class="line">        <span class="built_in">UNLOCK</span>(lev);</span><br><span class="line">        <span class="built_in">cb</span>(lev, new_fd, (<span class="keyword">struct</span> sockaddr*)&amp;ss, (<span class="type">int</span>)socklen,</span><br><span class="line">            user_data);<span class="comment">//调用用户回调并将connfd传入用户回调</span></span><br><span class="line">        <span class="built_in">LOCK</span>(lev);</span><br><span class="line">        <span class="keyword">if</span> (lev-&gt;refcnt == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> freed = <span class="built_in">listener_decref_and_unlock</span>(lev);</span><br><span class="line">            <span class="built_in">EVUTIL_ASSERT</span>(freed);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        --lev-&gt;refcnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="（四）参考"><a href="#（四）参考" class="headerlink" title="（四）参考"></a>（四）参考</h2><p>1.libevent programming<br>2.libevent 深入浅出</p>]]></content>
      
      
      <categories>
          
          <category> OpenSource </category>
          
          <category> libevent </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Opensource </tag>
            
            <tag> libevent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>汇编命令整理</title>
      <link href="/OS/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
      <url>/OS/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述: 汇编命令整理</p></blockquote><p>[toc]</p><h4 id="COMISS"><a href="#COMISS" class="headerlink" title="COMISS"></a>COMISS</h4><p>COMISS（Compare Or Ordered Move SIMD Single）指令是x86指令集中的一条比较指令，用于比较两个单精度浮点数或单精度寄存器，并设置标志位。它也可以将比较结果移动到另一个寄存器或内存位置。</p><p>具体来说，COMISS指令将两个单精度浮点数或单精度寄存器进行比较，并设置标志位ZF（Zero Flag，零标志位）、PF（Parity Flag，奇偶标志位）和CF（Carry Flag，进位标志位）。它可以将比较结果移动到目标寄存器或内存位置。</p><p>例如，以下是一条COMISS指令的示例代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">复制代码</span><br><span class="line"></span><br><span class="line">comiss xmm1, xmm2   ; 比较xmm1和xmm2寄存器中的单精度浮点数</span><br></pre></td></tr></table></figure><p>该指令会将两个寄存器中的单精度浮点数进行比较，并设置相应的标志位。然后，可以将比较结果移动到另一个寄存器或内存位置。</p><p>需要注意的是，COMISS指令只能用于单精度浮点数的比较，不能用于双精度浮点数的比较。</p><h4 id="CVTSD2SS"><a href="#CVTSD2SS" class="headerlink" title="CVTSD2SS"></a>CVTSD2SS</h4><p>CVTSD2SS 是 Intel C&#x2F;C++ 编译器的一个指令，用于将 64 位双精度浮点数转换为 32 位单精度浮点数。在此过程中，源操作数（SRC）被读取并转换为 32 位单精度浮点数，然后存储在目标操作数（DEST）中。</p><p>注意，以上信息仅供参考。在实际编程中，如果你使用 CVTSD2SS 指令，你需要参考 Intel 处理器的架构和相关文档，以确保你的代码可以在目标硬件上正确执行。</p><h4 id="JAE"><a href="#JAE" class="headerlink" title="JAE"></a>JAE</h4><blockquote><p>在汇编语言中，JAE（Jump if Above or Equal）指令是一种根据无符号整数比较的结果进行条件转移的指令。</p><p>当CF（Carry Flag）为0且ZF（Zero Flag）为0时，表示前面的操作结果是无符号整数大于（Above）或等于（Equal）的情况，此时执行跳转操作。</p><p>例如，假设当前指令的地址为0x1000，下一条指令的地址为0x1001，而某个无符号整数的比较结果使得CF为0且ZF为0，那么执行JAE指令后，程序将会跳转到地址0x1001处执行下一条指令。</p><p>需要注意的是，具体的指令用法和语法可能会因为不同的汇编语言而略有不同，具体需要参考对应的汇编语言文档或手册。</p></blockquote><h4 id="JE"><a href="#JE" class="headerlink" title="JE"></a>JE</h4><blockquote><p>在汇编语言中，JE指令全称为“Jump if Equal”，也被称为“Jump if Zero”。它根据标志寄存器中的零标志位(ZF)的值来判断是否进行跳转。当ZF为1时，表示前面的操作结果为零，则跳转到目标地址执行；当ZF为0时，则不进行跳转。</p></blockquote><h4 id="JP"><a href="#JP" class="headerlink" title="JP"></a>JP</h4><blockquote><p>在汇编语言中，JP（Jump if Parity）指令是一种根据奇偶标志位PF（Parity Flag）的状态进行跳转的条件转移指令。</p><p>当PF为1时，表示前面操作的结果具有偶数个1位（即低8位有偶数个1），此时执行跳转操作；当PF为0时，表示前面操作的结果具有奇数个1位（即低8位有奇数个1），此时不执行跳转操作。</p><p>例如，假设当前指令的地址为0x1000，下一条指令的地址为0x1001，而某个操作的结果使得PF为1，那么执行JP指令后，程序将会跳转到地址0x1001处执行下一条指令。</p><p>需要注意的是，具体的指令用法和语法可能会因为不同的汇编语言而略有不同，具体需要参考对应的汇编语言文档或手册。</p></blockquote><h4 id="DD"><a href="#DD" class="headerlink" title="DD"></a>DD</h4><blockquote><p>DD 作为伪操作命令，用于定义操作数占用的字节数，即DoubleWord的缩写，表示4个字节（32位）。</p></blockquote><h4 id="movaps"><a href="#movaps" class="headerlink" title="movaps"></a>movaps</h4><p>movaps是x86指令集中的一种指令，用于将对齐的封装好的128位数据从源地址移动到目标地址。这个指令通常用于处理SSE（Streaming SIMD Extensions）寄存器之间的数据传送。</p><p>在movaps指令中，”aps”表示”Aligned Packed Single”，即对齐的封装好的单精度浮点数。它要求源地址和目标地址都是16字节对齐的，以确保数据传送的效率。</p><p>例如，假设有两个SSE寄存器xmm0和xmm1，以及一个内存地址addr，那么可以使用以下指令将xmm0中的数据移动到addr所指向的内存中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">复制代码</span><br><span class="line"></span><br><span class="line">movaps [addr], xmm0</span><br></pre></td></tr></table></figure><p>这个指令将会将xmm0中的128位数据（即4个单精度浮点数）对齐地存储在addr所指向的内存地址中。</p><h4 id="movss"><a href="#movss" class="headerlink" title="movss"></a>movss</h4><blockquote><p>movss 是x86指令集中的一种单精度移动指令，用于将单精度浮点数（32位）从一个位置移动到另一个位置。这个指令可以用于寄存器之间、存储器和寄存器之间、存储器之间的数据传送。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> 汇编 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85%E9%94%99%E8%AF%AF/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85%E9%94%99%E8%AF%AF/</url>
      
        <content type="html"><![CDATA[<hr><hr><h2 id="安装声网卡驱动报错，代码：0xe0000246"><a href="#安装声网卡驱动报错，代码：0xe0000246" class="headerlink" title="安装声网卡驱动报错，代码：0xe0000246"></a>安装声网卡驱动报错，代码：0xe0000246</h2><p>打开<a href="https://so.csdn.net/so/search?q=%E6%B3%A8%E5%86%8C%E8%A1%A8&spm=1001.2101.3001.7020">注册表</a>，找到：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DeviceInstall\Parameters</p><p>将：DeviceInstallDisabled 的值改为 0<br>重新安装驱动即可</p><p>参考：<a href="https://social.msdn.microsoft.com/Forums/en-US/ae757663-1d0b-41f7-b216-3a1df00de1ab/error-0xe0000246-in-installing-driver?forum=wdk">0xe0000246解决方案</a></p><h2 id="注册表被保护问题"><a href="#注册表被保护问题" class="headerlink" title="注册表被保护问题"></a>注册表被保护问题</h2><p><a href="https://techquack.com/how-to-fix-the-the-configuration-registry-database-is-corrupt-error/">https://techquack.com/how-to-fix-the-the-configuration-registry-database-is-corrupt-error/</a></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>驱动常见错误及解决方案</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： windows驱动开发常见错误整理及其解决思路整理</p></blockquote><p>[toc]</p><h1 id="1-指定的服务已被标记为删除"><a href="#1-指定的服务已被标记为删除" class="headerlink" title="1 指定的服务已被标记为删除"></a>1 指定的服务已被标记为删除</h1><p>在Windows系统中，有时候在尝试启动或停止服务时，可能会遇到“指定的服务已被标记为删除”错误。这个错误常是由于服务已被删除，但是其配置信息仍然存在于系统中所导致的。本文将详细讲解如何解决“指定的服务已被标记为删除”错误，包括使用方法和示例说明。</p><h2 id="解决“指定的服务已被标记为删除”错误"><a href="#解决“指定的服务已被标记为删除”错误" class="headerlink" title="解决“指定的服务已被标记为删除”错误"></a>解决“指定的服务已被标记为删除”错误</h2><p>要解决指定的服务已被标记为删除”错误，可以使用以下方法：</p><h3 id="方法一：使用命令行"><a href="#方法一：使用命令行" class="headerlink" title="方法一：使用命令行"></a>方法一：使用命令行</h3><ol><li>打开命令提示符（以管理员身份运行）。</li><li>输入以下命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc delete servicename</span><br></pre></td></tr></table></figure><p>其中，servicename是要删除的服务的名称。</p><ol><li>按下回车键，待命执行完成。</li><li>重新启动计算机。</li></ol><h3 id="方法二：使用注册表编辑器"><a href="#方法二：使用注册表编辑器" class="headerlink" title="方法二：使用注册表编辑器"></a>方法二：使用注册表编辑器</h3><ol><li>打开注册表编辑器（以管理员身份运行）。</li><li>导航到以下路径：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services</span><br></pre></td></tr></table></figure><p>3.找并删除要删除的服务的子项。</p><ol><li>重新启动计算机。</li></ol><h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><p>以下是两个使用命令行和注册表编辑器解决“指定的服务已被标记为删除”错误的示例说明：</p><ol><li>使用命令行删除服务：假设我们需要删除名“testservice”的服务，可以使用以下命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc delete testservice</span><br></pre></td></tr></table></figure><p>这样就可以删除该服务。</p><ol><li>使用注册表编辑器删除服务：假设我们需要删除名为“testservice”的服务，可以使用以下步骤：</li><li>打开注册表编辑器。</li><li>导航到“HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services”路径。</li><li>查找名为“testservice”的子项，并删除该子项。</li><li>重新启动计算机。</li></ol><p>这样就可以删除该服务。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上是关于如何解决“指定的服务已被标记为删除”错误的攻略，包括方法和示例说明。如果您遇到了这个错误，请尝试使用以上方法解决。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 驱动 </tag>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>驱动禁用签名</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E7%A6%81%E7%94%A8%E7%AD%BE%E5%90%8D/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E7%A6%81%E7%94%A8%E7%AD%BE%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<p>方法一：使用命令提示符</p><p>\1. 首先，按下Win+X组合键，选择“命令提示符（管理员）”。 2. 在命令提示符窗口中，输入以下命令并按下回车键：bcdedit &#x2F;set testsigning on 3. 系统会显示“操作成功完成”的提示信息，表示已成功禁用驱动签名。 4. 重新启动电脑，即可生效。</p><p>现在，你已经成功禁用了Win10的驱动签名限制，可以自由安装非官方或未经认证的驱动程序了！但是请注意，禁用驱动签名可能会带来一定的安全风险，所以在安装驱动程序时，请确保来源可靠，并及时恢复驱动签名以保证系统的安全性。</p><p>希望本文的教程能够帮助到大家，让你的电脑更加自由灵活。如果你有任何问题或者建议，欢迎在评论区留言，我会尽力解答。祝大家使用愉快！</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络连接事件</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E4%BA%8B%E4%BB%B6/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>获取网卡数量</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E8%8E%B7%E5%8F%96%E7%BD%91%E5%8D%A1%E6%95%B0%E9%87%8F/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E8%8E%B7%E5%8F%96%E7%BD%91%E5%8D%A1%E6%95%B0%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<p>获取虚拟网卡的个数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetNetCardNums</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> nRet = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line">INetConnectionManager* pNetManager;</span><br><span class="line">INetConnection* pNetConnection;</span><br><span class="line">IEnumNetConnection* pEnum;</span><br><span class="line"></span><br><span class="line">ULONG celtFetched;</span><br><span class="line">std::string strComGuid;</span><br><span class="line">NETCON_PROPERTIES* properties = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="type">bool</span> bIsInstalledNcCard = <span class="literal">false</span>;</span><br><span class="line">TapReg setRegGuid = <span class="built_in">get_tap_reg</span>();</span><br><span class="line">NcStatusList ncStausList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (setRegGuid.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGW</span>(<span class="string">&quot;%s Reg Not Found, Re Install&quot;</span>, __SP_FUNC__);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (S_OK != <span class="built_in">CoCreateInstance</span>(CLSID_ConnectionManager, <span class="literal">NULL</span>, CLSCTX_SERVER, IID_INetConnectionManager, (<span class="type">void</span>**)&amp;pNetManager))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGW</span>(<span class="string">&quot;%s Com Instance Failed, sleep(5s)&quot;</span>, __SP_FUNC__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pNetManager-&gt;<span class="built_in">EnumConnections</span>(NCME_DEFAULT, &amp;pEnum);</span><br><span class="line">pNetManager-&gt;<span class="built_in">Release</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == pEnum)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pEnum-&gt;<span class="built_in">Next</span>(<span class="number">1</span>, &amp;pNetConnection, &amp;celtFetched) == S_OK)</span><br><span class="line">&#123;</span><br><span class="line">pNetConnection-&gt;<span class="built_in">GetProperties</span>(&amp;properties);</span><br><span class="line"></span><br><span class="line">strComGuid = <span class="built_in">GUIDToString</span>(properties-&gt;guidId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看当前网卡与注册表的guid一致时的状态</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; it : setRegGuid)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// #1 判断是否安装了 虚拟网卡</span></span><br><span class="line"><span class="keyword">if</span> (strComGuid.<span class="built_in">compare</span>(it) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">nRet++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">pEnum-&gt;<span class="built_in">Release</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="网卡保活"><a href="#网卡保活" class="headerlink" title="网卡保活"></a>网卡保活</h1><p>声明</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @fnkeepAlive</span></span><br><span class="line"><span class="comment">* @brief        网络连接保活</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @detail线程，通过COM组件实现</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">keepDeviceTAVnicAlive</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>实现</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">keepDeviceTAVnicAlive</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(g_mutex)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> bRet = <span class="literal">false</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> iRePtunFlag = <span class="number">1</span>; <span class="comment">// Nc重连标志</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> iReLoadFlag = <span class="number">1</span>; <span class="comment">// Dll重载标志</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ipc 主要处理nc发送的消息</span></span><br><span class="line"><span class="function">TrustSpaceIPCUtil <span class="title">m_ncIpc</span><span class="params">(<span class="string">&quot;trustNcToCore&quot;</span>)</span></span>;</span><br><span class="line">m_ncIpc.<span class="built_in">Initialize</span>(&amp;HandleIpcCallBack);</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line">INetConnectionManager* pNetManager = <span class="literal">nullptr</span>;</span><br><span class="line">INetConnection* pNetConnection = <span class="literal">nullptr</span>;</span><br><span class="line">IEnumNetConnection* pEnum = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">ULONG celtFetched;</span><br><span class="line">std::string strComGuid;</span><br><span class="line"><span class="type">bool</span> bIsInstalledNcCard = <span class="literal">false</span>;</span><br><span class="line">TapReg setRegGuid = <span class="built_in">get_tap_reg</span>();</span><br><span class="line">NcStatusList ncStausList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (setRegGuid.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGW</span>(<span class="string">&quot;%s Reg Not Found, Re Install&quot;</span>, __SP_FUNC__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">goto</span> __REINSTALL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (S_OK != <span class="built_in">CoCreateInstance</span>(CLSID_ConnectionManager, <span class="literal">NULL</span>, CLSCTX_SERVER, IID_INetConnectionManager, (<span class="type">void</span>**)&amp;pNetManager))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGW</span>(<span class="string">&quot;%s Com Instance Failed, sleep(5s)&quot;</span>, __SP_FUNC__);</span><br><span class="line"></span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span> * <span class="number">5</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pNetManager-&gt;<span class="built_in">EnumConnections</span>(NCME_DEFAULT, &amp;pEnum);</span><br><span class="line"><span class="keyword">if</span> (pNetManager)</span><br><span class="line">&#123;</span><br><span class="line">pNetManager-&gt;<span class="built_in">Release</span>();</span><br><span class="line">pNetManager = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == pEnum)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pEnum-&gt;<span class="built_in">Next</span>(<span class="number">1</span>, &amp;pNetConnection, &amp;celtFetched) == S_OK)</span><br><span class="line">&#123;</span><br><span class="line">NETCON_PROPERTIES* properties = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">pNetConnection-&gt;<span class="built_in">GetProperties</span>(&amp;properties);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (properties != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">strComGuid = <span class="built_in">GUIDToString</span>(properties-&gt;guidId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// T1 查看当前网卡与注册表的guid一致时的状态</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; it : setRegGuid)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// #1 判断是否安装了 虚拟网卡</span></span><br><span class="line"><span class="type">int</span> minSize = <span class="built_in">min</span>(strComGuid.<span class="built_in">size</span>(), it.<span class="built_in">size</span>());</span><br><span class="line"><span class="keyword">if</span> (it.<span class="built_in">compare</span>(<span class="number">0</span>, minSize, strComGuid, <span class="number">0</span>, minSize) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">ncStausList[properties-&gt;Status] = properties-&gt;pszwDeviceName;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #2 已安装</span></span><br><span class="line">bIsInstalledNcCard = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #3 判断是否被禁用</span></span><br><span class="line"><span class="keyword">if</span> (NCS_DISCONNECTED == properties-&gt;Status)</span><br><span class="line">&#123;</span><br><span class="line">pNetConnection-&gt;<span class="built_in">Connect</span>();</span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;%s [NcCard] ReConnect&quot;</span>, __SP_FUNC__);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pNetConnection)</span><br><span class="line">&#123;</span><br><span class="line">pNetConnection-&gt;<span class="built_in">Release</span>();</span><br><span class="line">pNetConnection = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pEnum)</span><br><span class="line">&#123;</span><br><span class="line">pEnum-&gt;<span class="built_in">Release</span>();</span><br><span class="line">pEnum = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// T2 网卡启用时，判断是否有业务需要开启</span></span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model &amp;&amp; g_sp_trust_model-&gt;<span class="built_in">Session</span>()-&gt;<span class="built_in">NeedsL3Tunnel</span>() &amp;&amp; <span class="comment">// 有三层业务</span></span><br><span class="line">!g_sp_trust_model-&gt;<span class="built_in">Session</span>()-&gt;<span class="built_in">IsTunnelSvrsEmpty</span>() &amp;&amp; <span class="comment">// 服务不为空</span></span><br><span class="line">g_sp_trust_model-&gt;<span class="built_in">Session</span>()-&gt;<span class="built_in">IsOnline</span>() &amp;&amp;  <span class="comment">// 会话在线</span></span><br><span class="line">g_bNetWorkOnline) <span class="comment">// 必须联网</span></span><br><span class="line">&#123;</span><br><span class="line">iRePtunFlag = (iRePtunFlag &gt; <span class="number">300</span>) ? <span class="number">0</span> : ++iRePtunFlag;</span><br><span class="line"><span class="keyword">if</span> (ncStausList.<span class="built_in">find</span>(NCS_CONNECTED) == ncStausList.<span class="built_in">end</span>() &amp;&amp; (iRePtunFlag % <span class="number">30</span> == <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;%s [NcCard] Auto Detect ReConnect PTUN&quot;</span>, __SP_FUNC__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (iReLoadFlag == <span class="number">5</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;%s [NcCard] Auto Detect ReConnect PTUN FAILED. RUN TIMES OVER 5, NECT:[NO OPTION]&quot;</span>, __SP_FUNC__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">handleReStartNc</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">5</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">iReLoadFlag++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ncStausList.<span class="built_in">find</span>(NCS_CONNECTED) != ncStausList.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line">iReLoadFlag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__REINSTALL:</span><br><span class="line"></span><br><span class="line"><span class="built_in">CoUninitialize</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> == bIsInstalledNcCard) <span class="comment">// 未安装，重新安装</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// #1 未安装，重新安装</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> == bIsInstalledNcCard)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGW</span>(<span class="string">&quot;[NetCard] Detect Nc Card Not Installed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// #2 重新安装</span></span><br><span class="line">bIsInstalledNcCard = <span class="literal">true</span>;</span><br><span class="line"><span class="function">std::thread <span class="title">installCardThread</span><span class="params">([] &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">g_sp_trust_model-&gt;NotifyUpMessage(SP_TRUST_TOPIC_MSG_NC_INSTALL, SPJSONObject(), <span class="number">100</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line">installCardThread.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// #3 等待客户端安装</span></span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">15</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">1</span> * <span class="number">1000</span>); <span class="comment">// 每一秒检查一次</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="网卡是否存在"><a href="#网卡是否存在" class="headerlink" title="网卡是否存在"></a>网卡是否存在</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsExistNcCard</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> bIsExist = <span class="literal">false</span>;</span><br><span class="line"><span class="type">int</span> nNetCardSize = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;IP_ADAPTER_INFO&gt; <span class="title">pIpAdapterInfo</span><span class="params">(<span class="keyword">new</span> IP_ADAPTER_INFO[nNetCardSize])</span></span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> stSize = <span class="built_in">sizeof</span>(IP_ADAPTER_INFO) * nNetCardSize;</span><br><span class="line"><span class="comment">//获取所有网卡信息，参数二为输入输出参数 </span></span><br><span class="line"><span class="type">int</span> nRel = <span class="built_in">GetAdaptersInfo</span>(pIpAdapterInfo.<span class="built_in">get</span>(), &amp;stSize);</span><br><span class="line"><span class="comment">// 空间不足</span></span><br><span class="line"><span class="keyword">if</span> (ERROR_BUFFER_OVERFLOW == nRel) &#123;</span><br><span class="line"></span><br><span class="line">pIpAdapterInfo.<span class="built_in">reset</span>(<span class="keyword">new</span> IP_ADAPTER_INFO[stSize]);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetAdaptersInfo</span>(pIpAdapterInfo.<span class="built_in">get</span>(), &amp;stSize) != NO_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Failed to get adapter info&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PIP_ADAPTER_INFO cur = pIpAdapterInfo.<span class="built_in">get</span>();</span><br><span class="line"><span class="comment">// 多个网卡 通过链表形式链接起来的</span></span><br><span class="line">std::string netdesc;</span><br><span class="line">std::string netip;</span><br><span class="line"><span class="keyword">while</span> (cur) &#123;</span><br><span class="line"></span><br><span class="line">netdesc = cur-&gt;Description;</span><br><span class="line"><span class="keyword">switch</span> (cur-&gt;Type) &#123;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_OTHER:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_ETHERNET:</span><br><span class="line">&#123;</span><br><span class="line">IP_ADDR_STRING* pIpAddrString = &amp;(cur-&gt;IpAddressList);</span><br><span class="line">netip = pIpAddrString-&gt;IpAddress.String;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_TOKENRING:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_FDDI:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_PPP:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_LOOPBACK:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MIB_IF_TYPE_SLIP:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:<span class="comment">//无线网卡,Unknown type</span></span><br><span class="line">&#123;</span><br><span class="line">IP_ADDR_STRING* pIpAddrString = &amp;(cur-&gt;IpAddressList);</span><br><span class="line">netip = pIpAddrString-&gt;IpAddress.String;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> hex[<span class="number">16</span>] = &#123; <span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;F&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mac 地址一般6个字节 </span></span><br><span class="line"><span class="comment">// mac 二进制转16进制字符串</span></span><br><span class="line"><span class="type">char</span> macStr[<span class="number">18</span>] = &#123; <span class="number">0</span> &#125;;<span class="comment">//12+5+1</span></span><br><span class="line"><span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (UINT j = <span class="number">0</span>; j &lt; cur-&gt;AddressLength; j++) &#123;</span><br><span class="line">macStr[k++] = hex[(cur-&gt;Address[j] &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>];</span><br><span class="line">macStr[k++] = hex[cur-&gt;Address[j] &amp; <span class="number">0x0f</span>];</span><br><span class="line">macStr[k++] = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (k &lt; <span class="number">18</span> &amp;&amp; k &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">macStr[k - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cur = cur-&gt;Next;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到 &quot;TrustAgent VNIC&quot;</span></span><br><span class="line"><span class="keyword">if</span> (netdesc.<span class="built_in">find</span>(<span class="string">&quot;TrustAgent VNIC&quot;</span>) != std::string::npos)</span><br><span class="line">&#123;</span><br><span class="line">bIsExist = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">goto</span> _END_;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_END_:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> bIsExist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 网卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个完整的wfp驱动</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E5%9C%B0wfp%E9%A9%B1%E5%8A%A8/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E5%9C%B0wfp%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntddk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(push)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4201)       <span class="comment">// unnamed struct/union</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4995)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fwpsk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(pop)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ndis.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fwpmk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ws2ipdef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;in6addr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ip2string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strsafe.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INITGUID</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;guiddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool BOOLEAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true TRUE </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false FALSE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_NAME <span class="string">L&quot;\\Device\\WFP_TEST&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_DOSNAME <span class="string">L&quot;\\DosDevices\\WFP_TEST&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> kmalloc(_s) ExAllocatePoolWithTag(NonPagedPool, _s, <span class="string">&#x27;SYSQ&#x27;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> kfree(_p) ExFreePool(_p)</span></span><br><span class="line"></span><br><span class="line">DEFINE_GUID <span class="comment">// &#123;6812FC83-7D3E-499a-A012-55E0D85F348B&#125;</span></span><br><span class="line">(</span><br><span class="line">GUID_ALE_AUTH_CONNECT_CALLOUT_V4,</span><br><span class="line"><span class="number">0x6812fc83</span>,</span><br><span class="line"><span class="number">0x7d3e</span>,</span><br><span class="line"><span class="number">0x499a</span>,</span><br><span class="line"><span class="number">0xa0</span>, <span class="number">0x12</span>, <span class="number">0x55</span>, <span class="number">0xe0</span>, <span class="number">0xd8</span>, <span class="number">0x5f</span>, <span class="number">0x34</span>, <span class="number">0x8b</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">PDEVICE_OBJECT  gDevObj;</span><br><span class="line"></span><br><span class="line">HANDLEgEngineHandle = <span class="number">0</span>;</span><br><span class="line">HANDLEgInjectHandle = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//CalloutId</span></span><br><span class="line">UINT32gAleConnectCalloutId = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//FilterId</span></span><br><span class="line">UINT64gAleConnectFilterId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">以下两个回调函数没啥用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">NTSTATUS NTAPI <span class="title">WallNotifyFn</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">IN FWPS_CALLOUT_NOTIFY_TYPE  notifyType,</span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> GUID  *filterKey,</span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> FWPS_FILTER  *filter</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">KdPrint</span>((<span class="string">&quot;NotifyFn\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID NTAPI <span class="title">WallFlowDeleteFn</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">IN UINT16  layerId,</span></span></span><br><span class="line"><span class="params"><span class="function">IN UINT32  calloutId,</span></span></span><br><span class="line"><span class="params"><span class="function">IN UINT64  flowContext</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">KdPrint</span>((<span class="string">&quot;FlowDeleteFn\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//协议代码转为名称</span></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">ProtocolIdToName</span><span class="params">(UINT16 id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span> *ProtocolName = <span class="built_in">kmalloc</span>(<span class="number">16</span>);</span><br><span class="line"><span class="built_in">RtlZeroMemory</span>(ProtocolName,<span class="number">16</span>);</span><br><span class="line"><span class="keyword">switch</span> (id)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">4</span> + <span class="number">1</span>, <span class="string">&quot;ICMP&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">4</span> + <span class="number">1</span>, <span class="string">&quot;IGMP&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">3</span> + <span class="number">1</span>, <span class="string">&quot;TCP&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">17</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">3</span> + <span class="number">1</span>, <span class="string">&quot;UDP&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">3</span> + <span class="number">1</span>, <span class="string">&quot;RDP&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">strcpy_s</span>(ProtocolName, <span class="number">7</span> + <span class="number">1</span>, <span class="string">&quot;UNKNOWN&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ProtocolName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最重要的过滤函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> NTAPI <span class="title">WallALEConnectClassify</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> FWPS_INCOMING_VALUES0* inFixedValues,<span class="comment">//此结构包含筛选层上每个数据字段的值  </span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//incomingValue[index] =&gt; index的值是枚举类型FWPS_FIELDS_ALE_AUTH_CONNECT_V4,</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//枚举名字说明了该值的类型例如:FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_LOCAL_ADDRESS 就是本地IP</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> FWPS_INCOMING_METADATA_VALUES0* inMetaValues,<span class="comment">//此结构包含筛选层上每个元数据字段的值。</span></span></span></span><br><span class="line"><span class="params"><span class="function">IN OUT <span class="type">void</span>* layerData,<span class="comment">//指向结构的指针，该结构描述正在过滤的层上的原始数据。此参数可能为NULL，</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//这取决于所筛选的层和调用classfyFn0标注函数的条件。</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//对于流层，此参数指向FWPS_stream_Callout_IO_PACKET 0结构。</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//对于所有其他层，如果NetBufferList结构不是NULL，则该参数指向该结构。</span></span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> <span class="type">void</span>* classifyContext,<span class="comment">//由过滤器引擎指向与标注驱动程序关联的上下文数据的指针 没有找出该指针类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> FWPS_FILTER* filter,<span class="comment">//指向FWPS_FILTER1结构的指针。此结构描述指定筛选器操作的标注的筛选器。</span></span></span></span><br><span class="line"><span class="params"><span class="function">IN UINT64 flowContext,<span class="comment">//包含与数据流关联的上下文的UINT 64类型变量。如果没有与数据流相关联的上下文，则此参数为零。</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">//如果在不支持数据流的过滤层将标注添加到筛选引擎中，则clamfyFn1回调函数应忽略此参数</span></span></span></span><br><span class="line"><span class="params"><span class="function">OUT FWPS_CLASSIFY_OUT* classifyOut <span class="comment">//指向FWPS_GARGY_OUT 0结构的指针，该结构接收clamfyFn1回调函数返回给调用方的任何数据</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *ProtocolName = <span class="literal">NULL</span>;</span><br><span class="line">DWORD LocalIp, RemoteIP;</span><br><span class="line">PWCHAR Path = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">Path = <span class="built_in">ExAllocatePoolWithTag</span>(NonPagedPool, inMetaValues-&gt;processPath-&gt;size+<span class="number">2</span>, <span class="string">&#x27;NET&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span>==Path)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">RtlZeroMemory</span>(Path, inMetaValues-&gt;processPath-&gt;size + <span class="number">2</span>);</span><br><span class="line"><span class="built_in">wcscpy_s</span>(Path, inMetaValues-&gt;processPath-&gt;size / <span class="number">2</span>, (WCHAR*)inMetaValues-&gt;processPath-&gt;data);</span><br><span class="line"></span><br><span class="line">LocalIp = inFixedValues-&gt;incomingValue[FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_LOCAL_ADDRESS].value.uint32;</span><br><span class="line">RemoteIP = inFixedValues-&gt;incomingValue[FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_REMOTE_ADDRESS].value.uint32;</span><br><span class="line">ProtocolName = <span class="built_in">ProtocolIdToName</span>(inFixedValues-&gt;incomingValue[FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_PROTOCOL].value.uint16);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;进程ID : %d&quot;</span>, (DWORD)(inMetaValues-&gt;processId));</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;Path=%S&quot;</span>, Path);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;本地地址=%u.%u.%u.%u &quot;</span>, (LocalIp &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>, (LocalIp &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>, (LocalIp &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, LocalIp &amp; <span class="number">0xFF</span>);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;端口%d\n&quot;</span>, inFixedValues-&gt;incomingValue[FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_LOCAL_PORT].value.uint16);</span><br><span class="line"></span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;远程地址=%u.%u.%u.%u &quot;</span>, (RemoteIP &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>, (RemoteIP &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>, (RemoteIP &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, RemoteIP &amp; <span class="number">0xFF</span>);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;端口%d\n&quot;</span>, inFixedValues-&gt;incomingValue[FWPS_FIELD_ALE_AUTH_CONNECT_V4_IP_REMOTE_PORT].value.uint16);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;协议名: %s\n&quot;</span>, ProtocolName);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">kfree</span>(ProtocolName);</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> != Path)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">ExFreePoolWithTag</span>(Path, <span class="string">&#x27;NET&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">classifyOut-&gt;actionType = FWP_ACTION_PERMIT;<span class="comment">//允许连接</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">RegisterCalloutForLayer</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> GUID* layerKey,</span></span></span><br><span class="line"><span class="params"><span class="function">IN <span class="type">const</span> GUID* calloutKey,</span></span></span><br><span class="line"><span class="params"><span class="function">IN FWPS_CALLOUT_CLASSIFY_FN classifyFn,</span></span></span><br><span class="line"><span class="params"><span class="function">IN FWPS_CALLOUT_NOTIFY_FN notifyFn,</span></span></span><br><span class="line"><span class="params"><span class="function">IN FWPS_CALLOUT_FLOW_DELETE_NOTIFY_FN flowDeleteNotifyFn,</span></span></span><br><span class="line"><span class="params"><span class="function">OUT UINT32* calloutId,   <span class="comment">//注册callout时返回此ID</span></span></span></span><br><span class="line"><span class="params"><span class="function">OUT UINT64* filterId</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NTSTATUS        status = STATUS_SUCCESS;</span><br><span class="line">FWPS_CALLOUT    sCallout = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">FWPM_FILTER     mFilter = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">FWPM_FILTER_CONDITION mFilter_condition[<span class="number">1</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">FWPM_CALLOUT    mCallout = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">FWPM_DISPLAY_DATA mDispData = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">BOOLEAN         bCalloutRegistered = FALSE;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里未指定sCallout.flags</span></span><br><span class="line">sCallout.calloutKey = *calloutKey;   <span class="comment">//一个唯一的GUID值,用来标记此callout</span></span><br><span class="line">sCallout.classifyFn = classifyFn;    <span class="comment">//每当回调处理网络数据时，过滤器引擎将调用此函数,处理网络数据在这个回调函数里面处理.</span></span><br><span class="line">sCallout.flowDeleteFn = flowDeleteNotifyFn;  <span class="comment">//每当终止由回调处理的数据流时，筛选器引擎将调用此函数</span></span><br><span class="line">sCallout.notifyFn = notifyFn; <span class="comment">//卸载callout时,会调用这个回调</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//要使用哪个设备对象注册</span></span><br><span class="line">status = <span class="built_in">FwpsCalloutRegister</span>(gDevObj, <span class="comment">//自己创建的设备对象</span></span><br><span class="line">&amp;sCallout, <span class="comment">//该结构体有用的是指定了classifyFn回调,处理连接时的数据就会用到这个回调函数.</span></span><br><span class="line">calloutId  <span class="comment">//返回的calloutID ,取消注册callout会用到这个值</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line"></span><br><span class="line">bCalloutRegistered = TRUE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mDispData.name = <span class="string">L&quot;WFP TEST&quot;</span>;        <span class="comment">//可选的名字</span></span><br><span class="line">mDispData.description = <span class="string">L&quot;yxp&#x27;s WFP TEST&quot;</span>;   <span class="comment">//可选的描述</span></span><br><span class="line"><span class="comment">//你感兴趣的内容</span></span><br><span class="line">mCallout.applicableLayer = *layerKey;  <span class="comment">//过滤层标识符   此过滤层允许授权对传出tcp连接的连接请求，</span></span><br><span class="line"><span class="comment">//以及基于发送的第一个数据包授权传出非tcp通信量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//你感兴趣的内容的GUID</span></span><br><span class="line">mCallout.calloutKey = *calloutKey;   <span class="comment">//该GUID值必须与FwpsCalloutRegister注册时的GUID值相同.</span></span><br><span class="line">mCallout.displayData = mDispData;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向过滤引擎添加callout</span></span><br><span class="line">status = <span class="built_in">FwpmCalloutAdd</span>(gEngineHandle,</span><br><span class="line">&amp;mCallout,  <span class="comment">//flags没有设置</span></span><br><span class="line"><span class="literal">NULL</span>,  <span class="comment">//安全描述符  可以为NULL</span></span><br><span class="line"><span class="literal">NULL</span>); <span class="comment">//返回一个ID  与FwpsCalloutRegister函数返回的ID是相同的.</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//FWPM_action0结构指定在所有筛选条件都为真时所采取的操作</span></span><br><span class="line">mFilter.action.calloutKey = *calloutKey;</span><br><span class="line"><span class="comment">//交给callout处理  由callout来决定返回阻止(block)或者允许(permit)</span></span><br><span class="line">mFilter.action.type = FWP_ACTION_CALLOUT_TERMINATING;</span><br><span class="line"></span><br><span class="line"><span class="comment">//描述</span></span><br><span class="line">mFilter.displayData.name = <span class="string">L&quot;WFP TEST&quot;</span>;</span><br><span class="line">mFilter.displayData.description = <span class="string">L&quot;yxp&#x27;s WFP TEST&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mFilter.layerKey = *layerKey;<span class="comment">//这个值和FwpmCalloutAdd里面使用的值一样 过滤层标识符   此过滤层允许授权对传出tcp连接的连接请求，</span></span><br><span class="line"><span class="comment">//以及基于发送的第一个数据包授权传出非tcp通信量  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤条件数</span></span><br><span class="line">mFilter.numFilterConditions = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//过滤条件</span></span><br><span class="line">mFilter.filterCondition = mFilter_condition;</span><br><span class="line"></span><br><span class="line">mFilter.subLayerKey = FWPM_SUBLAYER_UNIVERSAL;  <span class="comment">//此子层承载所有未分配给任何其他子层的筛选器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//BFE将根据过滤条件自动分配权重</span></span><br><span class="line">mFilter.weight.type = FWP_EMPTY;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加一个新的过滤器对象到系统中</span></span><br><span class="line">status = <span class="built_in">FwpmFilterAdd</span>(gEngineHandle, &amp;mFilter, <span class="literal">NULL</span>, filterId);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line">exit:</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (bCalloutRegistered)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">FwpsCalloutUnregisterById</span>(*calloutId);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">WallRegisterCallouts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NTSTATUS    status = STATUS_SUCCESS;</span><br><span class="line">BOOLEAN     bInTransaction = FALSE;</span><br><span class="line">BOOLEAN     bEngineOpened = FALSE;</span><br><span class="line">FWPM_SESSION session = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//置此标志时，会话结束时将自动删除在会话期间添加的任何对象</span></span><br><span class="line">session.flags = FWPM_SESSION_FLAG_DYNAMIC;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启WFP引擎</span></span><br><span class="line">status = <span class="built_in">FwpmEngineOpen</span>(<span class="literal">NULL</span>,</span><br><span class="line">RPC_C_AUTHN_WINNT,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">&amp;session,</span><br><span class="line">&amp;gEngineHandle);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line">bEngineOpened = TRUE;</span><br><span class="line"><span class="comment">// 在当前会话中开始显式事务</span></span><br><span class="line">status = <span class="built_in">FwpmTransactionBegin</span>(gEngineHandle, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line">bInTransaction = TRUE;</span><br><span class="line"><span class="comment">//注册回调函数</span></span><br><span class="line">status = <span class="built_in">RegisterCalloutForLayer</span>(</span><br><span class="line">&amp;FWPM_LAYER_ALE_AUTH_CONNECT_V4,  <span class="comment">//此过滤层允许授权对传出tcp连接的连接请求，</span></span><br><span class="line"><span class="comment">//以及基于发送的第一个数据包授权传出非tcp通信量</span></span><br><span class="line">&amp;GUID_ALE_AUTH_CONNECT_CALLOUT_V4,</span><br><span class="line">WallALEConnectClassify,</span><br><span class="line">WallNotifyFn,</span><br><span class="line">WallFlowDeleteFn,</span><br><span class="line">&amp;gAleConnectCalloutId,</span><br><span class="line">&amp;gAleConnectFilterId);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;RegisterCalloutForLayer失败!\n&quot;</span>);</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//确认所有内容并提交，让回调函数正式发挥作用</span></span><br><span class="line">status = <span class="built_in">FwpmTransactionCommit</span>(gEngineHandle);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line"><span class="keyword">goto</span> exit;</span><br><span class="line">bInTransaction = FALSE;</span><br><span class="line">exit:</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (bInTransaction)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">FwpmTransactionAbort</span>(gEngineHandle);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bEngineOpened)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">FwpmEngineClose</span>(gEngineHandle);</span><br><span class="line">gEngineHandle = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">WallUnRegisterCallouts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (gEngineHandle != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//删除FilterId</span></span><br><span class="line"><span class="built_in">FwpmFilterDeleteById</span>(gEngineHandle, gAleConnectFilterId);</span><br><span class="line"><span class="comment">//删除CalloutId</span></span><br><span class="line"><span class="built_in">FwpmCalloutDeleteById</span>(gEngineHandle, gAleConnectCalloutId);</span><br><span class="line"><span class="comment">//清空FilterId</span></span><br><span class="line">gAleConnectFilterId = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//反注册CalloutId</span></span><br><span class="line"><span class="built_in">FwpsCalloutUnregisterById</span>(gAleConnectCalloutId);</span><br><span class="line"><span class="comment">//清空CalloutId</span></span><br><span class="line">gAleConnectCalloutId = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//关闭引擎</span></span><br><span class="line"><span class="built_in">FwpmEngineClose</span>(gEngineHandle);</span><br><span class="line">gEngineHandle = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">DriverUnload</span><span class="params">(PDRIVER_OBJECT driverObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NTSTATUS status;</span><br><span class="line">UNICODE_STRING  deviceDosName = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">status = <span class="built_in">WallUnRegisterCallouts</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;WallUnRegisterCallouts失败\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">RtlInitUnicodeString</span>(&amp;deviceDosName, DEVICE_DOSNAME);</span><br><span class="line"><span class="built_in">IoDeleteSymbolicLink</span>(&amp;deviceDosName);</span><br><span class="line"><span class="keyword">if</span> (gDevObj)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">IoDeleteDevice</span>(gDevObj);</span><br><span class="line">gDevObj = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;驱动卸载成功\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(PDRIVER_OBJECT driverObject, PUNICODE_STRING registryPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">UNICODE_STRING  deviceName = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">UNICODE_STRING  deviceDosName = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">NTSTATUS status = STATUS_SUCCESS;</span><br><span class="line">driverObject-&gt;DriverUnload = DriverUnload;</span><br><span class="line"><span class="built_in">RtlInitUnicodeString</span>(&amp;deviceName, DEVICE_NAME);</span><br><span class="line">status = <span class="built_in">IoCreateDevice</span>(driverObject,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">&amp;deviceName,</span><br><span class="line">FILE_DEVICE_NETWORK,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">FALSE,</span><br><span class="line">&amp;gDevObj);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;创建设备对象失败\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> STATUS_UNSUCCESSFUL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">RtlInitUnicodeString</span>(&amp;deviceDosName, DEVICE_DOSNAME);</span><br><span class="line">status = <span class="built_in">IoCreateSymbolicLink</span>(&amp;deviceDosName, &amp;deviceName);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;创建符号链接失败\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> STATUS_UNSUCCESSFUL;</span><br><span class="line">&#125;</span><br><span class="line">status = <span class="built_in">WallRegisterCallouts</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;WallRegisterCallouts 失败!\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> STATUS_UNSUCCESSFUL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;过滤驱动加载成功\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio 2022 驱动开发环境准备</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87(VS2022)/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87(VS2022)/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：驱动开发环境准备</p></blockquote><p>[toc]</p><h1 id="步骤一-安装sdk与wdk"><a href="#步骤一-安装sdk与wdk" class="headerlink" title="步骤一 安装sdk与wdk"></a>步骤一 安装sdk与wdk</h1><p>安装windows相关的sdk</p><p>参考微软文档：<a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/download-the-wdk">下载 Windows 驱动程序工具包 (WDK) - Windows drivers | Microsoft Learn</a></p><h1 id="步骤二-调试与安装工具"><a href="#步骤二-调试与安装工具" class="headerlink" title="步骤二 调试与安装工具"></a>步骤二 调试与安装工具</h1><ul><li><p>下载 dbgview</p><p>dbgview 在 SysinternalsSuite 套件中，下载 SysinternalsSuite 套件即可。</p><p><a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/">https://docs.microsoft.com/zh-cn/sysinternals/downloads/</a></p></li><li><p>下载驱动安装器</p><p>KmdManager驱动加载调试工具</p><p><a href="https://www.downloadcrew.com/article/27494/kernel_mode_drivers_manager">Kernel Mode Drivers Manager 1.3 free download - Software reviews, downloads, news, free trials, freeware and full commercial software - Downloadcrew</a></p></li><li><p>PCHunter</p><p><a href="http://www.xuetr.com/">http://www.xuetr.com/</a></p></li></ul><h1 id="步骤三-驱动框架"><a href="#步骤三-驱动框架" class="headerlink" title="步骤三 驱动框架"></a>步骤三 驱动框架</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntddk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #include &lt;ntifs.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">UnloadDriver</span><span class="params">(PDRIVER_OBJECT pDriver)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;Bye, Driver&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(PDRIVER_OBJECT pDriver, PUNICODE_STRING pReg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;Hello World, Driver&quot;</span>);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;DRIVER ADDress, [%]&quot;</span>);</span><br><span class="line"><span class="built_in">DbgPrint</span>(<span class="string">&quot;Hello World, Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">pDriver-&gt;DriverUnload = UnloadDriver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="步骤三-Visual-Studio配置"><a href="#步骤三-Visual-Studio配置" class="headerlink" title="步骤三 Visual Studio配置"></a>步骤三 Visual Studio配置</h1><ol><li>C&#x2F;C++ -&gt; 常规 -&gt; 将警告视为错误 -&gt; 否</li><li>C&#x2F;C++ -&gt; 常规 -&gt; 警告等级 -&gt; 等级3（也可忽略）</li><li>驱动运行环境</li><li>inf2cat -&gt; 否</li><li>编译运行，会生成sys文件</li></ol><h1 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h1><h2 id="禁用界面输出无用信息"><a href="#禁用界面输出无用信息" class="headerlink" title="禁用界面输出无用信息"></a>禁用界面输出无用信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ed nt!Kd_SXS_Mask</span><br><span class="line">ed nt!Kd_FUSION_Mask</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
          <category> windows驱动开发教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 驱动 </tag>
            
            <tag> driver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HelloWorld驱动与安装</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/HelloWorld%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%AE%89%E8%A3%85/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/HelloWorld%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：实现一个最简单的helloworld驱动，微软官方有相关教程 <a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/writing-a-very-small-kmdf--driver">编写 Hello World Windows 驱动程序 (KMDF) - Windows drivers | Microsoft Learn</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
          <category> windows驱动开发教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 驱动 </tag>
            
            <tag> driver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>驱动开发相关API整理</title>
      <link href="/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/"/>
      <url>/OS/Windows/%E9%A9%B1%E5%8A%A8/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：驱动开发过程中，相关API的学习整理</p></blockquote><p>[toc]</p><h4 id="WdfDriverCreate"><a href="#WdfDriverCreate" class="headerlink" title="WdfDriverCreate"></a>WdfDriverCreate</h4><p>WdfDriverCreate 是 Windows Driver Frameworks (WDF) 中用于创建驱动程序的函数。它用于初始化驱动程序，并将其与 Windows 操作系统进行集成。</p><p>WdfDriverCreate 函数需要填写一个 WDFDRIVER 结构体来定义驱动程序的属性和行为。以下是一些常见的参数：</p><ul><li>DriverName: 驱动程序的名称，用于在调试和日志记录中标识驱动程序。</li><li>DriverVersion: 驱动程序的版本号，用于标识驱动程序的版本。</li><li>DeviceAddVersion: 用于添加新设备的 WDF 函数版本。</li><li>DriverUnload: 驱动程序卸载时的回调函数，用于清理资源并执行其他必要的操作。</li><li>DispatchTable: 一个包含驱动程序处理 IRP 请求的回调函数的表。</li><li>RegistryPath: 驱动程序在注册表中的路径，用于存储配置信息和设置。</li></ul><h4 id="WdfDeviceCreate"><a href="#WdfDeviceCreate" class="headerlink" title="WdfDeviceCreate"></a>WdfDeviceCreate</h4><p>WdfDeviceCreate 是 Windows Driver Frameworks (WDF) 中的一个函数，用于创建设备对象并初始化与设备相关的数据结构。它是 WDF 中非常重要和常用的函数之一。</p><p>WdfDeviceCreate 函数需要填写一个 WDFDEVICE_INIT 结构体来定义设备的属性和行为。以下是一些常见的参数：</p><ul><li>Driver: 指向驱动程序的指针，用于关联设备和驱动程序。</li><li>DeviceAttributes: 指向调用方分配的 WDF_OBJECT_ATTRIBUTES 结构的指针，该结构包含新设备的属性。</li><li>StackSize: 设备的堆栈大小，用于定义设备对象的执行环境。</li><li>DeviceInit: 指向 WDFDEVICE_INIT 结构的指针的地址，用于初始化设备的状态和行为。</li></ul><p>在调用 WdfDeviceCreate 之后，WDF 将使用提供的参数来创建并初始化一个设备对象。然后，设备可以使用 WDF 提供的其他函数来管理设备的状态、处理请求以及与其他设备或驱动程序进行交互。</p><p>需要注意的是，WdfDeviceCreate 是一个高级别的函数，通常用于创建完整的设备对象。对于较简单的设备或需要更精细控制的情况，可能需要使用其他 WDF 函数来手动创建和配置设备对象。同时，在使用 WdfDeviceCreate 和其他 WDF 函数时，应注意遵循正确的使用方法和规范，以避免产生潜在的问题和风险。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 驱动 </category>
          
          <category> windows驱动开发教程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>监控网卡事件</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%9B%91%E6%8E%A7%E7%BD%91%E5%8D%A1%E7%A6%81%E7%94%A8%E4%BA%8B%E4%BB%B6/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%9B%91%E6%8E%A7%E7%BD%91%E5%8D%A1%E7%A6%81%E7%94%A8%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h1><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>可以使用Win32 API中的NotifySubscribeCallouts和NotifyRegisterNetEvent api函数来监控网络适配器状态的改变，包括被禁用的事件。</p><p>具体步骤如下：</p><ol><li><p>使用NotifySubscribeCallouts函数来注册一个回调函数，当网络适配器状态改变时会调用该函数。</p></li><li><p>在回调函数中使用NotifyRegisterNetEvent函数来注册一个网络事件，比如网络适配器被禁用。</p></li><li><p>监听回调函数中传递的事件类型，当事件类型为被禁用时，执行自己的逻辑处理。</p></li></ol><p>示例代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ipexport.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">HandlerRoutine</span><span class="params">(DWORD dwCtrlType)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> CALLBACK</span></span><br><span class="line"><span class="function"><span class="title">NetEventCallback</span><span class="params">(PVOID pCallerContext, ULONG NotificationType, PVOID Notification)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 注册控制事件处理函数</span></span><br><span class="line"><span class="built_in">SetConsoleCtrlHandler</span>(HandlerRoutine, TRUE);</span><br><span class="line"></span><br><span class="line">HANDLE hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, FALSE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line">HANDLE hWaitableHandle[<span class="number">2</span>] = &#123; hEvent, INVALID_HANDLE_VALUE &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册网络事件回调函数</span></span><br><span class="line">DWORD dwFlags = NOTIFY_FILTER_INTERFACE_CHANGE | NOTIFY_FILTER_DRIVER_LOADED;</span><br><span class="line">HMODULE hModule = <span class="literal">NULL</span>;</span><br><span class="line">PVOID pCallerContext = (PVOID)hEvent;</span><br><span class="line">HANDLE hNotifyObject = <span class="literal">NULL</span>;</span><br><span class="line"><span class="built_in">NotifySubscribeCallouts</span>(dwFlags, NetEventCallback, pCallerContext, hModule, &amp;hNotifyObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待事件</span></span><br><span class="line">DWORD dwWaitResult;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">dwWaitResult = <span class="built_in">WaitForMultipleObjects</span>(<span class="number">2</span>, hWaitableHandle, FALSE, INFINITE);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">while</span> (dwWaitResult != WAIT_OBJECT_0);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消订阅并关闭事件句柄</span></span><br><span class="line"><span class="built_in">NotifyUnsubscribeCallouts</span>(hNotifyObject);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hEvent);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">HandlerRoutine</span><span class="params">(DWORD dwCtrlType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> (dwCtrlType)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> CTRL_CLOSE_EVENT:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Close signal received.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> CALLBACK <span class="title">NetEventCallback</span><span class="params">(PVOID pCallerContext, ULONG NotificationType, PVOID Notification)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> (NotificationType)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> NOTIFY_INTERFACE_ARRIVAL:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Interface arrival.&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> NOTIFY_INTERFACE_REMOVAL:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Interface removal.&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> NOTIFY_INTERFACE_ENABLED:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Interface enabled.&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> NOTIFY_INTERFACE_DISABLED:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Interface disabled.&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Unknown notification type.&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PIP_INTERFACE_INFO pIfInfo = (PIP_INTERFACE_INFO)Notification;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听网卡被禁用事件</span></span><br><span class="line"><span class="keyword">if</span> (NotificationType == NOTIFY_INTERFACE_DISABLED)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; Interface % ws has been disabled.&quot;</span>, pIfInfo-&gt;Adapter[<span class="number">0</span>].Name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意事项：</p><ol><li><p>如果需要使用NotifyRegisterNetEvent函数，需要将应用程序编译为驱动程序或系统服务，因为这个函数需要管理员权限。</p></li><li><p>回调函数中不能阻塞或进行耗时操作，因为这会影响系统功能的正常运作。</p></li><li><p>可以使用SetConsoleCtrlHandler函数注册控制事件处理函数，以便在收到控制事件时可以及时退出程序。</p></li></ol><h1 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h1><p>参考<a href="https://learn.microsoft.com/zh-cn/windows/win32/devio/registering-for-device-notification">注册设备通知 - Win32 apps | Microsoft Learn</a></p><p>要获取Windows网卡被禁用事件，您可以使用以下步骤：</p><ol><li>使用Windows API函数注册网络配置更改通知。使用以下代码：</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">HANDLE hNotify = <span class="literal">NULL</span>;</span><br><span class="line">HDEVNOTIFY hDevNotify = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">hNotify = <span class="built_in">FindFirstChangeNotificationW</span>(</span><br><span class="line">    HKEY_LOCAL_MACHINE,</span><br><span class="line">    <span class="string">L&quot;SYSTEM\\CurrentControlSet\\Control\\Network&quot;</span>,</span><br><span class="line">    FALSE,</span><br><span class="line">    FILE_NOTIFY_CHANGE_LAST_WRITE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hNotify == INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hDevNotify = <span class="built_in">RegisterDeviceNotification</span>(</span><br><span class="line">    hwnd,</span><br><span class="line">    &amp;filter,</span><br><span class="line">    DEVICE_NOTIFY_WINDOW_HANDLE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hDevNotify == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，HWND是接收通知的窗口句柄，filter是一些条件，例如通知类型，设备范围等。</p><ol start="2"><li>在您的窗口过程函数中处理通知消息。 它将提供一个 lParam 参数，该参数是一个包含有关更改的结构体。 您可以使用以下代码来检查是否禁用了任何网络适配器：</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_DEVICECHANGE:</span><br><span class="line">    PDEV_BROADCAST_HDR pHdr = (PDEV_BROADCAST_HDR)lParam;</span><br><span class="line">    <span class="keyword">if</span> (pHdr-&gt;dbch_devicetype == DBT_DEVTYP_VOLUME)</span><br><span class="line">    &#123;</span><br><span class="line">        PDEV_BROADCAST_VOLUME pVol = (PDEV_BROADCAST_VOLUME)pHdr;</span><br><span class="line">        <span class="comment">// Check if network adapter is disabled</span></span><br><span class="line">        <span class="keyword">if</span> (pVol-&gt;dbcv_flags &amp; DBTF_MEDIA) <span class="comment">// Media is removed</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Check if any network adapter is disabled</span></span><br><span class="line">            DWORD dwDriveMask = pVol-&gt;dbcv_unitmask;</span><br><span class="line">            <span class="keyword">if</span> (dwDriveMask != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((dwDriveMask &amp; <span class="number">0x01</span>) == <span class="number">0x01</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">char</span> szDrive[<span class="number">4</span>] = &#123; <span class="string">&#x27;A&#x27;</span> + i, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\0&#x27;</span> &#125;;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">GetDriveType</span>(szDrive) == DRIVE_CDROM)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// Network adapter on this drive is disabled</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    dwDriveMask &gt;&gt; = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br></pre></td></tr></table></figure><p>这段代码检查网络适配器是否被禁用，并根据需要执行操作。</p><p>请注意，这些代码只是一种参考。要使它们正常工作，您需要将它们植入到您的代码中，并根据需要进行修改。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 网卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>监控路由事件</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%9B%91%E6%8E%A7%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E7%9B%91%E6%8E%A7%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>相关文章： <a href=".%5C%E4%BD%BF%E7%94%A8winsock2">使用winsock2</a></p></blockquote><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>监控网卡可以使用 <code>NotifyRouteChange</code> 和 <code>NotifyRouteChange2</code> 函数，通过注册回调实现路由监控</p><h1 id="主要步骤"><a href="#主要步骤" class="headerlink" title="主要步骤"></a>主要步骤</h1><ol><li>声明一个回调函数处理通知</li><li>调用notifyRouteChange2注册通知,指定通知类型</li><li>等待通知</li><li>取消通知(可选)</li><li>在回调函数中根据通知类型进行处理</li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iphlpapi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;iphlpapi.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NAMEPRINTFORMAT(X) std::left &lt;&lt; setw(60)&lt;&lt; #X &lt;&lt; <span class="string">&quot;\t\t&quot;</span> &lt;&lt; X</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">ipToString</span><span class="params">(DWORD dwIP)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::string strDestIp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">std::string strMaskIp = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">in_addr</span> network;</span><br><span class="line">network.S_un.S_addr = dwIP;    <span class="comment">//为s_addr赋值--网络字节序</span></span><br><span class="line">strDestIp = <span class="built_in">inet_ntoa</span>(network);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strDestIp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> CALLBACK <span class="title">RouteChanged1</span><span class="params">(<span class="type">void</span>* CallerContext, PMIB_IPFORWARD_ROW2 Table, MIB_NOTIFICATION_TYPE NotificationType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">using</span> context = <span class="built_in">void</span>(*)(DWORD);</span><br><span class="line"></span><br><span class="line">context ctx = (context)CallerContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> PrintTable = [](MIB_IPFORWARD_ROW2 table) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;---------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.InterfaceLuid.Info.IfType) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.InterfaceLuid.Info.NetLuidIndex) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.InterfaceLuid.Info.Reserved) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.InterfaceLuid.Value) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.InterfaceIndex) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.si_family) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv4.sin_addr.S_un.S_addr) &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; <span class="built_in">ipToString</span>(table.DestinationPrefix.Prefix.Ipv4.sin_addr.S_un.S_addr) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv4.sin_family) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv4.sin_port) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv4.sin_zero) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_addr.u.Byte) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_addr.u.Word) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_family) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_flowinfo) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_port) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_scope_id) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_scope_struct.Level) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_scope_struct.Value) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.DestinationPrefix.Prefix.Ipv6.sin6_scope_struct.Zone) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.NextHop.Ipv4.sin_addr.S_un.S_addr) &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; <span class="built_in">ipToString</span>(table.NextHop.Ipv4.sin_addr.S_un.S_addr) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.NextHop.Ipv6.sin6_addr.u.Byte) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.NextHop.Ipv6.sin6_addr.u.Word) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.SitePrefixLength) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.ValidLifetime) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.PreferredLifetime) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Metric) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Protocol) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Loopback) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.AutoconfigureAddress) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Immortal) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Age) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(table.Origin) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;---------------&quot;</span> &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 处理路由表变更通知</span></span><br><span class="line"><span class="keyword">switch</span> (NotificationType)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> MibParameterNotification:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;1-- 参数被更改&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MibAddInstance:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2-- 添加&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">PrintTable</span>(*Table);</span><br><span class="line"></span><br><span class="line"><span class="built_in">ctx</span>(Table-&gt;DestinationPrefix.Prefix.Ipv4.sin_addr.S_un.S_addr);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MibDeleteInstance:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;3-- 删除&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">PrintTable</span>(*Table);</span><br><span class="line"></span><br><span class="line"><span class="built_in">ctx</span>(Table-&gt;DestinationPrefix.Prefix.Ipv4.sin_addr.S_un.S_addr);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> MibInitialNotification:</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;4-- 函数已注册&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">checkIsMyRoute</span> <span class="params">(DWORD ip)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="built_in">NAMEPRINTFORMAT</span>(<span class="built_in">ipToString</span>(ip)) &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HANDLE hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, FALSE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line">HANDLE hNotify = <span class="literal">NULL</span>;</span><br><span class="line">PVOID callerContext = <span class="built_in">static_cast</span>&lt;PVOID&gt;(&amp;checkIsMyRoute);</span><br><span class="line">BOOLEAN bSuccess = TRUE;</span><br><span class="line">ULONG pdwPrevNotified = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (callerContext != <span class="literal">nullptr</span> &amp;&amp; <span class="built_in">NotifyRouteChange2</span>(AF_UNSPEC, &amp;RouteChanged1, callerContext, bSuccess, &amp;hNotify) != NO_ERROR) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Could not register for route change notifications\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (TRUE) &#123;</span><br><span class="line">DWORD dwWait = <span class="built_in">WaitForSingleObject</span>(hNotify, INFINITE);</span><br><span class="line"><span class="keyword">if</span> (dwWait == WAIT_OBJECT_0) &#123;</span><br><span class="line"><span class="comment">// 接收到异步通知，处理结果</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消监控</span></span><br><span class="line"><span class="built_in">CancelMibChangeNotify2</span>(hNotify);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hNotify);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 监控 </tag>
            
            <tag> route </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 通过 COM 组件 启用&#92;禁用&#92;查看 网卡状态</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/COM%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E7%8A%B6%E6%80%81/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/COM%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E7%8A%B6%E6%80%81/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;NetCon.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ChangeNetState</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line">    INetConnectionManager* pNetManager;</span><br><span class="line">    INetConnection* pNetConnection;</span><br><span class="line">    IEnumNetConnection* pEnum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (S_OK != <span class="built_in">CoCreateInstance</span>(CLSID_ConnectionManager, <span class="literal">NULL</span>, CLSCTX_SERVER, IID_INetConnectionManager, (<span class="type">void</span>**)&amp;pNetManager))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pNetManager-&gt;<span class="built_in">EnumConnections</span>(NCME_DEFAULT, &amp;pEnum);</span><br><span class="line">    pNetManager-&gt;<span class="built_in">Release</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == pEnum)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ULONG celtFetched;</span><br><span class="line">    <span class="keyword">while</span> (pEnum-&gt;<span class="built_in">Next</span>(<span class="number">1</span>, &amp;pNetConnection, &amp;celtFetched) == S_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        NETCON_PROPERTIES* properties;</span><br><span class="line">        pNetConnection-&gt;<span class="built_in">GetProperties</span>(&amp;properties);</span><br><span class="line">        <span class="comment">//properties-&gt;pszwName; //网络连接的名称</span></span><br><span class="line">        <span class="comment">//properties-&gt;pszwDeviceName; //网卡名称</span></span><br><span class="line">        <span class="comment">//properties-&gt;Status;     //状态</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//pNetConnection-&gt;Disconnect(); //禁用网卡</span></span><br><span class="line">        <span class="comment">//pNetConnection-&gt;Connect();    //启用网卡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CoUninitialize</span>();</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>NETCON_PROPERTIES</code> 结构体使用的变量为宽字符，在打印时需要在程序入口调用以下函数才能正确输出。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setlocale</span>(LC_CTYPE, <span class="string">&quot;chs&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 网卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>socket 保活</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/socket%E4%BF%9D%E6%B4%BB/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/socket%E4%BF%9D%E6%B4%BB/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">BOOL _KeepAlive(SP_SOCKET fd)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//定义结构及宏</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KeepAlive</span></span><br><span class="line">&#123;</span><br><span class="line">u_long onoff;</span><br><span class="line">u_long keepalivetime;</span><br><span class="line">u_long keepaliveinterval;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIO_KEEPALIVE_VALS _WSAIOW(IOC_VENDOR,4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//KeepAlive实现</span></span><br><span class="line">KeepAlive inKeepAlive = &#123; <span class="number">0</span> &#125;; <span class="comment">//输入参数</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulInLen = <span class="built_in">sizeof</span>(KeepAlive);</span><br><span class="line"></span><br><span class="line">KeepAlive outKeepAlive = &#123; <span class="number">0</span> &#125;; <span class="comment">//输出参数</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulOutLen = <span class="built_in">sizeof</span>(KeepAlive);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulBytesReturn = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//keepalive xp以前的系统发送5次，xp之后的系统发送10</span></span><br><span class="line">inKeepAlive.onoff = <span class="number">1</span>;</span><br><span class="line">inKeepAlive.keepaliveinterval = <span class="number">5000</span>; <span class="comment">//两次KeepAlive探测间的时间间隔</span></span><br><span class="line">inKeepAlive.keepalivetime = <span class="number">5000</span>; <span class="comment">//开始首次KeepAlive探测前的TCP空闭时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WSAIoctl</span>((SOCKET)fd, SIO_KEEPALIVE_VALS,</span><br><span class="line">(LPVOID)&amp;inKeepAlive, ulInLen,</span><br><span class="line">(LPVOID)&amp;outKeepAlive, ulOutLen,</span><br><span class="line">&amp;ulBytesReturn, <span class="literal">NULL</span>, <span class="literal">NULL</span>) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">LOGT</span>(<span class="string">&quot;Set Keep Alive FAILED.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">LOGT</span>(<span class="string">&quot;Set Keep Alive OK.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iphepler 接口整理</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/iphelper%E6%8E%A5%E5%8F%A3%E6%95%B4%E7%90%86/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/iphelper%E6%8E%A5%E5%8F%A3%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>The following functions are used in Windows networking:</p><h3 id="Obsolete-Functions"><a href="#Obsolete-Functions" class="headerlink" title="Obsolete Functions"></a>Obsolete Functions</h3><p>The following function is provided only for compatibility with 16-bit versions of Windows:</p><p>windows提供了大量的网络辅助函数，如下也为探讨内容：</p><h1 id="IP-Helper-Functions"><a href="#IP-Helper-Functions" class="headerlink" title="IP Helper Functions"></a>IP Helper Functions</h1><p>The following functions retrieve and modify configuration settings for the TCP&#x2F;IP transport on the local computer. The following categorical listing can help determine which collection of functions is best suited for a given task:</p><h3 id="Adapter-Management"><a href="#Adapter-Management" class="headerlink" title="Adapter Management"></a>Adapter Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365909(v=vs.85).aspx">GetAdapterIndex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365915(v=vs.85).aspx">GetAdaptersAddresses</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365917(v=vs.85).aspx">GetAdaptersInfo</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366012(v=vs.85).aspx">GetPerAdapterInfo</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366034(v=vs.85).aspx">GetUniDirectionalAdapterInfo</a></li></ul><h3 id="Address-Resolution-Protocol-ARP-Management"><a href="#Address-Resolution-Protocol-ARP-Management" class="headerlink" title="Address Resolution Protocol (ARP) Management"></a>Address Resolution Protocol (ARP) Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365866(v=vs.85).aspx">CreateIpNetEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365868(v=vs.85).aspx">CreateProxyArpEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365882(v=vs.85).aspx">DeleteIpNetEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365889(v=vs.85).aspx">DeleteProxyArpEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365905(v=vs.85).aspx">FlushIpNetTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365956(v=vs.85).aspx">GetIpNetTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366358(v=vs.85).aspx">SendARP</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366365(v=vs.85).aspx">SetIpNetEntry</a></li></ul><h3 id="Interface-Conversion"><a href="#Interface-Conversion" class="headerlink" title="Interface Conversion"></a>Interface Conversion</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365821(v=vs.85).aspx">ConvertInterfaceAliasToLuid</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365823(v=vs.85).aspx">ConvertInterfaceGuidToLuid</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365826(v=vs.85).aspx">ConvertInterfaceIndexToLuid</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408400(v=vs.85).aspx">ConvertInterfaceLuidToAlias</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365829(v=vs.85).aspx">ConvertInterfaceLuidToGuid</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365835(v=vs.85).aspx">ConvertInterfaceLuidToIndex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365842(v=vs.85).aspx">ConvertInterfaceLuidToNameA</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365847(v=vs.85).aspx">ConvertInterfaceLuidToNameW</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365852(v=vs.85).aspx">ConvertInterfaceNameToLuidA</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365855(v=vs.85).aspx">ConvertInterfaceNameToLuidW</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408408(v=vs.85).aspx">if_indextoname</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408409(v=vs.85).aspx">if_nametoindex</a></li></ul><h3 id="Interface-Management"><a href="#Interface-Management" class="headerlink" title="Interface Management"></a>Interface Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365931(v=vs.85).aspx">GetFriendlyIfIndex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365939(v=vs.85).aspx">GetIfEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365941(v=vs.85).aspx">GetIfEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814412(v=vs.85).aspx">GetIfStackTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365943(v=vs.85).aspx">GetIfTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365945(v=vs.85).aspx">GetIfTable2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814413(v=vs.85).aspx">GetIfTable2Ex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365947(v=vs.85).aspx">GetInterfaceInfo</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814414(v=vs.85).aspx">GetInvertedIfStackTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814417(v=vs.85).aspx">GetIpInterfaceEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814418(v=vs.85).aspx">GetIpInterfaceTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365970(v=vs.85).aspx">GetNumberOfInterfaces</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814437(v=vs.85).aspx">InitializeIpInterfaceEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366362(v=vs.85).aspx">SetIfEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814465(v=vs.85).aspx">SetIpInterfaceEntry</a></li></ul><h3 id="Internet-Protocol-IP-and-Internet-Control-Message-Protocol-ICMP"><a href="#Internet-Protocol-IP-and-Internet-Control-Message-Protocol-ICMP" class="headerlink" title="Internet Protocol (IP) and Internet Control Message Protocol (ICMP)"></a>Internet Protocol (IP) and Internet Control Message Protocol (ICMP)</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365934(v=vs.85).aspx">GetIcmpStatistics</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365959(v=vs.85).aspx">GetIpStatistics</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366037(v=vs.85).aspx">Icmp6CreateFile</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366039(v=vs.85).aspx">Icmp6ParseReplies</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366041(v=vs.85).aspx">Icmp6SendEcho2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366043(v=vs.85).aspx">IcmpCloseHandle</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366045(v=vs.85).aspx">IcmpCreateFile</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366048(v=vs.85).aspx">IcmpParseReplies</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366050(v=vs.85).aspx">IcmpSendEcho</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366051(v=vs.85).aspx">IcmpSendEcho2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb309069(v=vs.85).aspx">IcmpSendEcho2Ex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366369(v=vs.85).aspx">SetIpTTL</a></li></ul><h3 id="IP-Address-Management"><a href="#IP-Address-Management" class="headerlink" title="IP Address Management"></a>IP Address Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365801(v=vs.85).aspx">AddIPAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814398(v=vs.85).aspx">CreateAnycastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814401(v=vs.85).aspx">CreateUnicastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365875(v=vs.85).aspx">DeleteIPAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814402(v=vs.85).aspx">DeleteAnycastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814405(v=vs.85).aspx">DeleteUnicastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814409(v=vs.85).aspx">GetAnycastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814410(v=vs.85).aspx">GetAnycastIpAddressTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365949(v=vs.85).aspx">GetIpAddrTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814424(v=vs.85).aspx">GetMulticastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814425(v=vs.85).aspx">GetMulticastIpAddressTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814427(v=vs.85).aspx">GetUnicastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814428(v=vs.85).aspx">GetUnicastIpAddressTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814438(v=vs.85).aspx">InitializeUnicastIpAddressEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366056(v=vs.85).aspx">IpReleaseAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366057(v=vs.85).aspx">IpRenewAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814452(v=vs.85).aspx">NotifyStableUnicastIpAddressTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814467(v=vs.85).aspx">SetUnicastIpAddressEntry</a></li></ul><h3 id="IP-Address-String-Conversion"><a href="#IP-Address-String-Conversion" class="headerlink" title="IP Address String Conversion"></a>IP Address String Conversion</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814456(v=vs.85).aspx">RtlIpv4AddressToString</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814457(v=vs.85).aspx">RtlIpv4AddressToStringEx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814458(v=vs.85).aspx">RtlIpv4StringToAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814459(v=vs.85).aspx">RtlIpv4StringToAddressEx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814460(v=vs.85).aspx">RtlIpv6AddressToString</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814461(v=vs.85).aspx">RtlIpv6AddressToStringEx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814462(v=vs.85).aspx">RtlIpv6StringToAddress</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814463(v=vs.85).aspx">RtlIpv6StringToAddressEx</a></li></ul><h3 id="IP-Neighbor-Address-Management"><a href="#IP-Neighbor-Address-Management" class="headerlink" title="IP Neighbor Address Management"></a>IP Neighbor Address Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814400(v=vs.85).aspx">CreateIpNetEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814404(v=vs.85).aspx">DeleteIpNetEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814406(v=vs.85).aspx">FlushIpNetTable2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814419(v=vs.85).aspx">GetIpNetEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814420(v=vs.85).aspx">GetIpNetTable2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814455(v=vs.85).aspx">ResolveIpNetEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb736271(v=vs.85).aspx">ResolveNeighbor</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814466(v=vs.85).aspx">SetIpNetEntry2</a></li></ul><h3 id="IP-Path-Management"><a href="#IP-Path-Management" class="headerlink" title="IP Path Management"></a>IP Path Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814407(v=vs.85).aspx">FlushIpPathTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814421(v=vs.85).aspx">GetIpPathEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814423(v=vs.85).aspx">GetIpPathTable</a></li></ul><h3 id="IP-Route-Management"><a href="#IP-Route-Management" class="headerlink" title="IP Route Management"></a>IP Route Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365860(v=vs.85).aspx">CreateIpForwardEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814399(v=vs.85).aspx">CreateIpForwardEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365878(v=vs.85).aspx">DeleteIpForwardEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814403(v=vs.85).aspx">DeleteIpForwardEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365896(v=vs.85).aspx">EnableRouter</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365920(v=vs.85).aspx">GetBestInterface</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365922(v=vs.85).aspx">GetBestInterfaceEx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365924(v=vs.85).aspx">GetBestRoute</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814411(v=vs.85).aspx">GetBestRoute2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814415(v=vs.85).aspx">GetIpForwardEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365953(v=vs.85).aspx">GetIpForwardTable</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814416(v=vs.85).aspx">GetIpForwardTable2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366013(v=vs.85).aspx">GetRTTAndHopCount</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814436(v=vs.85).aspx">InitializeIpForwardEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366363(v=vs.85).aspx">SetIpForwardEntry</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814464(v=vs.85).aspx">SetIpForwardEntry2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366367(v=vs.85).aspx">SetIpStatistics</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb736272(v=vs.85).aspx">SetIpStatisticsEx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366392(v=vs.85).aspx">UnenableRouter</a></li></ul><h3 id="IP-Table-Memory-Management"><a href="#IP-Table-Memory-Management" class="headerlink" title="IP Table Memory Management"></a>IP Table Memory Management</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814408(v=vs.85).aspx">FreeMibTable</a></li></ul><h3 id="IP-Utility"><a href="#IP-Utility" class="headerlink" title="IP Utility"></a>IP Utility</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408401(v=vs.85).aspx">ConvertIpv4MaskToLength</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408402(v=vs.85).aspx">ConvertLengthToIpv4Mask</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb870773(v=vs.85).aspx">CreateSortedAddressPairs</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb408412(v=vs.85).aspx">ParseNetworkString</a></li></ul><h3 id="Network-Configuration"><a href="#Network-Configuration" class="headerlink" title="Network Configuration"></a>Network Configuration</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa365968(v=vs.85).aspx">GetNetworkParams</a></li></ul><h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><ul><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa814397(v=vs.85).aspx">CancelMibChangeNotify2</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366329(v=vs.85).aspx">NotifyAddrChange</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络 </tag>
            
            <tag> windows </tag>
            
            <tag> ip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 winsock2 相关函数</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E4%BD%BF%E7%94%A8winsock2/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E4%BD%BF%E7%94%A8winsock2/</url>
      
        <content type="html"><![CDATA[<p>winsock2.h在最开始include</p><p>ip的一些工具函数在 <code>Iphlpapi.h</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Ws2_32.lib&quot;</span>)</span></span><br></pre></td></tr></table></figure><p><code>windows.h</code> 默认加载 winsock版本1.<br><code>winsock2.h</code> 默认加 windows.h</p><p>不得不加 <code>windows.h</code> 时候记得加宏 <code>WIN32_LEAN_AND_MEAN</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iphlpapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> win </tag>
            
            <tag> winsock </tag>
            
            <tag> iphelper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作网卡类</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E6%93%8D%E4%BD%9C%E7%BD%91%E5%8D%A1%E7%B1%BB/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/%E6%93%8D%E4%BD%9C%E7%BD%91%E5%8D%A1%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在 windows 环境下，使用wmi修改网卡 ip+dns</p></blockquote><h2 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;net_config.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::locale::<span class="built_in">global</span>(std::<span class="built_in">locale</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">NetConfig config;</span><br><span class="line"><span class="comment">//网卡的key可以从注册表获取, 路径: 计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\</span></span><br><span class="line"><span class="comment">config.set_key(&quot;&#123;cd574b17-73e1-42df-a50c-f95d7f15c1d0&#125;&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置静态ip之前要调用下enable_dhcp, 可以把以前设置的ip和网关都清空, 否则注册表会有多个ip信息</span></span><br><span class="line"><span class="keyword">if</span> (config.<span class="built_in">enable_dhcp</span>()) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;enable_dhcp success&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error code: &quot;</span> &lt;&lt; config.<span class="built_in">get_last_error_code</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="built_in">set_ip_config</span>(<span class="string">&quot;192.168.1.100&quot;</span>, <span class="string">&quot;255.255.255.0&quot;</span>, <span class="string">&quot;192.168.1.1&quot;</span>)) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;set_ip_config success&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error code: &quot;</span> &lt;&lt; config.<span class="built_in">get_last_error_code</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="built_in">set_dns</span>(<span class="string">&quot;255.255.255.0&quot;</span>, <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;set_dns success&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;error code: &quot;</span> &lt;&lt; config.<span class="built_in">get_last_error_code</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cin.<span class="built_in">get</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="net-config-h"><a href="#net-config-h" class="headerlink" title="net_config.h"></a>net_config.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//net_config.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Wbemidl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetConfig</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">NetConfig</span>() &#123;&#125;</span><br><span class="line"><span class="built_in">NetConfig</span>(<span class="type">const</span> std::string &amp;key) </span><br><span class="line">:<span class="built_in">key_</span>(key)&#123; &#125;</span><br><span class="line">~<span class="built_in">NetConfig</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置网络设备GUID</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_key</span><span class="params">(<span class="type">const</span> std::string &amp;key)</span> </span>&#123;</span><br><span class="line"><span class="built_in">clear</span>();</span><br><span class="line">key_ = key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//启用DHCP</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">enable_dhcp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//启动静态IP,设置IP,掩码,网关</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_ip_config</span><span class="params">(<span class="type">const</span> std::string &amp;ip, <span class="type">const</span> std::string &amp;mask, <span class="type">const</span> std::string &amp;gateway)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_ip_config</span><span class="params">(<span class="type">const</span> std::string &amp;ip, <span class="type">const</span> std::string &amp;mask)</span></span>;</span><br><span class="line"><span class="comment">//设置网关</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_gateway</span><span class="params">(<span class="type">const</span> std::string &amp;gateway)</span></span>;</span><br><span class="line"><span class="comment">//设置DNS地址</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_dns</span><span class="params">(<span class="type">const</span> std::string &amp;default_dns, <span class="type">const</span> std::string &amp;backup_dns)</span></span>;</span><br><span class="line"><span class="comment">//设置自动DNS</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_auto_dns</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_last_error_code</span><span class="params">()</span><span class="type">const</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> last_error_code_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">NetConfig</span>(<span class="type">const</span> NetConfig &amp;rhs) = <span class="keyword">delete</span>;</span><br><span class="line">NetConfig &amp;<span class="keyword">operator</span> = (<span class="type">const</span> NetConfig &amp;rhs) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">//初始化</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//创建COM数组</span></span><br><span class="line"><span class="function">std::shared_ptr&lt;SAFEARRAY&gt; <span class="title">create_SAFEARRAY</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt; &amp;args)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_dns_base</span><span class="params">(<span class="type">bool</span> is_auto, <span class="type">const</span> std::string &amp;default_dns, <span class="type">const</span> std::string &amp;backup_dns)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">exec_method</span><span class="params">(<span class="type">const</span> <span class="type">wchar_t</span> *method, IWbemClassObject *params_instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">std::string key_;</span><br><span class="line"><span class="type">bool</span> is_init_ = <span class="literal">false</span>;</span><br><span class="line">IWbemLocator* p_instance_ = <span class="literal">NULL</span>;</span><br><span class="line">IWbemServices* p_service_ = <span class="literal">NULL</span>;</span><br><span class="line">IEnumWbemClassObject* p_enum_ = <span class="literal">NULL</span>;</span><br><span class="line">IWbemClassObject *p_obj_ = <span class="literal">NULL</span>;</span><br><span class="line">IWbemClassObject *p_config = <span class="literal">NULL</span>;</span><br><span class="line">VARIANT path_;</span><br><span class="line"><span class="type">int</span> last_error_code_ = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="net-config-cpp"><a href="#net-config-cpp" class="headerlink" title="net_config.cpp"></a>net_config.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//net_config.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;net_config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atlbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;comutil.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;wbemuuid.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;comsuppw.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">NetConfig::~<span class="built_in">NetConfig</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::enable_dhcp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">init</span>())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">exec_method</span>(<span class="string">L&quot;EnableDHCP&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_ip_config</span><span class="params">(<span class="type">const</span> std::string &amp; ip, <span class="type">const</span> std::string &amp; mask, <span class="type">const</span> std::string &amp; gateway)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">set_ip_config</span>(ip, mask)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">set_gateway</span>(gateway);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_ip_config</span><span class="params">(<span class="type">const</span> std::string &amp; ip, <span class="type">const</span> std::string &amp; mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> rt = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">init</span>())</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line"></span><br><span class="line">IWbemClassObject *params = <span class="literal">NULL</span>;</span><br><span class="line">IWbemClassObject *paramsInst = <span class="literal">NULL</span>;</span><br><span class="line">p_config-&gt;<span class="built_in">GetMethod</span>(<span class="type">_bstr_t</span>(<span class="string">&quot;EnableStatic&quot;</span>), <span class="number">0</span>, &amp;params, <span class="literal">NULL</span>);</span><br><span class="line">params-&gt;<span class="built_in">SpawnInstance</span>(<span class="number">0</span>, &amp;paramsInst);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> p1 = <span class="built_in">create_SAFEARRAY</span>(&#123; ip &#125;);</span><br><span class="line">VARIANT paramVt;</span><br><span class="line">paramVt.vt = VT_ARRAY | VT_BSTR;</span><br><span class="line">paramVt.parray = p1.<span class="built_in">get</span>();</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;IPAddress&quot;</span>, <span class="number">0</span>, &amp;paramVt, <span class="literal">NULL</span>);</span><br><span class="line">p1 = <span class="built_in">create_SAFEARRAY</span>(&#123; mask &#125;);</span><br><span class="line">paramVt.parray = p1.<span class="built_in">get</span>();</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;SubnetMask&quot;</span>, <span class="number">0</span>, &amp;paramVt, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">rt = <span class="built_in">exec_method</span>(<span class="string">L&quot;EnableStatic&quot;</span>, paramsInst);</span><br><span class="line"><span class="keyword">if</span> (params) &#123;</span><br><span class="line">params-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_dns</span><span class="params">(<span class="type">const</span> std::string &amp; default_dns, <span class="type">const</span> std::string &amp; backup_dns)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">set_dns_base</span>(<span class="literal">false</span>, default_dns, backup_dns);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_auto_dns</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">set_dns_base</span>(<span class="literal">true</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_gateway</span><span class="params">(<span class="type">const</span> std::string &amp; gateway)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> rt = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">init</span>())</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line"></span><br><span class="line">IWbemClassObject *params = <span class="literal">NULL</span>;</span><br><span class="line">IWbemClassObject *paramsInst = <span class="literal">NULL</span>;</span><br><span class="line">p_config-&gt;<span class="built_in">GetMethod</span>(<span class="type">_bstr_t</span>(<span class="string">&quot;SetGateways&quot;</span>), <span class="number">0</span>, &amp;params, <span class="literal">NULL</span>);</span><br><span class="line">params-&gt;<span class="built_in">SpawnInstance</span>(<span class="number">0</span>, &amp;paramsInst);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> p1 = <span class="built_in">create_SAFEARRAY</span>(&#123; gateway &#125;);</span><br><span class="line">VARIANT paramVt;</span><br><span class="line">paramVt.vt = VT_ARRAY | VT_BSTR;</span><br><span class="line">paramVt.parray = p1.<span class="built_in">get</span>();</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;DefaultIPGateway&quot;</span>, <span class="number">0</span>, &amp;paramVt, <span class="literal">NULL</span>);</span><br><span class="line">paramVt.vt = VT_UINT;</span><br><span class="line">paramVt.uintVal = <span class="number">1</span>;</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;GatewayCostMetric&quot;</span>, <span class="number">0</span>, &amp;paramVt, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">rt = <span class="built_in">exec_method</span>(<span class="string">L&quot;SetGateways&quot;</span>, paramsInst);</span><br><span class="line"><span class="keyword">if</span> (params) &#123;</span><br><span class="line">params-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetConfig::clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (p_config) &#123;</span><br><span class="line">p_config-&gt;<span class="built_in">Release</span>();</span><br><span class="line">p_config = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p_obj_) &#123;</span><br><span class="line">p_obj_-&gt;<span class="built_in">Release</span>();</span><br><span class="line">p_obj_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p_enum_) &#123;</span><br><span class="line">p_enum_-&gt;<span class="built_in">Release</span>();</span><br><span class="line">p_enum_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p_service_) &#123;</span><br><span class="line">p_service_-&gt;<span class="built_in">Release</span>();</span><br><span class="line">p_service_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p_instance_) &#123;</span><br><span class="line">p_instance_-&gt;<span class="built_in">Release</span>();</span><br><span class="line">p_instance_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (is_init_) &#123;</span><br><span class="line"><span class="built_in">CoUninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line">is_init_ = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (is_init_) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 1: Initialize COM.</span></span><br><span class="line">HRESULThres = <span class="built_in">CoInitializeEx</span>(<span class="number">0</span>, COINIT_MULTITHREADED);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;CoInitializeEx failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// Step 2: Set general COM security levels</span></span><br><span class="line"><span class="comment">hres = CoInitializeSecurity(</span></span><br><span class="line"><span class="comment">NULL,</span></span><br><span class="line"><span class="comment">-1,                          // COM negotiates service</span></span><br><span class="line"><span class="comment">NULL,                        // Authentication services</span></span><br><span class="line"><span class="comment">NULL,                        // Reserved</span></span><br><span class="line"><span class="comment">RPC_C_AUTHN_LEVEL_DEFAULT,   // Default authentication </span></span><br><span class="line"><span class="comment">RPC_C_IMP_LEVEL_IMPERSONATE, // Default Impersonation  </span></span><br><span class="line"><span class="comment">NULL,                        // Authentication info</span></span><br><span class="line"><span class="comment">EOAC_NONE,                   // Additional capabilities </span></span><br><span class="line"><span class="comment">NULL                         // Reserved</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;CoInitializeSecurity failed&quot;);</span></span><br><span class="line"><span class="comment">if (FAILED(hres)) &#123;</span></span><br><span class="line"><span class="comment">#ifdef _DEBUG</span></span><br><span class="line"><span class="comment">cout &lt;&lt; &quot;CoInitializeSecurity failed: &quot; &lt;&lt; hres &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"><span class="comment">return false;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 3:  Obtain the initial locator to WMI</span></span><br><span class="line">hres = <span class="built_in">CoCreateInstance</span>(</span><br><span class="line">CLSID_WbemLocator,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">CLSCTX_INPROC_SERVER,</span><br><span class="line">IID_IWbemLocator,</span><br><span class="line">(LPVOID*)&amp;p_instance_);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;CoCreateInstance failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;CoCreateInstance failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 4: Connect to the local root\cimv2 namespace and obtain pointer pSvc to make IWbemServices calls.</span></span><br><span class="line">hres = p_instance_-&gt;<span class="built_in">ConnectServer</span>(</span><br><span class="line"><span class="type">_bstr_t</span>(<span class="string">L&quot;ROOT\\CIMV2&quot;</span>),</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">&amp;p_service_</span><br><span class="line">);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;ConnectServer failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ConnectServer failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 5:  Set security levels for the proxy</span></span><br><span class="line">hres = <span class="built_in">CoSetProxyBlanket</span>(</span><br><span class="line">p_service_,                        <span class="comment">// Indicates the proxy to set</span></span><br><span class="line">RPC_C_AUTHN_WINNT,           <span class="comment">// RPC_C_AUTHN_xxx </span></span><br><span class="line">RPC_C_AUTHZ_NONE,            <span class="comment">// RPC_C_AUTHZ_xxx </span></span><br><span class="line"><span class="literal">NULL</span>,                        <span class="comment">// Server principal name </span></span><br><span class="line">RPC_C_AUTHN_LEVEL_CALL,      <span class="comment">// RPC_C_AUTHN_LEVEL_xxx </span></span><br><span class="line">RPC_C_IMP_LEVEL_IMPERSONATE, <span class="comment">// RPC_C_IMP_LEVEL_xxx</span></span><br><span class="line"><span class="literal">NULL</span>,                        <span class="comment">// client identity</span></span><br><span class="line">EOAC_NONE                    <span class="comment">// proxy capabilities </span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;CoSetProxyBlanket failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;CoSetProxyBlanket failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过适配器名称来找到指定的适配器对象.</span></span><br><span class="line">CComBSTR TheQuery = <span class="string">L&quot;SELECT * FROM Win32_NetworkAdapterConfiguration WHERE SettingID = \&quot;&quot;</span>;</span><br><span class="line">std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="type">wchar_t</span>&gt;, <span class="type">wchar_t</span>&gt; conversion;</span><br><span class="line">TheQuery += conversion.<span class="built_in">from_bytes</span>(key_).<span class="built_in">c_str</span>();</span><br><span class="line">TheQuery += <span class="string">L&quot;\&quot;&quot;</span>;</span><br><span class="line">hres = p_service_-&gt;<span class="built_in">ExecQuery</span>(</span><br><span class="line"><span class="comment">//SysAllocString(L&quot;WQL&quot;),</span></span><br><span class="line"><span class="string">L&quot;WQL&quot;</span>,</span><br><span class="line">TheQuery,</span><br><span class="line">WBEM_FLAG_RETURN_IMMEDIATELY | WBEM_FLAG_FORWARD_ONLY,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">&amp;p_enum_);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;ExecQuery failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ExecQuery failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the adapter object.</span></span><br><span class="line">ULONG num = <span class="number">0</span>;</span><br><span class="line">hres = p_enum_-&gt;<span class="built_in">Next</span>(WBEM_INFINITE, <span class="number">1</span>, &amp;p_obj_, &amp;num);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;Next failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Next failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ASSERT_THROW(0 &lt; num, &quot;Next failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Next failed num &lt; 1&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">VariantInit</span>(&amp;path_);</span><br><span class="line">hres = p_obj_-&gt;<span class="built_in">Get</span>(<span class="string">L&quot;__PATH&quot;</span>, <span class="number">0</span>, &amp;path_, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;Get path failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Get failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">hres = p_service_-&gt;<span class="built_in">GetObject</span>(<span class="type">_bstr_t</span>(<span class="string">L&quot;Win32_NetworkAdapterConfiguration&quot;</span>), <span class="number">0</span>, <span class="literal">NULL</span>, &amp;p_config, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//ASSERT_THROW(SUCCEEDED(hres), &quot;GetObject Win32_NetworkAdapterConfiguration failed&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hres)) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;GetObject failed: &quot;</span> &lt;&lt; hres &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">is_init_ = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::shared_ptr&lt;SAFEARRAY&gt; <span class="title">NetConfig::create_SAFEARRAY</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt; &amp;args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SAFEARRAY *psa = <span class="built_in">SafeArrayCreateVector</span>(VT_BSTR, <span class="number">0</span>, args.<span class="built_in">size</span>());</span><br><span class="line"><span class="type">long</span> idx[] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; args.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="type">wchar_t</span>&gt;, <span class="type">wchar_t</span>&gt; conversion;</span><br><span class="line">BSTR ip = <span class="built_in">SysAllocString</span>(conversion.<span class="built_in">from_bytes</span>(args[i]).<span class="built_in">c_str</span>());</span><br><span class="line">idx[<span class="number">0</span>] = i;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(<span class="built_in">SafeArrayPutElement</span>(psa, idx, ip))) &#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">SysFreeString</span>(ip);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;SAFEARRAY&gt;(psa, [](SAFEARRAY *psa) &#123;<span class="built_in">SafeArrayDestroy</span>(psa); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::set_dns_base</span><span class="params">(<span class="type">bool</span> is_auto, <span class="type">const</span> std::string &amp; default_dns, <span class="type">const</span> std::string &amp; backup_dns)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> rt = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">init</span>())</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line"></span><br><span class="line">IWbemClassObject *params = <span class="literal">NULL</span>;</span><br><span class="line">IWbemClassObject *paramsInst = <span class="literal">NULL</span>;</span><br><span class="line">p_config-&gt;<span class="built_in">GetMethod</span>(<span class="type">_bstr_t</span>(<span class="string">&quot;SetDNSServerSearchOrder&quot;</span>), <span class="number">0</span>, &amp;params, <span class="literal">NULL</span>);</span><br><span class="line">params-&gt;<span class="built_in">SpawnInstance</span>(<span class="number">0</span>, &amp;paramsInst);</span><br><span class="line"></span><br><span class="line">shared_ptr&lt;SAFEARRAY&gt; p1;</span><br><span class="line"><span class="keyword">if</span> (is_auto) &#123;</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;DNSServerSearchOrder&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (backup_dns.<span class="built_in">size</span>()) &#123;</span><br><span class="line">p1 = <span class="built_in">create_SAFEARRAY</span>(&#123; default_dns, backup_dns &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">p1 = <span class="built_in">create_SAFEARRAY</span>(&#123; default_dns &#125;);</span><br><span class="line">&#125;</span><br><span class="line">VARIANT paramVt;</span><br><span class="line">paramVt.vt = VT_ARRAY | VT_BSTR;</span><br><span class="line">paramVt.parray = p1.<span class="built_in">get</span>();</span><br><span class="line">paramsInst-&gt;<span class="built_in">Put</span>(<span class="string">L&quot;DNSServerSearchOrder&quot;</span>, <span class="number">0</span>, &amp;paramVt, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rt = <span class="built_in">exec_method</span>(<span class="string">L&quot;SetDNSServerSearchOrder&quot;</span>, paramsInst);</span><br><span class="line"><span class="keyword">if</span> (params) &#123;</span><br><span class="line">params-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NetConfig::exec_method</span><span class="params">(<span class="type">const</span> <span class="type">wchar_t</span> * method, IWbemClassObject * params_instance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> rt = <span class="literal">false</span>;</span><br><span class="line">IWbemClassObject *results = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">auto</span> res = p_service_-&gt;<span class="built_in">ExecMethod</span>(path_.bstrVal, <span class="type">_bstr_t</span>(method), <span class="number">0</span>, <span class="literal">NULL</span>, params_instance, &amp;results, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(res)) &#123;</span><br><span class="line">VARIANT vtRet;</span><br><span class="line"><span class="built_in">VariantInit</span>(&amp;vtRet);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">FAILED</span>(results-&gt;<span class="built_in">Get</span>(<span class="string">L&quot;ReturnValue&quot;</span>, <span class="number">0</span>, &amp;vtRet, <span class="literal">NULL</span>, <span class="number">0</span>))) &#123;</span><br><span class="line"><span class="keyword">if</span> (vtRet.uintVal == <span class="number">0</span> || vtRet.uintVal == <span class="number">1</span>) &#123;</span><br><span class="line">rt = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">last_error_code_ = vtRet.uintVal;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line">wcout &lt;&lt; method &lt;&lt; <span class="string">&quot; failed, result: &quot;</span> &lt;&lt; last_error_code_ &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ExecMethod Get ReturnValue failed: &quot;</span> &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="built_in">VariantClear</span>(&amp;vtRet);</span><br><span class="line">results-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ExecMethod failed: &quot;</span> &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">if</span> (params_instance) &#123;</span><br><span class="line">params_instance-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 网卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>监控指定网卡事件</title>
      <link href="/OS/Windows/%E7%BD%91%E7%BB%9Chelper/(%E8%B6%85%E8%AF%A6%E7%BB%86)%E7%9B%91%E6%8E%A7%E7%BD%91%E5%8D%A1%E4%BA%8B%E4%BB%B62/"/>
      <url>/OS/Windows/%E7%BD%91%E7%BB%9Chelper/(%E8%B6%85%E8%AF%A6%E7%BB%86)%E7%9B%91%E6%8E%A7%E7%BD%91%E5%8D%A1%E4%BA%8B%E4%BB%B62/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="win-com类和接口说明"><a href="#win-com类和接口说明" class="headerlink" title="win com类和接口说明"></a>win com类和接口说明</h1><h2 id="1-INetworkListManager"><a href="#1-INetworkListManager" class="headerlink" title="1. INetworkListManager"></a>1. INetworkListManager</h2><blockquote><p><strong>INetworkListManager</strong> 接口提供了一组用于执行网络列表管理功能的方法。</p><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nn-netlistmgr-inetworklistmanager">[通过com组件获取系统网卡]</a> INetworkListManager接口</p></blockquote><table><thead><tr><th><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-clearsimulatedprofileinfo">INetworkListManager：：ClearSimulatedProfileInfo</a>  清除以前通过 SetSimulatedProfileInfo 应用于 Internet 连接配置文件的连接配置文件值。 下一个 Internet 连接查询（通过 GetInternetConnectionProfile）将使用系统信息。</th></tr></thead><tbody><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-get_isconnected">INetworkListManager：：get_IsConnected</a>  get_IsConnected 属性指定本地计算机是否具有网络连接。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-get_isconnectedtointernet">INetworkListManager：：get_IsConnectedToInternet</a>  get_IsConnectedToInternet 属性指定本地计算机是否具有 Internet 连接。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-getconnectivity">INetworkListManager：：GetConnectivity</a>  GetConnectivity 方法返回计算机的整体连接状态。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-getnetwork">INetworkListManager：：GetNetwork</a>  GetNetwork 方法基于提供的网络 ID 检索网络。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-getnetworkconnection">INetworkListManager：：GetNetworkConnection</a>  GetNetworkConnection 方法基于提供的网络连接 ID 检索网络。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-getnetworkconnections">INetworkListManager：：GetNetworkConnections</a>  GetNetworkConnections 方法枚举已建立的网络连接的完整列表。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-getnetworks">INetworkListManager：：GetNetworks</a>  GetNetworks 方法检索本地计算机上可用的网络列表。</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/nf-netlistmgr-inetworklistmanager-setsimulatedprofileinfo">INetworkListManager：：SetSimulatedProfileInfo</a> SetSimulatedProfileInfo 方法将一组特定的连接配置文件值应用于 Internet 连接配置文件，以支持特定按流量计费的 Internet 连接条件模拟。</td></tr></tbody></table><p>使用参考：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">IUnknown* pUnknown = <span class="literal">NULL</span>;</span><br><span class="line">HRESULT Result = <span class="built_in">CoCreateInstance</span>(CLSID_NetworkListManager, <span class="literal">NULL</span>, CLSCTX_ALL, IID_IUnknown, (<span class="type">void</span>**)&amp;pUnknown);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">    INetworkListManager* pNetworkListManager = <span class="literal">NULL</span>;</span><br><span class="line">    Result = pUnknown-&gt;<span class="built_in">QueryInterface</span>(IID_INetworkListManager, (<span class="type">void</span>**)&amp;pNetworkListManager);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="2-INetConnectionManager"><a href="#2-INetConnectionManager" class="headerlink" title="2. INetConnectionManager"></a>2. INetConnectionManager</h2><blockquote></blockquote><h2 id="3-IConnectionPointContainer"><a href="#3-IConnectionPointContainer" class="headerlink" title="3. IConnectionPointContainer"></a>3. IConnectionPointContainer</h2><blockquote><p>支持可连接对象的连接点。</p></blockquote><table><thead><tr><th><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/ocidl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints">IConnectionPointContainer：：EnumConnectionPoints</a>  创建枚举器对象以循环访问可连接对象中支持的所有连接点，每个传出 IID 一个连接点。</th></tr></thead><tbody><tr><td><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/ocidl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint">IConnectionPointContainer：：FindConnectionPoint</a>  如果 IID 描述支持的传出接口，则返回指向指定 IID 的连接点的 IConnectionPoint 接口的指针。</td></tr></tbody></table><p>使用参考：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">IConnectionPointContainer* pCPContainer = <span class="literal">NULL</span>;</span><br><span class="line">Result = pNetworkListManager-&gt;<span class="built_in">QueryInterface</span>(IID_IConnectionPointContainer, (<span class="type">void</span>**)&amp;pCPContainer);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">    IConnectionPoint* pConnectPoint = <span class="literal">NULL</span>;</span><br><span class="line">    Result = pCPContainer-&gt;<span class="built_in">FindConnectionPoint</span>(IID_INetworkListManagerEvents, &amp;pConnectPoint); <span class="comment">// 查找 IID 对应的连接点</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="4-IConnectionPoint"><a href="#4-IConnectionPoint" class="headerlink" title="4. IConnectionPoint"></a>4. IConnectionPoint</h2><blockquote><p>支持可连接对象的连接点。通过 <code>IConnectionPointContainer::FindConnectionPoint</code> 获取。通过其函数 <code>Advise</code> 可以建立连接点对象与客户端接收器之间的连接。也就是可以通过此接口实现网络事件的监控。</p></blockquote><ul><li>第一个参数参考 <a href="https://learn.microsoft.com/zh-cn/windows/win32/api/netlistmgr/">netListmgr.h</a></li></ul><p>使用参考：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">IConnectionPoint* pConnectPoint = <span class="literal">NULL</span>;</span><br><span class="line">Result = pCPContainer-&gt;<span class="built_in">FindConnectionPoint</span>(IID_INetworkListManagerEvents, &amp;pConnectPoint);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">    DWORD Cookie = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    CNetworkMonitor networkMonitor;</span><br><span class="line">    std::function&lt;<span class="type">void</span>(<span class="type">bool</span>)&gt; monitorFunc = std::<span class="built_in">bind</span>(&amp;CNetworkMonitor::NetworkStatusChangedCallback, networkMonitor, std::placeholders::_1);</span><br><span class="line">    <span class="comment">// CNetworkListManagerEvent 为继承自 INetworkListManagerEvents 的类，重载了 ConnectivityChanged 函数</span></span><br><span class="line">    CNetworkListManagerEvent* pNetEvent = <span class="built_in">new</span>(std::nothrow) <span class="built_in">CNetworkListManagerEvent</span>(monitorFunc);</span><br><span class="line">    <span class="keyword">if</span> (pNetEvent)</span><br><span class="line">    &#123;</span><br><span class="line">        Result = pConnectPoint-&gt;<span class="built_in">Advise</span>((IUnknown*)pNetEvent, &amp;Cookie);</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><h2 id="5-INetConnection"><a href="#5-INetConnection" class="headerlink" title="5. INetConnection"></a>5. INetConnection</h2><p><a href="https://learn.microsoft.com/en-us/windows/win32/api/netcon/nn-netcon-inetconnection">https://learn.microsoft.com/en-us/windows/win32/api/netcon/nn-netcon-inetconnection</a></p><h1 id="使用示例-1："><a href="#使用示例-1：" class="headerlink" title="使用示例 1："></a>使用示例 1：</h1><blockquote><p>监控网络状态，同时可以监控wife的网络质量</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netlistmgr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atlbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;objbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wtypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wlanapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netcon.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;IPHlpApi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;comutil.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;comsuppwd.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;ole32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;wlanapi.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Iphlpapi.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> std::string <span class="title">WCharToMByte</span><span class="params">(LPCWSTR lpcwszStr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::string str;</span><br><span class="line">DWORD dwMinSize = <span class="number">0</span>;</span><br><span class="line">LPSTR lpszStr = <span class="literal">NULL</span>;</span><br><span class="line">dwMinSize = <span class="built_in">WideCharToMultiByte</span>(CP_OEMCP, <span class="literal">NULL</span>, lpcwszStr, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, FALSE);</span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == dwMinSize)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line">lpszStr = <span class="keyword">new</span> <span class="type">char</span>[dwMinSize];</span><br><span class="line"><span class="built_in">WideCharToMultiByte</span>(CP_OEMCP, <span class="literal">NULL</span>, lpcwszStr, <span class="number">-1</span>, lpszStr, dwMinSize, <span class="literal">NULL</span>, FALSE);</span><br><span class="line">str = lpszStr;</span><br><span class="line"><span class="keyword">delete</span>[] lpszStr;</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> std::wstring <span class="title">GUIDToString</span><span class="params">(<span class="type">const</span> GUID&amp; guid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">OLECHAR guidString[<span class="number">40</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">::<span class="built_in">StringFromGUID2</span>(guid, guidString, <span class="built_in">sizeof</span>(guidString));</span><br><span class="line"><span class="keyword">return</span> guidString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> std::string <span class="title">UnicodeToUTF8</span><span class="params">(<span class="type">const</span> std::wstring&amp; wstr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::string ret;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">std::wstring_convert&lt; std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt; &gt; wcv;</span><br><span class="line">ret = wcv.<span class="built_in">to_bytes</span>(wstr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetWorkEvent</span> : <span class="keyword">public</span> INetworkConnectionEvents</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">LONG _ref;</span><br><span class="line">std::function&lt;<span class="type">void</span>()&gt; _callback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">NetWorkEvent</span>(<span class="type">const</span> std::function&lt;<span class="built_in">void</span>()&gt;&amp; cb);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="title">NetworkConnectionConnectivityChanged</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> GUID connectionId,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> NLM_CONNECTIVITY newConnectivity)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="title">NetworkConnectionPropertyChanged</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> GUID connectionId,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> NLM_CONNECTION_PROPERTY_CHANGE flags)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">STDMETHODIMP <span class="title">QueryInterface</span><span class="params">(REFIID refIID, <span class="type">void</span>** pIFace)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> ULONG __stdcall <span class="title">AddRef</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> ULONG __stdcall <span class="title">Release</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NetWorkEvent::<span class="built_in">NetWorkEvent</span>(<span class="type">const</span> std::function&lt;<span class="built_in">void</span>()&gt;&amp; cb)</span><br><span class="line">: _callback(cb)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HRESULT <span class="title">NetWorkEvent::NetworkConnectionConnectivityChanged</span><span class="params">(GUID connectionId, NLM_CONNECTIVITY newConnectivity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::wcout &lt;&lt; <span class="built_in">GUIDToString</span>(connectionId) &lt;&lt; <span class="string">&quot; | NUL_CONNECTIVITY : &quot;</span> &lt;&lt; newConnectivity &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">if</span> (_callback)</span><br><span class="line">&#123;</span><br><span class="line">_callback();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> S_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HRESULT <span class="title">NetWorkEvent::NetworkConnectionPropertyChanged</span><span class="params">(GUID connectionId, NLM_CONNECTION_PROPERTY_CHANGE flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> S_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">STDMETHODIMP <span class="title">NetWorkEvent::QueryInterface</span><span class="params">(REFIID refIID, <span class="type">void</span>** pIFace)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HRESULT hr = S_OK;</span><br><span class="line">*pIFace = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(refIID, IID_IUnknown))</span><br><span class="line">&#123;</span><br><span class="line">*pIFace = (IUnknown*)<span class="keyword">this</span>;</span><br><span class="line">((IUnknown*)*pIFace)-&gt;<span class="built_in">AddRef</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(refIID, IID_INetworkConnectionEvents))</span><br><span class="line">&#123;</span><br><span class="line">*pIFace = (INetworkConnectionEvents*)<span class="keyword">this</span>;</span><br><span class="line">((IUnknown*)*pIFace)-&gt;<span class="built_in">AddRef</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">hr = E_NOINTERFACE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> hr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG <span class="title">NetWorkEvent::AddRef</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (ULONG)<span class="built_in">InterlockedIncrement</span>(&amp;_ref);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG <span class="title">NetWorkEvent::Release</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LONG Result = <span class="built_in">InterlockedDecrement</span>(&amp;_ref);</span><br><span class="line"><span class="keyword">if</span> (Result == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">return</span> (ULONG)Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">NetworkType</span></span><br><span class="line">&#123;</span><br><span class="line">NotNetwork,</span><br><span class="line">Ethernet,</span><br><span class="line">Wlan,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">WiFiQuality</span></span><br><span class="line">&#123;</span><br><span class="line">Weak,             <span class="comment">// (-INF, -70dBm)</span></span><br><span class="line">Fair,             <span class="comment">// [-70dBm, -60dBm)</span></span><br><span class="line">Good,             <span class="comment">// [-60dBm, -50dBm)</span></span><br><span class="line">Excellent         <span class="comment">// [-50dBm, +INF)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionInfo</span></span><br><span class="line">&#123;</span><br><span class="line">std::wstring guid;</span><br><span class="line">NetworkType type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetworkMonitor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">OnNotificationCallback</span><span class="params">(PWLAN_NOTIFICATION_DATA Data, PVOID context)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">NetworkMonitor</span>();</span><br><span class="line">~<span class="built_in">NetworkMonitor</span>();</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;ConnectionInfo&gt; <span class="title">GetNetworkConnections</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">NetworkType <span class="title">GetNetAdpaterType</span><span class="params">(<span class="type">const</span> std::wstring&amp; guid)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">OnNetworkStatusChange</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">WiFiQuality <span class="title">GetWiFiSignalQuality</span><span class="params">(<span class="type">const</span> std::wstring&amp; guid)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">OnWiFiQualityChange</span><span class="params">(<span class="type">const</span> GUID&amp; guid)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowNetworkStatus</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">std::unique_ptr&lt;NetWorkEvent&gt; _networkEvent;</span><br><span class="line"></span><br><span class="line">DWORD _cookie;</span><br><span class="line">CComPtr&lt;INetworkListManager&gt; _pNLM;</span><br><span class="line">CComPtr&lt;IConnectionPointContainer&gt; _pCpc;</span><br><span class="line">CComPtr&lt;IConnectionPoint&gt; _pConnectionPoint;</span><br><span class="line"></span><br><span class="line">HANDLE _wlanHandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> NetworkMonitor* <span class="title">InstanceOfNetworkMonitor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">static</span> NetworkMonitor instance;</span><br><span class="line"><span class="keyword">return</span> &amp;instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NetworkMonitor::<span class="built_in">NetworkMonitor</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CoInitializeEx</span>(<span class="literal">NULL</span>, COINIT_MULTITHREADED | COINIT_DISABLE_OLE1DDE);</span><br><span class="line"></span><br><span class="line">HRESULT hr = <span class="built_in">CoCreateInstance</span>(CLSID_NetworkListManager, <span class="literal">NULL</span>, CLSCTX_ALL, IID_INetworkListManager, (LPVOID*)&amp;_pNLM);</span><br><span class="line">hr = _pNLM-&gt;<span class="built_in">QueryInterface</span>(IID_IConnectionPointContainer, (<span class="type">void</span>**)&amp;_pCpc);</span><br><span class="line">hr = _pCpc-&gt;<span class="built_in">FindConnectionPoint</span>(IID_INetworkConnectionEvents, &amp;_pConnectionPoint);</span><br><span class="line"></span><br><span class="line">_networkEvent = std::<span class="built_in">make_unique</span>&lt;NetWorkEvent&gt;(std::<span class="built_in">bind</span>(&amp;NetworkMonitor::OnNetworkStatusChange, <span class="keyword">this</span>));</span><br><span class="line">hr = _pConnectionPoint-&gt;<span class="built_in">Advise</span>((IUnknown*)_networkEvent.<span class="built_in">get</span>(), &amp;_cookie);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NetworkMonitor::~<span class="built_in">NetworkMonitor</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (_pConnectionPoint)</span><br><span class="line">&#123;</span><br><span class="line">_pConnectionPoint-&gt;<span class="built_in">Unadvise</span>(_cookie);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(_wlanHandle);</span><br><span class="line"></span><br><span class="line"><span class="built_in">CoUninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">OnNotificationCallback</span><span class="params">(PWLAN_NOTIFICATION_DATA Data, PVOID context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (Data != <span class="literal">NULL</span> &amp;&amp;</span><br><span class="line">Data-&gt;NotificationSource == WLAN_NOTIFICATION_SOURCE_MSM &amp;&amp;</span><br><span class="line">Data-&gt;NotificationCode == wlan_notification_msm_signal_quality_change)</span><br><span class="line">&#123;</span><br><span class="line">WLAN_SIGNAL_QUALITY Qality = (WLAN_SIGNAL_QUALITY)Data-&gt;pData;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;WiFi OnNotification Qality : &quot;</span> &lt;&lt; Qality &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">InstanceOfNetworkMonitor</span>()-&gt;<span class="built_in">OnWiFiQualityChange</span>(Data-&gt;InterfaceGuid);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;ConnectionInfo&gt; <span class="title">NetworkMonitor::GetNetworkConnections</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::vector&lt;ConnectionInfo&gt; result;</span><br><span class="line"></span><br><span class="line">CComPtr&lt;IEnumNetworkConnections&gt; enumConnectons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(_pNLM-&gt;<span class="built_in">GetNetworkConnections</span>(&amp;enumConnectons)))</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;GetNetworkConnections error : &quot;</span> &lt;&lt; <span class="built_in">GetLastError</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (enumConnectons)</span><br><span class="line">&#123;</span><br><span class="line">ULONG lFetch;</span><br><span class="line">INetworkConnection* connection = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">SUCCEEDED</span>(enumConnectons-&gt;<span class="built_in">Next</span>(<span class="number">1</span>, &amp;connection, &amp;lFetch)) &amp;&amp; <span class="literal">nullptr</span> != connection)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否当前连接网卡</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">VARIANT_BOOL isConnectInternet = VARIANT_FALSE;</span></span><br><span class="line"><span class="comment">connection-&gt;get_IsConnectedToInternet(&amp;isConnectInternet);</span></span><br><span class="line"><span class="comment">if (isConnectInternet == VARIANT_FALSE)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">continue;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">ConnectionInfo item;</span><br><span class="line">GUID guid;</span><br><span class="line">INetwork* network;</span><br><span class="line">BSTR strNetWorkName = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(connection-&gt;<span class="built_in">GetNetwork</span>(&amp;network)) &amp;&amp; network != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">network-&gt;<span class="built_in">GetName</span>(&amp;strNetWorkName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string strName = _com_util::<span class="built_in">ConvertBSTRToString</span>(strNetWorkName);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strName.<span class="built_in">compare</span>(<span class="string">&quot;TrustAgent VNIC&quot;</span>) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 GUID</span></span><br><span class="line">connection-&gt;<span class="built_in">GetAdapterId</span>(&amp;guid);</span><br><span class="line">item.guid = <span class="built_in">GUIDToString</span>(guid);</span><br><span class="line"></span><br><span class="line">result.<span class="built_in">push_back</span>(item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (connection)</span><br><span class="line">&#123;</span><br><span class="line">connection-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = result.<span class="built_in">begin</span>(); it != result.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line">it-&gt;type = <span class="built_in">GetNetAdpaterType</span>(it-&gt;guid);</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">partition</span>(result.<span class="built_in">begin</span>(), std::<span class="built_in">partition</span>(result.<span class="built_in">begin</span>(), result.<span class="built_in">end</span>(), [](<span class="type">const</span> ConnectionInfo&amp; info)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> info.type != NetworkType::NotNetwork;</span><br><span class="line">&#125;), [](<span class="type">const</span> ConnectionInfo&amp; info)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> info.type == NetworkType::Ethernet;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = result.<span class="built_in">begin</span>(); it != result.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line">std::wcout &lt;&lt; <span class="string">&quot;connect network guid : &quot;</span> &lt;&lt; it-&gt;guid &lt;&lt; <span class="string">&quot; | type : &quot;</span> &lt;&lt; it-&gt;type &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NetworkType <span class="title">NetworkMonitor::GetNetAdpaterType</span><span class="params">(<span class="type">const</span> std::wstring&amp; guid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> unSize = <span class="built_in">sizeof</span>(IP_ADAPTER_INFO);</span><br><span class="line">std::unique_ptr&lt;<span class="type">uint8_t</span>[]&gt; data = std::<span class="built_in">make_unique</span>&lt;<span class="type">uint8_t</span>[]&gt;(unSize);</span><br><span class="line"><span class="type">bool</span> find = <span class="literal">false</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> unResult = <span class="built_in">GetAdaptersInfo</span>(<span class="built_in">reinterpret_cast</span>&lt;PIP_ADAPTER_INFO&gt;(data.<span class="built_in">get</span>()), &amp;unSize);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ERROR_BUFFER_OVERFLOW == unResult)</span><br><span class="line">&#123;</span><br><span class="line">data = std::<span class="built_in">make_unique</span>&lt;<span class="type">uint8_t</span>[]&gt;(unSize);</span><br><span class="line">unResult = <span class="built_in">GetAdaptersInfo</span>(<span class="built_in">reinterpret_cast</span>&lt;PIP_ADAPTER_INFO&gt;(data.<span class="built_in">get</span>()), &amp;unSize);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS == unResult)</span><br><span class="line">&#123;</span><br><span class="line">PIP_ADAPTER_INFO pIpAdapterInfo = <span class="built_in">reinterpret_cast</span>&lt;PIP_ADAPTER_INFO&gt;(data.<span class="built_in">get</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pIpAdapterInfo)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">UnicodeToUTF8</span>(guid) == pIpAdapterInfo-&gt;AdapterName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> MIB_IF_TYPE_ETHERNET == pIpAdapterInfo-&gt;Type ? NetworkType::Ethernet :</span><br><span class="line">IF_TYPE_IEEE80211 == pIpAdapterInfo-&gt;Type ? NetworkType::Wlan : NetworkType::NotNetwork;</span><br><span class="line">&#125;</span><br><span class="line">pIpAdapterInfo = pIpAdapterInfo-&gt;Next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> NetworkType::NotNetwork;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkMonitor::OnNetworkStatusChange</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">ShowNetworkStatus</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">WiFiQuality <span class="title">NetworkMonitor::GetWiFiSignalQuality</span><span class="params">(<span class="type">const</span> std::wstring&amp; guid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WiFiQuality result = WiFiQuality::Weak;</span><br><span class="line">DWORD dwMaxClient = <span class="number">2</span>;</span><br><span class="line">DWORD dwCurVersion = <span class="number">0</span>;</span><br><span class="line">DWORD dwResult = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">PWLAN_INTERFACE_INFO_LIST pIfList = <span class="literal">NULL</span>;</span><br><span class="line">PWLAN_INTERFACE_INFO pIfInfo = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">PWLAN_AVAILABLE_NETWORK_LIST pBssList = <span class="literal">NULL</span>;</span><br><span class="line">PWLAN_AVAILABLE_NETWORK pBssEntry = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> iRSSI = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_wlanHandle == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">dwResult = <span class="built_in">WlanOpenHandle</span>(dwMaxClient, <span class="literal">NULL</span>, &amp;dwCurVersion, &amp;_wlanHandle);</span><br><span class="line"><span class="keyword">if</span> (dwResult != ERROR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;WlanOpenHandle failed with error: &quot;</span> &lt;&lt; dwResult &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">dwResult = <span class="built_in">WlanRegisterNotification</span>(_wlanHandle, WLAN_NOTIFICATION_SOURCE_ALL, TRUE, <span class="built_in">WLAN_NOTIFICATION_CALLBACK</span>(OnNotificationCallback), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (dwResult != ERROR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;WlanRegisterNotification failed with error: &quot;</span> &lt;&lt; dwResult &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dwResult = <span class="built_in">WlanEnumInterfaces</span>(_wlanHandle, <span class="literal">NULL</span>, &amp;pIfList);</span><br><span class="line"><span class="keyword">if</span> (dwResult != ERROR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;WlanEnumInterfaces failed with error: &quot;</span> &lt;&lt; dwResult &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)pIfList-&gt;dwNumberOfItems; i++)</span><br><span class="line">&#123;</span><br><span class="line">pIfInfo = (WLAN_INTERFACE_INFO*)&amp;pIfList-&gt;InterfaceInfo[i];</span><br><span class="line"><span class="keyword">if</span> (guid != <span class="built_in">GUIDToString</span>(pIfInfo-&gt;InterfaceGuid) || pIfInfo-&gt;isState != wlan_interface_state_connected)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dwResult = <span class="built_in">WlanGetAvailableNetworkList</span>(_wlanHandle,</span><br><span class="line">&amp;pIfInfo-&gt;InterfaceGuid,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">&amp;pBssList);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dwResult != ERROR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;WlanGetAvailableNetworkList failed with error:&quot;</span> &lt;&lt; dwResult &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; pBssList-&gt;dwNumberOfItems; j++)</span><br><span class="line">&#123;</span><br><span class="line">pBssEntry = (WLAN_AVAILABLE_NETWORK*)&amp;pBssList-&gt;Network[j];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pBssEntry-&gt;bNetworkConnectable &amp;&amp; (pBssEntry-&gt;dwFlags &amp; WLAN_AVAILABLE_NETWORK_CONNECTED))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pBssEntry-&gt;wlanSignalQuality == <span class="number">0</span>)</span><br><span class="line">iRSSI = <span class="number">-100</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pBssEntry-&gt;wlanSignalQuality == <span class="number">100</span>)</span><br><span class="line">iRSSI = <span class="number">-50</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">iRSSI = <span class="number">-100</span> + (pBssEntry-&gt;wlanSignalQuality / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Signal Quality:\t &quot;</span> &lt;&lt; pBssEntry-&gt;wlanSignalQuality &lt;&lt; <span class="string">&quot; (RSSI: &quot;</span> &lt;&lt; iRSSI &lt;&lt; <span class="string">&quot; dBm)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">result = iRSSI &lt; <span class="number">-70</span> ? WiFiQuality::Weak :</span><br><span class="line">iRSSI &lt; <span class="number">-60</span> ? WiFiQuality::Fair :</span><br><span class="line">iRSSI &lt; <span class="number">-50</span> ? WiFiQuality::Good : WiFiQuality::Excellent;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (pBssList != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">WlanFreeMemory</span>(pBssList);</span><br><span class="line">pBssList = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pIfList != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">WlanFreeMemory</span>(pIfList);</span><br><span class="line">pIfList = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkMonitor::OnWiFiQualityChange</span><span class="params">(<span class="type">const</span> GUID&amp; guid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> nowQuality = <span class="built_in">GetWiFiSignalQuality</span>(<span class="built_in">GUIDToString</span>(guid));</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;WiFi signal quality now : &quot;</span> &lt;&lt; nowQuality &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">ShowNetworkStatus</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkMonitor::ShowNetworkStatus</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NetworkType type;</span><br><span class="line">WiFiQuality quality;</span><br><span class="line"><span class="keyword">auto</span> connections = <span class="built_in">GetNetworkConnections</span>();</span><br><span class="line"><span class="keyword">if</span> (connections.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">type = NetworkType::NotNetwork;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">type = connections.<span class="built_in">front</span>().type;</span><br><span class="line"><span class="keyword">if</span> (type == NetworkType::Wlan)</span><br><span class="line">&#123;</span><br><span class="line">quality = <span class="built_in">GetWiFiSignalQuality</span>(connections.<span class="built_in">front</span>().guid);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;====== Notify ======&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;* Type : &quot;</span> &lt;&lt; (type == NetworkType::NotNetwork ? <span class="string">&quot;NetworkError&quot;</span> : type == NetworkType::Ethernet ? <span class="string">&quot;Ethernet&quot;</span> : <span class="string">&quot;WiFi&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">if</span> (type == NetworkType::Wlan)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;* Signal : &quot;</span> &lt;&lt; quality + <span class="number">1</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">InstanceOfNetworkMonitor</span>()-&gt;<span class="built_in">ShowNetworkStatus</span>();</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">hours</span>(<span class="number">10</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用示例2"><a href="#使用示例2" class="headerlink" title="使用示例2"></a>使用示例2</h1><blockquote><p>监控网络连接状态</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netlistmgr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netcon.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Shlwapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TLHELP32.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;UserEnv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iphlpapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;shlwapi.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;Iphlpapi.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CNetworkListManagerEvent</span> : <span class="keyword">public</span> INetworkListManagerEvents</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CNetworkListManagerEvent</span>(std::function&lt;<span class="built_in">void</span>(<span class="type">bool</span>)&gt; netChangedHandler) </span><br><span class="line">: <span class="built_in">m_ref</span>(<span class="number">1</span>)</span><br><span class="line">, <span class="built_in">netChangedHandler_</span>(netChangedHandler)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">CNetworkListManagerEvent</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HRESULT STDMETHODCALLTYPE <span class="title">QueryInterface</span><span class="params">(REFIID riid, <span class="type">void</span>** ppvObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HRESULT Result = S_OK;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(riid, IID_IUnknown))</span><br><span class="line">&#123;</span><br><span class="line">*ppvObject = (IUnknown*)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(riid, IID_INetworkListManagerEvents))</span><br><span class="line">&#123;</span><br><span class="line">*ppvObject = (INetworkListManagerEvents*)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">Result = E_NOINTERFACE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG STDMETHODCALLTYPE <span class="title">AddRef</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (ULONG)<span class="built_in">InterlockedIncrement</span>(&amp;m_ref);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG STDMETHODCALLTYPE <span class="title">Release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LONG Result = <span class="built_in">InterlockedDecrement</span>(&amp;m_ref);</span><br><span class="line"><span class="keyword">if</span> (Result == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">return</span> (ULONG)Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="title">ConnectivityChanged</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> NLM_CONNECTIVITY newConnectivity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (newConnectivity == NLM_CONNECTIVITY_DISCONNECTED)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;internet status changed. connect closed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络断开</span></span><br><span class="line"><span class="built_in">netChangedHandler_</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((newConnectivity &amp; NLM_CONNECTIVITY_IPV4_INTERNET) || (newConnectivity &amp; NLM_CONNECTIVITY_IPV6_INTERNET))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;internet status changed. connect success&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络连接成功</span></span><br><span class="line"><span class="built_in">netChangedHandler_</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> S_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">LONG m_ref;</span><br><span class="line">std::function&lt;<span class="type">void</span>(<span class="type">bool</span>)&gt; netChangedHandler_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CNetworkMonitor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CNetworkMonitor</span>() &#123;&#125;;</span><br><span class="line">~<span class="built_in">CNetworkMonitor</span>() &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">// 监控网络状态变化</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">InitNetworkMonitor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;InitNetworkMonitor&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> bSuccess = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  通过NLA接口获取网络状态</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">IUnknown* pUnknown = <span class="literal">NULL</span>;</span><br><span class="line">HRESULT Result = <span class="built_in">CoCreateInstance</span>(CLSID_NetworkListManager, <span class="literal">NULL</span>, CLSCTX_ALL, IID_IUnknown, (<span class="type">void</span>**)&amp;pUnknown);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">INetworkListManager* pNetworkListManager = <span class="literal">NULL</span>;</span><br><span class="line">Result = pUnknown-&gt;<span class="built_in">QueryInterface</span>(IID_INetworkListManager, (<span class="type">void</span>**)&amp;pNetworkListManager);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">VARIANT_BOOL IsConnect = VARIANT_FALSE;</span><br><span class="line">Result = pNetworkListManager-&gt;<span class="built_in">get_IsConnectedToInternet</span>(&amp;IsConnect);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;connect to internet:%s&quot;</span>, IsConnect == VARIANT_TRUE ? <span class="string">&quot;TRUE&quot;</span> : <span class="string">&quot;FALSE&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IConnectionPointContainer* pCPContainer = <span class="literal">NULL</span>;</span><br><span class="line">Result = pNetworkListManager-&gt;<span class="built_in">QueryInterface</span>(IID_IConnectionPointContainer, (<span class="type">void</span>**)&amp;pCPContainer);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">IConnectionPoint* pConnectPoint = <span class="literal">NULL</span>;</span><br><span class="line">Result = pCPContainer-&gt;<span class="built_in">FindConnectionPoint</span>(IID_INetworkListManagerEvents, &amp;pConnectPoint);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">DWORD Cookie = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">CNetworkMonitor networkMonitor;</span><br><span class="line">std::function&lt;<span class="type">void</span>(<span class="type">bool</span>)&gt; monitorFunc = std::<span class="built_in">bind</span>(&amp;CNetworkMonitor::NetworkStatusChangedCallback, networkMonitor, std::placeholders::_1);</span><br><span class="line">CNetworkListManagerEvent* pNetEvent = <span class="built_in">new</span>(std::nothrow) <span class="built_in">CNetworkListManagerEvent</span>(monitorFunc);</span><br><span class="line"><span class="keyword">if</span> (pNetEvent)</span><br><span class="line">&#123;</span><br><span class="line">Result = pConnectPoint-&gt;<span class="built_in">Advise</span>((IUnknown*)pNetEvent, &amp;Cookie);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;InitNetworkMonitor success&quot;</span>);</span><br><span class="line">bSuccess = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">MSG msg;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">GetMessage</span>(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line"><span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (msg.message == WM_QUIT)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pConnectPoint-&gt;<span class="built_in">Unadvise</span>(Cookie);</span><br><span class="line">pConnectPoint-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">pCPContainer-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">pNetworkListManager-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">pUnknown-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CoUninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkStatusChangedCallback</span><span class="params">(<span class="type">bool</span> status)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">g_bNetWorkOnline = status;</span><br><span class="line"><span class="keyword">if</span> (status)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model.<span class="built_in">get</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model-&gt;<span class="built_in">IsOnline</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//休眠唤醒后网络连接成功，自动发送一次心跳</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Sleep wakes up and automatically triggers a heartbeat&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;No login, will not rebuild trust nc&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;rebuild trust nc - g_sp_trust_model is null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StartMonitor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::thread <span class="title">monitorThread</span><span class="params">(&amp;InitNetworkMonitor)</span></span>;</span><br><span class="line">monitorThread.<span class="built_in">detach</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 网络helper </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>监控系统事件（网卡）</title>
      <link href="/OS/Windows/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E4%BA%8B%E4%BB%B6/"/>
      <url>/OS/Windows/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netlistmgr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic_bool <span class="title">g_bNetWorkOnline</span><span class="params">(<span class="literal">true</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CNetworkListManagerEvent</span> : <span class="keyword">public</span> INetworkListManagerEvents</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CNetworkListManagerEvent</span>(std::function&lt;<span class="built_in">void</span>(<span class="type">bool</span>)&gt; netChangedHandler) </span><br><span class="line">: <span class="built_in">m_ref</span>(<span class="number">1</span>)</span><br><span class="line">, <span class="built_in">netChangedHandler_</span>(netChangedHandler)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">CNetworkListManagerEvent</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HRESULT STDMETHODCALLTYPE <span class="title">QueryInterface</span><span class="params">(REFIID riid, <span class="type">void</span>** ppvObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HRESULT Result = S_OK;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(riid, IID_IUnknown))</span><br><span class="line">&#123;</span><br><span class="line">*ppvObject = (IUnknown*)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">IsEqualIID</span>(riid, IID_INetworkListManagerEvents))</span><br><span class="line">&#123;</span><br><span class="line">*ppvObject = (INetworkListManagerEvents*)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">Result = E_NOINTERFACE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG STDMETHODCALLTYPE <span class="title">AddRef</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (ULONG)<span class="built_in">InterlockedIncrement</span>(&amp;m_ref);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ULONG STDMETHODCALLTYPE <span class="title">Release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LONG Result = <span class="built_in">InterlockedDecrement</span>(&amp;m_ref);</span><br><span class="line"><span class="keyword">if</span> (Result == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">return</span> (ULONG)Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="title">ConnectivityChanged</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">/* [in] */</span> NLM_CONNECTIVITY newConnectivity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (newConnectivity == NLM_CONNECTIVITY_DISCONNECTED)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;internet status changed. connect closed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络断开</span></span><br><span class="line"><span class="built_in">netChangedHandler_</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((newConnectivity &amp; NLM_CONNECTIVITY_IPV4_INTERNET) || (newConnectivity &amp; NLM_CONNECTIVITY_IPV6_INTERNET))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;internet status changed. connect success&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络连接成功</span></span><br><span class="line"><span class="built_in">netChangedHandler_</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> S_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">LONG m_ref;</span><br><span class="line">std::function&lt;<span class="type">void</span>(<span class="type">bool</span>)&gt; netChangedHandler_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CNetworkMonitor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CNetworkMonitor</span>() &#123;&#125;;</span><br><span class="line">~<span class="built_in">CNetworkMonitor</span>() &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">// 监控网络状态变化</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">InitNetworkMonitor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;InitNetworkMonitor&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> bSuccess = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  通过NLA接口获取网络状态</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">IUnknown* pUnknown = <span class="literal">NULL</span>;</span><br><span class="line">HRESULT Result = <span class="built_in">CoCreateInstance</span>(CLSID_NetworkListManager, <span class="literal">NULL</span>, CLSCTX_ALL, IID_IUnknown, (<span class="type">void</span>**)&amp;pUnknown);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">INetworkListManager* pNetworkListManager = <span class="literal">NULL</span>;</span><br><span class="line">Result = pUnknown-&gt;<span class="built_in">QueryInterface</span>(IID_INetworkListManager, (<span class="type">void</span>**)&amp;pNetworkListManager);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">VARIANT_BOOL IsConnect = VARIANT_FALSE;</span><br><span class="line">Result = pNetworkListManager-&gt;<span class="built_in">get_IsConnectedToInternet</span>(&amp;IsConnect);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;connect to internet:%s&quot;</span>, IsConnect == VARIANT_TRUE ? <span class="string">&quot;TRUE&quot;</span> : <span class="string">&quot;FALSE&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IConnectionPointContainer* pCPContainer = <span class="literal">NULL</span>;</span><br><span class="line">Result = pNetworkListManager-&gt;<span class="built_in">QueryInterface</span>(IID_IConnectionPointContainer, (<span class="type">void</span>**)&amp;pCPContainer);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">IConnectionPoint* pConnectPoint = <span class="literal">NULL</span>;</span><br><span class="line">Result = pCPContainer-&gt;<span class="built_in">FindConnectionPoint</span>(IID_INetworkListManagerEvents, &amp;pConnectPoint);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line">DWORD Cookie = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">CNetworkMonitor networkMonitor;</span><br><span class="line">std::function&lt;<span class="type">void</span>(<span class="type">bool</span>)&gt; monitorFunc = std::<span class="built_in">bind</span>(&amp;CNetworkMonitor::NetworkStatusChangedCallback, networkMonitor, std::placeholders::_1);</span><br><span class="line">CNetworkListManagerEvent* pNetEvent = <span class="built_in">new</span>(std::nothrow) <span class="built_in">CNetworkListManagerEvent</span>(monitorFunc);</span><br><span class="line"><span class="keyword">if</span> (pNetEvent)</span><br><span class="line">&#123;</span><br><span class="line">Result = pConnectPoint-&gt;<span class="built_in">Advise</span>((IUnknown*)pNetEvent, &amp;Cookie);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">SUCCEEDED</span>(Result))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_DEV_LOGT</span>(<span class="string">&quot;InitNetworkMonitor success&quot;</span>);</span><br><span class="line">bSuccess = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">MSG msg;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">GetMessage</span>(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line"><span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (msg.message == WM_QUIT)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pConnectPoint-&gt;<span class="built_in">Unadvise</span>(Cookie);</span><br><span class="line">pConnectPoint-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">pCPContainer-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">pNetworkListManager-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line">pUnknown-&gt;<span class="built_in">Release</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CoUninitialize</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NetworkStatusChangedCallback</span><span class="params">(<span class="type">bool</span> status)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">g_bNetWorkOnline = status;</span><br><span class="line"><span class="keyword">if</span> (status)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model.<span class="built_in">get</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model-&gt;<span class="built_in">IsOnline</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//休眠唤醒后网络连接成功，自动发送一次心跳</span></span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;Sleep wakes up and automatically triggers a heartbeat&quot;</span>);</span><br><span class="line">g_sp_trust_model-&gt;<span class="built_in">OnWakeToSendHeartBeat</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;rebuild trust nc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (g_sp_trust_model-&gt;<span class="built_in">Session</span>()-&gt;<span class="built_in">NeedsL3Tunnel</span>() &amp;&amp; !g_sp_trust_model-&gt;<span class="built_in">Session</span>()-&gt;<span class="built_in">IsTunnelSvrsEmpty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 网络连接成功后自动触发重连</span></span><br><span class="line"><span class="function">std::thread <span class="title">buildUtunThread</span><span class="params">([] &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">g_sp_trust_model-&gt;NotifyUpMessage(SP_TRUST_TOPIC_BUILD_UTUN, SPJSONObject());</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line">buildUtunThread.<span class="built_in">detach</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;No login, will not rebuild trust nc&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">SP_LOGI</span>(<span class="string">&quot;rebuild trust nc - g_sp_trust_model is null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StartMonitor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::thread <span class="title">monitorThread</span><span class="params">(&amp;InitNetworkMonitor)</span></span>;</span><br><span class="line">monitorThread.<span class="built_in">detach</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>管道demo</title>
      <link href="/OS/Windows/%E7%AE%A1%E9%81%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/OS/Windows/%E7%AE%A1%E9%81%93%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="管道类"><a href="#管道类" class="headerlink" title="管道类"></a>管道类</h1><h2 id="h"><a href="#h" class="headerlink" title=".h"></a>.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIME_ASECOND 1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">PIPEUSERTYPE</span> &#123;</span><br><span class="line">USER_CLIENT, <span class="comment">//客户端</span></span><br><span class="line">USER_SERVER, <span class="comment">//服务端</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PipeIPC</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">PipeIPC</span><span class="params">(PIPEUSERTYPE role)</span> :m_Role(role), m_hPipeHandle(INVALID_HANDLE_VALUE) &#123;</span>&#125;;</span><br><span class="line">~<span class="built_in">PipeIPC</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">WriteData</span><span class="params">(__in <span class="type">const</span> std::string&amp; datas)</span></span>; <span class="comment">//写入数据</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Release</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ReadData</span><span class="params">(__out std::string&amp; datas, __out <span class="type">bool</span> bIsPipeEnd)</span></span>; <span class="comment">//读取数据</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitPipeIPC</span><span class="params">()</span></span>; <span class="comment">//初始化管道通信</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsInit</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">InitSecurityAttributes</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Connect</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisConnect</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">PIPEUSERTYPE m_Role;</span><br><span class="line">HANDLE m_hPipeHandle;</span><br><span class="line">SECURITY_ATTRIBUTES m_sec_attr;  <span class="comment">//security attributes </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="cpp"><a href="#cpp" class="headerlink" title=".cpp"></a>.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PipeIPC.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AccCtrl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AclAPI.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIPE_SERVER_NAME       <span class="string">&quot;\\\\.\\pipe\\TrustAgent\\pipe.ToFixService&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIPE_CLIENT_NAME       <span class="string">&quot;\\\\.\\pipe\\TrustAgent\\pipe.ToTrustAgent&quot;</span></span></span><br><span class="line"></span><br><span class="line">PipeIPC::~<span class="built_in">PipeIPC</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (m_hPipeHandle != INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DisconnectNamedPipe</span>(m_hPipeHandle);</span><br><span class="line"><span class="built_in">CloseHandle</span>(m_hPipeHandle);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">PipeIPC::InitPipeIPC</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (USER_SERVER == m_Role &amp;&amp; <span class="literal">nullptr</span> != m_hPipeHandle)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">InitSecurityAttributes</span>();</span><br><span class="line"><span class="comment">// cout &lt;&lt; &quot;ser&quot; &lt;&lt; endl;</span></span><br><span class="line">m_hPipeHandle = <span class="built_in">CreateNamedPipeA</span>(PIPE_SERVER_NAME, PIPE_ACCESS_DUPLEX, <span class="comment">//双向模式</span></span><br><span class="line">PIPE_TYPE_MESSAGE | PIPE_READMODE_MESSAGE<span class="comment">/* | PIPE_NOWAIT*/</span>,</span><br><span class="line">PIPE_UNLIMITED_INSTANCES,<span class="comment">//设置最大容纳实例数目</span></span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="literal">NULL</span>, (LPSECURITY_ATTRIBUTES)&amp;m_sec_attr);</span><br><span class="line"><span class="comment">//如果管道创建失败</span></span><br><span class="line"><span class="keyword">if</span> (m_hPipeHandle == INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">ConnectNamedPipe</span>(m_hPipeHandle, <span class="literal">nullptr</span>)) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;ConnectNamedPipe failed&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WaitNamedPipeA</span>(PIPE_CLIENT_NAME, TIME_ASECOND * <span class="number">5</span>) == FALSE)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">m_hPipeHandle = <span class="built_in">CreateFileA</span>(</span><br><span class="line">PIPE_CLIENT_NAME,</span><br><span class="line">GENERIC_READ | GENERIC_WRITE,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">OPEN_EXISTING,</span><br><span class="line">FILE_ATTRIBUTE_NORMAL,</span><br><span class="line"><span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果管道创建失败</span></span><br><span class="line"><span class="keyword">if</span> (m_hPipeHandle == INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">WriteData</span>(<span class="string">&quot;[PIPE] ------ V10 Init ------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">PipeIPC::IsInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> m_hPipeHandle == INVALID_HANDLE_VALUE ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[details] 创建管道去管理员权限</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">BOOL <span class="title">PipeIPC::InitSecurityAttributes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">PSID pEveryoneSID = <span class="literal">NULL</span>;</span><br><span class="line">PACL pACL = <span class="literal">NULL</span>;</span><br><span class="line">EXPLICIT_ACCESS ea;</span><br><span class="line">PSECURITY_DESCRIPTOR pSD = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">void</span>* ea_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">void</span>* acl_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">void</span>* sd_addr = <span class="literal">NULL</span>;</span><br><span class="line">SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">AllocateAndInitializeSid</span>(&amp;SIDAuthWorld, <span class="number">1</span>, SECURITY_WORLD_RID, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;pEveryoneSID))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">ZeroMemory</span>(&amp;ea, <span class="built_in">sizeof</span>(EXPLICIT_ACCESS));</span><br><span class="line">ea.grfAccessPermissions = SPECIFIC_RIGHTS_ALL | STANDARD_RIGHTS_ALL;</span><br><span class="line">ea.grfAccessMode = SET_ACCESS;</span><br><span class="line">ea.grfInheritance = NO_INHERITANCE;</span><br><span class="line">ea.Trustee.TrusteeForm = TRUSTEE_IS_SID;</span><br><span class="line">ea.Trustee.TrusteeType = TRUSTEE_IS_WELL_KNOWN_GROUP;</span><br><span class="line">ea.Trustee.ptstrName = (LPTSTR)pEveryoneSID;</span><br><span class="line">ea_addr = &amp;ea;</span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != <span class="built_in">SetEntriesInAcl</span>(<span class="number">1</span>, &amp;ea, <span class="literal">NULL</span>, &amp;pACL))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">goto</span> cleanup;</span><br><span class="line">&#125;</span><br><span class="line">acl_addr = &amp;pACL;</span><br><span class="line">pSD = (PSECURITY_DESCRIPTOR)<span class="built_in">LocalAlloc</span>(LPTR, SECURITY_DESCRIPTOR_MIN_LENGTH);</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == pSD)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">goto</span> cleanup;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">InitializeSecurityDescriptor</span>(pSD, SECURITY_DESCRIPTOR_REVISION))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">goto</span> cleanup;</span><br><span class="line">&#125;</span><br><span class="line">sd_addr = &amp;pSD;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">SetSecurityDescriptorDacl</span>(pSD, TRUE, pACL, FALSE))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">goto</span> cleanup;</span><br><span class="line">&#125;</span><br><span class="line">m_sec_attr.nLength = <span class="built_in">sizeof</span>(SECURITY_ATTRIBUTES);</span><br><span class="line">m_sec_attr.lpSecurityDescriptor = pSD;</span><br><span class="line">m_sec_attr.bInheritHandle = FALSE;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">cleanup:</span><br><span class="line"><span class="keyword">if</span> (pEveryoneSID)</span><br><span class="line"><span class="built_in">FreeSid</span>(pEveryoneSID);</span><br><span class="line"><span class="keyword">if</span> (pACL)</span><br><span class="line"><span class="built_in">LocalFree</span>(pACL);</span><br><span class="line"><span class="keyword">if</span> (pSD)</span><br><span class="line"><span class="built_in">LocalFree</span>(pSD);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PipeIPC::Connect</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">ConnectNamedPipe</span>(m_hPipeHandle, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PipeIPC::DisConnect</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DisconnectNamedPipe</span>(m_hPipeHandle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取数据</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">PipeIPC::ReadData</span><span class="params">(__out std::string&amp; datas, __out <span class="type">bool</span> bIsPipeEnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (INVALID_HANDLE_VALUE == m_hPipeHandle || <span class="literal">nullptr</span> == m_hPipeHandle)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">InitPipeIPC</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD cbRead = <span class="number">0</span>;<span class="comment">//定义数据长度</span></span><br><span class="line">DWORD cbData = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">ReadFile</span>(m_hPipeHandle, &amp;cbData, <span class="built_in">sizeof</span>(cbData), &amp;cbRead, <span class="literal">nullptr</span>) &amp;&amp; <span class="built_in">sizeof</span>(cbData) == cbRead)</span><br><span class="line">&#123;</span><br><span class="line">DWORD error = <span class="built_in">GetLastError</span>();</span><br><span class="line">bIsPipeEnd = (error == ERROR_BROKEN_PIPE ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">datas.<span class="built_in">resize</span>(cbData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">ReadFile</span>(m_hPipeHandle, (LPVOID)datas.<span class="built_in">data</span>(), cbData, &amp;cbRead, <span class="literal">nullptr</span>) &amp;&amp; cbData == cbRead)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">DWORD dwError = <span class="built_in">GetLastError</span>();</span><br><span class="line">bIsPipeEnd = (dwError == ERROR_BROKEN_PIPE) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">datas.<span class="built_in">resize</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//写入数据</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">PipeIPC::WriteData</span><span class="params">(__in <span class="type">const</span> std::string&amp; datas)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m_Role == USER_SERVER)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">bool</span> connect = <span class="built_in">ConnectNamedPipe</span>(m_hPipeHandle, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (!connect)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">InitPipeIPC</span>())</span><br><span class="line">&#123;</span><br><span class="line">DWORD error = <span class="built_in">GetLastError</span>();</span><br><span class="line"><span class="keyword">if</span> (error != ERROR_PIPE_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; &quot;客户端还没连接&quot; &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//连接失败</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">IsInit</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">InitPipeIPC</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接成功！</span></span><br><span class="line">DWORD wLen;</span><br><span class="line"><span class="type">const</span> DWORD cbData = datas.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(datas[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">WriteFile</span>(m_hPipeHandle, &amp;cbData, <span class="built_in">sizeof</span>(cbData), &amp;wLen, <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">WriteFile</span>(m_hPipeHandle, datas.<span class="built_in">c_str</span>(), datas.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(datas[<span class="number">0</span>]), &amp;wLen, <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PipeIPC::Release</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m_hPipeHandle)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DisconnectNamedPipe</span>(m_hPipeHandle);</span><br><span class="line"><span class="built_in">CloseHandle</span>(m_hPipeHandle); <span class="comment">// 关闭句柄</span></span><br><span class="line">m_hPipeHandle = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="定义与声明"><a href="#定义与声明" class="headerlink" title="定义与声明"></a>定义与声明</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__declspec(selectany) PipeIPC* pRead = <span class="keyword">new</span> <span class="built_in">PipeIPC</span>(USER_SERVER);</span><br><span class="line">__declspec(selectany) PipeIPC* pWrite = <span class="keyword">new</span> <span class="built_in">PipeIPC</span>(USER_CLIENT);</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="监听管道"><a href="#监听管道" class="headerlink" title="监听管道"></a>监听管道</h2><blockquote><p> 随程序同时启动</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"><span class="function">BOOL <span class="title">StartPipeRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot;[IPC][THREAD] ,Create PipeReadThread Success, pipe = %p&quot;</span>, pRead );</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot;pipe = %p, pipe-&gt;IsInit()=%d&quot;</span>, pRead, pRead-&gt;<span class="built_in">IsInit</span>());</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> isPipeEnd = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (isPipeEnd)</span><br><span class="line">&#123;</span><br><span class="line">pRead-&gt;<span class="built_in">Connect</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string datas;</span><br><span class="line"><span class="keyword">if</span> (!pRead-&gt;<span class="built_in">ReadData</span>(datas, isPipeEnd))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (isPipeEnd)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot;-----------[PIPE END]----------&quot;</span>);</span><br><span class="line">pRead-&gt;<span class="built_in">DisConnect</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">datas = <span class="string">&quot;Add&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据处理</span></span><br><span class="line"><span class="keyword">if</span> (datas.<span class="built_in">find</span>(<span class="string">&quot;start&quot;</span>) != std::string::npos) <span class="comment">// 启动成功</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot; [PIPE] [REC] TrustAgentStart&quot;</span>);</span><br><span class="line"><span class="comment">// 启动 管道客户端</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">StartPipeWrite</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot; [PIPE] Failed to Create Client Pipe, GetLastError()=&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!datas.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">EventLog</span>(LOG_ALL, <span class="string">&quot;[PIPE] [RECV] datas: %s&quot;</span>, datas.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="comment">// 调用导出的接口</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function">std::thread <span class="title">th</span><span class="params">(HandleFix, datas)</span></span>;</span><br><span class="line">th.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NSPTRUST::SendRpcMsgToPlugin(POLICY_SENDTQA_USER, datas.c_str());</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="写管道"><a href="#写管道" class="headerlink" title="写管道"></a>写管道</h2><p>启动时机，同名管道的监听管道启动后再启动</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">StartPipeWrite</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (pWrite-&gt;<span class="built_in">IsInit</span>())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> pWrite-&gt;<span class="built_in">InitPipeIPC</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写数据</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string datas = <span class="string">&quot;Send data to PIPE Read&quot;</span>;</span><br><span class="line">pWrite-&gt;<span class="built_in">WriteData</span>(datas);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>系统锁</title>
      <link href="/OS/Windows/%E7%B3%BB%E7%BB%9F%E9%94%81/"/>
      <url>/OS/Windows/%E7%B3%BB%E7%BB%9F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：系统锁就是在创建句柄，再次创建该句柄时，会返回失败</p></blockquote><p>[toc]</p><h1 id="系统锁"><a href="#系统锁" class="headerlink" title="系统锁"></a>系统锁</h1><p>系统锁就是使用 <code>CreateMutexA</code> 创建一个句柄，创建成功时，句柄不为空。当再次使用该锁的命名创建时，因为已经创建了一个同名锁了，所以会报错，也就实现了进程启动一次或者函数执行一次的逻辑。</p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WinSingleleton</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"> <span class="built_in">WinSingleleton</span>(string name);</span><br><span class="line"> </span><br><span class="line"> ~<span class="built_in">WinSingleleton</span>() </span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">if</span> (_handle != INVALID_HANDLE_VALUE)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">CloseHandle</span>(_handle);</span><br><span class="line"> &#125;</span><br><span class="line"> _handle = INVALID_HANDLE_VALUE;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"> HANDLE _handle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">WinSingleleton::<span class="built_in">WinSingleleton</span>(string name) </span><br><span class="line"> :_handle(INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> _handle = <span class="built_in">CreateMutexA</span>(<span class="literal">NULL</span>, FALSE, name.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 锁 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【windows】查询处理器架构</title>
      <link href="/OS/Windows/%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84/"/>
      <url>/OS/Windows/%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>问题： 在 <code>arm</code> 架构的 <code>windows</code> 上使用 <code>GetSystemInfo</code> 获取到的 <code>wProcessorArchitecture</code> 参数不准确。</p><blockquote><p> 由于 <code>arm</code> 架构的 <code>windows</code> 操作系统非常少见，所以客户端上线时并没有回归过检测 <code>arm</code> 操作系统。导致上线后出现驱动安装失败问题。</p></blockquote><p>[toc]</p><h1 id="使用-GetSystemInfo-查询"><a href="#使用-GetSystemInfo-查询" class="headerlink" title="使用 GetSystemInfo 查询"></a>使用 <code>GetSystemInfo</code> 查询</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">GetNcProcessorArchitecture</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SYSTEM_INFO si = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="built_in">GetSystemInfo</span>(&amp;si);</span><br><span class="line">DWORD architecture = si.wProcessorArchitecture;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_INTEL 0 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_MIPS 1  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_ALPHA 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_PPC 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_SHX 4 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_ARM 5  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_IA64 6 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_ALPHA64 7  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_MSIL 8  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_AMD64 9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROCESSOR_ARCHITECTURE_ARM64 12</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (architecture == PROCESSOR_ARCHITECTURE_AMD64)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;amd64&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (architecture == PROCESSOR_ARCHITECTURE_INTEL)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;i386&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (architecture == PROCESSOR_ARCHITECTURE_ARM64 || architecture == PROCESSOR_ARCHITECTURE_ARM)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;arm&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 <code>GetSystemInfo</code> 查询的 <code>wProcessorArchitecture</code> 的值为 <code>0</code>。</p><h1 id="查询注册表"><a href="#查询注册表" class="headerlink" title="查询注册表"></a>查询注册表</h1><p>调研一番后，发现使用注册表的方式更稳妥一点。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HKEY hKey;</span><br><span class="line">    TCHAR processorArchitecture[<span class="number">255</span>];</span><br><span class="line">    DWORD bufferSize = <span class="built_in">sizeof</span>(processorArchitecture);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开注册表键</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">RegOpenKeyEx</span>(HKEY_LOCAL_MACHINE, <span class="built_in">TEXT</span>(<span class="string">&quot;SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment&quot;</span>), <span class="number">0</span>, KEY_READ, &amp;hKey) == ERROR_SUCCESS) &#123;</span><br><span class="line">        <span class="comment">// 读取注册表值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">RegQueryValueEx</span>(hKey, <span class="built_in">TEXT</span>(<span class="string">&quot;PROCESSOR_ARCHITECTURE&quot;</span>), <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="built_in">reinterpret_cast</span>&lt;LPBYTE&gt;(processorArchitecture), &amp;bufferSize) == ERROR_SUCCESS) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Processor Architecture: &quot;</span> &lt;&lt; processorArchitecture;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// 关闭注册表键</span></span><br><span class="line">        <span class="built_in">RegCloseKey</span>(hKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 查询系统信息 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> sysinfo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>判断windows版本</title>
      <link href="/OS/Windows/%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/%E5%88%A4%E6%96%ADwindows%E7%89%88%E6%9C%AC/"/>
      <url>/OS/Windows/%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/%E5%88%A4%E6%96%ADwindows%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="接口说明"><a href="#接口说明" class="headerlink" title="接口说明"></a>接口说明</h1><p>在windows操作系统上，判断系统版本号一般都是使用 <code>GetVersionEx</code> 函数，但是该函数 <code>windows8.1</code> 以后被启用了，尽管可以通过添加宏来忽略 <code>4996</code> 的错误。在新的API中提供了新的接口以供判断操作系统版本：</p><ol><li><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/versionhelpers/">Versionhelpers.h 标头 - Win32 apps | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/zh-cn/windows/win32/winprog/using-the-windows-headers#macros-for-conditional-declarations">声明的宏</a></li></ol><p>本文介绍如何使用 <code>IsWindowsVersionOrGreater </code> 和 <code>verifyVersionInfoW</code> 函数。</p><p>关于如何查询windows版本号可以看这个文档： <a href="https://learn.microsoft.com/zh-cn/cpp/porting/modifying-winver-and-win32-winnt?view=msvc-170">更新 WINVER 和 _WIN32_WINNT | Microsoft Learn</a></p><h1 id="Windows各个版本的宏"><a href="#Windows各个版本的宏" class="headerlink" title="Windows各个版本的宏"></a>Windows各个版本的宏</h1><table><thead><tr><th align="left">所需的最低系统</th><th align="left">NTDDI_VERSION的值</th></tr></thead><tbody><tr><td align="left">Windows 10 1903 “19H1”</td><td align="left"><strong>NTDDI_WIN10_19H1</strong> (0x0A000007)</td></tr><tr><td align="left">Windows 10 1809 “红石 5”</td><td align="left"><strong>NTDDI_WIN10_RS5</strong> (0x0A000006)</td></tr><tr><td align="left">Windows 10 1803 “红石 4”</td><td align="left"><strong>NTDDI_WIN10_RS4</strong> (0x0A000005)</td></tr><tr><td align="left">Windows 10 1709 “红石 3”</td><td align="left"><strong>NTDDI_WIN10_RS3</strong> (0x0A000004)</td></tr><tr><td align="left">Windows 10 1703 “红石 2”</td><td align="left"><strong>NTDDI_WIN10_RS2</strong> (0x0A000003)</td></tr><tr><td align="left">Windows 10 1607 “红石 1”</td><td align="left"><strong>NTDDI_WIN10_RS1</strong> (0x0A000002)</td></tr><tr><td align="left">Windows 10 1511“阈值 2”</td><td align="left"><strong>NTDDI_WIN10_TH2</strong> (0x0A000001)</td></tr><tr><td align="left">Windows 10 1507“阈值”</td><td align="left"><strong>NTDDI_WIN10</strong> (0x0A000000)</td></tr><tr><td align="left">Windows 8.1</td><td align="left"><strong>NTDDI_WINBLUE</strong> (0x06030000)</td></tr><tr><td align="left">Windows 8</td><td align="left"><strong>NTDDI_WIN8</strong> (0x06020000)</td></tr><tr><td align="left">Windows 7</td><td align="left"><strong>NTDDI_WIN7</strong> (0x06010000)</td></tr><tr><td align="left">Windows Server 2008</td><td align="left"><strong>NTDDI_WS08</strong> (0x06000100)</td></tr><tr><td align="left">Windows Vista Service Pack 1 (SP1)</td><td align="left"><strong>NTDDI_VISTASP1</strong> (0x06000100)</td></tr><tr><td align="left">Windows Vista</td><td align="left"><strong>NTDDI_VISTA</strong> (0x06000000)</td></tr><tr><td align="left">Windows Server 2003 Service Pack 2 (SP2)</td><td align="left"><strong>NTDDI_WS03SP2</strong> (0x05020200)</td></tr><tr><td align="left">带有 Service Pack 1 (SP1) 的 Windows Server 2003</td><td align="left"><strong>NTDDI_WS03SP1</strong> (0x05020100)</td></tr><tr><td align="left">Windows Server 2003</td><td align="left"><strong>NTDDI_WS03</strong> (0x05020000)</td></tr><tr><td align="left">Windows XP Service Pack 3 (SP3)</td><td align="left"><strong>NTDDI_WINXPSP3</strong> (0x05010300)</td></tr><tr><td align="left">Windows XP Service Pack 2 (SP2)</td><td align="left"><strong>NTDDI_WINXPSP2</strong> (0x05010200)</td></tr><tr><td align="left">Windows XP Service Pack 1 (SP1)</td><td align="left"><strong>NTDDI_WINXPSP1</strong> (0x05010100)</td></tr><tr><td align="left">Windows XP</td><td align="left"><strong>NTDDI_WINXP</strong> (0x05010000)</td></tr></tbody></table><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>关于 函数的三个参数的输入可以参考文档中定义的宏：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> OSVER(Version)  ((Version) &amp; OSVERSION_MASK)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPVER(Version)  (((Version) &amp; SPVERSION_MASK) &gt;&gt; 8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUBVER(Version) (((Version) &amp; SUBVERSION_MASK) )</span></span><br></pre></td></tr></table></figure><p>除此之外，还可以使用以下宏获取三个版本号：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">LOWORD()得到一个32bit数的低16bit  </span></span><br><span class="line"><span class="comment">HIWORD()得到一个32bit数的高16bit</span></span><br><span class="line"><span class="comment">LOBYTE()得到一个16bit数最低（最右边）那个字节</span></span><br><span class="line"><span class="comment">HIBYTE()得到一个16bit数最高（最左边）那个字节</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOWORD(l)           ((WORD)(((DWORD_PTR)(l)) &amp; 0xffff))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HIWORD(l)           ((WORD)((((DWORD_PTR)(l)) &gt;&gt; 16) &amp; 0xffff))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOBYTE(w)           ((BYTE)(((DWORD_PTR)(w)) &amp; 0xff))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HIBYTE(w)           ((BYTE)((((DWORD_PTR)(w)) &gt;&gt; 8) &amp; 0xff))</span></span><br></pre></td></tr></table></figure><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p><code>IsWindowsVersionOrGreater</code> 函数是 Windows API 中的一个函数，用于检查当前运行的操作系统版本是否满足指定的条件。以下是该函数的一些常见用法：</p><ol><li><h2 id="检查特定版本及以上的-Windows-版本："><a href="#检查特定版本及以上的-Windows-版本：" class="headerlink" title="检查特定版本及以上的 Windows 版本："></a>检查特定版本及以上的 Windows 版本：</h2></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：检查 Windows 7 及以上版本</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsWindowsVersionOrGreater</span>(<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 在 Windows 7 或更高版本上执行某些操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><h2 id="检查特定版本和-Service-Pack-的-Windows-版本："><a href="#检查特定版本和-Service-Pack-的-Windows-版本：" class="headerlink" title="检查特定版本和 Service Pack 的 Windows 版本："></a>检查特定版本和 Service Pack 的 Windows 版本：</h2></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：检查 Windows 10 版本 1809（秋季创意者更新）及以上版本</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsWindowsVersionOrGreater</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">17763</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 在 Windows 10 版本 1809（秋季创意者更新）或更高版本上执行某些操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><h2 id="检查是否为特定-Windows-Server-版本："><a href="#检查是否为特定-Windows-Server-版本：" class="headerlink" title="检查是否为特定 Windows Server 版本："></a>检查是否为特定 Windows Server 版本：</h2></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：检查是否为 Windows Server 2016 版本</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsWindowsVersionOrGreater</span>(<span class="built_in">HIBYTE</span>(_WIN32_WINNT_WIN10), <span class="built_in">LOBYTE</span>(_WIN32_WINNT_WIN10), <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 在 Windows Server 2016 或更高版本上执行某些操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><h2 id="检查特定版本、Service-Pack-和产品类型的-Windows-版本："><a href="#检查特定版本、Service-Pack-和产品类型的-Windows-版本：" class="headerlink" title="检查特定版本、Service Pack 和产品类型的 Windows 版本："></a>检查特定版本、Service Pack 和产品类型的 Windows 版本：</h2></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：检查 Windows 8.1 Update 版本且为工作站类型</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsWindowsVersionOrGreater</span>(<span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, VER_GREATER_EQUAL, VER_NT_WORKSTATION))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 在 Windows 8.1 Update 版本且为工作站类型上执行某些操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些示例可以帮助你理解 <code>IsWindowsVersionOrGreater</code> 函数的各种用法，你可以根据实际需求在代码中适当调整参数和条件。</p><p>请注意，<code>IsWindowsVersionOrGreater</code> 是一个动态链接库函数，在使用时需要包含 <code>&lt;Windows.h&gt;</code> 头文件，且需要链接到 <code>Version.lib</code> 库。</p><h1 id="判断-dwPlatformId"><a href="#判断-dwPlatformId" class="headerlink" title="判断 dwPlatformId"></a>判断 dwPlatformId</h1><h2 id="dwPlatformId-字段说明"><a href="#dwPlatformId-字段说明" class="headerlink" title="dwPlatformId 字段说明"></a>dwPlatformId 字段说明</h2><p>在 Windows 系统中，常用的平台标识（Platform ID）定义如下：</p><ul><li><code>VER_PLATFORM_WIN32s</code>：表示 Win32s 子系统，它是为 Windows 3.1 提供的一个扩展运行环境，使得部分 32 位应用程序可以在 Windows 3.1 上运行。</li><li><code>VER_PLATFORM_WIN32_WINDOWS</code>：表示 Windows 9x 系列操作系统，包括 Windows 95、Windows 98 和 Windows ME。这些操作系统都是基于 MS-DOS 的。</li><li><code>VER_PLATFORM_WIN32_NT</code>：表示 Windows NT 系列操作系统，包括 Windows NT、Windows 2000、Windows XP、Windows Server 2003、Windows Vista、Windows 7、Windows 8、Windows 10 等版本。这些操作系统是基于全新的内核设计的，并具有更强大的功能和稳定性。</li></ul><p>每个平台标识对应不同的操作系统系列，因此在开发应用程序时，根据需要选择正确的平台标识是很重要的。</p><h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsWindowsNT</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">OSVERSIONINFOEX osvi;</span><br><span class="line"><span class="built_in">ZeroMemory</span>(&amp;osvi, <span class="built_in">sizeof</span>(OSVERSIONINFOEX));</span><br><span class="line">osvi.dwOSVersionInfoSize = <span class="built_in">sizeof</span>(OSVERSIONINFOEX);</span><br><span class="line"><span class="comment">// osvi.dwPlatformId = VER_PLATFORM_WIN32s;</span></span><br><span class="line"><span class="comment">// osvi.dwPlatformId = VER_PLATFORM_WIN32_WINDOWS;</span></span><br><span class="line">osvi.dwPlatformId = VER_PLATFORM_WIN32_NT;</span><br><span class="line"></span><br><span class="line">DWORDLONG conditionMask = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">VER_SET_CONDITION</span>(conditionMask, VER_PLATFORMID, VER_EQUAL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>  <span class="built_in">VerifyVersionInfo</span>(&amp;osvi, VER_PLATFORMID, conditionMask);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 查询系统信息 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> os </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 降权</title>
      <link href="/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E9%99%8D%E6%9D%83/"/>
      <url>/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E9%99%8D%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h1><p>在服务程序中调用了某一个程序的安装程序，由于权限的问题，这个安装程序也继承了服务的 <code>SYSTEM</code> 权限，导致安装程序与预期不符合。</p><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>最终实现的目标就是在服务中以普通用户的权限去启动安装程序，要以普通用户去启动，就涉及到降权的问题，需要获取用户的信息。在任务管理器详细信息中可以看到，资源管理器是以普通用户的身份启动的，因此可以在服务中以 <code>Explore.exe</code> 的权限去调用安装程序。</p><h1 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h1><p>此逻辑也可以用于解决 <code>UAC</code> 弹窗的问题。</p><ol><li>获取token</li><li>通过token获取用户的会话ID</li><li>通过token和ID启动进程</li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>最终调用的接口为： <code>CreateProcessAsUser</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ExecutePackage</span><span class="params">(LPCSTR pszPath, LPCSTR pszParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">nullptr</span> == pszPath)</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">wstring szPath = <span class="built_in">stringToWstring</span>(pszPath);</span><br><span class="line"></span><br><span class="line">wstring szParams;</span><br><span class="line"><span class="keyword">if</span> (pszParams)</span><br><span class="line">&#123;</span><br><span class="line">szParams = <span class="built_in">stringToWstring</span>(pszParams);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CreateProcessWithAdmin</span>(szPath.<span class="built_in">c_str</span>(), szParams.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>实现如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @fn           </span></span><br><span class="line"><span class="comment">* @brief        CreateProcessWithAdmin</span></span><br><span class="line"><span class="comment">* @param[in]    </span></span><br><span class="line"><span class="comment">*   strpath： 程序路径</span></span><br><span class="line"><span class="comment">*   strParams: 程序执行命令</span></span><br><span class="line"><span class="comment">* @param[out]   </span></span><br><span class="line"><span class="comment">* @return       </span></span><br><span class="line"><span class="comment">*               </span></span><br><span class="line"><span class="comment">* @detail      </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CreateProcessWithAdmin</span><span class="params">(LPCWSTR lpExePath, LPCWSTR lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hExplorerToken = <span class="built_in">GetExplorerToken</span>();</span><br><span class="line">    HANDLE hTokenDup = <span class="literal">NULL</span>;</span><br><span class="line">    LPVOID pEnvironment = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">bool</span> res&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>szErr[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">int</span>iErrCode = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hExplorerToken == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            iErrCode = <span class="built_in">GetLastError</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 复制令牌,把调用方有效的所有访问权限给复制后的令牌.</span></span><br><span class="line">        DWORD dwReturnBytes = <span class="number">0</span>;</span><br><span class="line">        DWORD dwReturnLen = <span class="number">0</span>;</span><br><span class="line">        DWORD dwTokenSessionId = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过token获取sessionId</span></span><br><span class="line">        <span class="keyword">if</span> (::<span class="built_in">GetTokenInformation</span>(hExplorerToken, TokenSessionId, &amp;dwTokenSessionId, <span class="built_in">sizeof</span>(DWORD), &amp;dwReturnLen) == FALSE)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过 SessionId 和 Token运行程序</span></span><br><span class="line">-res = _CreateProcessAsSystemBySession(lpExePath, lpParam, <span class="literal">NULL</span>, dwTokenSessionId, hExplorerToken); <span class="comment">// 改动如下所示</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 改动</span></span><br><span class="line">        <span class="comment">// 判断当前特权token是否已提升，如果已经提升，则直接通过当前的token启动，如果未提升，则通过提升后的token启动</span></span><br><span class="line">+        HANDLE hNewToken = <span class="literal">NULL</span>;</span><br><span class="line">+<span class="keyword">if</span> (<span class="built_in">GetElevatedToken</span>(hExplorerToken, &amp;hNewToken) &amp;&amp; hNewToken)</span><br><span class="line">+&#123;</span><br><span class="line">+res = <span class="built_in">CreateProcessByToken</span>(hNewToken, hExplorerToken, lpExePath, lpParam, <span class="literal">NULL</span>, FALSE);</span><br><span class="line">+<span class="built_in">CloseHandle</span>(hNewToken);</span><br><span class="line">+&#125;</span><br><span class="line">+<span class="keyword">else</span></span><br><span class="line">+&#123;</span><br><span class="line">+res = <span class="built_in">CreateProcessAsSystemBySession</span>(lpExePath, lpParam, <span class="literal">NULL</span>, dwTokenSessionId, hExplorerToken);</span><br><span class="line">+&#125;</span><br><span class="line">+<span class="built_in">CloseHandle</span>(hExplorerToken);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>判断token是否被提升：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">IsElevatedToken</span><span class="params">(HANDLE hToken, PBOOL pbElevated)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DWORD dwReturnBytes = <span class="number">0</span>;</span><br><span class="line">DWORD dwElevateionType = <span class="number">0</span>;</span><br><span class="line">BOOL bElevated = FALSE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hToken &amp;&amp; pbElevated)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetTokenInformation</span>(hToken, TokenElevationType, &amp;dwElevateionType, <span class="built_in">sizeof</span>(dwElevateionType), &amp;dwReturnBytes))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dwElevateionType == TokenElevationTypeFull)</span><br><span class="line">bElevated = TRUE;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (dwElevateionType == TokenElevationTypeDefault)</span><br><span class="line">&#123;</span><br><span class="line">TOKEN_ELEVATION te;</span><br><span class="line"><span class="built_in">ZeroMemory</span>(&amp;te, <span class="built_in">sizeof</span>(te));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetTokenInformation</span>(hToken, TokenElevation, &amp;te, <span class="built_in">sizeof</span>(te), &amp;dwReturnBytes))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (te.TokenIsElevated)</span><br><span class="line">bElevated = TRUE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pbElevated)</span><br><span class="line">*pbElevated = bElevated;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">GetElevatedToken</span><span class="params">(HANDLE hToken, PHANDLE phNewToken)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">BOOL bElevated = FALSE;</span><br><span class="line"></span><br><span class="line"><span class="built_in">IsElevatedToken</span>(hToken, &amp;bElevated);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bElevated)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">DuplicateTokenEx</span>(hToken, TOKEN_ALL_ACCESS, <span class="literal">NULL</span>, SecurityImpersonation, TokenPrimary, phNewToken);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">DWORD dwReturnBytes = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">GetTokenInformation</span>(hToken, TokenLinkedToken, phNewToken, <span class="built_in">sizeof</span>(HANDLE), &amp;dwReturnBytes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取资源管理器的 <code>token</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">HANDLE <span class="title">GetExplorerToken</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">PromotePrivilege</span>();</span><br><span class="line"></span><br><span class="line">    HANDLE hSnapshot = ::<span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HANDLE hExplorerToken = <span class="literal">NULL</span>;</span><br><span class="line">    PROCESSENTRY32 pe = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    pe.dwSize = <span class="built_in">sizeof</span>(pe);</span><br><span class="line"></span><br><span class="line">    BOOL bMore = ::<span class="built_in">Process32First</span>(hSnapshot, &amp;pe);</span><br><span class="line">    <span class="keyword">while</span> (bMore)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">StrCmpI</span>(<span class="string">L&quot;explorer.exe&quot;</span>, pe.szExeFile) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION, FALSE, pe.th32ProcessID);</span><br><span class="line">            <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">OpenProcessToken</span>(hProcess, TOKEN_QUERY, &amp;hExplorerToken))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        bMore = ::<span class="built_in">Process32Next</span>(hSnapshot, &amp;pe);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hSnapshot);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hExplorerToken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>给本进程特权，以便访问系统进程</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @fn       PromotePrivilege</span></span><br><span class="line"><span class="comment">* @brief    调整进程权限      </span></span><br><span class="line"><span class="comment">*               </span></span><br><span class="line"><span class="comment">* @detail   将进程权限提升成具有调试权限的进程，这个权限应该是进程所能具有的最大权限</span></span><br><span class="line"><span class="comment">*           前提启动这个进程的账户必须是一个管理员，否则没法提升</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">BOOL <span class="title">PromotePrivilege</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 附给本进程特权,以便访问系统进程  </span></span><br><span class="line">    HANDLE hToken;</span><br><span class="line">    <span class="comment">// 打开一个进程的访问令牌  </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">OpenProcessToken</span>(<span class="built_in">GetCurrentProcess</span>(), TOKEN_ADJUST_PRIVILEGES, &amp;hToken))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 取得特权名称为&quot;SetDebugPrivilege&quot;的LUID  </span></span><br><span class="line">        LUID uID;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">LookupPrivilegeValue</span>(<span class="literal">NULL</span>, SE_DEBUG_NAME, &amp;uID))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">            <span class="keyword">return</span> FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调整特权级别  </span></span><br><span class="line">        TOKEN_PRIVILEGES tp;</span><br><span class="line">        tp.PrivilegeCount = <span class="number">1</span>; <span class="comment">// 只启动调试权限，所以权限的个数是一个</span></span><br><span class="line">        tp.Privileges[<span class="number">0</span>].Luid = uID;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//当Attributes = SE_PRIVILEGE_ENABLE时，激活权限</span></span><br><span class="line">        <span class="comment">//当Attributes = 0时，关闭权限</span></span><br><span class="line">        tp.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// AdjustTokenPrivileges函数激活或者关闭tp中给定的权限</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">AdjustTokenPrivileges</span>(hToken, FALSE, &amp;tp, <span class="built_in">sizeof</span>(tp), <span class="literal">NULL</span>, <span class="literal">NULL</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">            <span class="keyword">return</span> FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭访问令牌句柄  </span></span><br><span class="line">        <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置当前进程的会话信息：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CreateProcessAsSystemBySession</span><span class="params">(LPCTSTR pszAppName, LPCTSTR pszCmd, LPCTSTR pszCwd, DWORD dwSession, HANDLE hEnvToken)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pszCmd == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> bRet = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    HANDLE hTokenThis = <span class="literal">NULL</span>;</span><br><span class="line">    bRet = <span class="built_in">OpenProcessToken</span>(<span class="built_in">GetCurrentProcess</span>(), TOKEN_DUPLICATE | TOKEN_QUERY, &amp;hTokenThis);</span><br><span class="line">    <span class="keyword">if</span> (!bRet || hTokenThis == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    HANDLE hTokenDup = <span class="literal">NULL</span>;</span><br><span class="line">    bRet = <span class="built_in">DuplicateTokenEx</span>(hTokenThis, MAXIMUM_ALLOWED, <span class="literal">NULL</span>, SecurityIdentification, TokenPrimary, &amp;hTokenDup);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hTokenThis);</span><br><span class="line">    <span class="keyword">if</span> (!bRet || hTokenDup == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">SetTokenInformation</span>(hTokenDup, TokenSessionId, &amp;dwSession, <span class="built_in">sizeof</span>(DWORD)))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hTokenDup);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bRet = <span class="built_in">CreateProcessByToken</span>(hTokenDup, hEnvToken, pszAppName, pszCmd, pszCwd, TRUE);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hTokenDup);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bRet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用接口创建进程：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">BOOL</span><span class="params">(STDMETHODCALLTYPE FAR* LPFNCREATEENVIRONMENTBLOCK)</span> <span class="params">(LPVOID* lpEnvironment, HANDLE  hToken, BOOL    bInherit)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">BOOL</span><span class="params">(STDMETHODCALLTYPE FAR* LPFNDESTROYENVIRONMENTBLOCK)</span> <span class="params">(LPVOID lpEnvironment)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CreateProcessByToken</span><span class="params">(HANDLE hToken, HANDLE hEnvToken, LPCTSTR pszAppName, LPCTSTR pszCmd, LPCTSTR pszCwd, BOOL bWndHide<span class="comment">/* = FALSE*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    STARTUPINFO si = &#123; <span class="built_in">sizeof</span>(si) &#125;;</span><br><span class="line">    PROCESS_INFORMATION pi = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    si.lpDesktop = (LPWSTR)<span class="string">L&quot;Winsta0\\Default&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bWndHide)</span><br><span class="line">    &#123;</span><br><span class="line">        si.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line">        si.wShowWindow = SW_HIDE;</span><br><span class="line">    &#125;</span><br><span class="line">    DWORD  dwCreationFlag = NORMAL_PRIORITY_CLASS | CREATE_NEW_CONSOLE;</span><br><span class="line">    LPVOID pEnvironment = <span class="literal">NULL</span>;</span><br><span class="line">    LPFNCREATEENVIRONMENTBLOCK  lpfnCreateEnvironmentBlock = <span class="literal">NULL</span>;</span><br><span class="line">    LPFNDESTROYENVIRONMENTBLOCK lpfnDestroyEnvironmentBlock = <span class="literal">NULL</span>;</span><br><span class="line">    HMODULE hUserEnvLib = <span class="literal">NULL</span>;</span><br><span class="line">    hUserEnvLib = <span class="built_in">LoadLibrary</span>(<span class="string">L&quot;userenv.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != hUserEnvLib)</span><br><span class="line">    &#123;</span><br><span class="line">        lpfnCreateEnvironmentBlock = (LPFNCREATEENVIRONMENTBLOCK)<span class="built_in">GetProcAddress</span>(hUserEnvLib, <span class="string">&quot;CreateEnvironmentBlock&quot;</span>);</span><br><span class="line">        lpfnDestroyEnvironmentBlock = (LPFNDESTROYENVIRONMENTBLOCK)<span class="built_in">GetProcAddress</span>(hUserEnvLib, <span class="string">&quot;DestroyEnvironmentBlock&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != lpfnCreateEnvironmentBlock)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">lpfnCreateEnvironmentBlock</span>(&amp;pEnvironment, hEnvToken, FALSE))</span><br><span class="line">        &#123;</span><br><span class="line">            dwCreationFlag |= CREATE_UNICODE_ENVIRONMENT; <span class="comment">// must specify</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pEnvironment = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> bRet = <span class="literal">false</span>;</span><br><span class="line">    BOOL bDisableRedirect = FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CreateProcessAsUser</span>(hToken, pszAppName, (LPTSTR)pszCmd, <span class="literal">NULL</span>, <span class="literal">NULL</span>, FALSE, dwCreationFlag, pEnvironment, pszCwd, &amp;si, &amp;pi))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(pi.hThread);</span><br><span class="line"></span><br><span class="line">        DWORD dwRet = <span class="built_in">WaitForSingleObject</span>(pi.hProcess, <span class="number">2</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">if</span> (WAIT_TIMEOUT == dwRet)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (WAIT_OBJECT_0 == dwRet)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            bRet = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(pi.hProcess);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != lpfnDestroyEnvironmentBlock)</span><br><span class="line">        <span class="built_in">lpfnDestroyEnvironmentBlock</span>(pEnvironment);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != hUserEnvLib)</span><br><span class="line">        <span class="built_in">FreeLibrary</span>(hUserEnvLib);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bRet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 权限与会话 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 权限 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提权</title>
      <link href="/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%8F%90%E6%9D%83/"/>
      <url>/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">BOOL  <span class="title">EnablePrivilege</span><span class="params">(LPCTSTR lpszPrivilegeName, BOOL bEnable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> nResult = FALSE;</span><br><span class="line">    <span class="type">int</span> nRetCode = FALSE;</span><br><span class="line">    HANDLE hToken = <span class="literal">NULL</span>;</span><br><span class="line">    TOKEN_PRIVILEGES tkp = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        nRetCode = ::<span class="built_in">OpenProcessToken</span>(<span class="built_in">GetCurrentProcess</span>(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken);</span><br><span class="line">        <span class="keyword">if</span> (!nRetCode)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        nRetCode = ::<span class="built_in">LookupPrivilegeValue</span>(<span class="literal">NULL</span>, lpszPrivilegeName, &amp;tkp.Privileges[<span class="number">0</span>].Luid);</span><br><span class="line">        <span class="keyword">if</span> (!nRetCode)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        tkp.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">        tkp.Privileges[<span class="number">0</span>].Attributes = bEnable ? SE_PRIVILEGE_ENABLED : <span class="number">0</span>;</span><br><span class="line">        nRetCode = ::<span class="built_in">AdjustTokenPrivileges</span>(hToken, FALSE, &amp;tkp, <span class="built_in">sizeof</span>(tkp), <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span> (!nRetCode)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        nResult = TRUE;</span><br><span class="line">    &#125; <span class="keyword">while</span> (FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hToken != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE <span class="title">GetExplorerToken</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">EnablePrivilege</span>(SE_DEBUG_NAME, TRUE);</span><br><span class="line"></span><br><span class="line">    HANDLE hSnapshot = ::<span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HANDLE hExplorerToken = <span class="literal">NULL</span>;</span><br><span class="line">    PROCESSENTRY32 pe = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    pe.dwSize = <span class="built_in">sizeof</span>(pe);</span><br><span class="line"></span><br><span class="line">    BOOL bMore = ::<span class="built_in">Process32First</span>(hSnapshot, &amp;pe);</span><br><span class="line">    <span class="keyword">while</span> (bMore)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_tcsicmp(<span class="string">&quot;explorer.exe&quot;</span>, pe.szExeFile) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION, FALSE, pe.th32ProcessID);</span><br><span class="line">            <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">OpenProcessToken</span>(hProcess, TOKEN_QUERY, &amp;hExplorerToken))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">        &#125;</span><br><span class="line">        bMore = ::<span class="built_in">Process32Next</span>(hSnapshot, &amp;pe);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hSnapshot);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hExplorerToken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HANDLE hExplorerToken = <span class="built_in">GetExplorerToken</span>();</span><br><span class="line"><span class="keyword">if</span> (hExplorerToken == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> szUserProfilePath[MAX_PATH] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">DWORD cchSize = MAX_PATH;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">GetUserProfileDirectoryA</span>(hExplorerToken, szUserProfilePath, &amp;cchSize))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hExplorerToken);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 权限与会话 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>提权工具 psExec.exe</title>
      <link href="/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7/"/>
      <url>/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>使用方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec -i -d -s  cmd.exe <span class="comment"># 就是提权运行cmd</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 权限与会话 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>服务中以管理员&#92;普通权限启动进程</title>
      <link href="/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/"/>
      <url>/OS/Windows/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/%E6%9D%83%E9%99%90%E4%B8%8E%E4%BC%9A%E8%AF%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="管理员权限启动进程"><a href="#管理员权限启动进程" class="headerlink" title="管理员权限启动进程"></a>管理员权限启动进程</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 管理员权限启动进程</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="function">MMSYSSHARED_EXPORT <span class="type">bool</span> <span class="title">CreateProcessWithAdmin</span><span class="params">(<span class="type">const</span> std::wstring&amp; exe, <span class="type">const</span> std::wstring&amp; param, <span class="type">bool</span> show)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">else</span></span></span></span><br><span class="line"><span class="function">MMSYSSHARED_EXPORT <span class="type">bool</span> <span class="title">CreateProcessWithAdmin</span><span class="params">(<span class="type">const</span> std::string&amp; exe, <span class="type">const</span> std::string&amp; param, <span class="type">bool</span> show)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// UNICODE</span></span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hToken&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">    HANDLE hTokenDup&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">    LPVOID pEnvironment&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">    <span class="type">bool</span> res&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">    <span class="type">wchar_t</span>* cmd = (<span class="type">wchar_t</span>*)param.<span class="built_in">c_str</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">char</span>* cmd = (<span class="type">wchar_t</span>*)param.<span class="built_in">c_str</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (exe.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;exe is null!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">GetTokenWithProcessName</span>(<span class="string">L&quot;explorer.exe&quot;</span>, hToken))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;GetTokenWithProcessName Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 复制令牌,把调用方有效的所有访问权限给复制后的令牌.</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">DuplicateTokenEx</span>(hToken, MAXIMUM_ALLOWED<span class="comment">/*TOKEN_ALL_ACCESS*/</span>, <span class="literal">NULL</span><span class="comment">/*&amp;sa*/</span>, SecurityImpersonation, TokenPrimary, &amp;hTokenDup))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;DuplicateTokenEx Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        STARTUPINFO si;</span><br><span class="line">        <span class="built_in">ZeroMemory</span>(&amp;si, <span class="built_in">sizeof</span>(STARTUPINFO));</span><br><span class="line">        si.cb = <span class="built_in">sizeof</span>(STARTUPINFO);</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">        <span class="type">wchar_t</span> desk[]&#123; <span class="built_in">TEXT</span>(<span class="string">&quot;WinSta0\\Default&quot;</span>) &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="type">char</span> desk[]&#123; <span class="built_in">TEXT</span>(<span class="string">&quot;WinSta0\\Default&quot;</span>) &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        si.lpDesktop = desk;</span><br><span class="line">        <span class="keyword">if</span> (show)</span><br><span class="line">        &#123;</span><br><span class="line">            si.wShowWindow = SW_SHOW;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            si.wShowWindow = SW_HIDE;</span><br><span class="line">        &#125;</span><br><span class="line">        si.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line">        PROCESS_INFORMATION pi;</span><br><span class="line">        <span class="comment">// 检索指定用户的环境变量。然后，可以将此块传递给 CreateProcessAsUser 函数。</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">CreateEnvironmentBlock</span>(&amp;pEnvironment, hTokenDup, FALSE))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateEnvironmentBlock Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 缺少环境变量时某些依赖环境变量的程序打不开，或者运行不正常。</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">CreateProcessAsUser</span>(hTokenDup, exe.<span class="built_in">c_str</span>(), cmd, <span class="literal">NULL</span>, <span class="literal">NULL</span>, FALSE</span><br><span class="line">            , NORMAL_PRIORITY_CLASS </span><br><span class="line">            <span class="comment">/*| CREATE_NEW_CONSOLE  */</span> </span><br><span class="line">            | CREATE_UNICODE_ENVIRONMENT</span><br><span class="line">            , pEnvironment, <span class="literal">NULL</span>, &amp;si, &amp;pi))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateProcessAsUser Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 清理</span></span><br><span class="line">    <span class="keyword">if</span> (cmd)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span>[]cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pEnvironment)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">DestroyEnvironmentBlock</span>(pEnvironment);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(hToken)</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">    <span class="keyword">if</span> (hTokenDup)</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hTokenDup);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="普通用户权限启动进程"><a href="#普通用户权限启动进程" class="headerlink" title="普通用户权限启动进程"></a>普通用户权限启动进程</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通用户权限启动进程</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CreateProcessWithUser</span><span class="params">(<span class="type">const</span> std::wstring&amp; exePath, <span class="type">const</span> std::wstring&amp; param, <span class="type">bool</span> show)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">else</span></span></span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CreateProcessWithUser</span><span class="params">(<span class="type">const</span> std::string&amp; exePath, <span class="type">const</span> std::string&amp; param, <span class="type">bool</span> show)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// UNICODE</span></span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hToken = <span class="number">0</span>;</span><br><span class="line">    HANDLE hNewToken = <span class="number">0</span>;</span><br><span class="line">    LPVOID pEnvironment&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">    <span class="type">bool</span> res&#123; <span class="literal">false</span> &#125;;</span><br><span class="line">    <span class="type">int</span> l = param.<span class="built_in">length</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">    <span class="type">wchar_t</span>* cmd = <span class="keyword">new</span> <span class="type">wchar_t</span>[l + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(cmd, param.<span class="built_in">c_str</span>(), l * <span class="built_in">sizeof</span>(<span class="type">wchar_t</span>));</span><br><span class="line">    cmd[l] = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">char</span>* cmd = <span class="keyword">new</span> <span class="type">char</span>[l + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(cmd, param.<span class="built_in">c_str</span>(), l * <span class="built_in">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">    cmd[l] = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// UNICODE</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">GetTokenWithProcessName</span>(<span class="string">L&quot;explorer.exe&quot;</span>, hToken))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;GetTokenWithProcessName Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">DuplicateTokenEx</span>(hToken, TOKEN_ALL_ACCESS, <span class="literal">NULL</span><span class="comment">/*&amp;sa*/</span>, SECURITY_MAX_IMPERSONATION_LEVEL, TokenPrimary, &amp;hNewToken))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;DuplicateTokenEx Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DWORD dwCreationFlag = NORMAL_PRIORITY_CLASS <span class="comment">/*| CREATE_NEW_CONSOLE*/</span> | CREATE_UNICODE_ENVIRONMENT;</span><br><span class="line">        <span class="comment">// 检索指定用户的环境变量。然后，可以将此块传递给 CreateProcessAsUser 函数。</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">CreateEnvironmentBlock</span>(&amp;pEnvironment, hNewToken, FALSE))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateEnvironmentBlock Error: %u&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        STARTUPINFO si;</span><br><span class="line">        PROCESS_INFORMATION pi;</span><br><span class="line">        <span class="built_in">ZeroMemory</span>(&amp;si, <span class="built_in">sizeof</span>(STARTUPINFO));</span><br><span class="line">        si.cb = <span class="built_in">sizeof</span>(STARTUPINFO);</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">        <span class="type">wchar_t</span> desktop[] = <span class="string">L&quot;winsta0\\default&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="type">char</span> desktop[] = <span class="string">&quot;winsta0\\default&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line">        si.lpDesktop = desktop;</span><br><span class="line">        si.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line">        <span class="keyword">if</span> (show)</span><br><span class="line">        &#123;</span><br><span class="line">            si.wShowWindow = SW_SHOW;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            si.wShowWindow = SW_HIDE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">CreateProcessAsUser</span>(hNewToken, exePath.<span class="built_in">c_str</span>(), cmd, <span class="number">0</span>, <span class="number">0</span>, FALSE, dwCreationFlag, pEnvironment, <span class="number">0</span>, &amp;si, &amp;pi))</span><br><span class="line">        &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">            std::string ansicmd = mm::Charset::<span class="built_in">UnicodeToANSI</span>(cmd);</span><br><span class="line">            std::string ansibat = mm::Charset::<span class="built_in">UnicodeToANSI</span>(exePath.<span class="built_in">c_str</span>());</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateProcessAsUser error! LastError=%ld, %s, %s&quot;</span>, <span class="built_in">GetLastError</span>(), ansibat.<span class="built_in">c_str</span>(), ansicmd.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateProcessAsUser error! LastError=%ld, %s, %s&quot;</span>, <span class="built_in">GetLastError</span>(), exePath.<span class="built_in">c_str</span>(), cmd.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// UNICODE</span></span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 清理</span></span><br><span class="line">    <span class="keyword">delete</span>[] cmd;</span><br><span class="line">    <span class="keyword">if</span> (hToken)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hNewToken) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hNewToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pEnvironment)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">DestroyEnvironmentBlock</span>(pEnvironment);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="根据名字查找进程句柄"><a href="#根据名字查找进程句柄" class="headerlink" title="根据名字查找进程句柄"></a>根据名字查找进程句柄</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">GetTokenWithProcessName</span><span class="params">(<span class="type">const</span> <span class="type">wchar_t</span>* szName, HANDLE&amp; hToken)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">else</span></span></span></span><br><span class="line"><span class="function">    <span class="type">bool</span> <span class="title">GetTokenWithProcessName</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* szName, HANDLE&amp; hToken)</span></span></span><br><span class="line"><span class="function"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _DEBUG</span></span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// HANDLE hToken&#123; NULL &#125;;</span></span><br><span class="line">        HANDLE hProcessSnap&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">        PROCESSENTRY32 pe32&#123; <span class="literal">NULL</span> &#125;; </span><br><span class="line">        HANDLE hProcess&#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">        <span class="type">bool</span> res&#123; <span class="literal">false</span> &#125;;</span><br><span class="line">        <span class="keyword">do</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 多用户模式时任务管理器里可能出现多个explorer</span></span><br><span class="line">            <span class="comment">// 需要先获取当前会话ID，再通过枚举进程，通过比较sessionID进而得到token。</span></span><br><span class="line">            <span class="comment">//DWORD dwSessionId = WTSGetActiveConsoleSessionId();</span></span><br><span class="line">            <span class="comment">//PWTS_PROCESS_INFO ppi = NULL;</span></span><br><span class="line">            <span class="comment">//DWORD dwProcessCount = 0;</span></span><br><span class="line">            <span class="comment">//if (WTSEnumerateProcesses(WTS_CURRENT_SERVER_HANDLE, 0, 1, &amp;ppi, &amp;dwProcessCount))</span></span><br><span class="line">            <span class="comment">//&#123;</span></span><br><span class="line">            <span class="comment">//    for (int i = 0; i &lt; dwProcessCount; i++)</span></span><br><span class="line">            <span class="comment">//    &#123;      </span></span><br><span class="line">            <span class="comment">//        if (_wcsicmp(ppi[i].pProcessName, L&quot;explorer.exe&quot;) == 0)</span></span><br><span class="line">            <span class="comment">//        &#123;</span></span><br><span class="line">            <span class="comment">//            if (ppi[i].SessionId == dwSessionId)</span></span><br><span class="line">            <span class="comment">//            &#123;</span></span><br><span class="line">            <span class="comment">//                break;</span></span><br><span class="line">            <span class="comment">//            &#125;</span></span><br><span class="line">            <span class="comment">//        &#125;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            <span class="comment">//    WTSFreeMemory(ppi);</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            hProcessSnap = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);       </span><br><span class="line">            <span class="keyword">if</span> (!hProcessSnap)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;CreateToolhelp32Snapshot error! %d&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pe32.dwSize = <span class="built_in">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">Process32First</span>(hProcessSnap, &amp;pe32); <span class="built_in">Process32Next</span>(hProcessSnap, &amp;pe32);)</span><br><span class="line">            &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line">                <span class="keyword">if</span> (_wcsicmp((pe32.szExeFile), szName))</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                <span class="keyword">if</span> (_stricmp((pe32.szExeFile), szName))</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _DEBUG</span></span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION, FALSE, pe32.th32ProcessID);</span><br><span class="line">                <span class="keyword">if</span> (!hProcess)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;OpenProcess error! %d&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                BOOL ret = <span class="built_in">OpenProcessToken</span>(hProcess, TOKEN_ALL_ACCESS, &amp;hToken);</span><br><span class="line">                <span class="keyword">if</span>(!ret)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;OpenProcess error! %d&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                res = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span> (hProcessSnap)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">CloseHandle</span>(hProcessSnap);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hProcess)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 权限与会话 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 权限 </tag>
            
            <tag> 会话 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows 安全基线检查项</title>
      <link href="/OS/Windows/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5%E9%A1%B9/"/>
      <url>/OS/Windows/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="系统配置安全检查"><a href="#系统配置安全检查" class="headerlink" title="系统配置安全检查"></a>系统配置安全检查</h1><h2 id="1-身份鉴别"><a href="#1-身份鉴别" class="headerlink" title="1. 身份鉴别"></a>1. 身份鉴别</h2><h3 id="1-1-密码最长使用期限"><a href="#1-1-密码最长使用期限" class="headerlink" title="1.1 密码最长使用期限"></a>1.1 密码最长使用期限</h3><p>内容描述：</p><p> 此策略使管理员能够通过确保旧密码不被连续重新使用来增强安全性。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为90或较少的天数，但不是0 ：计算机配置\Windows设置\安全设置\帐户策略\密码策略\密码最长使用期限。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-2-密码最短使用期限"><a href="#1-2-密码最短使用期限" class="headerlink" title="1.2 密码最短使用期限"></a>1.2 密码最短使用期限</h3><p>内容描述：</p><p> 此策略设置定义用户密码必须使用多长时间。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为1或更大天：计算机配置\Windows设置\安全设置\帐户策略\密码策略\密码最短使用期限。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-3-强制密码历史"><a href="#1-3-强制密码历史" class="headerlink" title="1.3 强制密码历史"></a>1.3 强制密码历史</h3><p>内容描述：</p><p> 此策略使管理员能够通过确保旧密码不被连续重新使用来增强安全性。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为24或更多密码：计算机配置\Windows设置\安全设置\帐户策略\密码策略\强制执行密码历史。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-4-密码长度最小值"><a href="#1-4-密码长度最小值" class="headerlink" title="1.4 密码长度最小值"></a>1.4 密码长度最小值</h3><p>内容描述：</p><p> 密码长度最小值越大，暴力破解难度就越高。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为14或更多字符：计算机配置\Windows设置\安全设置\帐户策略\密码策略\密码长度最小值。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-5-密码必须符合复杂性要求"><a href="#1-5-密码必须符合复杂性要求" class="headerlink" title="1.5 密码必须符合复杂性要求"></a>1.5 密码必须符合复杂性要求</h3><p>内容描述：</p><p> 如果启用此策略，密码必须符合下列最低要求：</p><ul><li>不包含用户的帐户名或用户全名中超过两个的部分连续字符</li><li>至少六个字符</li><li>包含以下三个类别的字符：</li><li>英文大写字母（A到Z）</li><li>英文小写字母（a到z）</li><li>以10为基数的数字（0到9）</li><li>非字母字符（例如，！，$，＃，％）</li><li>不属于以下任何Unicode字符的全部类别前四个类别。第五类可以是区域特定的。</li></ul><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为启用：计算机配置\Windows设置\安全设置\帐户策略\密码策略\密码必须符合复杂性要求。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-6-用可还原的加密来储存密码"><a href="#1-6-用可还原的加密来储存密码" class="headerlink" title="1.6 用可还原的加密来储存密码"></a>1.6 用可还原的加密来储存密码</h3><p>内容描述：</p><p> 通过远程访问或 Internet 身份验证服务(IAS)使用质询握手身份验证协议(CHAP)验证时需要设置此策略。在 Internet 信息服务(IIS)中使用摘要式身份验证时也需要设置此策略。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为禁用：计算机配置\Windows设置\安全设置\帐户策略\密码策略\用可还原的加密来储存密码。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-7-阻止Microsoft帐户"><a href="#1-7-阻止Microsoft帐户" class="headerlink" title="1.7 阻止Microsoft帐户"></a>1.7 阻止Microsoft帐户</h3><p>内容描述：</p><p> 此策略设置阻止用户在此计算机上添加新的 Microsoft 帐户。 如果选择“用户不能添加 Microsoft 帐户”选项，用户将不能在此计算机上创建新的 Microsoft 帐户，不能将本地帐户切换到 Microsoft 帐户，也不能将域帐户连接到 Microsoft 帐户。如果需要在企业中限制使用 Microsoft 帐户，这是首选选项。 如果选择“用户不能添加 Microsoft 帐户或使用该帐户登录”选项，则现有的 Microsoft 帐户用户将不能登录到 Windows。选中此选项后，此计算机上的现有管理员可能无法登录和管理系统。 如果禁用或不配置此策略(推荐)，则用户能够将 Microsoft 帐户用于 Windows。</p><p>加固建议：</p><p> Windows10&#x2F;8：请将以下UI路径设置为用户不能添加 Microsoft 帐户或使用该帐户登录：计算机配置\Windows设置\安全设置\本地策略\安全选项\帐户：阻止Microsoft帐户。</p><h3 id="1-8-帐户锁定阈值"><a href="#1-8-帐户锁定阈值" class="headerlink" title="1.8 帐户锁定阈值"></a>1.8 帐户锁定阈值</h3><p>内容描述：</p><p> 此安全设置确定导致用户帐户被锁定的登录尝试失败的次数。在管理员重置锁定帐户或帐户锁定时间期满之前，无法使用该锁定帐户。可以将登录尝试失败次数设置为介于 0 和 999 之间的值。如果将值设置为 0，则永远不会锁定帐户。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为10或较少的无效登录尝试，但不是0 ：计算机配置\Windows设置\安全设置\本地策略\安全选项\交互式登录：计算机帐户锁定阈值。</p><p>注意：</p><p> 域账户需要联系域管理员做对应修改。</p><h3 id="1-9-帐户锁定持续时间"><a href="#1-9-帐户锁定持续时间" class="headerlink" title="1.9 帐户锁定持续时间"></a>1.9 帐户锁定持续时间</h3><p>内容描述：</p><p> 此策略设置确定锁定帐户之前必须经过的时间长度解锁，用户可以尝试再次登录。该设置通过指定数字来实现锁定的帐户将在几分钟之内不可用。如果此策略设置的值配置为0，锁定的帐户将保持锁定状态，直到管理员手动解锁。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为1或更多分钟：计算机配置\Windows设置\安全设置\帐户策略\帐户锁定策略\帐户锁定持续时间。</p><p>注意：</p><p> 如果定义了帐户锁定阈值，则帐户锁定时间必须大于或等于重置时间。只有在指定了帐户锁定阈值时，此策略设置才有意义。</p><h3 id="1-10-重置账号锁定计数器"><a href="#1-10-重置账号锁定计数器" class="headerlink" title="1.10 重置账号锁定计数器"></a>1.10 重置账号锁定计数器</h3><p>内容描述：</p><p> 此安全设置确定在某次登录尝试失败之后将登录尝试失败计数器重置为 0 次错误登录尝试之前需要的时间。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\Windows设置\安全设置\帐户策略\帐户锁定策略\重置帐户锁定计数器后。</p><p>注意：</p><p> 如果定义了帐户锁定阈值，此重置时间必须小于或等于帐户锁定时间。只有在指定了帐户锁定阈值时，此策略设置才有意义。</p><h3 id="1-11-启用屏幕保护程序"><a href="#1-11-启用屏幕保护程序" class="headerlink" title="1.11 启用屏幕保护程序"></a>1.11 启用屏幕保护程序</h3><p>内容描述：</p><p> 确保终端在不活动的状态下，超过一定时间后会自动进入屏幕保护状态。防止终端盗用。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为启用：用户配置\管理模板\控制面板\个性化\启用屏幕保护程序</p><p>注意：</p><p> 默认情况下，此组策略路径可能不存在。 它由Microsoft Windows 7和Server 2008 R2管理模板（或更新版本）附带的组策略模板ControlPanelDisplay.admx &#x2F; adml提供。</p><h2 id="2-访问控制"><a href="#2-访问控制" class="headerlink" title="2. 访问控制"></a>2. 访问控制</h2><h3 id="2-1-Guest-帐户状态"><a href="#2-1-Guest-帐户状态" class="headerlink" title="2.1 Guest 帐户状态"></a>2.1 Guest 帐户状态</h3><p>内容描述：</p><p> 此安全设置确定是启用还是禁用来宾帐户。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为“已禁用”：我的电脑\右键\管理\计算机管理（本地）&#x2F;本地用户和组&#x2F;用户&#x2F; Guest属性&#x2F;账户已禁用。</p><p>注意：</p><p> 如果来宾帐户被禁用且安全选项“网络访问: 本地帐户的共享和安全模型”被设置为“仅来宾”，则网络登录(如由 Microsoft 网络服务器(SMB 服务)所执行的网络登录)将失败。</p><h3 id="2-2-使用空密码的本地帐户只允许进行控制台登录"><a href="#2-2-使用空密码的本地帐户只允许进行控制台登录" class="headerlink" title="2.2 使用空密码的本地帐户只允许进行控制台登录"></a>2.2 使用空密码的本地帐户只允许进行控制台登录</h3><p>内容描述：</p><p> 此安全设置确定未进行密码保护的本地帐户是否可以用于从物理计算机控制台之外的位置登录。如果启用此设置，则未进行密码保护的本地帐户将仅能够通过计算机的键盘登录。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为已启用：计算机配置\Windows设置\安全设置\本地策略\安全选项\帐户：使用空密码的本地帐户只允许进行控制台登录。</p><p>注意：</p><p> 1、此设置不影响使用域帐户的登录。 2、使用远程交互式登录的应用程序可以绕过此设置。 3、在以前版本的 Windows Server 中，远程桌面服务称为终端服务。</p><h3 id="2-3-帐户-重命名来宾帐户"><a href="#2-3-帐户-重命名来宾帐户" class="headerlink" title="2.3 帐户: 重命名来宾帐户"></a>2.3 帐户: 重命名来宾帐户</h3><p>内容描述：</p><p> 此安全设置确定是否存在另一个帐户名称与帐户 “Guest” 的安全标识符(SID)相关联。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\安全选项\帐户: 重命名来宾帐户</p><h3 id="2-4-帐户-重命名管理员帐户"><a href="#2-4-帐户-重命名管理员帐户" class="headerlink" title="2.4 帐户: 重命名管理员帐户"></a>2.4 帐户: 重命名管理员帐户</h3><p>内容描述：</p><p> 此安全设置确定是否存在另一个帐户名称与帐户 Administrator 的安全标识符(SID)相关联。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\安全选项\帐户: 重命名管理员帐户</p><h3 id="2-5-交互式登录-提示用户在密码过期之前更改密码"><a href="#2-5-交互式登录-提示用户在密码过期之前更改密码" class="headerlink" title="2.5 交互式登录: 提示用户在密码过期之前更改密码"></a>2.5 交互式登录: 提示用户在密码过期之前更改密码</h3><p>内容描述：</p><p> 确定提前多长时间(以天为单位)向用户发出其密码即将过期的警告。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\安全选项\交互式登录: 提示用户在密码过期之前更改密码。</p><h3 id="2-6-交互式登录-不显示上次登录"><a href="#2-6-交互式登录-不显示上次登录" class="headerlink" title="2.6 交互式登录: 不显示上次登录"></a>2.6 交互式登录: 不显示上次登录</h3><p>内容描述：</p><p> 该安全设置确定 Windows 登录屏幕是否将显示上次登录该台电脑的人员的用户名，如果启用该策略，将不显示用户名。如果禁用该策略，将显示用户名。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\安全选项\交互式登录: 不显示上次登录。</p><h3 id="2-7-关机-清除虚拟内存页面文件"><a href="#2-7-关机-清除虚拟内存页面文件" class="headerlink" title="2.7 关机: 清除虚拟内存页面文件"></a>2.7 关机: 清除虚拟内存页面文件</h3><p>内容描述：</p><p> 启用此策略会在干净关机时清除系统页面文件。启用此安全选项时，如果禁用休眠，休眠文件(hiberfil.sys)也会被清零。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\安全选项\关机: 清除虚拟内存页面文件。</p><h3 id="2-8-操作系统UAC用户账户控制是否开启至指定级别"><a href="#2-8-操作系统UAC用户账户控制是否开启至指定级别" class="headerlink" title="2.8 操作系统UAC用户账户控制是否开启至指定级别"></a>2.8 操作系统UAC用户账户控制是否开启至指定级别</h3><p>内容描述：</p><p> 用户账户控制有助于预防有害程序对你的计算机进行更改。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：控制面板\用户账户\更改用户账户控制设置。</p><h3 id="2-9-允许Windows自动连接到建议的开放式热点，与联系人共享的网络以及提供付费服务的热点"><a href="#2-9-允许Windows自动连接到建议的开放式热点，与联系人共享的网络以及提供付费服务的热点" class="headerlink" title="2.9 允许Windows自动连接到建议的开放式热点，与联系人共享的网络以及提供付费服务的热点"></a>2.9 允许Windows自动连接到建议的开放式热点，与联系人共享的网络以及提供付费服务的热点</h3><p>内容描述：</p><p> 此策略设置确定用户是否可以启用以下 WLAN 设置:“连接到建议的开放热点”、“连接到我的联系人共享的网络”和“启用付费服务”。</p><p>加固建议：</p><p> Windows10&#x2F;8：请将以下UI路径设置为“已禁用”：计算机配置\管理模板\网络\WLAN服务\WLAN设置\允许Windows自动连接到建议的开放热点，联系人共享的网络以及提供付费服务的热点</p><p>注意：</p><p> 默认情况下，此组策略路径可能不存在。 它由Microsoft Windows 10版本1511管理模板（或更新版本）附带的组策略模板wlansvc.admx &#x2F; adml提供。</p><h3 id="2-10-允许用户通过使用远程桌面服务进行远程连接"><a href="#2-10-允许用户通过使用远程桌面服务进行远程连接" class="headerlink" title="2.10 允许用户通过使用远程桌面服务进行远程连接"></a>2.10 允许用户通过使用远程桌面服务进行远程连接</h3><p>内容描述：</p><p> 使用此策略设置，可以通过使用远程桌面服务配置对计算机的远程访问。 如果启用此策略设置，则目标计算机上的“远程桌面用户”组成员用户可以使用远程桌面服务远程连接到该目标计算机。 如果禁用此策略设置，则用户无法使用远程桌面服务远程连接到目标计算机。目标计算机将保持当前的所有连接，但不会接受任何新传入的连接。 如果未配置此策略设置，则远程桌面服务使用目标计算机上的“远程桌面”设置来确定是否允许远程连接。此设置位于“系统属性”表的“远程”选项卡上。默认情况下，不允许进行远程连接。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为“已禁用”：计算机配置\管理模板\Windows组件\远程桌面服务\远程桌面会话主机\连接\允许用户使用远程桌面服务进行远程连接。 Windows XP：计算机配置\管理模板\Windows组件\终端服务\允许用户使用远程终端服务远程连接。</p><p>注意：</p><p> 1、此组策略路径由所有版本的Microsoft Windows管理模板附带的组策略模板TerminalServer.admx &#x2F; adml提供。 2、在较旧的Microsoft Windows管理模板中，此设置最初名为Windows 7＆Server 2008 R2管理模板中的“允许用户使用终端服务远程连接”，但在“ Windows 7＆Server 2008 R2管理模板”中已重命名为“允许用户使用远程桌面服务远程连接”。最终，它再次被重命名为“允许用户使用从Windows 8.0＆Server 2012（非R2）管理模板开始的远程桌面服务”进行远程连接。</p><h3 id="2-11-管理员帐户状态"><a href="#2-11-管理员帐户状态" class="headerlink" title="2.11 管理员帐户状态"></a>2.11 管理员帐户状态</h3><p>内容描述：</p><p> 此安全设置确定是启用还是禁用本地管理员帐户。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：已禁用：我的电脑\右键\管理\计算机管理（本地）\本地用户和组\用户\Administrator属性\账户已禁用。</p><p>注意：</p><p> 如果在管理员帐户被禁用之后试图重新启用它，且如果当前管理员密码不符合密码要求，则无法重新启用该帐户。在这种情况下，Administrators 组的某个备用成员必须重置管理员帐户上的密码。有关如何重置密码的信息，请参阅“重置密码”。 在某些环境下，禁用管理员帐户会成为一个维护问题。 在安全模式启动下，禁用的管理员帐户仅在该计算机未加入域并且没有任何其他本地活动管理员帐户时才可以启用。如果计算机加入了域，将不能启用禁用的管理员。</p><h3 id="2-12-允许ICMP重定向覆盖OSPF生成的路由"><a href="#2-12-允许ICMP重定向覆盖OSPF生成的路由" class="headerlink" title="2.12 允许ICMP重定向覆盖OSPF生成的路由"></a>2.12 允许ICMP重定向覆盖OSPF生成的路由</h3><p>内容描述：</p><p> Internet控制消息协议（ICMP）重定向导致堆栈检测主机路由。 这些路由会覆盖“开放式最短路径优先”（OSPF）生成的路由。 对于企业环境，建议将此设置配置为“未定义”，对于高安全性环境，建议配置为“禁用”。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为“已禁用”：计算机配置\管理模板\MSS（传统）\MSS：（EnableICMPRedirect）允许ICMP重定向覆盖OSPF生成的路由。</p><p>注意：</p><p> 默认情况下，此组策略路径不存在。 需要附加的组策略模板（MSS-legacy.admx &#x2F; adml）-可从此TechNet博客文章中获得：MSS设置-Microsoft安全指南博客。</p><h3 id="2-13-检查是否关闭了默认共享"><a href="#2-13-检查是否关闭了默认共享" class="headerlink" title="2.13 检查是否关闭了默认共享"></a>2.13 检查是否关闭了默认共享</h3><p>内容描述：</p><p> 检查是否关闭了系统默认共享，未关闭将检查不通过。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：“禁用”。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\server；（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="2-14-设置活动但空闲的远程桌面服务会话的时间限制"><a href="#2-14-设置活动但空闲的远程桌面服务会话的时间限制" class="headerlink" title="2.14 设置活动但空闲的远程桌面服务会话的时间限制"></a>2.14 设置活动但空闲的远程桌面服务会话的时间限制</h3><p>内容描述：</p><p> 使用此策略设置可以指定活动的远程桌面服务会话在自动断开连接之前可以保持空闲状态(无用户输入)的最长时间。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为“启用”：计算机配置\管理模板\Windows组件\远程桌面服务\远程桌面会话主机\会话时间限制\设置活动但空闲的远程桌面服务会话的时间限制。</p><p>注意：</p><p> “计算机配置”和“用户配置”中都有此策略设置。如果同时配置了这两个策略设置，则将优先考虑“计算机配置”策略设置。</p><h3 id="2-15-TCP-x2F-IP筛选"><a href="#2-15-TCP-x2F-IP筛选" class="headerlink" title="2.15 TCP&#x2F;IP筛选"></a>2.15 TCP&#x2F;IP筛选</h3><p>内容描述：</p><p> 允许您连接到您的Windows计算机的TCP&#x2F;IP网络流量类型。</p><p>加固建议：</p><p> 网上邻居\属性\本地连接右键属性\ Internet协议（TCP&#x2F;IP)\属性\高级\选项\TCP&#x2F;IP筛选\属性\启动TCP&#x2F;IP筛选的功能</p><h2 id="3-资源控制"><a href="#3-资源控制" class="headerlink" title="3. 资源控制"></a>3. 资源控制</h2><h3 id="3-1-Remote-Access-Auto-Connection-Manager-RasAuto"><a href="#3-1-Remote-Access-Auto-Connection-Manager-RasAuto" class="headerlink" title="3.1 Remote Access Auto Connection Manager (RasAuto)"></a>3.1 Remote Access Auto Connection Manager (RasAuto)</h3><p>内容描述：</p><p> 每当程序引用远程DNS或NetBIOS名称或地址时，都会创建到远程网络的连接。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：“禁用”。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Access Auto Connection Manager；（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-2-Remote-Desktop-Services-TermService"><a href="#3-2-Remote-Desktop-Services-TermService" class="headerlink" title="3.2 Remote Desktop Services (TermService)"></a>3.2 Remote Desktop Services (TermService)</h3><p>内容描述：</p><p> 允许用户以交互方式连接到远程计算机。 远程桌面和远程桌面会话主机服务器取决于此服务。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Desktop Services。（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-3-Remote-Procedure-Call-RPC-Locator-RpcLocator"><a href="#3-3-Remote-Procedure-Call-RPC-Locator-RpcLocator" class="headerlink" title="3.3 Remote Procedure Call (RPC) Locator (RpcLocator)"></a>3.3 Remote Procedure Call (RPC) Locator (RpcLocator)</h3><p>内容描述：</p><p> 在Windows 2003和Windows的早期版本中，远程过程调用（RPC）定位器服务管理RPC名称服务数据库。 在Windows Vista和Windows的更高版本中，此服务不提供任何功能，并且提供此功能是为了与应用程序兼容。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Procedure Call (RPC) Locator (RpcLocator)。（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-4-Remote-Registry-RemoteRegistry"><a href="#3-4-Remote-Registry-RemoteRegistry" class="headerlink" title="3.4 Remote Registry (RemoteRegistry)"></a>3.4 Remote Registry (RemoteRegistry)</h3><p>内容描述：</p><p> 在Windows 2003和Windows的早期版本中，远程过程调用（RPC）定位器服务管理RPC名称服务数据库。 在Windows Vista和Windows的更高版本中，此服务不提供任何功能，并且提供此功能是为了与应用程序兼容。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Registry（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-5-Remote-Desktop-Configuration-SessionEnv"><a href="#3-5-Remote-Desktop-Configuration-SessionEnv" class="headerlink" title="3.5 Remote Desktop Configuration (SessionEnv)"></a>3.5 Remote Desktop Configuration (SessionEnv)</h3><p>内容描述：</p><p> 远程桌面配置服务（RDCS）负责所有需要SYSTEM上下文的与远程桌面相关的配置和会话维护活动。 其中包括每个会话的临时文件夹，RD主题和RD证书。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Desktop Configuration。（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-6-Remote-Desktop-Services-UserMode-Port-Redirector-UmRdpService"><a href="#3-6-Remote-Desktop-Services-UserMode-Port-Redirector-UmRdpService" class="headerlink" title="3.6 Remote Desktop Services UserMode Port Redirector (UmRdpService)"></a>3.6 Remote Desktop Services UserMode Port Redirector (UmRdpService)</h3><p>内容描述：</p><p> 允许重定向打印机&#x2F;驱动器&#x2F;端口以进行RDP连接。</p><p>加固建议：</p><p> helpDocument.baseline.checkItems.1037.suggest</p><p>注意：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Remote Desktop Services UserMode Port Redirector。（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-7-Telnet服务器"><a href="#3-7-Telnet服务器" class="headerlink" title="3.7 Telnet服务器"></a>3.7 Telnet服务器</h3><p>内容描述：</p><p> 提供网络访问的服务是一个攻击用的很好的渠道，在没有必要的情况下建议关闭。</p><p>加固建议：</p><p> Windows8&#x2F;7&#x2F;XP：请将以下UI路径设置为：我的电脑鼠标右键“管理”\打开计算机管理\服务和应用程序\Telnet。</p><p>注意：</p><p> 如何验证telnet服务是否真的关闭了？使用快捷键win键+r，输入cmd，点击【确定】。输入telnet +IP地址（例如：telnet 192.168.1.1），回车，提示telnet不是内部或外部命令，也不是可运行的程序或批处理文件。说明已经禁止telnet。</p><h3 id="3-8-IE受信任站点检查"><a href="#3-8-IE受信任站点检查" class="headerlink" title="3.8 IE受信任站点检查"></a>3.8 IE受信任站点检查</h3><p>内容描述：</p><p> 检查对应站点是否加入IE受信任站点。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：通过以下UI路径设置为：已启用。计算机配置\管理模板\Windows组件\Internet Explorer\Internet 控制面板\安全页\站点到区域分配列表。</p><h3 id="3-9-Routing-And-Remote-Access-RemoteAccess"><a href="#3-9-Routing-And-Remote-Access-RemoteAccess" class="headerlink" title="3.9 Routing And Remote Access (RemoteAccess)"></a>3.9 Routing And Remote Access (RemoteAccess)</h3><p>内容描述：</p><p> 为局域网和广域网环境中的企业提供路由服务。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：请将以下UI路径设置为：禁用。我的电脑\右键\管理\计算机管理(本地)\ 服务和应用程序\服务\Routing and Remote Access（或通过以下方式：同时按下win+r键，在运行窗口中输入services.msc，即可打开服务。）</p><h3 id="3-10-Windows-Event-Log"><a href="#3-10-Windows-Event-Log" class="headerlink" title="3.10 Windows Event Log"></a>3.10 Windows Event Log</h3><p>内容描述：</p><p> 此服务管理事件和事件日志。它支持日志记录事件、查询事件、订阅事件、归档事件日志以及管理事件元数据。它可以用 XML 和纯文本两种格式显示事件。停止该服务可能危及系统的安全性和可靠性。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：控制面板\系统和安全\管理工具\服务\Windows Event Log</p><h3 id="3-11-专用配置文件的-防火墙状态"><a href="#3-11-专用配置文件的-防火墙状态" class="headerlink" title="3.11 专用配置文件的:防火墙状态"></a>3.11 专用配置文件的:防火墙状态</h3><p>内容描述：</p><p> 指定将计算机连接到专用网络位置时的行为。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：计算机配置\ Windows设置\安全设置\高级安全Windows Defender防火墙\高级安全Windows Defender防火墙-本地组策略对象\Windows Defender防火墙属性\专用配置文件\防火墙状态</p><h3 id="3-12-公用配置文件的-防火墙状态"><a href="#3-12-公用配置文件的-防火墙状态" class="headerlink" title="3.12 公用配置文件的:防火墙状态"></a>3.12 公用配置文件的:防火墙状态</h3><p>内容描述：</p><p> 指定将计算机连接到专用网络位置时的行为。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：计算机配置\ Windows设置\安全设置\高级安全Windows Defender防火墙\高级安全Windows Defender防火墙-本地组策略对象\Windows Defender防火墙属性\公用配置文件\防火墙状态</p><h3 id="3-13-公用配置文件的-应用本地防火墙规则"><a href="#3-13-公用配置文件的-应用本地防火墙规则" class="headerlink" title="3.13 公用配置文件的:应用本地防火墙规则"></a>3.13 公用配置文件的:应用本地防火墙规则</h3><p>内容描述：</p><p> 指定将计算机连接到专用网络位置时的行为。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：计算机配置\ Windows设置\安全设置\高级安全Windows Defender防火墙\高级安全Windows Defender防火墙-本地组策略对象\Windows Defender防火墙属性\公用配置文件\指定Windows Defender防火墙行为的设置-自定义\应用本地防火墙规则设置为否</p><h3 id="3-14-Windows防火墙检查（仅针对Xp系统）"><a href="#3-14-Windows防火墙检查（仅针对Xp系统）" class="headerlink" title="3.14 Windows防火墙检查（仅针对Xp系统）"></a>3.14 Windows防火墙检查（仅针对Xp系统）</h3><p>内容描述：</p><p> 检查防火墙启用状态。</p><p>加固建议：</p><p> 请按以下路径配置：防火墙状态。若您购买的奇安信终端安全管理系统已授权模块包含“主机防火墙”，您可在主机防火墙模块完成防火墙的状态调整。奇安信终端安全管理系统授权模块不包含 “主机防火墙”，您可按照以下路径下配置：控制面板\系统和安全\Windows Defender 防火墙\自定义设置。</p><h2 id="4-安全审计"><a href="#4-安全审计" class="headerlink" title="4. 安全审计"></a>4. 安全审计</h2><h3 id="4-1-审核登录"><a href="#4-1-审核登录" class="headerlink" title="4.1 审核登录"></a>4.1 审核登录</h3><p>内容描述：</p><p> 此策略设置允许你审核由计算机上的用户帐户登录尝试所生成的事件。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为：成功和失败。计算机配置\Windows设置\安全设置\高级审核策略配置\系统审核策略\登录&#x2F;注销\审核登录。</p><h3 id="4-2-审核其他登录-x2F-注销事件"><a href="#4-2-审核其他登录-x2F-注销事件" class="headerlink" title="4.2 审核其他登录&#x2F;注销事件"></a>4.2 审核其他登录&#x2F;注销事件</h3><p>内容描述：</p><p> 此策略设置允许你审核“登录&#x2F;注销”策略设置未涵盖的其他登录&#x2F;注销相关事件，例如:</p><ul><li>终端服务会话断开连接。</li><li>新建终端服务会话。</li><li>锁定和解锁工作站。</li><li>调用屏幕保护程序。</li><li>解除屏幕保护程序。</li></ul><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请将以下UI路径设置为成功和失败：计算机配置\Windows设置\安全设置\高级审核策略配置\系统审核策略\登录&#x2F;注销\审核其他登录&#x2F;注销事件。</p><h3 id="4-3-审核审核策略更改"><a href="#4-3-审核审核策略更改" class="headerlink" title="4.3 审核审核策略更改"></a>4.3 审核审核策略更改</h3><p>内容描述：</p><p> 此策略设置允许你审核对安全审核策略设置的更改，例如:</p><ul><li>设置审核策略对象上的权限和审核设置。</li><li>更改系统审核策略。</li><li>注册安全事件源。</li><li>注销安全事件源。</li><li>更改每用户审核设置。</li><li>更改 CrashOnAuditFail 的值。</li><li>更改文件系统或注册表对象上的系统访问控制列表。</li><li>更改特殊组列表。</li></ul><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：请设置以下UI路径以包含成功：计算机配置\Windows设置\安全设置\高级审核策略配置\系统审核策略\策略更改\审核审核策略更改。</p><p>注意：</p><p> 当某个对象的系统访问控制列表(SACL)发生更改并且启用策略更改类别时执行 SACL 更改审核。在启用对象访问审核并且将对象的 SACL 配置为审核 DACL&#x2F;所有者更改时审核自定义访问控制列表(SACL)和所有权更改。</p><h3 id="4-4-管理审核和安全日志"><a href="#4-4-管理审核和安全日志" class="headerlink" title="4.4 管理审核和安全日志"></a>4.4 管理审核和安全日志</h3><p>内容描述：</p><p> 此安全设置确定哪些用户可以为各种资源(如文件、Active Directory 对象和注册表项)指定对象访问审核选项。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F;XP：计算机配置\ Windows设置\安全设置\本地策略\用户权限分配\管理审核和安全日志</p><h3 id="4-5-审核帐户锁定"><a href="#4-5-审核帐户锁定" class="headerlink" title="4.5 审核帐户锁定"></a>4.5 审核帐户锁定</h3><p>内容描述：</p><p> 此策略设置允许你审核由尝试登录到已锁定帐户失败而生成的事件。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7：计算机配置\ Windows设置\安全设置\高级审核策略配置\系统审核策略\登录&#x2F;注销\审核账户锁定</p><p>\5. 入侵防范</p><h3 id="5-1-关闭自动播放"><a href="#5-1-关闭自动播放" class="headerlink" title="5.1 关闭自动播放"></a>5.1 关闭自动播放</h3><p>内容描述：</p><p> 此策略可防止可移动存储设备连接到计算机后，恶意软件会自动运行起来。</p><p>加固建议：</p><p> Windows10&#x2F;8&#x2F;7&#x2F; vista：请将以下UI路径设置为：已启用所有驱动器：计算机配置\管理模板\Windows组件\自动播放策略\关闭自动播放。</p><p>注意：</p><p> “计算机配置”和“用户配置”文件夹中都存在此策略设置。如果两个策略设置发生冲突，则“计算机配置”中的策略设置优先于“用户配置”中的策略设置。 此组策略路径由Microsoft Windows管理模板的所有版本附带的组策略模板AutoPlay.admx &#x2F; adml提供。</p><h1 id="系统状态安全检查"><a href="#系统状态安全检查" class="headerlink" title="系统状态安全检查"></a>系统状态安全检查</h1><h2 id="1-补丁检查"><a href="#1-补丁检查" class="headerlink" title="1 补丁检查"></a>1 补丁检查</h2><p>内容描述：</p><p> 是否安装关键和重要系统补丁。</p><p>加固建议：</p><p> 若您购买的奇安信终端安全管理系统已授权模块包含“补丁管理”，您可在补丁管理模块完成补丁修复，若您购买的奇安信终端安全管理系统授权模块不包含“补丁管理”，您可以联系销售来咨询购买事项。</p><p>注意：</p><p> 无“补丁管理”模块，该项检查无结果，系统显示检查异常，但本项不扣除对应分数。</p><h2 id="2-防病毒检查"><a href="#2-防病毒检查" class="headerlink" title="2 防病毒检查"></a>2 防病毒检查</h2><p>内容描述：</p><p> 检查终端上是否安装了防病毒软件。本地防病毒软件的版本及病毒库是否及时更新。</p><p>加固建议：</p><p> 若您购买的奇安信终端安全管理系统已授权模块包含“软件管家”，您可在软件管家模块完成防病毒软件安装及本地防病毒软件版本更新。若您购买的奇安信终端安全管理系统授权模块不包含 “软件管家”，您可以在对应杀软官网手动下载或联系销售来咨询模块授权购买事项。</p><h2 id="3-杀毒软件保护检查"><a href="#3-杀毒软件保护检查" class="headerlink" title="3 杀毒软件保护检查"></a>3 杀毒软件保护检查</h2><p>内容描述：</p><p> 检查计算机是否存在杀毒软件保护，存在杀毒软件则检查通过</p><p>加固建议：</p><p> 请在计算机上安装防病毒软件</p><h2 id="4-工作组命名检查"><a href="#4-工作组命名检查" class="headerlink" title="4 工作组命名检查"></a>4 工作组命名检查</h2><p>内容描述：</p><p> 检查工作组命名规范。</p><p>加固建议：</p><p> 请按以下路径配置：控制面板\系统和安全\系统\计算机名、域和工作组设置\计算机名\更改\工作组 (查看方式为类别)</p><p>注意：</p><p> 请根据管理员设置规范设置工作组名称。</p><h2 id="5-域检查"><a href="#5-域检查" class="headerlink" title="5 域检查"></a>5 域检查</h2><p>内容描述：</p><p> 检测当前系统是否加入域。</p><p>加固建议：</p><p> 请按以下路径配置：将计算机加入域。控制面板\系统和安全\系统\计算机名、域和工作组设置\计算机名\网络ID (查看方式为类别)</p><p>注意：</p><p> 该项与计算机工作组命名二选一</p><h2 id="6-计算机命名检查"><a href="#6-计算机命名检查" class="headerlink" title="6 计算机命名检查"></a>6 计算机命名检查</h2><p>内容描述：</p><p> 检查计算机命名规范。</p><p>加固建议：</p><p> 请按以下路径配置：控制面板\系统和安全\系统\计算机名、域和工作组设置\计算机名 (查看方式为类别)</p><p>注意：</p><p> 请根据管理员设置规范设置工作组名称。</p><h2 id="7-空口令检查"><a href="#7-空口令检查" class="headerlink" title="7 空口令检查"></a>7 空口令检查</h2><p>内容描述：</p><p> 检查操作系统账户密码是否为空口令。</p><p>加固建议：</p><p> 请尽快设置系统账户密码。</p><h2 id="8-系统中重要目录对Everyone或Guests来宾账户开放检查"><a href="#8-系统中重要目录对Everyone或Guests来宾账户开放检查" class="headerlink" title="8 系统中重要目录对Everyone或Guests来宾账户开放检查"></a>8 系统中重要目录对Everyone或Guests来宾账户开放检查</h2><p>内容描述：</p><p> 检查操作系统中重要目录（C:\windows\system和C:\windows\system32\config）是否对Everyone或Guests来宾账户开放。</p><p>加固建议：</p><p> 请取消对Everyone或Guests来宾账户开放操作系统中重要目录（右键\属性\安全，查看文件目录对应的组或用户名是否包含Everyone或Guests来宾账户）</p><h2 id="9-系统备份还原点检查"><a href="#9-系统备份还原点检查" class="headerlink" title="9 系统备份还原点检查"></a>9 系统备份还原点检查</h2><p>内容描述：</p><p> 检查在计算机中是否发现系统备份还原点。</p><p>加固建议：</p><p> 请在系统设置\系统保护\配置中设置系统还原点。</p><h2 id="10-系统隐藏用户检查"><a href="#10-系统隐藏用户检查" class="headerlink" title="10 系统隐藏用户检查"></a>10 系统隐藏用户检查</h2><p>内容描述：</p><p> 检查系统是否存在隐藏的用户。</p><p>加固建议：</p><p> 我的电脑\右键\管理\计算机管理(本地)\系统工具\本地用户和组\用户\右键删除（名称结尾带$符号的是隐藏用户）</p><p>注意：</p><p> 所谓隐藏账户即为控制面板与开机选择中看不见的账户。它可以用输账号密码的方式进入。</p><h2 id="11-操作系统是否开启Hardware-DEP-Available保护检查"><a href="#11-操作系统是否开启Hardware-DEP-Available保护检查" class="headerlink" title="11 操作系统是否开启Hardware DEP Available保护检查"></a>11 操作系统是否开启Hardware DEP Available保护检查</h2><p>内容描述：</p><p> 检查操作系统是否开启Hardware DEP Available保护</p><p>加固建议：</p><p> 控制面板\系统和安全\系统\高级系统设置\高级\性能-设置\数据执行保护</p><h1 id="系统运行安全检查"><a href="#系统运行安全检查" class="headerlink" title="系统运行安全检查"></a>系统运行安全检查</h1><h2 id="1-进程检查"><a href="#1-进程检查" class="headerlink" title="1 进程检查"></a>1 进程检查</h2><p>内容描述：</p><p> 检测进程项是否运行&#x2F;禁止，运行&#x2F;禁止其中任意进程即视为符合规范。</p><p>加固建议：</p><p> 请按以下路径配置：进程启停状态。Ctrl+Alt+Delete\启动。</p><h2 id="2-端口检查"><a href="#2-端口检查" class="headerlink" title="2 端口检查"></a>2 端口检查</h2><p>内容描述：</p><p> 端口状态检查。</p><p>加固建议：</p><p> 请检查监听的端口是否符合管理员设置的端口开放要求（可以通过运行CMD并输入命令查看系统正在监听的端口：netstat -ano |findstr “xxx”）。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 安全基线 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 安全基线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于Windows服务</title>
      <link href="/OS/Windows/%E6%9C%8D%E5%8A%A1/%E5%85%B3%E4%BA%8Ewindows%E6%9C%8D%E5%8A%A1/"/>
      <url>/OS/Windows/%E6%9C%8D%E5%8A%A1/%E5%85%B3%E4%BA%8Ewindows%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="windows服务程序崩溃后自动拉起"><a href="#windows服务程序崩溃后自动拉起" class="headerlink" title="windows服务程序崩溃后自动拉起"></a>windows服务程序崩溃后自动拉起</h1><p>Windows 操作系统中的服务程序崩溃后自动重新启动是由操作系统的服务控制管理机制决定的。这个机制确保关键的系统服务能够持续运行，即使在发生错误或异常情况下也能够自动进行恢复。</p><p>下面是一些可能导致服务程序崩溃后自动重新启动的原因：</p><ol><li><strong>服务恢复选项设置</strong>：Windows 操作系统提供了服务恢复选项，允许你为每个服务定义特定的恢复行为。这包括启动服务、重新启动服务和采取其他操作，如运行脚本或发送警报。通过配置这些选项，你可以指定服务崩溃后的行为，以实现自动重新启动。</li><li><strong>故障回收管理器</strong>：Windows 服务控制管理器（SCM）负责监控和管理运行在操作系统中的服务。SCM 包含一个故障回收管理器（Failure Recovery Manager），它会检测服务崩溃事件，并根据预定义的规则自动触发恢复操作。这些规则可以指定在发生故障时自动重新启动服务。</li><li><strong>服务依赖关系</strong>：在 Windows 系统中，服务可以定义它们所依赖的其他服务。当一个服务崩溃后，如果它的依赖服务还正常运行，那么操作系统会自动重新启动崩溃的服务，以保持整个系统的稳定性和连续性。</li></ol><p>需要注意的是，服务程序崩溃后自动拉起并不一定总是适用于所有服务。某些服务可能会配置成在崩溃后停留在错误状态，并等待手动干预或其他特定条件才会重新启动。</p><p>总之，Windows 操作系统通过服务控制管理机制来确保关键服务的连续运行，使其具备自动恢复能力。这种行为通过服务恢复选项、故障回收管理器和服务依赖关系等机制来实现。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 服务 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> windows服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷新托盘图标</title>
      <link href="/OS/Windows/%E5%88%B7%E6%96%B0%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87/"/>
      <url>/OS/Windows/%E5%88%B7%E6%96%B0%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>程序崩溃结束后，创建的系统托盘区图标并不能被刷新掉，重启客户端程序后，托盘区会有两个一样的图标。</p><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h2><p>调用以下代码模拟鼠标hover操作遍历系统托盘区图标</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> Q_OS_WIN</span></span><br><span class="line"><span class="comment">//刷新托盘图标</span></span><br><span class="line">    <span class="keyword">auto</span> RefreshTrayIcon = []()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//任务栏窗口</span></span><br><span class="line">        HWND hShellTrayWnd = ::<span class="built_in">FindWindow</span>(<span class="string">L&quot;Shell_TrayWnd&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="comment">//任务栏右边托盘图标+时间区</span></span><br><span class="line">        HWND hTrayNotifyWnd = ::<span class="built_in">FindWindowEx</span>(hShellTrayWnd, <span class="number">0</span>, <span class="string">L&quot;TrayNotifyWnd&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="comment">//不同系统可能有可能没有这层</span></span><br><span class="line">        HWND hSysPager = ::<span class="built_in">FindWindowEx</span>(hTrayNotifyWnd, <span class="number">0</span>, <span class="string">L&quot;SysPager&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="comment">//托盘图标窗口</span></span><br><span class="line">        HWND hToolbarWindow32;</span><br><span class="line">        <span class="keyword">if</span> (hSysPager)</span><br><span class="line">        &#123;</span><br><span class="line">            hToolbarWindow32 = ::<span class="built_in">FindWindowEx</span>(hSysPager, <span class="number">0</span>, <span class="string">L&quot;ToolbarWindow32&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            hToolbarWindow32 = ::<span class="built_in">FindWindowEx</span>(hTrayNotifyWnd, <span class="number">0</span>, <span class="string">L&quot;ToolbarWindow32&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hToolbarWindow32)</span><br><span class="line">        &#123;</span><br><span class="line">            RECT r;</span><br><span class="line">            ::<span class="built_in">GetWindowRect</span>(hToolbarWindow32, &amp;r);</span><br><span class="line">            <span class="type">int</span> width = r.right - r.left;</span><br><span class="line">            <span class="type">int</span> height = r.bottom - r.top;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> iconWidth = <span class="built_in">GetSystemMetrics</span>(SM_CXSMICON);  <span class="comment">// 图标基准宽度 </span></span><br><span class="line"><span class="type">int</span> iconHeight = <span class="built_in">GetSystemMetrics</span>(SM_CYSMICON); <span class="comment">// 图标基准高度</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//从任务栏中间从左到右 MOUSEMOVE一遍，所有图标状态会被更新</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt; width; x+=iconWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt; height; y+=iconHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    ::<span class="built_in">SendMessage</span>(hToolbarWindow32, WM_MOUSEMOVE, <span class="number">0</span>, <span class="built_in">MAKELPARAM</span>(x, y));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RefreshTrayIcon();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// Q_OS_WIN</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h2><p>重新启动进程的时候先删除再创建，但是需要通过添加 <code>uID</code> 和 <code>guidItem</code> 来识别已创建的托盘图标</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 设置 uid 和 guiditem</span></span><br><span class="line">m_nid.uID = GUID_TrayIcon.Data2;</span><br><span class="line"><span class="keyword">if</span> (QSysInfo::WindowsVersion &gt;= QSysInfo::WV_WINDOWS7)</span><br><span class="line">&#123;</span><br><span class="line">m_nid.uFlags |= NIF_GUID;</span><br><span class="line"></span><br><span class="line">m_nid.guidItem = GUID_TrayIcon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 删除</span></span><br><span class="line">   <span class="built_in">Shell_NotifyIcon</span>(NIM_DELETE, &amp;m_nid);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 托盘 </tag>
            
            <tag> tray </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win 10/11 通过命令行打开系统设置页面</title>
      <link href="/OS/Windows/%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%93%E5%BC%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5/"/>
      <url>/OS/Windows/%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%93%E5%BC%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述: 程序中或者脚本中要打开系统设置界面时，可以使用如下方式和接口</p></blockquote><p>[toc]</p><h1 id="使用-Win32-API"><a href="#使用-Win32-API" class="headerlink" title="使用 Win32 API"></a>使用 Win32 API</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">::<span class="built_in">ShellExecute</span>(hWnd, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;ms-settings:about&quot;</span>, ...);</span><br></pre></td></tr></table></figure><h1 id="KeyBoard-Win-R启动命令行"><a href="#KeyBoard-Win-R启动命令行" class="headerlink" title="KeyBoard Win+R启动命令行"></a>KeyBoard Win+R启动命令行</h1><p><kbd>Win+R</kbd> 在输入框直接输入启动的界面命令即可。</p><p><img src="/images/%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%93%E5%BC%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5/1.png" alt="image-20230814095627601"></p><h1 id="Command-Line-cmd-exe"><a href="#Command-Line-cmd-exe" class="headerlink" title="Command Line(cmd.exe)"></a>Command Line(cmd.exe)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start ms-settings:about</span><br></pre></td></tr></table></figure><h1 id="启动说明对照表"><a href="#启动说明对照表" class="headerlink" title="启动说明对照表"></a>启动说明对照表</h1><table><thead><tr><th>Settings page ▾</th><th>Uri &#x2F; Setting Name</th><th>Category</th></tr></thead><tbody><tr><td>About (device name&#x2F;specification)</td><td>ms-settings:about</td><td>Windows</td></tr><tr><td>Access work or school</td><td>ms-settings:workplace</td><td>Network</td></tr><tr><td>Account info (share between apps)</td><td>ms-settings:privacy-accountinfo</td><td>Privacy</td></tr><tr><td>Activation</td><td>ms-settings:activation</td><td>Security</td></tr><tr><td>Activity history (build 17040+)</td><td>ms-settings:privacy-activityhistory</td><td>Privacy</td></tr><tr><td>Adaptive Color Filters Link</td><td>ms-settings:easeofaccess-colorfilter-adaptivecolorlink</td><td>Accessibility</td></tr><tr><td>Airplane mode (wireless&#x2F;bluetooth)</td><td>ms-settings:network-airplanemode</td><td>Network</td></tr><tr><td>Airplane mode (wireless&#x2F;bluetooth)</td><td>ms-settings:proximity</td><td>Network</td></tr><tr><td>App diagnostics (share between apps)</td><td>ms-settings:privacy-appdiagnostics</td><td>Privacy</td></tr><tr><td>App volume and device preferences (1903)</td><td>ms-settings:apps-volume</td><td>Audio</td></tr><tr><td>Apps &amp; features</td><td>ms-settings:appsfeatures</td><td>Apps</td></tr><tr><td>Apps for websites</td><td>ms-settings:appsforwebsites</td><td>Apps</td></tr><tr><td>AutoPlay</td><td>ms-settings:autoplay</td><td>Apps</td></tr><tr><td>Automatic online file downloads</td><td>ms-settings:privacy-automaticfiledownloads</td><td>Apps</td></tr><tr><td>Background apps</td><td>ms-settings:privacy-backgroundapps</td><td>Apps</td></tr><tr><td>Backgrounds</td><td>ms-settings:personalization-background</td><td>Customisation</td></tr><tr><td>Backup</td><td>ms-settings:backup</td><td>Storage</td></tr><tr><td>Battery Saver</td><td>ms-settings:batterysaver</td><td>Power</td></tr><tr><td>Battery Saver - settings</td><td>ms-settings:batterysaver-settings</td><td>Power</td></tr><tr><td>Battery Saver - usage</td><td>ms-settings:batterysaver-usagedetails</td><td>Power</td></tr><tr><td>Bluetooth &amp; Connected Devices</td><td>ms-settings:bluetooth</td><td>Network</td></tr><tr><td>Bluetooth &amp; Connected Devices</td><td>ms-settings:connecteddevices</td><td>Network</td></tr><tr><td>Calendar (share between apps)</td><td>ms-settings:privacy-calendar</td><td>Privacy</td></tr><tr><td>Call history (share between apps)</td><td>ms-settings:privacy-callhistory</td><td>Privacy</td></tr><tr><td>Cellular Network</td><td>ms-settings:network-cellular</td><td>Network</td></tr><tr><td>Clipboard</td><td>ms-settings:clipboard</td><td>Apps</td></tr><tr><td>Closed Captioning</td><td>ms-settings:easeofaccess-closedcaptioning</td><td>Accessibility</td></tr><tr><td>Color Filters (build 17025+)</td><td>ms-settings:easeofaccess-colorfilter</td><td>Accessibility</td></tr><tr><td>Colors</td><td>ms-settings:personalization-colors</td><td></td></tr><tr><td>ms-settings:colors</td><td>Customisation</td><td></td></tr><tr><td>Connect to a wireless display</td><td>ms-settings-connectabledevices:devicediscovery</td><td>Display</td></tr><tr><td>Contacts (share between apps)</td><td>ms-settings:privacy-contacts</td><td>Privacy</td></tr><tr><td>Cortana</td><td>ms-settings:cortana</td><td>Search</td></tr><tr><td>Cortana more details</td><td>ms-settings:cortana-moredetails</td><td>Search</td></tr><tr><td>Cortana permissions</td><td>ms-settings:cortana-permissions</td><td>Search</td></tr><tr><td>Data Sense</td><td>ms-settings:datausage</td><td>Storage</td></tr><tr><td>Date &amp; Time</td><td>ms-settings:dateandtime</td><td>Region &amp; Language</td></tr><tr><td>Default Save Locations</td><td>ms-settings:savelocations</td><td>Storage</td></tr><tr><td>Default apps</td><td>ms-settings:defaultapps</td><td>Apps</td></tr><tr><td>Delivery Optimization</td><td>ms-settings:delivery-optimization</td><td>Windows</td></tr><tr><td>Device Encryption (where available)</td><td>ms-settings:deviceencryption</td><td>Security</td></tr><tr><td>Dial-up Network</td><td>ms-settings:network-dialup</td><td>Network</td></tr><tr><td>DirectAccess</td><td>ms-settings:network-directaccess</td><td>Network</td></tr><tr><td>Display</td><td>ms-settings:display</td><td>Display</td></tr><tr><td>Display Screen rotation</td><td>ms-settings:screenrotation</td><td>Display</td></tr><tr><td>Display Text scaling (build 17025+)</td><td>ms-settings:easeofaccess-display</td><td>Accessibility</td></tr><tr><td>Document Library (share between apps)</td><td>ms-settings:privacy-documents</td><td>Privacy</td></tr><tr><td>Download maps</td><td>ms-settings:maps-downloadmaps</td><td>Apps</td></tr><tr><td>Dynamic Lock</td><td>ms-settings:signinoptions-dynamiclock</td><td>Security</td></tr><tr><td>Ease of Access Audio (build 17035+)</td><td>ms-settings:easeofaccess-audio</td><td>Accessibility</td></tr><tr><td>Edge web browser</td><td>microsoft-edge:url</td><td>Apps</td></tr><tr><td>Email &amp; app accounts</td><td>ms-settings:emailandaccounts</td><td>Security</td></tr><tr><td>Email (share between apps)</td><td>ms-settings:privacy-email</td><td>Privacy</td></tr><tr><td>Ethernet Network</td><td>ms-settings:network-ethernet</td><td>Network</td></tr><tr><td>Eye Control (build 17035+)</td><td>ms-settings:easeofaccess-eyecontrol</td><td>Accessibility</td></tr><tr><td>Eye tracker (requires eyetracker hardware)</td><td>ms-settings:privacy-eyetracker</td><td>Privacy</td></tr><tr><td>Family &amp; other users</td><td>ms-settings:family-group</td><td>Security</td></tr><tr><td>Family &amp; other users</td><td>ms-settings:otherusers</td><td>Security</td></tr><tr><td>Feedback &amp; diagnostics (privacy)</td><td>ms-settings:privacy-feedback</td><td>Security</td></tr><tr><td>File System (share between apps)</td><td>ms-settings:privacy-broadfilesystemaccess</td><td>Privacy</td></tr><tr><td>Find My Device</td><td>ms-settings:findmydevice</td><td>Security</td></tr><tr><td>Focus assist (build 17074+)</td><td>ms-settings:quiethours<br />OR ms-settings:quietmomentshome</td><td>Apps</td></tr><tr><td>Fonts (build 17083+)</td><td>ms-settings:fonts</td><td>Customisation</td></tr><tr><td>For developers</td><td>ms-settings:developers</td><td>Apps</td></tr><tr><td>Graphics Advanced scaling settings</td><td>ms-settings:display-advanced</td><td>Display</td></tr><tr><td>Graphics performance preference</td><td>ms-settings:display-advancedgraphics</td><td>Display</td></tr><tr><td>High Contrast</td><td>ms-settings:easeofaccess-highcontrast</td><td>Accessibility</td></tr><tr><td>Home page for Settings</td><td>ms-settings:</td><td>Windows</td></tr><tr><td>Keyboard</td><td>ms-settings:easeofaccess-keyboard</td><td>Devices</td></tr><tr><td>Location (share between apps)</td><td>ms-settings:privacy-location</td><td>Privacy</td></tr><tr><td>Lock screen</td><td>ms-settings:lockscreen</td><td>Security</td></tr><tr><td>Magnifier</td><td>ms-settings:easeofaccess-magnifier</td><td>Accessibility</td></tr><tr><td>Manage known Wi-Fi</td><td>ms-settings:network-wifisettings</td><td>Network</td></tr><tr><td>Manage sound devices (disable&#x2F;test)</td><td>ms-settings:sound-devices</td><td>Audio</td></tr><tr><td>Messaging (share between apps)</td><td>ms-settings:privacy-messaging</td><td>Privacy</td></tr><tr><td>Microphone (share between apps)</td><td>ms-settings:privacy-microphone</td><td>Privacy</td></tr><tr><td>Mobile Hotspot</td><td>ms-settings:network-mobilehotspot</td><td>Network</td></tr><tr><td>Motion (share between apps)</td><td>ms-settings:privacy-motion</td><td>Privacy</td></tr><tr><td>Mouse</td><td>ms-settings:easeofaccess-mouse</td><td>Accessibility</td></tr><tr><td>Mouse &amp; Touchpad Devices</td><td>ms-settings:mousetouchpad</td><td>Devices</td></tr><tr><td>Mouse Pointer (Cursor &amp; pointer, build 17040+)</td><td>ms-settings:easeofaccess-cursorandpointersize</td><td>Accessibility</td></tr><tr><td>Mouse Pointer (Cursor &amp; pointer, build 17040+)</td><td>ms-settings:easeofaccess-mousepointer</td><td>Accessibility</td></tr><tr><td>Multitasking</td><td>ms-settings:multitasking</td><td>Display</td></tr><tr><td>Narrator</td><td>ms-settings:easeofaccess-narrator</td><td>Audio</td></tr><tr><td>Network &amp; Internet</td><td>ms-settings:network</td><td>Network</td></tr><tr><td>Network Status</td><td>ms-settings:network-status</td><td>Network</td></tr><tr><td>Night light settings</td><td>ms-settings:nightlight</td><td>Customisation</td></tr><tr><td>Notifications (share between apps)</td><td>ms-settings:privacy-notifications</td><td>Privacy</td></tr><tr><td>Notifications and Actions</td><td>ms-settings:notifications</td><td>Customisation</td></tr><tr><td>Offline Maps</td><td>ms-settings:maps</td><td>Apps</td></tr><tr><td>Online Speech recognition</td><td>ms-settings:privacy-speech</td><td>Privacy</td></tr><tr><td>Optional features</td><td>ms-settings:optionalfeatures</td><td>Apps</td></tr><tr><td>Other options</td><td>ms-settings:easeofaccess-otheroptions</td><td>Accessibility</td></tr><tr><td>Personalization</td><td>ms-settings:personalization</td><td>Customisation</td></tr><tr><td>Picture Library (share between apps)</td><td>ms-settings:privacy-pictures</td><td>Privacy</td></tr><tr><td>Power &amp; Sleep</td><td>ms-settings:powersleep</td><td>Power</td></tr><tr><td>Printers</td><td>ms-settings:printers</td><td>Devices</td></tr><tr><td>Privacy</td><td>ms-settings:privacy</td><td>Privacy</td></tr><tr><td>Projecting to this PC</td><td>ms-settings:project</td><td>Display</td></tr><tr><td>Proxy (Network)</td><td>ms-settings:network-proxy</td><td>Network</td></tr><tr><td>Radio (share between apps)</td><td>ms-settings:privacy-radios</td><td>Privacy</td></tr><tr><td>Recovery - Reset&#x2F;Advanced startup</td><td>ms-settings:recovery</td><td>Windows</td></tr><tr><td>Region</td><td>ms-settings:regionformatting</td><td>Region &amp; Language</td></tr><tr><td>Region &amp; language</td><td>ms-settings:regionlanguage</td><td>Region &amp; Language</td></tr><tr><td>Remember typing patterns</td><td>ms-settings:privacy-speechtyping</td><td>Privacy</td></tr><tr><td>Remote Desktop</td><td>ms-settings:remotedesktop</td><td>Network</td></tr><tr><td>Search Permissions &amp; search history</td><td>ms-settings:search-permissions</td><td>Search</td></tr><tr><td>Search details</td><td>ms-settings:search-moredetails</td><td>Search</td></tr><tr><td>Security Key setup</td><td>ms-settings:signinoptions-launchsecuritykeyenrollment</td><td>Security</td></tr><tr><td>Send Diagnostic Data to Microsoft</td><td>ms-settings:privacy-feedback-telemetryviewergroup</td><td>Privacy</td></tr><tr><td>Set up a kiosk</td><td>ms-settings:assignedaccess</td><td>Security</td></tr><tr><td>Shared experiences</td><td>ms-settings:crossdevice</td><td>Network</td></tr><tr><td>Sign-in options</td><td>ms-settings:signinoptions</td><td>Security</td></tr><tr><td>Software Center (SCCM)</td><td>softwarecenter:</td><td>Apps</td></tr><tr><td>Sound (build 17063+)</td><td>ms-settings:sound</td><td>Audio</td></tr><tr><td>Speech</td><td>ms-settings:speech</td><td>Audio</td></tr><tr><td>Speech recognition (build 17035+)</td><td>ms-settings:easeofaccess-speechrecognition</td><td>Accessibility</td></tr><tr><td>Start Menu</td><td>ms-settings:personalization-start</td><td>Customisation</td></tr><tr><td>Start Menu (choose which folders appear)</td><td>ms-settings:personalization-start-places</td><td>Customisation</td></tr><tr><td>Start Narrator after sign-in</td><td>ms-settings:easeofaccess-narrator-isautostartenabled</td><td>Audio</td></tr><tr><td>Startup (build 17017+)</td><td>ms-settings:startupapps</td><td>Customisation</td></tr><tr><td>Storage Sense</td><td>ms-settings:storagesense</td><td>Storage</td></tr><tr><td>Storage Sense configuration</td><td>ms-settings:storagepolicies</td><td>Storage</td></tr><tr><td>Sync your settings</td><td>ms-settings:sync</td><td>Network</td></tr><tr><td>Tablet mode</td><td>ms-settings:tabletmode</td><td>Customisation</td></tr><tr><td>Taskbar</td><td>ms-settings:taskbar</td><td>Apps</td></tr><tr><td>Tasks (share between apps)</td><td>ms-settings:privacy-tasks</td><td>Privacy</td></tr><tr><td>Text Cursor</td><td>ms-settings:easeofaccess-cursor</td><td>Accessibility</td></tr><tr><td>Themes</td><td>ms-settings:themes</td><td>Customisation</td></tr><tr><td>Touchpad</td><td>ms-settings:devices-touchpad</td><td>Devices</td></tr><tr><td>Troubleshoot - Fix Windows Update</td><td>ms-settings:troubleshoot</td><td>Windows</td></tr><tr><td>Typing</td><td>ms-settings:typing</td><td>Accessibility</td></tr><tr><td>USB</td><td>ms-settings:usb</td><td>Devices</td></tr><tr><td>Unpaired devices (share between apps)</td><td>ms-settings:privacy-customdevices</td><td>Privacy</td></tr><tr><td>VPN</td><td>ms-settings:network-vpn</td><td>Network</td></tr><tr><td>Video Library (share between apps)</td><td>ms-settings:privacy-videos</td><td>Privacy</td></tr><tr><td>Video playback (build 16215+)</td><td>ms-settings:videoplayback</td><td>Display</td></tr><tr><td>Voice activation (apps can listen)</td><td>ms-settings:privacy-voiceactivation</td><td>Privacy</td></tr><tr><td>Webcam (share between apps)</td><td>ms-settings:privacy-webcam</td><td>Privacy</td></tr><tr><td>Wi-Fi</td><td>ms-settings:network-wifi</td><td>Network</td></tr><tr><td>WinUpdate - Active Hours</td><td>ms-settings:windowsupdate-activehours</td><td>Security</td></tr><tr><td>WinUpdate - Advanced options</td><td>ms-settings:windowsupdate-options</td><td>Security</td></tr><tr><td>WinUpdate - Check for updates</td><td>ms-settings:windowsupdate-action</td><td>Security</td></tr><tr><td>WinUpdate - Optional updates</td><td>ms-settings:windowsupdate-optionalupdates</td><td>Security</td></tr><tr><td>WinUpdate - Restart options</td><td>ms-settings:windowsupdate-restartoptions</td><td>Security</td></tr><tr><td>WinUpdate - Update history</td><td>ms-settings:windowsupdate-history</td><td>Security</td></tr><tr><td>Windows Hello face setup</td><td>ms-settings:signinoptions-launchfaceenrollment</td><td>Security</td></tr><tr><td>Windows Hello fingerprint setup</td><td>ms-settings:signinoptions-launchfingerprintenrollment</td><td>Security</td></tr><tr><td>Windows Insider Program (beta’s)</td><td>ms-settings:windowsinsider</td><td>Windows</td></tr><tr><td>Windows Search</td><td>ms-settings:cortana-windowssearch</td><td>Search</td></tr><tr><td>Windows Security (Defender)</td><td>ms-settings:windowsdefender</td><td>Security</td></tr><tr><td>Windows Security at a glance</td><td>windowsdefender:</td><td>Security</td></tr><tr><td>Windows Update</td><td>ms-settings:windowsupdate</td><td>Security</td></tr><tr><td>Your info (Microsoft account)</td><td>ms-settings:yourinfo</td><td>Security</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> ms-settings </tag>
            
            <tag> 快捷方式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 UMDH 定位用户模式内存泄漏</title>
      <link href="/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%AE%9A%E4%BD%8D%20UMDH/"/>
      <url>/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%AE%9A%E4%BD%8D%20UMDH/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="UMDH"><a href="#UMDH" class="headerlink" title="UMDH"></a>UMDH</h1><blockquote><p><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/debugger/umdh?source=recommendations">UMDH</a>（用户模式转储堆），是与操作系统一起用于分析特性进程Windows堆分配。UMDH查找特定进程中的哪个例程正在泄漏内存。特别要注意的事：使用UMDH显示堆栈跟踪数据之前，必须使用 GFlags 正确配置系统。Windows的调试工具中包含了 <a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/debugger/gflags?source=recommendations">GFlags</a>。</p></blockquote><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="启用-UMDH-stack-跟踪："><a href="#启用-UMDH-stack-跟踪：" class="headerlink" title="启用 UMDH stack 跟踪："></a>启用 <code>UMDH stack</code> 跟踪：</h2><ol><li><p>在 GFlags 图形界面中，选择 “图像文件” 选项卡，键入进程名称 (包括文件扩展名) ，按 TAB 键，选择 “ <strong>创建用户模式堆栈跟踪数据库</strong>“，然后选择 “ <strong>应用</strong>“。或者，在命令行界面使用 <code>gflags</code> 命令设置。</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gflags /i imageName +ust</span><br></pre></td></tr></table></figure><p>当完成分析后，使用 <code>-</code> 清楚设置：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gflags /i imageName -ust</span><br></pre></td></tr></table></figure></li><li><p>默认情况下，在 x86 处理器上 Windows 收集的堆栈跟踪数据量限制为 32 MB，在 x64 处理器上限制为 64 mb。 如果必须增加此数据库的大小，请选择 “GFlags” 图形界面中的 “ <strong>映像文件</strong> “ 选项卡，键入进程名称，按 tab 键，选中 “ <strong>Stack Backtrace (Megs)</strong> “ 复选框，在 “关联” 文本框中键入值 (，以) MB 为单位），然后选择 “ <strong>应用</strong>“。 仅在必要时增加此数据库，因为它可能会耗尽有限的 Windows 资源。 如果不再需要更大的大小，则将此设置返回到其原始值。</p></li><li><p>如果更改了 “<strong>系统注册表</strong>“ 选项卡上的任何标志，则必须重新启动 Windows 以使这些更改生效。 如果更改了 “ <strong>图像文件</strong> “ 选项卡上的任何标志，则必须重新启动该过程才能使更改生效。 对<strong>内核标志</strong>选项卡所做的更改会立即生效，但下次重新启动 Windows，它们会丢失。</p></li></ol><p>在使用 UMDH 之前，必须有权访问应用程序的正确符号。UMDH 使用环境变量指定的符号路径 <code>_NT_SYMBOL_PATH</code>。将此变量设置为包含应用程序的符号的路径。如果还包括 Windows 符号的路径，则分析可能更完整。此符号路径的语法与调试器使用的语法相同。</p><p>例如，如果你的应用程序的符号位于 <code>C:\MySymbols</code>，并且你想要为你的 Windows 符号使用公共 Microsoft 符号存储区，则使用 <code>C:\MyCache</code> 作为下游存储，你将使用以下命令设置你的符号路径：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set _NT_SYMBOL_PATH=c:\mysymbols;srv*c:\mycache*https://msdl.microsoft.com/download/symb</span><br></pre></td></tr></table></figure><p>此外，若需要确保准确的结果，必须禁用 <code>BSTR</code> 缓存。为此，请将 <code>OANOCACHE</code> 环境变量的值设置为 1（需要在启动跟踪其分配的应用程序之前进行设置）。如果需要跟踪服务所做的分配，则必须将 <code>OANOCACHE</code> 设置为西戎环境变量，然后重新启动 Windows 以使此设置生效。</p><h2 id="检测通过-UMDH-增加的堆分配"><a href="#检测通过-UMDH-增加的堆分配" class="headerlink" title="检测通过 UMDH 增加的堆分配"></a>检测通过 UMDH 增加的堆分配</h2><h3 id="1-确认进程ID-PID"><a href="#1-确认进程ID-PID" class="headerlink" title="1. 确认进程ID (PID)"></a>1. 确认进程ID (PID)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tlist | finstr &quot;进程名&quot;</span><br></pre></td></tr></table></figure><h3 id="2-保存日志文件"><a href="#2-保存日志文件" class="headerlink" title="2. 保存日志文件"></a>2. 保存日志文件</h3><p>使用 UMDH 分析此进程的堆内存分配，并将其保存到日志文件。将 <code>-p</code> 开关与 PID 一起使用，并将 <code>-f</code> 开关与日志文件的名称一起使用。例如，如果 PID 为123，并且你想要将日志文件命名为 <code>Log1.txt</code> ，请使用以下命令：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umdh -p:123 -f:log1.txt</span><br></pre></td></tr></table></figure><h3 id="3-查看日志"><a href="#3-查看日志" class="headerlink" title="3. 查看日志"></a>3. 查看日志</h3><p>使用记事本或其他程序打开日志文件。 此文件包含每个堆分配的调用堆栈、通过该调用堆栈进行的分配数，以及通过该调用堆栈使用的字节数。</p><h3 id="4-前后两次日志对比结果"><a href="#4-前后两次日志对比结果" class="headerlink" title="4. 前后两次日志对比结果"></a>4. 前后两次日志对比结果</h3><p>由于您正在查找内存泄漏，因此，单个日志文件的内容是不够的。 你必须比较在不同时间记录的日志文件，以确定哪些分配正在增长。</p><p>UMDH 可以比较两个不同的日志文件，并在各自的分配大小中显示更改。 您可以使用大于符号 (<strong>&gt;</strong>) 将结果重定向到第三个文本文件。 你可能还需要包含-d 选项，该选项将字节和分配计数从十六进制转换为十进制。 例如，若要比较 Log1.txt 和 Log2.txt，将比较结果保存到文件 LogCompare.txt，请使用以下命令：</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umdh log1.txt log2.txt &gt; logcompare.txt </span><br></pre></td></tr></table></figure><h3 id="5-分析内存泄漏"><a href="#5-分析内存泄漏" class="headerlink" title="5. 分析内存泄漏"></a>5. 分析内存泄漏</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ 5320 ( f110 - 9df0) 3a allocs BackTrace00B53 </span><br><span class="line">Total increase == 5320 </span><br></pre></td></tr></table></figure><p>对于每个调用堆栈 (在 UMDH 日志文件中标记为 “BackTrace” ) ，这两个日志文件之间有比较。 在此示例中，第一个日志文件 (Log1.txt) 为 BackTrace00B53 分配的0x9DF0 字节，而第二个日志文件记录了0xF110 字节，这意味着在捕获两个日志的时间之间分配有0x5320 的额外字节。 这些字节来自 BackTrace00B53 标识的调用堆栈。</p><h3 id="6-查看泄漏堆栈"><a href="#6-查看泄漏堆栈" class="headerlink" title="6. 查看泄漏堆栈"></a>6. 查看泄漏堆栈</h3><p>若要确定该 backtrace 中的内容，请打开一个原始日志文件 (例如 Log2.txt) ，然后搜索 “BackTrace00B53”。结果类似于以下数据：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">00005320 bytes in 0x14 allocations (@ 0x00000428) by: BackTrace00B53</span><br><span class="line">ntdll!RtlDebugAllocateHeap+0x000000FD</span><br><span class="line">ntdll!RtlAllocateHeapSlowly+0x0000005A</span><br><span class="line">ntdll!RtlAllocateHeap+0x00000808</span><br><span class="line">MyApp!_heap_alloc_base+0x00000069</span><br><span class="line">MyApp!_heap_alloc_dbg+0x000001A2</span><br><span class="line">MyApp!_nh_malloc_dbg+0x00000023</span><br><span class="line">MyApp!_nh_malloc+0x00000016</span><br><span class="line">MyApp!operator new+0x0000000E</span><br><span class="line">MyApp!DisplayMyGraphics+0x0000001E</span><br><span class="line">MyApp!main+0x0000002C</span><br><span class="line">MyApp!mainCRTStartup+0x000000FC</span><br><span class="line">KERNEL32!BaseProcessStart+0x0000003D </span><br></pre></td></tr></table></figure><blockquote><p><strong>上述泄漏内存分析</strong>:</p><p>此 UMDH 输出显示有) (十进制21280从调用堆栈中分配的总字节数。 这些字节是从 0x14 (十进制 20) 单独分配的，每个 0x428 (十进制 1064) 字节。</p><p>将为调用堆栈提供 “BackTrace00B53” 的标识符，并显示此堆栈中的调用。 在检查调用堆栈时，可以看到 <strong>DisplayMyGraphics</strong> 例程正在通过 <strong>new</strong> 运算符分配内存，该运算符调用例程 <em>malloc</em>，后者使用 Visual C++ 运行时库从堆中获取内存。</p><p>确定要在源代码中显式显示的最后一个调用。 在这种情况下，它可能是 <strong>new</strong> 运算符，因为调用 <em>malloc</em> 是作为 <strong>新</strong> 的实现的一部分而不是作为单独的分配。 因此， <strong>DisplayMyGraphics</strong>例程中<strong>new</strong>运算符的此实例会重复分配未释放的内存。</p></blockquote><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/debugger/using-umdh-to-find-a-user-mode-memory-leak">使用 UMDH 查找用户模式内存泄漏 - Windows drivers | Microsoft Docs</a></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 内存泄漏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内存 </tag>
            
            <tag> 内存泄漏 </tag>
            
            <tag> UMDH </tag>
            
            <tag> WinDbg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内存泄漏分析实战</title>
      <link href="/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/%E5%AE%9E%E6%88%98/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/"/>
      <url>/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/%E5%AE%9E%E6%88%98/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文为项目中服务程序的内存泄漏，挑了其中一部分比较常见的内存泄漏进行分析和修改。</p><p>关于内存泄漏和分析的文章可查看博客相关文章，有 <code>UMDH</code> 和 <code>vld</code> 两种方式，可根据个人需求展开分析。</p><h1 id="泄漏分类"><a href="#泄漏分类" class="headerlink" title="泄漏分类"></a>泄漏分类</h1><h2 id="malloc-内存泄漏"><a href="#malloc-内存泄漏" class="headerlink" title="# malloc 内存泄漏"></a># <code>malloc</code> 内存泄漏</h2><p>下述日志为一次 <code>malloc</code>  未正确释放导致的内存泄漏。这种问题比较常见，不用多说。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ntdll.dll!RtlAllocateHeap()</span><br><span class="line">***\heap\malloc_base.cpp (34): XXX.dll!_malloc_base() + 0xF bytes</span><br><span class="line">XXX.dll!_event_debugx() + 0x1A7 bytes</span><br></pre></td></tr></table></figure><p><mark style="background:green;border-radius:10px;color:white;border:none">解决方案：</mark></p><p>根据提示的位置找到并释放该内存。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *ch = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="number">8</span>));</span><br><span class="line">free ch;</span><br><span class="line">ch = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><p>另外，也可以使用智能指针管理该指针：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *ch = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="number">8</span>));</span><br><span class="line"><span class="function">shared_ptr&lt;<span class="type">char</span>&gt; <span class="title">spCh</span><span class="params">(ch)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="new-内存泄漏"><a href="#new-内存泄漏" class="headerlink" title="# new 内存泄漏"></a># <code>new</code> 内存泄漏</h2><p>关于 <code>new</code> 的内存泄漏分析写了一段代码用来展示一下：</p><p><font size=1>注：代码 Section2 部分为一个崩溃代码，堆内存申请后使用时一处，而在堆内存申请和释放时以及程序结束时释放堆内存时，都 <mark>存在堆溢出检查</mark> ，检查点会抛出异常，导致程序奔溃。</font></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码 Section2</span></span><br><span class="line"><span class="comment">// 该函数代码还涉及奔溃问题</span></span><br><span class="line"><span class="function"><span class="type">int</span>* <span class="title">test_heap_alloc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span>* pTable = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">256</span>); <span class="comment">// 申请一个int结构体变量，初始值为256;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">pTable[i] = i;</span><br><span class="line"><span class="keyword">return</span> pTable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">test_heap_alloc</span>();</span><br><span class="line">    <span class="comment">// 执行上述代码之后再去下边这句申请堆内存会奔溃。</span></span><br><span class="line">    <span class="type">char</span>* p = <span class="keyword">new</span> <span class="built_in">char</span>(<span class="number">0</span>); <span class="comment">// 申请一个字节，内容初始化为0</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下为 vld 生成的泄漏日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Visual Leak Detector detected memory leaks!</span><br><span class="line">---------- Block 1 at 0x010AAC68: 4 bytes ----------</span><br><span class="line">  Leak Hash: 0x03729B3D, Count: 1, Total 4 bytes</span><br><span class="line">  Call Stack (TID 33760):</span><br><span class="line">    ucrtbase.dll!malloc()</span><br><span class="line">    d:\agent\_work\3\s\src\vctools\crt\vcstartup\src\heap\new_scalar.cpp (35): vldforptr.exe!operator new() + 0x8 bytes</span><br><span class="line">    d:\code_source\c++\vs2019\vldforptr\vldforptr.cpp (45): vldforptr.exe!main() + 0x7 bytes</span><br><span class="line">    KERNEL32.DLL!BaseThreadInitThunk() + 0x19 bytes</span><br><span class="line">    ntdll.dll!RtlGetAppContainerNamedObjectPath() + 0x11E bytes</span><br><span class="line">    ntdll.dll!RtlGetAppContainerNamedObjectPath() + 0xEE bytes</span><br><span class="line">  Data:</span><br><span class="line">    00 00 00 00                                                  ........ ........</span><br></pre></td></tr></table></figure><p><mark style="background:green;border-radius:10px;color:white;border:none">解决方案：</mark></p><p>调用 <code>delete</code> 释放 <code>new</code> 出来的内存。</p><ol><li><p>问题：不确定变量什么时候使用完的，如何释放？</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用智能指针</span></span><br><span class="line"><span class="type">char</span> *ch = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">256</span>];</span><br><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">char</span>&gt; <span class="title">spCh</span><span class="params">(ch)</span></span>;</span><br></pre></td></tr></table></figure></li></ol><h3 id="strdup-内存泄漏"><a href="#strdup-内存泄漏" class="headerlink" title="# strdup 内存泄漏"></a># <code>strdup</code> 内存泄漏</h3><p><code>strdup</code>函数说明：</p><p>功能：将字符串拷贝到新建的位置处</p><p>返回值 ：返回一个指向新字符串的指针，该字符串是字符串s的副本，如果分配空间失败，则返回NULL值。新字符串的内存由strdup函数原型内部的malloc（）获得，需用free（）释放。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ntdll.dll!RtlAllocateHeap()</span><br><span class="line">minkernel\crts\ucrt\src\appcrt\heap\malloc_base.cpp (34): XXX.dll!_malloc_base() + 0xF bytes</span><br><span class="line">XXX.dll!BUF_strndup() + 0x8A bytes</span><br></pre></td></tr></table></figure><p>把返回内存地址的释放权交给了别的变量，这就很容易忘记释放，所以 <code>strdup</code> 这个函数也很容易造成内存泄漏。</p><h1 id="整理"><a href="#整理" class="headerlink" title="整理"></a>整理</h1><h2 id="malloc-base"><a href="#malloc-base" class="headerlink" title="# _malloc_base"></a># <code>_malloc_base</code></h2><p><code>_malloc_base</code> 就是编译器编译之后的 <code>malloc</code>。</p><p>查看vld的log可以看到，堆栈显示的 <code>_malloc_base</code> 所在的文件夹为 <code>minkernel\crts\ucrt\src\appcrt\heap\malloc_base.cpp</code>，这个文件就是 <code>malloc</code> 声明和定义的文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">领导您好！</span><br><span class="line">以下内容为本次绩效期间我的工作概述以及自我评价。</span><br><span class="line"></span><br><span class="line">本次绩效期间，我的主要工作内容集中在零信任国信版本和天擎零信任插件部分，同时也负责了部分工行、标板的需求开发（SPA、异常告警、命令行登录等）。零信任国信版本共计发布版本两次，均在发布版本之前完成了需求的开发和bug的修复，涉及的需求十多项，需求提测均通过，在完成需求的同时，整理编写了相应的技术开发文档十多篇，同时也补充了零信任客户端部分配置文件的说明文档。开发同时，针对国信零信任版本的升级故障问题（升级失败，升级检测问题），优化了该部分的逻辑，对整个客户端的无逻辑代码和日志部分进行了优化，以便于后续快速定位和分析问题，国信发布版本期间，为保证出包顺利，解决临时出现的问题，与团队一起解决问题并完成版本发布的任务；零信任插件部分，插件的开发让我学习到了较多框架方面的知识，了解了插件的开发以及团队联调的过程，零信任插件的开发在团队帮助下开发较为顺利，并且按时提测，且完成度较高，故障部分相对较少，调整部分基本为业务方面的逻辑调整。工行和标板的需求也是在计划内完成了需求的开发并提测成功，本次绩效期间，工作充实，如期完成了各项需求开发。不足就是多个需求的开发和提测过程相对较慢，由于环境（tac）问题，在开发自测和提测过程中出现了效果不一致的情况，在以后开发中需要注意该方面问题对开发提测的影响，提测前尽量保证自测完整，需求完善。</span><br><span class="line"></span><br><span class="line">以上就是本期自我评价。</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 内存泄漏 </category>
          
          <category> 实战 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内存泄漏 </tag>
            
            <tag> 实战 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windbg 定位内存泄漏</title>
      <link href="/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/WinDbg%E5%AE%9A%E4%BD%8D%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"/>
      <url>/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/WinDbg%E5%AE%9A%E4%BD%8D%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：使用 Windbg 定位内存泄漏</p></blockquote><p>[toc]</p><h1 id="windbg-定位内存泄漏"><a href="#windbg-定位内存泄漏" class="headerlink" title="windbg 定位内存泄漏"></a>windbg 定位内存泄漏</h1><p>主要使用 <code>!heap</code> 命令</p><p>使用Windbg检测Windows程序内存泄漏的步骤如下：</p><ol><li>启动程序：使用Windbg启动需要检测内存泄漏的程序，可以通过在Windbg中选择“文件”-&gt;“打开程序”来打开程序。</li><li>设置符号路径：在Windbg中，可以通过设置符号路径来加载程序的符号信息，方便调试。可以通过在Windbg中输入“.sympath”命令来设置符号路径，例如：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.sympath+ C:\Symbols</span><br></pre></td></tr></table></figure><p>其中，C:\Symbols是符号文件的路径。</p><ol><li>启用gflags：gflags是Windows提供的一个工具，可以用来设置程序的调试标志。可以通过在命令行中输入以下命令来启用gflags：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gflags /i your_program.exe +ust</span><br></pre></td></tr></table></figure><p>其中，your_program.exe是需要检测内存泄漏的程序的名称。</p><ol><li>运行程序：在Windbg中，可以通过输入“g”命令来运行程序。</li><li>检测内存泄漏：在程序运行过程中，可以通过输入“!heap -s”命令来查看程序的堆内存使用情况，例如：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!heap -s</span><br></pre></td></tr></table></figure><p>该命令会输出程序的堆内存使用情况，包括已分配的内存块数量、已释放的内存块数量、已分配的内存块总大小、已释放的内存块总大小等信息。</p><ol><li>输出内存泄漏信息：在程序运行结束后，可以通过输入“!heap -stat -h handle”命令来输出内存泄漏信息，例如：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!heap -stat -h handle</span><br></pre></td></tr></table></figure><p>该命令会输出程序中所有未释放的内存块的信息，包括内存块的大小、地址、分配位置等信息。</p><p>需要注意的是，使用Windbg检测内存泄漏需要一定的调试经验和技巧，对程序的性能也会产生一定的影响。因此，在正式发布程序之前，应该关闭gflags功能。可以通过在命令行中输入以下命令来关闭gflags：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gflags /i your_program.exe -ust</span><br></pre></td></tr></table></figure><p>其中，your_program.exe是需要关闭gflags功能的程序的名称。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 内存泄漏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windbg </tag>
            
            <tag> 内存泄漏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【不敢说一文搞懂】VLD 内存泄漏定位</title>
      <link href="/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/vld%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"/>
      <url>/OS/Windows/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/vld%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>半学半练，定位了一把内存泄漏的问题。</p><p>内存泄漏工具的想必大家都知道了，主要使用 VLD 这个工具。</p><h1 id="VLD-下载安装和使用"><a href="#VLD-下载安装和使用" class="headerlink" title="VLD 下载安装和使用"></a>VLD 下载安装和使用</h1><h2 id="1-下载和安装"><a href="#1-下载和安装" class="headerlink" title="1. 下载和安装"></a>1. 下载和安装</h2><p><a href="https://kinddragon.github.io/vld/">Visual Leak Detector | Enhanced Memory Leak Detection for Visual C++</a></p><p>点击上方链接下载和安装 vld 工具，记住安装的位置，后续有很多文件会使用到，需要拷贝移动到相应的文件中。</p><h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h2><ol><li>安装完成后，找到安装所在的文件夹</li><li>找到 vs studio 中 <mark>标准头文文件</mark> 所在的文件夹，一般会在对应的 <code>windows kits</code> 所在的文件夹中找到。如：  <code>C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt</code>。拷贝安装目录下 <code>include</code> 中的 头文件到该目录，注意有几个 <code>kits</code> 环境就尽量拷贝几个，万一用到呢</li><li>找到 vs studio 中 <mark>库文件</mark> 所在的文件夹，一般会在对应的 <code>windows kits</code> 所在的文件夹中找到。如：  <code>C:\Program Files (x86)\Windows Kits\10\Lib\(kits 版本号)\um\</code>。拷贝安装目录下 <code>lib</code> 目录下对应位数的 <code>lib</code> 文件到 <code>kits</code> 对应的 <code>um\x64</code>或<code>um\x86</code>  文件夹中。</li></ol><p><img src="/vld%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/vld-source.png" alt="image-20220913162958861"></p><p>到这一步，只要在程序中引入 <code>vld</code> 头文件就可以正常使用了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vld.h&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="3-在-vs2015-以上的版本中使用"><a href="#3-在-vs2015-以上的版本中使用" class="headerlink" title="3. 在 vs2015 以上的版本中使用"></a>3. 在 vs2015 以上的版本中使用</h2><blockquote><p>安装的时候就可以看到 vld 只支持到 vs2015。所以在 vs 更高的版本中使用时，需要一些额外的操作。</p><p>影响：在vs高版本中使用时，虽然能定位泄漏问题，但是不显示文件名和行号。</p></blockquote><p>解决办法：</p><p>在 vs 工程设置中按下图设置：</p><p><img src="/vld%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/vs-vld-config.png" alt="vs-vld-config"></p><h2 id="4-release-模式下进行内存泄漏检测"><a href="#4-release-模式下进行内存泄漏检测" class="headerlink" title="4. release 模式下进行内存泄漏检测"></a>4. release 模式下进行内存泄漏检测</h2><p>在 Debug 模式下，直接在工程中源文件中任意位置引入 <code>&lt;vld.h&gt;</code> 即可，编译之后的可执行文件就带有泄漏检测的功能。</p><p>但是在 Release 模式下则需要做一下额外的处理。</p><ol><li><p>同 Debug 版本在 VS 中一样配置好 VLD 的相关信息</p></li><li><p>拷贝 VLD 安装目录下 <code>bin\win32</code> 目录下所有的文件和 <code>vld.ini</code> 到工程目标路径下(可执行文件的目录)。</p></li><li><p>在程序入口处的 <code>cpp</code> 文件中，定义强制检测宏和包含 <code>vld</code> 头文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> VLD_FORCE_ENABLE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vld.h&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>在程序启动和退出时，分别增加以下函数调用</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">VLDGlobalEnable</span>();</span><br><span class="line">    <span class="built_in">VLDReportLeaks</span>();</span><br><span class="line">    <span class="comment">//some code...</span></span><br><span class="line">    <span class="built_in">VLDGlobalDisable</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>增加检测模块（如加载的 <code>dll</code> 文件）</p><blockquote><p>以上配置后，默认情况下只会检测主线程的模块，要想增加其他模块的内存泄漏检测，需要配置 <code>vld.ini</code> 配置文件中的 <code>ForceIncludeModules</code> 配置项。在该配置项后增加需要检测的模块。如：<code>ForceIncludeModules=demo1.dll;demo2.dll</code></p></blockquote></li><li><p>配置输出方式</p><p>同样还是配置文件中修改。设置配置文件中 <code>ReportTo</code> 的值即可：</p><ul><li>debugger：控制台</li><li>file: 文件 （默认会输出在运行程序的目录下，也可能会输出在 <code>syswow64</code> 这个系统目录下，<kbd>Win+R</kbd> 输入 <code>syswow64</code>即可打开这个目录。默认文件名：<code>memory_leak_report.txt</code>）</li><li>both：控制台和文件</li></ul><blockquote><p>关于 <code>VLD</code> 的配置文件：</p><p>  <code>Vld</code> 的库会检查程序所运行的当前目录是否存在 <code>vld.ini</code> 的配置文件，如果有，则加载里头的配置进行内存检测运行，如果没有取默认的配置参数运行，我们可以手动将 <code>vld.ini</code> 的文件拷贝到程序的运行目录中即可。</p><p>关于 <code>vld.ini</code> 的几个注意的参数：</p><ol><li><code>VLD = on</code> 总开关，是否启用 <code>VLD</code> 功能，默认为 <code>yes</code> </li><li><code>MaxDataDump = 256</code> 用来显示检测到的内在泄露的块的地址大小，默认256，其实就是显示多少个byte的内容。</li><li><code>MaxTraceFrames = 64</code>   设置 <code>VLD</code> 检测到堆栈的最大层极，也就是frame的深度</li><li><code>ReportFile = xxx</code>设置 <code>VLD</code> 生成报告的位置和报告的文件名，默认为：<code>.\memory_leak_report.txt</code> ，程序当前运行目录中。</li><li><code>ReportTo = debugger</code>  设置 <code>VLD</code> 生成报告的方式，debugger为在控制台输出 <code>VLD</code> 的报告信息，file在指定目录下生成报告文件，both为即输出也生成报告。如果你的程序为带窗体的程序，需要设置为file或both.</li></ol></blockquote></li></ol><h1 id="问题1：不显示文件名和行号"><a href="#问题1：不显示文件名和行号" class="headerlink" title="问题1：不显示文件名和行号"></a>问题1：不显示文件名和行号</h1><p>缺少 <code>pdb</code> 文件</p><p>如果程序运行之后生成的 <code>memory_leak_report</code> 中还是不显示行号，则试试把pdb文件放在程序的运行目录试试。</p><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ol><li><p><a href="https://blog.csdn.net/qq_22108657/article/details/120884329">【VS2019】C&#x2F;C++内存泄漏检测工具：Visual Leak Detector超详细安装教程（for windows）_执行x的博客-CSDN博客_vs2019内存泄漏检测</a></p></li><li><p><a href="https://blog.csdn.net/xiaomucgwlmx/article/details/87630671">使用VLD进行内存泄漏检测(release + debug)_OH,CGWLMXUP的博客-CSDN博客_release vld</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> 内存泄漏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 内存泄漏 </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>共享文件夹</title>
      <link href="/OS/Windows/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
      <url>/OS/Windows/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
      
        <content type="html"><![CDATA[<p>最近由于项目需求，需要编写一个监控本机共享文件夹的变化的模块，经过查询资料，找到并实现了一个较为稳定的方式<br>项目实现是使用Win32 C++的，测试平台是Win 7 64和Win 10 64，XP测试也是好使的。下面是具体实现</p><p>首先要获取并监控系统共享文件夹的路径，相关注册表路径为 HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Share ,他的值的格式为如图所示，</p><p><img src="/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/20190527113742209.png" alt="共享文件注册表"></p><h1 id="C-获取共享文件夹目录"><a href="#C-获取共享文件夹目录" class="headerlink" title="C++ 获取共享文件夹目录"></a>C++ 获取共享文件夹目录</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">GetSharedFoldersList</span><span class="params">(map&lt;CString, HANDLE&gt; &amp;theList)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">BOOL bFlag = FALSE;</span><br><span class="line">HKEY hKey = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//清空列表</span></span><br><span class="line">theList.<span class="built_in">clear</span>();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Share</span></span><br><span class="line"><span class="comment">//通过注册表获取共享文件夹列表</span></span><br><span class="line">HKEY rootKey = REG_SHARE_KEY;</span><br><span class="line">CString szRegPath = REG_SHARE_PATH;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ErrCode;</span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != (ErrCode = <span class="built_in">RegOpenKeyEx</span>(rootKey, szRegPath, <span class="number">0</span>, KEY_READ | KEY_WOW64_64KEY, &amp;hKey)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">TCHAR szValue[MAX_VALUE_NAME] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">DWORD dwValueSize = MAX_VALUE_NAME;</span><br><span class="line"><span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">DWORD dwBufferSize = <span class="number">255</span>;</span><br><span class="line">DWORD dwType;</span><br><span class="line">TCHAR *szValBuffer = <span class="literal">NULL</span>;</span><br><span class="line">DWORD dwSize;</span><br><span class="line"><span class="keyword">while</span> (ERROR_NO_MORE_ITEMS != <span class="built_in">RegEnumValue</span> (</span><br><span class="line">hKey, index, szValue, &amp;dwValueSize, <span class="literal">NULL</span>, &amp;dwType, <span class="literal">NULL</span>, &amp;dwBufferSize))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//判断值类型</span></span><br><span class="line"><span class="keyword">switch</span>(dwType)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//只找多个串的值</span></span><br><span class="line"><span class="keyword">case</span> REG_MULTI_SZ:</span><br><span class="line">&#123;</span><br><span class="line">dwSize = dwBufferSize + <span class="number">1</span>;</span><br><span class="line">szValBuffer = <span class="keyword">new</span> TCHAR[dwSize];</span><br><span class="line"><span class="built_in">ZeroMemory</span>(szValBuffer, dwSize);</span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != <span class="built_in">RegQueryValueEx</span>(hKey, szValue, <span class="number">0</span>, &amp;dwType, (LPBYTE)szValBuffer, &amp;dwBufferSize))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">CString TmpValue;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;szValBuffer[i] != <span class="string">&#x27;\0&#x27;</span> ;i += j + <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>;szValBuffer[i + j] != <span class="string">&#x27;\0&#x27;</span>;j ++)</span><br><span class="line">&#123;</span><br><span class="line">TmpValue += szValBuffer[i + j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果找到共享路径，则直接放入容器，然后进行下一个路径的查找</span></span><br><span class="line"><span class="keyword">if</span> (TmpValue.<span class="built_in">Find</span>(_T(<span class="string">&quot;Path=&quot;</span>)) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//m_vSharedList.push_back(TmpValue.Right(TmpValue.GetLength() - 5));</span></span><br><span class="line">CString Tmp = TmpValue.<span class="built_in">Right</span>(TmpValue.<span class="built_in">GetLength</span>() - <span class="number">5</span>);</span><br><span class="line">CString szTmp = Tmp;</span><br><span class="line">Tmp.<span class="built_in">MakeLower</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">TmpValue = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> szValBuffer;</span><br><span class="line">szValBuffer = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//其他类型跳过</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">dwValueSize = MAX_VALUE_NAME;</span><br><span class="line">dwBufferSize = <span class="number">255</span>;</span><br><span class="line">index ++;</span><br><span class="line">&#125;</span><br><span class="line">bFlag = TRUE;</span><br><span class="line">&#125;<span class="keyword">while</span>(FALSE);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (hKey != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">RegCloseKey</span>(hKey);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> bFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="C-监控共享注册表变化"><a href="#C-监控共享注册表变化" class="headerlink" title="C++监控共享注册表变化"></a>C++监控共享注册表变化</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监控注册表项以更新共享文件夹列表</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">SharedMonitor::RefreshThread</span><span class="params">(LPVOID lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SharedMonitor *pThis = (SharedMonitor *)lpParam;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//只监控值的改变</span></span><br><span class="line">DWORD  dwFilter = REG_NOTIFY_CHANGE_LAST_SET;</span><br><span class="line"> </span><br><span class="line">HKEY hKey;</span><br><span class="line">HKEY rootKey = REG_SHARE_KEY;</span><br><span class="line">CString szRegPath = REG_SHARE_PATH;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//等待10分钟</span></span><br><span class="line"><span class="type">int</span> iWaitTime = <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">while</span> (TRUE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//监控注册表项改变</span></span><br><span class="line"><span class="comment">//Sleep(iWaitTime);</span></span><br><span class="line">HANDLE hEvent;</span><br><span class="line">BOOL bFlag = FALSE;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != <span class="built_in">RegOpenKeyEx</span>(rootKey, szRegPath, <span class="number">0</span>, KEY_ALL_ACCESS | KEY_WOW64_64KEY, &amp;hKey))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebugA</span> (<span class="string">&quot;RegMonitorThread--- RegOpenKeyEx ERR!&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == (hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="literal">NULL</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebugA</span> (<span class="string">&quot;CreateEvent ERR&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != <span class="built_in">RegNotifyChangeKeyValue</span> (hKey, TRUE, dwFilter, hEvent, TRUE))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebugA</span> (<span class="string">&quot;RegNotifyChangeKeyValue ERR&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (WAIT_FAILED == <span class="built_in">WaitForSingleObject</span> (hEvent, INFINITE))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebugA</span> (<span class="string">&quot;WaitForSingleObject ERR&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">bFlag = TRUE;</span><br><span class="line">&#125;<span class="keyword">while</span>(FALSE);</span><br><span class="line"></span><br><span class="line"><span class="built_in">RegCloseKey</span> (hKey);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">CloseHandle</span> (hEvent);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//如果监控失败，则重新再来</span></span><br><span class="line"><span class="keyword">if</span> (!bFlag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//等待系统将注册表消息发放完毕，否则有时候添加或删除的注册表项无法被枚举到</span></span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">200</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//进行共享列表枚举和比较</span></span><br><span class="line">map&lt;CString, HANDLE&gt; theNewList;</span><br><span class="line"><span class="comment">//获取新列表</span></span><br><span class="line">pThis-&gt;<span class="built_in">GetSharedFoldersList</span>(theNewList);</span><br><span class="line">map&lt;CString, HANDLE&gt; &amp;theOldList = pThis-&gt;<span class="built_in">GetListInstance</span>();</span><br><span class="line"> </span><br><span class="line">BOOL bFindNew = FALSE;</span><br><span class="line"><span class="comment">//比较两个列表</span></span><br><span class="line"><span class="comment">//添加旧列表中没有的共享</span></span><br><span class="line"><span class="keyword">for</span> (map&lt;CString, HANDLE&gt;::iterator it = theNewList.<span class="built_in">begin</span>();</span><br><span class="line">it != theNewList.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (theOldList.<span class="built_in">find</span>(it-&gt;first) == theOldList.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebug</span>(_T(<span class="string">&quot;----------Find New Share----------&quot;</span>));</span><br><span class="line"><span class="built_in">MyDebug</span>(it-&gt;first);</span><br><span class="line">theOldList[it-&gt;first] = <span class="number">0</span>;</span><br><span class="line">bFindNew = TRUE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//MyDebug(_T(&quot;---------Start Delete--------&quot;));</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要删除的列表,map不支持循环删除多个元素</span></span><br><span class="line">vector&lt;CString&gt; theDeleteList;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//删除旧列表中已经取消的共享</span></span><br><span class="line"><span class="keyword">for</span> (map&lt;CString, HANDLE&gt;::iterator it = theOldList.<span class="built_in">begin</span>();</span><br><span class="line">it != theOldList.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (theNewList.<span class="built_in">find</span>(it-&gt;first) == theNewList.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//结束监控线程</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">TerminateThread</span>(it-&gt;second, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebug</span>(_T(<span class="string">&quot;TerminateThread ERR&quot;</span>));</span><br><span class="line"><span class="built_in">MyDebug</span>(it-&gt;first);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//将线程占用的共享目录句柄释放</span></span><br><span class="line"><span class="keyword">if</span> (gs_mpDirHandleList[it-&gt;first])</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CloseHandle</span>(gs_mpDirHandleList[it-&gt;first]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(it-&gt;second);</span><br><span class="line"></span><br><span class="line">theDeleteList.<span class="built_in">push_back</span>(it-&gt;first);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">MyDebug</span>(_T(<span class="string">&quot;-----------DeleteList-------------&quot;</span>));</span><br><span class="line"><span class="comment">//删除旧列表中的过期共享</span></span><br><span class="line"><span class="keyword">for</span> (vector&lt;CString&gt;::iterator it = theDeleteList.<span class="built_in">begin</span>();</span><br><span class="line">it != theDeleteList.<span class="built_in">end</span>(); ++it)</span><br><span class="line">&#123;</span><br><span class="line">theOldList.<span class="built_in">erase</span>(*it);</span><br><span class="line"><span class="built_in">MyDebug</span>(*it);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//如果有新的共享</span></span><br><span class="line"><span class="keyword">if</span> (bFindNew)</span><br><span class="line">&#123;</span><br><span class="line">pThis-&gt;<span class="built_in">SetSharedMonitor</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="共享文件夹内文件监控"><a href="#共享文件夹内文件监控" class="headerlink" title="共享文件夹内文件监控"></a>共享文件夹内文件监控</h1><p>最后就是最终的目的，对共享文件夹内文件的变化进行监控操作。这里使用的是 WIN32 API ReadDirectoryChangesW ，这个的具体使用在我之前的一篇文章里有介绍，这里就不多说了，需要注意的一点是 ReadDirectoryChangesW 函数的第一个参数所需的句柄需要 CreateFile 去创建，而且创建后需要一直占用着不能释放，而创建时所需的权限(第三个参数) 必须设置为 “FILE_SHARE_READ | FILE_SHARE_WRITE | FILE_SHARE_DELETE”，因为如果少任意一个就有可能导致某些第三方软件的使用出现异常，例如迅雷下载，浏览器下载之类的。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监控线程</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ATSharedMonitor::MonitorThread</span><span class="params">(LPVOID lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CString szRootPath = *(CString *)lpParam;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">HANDLE hRootHandle = <span class="built_in">CreateFile</span>(</span><br><span class="line">szRootPath,<span class="comment">//监控路径</span></span><br><span class="line">FILE_LIST_DIRECTORY, </span><br><span class="line">FILE_SHARE_READ | FILE_SHARE_WRITE | FILE_SHARE_DELETE,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">OPEN_EXISTING,</span><br><span class="line">FILE_FLAG_BACKUP_SEMANTICS<span class="comment">/* | FILE_FLAG_OVERLAPPED*/</span>,</span><br><span class="line"><span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">FAILED_HANDLE</span>(hRootHandle))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebug</span>(_T(<span class="string">&quot;CreateFile Fail&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//将目录句柄放到线程对应容器中</span></span><br><span class="line">gs_mpDirHandleList[szRootPath] = hRootHandle;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//OUTPUT_PARAM_DEBUGA(&quot;The CurrentThread:%X&quot;, GetCurrentThread());</span></span><br><span class="line"> </span><br><span class="line">szRootPath += _T(<span class="string">&quot;\\&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="type">wchar_t</span> notify[<span class="number">1024</span>];</span><br><span class="line"><span class="built_in">ZeroMemory</span>(notify, <span class="number">1024</span>);</span><br><span class="line">DWORD dwBytes;</span><br><span class="line">FILE_NOTIFY_INFORMATION *pNotify = (FILE_NOTIFY_INFORMATION *)notify;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//过滤同一个文件的操作 </span></span><br><span class="line">CString szLastFile = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> (TRUE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">ReadDirectoryChangesW</span> (hRootHandle, &amp;notify, <span class="built_in">sizeof</span>(notify), TRUE,</span><br><span class="line">FILE_NOTIFY_CHANGE_CREATION | FILE_NOTIFY_CHANGE_FILE_NAME | </span><br><span class="line">FILE_NOTIFY_CHANGE_DIR_NAME | FILE_NOTIFY_CHANGE_LAST_WRITE,</span><br><span class="line">&amp;dwBytes, <span class="literal">NULL</span>, <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MyDebug</span>(_T(<span class="string">&quot;---------Change Happened!------------&quot;</span>));</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">pNotify-&gt;FileName[pNotify-&gt;FileNameLength / <span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="comment">//CString tmp = pNotify-&gt;FileName;</span></span><br><span class="line"><span class="comment">//tmp.MakeLower ();</span></span><br><span class="line"> </span><br><span class="line">CString TmpPath = szRootPath + pNotify-&gt;FileName;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">switch</span>(pNotify-&gt;Action)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//重命名获取</span></span><br><span class="line"> <span class="keyword">case</span> FILE_ACTION_RENAMED_OLD_NAME:</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">MyDebug</span> (<span class="built_in">TEXT</span>(<span class="string">&quot;文件更名 :&quot;</span>) + TmpPath);</span><br><span class="line"> PFILE_NOTIFY_INFORMATION p = (PFILE_NOTIFY_INFORMATION)((<span class="type">char</span>*)pNotify+pNotify-&gt;NextEntryOffset);</span><br><span class="line"> p-&gt;FileName[p-&gt;FileNameLength/<span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"> CString newName = szRootPath + p-&gt;FileName;</span><br><span class="line"> <span class="built_in">MyDebug</span>(newName);</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">break</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">//删除</span></span><br><span class="line"><span class="comment">// case FILE_ACTION_REMOVED:</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// MyDebug (TEXT(&quot;文件删除 :&quot;) + TmpPath);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//修改..略过文件夹的修改,过滤同一个文件的修改</span></span><br><span class="line"><span class="keyword">case</span> FILE_ACTION_MODIFIED:</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">PathIsDirectory</span>(TmpPath) <span class="comment">/*&amp;&amp; szLastFile.CompareNoCase(pNotify-&gt;FileName) != 0*/</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//szLastFile = pNotify-&gt;FileName;</span></span><br><span class="line"><span class="built_in">MyDebug</span> (<span class="built_in">TEXT</span>(<span class="string">&quot;文件修改 :&quot;</span>) + TmpPath);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//新建文件获取</span></span><br><span class="line"><span class="keyword">case</span> FILE_ACTION_ADDED:</span><br><span class="line"> &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">PathIsDirectory</span>(TmpPath) <span class="comment">/*&amp;&amp; szLastFile.CompareNoCase(pNotify-&gt;FileName) != 0*/</span>)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="built_in">MyDebug</span> (<span class="built_in">TEXT</span>(<span class="string">&quot;文件添加 :&quot;</span>) + TmpPath);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">break</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 共享文件夹 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows聚焦不更新</title>
      <link href="/OS/Windows/windows%E8%81%9A%E7%84%A6%E9%97%AE%E9%A2%98/"/>
      <url>/OS/Windows/windows%E8%81%9A%E7%84%A6%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h1><p>在应用商店安装 <code>dynamic theme</code></p><h1 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h1><p>先将个性化锁屏界面选项由”Windows 聚焦”改为”图片”。</p><p>然后去删除</p><p><code>C:\Users\你自己的用户名\AppData\Local\Packages\Microsoft.Windows.ContentDeliveryManager_***\Settings</code> (***为随机数字)目录下<code>settings.dat</code> 和 <code>roaming.lock</code> 这两个文件。（注：<code>AppData</code> 等是隐藏的文件夹或文件）</p><p>再然后回到个性化锁屏界面将选项由”图片”改回”Windows 聚焦”。</p><p>稍等，OK!</p><p>随后应该可以看到 <code>:...\Microsoft.Windows.ContentDeliveryManager_***\LocalState\Assets</code> 文件夹里下载了一批聚焦图片</p><p><code>..\Microsoft.Windows.ContentDeliveryManager_***\settings</code> 目录下重新生成了 <code>settings.dat</code> 文件。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>删除文件夹</title>
      <link href="/OS/Windows/cmd/%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
      <url>/OS/Windows/cmd/%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;%<span class="number">1</span>&quot; == &quot;h&quot; <span class="keyword">goto</span> begin</span><br><span class="line">mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~nx0&quot;&quot; h&quot;,<span class="number">0</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line">:begin</span><br><span class="line"><span class="comment">REM</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rd</span> /Q /S <span class="variable">%programdata%</span>\TrustAgent\logs</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> cmd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
            <tag> 文件夹 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmd——route</title>
      <link href="/OS/Windows/cmd/route/"/>
      <url>/OS/Windows/cmd/route/</url>
      
        <content type="html"><![CDATA[<p>Route 命令</p><p>  Route命令用于在本地IP路由表中显示和修改条目。在排除网络故障时常会用到。</p><p>  使用不带参数的Route或 <code>Route /?</code> 可以显示帮助。</p><p>语法：</p><p>  <code>route [-f] [-p] [command [destination] [mask netmask] [gateway] [metric] [if interface]</code></p><p>-f 选项</p><p>  <code>Route –f</code> 命令清除所有网关项的路由表。如果该参数与某个命令组合使用，路由表将在运行命令前清除。</p><p>  如下图所示，执行 <code>route –f</code> 命令后，再用 <code>route print</code> 打印路由表时，可看到路由表为空。</p><p>-p 选项</p><p>  与 <code>route add</code> 命令结合使用时，将路由设备为在系统引导期间保持不变。</p><p>  默认情况下，重新启动系统时，不保存路由。</p><p>  当在 <code>route add</code> 命令中加入-p参数时，<code>route print</code> 命令就能看到永久路由了。</p><h1 id="route-print"><a href="#route-print" class="headerlink" title="route print"></a>route print</h1><p>Print命令</p><p>  接下来，我们将介绍Print、Add、Delete、Chance四个常用的Command命令。</p><p>  Route print命令显示IP路由表的完整内容，如下图所示：首先显示了当前主机的所有接口列表，接下来显示IPv4路由表和IPv4永久路由，可以看到，我的IPv4路由表有两个默认网关，且无手动添加的IPv4永久路由。</p><p>  使用route print命令时，目标或网关可以为通配符，通配符指定为星号“*”。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route <span class="built_in">print</span> -4命令只显示IPv4的路由表信息。</span><br><span class="line"></span><br><span class="line">Route <span class="built_in">print</span> -6命令只显示IPv6的路由表信息。</span><br><span class="line"></span><br><span class="line">Route <span class="built_in">print</span> 192*命令只显示那些匹配192*的项。</span><br></pre></td></tr></table></figure><h1 id="route-add"><a href="#route-add" class="headerlink" title="route add"></a>route add</h1><p>例1：若要添加带有 192.168.12.1 默认网关地址的默认路由，</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add 0.0.0.0 mask 0.0.0.0 192.168.12.1</span><br></pre></td></tr></table></figure><p>例2：若要向带有 255.255.0.0 子网掩码和 10.27.0.1 下一跃点地址的 10.41.0.0 目标中添加一个路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add 10.41.0.0 mask 255.255.0.0 10.27.0.1</span><br></pre></td></tr></table></figure><p>例3：若要向带有 255.255.0.0 子网掩码和 10.27.0.1 下一跃点地址的 10.41.0.0 目标中添加一个永久路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -p add 10.41.0.0 mask 255.255.0.0 10.27.0.1</span><br></pre></td></tr></table></figure><p>例4：若要向带有 255.255.0.0 子网掩码、10.27.0.1 下一跃点地址且其成本值标为 7 的 10.41.0.0 目标中添加一个路由</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 metric 7</span><br></pre></td></tr></table></figure><p>例5：若要向带有 255.255.0.0 子网掩码、10.27.0.1 下一跃点地址且使用 0x3 接口索引的 10.41.0.0 目标中添加一个路由</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 <span class="keyword">if</span> 0x3</span><br></pre></td></tr></table></figure><p>如果未给出if，它将尝试查找给定网关的最佳接口。</p><p>例6：若本地的IP地址为172.16.1.100，网关为172.16.1.254，现有一条ADSL线路，路由器的地址为172.168.1.200，通过该地址可访问Internet。如何做到既想上网，又想访问网络内的资源？只需按以下三步操作即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一步：将本地的网关地址由172.16.1.254改为172.16.1.200</span><br><span class="line"></span><br><span class="line">第二步：route delete 0.0.0.0 mask 0.0.0.0 172.16.1.254</span><br><span class="line"></span><br><span class="line">第三步：route add 172.16.0.0 mask 255.255.0.0 172.16.1.100 -p metric 1</span><br></pre></td></tr></table></figure><p>Delete命令</p><p>  Route delete命令删除路由。</p><p>  使用route delete命令时，目标或网关可以为通配符，通配符指定为星号“*”。</p><p>例1：若要删除到带有 255.255.0.0 子网掩码的 10.41.0.0 目标的路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route delete 10.41.0.0 mask 255.255.0.0</span><br></pre></td></tr></table></figure><p>例2：若要删除以 10. 起始的 IP 路由表中的所有路由</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route delete 10.\*</span><br></pre></td></tr></table></figure><p>Change命令</p><p>  Route change命令只用于修改网关和&#x2F;或跃点数</p><p>例1：若要将带有 10.100.0.0 目标和 255.255.0.0 子网掩码的下一跃点地址从 10.100.0.1 修改为 10.100.0.254</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route change 10.100.0.0 mask 255.255.0.0 10.100.0.254</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> cmd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> route </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bcdedit 用法整理</title>
      <link href="/OS/Windows/cmd/bcdedit/"/>
      <url>/OS/Windows/cmd/bcdedit/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：bdcedit用法整理</p><p><strong>更多命令</strong>：<a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/devtest/bcdedit%E2%80%93bootdebug">https://docs.microsoft.com/zh-cn/windows-hardware/drivers/devtest/bcdedit–bootdebug</a></p></blockquote><p>[toc]</p><h1 id="禁用数字签名"><a href="#禁用数字签名" class="headerlink" title="禁用数字签名"></a>禁用数字签名</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /set testsigning on</span><br></pre></td></tr></table></figure><h1 id="windows操作提供内核调试"><a href="#windows操作提供内核调试" class="headerlink" title="windows操作提供内核调试"></a>windows操作提供内核调试</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /debug on <span class="comment"># 启动</span></span><br><span class="line">bcdedit /debug off <span class="comment"># 禁用</span></span><br></pre></td></tr></table></figure><h1 id="windows操作系统启动项的启动调试"><a href="#windows操作系统启动项的启动调试" class="headerlink" title="windows操作系统启动项的启动调试"></a>windows操作系统启动项的启动调试</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /bootdebug on <span class="comment"># 启用</span></span><br><span class="line">bcdedit /bootdebug off <span class="comment"># 禁用</span></span><br></pre></td></tr></table></figure><h1 id="永久禁用数字签名方法"><a href="#永久禁用数字签名方法" class="headerlink" title="永久禁用数字签名方法"></a>永久禁用数字签名方法</h1><ol><li>管理员CMD</li><li>输入 <code>bcdedit.exe /set nointegritychecks on</code>，执行完毕就结束了</li><li>如果要恢复签名，执行 <code>bcdedit.exe /set nointegritychecks off</code>就行</li></ol><h1 id="windbg和虚拟机的远程调试和网络调试设置"><a href="#windbg和虚拟机的远程调试和网络调试设置" class="headerlink" title="windbg和虚拟机的远程调试和网络调试设置"></a>windbg和虚拟机的远程调试和网络调试设置</h1><blockquote><p>参考：<a href="https://blog.csdn.net/m0_37567738/article/details/129062143">windbg和虚拟机下的远程调试和网络调试设置_windbg调试虚拟机_satadriver的博客-CSDN博客</a></p><p>微软官方文档：<a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/devtest/bcdedit--dbgsettings?redirectedfrom=MSDN">BCDEdit &#x2F;dbgsettings - Windows drivers | Microsoft Learn</a></p></blockquote><h1 id="WDF双机调试"><a href="#WDF双机调试" class="headerlink" title="WDF双机调试"></a>WDF双机调试</h1><blockquote><p>参考：<a href="https://blog.csdn.net/ljymoonlight/article/details/99709697">WDK1.2. bcdedit调试配置_bcdedit &#x2F;dbgsettings hostip_ljymoonlight的博客-CSDN博客</a></p></blockquote><h2 id="双机调试基本步骤"><a href="#双机调试基本步骤" class="headerlink" title="双机调试基本步骤"></a>双机调试基本步骤</h2><h3 id="网络连接"><a href="#网络连接" class="headerlink" title="网络连接"></a>网络连接</h3><h4 id="虚拟机设置"><a href="#虚拟机设置" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 打开调试模式</span></span><br><span class="line">bcdedit /debug on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置网络方式调试</span></span><br><span class="line"><span class="comment"># hostip：主机IP地址</span></span><br><span class="line"><span class="comment"># port: 主机的端口</span></span><br><span class="line"><span class="comment"># key：(可省略) 登录密码</span></span><br><span class="line">bcdedit /dbgsettings net hostip:192.168.0.102 port:50000 key:1.2.3.4</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 设置数字签名</span></span><br><span class="line">bcdedit /set testsigning on</span><br></pre></td></tr></table></figure><h4 id="主机windbg连接虚拟机"><a href="#主机windbg连接虚拟机" class="headerlink" title="主机windbg连接虚拟机"></a>主机windbg连接虚拟机</h4><p>如下图所示填入上述得到key或自定义设置的key之后连接即可。</p><p><img src="/images/bcdedit/1.png" alt="image-20230917115729090"></p><h3 id="串口调试"><a href="#串口调试" class="headerlink" title="串口调试"></a>串口调试</h3><h4 id="虚拟机设置-1"><a href="#虚拟机设置-1" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h4><ol><li><p>管理员cmd</p></li><li><p>依次输入以下指令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加新的引导项</span></span><br><span class="line">bcdedit /copy &#123;current&#125; /d Debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置引导项等待时间</span></span><br><span class="line">bcdedit /timeout 30</span><br></pre></td></tr></table></figure></li><li><p>重启操作系统并再次管理员运行CMD</p></li><li><p>依次输入以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /dbgsettings SERIAL DEBUGPORT:1 BAUDRATE:115200</span><br><span class="line"></span><br><span class="line">bcdedit /bootdebug on</span><br><span class="line"></span><br><span class="line">bcdedit /debug on</span><br></pre></td></tr></table></figure></li><li><p>运行 ‘msconfig’</p><p><img src="/images/bcdedit/image-20230917204346062.png" alt="image-20230917204346062"></p><ul><li>win+R 输入 msconfig</li><li>查看引导项是否有Debug模式<br><img src="/images/bcdedit/image-20230917204844775.png" alt="image-20230917204844775"></li><li>查看高级选项，调试端口和波特率<br><img src="/images/bcdedit/image-20230917205109487.png" alt="image-20230917205109487"></li></ul></li><li><p>到此为止，虚拟机设置完毕，启动后操作系统启动时选择 <code>Debug</code></p></li></ol><h4 id="Windbg连接"><a href="#Windbg连接" class="headerlink" title="Windbg连接"></a>Windbg连接</h4><ol><li>连接内核<br><img src="/images/bcdedit/image-20230917205922673.png" alt="image-20230917205922673"></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> cmd </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>windows 程序自动生成dump文件</title>
      <link href="/OS/Windows/Windbg/windows-%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90dump%E6%96%87%E4%BB%B6/"/>
      <url>/OS/Windows/Windbg/windows-%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90dump%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="一、Windows-生成dump"><a href="#一、Windows-生成dump" class="headerlink" title="一、Windows 生成dump"></a>一、Windows 生成dump</h1><blockquote><p>本文主要说明windows操作系统下，程序如何自动生成dump文件</p></blockquote><h2 id="如果生成dump"><a href="#如果生成dump" class="headerlink" title="如果生成dump"></a>如果生成dump</h2><p>生成dump主要依赖于windowsapi函数 <code>SetUnhandledExceptionFilter</code>,参数为一个回调函数，主要依赖于该函数以及回调函数中的相关逻辑生成dump。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPTOP_LEVEL_EXCEPTION_FILTER WINAPI <span class="title">SetUnhandledExceptionFilter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        _In_ LPTOP_LEVEL_EXCEPTION_FILTER  lpTopLevelExceptionFilter）</span></span></span><br></pre></td></tr></table></figure><h3 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h3><ol><li>最好是在程序开始处设置回调</li><li>如果回调不生效，也可使用 <code>AddVectoredExceptionHandler</code> 函数设置回调，其用法与 <code>SetUnhandledExceptionFilter</code> 基本一致，但是需要注意的是，使用 <code>AddVectoredExceptionHandler</code> 后，<code>outpuydebugstring</code> 也会触发回调，所以这个函数慎用。</li></ol><h2 id="dump回调函数"><a href="#dump回调函数" class="headerlink" title="dump回调函数"></a>dump回调函数</h2><p>dump回调函数可根据自己的需求去编写，以下为一个示例：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG WINAPI <span class="title">MyUnhandledExceptionFilter</span><span class="params">( <span class="keyword">struct</span> _EXCEPTION_POINTERS *ExceptionInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SYSTEMTIME st;</span><br><span class="line">    <span class="built_in">GetLocalTime</span>(&amp;st);</span><br><span class="line"> </span><br><span class="line">    CString time_now = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    time_now.<span class="built_in">Format</span>(_T(<span class="string">&quot;%04d_%02d_%02d_%02d_%02d_%03d.dmp&quot;</span>), st.wYear, st.wMonth, st.wDay,st.wHour, st.wMinute, st.wSecond, st.wMilliseconds);</span><br><span class="line">    CString dump_file_path = <span class="built_in">GetRootPath</span>();            <span class="comment">//获取程序所在的文件夹的路径</span></span><br><span class="line">    dump_file_path += _T(<span class="string">&quot;dump/&quot;</span>);</span><br><span class="line">    <span class="built_in">CreateDirectory</span>(dump_file_path, <span class="literal">NULL</span>);</span><br><span class="line">    dump_file_path += time_now;</span><br><span class="line">    </span><br><span class="line">    HANDLE hFile = <span class="built_in">CreateFile</span>(dump_file_path, GENERIC_READ|GENERIC_WRITE,</span><br><span class="line">        FILE_SHARE_WRITE, <span class="literal">NULL</span>, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( hFile == INVALID_HANDLE_VALUE )</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION; <span class="comment">// 往下传，继续交给 windows 默认的处理函数处理</span></span><br><span class="line"></span><br><span class="line">    MINIDUMP_EXCEPTION_INFORMATION mdei;</span><br><span class="line">    mdei.ThreadId = <span class="built_in">GetCurrentThreadId</span>();</span><br><span class="line">    mdei.ExceptionPointers = ExceptionInfo;</span><br><span class="line">    mdei.ClientPointers = <span class="literal">NULL</span>;</span><br><span class="line">    MINIDUMP_CALLBACK_INFORMATION mci;  </span><br><span class="line">    mci.CallbackRoutine     = <span class="literal">NULL</span>;  </span><br><span class="line">    mci.CallbackParam       = <span class="number">0</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">MiniDumpWriteDump</span>(<span class="built_in">GetCurrentProcess</span>(), <span class="built_in">GetCurrentProcessId</span>(), hFile, MiniDumpNormal, &amp;mdei, <span class="literal">NULL</span>, &amp;mci);  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">CloseHandle</span>(hFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="设置回调"><a href="#设置回调" class="headerlink" title="设置回调"></a>设置回调</h2><p>写完回调函数之后，调用 <code>SetUnhandledExceptionFilter</code> ，入参为回调函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetUnhandledExceptionFilter</span>(MyUnhandledExceptionFilter);</span><br></pre></td></tr></table></figure><blockquote><p>到此，设置并捕获异常的接口完成，以下补充几点个人经验。</p></blockquote><h1 id="二、手写崩溃"><a href="#二、手写崩溃" class="headerlink" title="二、手写崩溃"></a>二、手写崩溃</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreteCrash</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> *ptr = <span class="literal">nullptr</span>;</span><br><span class="line">*ptr = n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三、回调不生效问题"><a href="#三、回调不生效问题" class="headerlink" title="三、回调不生效问题"></a>三、回调不生效问题</h1><blockquote><p><code>SetUnhandledExceptionFilter</code> 是无法捕获 <code>printf</code>, <code>scan</code>, <code>strlen</code> 等CRT函数的异常的，如<code>printf(NULL)</code> 异常;除此之外，在有的环境当中，因为软件被hook的问题，导致 <code>函数不生效，设置的回调往往不起作用，此时可以修改设置</code> 的函数地址来屏蔽其他软件的hook。</p></blockquote><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisableSetUnhandledExceptionFilter</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">void</span>* addr = (<span class="type">void</span>*)<span class="built_in">GetProcAddress</span>(<span class="built_in">LoadLibrary</span>(_T(<span class="string">&quot;kernel32.dll&quot;</span>)), <span class="string">&quot;SetUnhandledExceptionFilter&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (addr != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> code[<span class="number">16</span>];</span><br><span class="line">        <span class="type">int</span> size = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">        code[size++] = <span class="number">0x33</span>;</span><br><span class="line">        code[size++] = <span class="number">0xC0</span>;</span><br><span class="line">        code[size++] = <span class="number">0xC2</span>;</span><br><span class="line">        code[size++] = <span class="number">0x04</span>;</span><br><span class="line">        code[size++] = <span class="number">0x00</span>;</span><br><span class="line"> </span><br><span class="line">        DWORD dwOldFlag, dwTempFlag;</span><br><span class="line">        <span class="built_in">VirtualProtect</span>(addr, size, PAGE_READWRITE, &amp;dwOldFlag);</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), addr, code, size, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">VirtualProtect</span>(addr, size, dwOldFlag, &amp;dwTempFlag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><p>在程序启动并设置dump回调之后调用 <code>DisableSetUnhandledExceptionFilter</code>即可。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>经本人测试，在部分机器上，使用 <code>WriteProcessMemory</code>和 <code>VirtualProtect</code> 可能会导致程序崩溃，并且不会生成dump。可尝试修改 <code>VirtualProtect</code> 和 <code>WriteProcessMemory</code> 函数的参数测试。</p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>修改 <code>VirtualProtect</code> 的 flag.设置为 <code>PAGE_EXECUTE_READWRITE</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, PAGE_EXECUTE_READWRITE, &amp;dwOldFlag);</span><br></pre></td></tr></table></figure><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p><code>WriteProcessMemory</code> 可直接使用 <code>memcpy</code> 替代。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memcpy</span>(addr, code, size);</span><br></pre></td></tr></table></figure><h3 id="代码总结"><a href="#代码总结" class="headerlink" title="代码总结"></a>代码总结</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DWORD dwOldFlag = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, PAGE_EXECUTE_READWRITE, &amp;dwOldFlag);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">HANDLE hProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line"><span class="keyword">if</span> (!(hProcess == <span class="literal">NULL</span> || hProcess == INVALID_HANDLE_VALUE))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), addr, code, size, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(addr, code, size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="built_in">memcpy</span>(addr, code, size);</span><br><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, dwOldFlag, &amp;dwOldFlag);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> windbg </tag>
            
            <tag> dump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows 程序自动生成dump文件</title>
      <link href="/OS/Windows/Windbg/%E7%94%9F%E6%88%90dump/"/>
      <url>/OS/Windows/Windbg/%E7%94%9F%E6%88%90dump/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="一、Windows-生成dump"><a href="#一、Windows-生成dump" class="headerlink" title="一、Windows 生成dump"></a>一、Windows 生成dump</h1><blockquote><p>本文主要说明windows操作系统下，程序如何自动生成dump文件</p></blockquote><h2 id="如果生成dump"><a href="#如果生成dump" class="headerlink" title="如果生成dump"></a>如果生成dump</h2><p>生成dump主要依赖于windowsapi函数 <code>SetUnhandledExceptionFilter</code>,参数为一个回调函数，主要依赖于该函数以及回调函数中的相关逻辑生成dump。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPTOP_LEVEL_EXCEPTION_FILTER WINAPI <span class="title">SetUnhandledExceptionFilter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        _In_ LPTOP_LEVEL_EXCEPTION_FILTER  lpTopLevelExceptionFilter）</span></span></span><br></pre></td></tr></table></figure><h3 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h3><ol><li>最好是在程序开始处设置回调</li><li>如果回调不生效，也可使用 <code>AddVectoredExceptionHandler</code> 函数设置回调，其用法与 <code>SetUnhandledExceptionFilter</code> 基本一致，但是需要注意的是，使用 <code>AddVectoredExceptionHandler</code> 后，<code>outpuydebugstring</code> 也会触发回调，所以这个函数慎用。</li></ol><h2 id="dump回调函数"><a href="#dump回调函数" class="headerlink" title="dump回调函数"></a>dump回调函数</h2><p>dump回调函数可根据自己的需求去编写，以下为一个示例：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG WINAPI <span class="title">MyUnhandledExceptionFilter</span><span class="params">( <span class="keyword">struct</span> _EXCEPTION_POINTERS *ExceptionInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SYSTEMTIME st;</span><br><span class="line">    <span class="built_in">GetLocalTime</span>(&amp;st);</span><br><span class="line"> </span><br><span class="line">    CString time_now = _T(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    time_now.<span class="built_in">Format</span>(_T(<span class="string">&quot;%04d_%02d_%02d_%02d_%02d_%03d.dmp&quot;</span>), st.wYear, st.wMonth, st.wDay,st.wHour, st.wMinute, st.wSecond, st.wMilliseconds);</span><br><span class="line">    CString dump_file_path = <span class="built_in">GetRootPath</span>();            <span class="comment">//获取程序所在的文件夹的路径</span></span><br><span class="line">    dump_file_path += _T(<span class="string">&quot;dump/&quot;</span>);</span><br><span class="line">    <span class="built_in">CreateDirectory</span>(dump_file_path, <span class="literal">NULL</span>);</span><br><span class="line">    dump_file_path += time_now;</span><br><span class="line">    </span><br><span class="line">    HANDLE hFile = <span class="built_in">CreateFile</span>(dump_file_path, GENERIC_READ|GENERIC_WRITE,</span><br><span class="line">        FILE_SHARE_WRITE, <span class="literal">NULL</span>, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( hFile == INVALID_HANDLE_VALUE )</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION; <span class="comment">// 往下传，继续交给 windows 默认的处理函数处理</span></span><br><span class="line"></span><br><span class="line">    MINIDUMP_EXCEPTION_INFORMATION mdei;</span><br><span class="line">    mdei.ThreadId = <span class="built_in">GetCurrentThreadId</span>();</span><br><span class="line">    mdei.ExceptionPointers = ExceptionInfo;</span><br><span class="line">    mdei.ClientPointers = <span class="literal">NULL</span>;</span><br><span class="line">    MINIDUMP_CALLBACK_INFORMATION mci;  </span><br><span class="line">    mci.CallbackRoutine     = <span class="literal">NULL</span>;  </span><br><span class="line">    mci.CallbackParam       = <span class="number">0</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">MiniDumpWriteDump</span>(<span class="built_in">GetCurrentProcess</span>(), <span class="built_in">GetCurrentProcessId</span>(), hFile, MiniDumpNormal, &amp;mdei, <span class="literal">NULL</span>, &amp;mci);  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">CloseHandle</span>(hFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="设置回调"><a href="#设置回调" class="headerlink" title="设置回调"></a>设置回调</h2><p>写完回调函数之后，调用 <code>SetUnhandledExceptionFilter</code> ，入参为回调函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetUnhandledExceptionFilter</span>(MyUnhandledExceptionFilter);</span><br></pre></td></tr></table></figure><blockquote><p>到此，设置并捕获异常的接口完成，以下补充几点个人经验。</p></blockquote><h1 id="二、手写崩溃"><a href="#二、手写崩溃" class="headerlink" title="二、手写崩溃"></a>二、手写崩溃</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreteCrash</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> *ptr = <span class="literal">nullptr</span>;</span><br><span class="line">*ptr = n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三、回调不生效问题"><a href="#三、回调不生效问题" class="headerlink" title="三、回调不生效问题"></a>三、回调不生效问题</h1><blockquote><p><code>SetUnhandledExceptionFilter</code> 是无法捕获 <code>printf</code>, <code>scan</code>, <code>strlen</code> 等CRT函数的异常的，如<code>printf(NULL)</code> 异常;除此之外，在有的环境当中，因为软件被hook的问题，导致 <code>函数不生效，设置的回调往往不起作用，此时可以修改设置</code> 的函数地址来屏蔽其他软件的hook。</p></blockquote><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisableSetUnhandledExceptionFilter</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">void</span>* addr = (<span class="type">void</span>*)<span class="built_in">GetProcAddress</span>(<span class="built_in">LoadLibrary</span>(_T(<span class="string">&quot;kernel32.dll&quot;</span>)), <span class="string">&quot;SetUnhandledExceptionFilter&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (addr != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> code[<span class="number">16</span>];</span><br><span class="line">        <span class="type">int</span> size = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">        code[size++] = <span class="number">0x33</span>;</span><br><span class="line">        code[size++] = <span class="number">0xC0</span>;</span><br><span class="line">        code[size++] = <span class="number">0xC2</span>;</span><br><span class="line">        code[size++] = <span class="number">0x04</span>;</span><br><span class="line">        code[size++] = <span class="number">0x00</span>;</span><br><span class="line"> </span><br><span class="line">        DWORD dwOldFlag, dwTempFlag;</span><br><span class="line">        <span class="built_in">VirtualProtect</span>(addr, size, PAGE_READWRITE, &amp;dwOldFlag);</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), addr, code, size, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">VirtualProtect</span>(addr, size, dwOldFlag, &amp;dwTempFlag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><p>在程序启动并设置dump回调之后调用 <code>DisableSetUnhandledExceptionFilter</code>即可。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>经本人测试，在部分机器上，使用 <code>WriteProcessMemory</code>和 <code>VirtualProtect</code> 可能会导致程序崩溃，并且不会生成dump。可尝试修改 <code>VirtualProtect</code> 和 <code>WriteProcessMemory</code> 函数的参数测试。</p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>修改 <code>VirtualProtect</code> 的 flag.设置为 <code>PAGE_EXECUTE_READWRITE</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, PAGE_EXECUTE_READWRITE, &amp;dwOldFlag);</span><br></pre></td></tr></table></figure><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p><code>WriteProcessMemory</code> 可直接使用 <code>memcpy</code> 替代。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memcpy</span>(addr, code, size);</span><br></pre></td></tr></table></figure><h3 id="代码总结"><a href="#代码总结" class="headerlink" title="代码总结"></a>代码总结</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DWORD dwOldFlag = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, PAGE_EXECUTE_READWRITE, &amp;dwOldFlag);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">HANDLE hProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line"><span class="keyword">if</span> (!(hProcess == <span class="literal">NULL</span> || hProcess == INVALID_HANDLE_VALUE))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), addr, code, size, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(addr, code, size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="built_in">memcpy</span>(addr, code, size);</span><br><span class="line"><span class="built_in">VirtualProtect</span>(addr, size, dwOldFlag, &amp;dwOldFlag);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> windbg </tag>
            
            <tag> dump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windbg手册</title>
      <link href="/OS/Windows/Windbg/Windbg%E6%89%8B%E5%86%8C/"/>
      <url>/OS/Windows/Windbg/Windbg%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="0n-命令"><a href="#0n-命令" class="headerlink" title="? 0n 命令"></a>? 0n 命令</h2><p>Windbg中的 ?0n 是一个命令，用来设置表达式的数制为十进制。具体来说，当你需要查看一个内存地址或者变量以十进制格式时，可以使用 ?0n 命令。</p><p>在Windbg中，数制的表示：</p><ul><li><p>0x表示十六进制</p></li><li><p>0n表示十进制</p></li><li><p>0t表示八进制</p></li><li><p>0y表示二进制。</p></li></ul><p>Windbg默认数制为十六进制。</p><h2 id="切换线程"><a href="#切换线程" class="headerlink" title="切换线程"></a>切换线程</h2><p>在WinDbg中，可以使用以下命令来切换线程：</p><ol><li><code>~</code> 命令：用于切换当前活动线程。例如，<code>~0s</code>将切换到线程ID为0的线程。</li><li><code>~*</code> 命令：用于切换到所有线程中的下一个线程。</li><li><code>~[]</code> 命令：用于切换到特定索引的线程。例如，<code>~[3]s</code>将切换到索引为3的线程。</li></ol><p>请注意，使用这些命令时，要确保已经在调试会话中加载了适当的符号和源代码，并且已经打开了需要调试的进程和线程。</p><h2 id="切换进程"><a href="#切换进程" class="headerlink" title="切换进程"></a>切换进程</h2><p>在WinDbg中，可以使用以下命令来切换进程：</p><ol><li><code>|</code> 命令：用于切换当前活动进程。例如，<code>|1s</code>将切换到进程ID为1的进程。</li><li><code>~*</code> 命令：用于切换到所有进程中的下一个进程。</li><li><code>~[]</code> 命令：用于切换到特定索引的进程。例如，<code>~[3]s</code>将切换到索引为3的进程。</li></ol><p>请注意，使用这些命令时，要确保已经在调试会话中加载了适当的符号和源代码，并且已经打开了需要调试的进程和线程。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>winuser说明</title>
      <link href="/OS/Windows/WinUser/winuser%E4%BB%8B%E7%BB%8D/"/>
      <url>/OS/Windows/WinUser/winuser%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/">Winuser.h 标头 - Win32 apps | Microsoft Learn</a></p><p>[toc]</p><h1 id="winuser-相关函数说明"><a href="#winuser-相关函数说明" class="headerlink" title="winuser 相关函数说明"></a>winuser 相关函数说明</h1><h2 id="GetSystemMetrics"><a href="#GetSystemMetrics" class="headerlink" title="GetSystemMetrics"></a>GetSystemMetrics</h2><blockquote><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-getsystemmetrics">GetSystemMetrics 函数 (winuser.h) - Win32 apps | Microsoft Learn</a></p><p>检索指定的系统指标或系统配置设置。</p><p>请注意， <strong>GetSystemMetrics</strong> 检索的所有维度都以像素为单位。</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> iconWidth = <span class="built_in">GetSystemMetrics</span>(SM_CXSMICON);  <span class="comment">// 图标基准宽度 </span></span><br><span class="line"><span class="type">int</span> iconHeight = <span class="built_in">GetSystemMetrics</span>(SM_CYSMICON); <span class="comment">// 图标基准高度</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> WinUser </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> winuser </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windbg 基础命令</title>
      <link href="/OS/Windows/Windbg/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
      <url>/OS/Windows/Windbg/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>本文介绍windbg中的一些基础命令：</p><p>[toc]</p><h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><table><thead><tr><th align="left">说明</th><th align="left">命令</th><th align="left">用法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">说明</td><td align="left">命令</td><td align="left">用法</td><td align="left">描述</td></tr><tr><td align="left">帮助</td><td align="left">?</td><td align="left">?? 表达式</td><td align="left">显示常规命令计算表达式的值</td></tr><tr><td align="left">.help</td><td align="left">.help</td><td align="left">显示元命令(以 . 开头的命令)</td><td align="left"></td></tr><tr><td align="left">.hh</td><td align="left">.hh.hh bp</td><td align="left">打开windbg help文档打开windbg help文档，并自动输入bp命令进行搜索</td><td align="left"></td></tr><tr><td align="left">版本</td><td align="left">version</td><td align="left"></td><td align="left">显示调试器和调试目标版本</td></tr><tr><td align="left">vercommand</td><td align="left"></td><td align="left">显示调试器启动时的命令行</td><td align="left"></td></tr><tr><td align="left">vertarget</td><td align="left"></td><td align="left">显示调试目标系统信息</td><td align="left"></td></tr><tr><td align="left">清空屏幕</td><td align="left">.cls</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">查看异常信息</td><td align="left">.ecxr</td><td align="left"></td><td align="left">显示异常信息的上下文</td></tr><tr><td align="left">.lastevent</td><td align="left"></td><td align="left">显示最近一次发生的异常信息或事件</td><td align="left"></td></tr><tr><td align="left">.exr -1</td><td align="left"></td><td align="left">显示最近一次的异常记录</td><td align="left"></td></tr><tr><td align="left">!analyze</td><td align="left">!analyze -v!analyze -hang!analyze -f</td><td align="left">显示当前异常信息分析线程栈，看是否有线程blocking其他线程See an exception analysis even when the debugger does not detect an exception.</td><td align="left"></td></tr><tr><td align="left">寄存器</td><td align="left">r</td><td align="left"></td><td align="left">显示各寄存器的值</td></tr><tr><td align="left">时间</td><td align="left">.time</td><td align="left"></td><td align="left">显示system&#x2F;process&#x2F;kernel&#x2F;user time</td></tr><tr><td align="left">Switch between 32-bit and 64-bit mode</td><td align="left">!wow64exts.sw<br />.load wow64exts</td><td align="left"></td><td align="left">查看64位机器上生成的32位程序的dmp时，需要使用此命令转换一下模式!wow64exts.help 可查看相关帮助信息</td></tr></tbody></table><h3 id="调试命令"><a href="#调试命令" class="headerlink" title="调试命令"></a>调试命令</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">g</td><td align="left">继续执行</td><td align="left"></td></tr><tr><td align="left">gu</td><td align="left">执行到当前函数返回 step out</td><td align="left"></td></tr><tr><td align="left">p</td><td align="left">单步调试 step over</td><td align="left"></td></tr><tr><td align="left">t</td><td align="left">step into</td><td align="left"></td></tr><tr><td align="left">q</td><td align="left">结束调试会话&#x2F;退出</td><td align="left"></td></tr><tr><td align="left">.restart</td><td align="left">重新启动调试目标</td><td align="left"></td></tr><tr><td align="left">.detach</td><td align="left">分离调试目标</td><td align="left"></td></tr><tr><td align="left">.attach</td><td align="left">附加到存在的进程，参数为16进制的PID</td><td align="left">.attach 0x123</td></tr><tr><td align="left">.create</td><td align="left">创建一个新的进程进行调试</td><td align="left">例如调试cmd.exe.create cmd</td></tr><tr><td align="left">.dbgdbg</td><td align="left">启动另一个调试器来调试当前调试器</td><td align="left"></td></tr><tr><td align="left">.opendump</td><td align="left">打开dmp文件</td><td align="left">.opendump d:\dump\360tray.dmp</td></tr></tbody></table><h3 id="模块信息"><a href="#模块信息" class="headerlink" title="模块信息"></a>模块信息</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left"></th></tr></thead><tbody><tr><td align="left">lm</td><td align="left">显示加载的模块信息，exe和dll等</td><td align="left"></td></tr><tr><td align="left">lmvm 模块名lm v m 模块名</td><td align="left">查看指定模块详细信息，比如查看360tray.exe中加载的appd.dll的信息示例： lmvm appd</td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table><h3 id="调试符号"><a href="#调试符号" class="headerlink" title="调试符号"></a>调试符号</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">ld</td><td align="left">加载模块的调试符号</td><td align="left">ld appdld *</td></tr><tr><td align="left">ln</td><td align="left">搜索相邻符号（距离指定地址最近的符号）</td><td align="left">ln 722d0000</td></tr><tr><td align="left">x</td><td align="left">显示匹配参数类型的符号</td><td align="left">显示kernel32.dll所有以Create开头的符号x kernel32!Create*</td></tr><tr><td align="left">.sympath</td><td align="left">设置符号文件路径</td><td align="left">.sympath d:\dump</td></tr><tr><td align="left">.symfix</td><td align="left">设置系统符号存放位置</td><td align="left">设置系统符号存放位置</td></tr><tr><td align="left">.reload</td><td align="left">Reload symbol information for all modules**</td><td align="left"></td></tr></tbody></table><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><table><thead><tr><th>命令</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>.process</td><td>显示当前进程的EPROCESS</td><td></td></tr><tr><td>!process EPROCESS</td><td>查看某个线程</td><td></td></tr><tr><td>!process 0 0</td><td></td><td></td></tr></tbody></table><h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">~</td><td align="left">显示所有线程信息</td><td align="left"></td></tr><tr><td align="left"><del>* [Command]</del>. [Command]~#[Command]</td><td align="left">为所有线程执行指定命令为当前线程执行指定命令为导致当前异常或调试事件的线程执行指定命令</td><td align="left">查看所有线程的栈信息：~* k</td></tr><tr><td align="left"><del>Number</del> Number s</td><td align="left">显示序号为Number的线程切换当前线程为序号Number的线程</td><td align="left">显示10号线程：<del>10切换到10号线程：</del> 10 s</td></tr><tr><td align="left">~~[TID]</td><td align="left">线程ID为TID的线程</td><td align="left"></td></tr><tr><td align="left">~ Number n~ Number m</td><td align="left">SuspendThread 增加线程的挂起计数ResumeThread 减少线程的挂起计数</td><td align="left">~ 10 n~10 m</td></tr><tr><td align="left">~ Number f~ Number u</td><td align="left">Freeze thread 冻结线程Unfreeze thread 解冻线程控制被调试的线程的冻结状态, 与上面两个命令类似（处于冻结状态时恢复目标执行时这个线程不会恢复执行，这个状态是调试器维护的一个状态，执行~ 线程号 n 增加挂起计数后，执行g运行时该线程也不会运行）</td><td align="left"></td></tr><tr><td align="left">~ Number s</td><td align="left">在恢复执行命令g前加线程限定符，可以只恢复指定的线程执行（只对该线程调用ResumeThread使其恢复执行，其他线程仍处于挂起状态）</td><td align="left"></td></tr><tr><td align="left">!runaway</td><td align="left">显示每个线程运行时间，可以方便找到消耗cpu时间长的线程</td><td align="left"></td></tr><tr><td align="left">.ttime</td><td align="left">display thread times (user + kernel mode)</td><td align="left"></td></tr><tr><td align="left">!gle!gle -all</td><td align="left">displays the last error value for the current thread -&gt;GetLastErrordisplays the last error value for all threads</td><td align="left"></td></tr><tr><td align="left">!error</td><td align="left">decodes and displays information about an error value.Specifies one of the following error codes:Win32WinsockNTSTATUSNetAPI</td><td align="left"><img src="/images/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/1.png" alt="1"></td></tr></tbody></table><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">k</td><td align="left">显示EBP，返回地址和源文件信息（如果有私有符号的话）</td><td align="left"></td></tr><tr><td align="left">kb</td><td align="left">显示EBP，返回地址，函数参数及源文件信息（如果有私有符号的话）</td><td align="left"></td></tr><tr><td align="left">k L</td><td align="left">L选项表示不显示源文件信息，也可以用于其他命令比如 kb L， kv L或写为 kL，kbL，kvL</td><td align="left"></td></tr><tr><td align="left">kv</td><td align="left">在kb的基础上增加显示FPO（栈指针省略）信息和调用协议（调用协议仅支持On x86-based processors）</td><td align="left"></td></tr><tr><td align="left">kpkP</td><td align="left">根据私有符号文件中的函数原型信息自动显示参数信息P为大写，表示每个参数占一行</td><td align="left"></td></tr><tr><td align="left">kn</td><td align="left">在k命令的基础上，每行前显示栈帧的序号</td><td align="left"></td></tr><tr><td align="left">kn f</td><td align="left">f选项表示显示每两个相邻栈帧的内存距离，即栈帧基地址的差值</td><td align="left"></td></tr></tbody></table><h3 id="查看-x2F-修改-x2F-搜索内存数据"><a href="#查看-x2F-修改-x2F-搜索内存数据" class="headerlink" title="查看&#x2F;修改&#x2F;搜索内存数据"></a>查看&#x2F;修改&#x2F;搜索内存数据</h3><table><thead><tr><th align="left">说明</th><th align="left">命令</th><th align="left">描述</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">查看内存数据  命令格式：d{a|b|c|d|D|f|p|q|u|w|W} [Options] [Range]dy{b|d} [Options] [Range]d [Options] [Range]</td><td align="left">da</td><td align="left">ASCII字符</td><td align="left">Range指定要显示的内存范围，有如下几种表示方法：起始地址+终止地址比如：dd 0012fd9c 0012fda8起始地址+L&#x2F;l+元素个数比如：dd 0012fd9c L4  或  dd 0012fd9c l4终止地址+L&#x2F;l+负号+元素个数比如：dd 0012fda8 L-4   或   dd 0012fda8 l-4</td></tr><tr><td align="left">du</td><td align="left">Unicode字符</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dc</td><td align="left">DWORD和ASCII码</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dd</td><td align="left">DWORD</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dD</td><td align="left">双精度浮点数</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">df</td><td align="left">单精度浮点数</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dp</td><td align="left">指针</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dq</td><td align="left">四字&#x2F;8字节</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">dw</td><td align="left">一个字&#x2F;2字节</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">查看局部变量<strong>dv</strong> [<em>Flags</em>] [<em>Pattern</em>]</td><td align="left">dv</td><td align="left">查看局部变量</td><td align="left">dv 02sample!gGlo*dv命令可以带有通配符, 来查看具有某命名模式的变量.</td></tr><tr><td align="left">dv &#x2F;i</td><td align="left">查看局部变量, 并显示符号的类型和参数类型.</td><td align="left"></td><td align="left"><img src="/images/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/2.png" alt="2"></td></tr><tr><td align="left">dv &#x2F;t</td><td align="left">查看局部变量, 并显示每个局部变量的数据类型</td><td align="left"></td><td align="left"><img src="/images/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/3.png" alt="3"></td></tr><tr><td align="left">dv &#x2F;V</td><td align="left">查看局部变量, 并显示变量的存储位置</td><td align="left"></td><td align="left"><img src="/images/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/4.png" alt="4"></td></tr><tr><td align="left">dv &#x2F;V VariableName</td><td align="left">查看指定名称的变量</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">查看复合类型变量</td><td align="left">dt</td><td align="left">Display Type的缩写. 当变量的类型为复合类型, 比如说结构体或者类, 那么dv命令只会显示变量的地址. dt命令可以将一块内存按照某个数据类型来解析, 其中的数据类型需要作为参数被传递给dt命令.-b：递归显示所有子类型-r ：指定显示深度，-r0表示不显示子类型-y：附加搜索选项，只显示某个匹配的字段</td><td align="left"><img src="/images/Windbg%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/5.png" alt="5"></td></tr><tr><td align="left">编辑内存数据</td><td align="left">按字符串方式编辑命令格式：e{a|u|za|zu} Address “String”</td><td align="left">其中a和u分别代表不是以0结尾的ASCII和Unicode字符串，za和zu分别代表以0结尾的ASCII和Unicode字符串</td><td align="left">ezu  12fc94 “Debug”   修改0012fc94地址的内容为Unicode字符串”Debug”</td></tr><tr><td align="left">按数值方式编辑命令格式：e{b|d|D|f|p|q|w} Address [Values]</td><td align="left">Values指定新的值，如果命令中没有指定该值，则Windbg会以交互式方式让用户输入</td><td align="left">ew 12fc94 41 41 41 41 41 将0012fc94地址开始的5个WORD都改为0x41</td><td align="left"></td></tr><tr><td align="left">搜索内存数据</td><td align="left">指定范围搜索任何ANSII或UNICODE字符串命令格式：s -[[Flags]] sa|su Range</td><td align="left">[Flags]用来指定搜索选项：L&#x2F;l+整数   指定字符串的最小长度s          将搜索结果保存起来r          在保存的结果中搜索 Range指定内存范围，写法与d命令的Range参数一样</td><td align="left">s -[L5] sa poi(nt!PsInitialSystemProcess) L200在nt!PsInitialSystemProcess变量所指地址开始的512字节（0x200）范围内搜索任何长度不小于5的ANSII字符串</td></tr><tr><td align="left">指定内存地址范围内搜索与指定对象相同类型的对象命令格式：s -[[Flags]]v Range Object</td><td align="left">Object ： Specifies the address of an object or the address of a pointer to an object</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">指定范围内搜索某一内容模式命令格式：s -[[[Flags]Type]] Range Pattern</td><td align="left">Type指定要搜索内容的数据类型，即决定匹配搜索内容的方式。取值可以为：b（字节），w（字），d（双字），q（四字），a（ASCII字符串），u（Unicode字符串）。如果不指定，默认为b。 Pattern指定要搜索的内容</td><td align="left">s -u  0x400000 L2a000 “AdvDbg”从0x400000开始的2a000范围内搜索Unicode字符串”AdvDbg”</td><td align="left"></td></tr><tr><td align="left">在当前进程的所有模块中进行搜索!for_each_module s-a @#Base @#End “Debugger”</td><td align="left">在每个模块中搜索字符串” Debugger”其中@#Base和@#End是!for_each_module定义的别名，其他的还有：@#ModuleName（模块名称），@#SymbolFileName（符号文件名称），@#Size（模块大小），@#SymbolType（符号文件类型）</td><td align="left"></td><td align="left"></td></tr></tbody></table><h3 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h3><table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">命令</td><td align="left">说明</td><td align="left">示例</td></tr><tr><td align="left">bp</td><td align="left">设置断点命令格式： bp[ID号] [Options] [Address [第几次命中断点时中断到调试器]] [“一组命令，用分号隔开”] Options选项可用的值：&#x2F;1  断点被命中一次后自动删除，即一次命中断点&#x2F;p  只用于内核调试中，&#x2F;p后跟一个EPROCESS结构的地址，即对指定的进程设置断点&#x2F;t  只用于内核调试中，&#x2F;t后跟一个ETHREAD结构的地址，即对指定的线程设置断点&#x2F;c 和 &#x2F;C 指定中断给用户的最大函数调用深度和最小函数调用深度举例：bp &#x2F;c5 MSVCR80D!printf 只有当函数调用栈深度浅于5时才中断。 Address表达方式：使用模块名加函数符号：bp LocalVar!FuncC  或带偏移值 bp LocalVar!FuncC+9直接使用内存地址：bp 00401089如果使用完全的调试符号，调试符号中包含源代码行信息，可以用： bp｀模块名!XXX.cpp:行号｀ ， 其中｀为重音符号对于C++的类方法，可以使用类名双冒号(::)或双下划线(__)来连接类名和方法名： bp MyClass::MyMethod  或 bp MyClass__MyMethod 或 bp @@(MyClass::MyMethod)</td><td align="left">（1）bp LocalVar!FuncC+9  其中 LocalVar为模块名称，FuncC为函数名称，9为偏移 （2）bp 00401089   在指定的地址上下断点 （3）bp MSVCR80D!printf + 3  2 “kv; da poi(ebp+8)”  在printf的入口偏移3的地址处下断点(为了让建立栈帧的代码执行完)，当第2次命中断点时中断到调试器，并自动执行kv和da poi(ebp+8)命令。  其中，da poi(ebp+8)用来显示printf的第一个参数所指定的字符串。</td></tr><tr><td align="left">bu</td><td align="left">用于对尚未被加载模块中的代码设置断点命令格式： bu[ID号] [Options] [Address [第几次命中断点时中断到调试器]] [“一组命令，用分号隔开”]</td><td align="left">对于调试动态加载模块的入口函数和初始化代码比较有用，比如对于即插即用设备的驱动程序。可以使用如下命令在入口函数处设置断点： bu  MyDriver!DriverEntry</td></tr><tr><td align="left">bm</td><td align="left">用于设置一批断点命令格式：bm [Options] SymbolPattern [第几次命中断点时中断到调试器] [“一组命令，用分号隔开”] bm命令要求目标模块的调试符号有类型信息，这通常需要私有符号文件，如果对公共符号文件的模块使用bm命令，会提示错误信息。解决这个问题的方法是使用 &#x2F;a 开关，强制针对所有匹配的符号设置断点，无论是数据还是代码，建议只有在确信所有符号是函数时才使用。</td><td align="left">bm MSVCR80D!print* 对MSVCR80D中所有print开头的函数设置断点</td></tr><tr><td align="left">ba</td><td align="left">设置读，写，执行断点命令格式：ba[ID号] Access  Size [Options] [Address [第几次命中断点时中断到调试器]] [“一组命令，用分号隔开”]其中Access指定触发断点的访问方式，Size指定访问的长度。 Access的取值如下：e  读取和执行指令时触发断点，即访问代码硬件断点r   读取和写入数据时触发断点w  写入数据时触发断点i   执行I&#x2F;O访问时触发断点   Size的取值如下：对于访问代码硬件断点，它的值应该为1对于x86系统，可以为1，2，4，分别表示1字节访问，字访问和双字访问对于x64系统，可以为1，2，4， 8对于安腾系统，可以为1 - 0x80000000间的任意2次方值</td><td align="left">ba  r1 0041717c  对地址0041717c的1字节访问，字访问和双字访问（读写）都会触发该断点</td></tr><tr><td align="left">bl</td><td align="left">列出当前所有断点</td><td align="left"></td></tr><tr><td align="left">bc  断点号</td><td align="left">删除断点</td><td align="left">断点号可以使用*来通配所有断点，使用 - 来表示一个范围，或者使用逗号来指定多个断点号</td></tr><tr><td align="left">bd  断点号</td><td align="left">禁用断点</td><td align="left"></td></tr><tr><td align="left">be  断点号</td><td align="left">启用断点</td><td align="left"></td></tr><tr><td align="left">sxe ld:[dll名称]</td><td align="left">加载某个DLL时下断点 bu wininet!DllMain  与 sxe ld:wininet 效果相同bp kernel32!LoadLibraryW &#x2F;bp kernel32!LoadLibraryA</td><td align="left">sxe ld:wininet加载wininet时下断点sxe ld:* &#x2F; sxe ud:*  匹配所有DLL模块</td></tr><tr><td align="left">sxe ud:[dll名称]</td><td align="left">卸载某个DLL时下断点</td><td align="left"></td></tr></tbody></table><h2 id="查看句柄信息"><a href="#查看句柄信息" class="headerlink" title="查看句柄信息"></a>查看句柄信息</h2><table><thead><tr><th>命令</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>!handle</td><td>扩展显示目标系统中一个或所有进程拥有的句柄的信息</td><td></td></tr><tr><td>!handle 4 f</td><td>用’f’表示显示最详细的信息：</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Windbg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Windbg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win7 使用未签名驱动程序</title>
      <link href="/OS/Windows/Win7%20%E9%A9%B1%E5%8A%A8%E6%9C%AA%E7%AD%BE%E5%90%8D%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8/"/>
      <url>/OS/Windows/Win7%20%E9%A9%B1%E5%8A%A8%E6%9C%AA%E7%AD%BE%E5%90%8D%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="win7使用未签名驱动程序"><a href="#win7使用未签名驱动程序" class="headerlink" title="win7使用未签名驱动程序"></a>win7使用未签名驱动程序</h1><h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><p>具体方法如下:</p><p>1、在 win7 64 位系统上，安装某些驱动程序无法成功时，考虑禁用数字签名，重新启动计算机；这是与 XP 系统不同的地方，XP 系统没有这个功能，不用考虑禁用数字签名；</p><p>2、在电脑启动的过程中，不用等到进去输入用户登陆框，按键盘上面的按键 F8，就会出现系统启动项，供我们进行选择；</p><p>3、然后选择，禁用数字签名，启动电脑，数字签名被禁用后，驱动就能成功安装了。但是重启电脑之后，设置又会恢复成启用数字签名。有些电脑的禁用，是一次性的；</p><p>4、我们也可以强制关闭数字签名，进入系统后，使用管理员，在 CMD 运行器中，输入 <code>bcdedit.exe -set loadoptions DDISABLE_INTEGRITY_CHECKS ；</code>然后会出现禁用成功的提示；</p><p>5、再重启电脑，那么系统就会一直默认关闭数字签名了。安装驱动就会成功了。</p><p>以上内容就是 win7 64 位系统禁用数字签名的详细步骤，关闭数字签名后，应用程序就可以安装成功了。</p><h1 id="可能存在的问题"><a href="#可能存在的问题" class="headerlink" title="可能存在的问题"></a>可能存在的问题</h1><p>win7 X64 系统中对驱动程序要求有数字签名，否则无法正常使用。但有时需要用到没有数字签名的驱动程序，可正常安装后驱动是无法使用的，</p><p>具体表现如下：</p><p>1、无法自动识别硬盘控制器</p><p>使用非正版的个别操作系统光盘，在安装系统时，容易出现此错误。原因是非正版光盘自动加载的硬盘控制器驱动不符合电脑自身需要的驱动。这种情况就建议换正版光盘安装操作系统。</p><p>2、手动更新错误的驱动程序</p><p>windows操作系统正常使用，但手动更新驱动程序把硬盘控制器的驱动程序更新错误，导致此故障。解决方法是进入windows系统高级菜单，选择最后一次的正常配置，即可正常进入系统。</p><p>3、bios 设置变化后所导致</p><p>windows 操作系统正常，但是由于某些原因，用户修改了 bios 设置，导致 <code>0x0000007b</code> 故障。</p><p>①如果只是一次性禁用驱动程序的认证签名，可以在开机时按 <kbd>F8</kbd> 键，在弹出的菜单中有 禁用驱动程序签名强制 选项，使用上下键选中之后，再按回车键确认，进入系统即可使用自己的驱动程序更新设备的驱动程序了。</p><p>②尤其是不需要微软的签名驱动程序，还可以这样打开系统属性进行设置：</p><p>运行中输入：<code>sysdm.cpl</code> <kbd>→</kbd> 确定</p><p>③硬件→设备安装设置</p><p>④从不安装来自 Windows Update 的驱动程序软件→保存更改</p><p>建议：使用完毕，再改回使用 Windows Update 更新驱动选项，毕竟很多设备都需要使用微软认证签名的驱动程序。</p><p>⑤还可以使用命令：</p><p>开始→所有程序→附件→右键命令提示符→以管理员身份运行</p><p>⑥打开命令提示符，复制以下的命令，右键点击空白处→粘贴→在按回车键：</p><p><code>bcdedit.exe -set loadoptions DDISABLE_INTEGRITY_CHECKS</code></p><p>命令正确，有操作成功完成的提示。</p><p>⑦除此之外，还可以在组策略中进行相关设置：</p><p>开始→运行→输入： <code>gpedit.msc</code> 回车打开组策略编辑器。</p><p>⑧在窗体左侧选择： 用户配置→管理模板→系统→驱动程序安装→再双击右侧窗口的 设备驱动的代码签名 策略进行设置。</p><p>⑨点选→已启用→这里还有三个选择项：警告、忽略、组织(默认是警告)→确定</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Win7 </tag>
            
            <tag> 签名 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何让控制台程序不显示界面</title>
      <link href="/OS/Windows/Visual%20Studio/%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%A8%8B%E5%BA%8F%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%95%8C%E9%9D%A2/"/>
      <url>/OS/Windows/Visual%20Studio/%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%A8%8B%E5%BA%8F%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%95%8C%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="windows控制台程序不显示界面的几种方式"><a href="#windows控制台程序不显示界面的几种方式" class="headerlink" title="windows控制台程序不显示界面的几种方式"></a>windows控制台程序不显示界面的几种方式</h1><p>要使Windows控制台程序在后台运行，而不显示界面，可以使用以下几种方法：</p><h2 id="1-更改程序的后缀名"><a href="#1-更改程序的后缀名" class="headerlink" title="1. 更改程序的后缀名"></a>1. 更改程序的后缀名</h2><p>将程序的后缀名修改为<code>.com</code>或者<code>.pif</code>，这会导致程序在后台运行时不显示控制台窗口。</p><h2 id="2-修改程序的子系统"><a href="#2-修改程序的子系统" class="headerlink" title="2. 修改程序的子系统"></a>2. 修改程序的子系统</h2><p>使用Visual Studio等开发工具，将程序的子系统修改为<code>Windows</code>而不是<code>Console</code>。这样可以使程序在后台以窗口应用程序的形式运行。具体步骤如下：</p><ul><li>打开项目的属性（右键项目 -&gt; 属性）。</li><li>切换到“配置属性” -&gt; “链接器” -&gt; “系统”。</li><li>修改“子系统”属性为“Windows (&#x2F;SUBSYSTEM:WINDOWS)”。</li><li>编译和运行项目。</li></ul><blockquote><p>使用此方式可能会使程序编译报错：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">错误LNK2001无法解析的外部符号 _WinMain@16</span><br><span class="line">fatal error LNK1120: 1 个无法解析的外部命令</span><br></pre></td></tr></table></figure><p>需要在文件中添加以下代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置连接器选项</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/entry:mainCRTStartup&quot;</span>) </span></span><br></pre></td></tr></table></figure></blockquote><h2 id="使用第三方工具"><a href="#使用第三方工具" class="headerlink" title="使用第三方工具"></a>使用第三方工具</h2><p>可以使用第三方工具将控制台程序包装成无界面的应用程序。例如，可以使用nssm（Non-Sucking Service Manager）工具将控制台程序安装为服务，并设置该服务在后台运行而不显示界面。</p><p>以上是几种常用的方法，可以根据具体需求选择适合的方式来实现控制台程序在后台运行而不显示界面。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
        <tags>
            
            <tag> visual studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 常见错误——无法解析的外部符号</title>
      <link href="/OS/Windows/Visual%20Studio/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
      <url>/OS/Windows/Visual%20Studio/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>关于C++常见错误“无法解析的外部符号”这一问题如何解决的思考与方法。</p><p>本文就使用libevent中遇到的相似问题着手进行分析该如何解决，其他情况仍需按实际情况进行分析处理。常见的原因无外乎缺少编译库。</p></blockquote><p><img src="/images/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/1.png" alt="LNK2001"></p><p><img src="/images/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/2.png" alt="LNK2001详细列表"></p><ol><li><p>如上图所示，报错为无法解析的外部符号，符号为 <code>__imp__if_nametoindex@4</code>， 一般这种符号就是缺少导出的接口，导出接口一般为 <code>函数名@导出序号</code>。基本可以确定是缺少一个链接库。其次 <mark style="background:green;border-radius:10px;color:white">出现字符<code>_imp</code>，说明不是真正的静态库，而是某个动态库的导入库，导入函数和自己不同名，所以加了字符<code>_imp</code></mark>。这里可以确定导出函数名为 <code>if_nametoindex</code>；</p></li><li><p>确定了导出函数名为 <code>if_nametoindex</code> 之后，可以百度查看一下有没有相关函数的信息；</p><img src="images/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/3.png" alt="if_nametoindex函数查询结果" style="zoom:67%;" /><p>一搜发现为windows系统函数，是网络相关的接口函数，负责将ANSI接口转换为接口的本地索引。其声明需要包含的静态库文件为 <code> Netio.lib</code>。但是笔者这边测试之后发现无法打开 <code>Netio.lib</code> 这个静态库，再查找，找到其相关索引为 <a href="https://learn.microsoft.com/en-us/previous-versions/windows/embedded/ee494702(v=winembedded.70)">IP Helper Functions</a>。</p></li><li><p>至此，基本上可以确定其缺少的静态库和网络部分相关，找到相关函数（这里查看的函数为 <code>AddIPAddress</code>），查看其函数使用要求，需要引用 <code>Iphlpapi.lib</code>，引入到代码中，编译成功。<br><img src="/images/%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E7%9A%84%E5%A4%96%E9%83%A8%E7%AC%A6%E5%8F%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/4.png" alt="4"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 整理 </tag>
            
            <tag> 思考 </tag>
            
            <tag> 错误 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Procmon 过滤用法</title>
      <link href="/OS/Windows/Procmon%E7%94%A8%E6%B3%95/"/>
      <url>/OS/Windows/Procmon%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<ul><li>Application Details <ul><li>– Process Name：产生事件的那个进程的名字 </li><li>– Image Path：进程镜像的完整路径 </li><li>– Command Line：命令行，用于启动进程 </li><li>– Company Name：进程镜像文件中的企业名称。这个文本是由应用程序的开发者来定义的 </li><li>– Description：进程镜像文件中的产品描述信息。这个文本是由应用程序的开发者定义的 </li><li>– Version：进程镜像文件中的产品版本号。这个文本是由应用程序的开发者定义的</li></ul></li><li>Event Details <ul><li>– Sequence Number：操作在全体事件中的相对位置，也包括当前的过滤 </li><li>– Event Class：事件的类别（文件，注册表，进程） </li><li>– Operation：特殊事件操作，比如Read、RegQueryValue等 </li><li>– Date &amp; Time：操作的日期和时间 </li><li>– Time of Day：只是操作的时间 </li><li>– Path：一个事件引用资源的路径 </li><li>– Detail：事件的附加信息 </li><li>– Result：一个完成了的操作的状态码 </li><li>– Relative Time：一个操作相对于Process Monitor的启动后的时间，或者相对于Process Monitor的信息清除后的时间 </li><li>– Duration：一个已经完成了的操作所持续的时间</li></ul></li><li>Process Management <ul><li>– User Name：正在执行操作的进程的用户账户名 </li><li>– Session ID：正在执行操作的进程的Windows会话ID </li><li>– Authentication ID：正在执行操作的进程的登录会话ID </li><li>– Process ID：执行了操作的进程的进程ID </li><li>– Thread ID：执行了操作的线程的线程ID </li><li>– Integrity Level：正在运行的进程执行操作时的可信级别（仅支持Vista以上系统） </li><li>– Virtualized：执行了操作的进程的虚拟化状态</li></ul></li></ul><h1 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h1><ul><li>删除<ol><li><em>_del.</em></li></ol></li><li>重命名并删除<ol><li>trustdservice.exe -&gt; trustservice_del.exe （以下文件均改为”文件名_del.ext”）</li><li>trustfixservice.exe</li><li>ServiceDetect.dll</li><li>libgcommon.dll</li><li>TrustAgent.exe</li><li>TrustAgentApp.dll</li><li>trustcore.dll</li><li>trustnc.dll</li><li>trustproxy.dll</li><li>trustproxyserver.dll</li><li>trustcheck.exe</li><li>trustproxy64.sys</li><li>trustproxy.sys</li><li>vpnvnic.sys</li><li>QInstUtils.exe</li><li>ClientLogTool.exe</li><li>QtWebEngineProcess.exe</li><li>TrustAgent.config</li><li>TrustAgentExtra.config</li></ol></li></ul><p>重命名完成之后会删除以上文件</p><h1 id="结束进程"><a href="#结束进程" class="headerlink" title="结束进程"></a>结束进程</h1><ol><li>trustservice</li><li>TrustAgent</li><li>QtWebEngineProcess</li><li>trustdservice</li><li>trustfixservice</li></ol><h1 id="释放文件"><a href="#释放文件" class="headerlink" title="释放文件"></a>释放文件</h1><ul><li>文件<ol><li>虚拟网卡驱动</li><li>代理驱动</li><li>trustservice</li><li>trustfixservice.exe</li><li>ServiceDetect.dll</li><li>libgcommon.dll</li><li>TrustAgent.exe</li><li>TrustAgentApp.dll</li><li>trustcore.dll</li><li>trustnc.dll</li><li>trustproxy.dll</li><li>trustproxyserver.dll</li><li>trustcheck.exe</li><li>trustproxy64.sys</li><li>trustproxy.sys</li><li>vpnvnic.sys</li><li>QInstUtils.exe</li><li>ClientLogTool.exe</li><li>QtWebEngineProcess.exe</li></ol></li><li>目录<ol><li>qtdepends</li><li>oemdepends</li><li>cert</li></ol></li></ul><h1 id="删除旧的快捷方式"><a href="#删除旧的快捷方式" class="headerlink" title="删除旧的快捷方式"></a>删除旧的快捷方式</h1><ol><li>国信安全接入.lnk</li><li>青鸾安全接入.lnk</li><li>TrustAgent.lnk</li><li>零信任客户端.lnk</li></ol><h1 id="清理路由"><a href="#清理路由" class="headerlink" title="清理路由"></a>清理路由</h1><p>调用安装目录下 <code>ClearHost.exe</code></p><h1 id="更新配置文件"><a href="#更新配置文件" class="headerlink" title="更新配置文件"></a>更新配置文件</h1><ol><li>TrustAgent.config</li><li>TrustAgentExtra.config</li></ol><h1 id="更新注册表"><a href="#更新注册表" class="headerlink" title="更新注册表"></a>更新注册表</h1><p>注册表路径</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">!define</span> PRODUCT_UNINST_KEY <span class="string">&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\<span class="variable">$&#123;PRODUCT_NAME&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>更新字段</p><ol><li>DisplayName</li><li>Publisher</li><li>DisplayIcon</li><li>UninstallString</li><li>DisplayVersion</li><li>InstallDir</li><li>ProxyVersion</li><li>InstParams</li></ol><h1 id="配置崩溃状态"><a href="#配置崩溃状态" class="headerlink" title="配置崩溃状态"></a>配置崩溃状态</h1><p>配置系统LocalDumps，设置相关注册表项</p><h1 id="创建快捷方式"><a href="#创建快捷方式" class="headerlink" title="创建快捷方式"></a>创建快捷方式</h1><p>以更新程序的快捷方式命名为主。</p><h1 id="更新-TrustService"><a href="#更新-TrustService" class="headerlink" title="更新 TrustService"></a>更新 TrustService</h1><p>调用 <code>Trustservice.exe /update</code> 更新。</p><h1 id="更新TrustFixService"><a href="#更新TrustFixService" class="headerlink" title="更新TrustFixService"></a>更新TrustFixService</h1><p>调用 <code>TrustFixservice.exe /update</code> 更新。</p><h1 id="启动-TrustService"><a href="#启动-TrustService" class="headerlink" title="启动 TrustService"></a>启动 TrustService</h1><p>调用 <code>Trustservice.exe /start</code> 更新。</p><h1 id="启动-YMDbg-exe"><a href="#启动-YMDbg-exe" class="headerlink" title="启动 YMDbg.exe"></a>启动 YMDbg.exe</h1><p>直接启动 <code>$INSTALLDIR\Dbg\Ymdbg.exe</code></p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Exec</span> YMDbg.exe -i1</span><br></pre></td></tr></table></figure><h1 id="刷新-Windows-图标缓存"><a href="#刷新-Windows-图标缓存" class="headerlink" title="刷新 Windows 图标缓存"></a>刷新 Windows 图标缓存</h1>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>批处理获取ip到剪切板</title>
      <link href="/OS/Windows/PowerShell/%E8%8E%B7%E5%8F%96IP%E5%88%B0%E5%89%AA%E5%88%87%E6%9D%BF/"/>
      <url>/OS/Windows/PowerShell/%E8%8E%B7%E5%8F%96IP%E5%88%B0%E5%89%AA%E5%88%87%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="获取当前ip到剪切板"><a href="#获取当前ip到剪切板" class="headerlink" title="获取当前ip到剪切板"></a>获取当前ip到剪切板</h1><blockquote><p>客户端开发远程调试每次都需要获取机器的ip，然后手动填写，较为麻烦，因此简单做了一个可以获取ip到剪切板当中的批处理脚本，可以获取系统当前ip到剪切板中。</p></blockquote><p>[toc]</p><h2 id="获取ip"><a href="#获取ip" class="headerlink" title="获取ip"></a>获取ip</h2><p>获取ip的命令有多种，最终实现就是只要能打印出当前系统ip的命令都可以。</p><ul><li><code>ipconfig</code></li><li><code>route print</code></li></ul><p>以下两个脚本就是从上述两个命令当中获取ip地址：</p><h3 id="ipconfig"><a href="#ipconfig" class="headerlink" title="ipconfig"></a>ipconfig</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">for /f &quot;tokens=2 delims=:&quot; %%a in (&#x27;ipconfig ^| findstr ^^IPv4&#x27;) do (set IP=%%a)</span><br><span class="line"></span><br><span class="line">echo %IP%</span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure><h3 id="route-print"><a href="#route-print" class="headerlink" title="route print"></a>route print</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">for /f &quot;tokens=4&quot; %%a in (&#x27; route print ^| findstr 0.0.0.0.*0.0.0.0 ^| findstr /v &quot;默认&quot; &#x27;) do (set IP=%%a)</span><br><span class="line"></span><br><span class="line">echo 你的局域网IP是： %IP%</span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure><blockquote><p><span style="font-weight:900"><code>for /f</code></span>的用法：</p><p>在<code>For</code>命令语踞饽参数F中，最难理解的就是<code>Delims</code>和<code>Tokens</code>两个选项，本文简单的做一个比较和总拮。<br>“<code>For /f</code>”常用来解析文本，读取<a href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020">字符串</a>。分工上，<code>delims</code>负责切分字符串，而<code>tokens</code>负责提取字符串。如果把字符串当作蛋糕，<code>Delims</code>像刀子，用来切蛋糕，<code>tokens</code>像叉子，用来取切好的蛋糕。</p></blockquote><h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ipconfig|select-string &quot;IPv4&quot;|out-string).Split(&quot;:&quot;)[-1]</span><br></pre></td></tr></table></figure><h2 id="输入到剪切板"><a href="#输入到剪切板" class="headerlink" title="输入到剪切板"></a>输入到剪切板</h2><p>剪切板的关键字为：<code>clip</code></p><p>使用 <code>clip \?</code> 可以查看帮助</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">c:\windows\system32&gt;clip /?</span><br><span class="line"> </span><br><span class="line">clip</span><br><span class="line"> </span><br><span class="line">描述:</span><br><span class="line">    将命令行工具的输出重定向到 windows 剪贴板。这个文本输出可以被粘贴</span><br><span class="line">    到其他程序中。</span><br><span class="line"> </span><br><span class="line">参数列表:</span><br><span class="line">    /?                  显示此帮助消息。</span><br><span class="line"> </span><br><span class="line">示例:</span><br><span class="line">    dir | clip          将一份当前目录列表的副本放入 windows 剪贴板。</span><br><span class="line"> </span><br><span class="line">    clip &lt; readme.txt   将 readme.txt 的一份文本放入 windows 剪贴板。</span><br><span class="line"> </span><br><span class="line">c:\windows\system32&gt;</span><br></pre></td></tr></table></figure><p>结合以上两个命令，脚本稍微修改一下就能实现获取ip到剪切版的功能。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> PowerShell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> 批处理 </tag>
            
            <tag> 剪切板 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio 通用配置</title>
      <link href="/OS/Windows/Visual%20Studio/Visual%20Stdio%20%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/OS/Windows/Visual%20Studio/Visual%20Stdio%20%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="工具集"><a href="#工具集" class="headerlink" title="工具集"></a>工具集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(DefaultPlatformToolset)</span><br></pre></td></tr></table></figure><h2 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$([Microsoft.Build.Utilities.ToolLocationHelper]::GetLatestSDKTargetPlatformVersion(<span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;10.0&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="Qt-版本"><a href="#Qt-版本" class="headerlink" title="Qt 版本"></a>Qt 版本</h2><p>需要设置注册表项，值为Qt安装路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(QtPath)</span><br></pre></td></tr></table></figure><h2 id="生成事件"><a href="#生成事件" class="headerlink" title="生成事件"></a>生成事件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call $(SolutionDir)prompt.bat</span><br></pre></td></tr></table></figure><p><code>prompt.bat</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------------------------</span><br><span class="line"><span class="built_in">echo</span> [TrustAgent.pro] 文件有更新时，请重新生成当前工程</span><br><span class="line"><span class="built_in">echo</span> 以下配置并不适用于所有人，如有编译报错，请自行修改。</span><br><span class="line"><span class="built_in">echo</span> 1. Qt工具集默认配置为环境变量QtPath: 当前系统QtPath:[%QtPath%] （推荐 5.9.9_msvc2015）</span><br><span class="line"><span class="built_in">echo</span> 2. 工具集默认配置为: $(DefaultPlatformToolset) （推荐 10.0.19041.0及以上）</span><br><span class="line"><span class="built_in">echo</span> 3. SDK默认配置为: $([Microsoft.Build.Utilities.ToolLocationHelper]::GetLatestSDKTargetPlatformVersion(<span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;10.0&#x27;</span>)) （推荐 V142）</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------------------------</span><br><span class="line"></span><br><span class="line">@REM <span class="keyword">if</span> <span class="string">&quot;%QtPath%&quot;</span> == <span class="string">&quot;&quot;</span> (</span><br><span class="line">@REM     choice /c:yn /m <span class="string">&quot;当前未配置环境变量，是否打开系统配置页面：&quot;</span></span><br><span class="line">@REM     <span class="keyword">if</span> %errorlevel%==1 (</span><br><span class="line">@REM         start ms-settings:about</span><br><span class="line">@REM     )</span><br><span class="line">@REM )</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Visual Studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio中MD与MT的区别及运行库类型选择</title>
      <link href="/OS/Windows/Visual%20Studio/VisualStudio%E4%B8%ADMD%E4%B8%8EMT%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E8%BF%90%E8%A1%8C%E5%BA%93%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9/"/>
      <url>/OS/Windows/Visual%20Studio/VisualStudio%E4%B8%ADMD%E4%B8%8EMT%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E8%BF%90%E8%A1%8C%E5%BA%93%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>本篇主要总结一下自己在项目开发过程中经常遇到的一个问题，即<code>Visual Studio</code>编译过程中如何选择运行库的类型。希望对其它开发的伙伴们有一定的参考价值和帮助。</p><h2 id="1-在Visual-Studio中设置"><a href="#1-在Visual-Studio中设置" class="headerlink" title="1.在Visual Studio中设置"></a>1.在<code>Visual Studio</code>中设置</h2><p>在<code>Visual Studio 2019</code>中，右键项目名称，打开项目属性页，选择“配置属性”-&gt;“C&#x2F;C++”-&gt;“代码生成”-&gt;“运行库”即可对<code>运行库类型</code>进行设置，如下图所示。</p><p><img src="/images/VisualStudio%E4%B8%ADMD%E4%B8%8EMT%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E8%BF%90%E8%A1%8C%E5%BA%93%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9/1.png" alt="image-20230809182412117"></p><p>这里<code>运行库类型</code>主要包含四种：多线程(&#x2F;MT)、多线程调试(&#x2F;MTd)、多线程DLL(&#x2F;MD)、多线程调试(&#x2F;MDd)。其中带有<code>d</code>的类型是项目的<code>调试版本</code>，不带有<code>d</code>的类型是项目的<code>Release</code>版本。</p><h2 id="2-MT与MD的区别"><a href="#2-MT与MD的区别" class="headerlink" title="2. MT与MD的区别"></a>2. <code>MT</code>与<code>MD</code>的区别</h2><ul><li><strong><code>/MT</code>：</strong>是<code>multithread-static version</code>，是多线程静态版本的意思，项目会使用运行时库的多线程静态版本，编译器会将<code>LIBCMT.lib</code>放入<code>.obj</code>文件中，以便链接器使用<code>LIBCMT.lib</code>解析外部符号；</li><li><strong><code>/MTd</code>：</strong>是定义了<code>_DEBUG</code>和<code>/MT</code>，是<code>/MT</code>类型的<code>debug</code>版本；</li><li><strong><code>/MD</code>：</strong>是<code>multithread-dll version</code>，是多线程<code>dll</code>版本的意思，项目会使用运行时库的多线程动态<code>dll</code>版本，编译器会将<code>MSVCRT.lib</code>放入<code>.obj</code>文件中，在编译项目时，它会静态链接<code>MSVCRT.lib</code>，但在实际运行过程中，它会链接使用<code>MSVCR90.dll</code>；</li><li><strong><code>MDd</code>：</strong>是定义了<code>_DEBUG</code>和<code>/MD</code>，是<code>/MD</code>类型的<code>debug</code>版本；</li></ul><p>因此，<strong>我们在编译时，对应的库一定要配套一致</strong>。比如你用<code>CMake</code>生成工程文件时，若<code>CMake</code>是用<code>/MT</code>类型生成的，则它所调用的运行时库为<code>LIBCMT.lib</code>；后面生成工程时，你必须也选择<code>/MT</code>类型，否则你选择<code>/MD</code>类型的话，工程在链接时会调用<code>MSVCRT.lib</code>和<code>MSVCR90.dll</code>，显然两次调用不同的运行时库，会出现重定义的错误。</p><p>总起来说，<code>/MD</code>类型表示运行时库不集成，生成的文件小，程序运行时动态加载对应的<code>dll</code>；<code>/MT</code>类型表示运行时库集成，生成的文件较大，在链接时将<code>C/C++</code>运行时库集成到程序中。</p><h2 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h2><p>在使用过程中，如果Release模式下使用MD编译的文件报错缺少 <code>MSVCD140。dll</code>，则可以使用 <code>MT</code> 选项编译，解决缺少动态库的问题。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Visual Studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改网络配置的 InterfaceMetric</title>
      <link href="/OS/Windows/PowerShell/%E4%BF%AE%E6%94%B9ip%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%B7%83%E7%82%B9%E6%95%B0/"/>
      <url>/OS/Windows/PowerShell/%E4%BF%AE%E6%94%B9ip%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%B7%83%E7%82%B9%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用脚本修改网卡跃点数 InterfaceMetric</p></blockquote><h2 id="使用到的接口"><a href="#使用到的接口" class="headerlink" title="使用到的接口"></a>使用到的接口</h2><ol><li>Get-NetIPInterface</li><li>Set-NetIPInterface</li><li>Get-NetAdapter</li></ol><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><p>需要修改当前跃点数为 <code>1</code> 的ip接口，修改其跃点数为 <code>90</code></p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote><p>设置ip接口的跃点数均需要<a href="#cmd">管理员权限</a></p></blockquote><h3 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h3><p><a href="./ModifyIfm.ps1">源文件</a></p><ol><li>通过 <code>Get-NetIPInterface</code> 获取需要修改的IP接口</li><li>通过 <code>Set-NetIPInterface</code> 修改跃点数</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ChangeIfm</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$WangToChangeIfm</span> = <span class="number">90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 InterfaceMetric 为 1 的 -InterfaceIndex</span></span><br><span class="line"><span class="variable">$NetCard</span> = (<span class="built_in">Get-NetIPInterface</span>  <span class="literal">-InterfaceMetric</span> <span class="variable">$ChangeIfm</span>).ifAlias</span><br><span class="line"><span class="variable">$netInterfaceIndex</span> = (<span class="built_in">Get-NetIPInterface</span> <span class="literal">-AddressFamily</span> IPv4 <span class="literal">-InterfaceMetric</span> <span class="variable">$ChangeIfm</span>).ifIndex</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;检索InterfaceMetric为 [<span class="variable">$</span>&#123;ChangeIfm&#125;] 列表: `n <span class="variable">$</span>&#123;NetCard&#125;&quot;</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;Index 为:  <span class="variable">$</span>&#123;netInterfaceIndex&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-NetIPInterface</span> <span class="literal">-InterfaceIndex</span> <span class="variable">$netInterfaceIndex</span> <span class="literal">-InterfaceMetric</span> <span class="variable">$WangToChangeIfm</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;已修改 <span class="variable">$</span>&#123;NetCard&#125; 的 InterfaceMetric 为 <span class="variable">$</span>&#123;WangToChangeIfm&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h3><p><a href="./ModifyIfm-NetAdapter.ps1">源文件</a></p><p>使用过滤器筛选需要修改的ip接口，再通过 <code>Set-NetIPInterface</code> 修改跃点数</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 获取 InterfaceMetric 为 1 的 -InterfaceIndex</span></span><br><span class="line"><span class="variable">$NetCard</span> = (<span class="built_in">Get-NetAdapter</span> | <span class="built_in">Where-Object</span> <span class="literal">-FilterScript</span> &#123;<span class="variable">$_</span>.ifIndex <span class="operator">-eq</span> <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="variable">$NetCard</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-NetIPInterface</span> <span class="literal">-InterfaceIndex</span> <span class="variable">$NetCard</span>.ifIndex <span class="literal">-AddressFamily</span> IPv6 <span class="literal">-InterfaceMetric</span> <span class="number">90</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="官方demo"><a href="#官方demo" class="headerlink" title="官方demo"></a>官方demo</h2><p>修改 LinkSpeed 为 100 Mbps 的网络的 InterfaceMetric 为 21</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetAdapter</span> | <span class="built_in">Where-Object</span> <span class="literal">-FilterScript</span> &#123;<span class="variable">$_</span>.LinkSpeed <span class="operator">-Eq</span> <span class="string">&quot;100 Mbps&quot;</span>&#125; | <span class="built_in">Set-NetIPInterface</span> <span class="literal">-InterfaceMetric</span> <span class="number">21</span></span><br></pre></td></tr></table></figure><h2 id="提升管理员权限"><a href="#提升管理员权限" class="headerlink" title="提升管理员权限"></a><a id="cmd">提升管理员权限</a></h2><h3 id="cmd提权"><a href="#cmd提权" class="headerlink" title="cmd提权"></a>cmd提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line">::1 获取管理员权限</span><br><span class="line">%1 mshta vbscript:CreateObject(<span class="string">&quot;Shell.Application&quot;</span>).ShellExecute(<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c %~s0 ::&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;runas&quot;</span>,1)(window.close)&amp;&amp;<span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">::2 执行操作</span><br><span class="line"><span class="built_in">set</span> curpath=%~dp0</span><br><span class="line"><span class="built_in">set</span> file=ModifyIfm.ps1</span><br><span class="line"><span class="built_in">set</span> execPath=%curpath%%file%</span><br><span class="line"><span class="built_in">echo</span> %execPath%</span><br><span class="line">powershell.exe -ExecutionPolicy ByPass -File %execPath%</span><br></pre></td></tr></table></figure><h3 id="powershell-提权"><a href="#powershell-提权" class="headerlink" title="powershell 提权"></a>powershell 提权</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="operator">-Not</span> ([<span class="type">Security.Principal.WindowsPrincipal</span>] [<span class="type">Security.Principal.WindowsIdentity</span>]::GetCurrent()).IsInRole([<span class="type">Security.Principal.WindowsBuiltInRole</span>] <span class="string">&#x27;Administrator&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">int</span>](<span class="built_in">Get-CimInstance</span> <span class="literal">-Class</span> Win32_OperatingSystem | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> BuildNumber) <span class="operator">-ge</span> <span class="number">6000</span>) &#123;</span><br><span class="line">        <span class="variable">$Command</span> = <span class="string">&quot;-File `&quot;&quot;</span> + <span class="variable">$MyInvocation</span>.MyCommand.Path + <span class="string">&quot;`&quot; &quot;</span> + <span class="variable">$MyInvocation</span>.UnboundArguments</span><br><span class="line">        <span class="built_in">Start-Process</span> <span class="literal">-FilePath</span> PowerShell.exe <span class="literal">-Verb</span> RunAs <span class="literal">-ArgumentList</span> <span class="variable">$Command</span></span><br><span class="line">        <span class="keyword">Exit</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>InterfaceMetric</code> 是用于表示网络接口优先级的指标，它用于决定计算机在多个网络接口之间进行网络通信时所选择的默认接口。</p><p>在Windows操作系统中，InterfaceMetric是一个用于路由选择和接口优先级的整数值。较低的InterfaceMetric值表示较高的优先级，通常会被选择为默认接口。以下是InterfaceMetric的一些常用数值及其含义：</p><ul><li>0：最高优先级。当存在多个可用的接口时，操作系统将优先使用此接口进行网络通信。</li><li>5：较高优先级。优先级稍低于0，但仍比较高，通常用于指定首选接口。</li><li>10：默认优先级。如果没有特殊指定优先级的情况下，操作系统通常将选择InterfaceMetric为10的接口作为默认接口。</li><li>大于10的值：较低优先级。这些值表示接口的优先级较低，只有在没有更高优先级的接口可用时才被选择。</li></ul><p>请注意，InterfaceMetric值只在有多个可用的网络接口时才起作用。如果只有一个接口可用，则无论InterfaceMetric的值如何，该接口都将被选择为默认接口。</p><p>您可以通过以下步骤在Windows系统中修改接口的InterfaceMetric值：</p><ol><li>打开网络连接设置：在Windows搜索栏中输入”控制面板”，打开控制面板后选择”网络和 Internet”，然后选择”网络和共享中心”。</li><li>打开适配器设置：在左侧面板中，点击”更改适配器设置”。</li><li>找到网络接口：在适配器设置窗口中，找到要修改InterfaceMetric的网络接口，右键点击该接口，然后选择”属性”。</li><li>修改接口属性：在接口属性窗口中，选择”Internet 协议版本 4 (TCP&#x2F;IPv4)”（或其他适用的协议版本），然后点击”属性”按钮。</li><li>修改InterfaceMetric值：在该接口的属性窗口中，点击”高级”按钮，在”适配器度量”部分，可以手动输入想要设置的InterfaceMetric值（整数）。</li><li>保存设置：保存修改后的设置，然后关闭所有窗口。</li></ol><p>注意：更改InterfaceMetric值后，可能需要重启计算机或者启用&#x2F;禁用网络接口才能使更改生效。</p><p>希望这些信息能帮助您理解InterfaceMetric的含义及其在Windows系统中使用的方式。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> PowerShell </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>清理DNS缓存</title>
      <link href="/OS/Windows/PowerShell/%E6%B8%85%E7%90%86DNS%E7%BC%93%E5%AD%98/"/>
      <url>/OS/Windows/PowerShell/%E6%B8%85%E7%90%86DNS%E7%BC%93%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<p>在Windows系统上清理DNS缓存有几种方法，以下是其中两种常用的方法：</p><p>方法一：使用ipconfig命令</p><ol><li><p>打开命令提示符：按下Win + R键，在运行对话框中输入<code>cmd</code>，然后按下回车键。</p></li><li><p>在命令提示符窗口中，输入以下命令并按下回车键：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure><p>这将清除本地计算机上的DNS缓存。</p></li><li><p>在命令提示符窗口中，您将看到一条消息提示”DNS Resolver Cache successfully flushed”，表明DNS缓存已成功清除。</p></li></ol><p>方法二：使用命令提示符和netsh命令</p><ol><li><p>打开命令提示符：按下Win + R键，在运行对话框中输入<code>cmd</code>，然后按下回车键。</p></li><li><p>在命令提示符窗口中，输入以下命令并按下回车键：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winsock reset</span><br></pre></td></tr></table></figure><p>这将重置Winsock目录，并清除DNS缓存。</p></li><li><p>在命令提示符窗口中，您将看到一条消息提示”Successfully reset the Winsock Catalog”，表明Winsock目录已成功重置。</p></li><li><p>在命令提示符窗口中，输入以下命令并按下回车键：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure><p>这将清除本地计算机上的DNS缓存。</p></li><li><p>在命令提示符窗口中，您将看到一条消息提示”DNS Resolver Cache successfully flushed”，表明DNS缓存已成功清除。</p></li></ol><p>无论使用哪种方法，都需要以管理员权限运行命令提示符窗口（右键点击命令提示符图标，选择”以管理员身份运行”）才能执行清除DNS缓存的命令。</p><p>希望这些步骤能够帮助您清理Windows系统上的DNS缓存。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> PowerShell </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>LoadLibrary加载失败，返回126</title>
      <link href="/OS/Windows/GetLastError/126/"/>
      <url>/OS/Windows/GetLastError/126/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h1><p>在某一个windows环境中，安装了一个服务d，服务d的启动依赖于一个关键的dll文件(info.dll)，一直服务进程的dll也存在，但是在服务启动的时候，使用 <code>LoadLibrary</code> 函数会返回<code>GetLastError</code> 126。</p><h1 id="排查手段记录"><a href="#排查手段记录" class="headerlink" title="排查手段记录"></a>排查手段记录</h1><p>已经尝试过的排查手段包括但不限于：</p><h2 id="使用绝对路径加载dll"><a href="#使用绝对路径加载dll" class="headerlink" title="使用绝对路径加载dll"></a>使用绝对路径加载dll</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// old</span></span><br><span class="line"><span class="built_in">LoadLibrary</span>(<span class="string">&quot;info.dll&quot;</span>);</span><br><span class="line"><span class="comment">// new</span></span><br><span class="line"><span class="built_in">LoadLibrary</span>(<span class="string">&quot;C:\\info.dll&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="问题关键"><a href="#问题关键" class="headerlink" title="问题关键"></a>问题关键</h1>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> GetLastError </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> GetLastError </tag>
            
            <tag> LoadLibrary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FormatMessage函数的使用</title>
      <link href="/OS/Windows/FormatErrMessage/"/>
      <url>/OS/Windows/FormatErrMessage/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">SPErrMsg</span><span class="params">(<span class="type">int</span> errcode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> _g_inner_msg[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">memset</span>(_g_inner_msg, <span class="number">0</span>, <span class="built_in">sizeof</span>(_g_inner_msg));</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SP_PLATFORM==SP_PLATFORM_WINDOWS</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span>==errcode)</span><br><span class="line">    &#123;</span><br><span class="line">        errcode = <span class="built_in">GetLastError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    LPTSTR buf = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (::<span class="built_in">FormatMessage</span>(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS,</span><br><span class="line">        <span class="literal">NULL</span>, errcode, <span class="built_in">MAKELANGID</span>(LANG_ENGLISH, SUBLANG_ENGLISH_US) <span class="comment">/* MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT) */</span>,</span><br><span class="line">        (LPTSTR)&amp;buf, <span class="number">0</span>, <span class="literal">NULL</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// DWORD language_id</span></span><br><span class="line">        <span class="comment">// MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT)</span></span><br><span class="line">        <span class="comment">// MAKELANGID(LANG_ENGLISH, SUBLANG_ENGLISH_US)</span></span><br><span class="line">        <span class="comment">// MAKELANGID(LANG_CHINESE_SIMPLIFIED, SUBLANG_CHINESE_SIMPLIFIED)</span></span><br><span class="line">        <span class="comment">// MAKELANGID(LANG_CHINESE_TRADITIONAL, SUBLANG_CHINESE_TRADITIONAL)</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">snprintf</span>(_g_inner_msg, <span class="built_in">sizeof</span>(_g_inner_msg), <span class="string">&quot; [%d]%s&quot;</span>, errcode, buf);</span><br><span class="line">        <span class="keyword">if</span> ( len&gt;<span class="number">2</span> &amp;&amp; _g_inner_msg[len<span class="number">-1</span>]==<span class="string">&#x27;\n&#x27;</span> &amp;&amp; _g_inner_msg[len<span class="number">-2</span>]==<span class="string">&#x27;\r&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            _g_inner_msg[len - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            _g_inner_msg[len - <span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ::<span class="built_in">LocalFree</span>(buf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(_g_inner_msg, <span class="built_in">sizeof</span>(_g_inner_msg), <span class="string">&quot; [%d]Unknown error %d&quot;</span>, errcode, errcode);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="comment">// https://stackoverflow.com/questions/3219393/stdlib-and-colored-output-in-c</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span>==errcode)</span><br><span class="line">    &#123;</span><br><span class="line">        errcode = errno;</span><br><span class="line">        errno   = errcode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">snprintf</span>(_g_inner_msg, <span class="built_in">sizeof</span>(_g_inner_msg), <span class="string">&quot; [%d]%s&quot;</span>, (<span class="type">int</span>)errcode, <span class="built_in">strerror</span>(errcode));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> (_g_inner_msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加载动态库 (loadlibrary)</title>
      <link href="/OS/Windows/API_%E5%8A%A0%E8%BD%BD%E5%8A%A8%E6%80%81%E5%BA%93/"/>
      <url>/OS/Windows/API_%E5%8A%A0%E8%BD%BD%E5%8A%A8%E6%80%81%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h1><blockquote><p>using的用法参考 <a href="../../Code/C++er/using.md">使用using起别名</a></p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PipeIPC/PipeIPC.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;--- DLL Test ---\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    HINSTANCE hDLL; <span class="comment">// Handle to DLL</span></span><br><span class="line">    <span class="keyword">using</span> Face = <span class="type">int</span> * (*)(<span class="type">int</span>,<span class="type">int</span>);</span><br><span class="line"></span><br><span class="line">    hDLL = <span class="built_in">LoadLibrary</span>(<span class="string">L&quot;mydll.dll&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (hDLL != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Face faceSum = (Face)<span class="built_in">GetProcAddress</span>(hDLL,</span><br><span class="line">            <span class="string">&quot;mySum&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!faceSum)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// handle the error</span></span><br><span class="line">            <span class="built_in">FreeLibrary</span>(hDLL);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// call the function</span></span><br><span class="line">           <span class="built_in">faceSum</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="生成动态库"><a href="#生成动态库" class="headerlink" title="生成动态库"></a>生成动态库</h1><h2 id="dllmain-cpp"><a href="#dllmain-cpp" class="headerlink" title="dllmain.cpp"></a>dllmain.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYIMAPI extern <span class="string">&quot;C&quot;</span> __declspec(dllimport)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYEXAPI extern <span class="string">&quot;C&quot;</span> __declspec(dllexport)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYEXAPI <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> numa, <span class="type">int</span> numb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numa + numb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">MYEXAPI <span class="type">int</span> <span class="title">Sub</span><span class="params">(<span class="type">int</span> numa, <span class="type">int</span> numb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (numa - numb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> DLL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows 查看进程启动参数命令行</title>
      <link href="/OS/Windows/CommandstartProcess/"/>
      <url>/OS/Windows/CommandstartProcess/</url>
      
        <content type="html"><![CDATA[<h1 id="Windows-查看进程启动参数命令行"><a href="#Windows-查看进程启动参数命令行" class="headerlink" title="Windows 查看进程启动参数命令行"></a>Windows 查看进程启动参数命令行</h1><h2 id="使用wmic查看"><a href="#使用wmic查看" class="headerlink" title="使用wmic查看"></a>使用<code>wmic</code>查看</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process where caption=&quot;【进程名】&quot; get caption,commandline /value</span><br></pre></td></tr></table></figure><p>也可以通过打印所有的命令行参数之后进行筛选</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process get caption,commandline /value | findstr &quot;【进程名，特征字符串等】&quot;</span><br></pre></td></tr></table></figure><h2 id="使用任务管理器查看"><a href="#使用任务管理器查看" class="headerlink" title="使用任务管理器查看"></a>使用任务管理器查看</h2><p>打开任务管理器，在<kbd>详细信息</kbd>栏，右击标题列<code>-&gt;</code>选择列，找到命令行，勾选即可。</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Windows/images/CommandstartProcess/image-20220425100222890.png" alt="选择命令行列"></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows 系统获取系统主机域名</title>
      <link href="/OS/Windows/API/%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%9F%9F%E5%90%8D/"/>
      <url>/OS/Windows/API/%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%9F%9F%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：windows操作系统下获取主机域名</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetDominName.cpp : 获取主机域名</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DSRole.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;netapi32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DSROLE_PRIMARY_DOMAIN_INFO_BASIC * info;</span><br><span class="line">DWORD dw;</span><br><span class="line"></span><br><span class="line">dw = <span class="built_in">DsRoleGetPrimaryDomainInformation</span>(<span class="literal">NULL</span>,</span><br><span class="line">DsRolePrimaryDomainInfoBasic,</span><br><span class="line">(PBYTE *)&amp;info);</span><br><span class="line"><span class="keyword">if</span> (dw != ERROR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">wprintf</span>(<span class="string">L&quot;DsRoleGetPrimaryDomainInformation: %u\n&quot;</span>, dw);</span><br><span class="line"><span class="keyword">return</span> dw;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (info-&gt;DomainNameDns == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">wprintf</span>(<span class="string">L&quot;DomainNameDns is NULL\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">wprintf</span>(<span class="string">L&quot;DomainNameDns: %s\n&quot;</span>, info-&gt;DomainNameDns);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出示例：</p><p><img src="/images/%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%9F%9F%E5%90%8D/1.png" alt="image-20230814100602822"></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> winapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>删除文件夹下所有文件</title>
      <link href="/OS/Windows/API/%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6/"/>
      <url>/OS/Windows/API/%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// moveLogs.cpp : 此文件包含 &quot;main&quot; 函数。程序执行将在此处开始并结束。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinUser.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strsafe.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ShObjIdl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;shlobj.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;comutil.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;comsuppw.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/entry:mainCRTStartup&quot;</span>) </span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> _SetFileRebootDelete(<span class="type">const</span> std::string&amp; file_path) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">MoveFileExA</span>(file_path.<span class="built_in">c_str</span>(), <span class="number">0</span>, MOVEFILE_DELAY_UNTIL_REBOOT)) &#123;</span><br><span class="line"><span class="comment">// MessageBoxA(NULL, &quot;成功！&quot;, &quot;设置成功！&quot;, MB_OK);</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// MessageBoxA(NULL, &quot;失败！&quot;, &quot;设置失败！&quot;, MB_OK);</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getFiles</span><span class="params">(std::string path, std::vector&lt;std::string&gt;&amp; files, std::vector&lt;std::string&gt;&amp; names)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//文件句柄，win10用long long，win7用long就可以了</span></span><br><span class="line"><span class="type">long</span> hFile = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//文件信息 </span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">_finddata_t</span> fileinfo;</span><br><span class="line">std::string p;</span><br><span class="line"><span class="keyword">if</span> ((hFile = _findfirst(p.<span class="built_in">assign</span>(path).<span class="built_in">append</span>(<span class="string">&quot;\\*&quot;</span>).<span class="built_in">c_str</span>(), &amp;fileinfo)) != <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果是目录,迭代之 //如果不是,加入列表 </span></span><br><span class="line"><span class="keyword">if</span> ((fileinfo.attrib &amp; _A_SUBDIR))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(fileinfo.name, <span class="string">&quot;.&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(fileinfo.name, <span class="string">&quot;..&quot;</span>) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">getFiles</span>(p.<span class="built_in">assign</span>(path).<span class="built_in">append</span>(<span class="string">&quot;\\&quot;</span>).<span class="built_in">append</span>(fileinfo.name), files, names);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">files.<span class="built_in">push_back</span>(p.<span class="built_in">assign</span>(path).<span class="built_in">append</span>(<span class="string">&quot;\\&quot;</span>).<span class="built_in">append</span>(fileinfo.name));</span><br><span class="line">names.<span class="built_in">push_back</span>(fileinfo.name);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (_findnext(hFile, &amp;fileinfo) == <span class="number">0</span>);</span><br><span class="line">_findclose(hFile);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">GetLoactionDir</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DWORD dwLen = <span class="number">0</span>;</span><br><span class="line">CHAR szAppDataDir[MAX_PATH];</span><br><span class="line">dwLen = <span class="built_in">ExpandEnvironmentStringsA</span>(<span class="string">&quot;%programdata%&quot;</span>, szAppDataDir, MAX_PATH);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dwLen != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">StringCchCatA</span>(szAppDataDir, <span class="built_in">sizeof</span>(szAppDataDir), (<span class="string">&quot;\\TrustAgent\\logs&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> szAppDataDir;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">std::string filepath = <span class="built_in">GetLoactionDir</span>();</span><br><span class="line"></span><br><span class="line">vector&lt;string&gt; files;</span><br><span class="line">vector&lt;string&gt; names;</span><br><span class="line"></span><br><span class="line"><span class="built_in">getFiles</span>(filepath, files, names);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; files.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;-----========files:%d========---\n&quot;</span>, i);</span><br><span class="line"><span class="comment">// cout &lt;&lt; &quot;files&quot; &lt;&lt; i &lt;&lt; &#x27;:&#x27; &lt;&lt; files[i] &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// wstring wsName;</span></span><br><span class="line"><span class="comment">// wsName = string2wstring(files[i]);</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;lnkPath: &quot;</span> &lt;&lt; files[i] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// wstring wsDestPath = getLnkFormPath(wsName);</span></span><br><span class="line"><span class="comment">// cout &lt;&lt; &quot;destPath:&quot;;</span></span><br><span class="line"><span class="comment">// wcout &lt;&lt; wsDestPath;</span></span><br><span class="line"><span class="comment">// cout &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">_SetFileRebootDelete(files[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行程序: Ctrl + F5 或调试 &gt;“开始执行(不调试)”菜单</span></span><br><span class="line"><span class="comment">// 调试程序: F5 或调试 &gt;“开始调试”菜单</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 入门使用技巧: </span></span><br><span class="line"><span class="comment">//   1. 使用解决方案资源管理器窗口添加/管理文件</span></span><br><span class="line"><span class="comment">//   2. 使用团队资源管理器窗口连接到源代码管理</span></span><br><span class="line"><span class="comment">//   3. 使用输出窗口查看生成输出和其他消息</span></span><br><span class="line"><span class="comment">//   4. 使用错误列表窗口查看错误</span></span><br><span class="line"><span class="comment">//   5. 转到“项目”&gt;“添加新项”以创建新的代码文件，或转到“项目”&gt;“添加现有项”以将现有代码文件添加到项目</span></span><br><span class="line"><span class="comment">//   6. 将来，若要再次打开此项目，请转到“文件”&gt;“打开”&gt;“项目”并选择 .sln 文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 删除文件 </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FormatMessageA</title>
      <link href="/OS/Windows/API/FormatMessageA/"/>
      <url>/OS/Windows/API/FormatMessageA/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">get_sys_error_msg</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> err)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span> _inner_msg[<span class="number">10240</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="built_in">memset</span>(_inner_msg, <span class="number">0</span>, <span class="built_in">sizeof</span>(_inner_msg));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (err == <span class="number">0</span>)</span><br><span class="line">err = <span class="built_in">GetLastError</span>();</span><br><span class="line">LPSTR buf = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (::<span class="built_in">FormatMessageA</span>(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM | </span><br><span class="line"> FORMAT_MESSAGE_IGNORE_INSERTS,</span><br><span class="line"> <span class="literal">NULL</span>, </span><br><span class="line"> err, </span><br><span class="line"> <span class="built_in">MAKELANGID</span>(LANG_ENGLISH, SUBLANG_ENGLISH_US),</span><br><span class="line">(LPSTR)&amp;buf, </span><br><span class="line"><span class="number">0</span>, </span><br><span class="line"><span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sprintf_s</span>(_inner_msg, <span class="built_in">sizeof</span>(_inner_msg),<span class="string">&quot;[%d]%s&quot;</span>, err, buf);</span><br><span class="line">::<span class="built_in">LocalFree</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">snprintf</span>(_inner_msg, <span class="built_in">sizeof</span>(_inner_msg), <span class="string">&quot; [0x%x]Unknown error&quot;</span>, err);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">string <span class="title">str_error_msg</span><span class="params">(_inner_msg)</span></span>;</span><br><span class="line"><span class="keyword">return</span> str_error_msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> API </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ShellExecute</title>
      <link href="/OS/Windows/API/ShellExecute/"/>
      <url>/OS/Windows/API/ShellExecute/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： <code>ShellExecute</code> 用法的整理和示例<br>官方说明：<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/shellapi/nf-shellapi-shellexecutea">shellExecuteA 函数 (shellapi.h) - Win32 apps | Microsoft Learn</a></p></blockquote><h1 id="一个完整的用法示例"><a href="#一个完整的用法示例" class="headerlink" title="一个完整的用法示例"></a>一个完整的用法示例</h1><p>以下示例为一个完整的用法展示，实现了调用第三方工具 <code>devocn.exe</code> 安装虚拟网卡（不展示安装界面）并通过获取安装进程句柄判断安装结果。</p><ul><li><code>SEE_MASK_NOCLOSEPROCESS</code> 参数：表示要获取进程句柄</li><li>通过 <code>GetExitCodeProcess</code> 函数获取进程执行状态</li><li><code>SW_HIDE</code> 参数: 不展示窗口</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> QREINSTALL_NETCARD_TOOLS_NAME   <span class="string">L&quot;devcon.exe&quot;</span></span></span><br><span class="line">std::mutex g_mutex_nc_install;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InstallNcDrive</span><span class="params">(<span class="type">bool</span> &amp;bRes, <span class="type">bool</span> &amp;bEnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(g_mutex_nc_install)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> bOptRt = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//触发重新安装虚拟网卡</span></span><br><span class="line">TCHAR szPath[MAX_PATH];</span><br><span class="line">::<span class="built_in">GetModuleFileName</span>(<span class="literal">NULL</span>, szPath, MAX_PATH);</span><br><span class="line">::<span class="built_in">PathRemoveFileSpec</span>(szPath);</span><br><span class="line"></span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;tools[devcon.exe]&#x27;s path is&quot;</span> &lt;&lt; QString::<span class="built_in">fromWCharArray</span>(szPath);</span><br><span class="line"></span><br><span class="line">std::string command = <span class="string">&quot; install vpnvnic.inf vpnvnic&quot;</span>;</span><br><span class="line"></span><br><span class="line">SHELLEXECUTEINFO  ShExecInfoInstall = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">ShExecInfoInstall.cbSize = <span class="built_in">sizeof</span>(SHELLEXECUTEINFO);</span><br><span class="line">ShExecInfoInstall.fMask = SEE_MASK_NOCLOSEPROCESS;</span><br><span class="line">ShExecInfoInstall.hwnd = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">isProcessAdmin</span>())</span><br><span class="line">&#123;</span><br><span class="line">ShExecInfoInstall.lpVerb = <span class="string">L&quot;runas&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ShExecInfoInstall.lpVerb = <span class="string">L&quot;open&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ShExecInfoInstall.lpFile = QREINSTALL_NETCARD_TOOLS_NAME;</span><br><span class="line">ShExecInfoInstall.lpParameters = <span class="built_in">STDString2LPCWCH</span>(command);</span><br><span class="line">ShExecInfoInstall.lpDirectory = szPath;</span><br><span class="line">ShExecInfoInstall.nShow = SW_HIDE;</span><br><span class="line">ShExecInfoInstall.hInstApp = <span class="literal">NULL</span>;</span><br><span class="line">ShExecInfoInstall.hProcess = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">bOptRt = <span class="built_in">ShellExecuteEx</span>(&amp;ShExecInfoInstall);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bOptRt)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;驱动安装进程已启动！&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待进程结束</span></span><br><span class="line"><span class="built_in">WaitForSingleObject</span>(ShExecInfoInstall.hProcess, INFINITE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取退出代码</span></span><br><span class="line">DWORD exitCode;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetExitCodeProcess</span>(ShExecInfoInstall.hProcess, &amp;exitCode))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 判断进程是否成功退出</span></span><br><span class="line"><span class="keyword">if</span> (exitCode != STILL_ACTIVE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;驱动安装进程已退出，退出代码: &quot;</span> &lt;&lt; exitCode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;驱动安装进程未能正常退出，退出代码: &quot;</span> &lt;&lt; exitCode;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;获取驱动安装进程退出代码失败！错误代码: &quot;</span> &lt;&lt; <span class="built_in">GetLastError</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实测 1和0 的时候安装成功</span></span><br><span class="line">bRes = exitCode == <span class="number">1</span> || exitCode == <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭句柄</span></span><br><span class="line"><span class="built_in">CloseHandle</span>(ShExecInfoInstall.hProcess);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_ERROR</span>() &lt;&lt; <span class="string">&quot;启动驱动安装进程失败！错误代码: &quot;</span> &lt;&lt; <span class="built_in">GetLastError</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">QLOG_ERROR</span>() &lt;&lt; __FUNCTION__ &lt;&lt; __LINE__ &lt;&lt; e.<span class="built_in">what</span>();</span><br><span class="line"></span><br><span class="line">bEnd = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> bOptRt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bEnd = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> bOptRt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Windows </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> winapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xcode 下载与安装</title>
      <link href="/OS/Mac/Xcode/"/>
      <url>/OS/Mac/Xcode/</url>
      
        <content type="html"><![CDATA[<p>下载后得到 xip 文件 如 ： Xcode_13.xip 可以使用解压缩软件进行解压，如果有些压缩软件不支持会提示破损，可以考虑直接在命令行解压。</p><p>第一步：cd 到下载的目录 第二步：xip -x Xcode_13.xip 此时，会有一个很奇怪的提示，会误以为报错。</p><blockquote><p> xip: signing certificate was “Software Update” (validation not attempted) </p></blockquote><p>主要是 xcode 文件太大导致的，可以耐心多等待几分钟，将会收到以下信息：</p><blockquote><p> xip: expanded items from “&#x2F;Users&#x2F;ivychen&#x2F;Documents&#x2F;Xcode_13.xip” </p></blockquote><p>将得到 Xcode 程序文件，将其拖动到访达的 Application 文件夹即可。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> Xcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 进程管理</title>
      <link href="/OS/Linux/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8ALinux%E5%86%85%E6%A0%B8/6%20Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
      <url>/OS/Linux/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8ALinux%E5%86%85%E6%A0%B8/6%20Linux%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li>查看进程的运行状态</li><li>进程的结束控制</li><li>进程的执行顺序</li></ul></blockquote><p>[toc]</p><h1 id="1-进程的查看"><a href="#1-进程的查看" class="headerlink" title="1 进程的查看"></a>1 进程的查看</h1><p>不管在测试的时候、在实际的生产环境中，还是自己的使用过程中，难免会遇到一些进程异常的情况，所以 Linux 为我们提供了一些工具来查看进程的状态信息。我们可以通过 <code>top</code> 实时的查看进程的状态，以及系统的一些信息（如 CPU、内存信息等），我们还可以通过 <code>ps</code> 来静态查看当前的进程信息，同时我们还可以使用 <code>pstree</code> 来查看当前活跃进程的树形结构。</p><h2 id="1-1-top工具的使用"><a href="#1-1-top工具的使用" class="headerlink" title="1.1 top工具的使用"></a>1.1 top工具的使用</h2>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> 操作系统及Linux内核 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 进程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux进程概念</title>
      <link href="/OS/Linux/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8ALinux%E5%86%85%E6%A0%B8/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/"/>
      <url>/OS/Linux/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8ALinux%E5%86%85%E6%A0%B8/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li>进程与程序</li><li>进程的衍生</li><li>工作管理</li></ul></blockquote><p>[toc]</p><h1 id="1-概念理解"><a href="#1-概念理解" class="headerlink" title="1 概念理解"></a>1 概念理解</h1><p>首先程序与进程是什么？程序与进程又有什么区别？</p><blockquote><p><strong>程序</strong>（procedure）：不太精确地说，程序就是执行一系列有逻辑、有顺序结构的指令，帮我们达成某个结果。就如我们去餐馆，给服务员说我要牛肉盖浇饭，她执行了做牛肉盖浇饭这么一个程序，最后我们得到了这么一盘牛肉盖浇饭。它需要去执行，不然它就像一本武功秘籍，放在那里等人翻看。</p></blockquote><blockquote><p><strong>进程</strong>（process）：进程是程序在一个数据集合上的一次执行过程，在早期的UNIX、Linux 2.4及更早的版本中，它是系统进行资源分配和调度的独立基本单位。同上一个例子，就如我们去了餐馆，给服务员说我要牛肉盖浇饭，她执行了做牛肉盖浇饭这么一个程序，而里面做饭的是一个进程，做牛肉汤汁的是一个进程，把牛肉汤汁与饭混合在一起的是一个进程，把饭端上桌的是一个进程。它就像是我们在看武功秘籍这么一个过程，然后一个篇章一个篇章地去练。</p></blockquote><p>简单来说，程序是为了完成某种任务而设计的软件，比如 vim 是程序。什么是进程呢？进程就是运行中的程序。</p><p>程序只是一些列指令的集合，是一个静止的实体，而进程不同，进程有以下的特性：</p><ul><li>动态性：进程的实质是一次程序执行的过程，有创建、撤销等状态的变化。而程序是一个静态的实体。</li><li>并发性：进程可以做到在一个时间段内，有多个程序在运行中。程序只是静态的实体，所以不存在并发性。</li><li>独立性：进程可以独立分配资源，独立接受调度，独立地运行。</li><li>异步性：进程以不可预知的速度向前推进。</li><li>结构性：进程拥有代码段、数据段、PCB（进程控制块，进程存在的唯一标志）。也正是因为有结构性，进程才可以做到独立地运行。</li></ul><blockquote><p><strong>并发：</strong>在一个时间段内，宏观来看有多个程序都在活动，有条不紊的执行（每一瞬间只有一个在执行，只是在一段时间有多个程序都执行过）</p></blockquote><blockquote><p><strong>并行：</strong>在每一个瞬间，都有多个程序都在同时执行，这个必须有多个 CPU 才行</p></blockquote><p>引入进程是因为传统意义上的程序已经不足以描述 OS 中各种活动之间的动态性、并发性、独立性还有相互制约性。程序就像一个公司，只是一些证书，文件的堆积（静态实体）。而当公司运作起来就有各个部门的区分，财务部，技术部，销售部等等，就像各个进程，各个部门之间可以独立运做，也可以有交互（独立性、并发性）。</p><p>而随着程序的发展越做越大，又会继续细分，从而引入了线程的概念，当代多数操作系统、Linux 2.6及更新的版本中，进程本身不是基本运行单位，而是线程的容器。就像上述所说的，每个部门又会细分为各个工作小组（线程），而工作小组需要的资源需要向上级（进程）申请。</p><blockquote><p><strong>线程</strong>（thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。因为线程中几乎不包含系统资源，所以执行更快、更有效率。</p></blockquote><p>简而言之,一个程序至少有一个进程,一个进程至少有一个线程。线程的划分尺度小于进程，使得多线程程序的并发性高。另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。就如下图所示：</p><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1.png" alt="实验楼"></p><h1 id="2-进程的属性"><a href="#2-进程的属性" class="headerlink" title="2 进程的属性"></a>2 进程的属性</h1><h2 id="2-1-进程的分类"><a href="#2-1-进程的分类" class="headerlink" title="2.1 进程的分类"></a>2.1 进程的分类</h2><ol><li>第一个角度来看，我们可以分为<strong>用户进程</strong>与<strong>系统进程</strong>：</li></ol><ul><li>用户进程：通过执行用户程序、应用程序或称之为内核之外的系统程序而产生的进程，此类进程可以在用户的控制下运行或关闭。</li><li>系统进程：通过执行系统内核程序而产生的进程，比如可以执行内存资源分配和进程切换等相对底层的工作；而且该进程的运行不受用户的干预，即使是 root 用户也不能干预系统进程的运行。</li></ul><ol start="2"><li>第二角度来看，我们可以将进程分为<strong>交互进程</strong>、<strong>批处理进程</strong>、<strong>守护进程</strong></li></ol><ul><li>交互进程：由一个 shell 终端启动的进程，在执行过程中，需要与用户进行交互操作，可以运行于前台，也可以运行在后台。</li><li>批处理进程：该进程是一个进程集合，负责按顺序启动其他的进程。</li><li>守护进程：守护进程是一直运行的一种进程，在 Linux 系统启动时启动，在系统关闭时终止。它们独立于控制终端并且周期性的执行某种任务或等待处理某些发生的事件。例如 httpd 进程，一直处于运行状态，等待用户的访问。还有经常用的 cron（在 centOS 系列为 crond）进程，这个进程为 crontab 的守护进程，可以周期性的执行用户设定的某些任务。</li></ul><h2 id="2-2-进程的衍生"><a href="#2-2-进程的衍生" class="headerlink" title="2.2 进程的衍生"></a>2.2 进程的衍生</h2><p>进程有这么多的种类，那么进程之间定是有相关性的，而这些有关联性的进程又是如何产生的，如何衍生的？</p><p>就比如我们启动了终端，就是启动了一个 bash 进程，我们可以在 bash 中再输入 bash 则会再启动一个 bash 的进程，此时第二个 bash 进程就是由第一个 bash 进程创建出来的，他们之间又是个什么关系？</p><p>我们一般称呼第一个 bash 进程是第二 bash 进程的父进程，第二 bash 进程是第一个 bash 进程的子进程，这层关系是如何得来的呢？</p><p>关于父进程与子进程便会提及这两个系统调用 <code>fork()</code> 与 <code>exec()</code></p><blockquote><p><strong>fork-exec</strong>是由 Dennis M. Ritchie 创造的</p></blockquote><blockquote><p><strong>fork()</strong> 是一个系统调用（system call），它的主要作用就是为当前的进程创建一个新的进程，这个新的进程就是它的子进程，这个子进程除了父进程的返回值和 PID 以外其他的都一模一样，如进程的执行代码段，内存信息，文件描述，寄存器状态等等</p></blockquote><blockquote><p><strong>exec()</strong> 也是系统调用，作用是切换子进程中的执行程序也就是替换其从父进程复制过来的代码段与数据段</p></blockquote><p>子进程就是父进程通过系统调用 <code>fork()</code> 而产生的复制品，<code>fork()</code> 就是把父进程的 PCB 等进程的数据结构信息直接复制过来，只是修改了 PID，所以一模一样，只有在执行 <code>exec()</code> 之后才会不同，而早先的 <code>fork()</code> 比较消耗资源后来进化成 <code>vfork()</code>,效率高了不少，感兴趣的同学可以查查为什么。</p><p>这就是子进程产生的由来。简单的实现逻辑就如下方所示<a href="https://www.lanqiao.cn/courses/2610/learning/?id=43482#jump">【注释１】</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> p;</span><br><span class="line"></span><br><span class="line">p = fork();</span><br><span class="line"><span class="keyword">if</span> (p == (<span class="type">pid_t</span>) <span class="number">-1</span>)</span><br><span class="line">        <span class="comment">/* ERROR */</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p == <span class="number">0</span>)</span><br><span class="line">        <span class="comment">/* CHILD */</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="comment">/* PARENT */</span></span><br></pre></td></tr></table></figure><p>既然子进程是通过父进程而衍生出来的，那么子进程的退出与资源的回收定然与父进程有很大的相关性。当一个子进程要正常的终止运行时，或者该进程结束时它的主函数 <code>main()</code> 会执行 <code>exit(n);</code> 或者 <code>return n</code>，这里的返回值 n 是一个信号，系统会把这个 SIGCHLD 信号传给其父进程，当然若是异常终止也往往是因为这个信号。</p><p>在将要结束时的子进程代码执行部分已经结束执行了，系统的资源也基本归还给系统了，但若是其进程的进程控制块（PCB）仍驻留在内存中，而它的 PCB 还在，代表这个进程还存在（因为 PCB 就是进程存在的唯一标志，里面有 PID 等消息），并没有消亡，这样的进程称之为僵尸进程（Zombie）。</p><p>如图中第四列标题是 S，S 表示的是进程的状态，而在下属的第三行的 Z 表示的是 Zombie 的意思。（ ps 命令将在后续详解）</p><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/2.png" alt="实验楼"></p><p>正常情况下，父进程会收到两个返回值：exit code（SIGCHLD 信号）与 <code>reason for termination</code> 。之后，父进程会使用 <code>wait(&amp;status)</code> 系统调用以获取子进程的退出状态，然后内核就可以从内存中释放已结束的子进程的 PCB；而如若父进程没有这么做的话，子进程的 PCB 就会一直驻留在内存中，一直留在系统中成为僵尸进程（Zombie）。</p><p>虽然僵尸进程是已经放弃了几乎所有内存空间，没有任何可执行代码，也不能被调度，在进程列表中保留一个位置，记载该进程的退出状态等信息供其父进程收集，从而释放它。但是 Linux 系统中能使用的 PID 是有限的，如果系统中存在有大量的僵尸进程，系统将会因为没有可用的 PID 从而导致不能产生新的进程。</p><p>另外如果父进程结束（非正常的结束），未能及时收回子进程，子进程仍在运行，这样的子进程称之为孤儿进程。在 Linux 系统中，孤儿进程一般会被 init 进程所“收养”，成为 init 的子进程。由 init 来做善后处理，所以它并不至于像僵尸进程那样无人问津，不管不顾，大量存在会有危害。</p><p>进程 0 是系统引导时创建的一个特殊进程，也称之为内核初始化，其最后一个动作就是调用 <code>fork()</code> 创建出一个子进程运行 <code>/sbin/init</code> 可执行文件,而该进程就是 PID&#x3D;1 的进程 1，而进程 0 就转为交换进程（也被称为空闲进程），进程 1 （init 进程）是第一个用户态的进程，再由它不断调用 fork() 来创建系统里其他的进程，所以它是所有进程的父进程或者祖先进程。同时它是一个守护程序，直到计算机关机才会停止。</p><p>通过以下的命令我们可以很明显的看到这样的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/3.png" alt="实验楼"></p><p>或者从此图我们可以更加形象的看清子父进程的关系</p><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/4.png" alt="实验楼"></p><p>通过以上的显示结果我们可以看的很清楚，init 为所有进程的父进程或者说是祖先进程</p><p>我们还可以使用这样一个命令来看，其中 pid 就是该进程的一个唯一编号，ppid 就是该进程的父进程的 pid，command 表示的是该进程通过执行什么样的命令或者脚本而产生的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps －fxo user,ppid,pid,pgid,command</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/5.png" alt="实验楼"></p><p>可以在图中看见我们执行的 ps 就是由 zsh 通过 fork-exec 创建的子进程而执行的</p><p>使用这样的一个命令我们也能清楚的看见 init 如上文所说是由进程 0 这个初始化进程来创建出来的子进程,而其他的进程基本是由 init 创建的子进程，或者是由它的子进程创建出来的子进程。所以 init 是用户进程的第一个进程也是所有用户进程的父进程或者祖先进程。（ps 命令将在后续课程详解）</p><p>就像一个树状图，而 init 进程就是这棵树的根，其他进程由根不断的发散，开枝散叶</p><h2 id="2-3-进程组与Sessions"><a href="#2-3-进程组与Sessions" class="headerlink" title="2.3 进程组与Sessions"></a>2.3 进程组与Sessions</h2><p>每一个进程都会是一个进程组的成员，而且这个进程组是唯一存在的，他们是依靠 PGID（process group ID）来区别的，而每当一个进程被创建的时候，它便会成为其父进程所在组中的一员。</p><p>一般情况，进程组的 PGID 等同于进程组的第一个成员的 PID，并且这样的进程称为该进程组的领导者,也就是领导进程，进程一般通过使用 <code>getpgrp()</code> 系统调用来寻找其所在组的 PGID，领导进程可以先终结，此时进程组依然存在，并持有相同的PGID，直到进程组中最后一个进程终结。</p><p>与进程组类似，每当一个进程被创建的时候，它便会成为其父进程所在 Session 中的一员，每一个进程组都会在一个 Session 中，并且这个 Session 是唯一存在的，</p><p>Session 主要是针对一个 tty 建立，Session 中的每个进程都称为一个工作(job)。每个会话可以连接一个终端(control terminal)。当控制终端有输入输出时，都传递给该会话的前台进程组。Session 意义在于将多个 jobs 囊括在一个终端，并取其中的一个 job 作为前台，来直接接收该终端的输入输出以及终端信号。 其他 jobs 在后台运行。</p><blockquote><p><strong>前台</strong>（foreground）就是在终端中运行，能与你有交互的</p></blockquote><blockquote><p><strong>后台</strong>（background）就是在终端中运行，但是你并不能与其任何的交互，也不会显示其执行的过程</p></blockquote><h2 id="2-4-工作管理"><a href="#2-4-工作管理" class="headerlink" title="2.4 工作管理"></a>2.4 工作管理</h2><p>bash(Bourne-Again shell)支持工作控制（job control）,而 sh（Bourne shell）并不支持。</p><p>并且每个终端或者说 bash 只能管理当前终端中的 job，不能管理其他终端中的 job。比如我当前存在两个 bash 分别为 bash1、bash2，bash1 只能管理其自己里面的 job 并不能管理 bash2 里面的 job</p><p>我们都知道当一个进程在前台运作时我们可以用 <code>ctrl + c</code> 来终止它，但是若是在后台的话就不行了。</p><p>我们可以通过 <code>&amp;</code> 这个符号，让我们的命令在后台中运行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls &amp;</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/6.png" alt="实验楼"></p><p>图中所显示的 <code>[1] 236</code>分别是该 job 的 job number 与该进程的 PID，而最后一行的 Done 表示该命令已经在后台执行完毕。</p><p>我们还可以通过 <code>ctrl + z</code> 使我们的当前工作停止并丢到后台中去</p><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/7.png" alt="实验楼"></p><p>被停止并放置在后台的工作我们可以使用这个命令来查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jobs</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/8.png" alt="实验楼"></p><p>其中第一列显示的为被放置后台 job 的编号，而第二列的 <code>＋</code> 表示最近(刚刚、最后)被放置后台的 job，同时也表示预设的工作，也就是若是有什么针对后台 job 的操作，首先对预设的 job，<code>-</code> 表示倒数第二（也就是在预设之前的一个）被放置后台的工作，倒数第三个（再之前的）以后都不会有这样的符号修饰，第三列表示它们的状态，而最后一列表示该进程执行的命令</p><p>我们可以通过这样的一个命令将后台的工作拿到前台来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#后面不加参数提取预设工作，加参数提取指定工作的编号</span><br><span class="line">#ubuntu 在 zsh 中需要 %，在 bash 中不需要 %</span><br><span class="line">fg [%jobnumber]</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/9.png" alt="实验楼"></p><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/10.png" alt="实验楼"></p><p>之前我们通过 <code>ctrl + z</code> 使得工作停止放置在后台，若是我们想让其在后台运作我们就使用这样一个命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#与fg类似，加参则指定，不加参则取预设</span><br><span class="line">bg [%jobnumber]</span><br></pre></td></tr></table></figure><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/11.png" alt="实验楼"></p><p>既然有方法将被放置在后台的工作提至前台或者让它从停止变成继续运行在后台，当然也有方法删除一个工作，或者重启等等</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#kill的使用格式如下</span><br><span class="line">kill -signal %jobnumber</span><br><span class="line"></span><br><span class="line">#signal从1-64个信号值可以选择，可以这样查看</span><br><span class="line">kill －l</span><br></pre></td></tr></table></figure><p>其中常用的有这些信号值</p><table><thead><tr><th>信号值</th><th>作用</th></tr></thead><tbody><tr><td>-1</td><td>重新读取参数运行，类似与restart</td></tr><tr><td>-2</td><td>如同 ctrl+c 的操作退出</td></tr><tr><td>-9</td><td>强制终止该任务</td></tr><tr><td>-15</td><td>正常的方式终止该任务</td></tr></tbody></table><p><img src="/images/5%20Linux%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/12.png" alt="实验楼"></p><blockquote><p><strong>注意</strong></p></blockquote><blockquote><p>若是在使用kill＋信号值然后直接加 pid，你将会对 pid 对应的进程进行操作</p></blockquote><blockquote><p>若是在使用kill+信号值然后 <code>％jobnumber</code>，这时所操作的对象是 job，这个数字就是就当前 bash 中后台的运行的 job 的 ID</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> 操作系统及Linux内核 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 进程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 导读大纲</title>
      <link href="/OS/Linux/readme/"/>
      <url>/OS/Linux/readme/</url>
      
        <content type="html"><![CDATA[<ol><li><a href="./Command&Tools/">命令行和工具</a></li><li><a href="./Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Readme">Linux基础入门</a></li><li><a href="./Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/Readme">Linux内核分析配套实验</a></li><li><a href="./RPC/">Linux RPC</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 导读 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux RPC</title>
      <link href="/OS/Linux/RPC/Linux_RPC/"/>
      <url>/OS/Linux/RPC/Linux_RPC/</url>
      
        <content type="html"><![CDATA[<p><img src="/Linux_RPC/LinuxRPC.png" alt="LinuxRPC"></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> rpc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5 环境变量与文件查找</title>
      <link href="/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/"/>
      <url>/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="1-环境变量"><a href="#1-环境变量" class="headerlink" title="1. 环境变量"></a>1. 环境变量</h1><p>简单理解了变量的概念，就很容易理解环境变量了。环境变量的作用域比自定义变量的要大，如 Shell 的环境变量作用于自身和它的子进程。在所有的 UNIX 和类 UNIX 系统中，每个进程都有其各自的环境变量设置，且默认情况下，当一个进程被创建时，除了创建过程中明确指定的话，它将继承其父进程的绝大部分环境设置。Shell 程序也作为一个进程运行在操作系统之上，而我们在 Shell 中运行的大部分命令都将以 Shell 的子进程的方式运行。</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-2.png" alt="1"></p><p>通常我们会涉及到的变量类型有三种：</p><ul><li>当前 Shell 进程私有用户自定义变量，如上面我们创建的 tmp 变量，只在当前 Shell 中有效。</li><li>Shell 本身内建的变量。</li><li>从自定义变量导出的环境变量。</li></ul><p>也有三个与上述三种环境变量相关的命令：<code>set</code>，<code>env</code>，<code>export</code>。这三个命令很相似，都是用于打印环境变量信息，区别在于涉及的变量范围不同。详见下表：</p><table><thead><tr><th>命 令</th><th>说 明</th></tr></thead><tbody><tr><td><code>set</code></td><td>显示当前 Shell 所有变量，包括其内建环境变量（与 Shell 外观等相关），用户自定义变量及导出的环境变量。</td></tr><tr><td><code>env</code></td><td>显示与当前用户相关的环境变量，还可以让命令在指定环境中运行。</td></tr><tr><td><code>export</code></td><td>显示从 Shell 中导出成环境变量的变量，也能通过它将自定义变量导出为环境变量。</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-3.png" alt="1"></p><p>你可以更直观的使用 <code>vimdiff</code> 工具比较一下它们之间的差别：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">temp=shiyanlou</span><br><span class="line"><span class="built_in">export</span> temp_env=shiyanlou</span><br><span class="line"><span class="built_in">env</span>|<span class="built_in">sort</span>&gt;env.txt</span><br><span class="line"><span class="built_in">export</span>|<span class="built_in">sort</span>&gt;export.txt</span><br><span class="line"><span class="built_in">set</span>|<span class="built_in">sort</span>&gt;set.txt</span><br></pre></td></tr></table></figure><p>上述操作将命令输出通过管道 <code>|</code> 使用 <code>sort</code> 命令排序，再重定向到对象文本文件中。管道的概念后面我们会学到，现在你知道这是什么意思就行了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vimdiff env.txt export.txt set.txt</span><br></pre></td></tr></table></figure><p>使用 <code>vimdiff</code> 工具比较导出的几个文件的内容，退出 <code>vimdiff</code> 需要按下 Esc 后输入 <code>:q</code> 即可退出。</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-5.gif" alt="1"></p><p>关于哪些变量是环境变量，可以简单地理解成在当前进程的子进程有效则为环境变量，否则不是（有些人也将所有变量统称为环境变量，只是以全局环境变量和局部环境变量进行区分，我们只要理解它们的实质区别即可）。我们这里用 <code>export</code> 命令来体会一下，先在 Shell 中设置一个变量 <code>temp=shiyanlou</code>，然后再新创建一个子 Shell 查看 <code>temp</code> 变量的值：</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-4.png" alt="此处输入图片的描述"></p><p><strong>注意：为了与普通变量区分，通常我们习惯将环境变量名设为大写。</strong></p><h4 id="永久生效"><a href="#永久生效" class="headerlink" title="永久生效"></a>永久生效</h4><p>但是问题来了，当你关机后，或者关闭当前的 shell 之后，环境变量就没了啊。怎么才能让环境变量永久生效呢？</p><p>按变量的生存周期来划分，Linux 变量可分为两类：</p><ol><li>永久的：需要修改配置文件，变量永久生效；</li><li>临时的：使用 export 命令行声明即可，变量在关闭 shell 时失效。</li></ol><p>这里介绍两个重要文件 <code>/etc/bashrc</code>（有的 Linux 没有这个文件） 和 <code>/etc/profile</code> ，它们分别存放的是 shell 变量和环境变量。还有要注意区别的是每个用户目录下的一个隐藏文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .profile 可以用 ls -a 查看</span></span><br><span class="line"><span class="built_in">cd</span> /home/shiyanlou</span><br><span class="line"><span class="built_in">ls</span> -a</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583220161661.png" alt="图片描述"></p><p>这个 .profile 只对当前用户永久生效。因为它保存在当前用户的 Home 目录下，当切换用户时，工作目录可能一并被切换到对应的目录中，这个文件就无法生效。而写在 <code>/etc/profile</code> 里面的是对所有用户永久生效，所以如果想要添加一个永久生效的环境变量，只需要打开 <code>/etc/profile</code>，在最后加上你想添加的环境变量就好啦。</p><h2 id="1-命令的查找路径与顺序"><a href="#1-命令的查找路径与顺序" class="headerlink" title="1. 命令的查找路径与顺序"></a>1. 命令的查找路径与顺序</h2><p>查看 <code>PATH</code> 环境变量的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>默认情况下你会看到如下输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games</span><br></pre></td></tr></table></figure><p>如果你还记得 Linux 目录结构那一节的内容，你就应该知道上面这些目录下放的是哪一类文件了。通常这一类目录下放的都是可执行文件，当我们在 Shell 中执行一个命令时，系统就会按照 PATH 中设定的路径按照顺序依次到目录中去查找，如果存在同名的命令，则执行先找到的那个。</p><h2 id="2-添加自定义路径到-PATH-环境变量"><a href="#2-添加自定义路径到-PATH-环境变量" class="headerlink" title="2 添加自定义路径到 PATH 环境变量"></a>2 添加自定义路径到 <code>PATH</code> 环境变量</h2><p>在前面我们应该注意到 <code>PATH</code> 里面的路径是以 <code>:</code> 作为分割符的，所以我们可以这样添加自定义路径：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=<span class="variable">$PATH</span>:/home/shiyanlou/mybin</span><br></pre></td></tr></table></figure><p><strong>注意这里一定要使用绝对路径。</strong></p><h2 id="3-修改和删除已有变量"><a href="#3-修改和删除已有变量" class="headerlink" title="3 修改和删除已有变量"></a>3 修改和删除已有变量</h2><h4 id="变量修改"><a href="#变量修改" class="headerlink" title="变量修改"></a>变量修改</h4><p>变量的修改有以下几种方式：</p><table><thead><tr><th>变量设置方式</th><th>说明</th></tr></thead><tbody><tr><td><code>$&#123;变量名#匹配字串&#125;</code></td><td>从头向后开始匹配，删除符合匹配字串的最短数据</td></tr><tr><td><code>$&#123;变量名##匹配字串&#125;</code></td><td>从头向后开始匹配，删除符合匹配字串的最长数据</td></tr><tr><td><code>$&#123;变量名%匹配字串&#125;</code></td><td>从尾向前开始匹配，删除符合匹配字串的最短数据</td></tr><tr><td><code>$&#123;变量名%%匹配字串&#125;</code></td><td>从尾向前开始匹配，删除符合匹配字串的最长数据</td></tr><tr><td><code>$&#123;变量名/旧的字串/新的字串&#125;</code></td><td>将符合旧字串的第一个字串替换为新的字串</td></tr><tr><td><code>$&#123;变量名//旧的字串/新的字串&#125;</code></td><td>将符合旧字串的全部字串替换为新的字串</td></tr></tbody></table><p>比如我们可以修改前面添加到 PATH 的环境变量，将添加的 mybin 目录从环境变量里删除。为了避免操作失误导致命令找不到，我们先将 PATH 赋值给一个新的自定义变量 mypath：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mypath=<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$mypath</span></span><br><span class="line">mypath=<span class="variable">$&#123;mypath%/home/shiyanlou/mybin&#125;</span></span><br><span class="line"><span class="comment"># 或使用通配符 * 表示任意多个任意字符</span></span><br><span class="line">mypath=<span class="variable">$&#123;mypath%*/mybin&#125;</span></span><br></pre></td></tr></table></figure><p>可以看到路径已经不存在了。</p><h4 id="变量删除"><a href="#变量删除" class="headerlink" title="变量删除"></a>变量删除</h4><p>可以使用 <code>unset</code> 命令删除一个环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> mypath</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583224422523.png" alt="图片描述"></p><h2 id="4-让环境变量立即生效"><a href="#4-让环境变量立即生效" class="headerlink" title="4 让环境变量立即生效"></a>4 让环境变量立即生效</h2><p>前面我们在 Shell 中修改了一个配置脚本文件之后（比如 zsh 的配置文件 home 目录下的 <code>.zshrc</code>），每次都要退出终端重新打开甚至重启主机之后其才能生效，很是麻烦，我们可以使用 <code>source</code> 命令来让其立即生效，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/shiyanlou</span><br><span class="line"><span class="built_in">source</span> .zshrc</span><br></pre></td></tr></table></figure><p><code>source</code> 命令还有一个别名就是 <code>.</code>，上面的命令如果替换成 <code>.</code> 的方式就该是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ./.zshrc</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583225164807.png" alt="图片描述"></p><p>在使用 <code>.</code> 的时候，需要注意与表示当前路径的那个点区分开。</p><p>注意第一个点后面有一个空格，而且后面的文件必须指定完整的绝对或相对路径名，<code>source</code> 则不需要。</p><h1 id="2-搜索文件"><a href="#2-搜索文件" class="headerlink" title="2 搜索文件"></a>2 搜索文件</h1><p>与搜索相关的命令常用的有 <code>whereis</code>，<code>which</code>，<code>find</code> 和 <code>locate</code>。</p><ul><li><code>whereis</code> 简单快速</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis <span class="built_in">who</span></span><br><span class="line">whereis find</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-6.png" alt="此处输入图片的描述"></p><p>你会看到 <code>whereis find</code> 找到了三个路径，两个可执行文件路径和一个 man 在线帮助文件所在路径，这个搜索很快，因为它并没有从硬盘中依次查找，而是直接从数据库中查询。</p><p><code>whereis</code> 只能搜索二进制文件（<code>-b</code>），man 帮助文件（<code>-m</code>）和源代码文件（<code>-s</code>）。如果想要获得更全面的搜索结果可以使用 <code>locate</code> 命令。</p><ul><li><code>locate</code> 快而全</li></ul><p>使用 <code>locate</code> 命令查找文件也不会遍历硬盘，它通过查询 <code>/var/lib/mlocate/mlocate.db</code> 数据库来检索信息。不过这个数据库也不是实时更新的，系统会使用定时任务每天自动执行 <code>updatedb</code> 命令来更新数据库。所以有时候你刚添加的文件，它可能会找不到，需要手动执行一次 <code>updatedb</code> 命令（在我们的环境中必须先执行一次该命令）。注意这个命令也不是内置的命令，在部分环境中需要手动安装，然后执行更新。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install locate</span><br><span class="line">sudo updatedb</span><br></pre></td></tr></table></figure><p>它可以用来查找指定目录下的不同文件类型，如查找 <code>/etc</code> 下所有以 sh 开头的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate /etc/sh</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意，它不只是在 &#x2F;etc 目录下查找，还会自动递归子目录进行查找。</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583225846911.png" alt="图片描述"></p><p>查找 <code>/usr/share/</code> 下所有 jpg 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate /usr/share/*.jpg</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20210113-1610502774649.png" alt="图片描述"></p><blockquote><p>环境里使用 zsh，在 <code>~/.zshrc</code> 文件里添加了 <code>setopt nonomatch</code> 配置，这样就不会自动处理和修复命令，因此可以不使用 <code>\</code> 转义。如果其他环境中执行该命令提示 <code>zsh: no matches found: /usr/share/*.jpg</code>，则可以在 <code>.zshrc</code> 中添加上述配置，或者使用 <code>\</code> 转义。</p></blockquote><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583226161762.png" alt="图片描述"></p><p>如果想只统计数目可以加上 <code>-c</code> 参数，<code>-i</code> 参数可以忽略大小写进行查找，<code>whereis</code> 的 <code>-b</code>、<code>-m</code>、<code>-s</code> 同样可以使用。</p><ul><li><code>which</code> 小而精</li></ul><p><code>which</code> 本身是 Shell 内建的一个命令，我们通常使用 <code>which</code> 来确定是否安装了某个指定的程序，因为它只从 <code>PATH</code> 环境变量指定的路径中去搜索命令并且返回第一个搜索到的结果。也就是说，我们可以看到某个系统命令是否存在以及执行的到底是哪一个地方的命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> man</span><br><span class="line"><span class="built_in">which</span> nginx</span><br><span class="line"><span class="built_in">which</span> ping</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583226577160.png" alt="图片描述"></p><ul><li><code>find</code> 精而细</li></ul><p><code>find</code> 应该是这几个命令中最强大的了，它不但可以通过文件类型、文件名进行查找而且可以根据文件的属性（如文件的时间戳，文件的权限等）进行搜索。<code>find</code> 命令强大到，要把它讲明白至少需要单独好几节课程才行，我们这里只介绍一些常用的内容。</p><p>这条命令表示去 <code>/etc/</code> 目录下面 ，搜索名字叫做 interfaces 的文件或者目录。这是 <code>find</code> 命令最常见的格式，千万记住 <code>find</code> 的第一个参数是要搜索的地方。命令前面加上 <code>sudo</code> 是因为 shiyanlou 只是普通用户，对 <code>/etc</code> 目录下的很多文件都没有访问的权限，如果是 root 用户则不用使用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find /etc/ -name interfaces</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583226847941.png" alt="图片描述"></p><blockquote><p><strong>注意 find 命令的路径是作为第一个参数的， 基本命令格式为 find [path][option] [action] 。</strong></p></blockquote><p>与时间相关的命令参数：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-atime</code></td><td>最后访问时间</td></tr><tr><td><code>-ctime</code></td><td>最后修改文件内容的时间</td></tr><tr><td><code>-mtime</code></td><td>最后修改文件属性的时间</td></tr></tbody></table><p>下面以 <code>-mtime</code> 参数举例：</p><ul><li><code>-mtime n</code>：n 为数字，表示为在 n 天之前的“一天之内”修改过的文件</li><li><code>-mtime +n</code>：列出在 n 天之前（不包含 n 天本身）被修改过的文件</li><li><code>-mtime -n</code>：列出在 n 天之内（包含 n 天本身）被修改过的文件</li><li><code>-newer file</code>：file 为一个已存在的文件，列出比 file 还要新的文件名</li></ul><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/5-8.png" alt="1"></p><p>列出 home 目录中，当天（24 小时之内）有改动的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ~ -mtime 0</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583226953512.png" alt="图片描述"></p><p>列出用户家目录下比 &#x2F;etc 目录新的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ~ -newer /etc</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE/uid871732-20200303-1583227074890.png" alt="图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux基础入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 基础入门</title>
      <link href="/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Readme/"/>
      <url>/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Readme/</url>
      
        <content type="html"><![CDATA[<blockquote><p>实验楼 Linux 基础入门学习整理</p></blockquote><h1 id="linux-基础入门"><a href="#linux-基础入门" class="headerlink" title="linux 基础入门"></a>linux 基础入门</h1><ol start="5"><li><p><a href="./5%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE.md">5 环境变量与文件查找</a></p></li><li><p><a href="./15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5.md">15 Linux 进程概念</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux基础入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 内核 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 内核分析配套实验</title>
      <link href="/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/Readme/"/>
      <url>/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/Readme/</url>
      
        <content type="html"><![CDATA[<h1 id="linux-内核分析配套实验学习记录"><a href="#linux-内核分析配套实验学习记录" class="headerlink" title="linux 内核分析配套实验学习记录"></a>linux 内核分析配套实验学习记录</h1><p>本节记录实验楼Linux内核学习记录</p><ol><li><a href="./1%20%E5%AE%8C%E6%88%90%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%BA%B2%E5%88%B0%E7%A8%8B%E5%BA%8F%E5%86%85%E6%A0%B8%E4%BB%A3%E7%A0%81.md">1 完成一个简单的时间片轮转躲到程序内核代码</a></li><li><a href="./2%20%E8%B7%9F%E8%B8%AA%E5%88%86%E6%9E%90Linux%E5%86%85%E6%A0%B8%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md">2 跟踪分析Linux内核的启动过程</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux内核分析配套实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 内核 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux基础入门15 Linux进程概念</title>
      <link href="/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/"/>
      <url>/OS/Linux/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<p>Linux 进程概念</p><p>[toc]</p><h1 id="1-概念的理解"><a href="#1-概念的理解" class="headerlink" title="1 概念的理解"></a>1 概念的理解</h1><p>首先程序与进程是什么？程序与进程又有什么区别？</p><blockquote><p><strong>程序</strong>（procedure）：不太精确地说，程序就是执行一系列有逻辑、有顺序结构的指令，帮我们达成某个结果。就如我们去餐馆，给服务员说我要牛肉盖浇饭，她执行了做牛肉盖浇饭这么一个程序，最后我们得到了这么一盘牛肉盖浇饭。它需要去执行，不然它就像一本武功秘籍，放在那里等人翻看。</p></blockquote><blockquote><p><strong>进程</strong>（process）：进程是程序在一个数据集合上的一次执行过程，在早期的 UNIX、Linux 2.4 及更早的版本中，它是系统进行资源分配和调度的独立基本单位。同上一个例子，就如我们去了餐馆，给服务员说我要牛肉盖浇饭，她执行了做牛肉盖浇饭这么一个程序，而里面做饭的是一个进程，做牛肉汤汁的是一个进程，把牛肉汤汁与饭混合在一起的是一个进程，把饭端上桌的是一个进程。它就像是我们在看武功秘籍这么一个过程，然后一个篇章一个篇章地去练。</p></blockquote><p>简单来说，程序是为了完成某种任务而设计的软件，比如 vim 是程序。什么是进程呢？进程就是运行中的程序。</p><p>程序只是一些列指令的集合，是一个静止的实体，而进程不同，进程有以下的特性：</p><ul><li>动态性：进程的实质是一次程序执行的过程，有创建、撤销等状态的变化。而程序是一个静态的实体。</li><li>并发性：进程可以做到在一个时间段内，有多个程序在运行中。程序只是静态的实体，所以不存在并发性。</li><li>独立性：进程可以独立分配资源，独立接受调度，独立地运行。</li><li>异步性：进程以不可预知的速度向前推进。</li><li>结构性：进程拥有代码段、数据段、PCB（进程控制块，进程存在的唯一标志）。也正是因为有结构性，进程才可以做到独立地运行。</li></ul><blockquote><p><strong>并发：</strong>在一个时间段内，宏观来看有多个程序都在活动，有条不紊的执行（每一瞬间只有一个在执行，只是在一段时间有多个程序都执行过）</p></blockquote><blockquote><p><strong>并行：</strong>在每一个瞬间，都有多个程序都在同时执行，这个必须有多个 CPU 才行</p></blockquote><p>引入进程是因为传统意义上的程序已经不足以描述 OS 中各种活动之间的动态性、并发性、独立性还有相互制约性。程序就像一个公司，只是一些证书，文件的堆积（静态实体）。而当公司运作起来就有各个部门的区分，财务部，技术部，销售部等等，就像各个进程，各个部门之间可以独立运作，也可以有交互（独立性、并发性）。</p><p>而随着程序的发展越做越大，又会继续细分，从而引入了线程的概念，当代多数操作系统、Linux 2.6 及更新的版本中，进程本身不是基本运行单位，而是线程的容器。就像上述所说的，每个部门又会细分为各个工作小组（线程），而工作小组需要的资源需要向上级（进程）申请。</p><blockquote><p><strong>线程</strong>（thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。因为线程中几乎不包含系统资源，所以执行更快、更有效率。</p></blockquote><p>简而言之，一个程序至少有一个进程，一个进程至少有一个线程。线程的划分尺度小于进程，使得多线程程序的并发性高。另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。</p><h1 id="2-进程的属性"><a href="#2-进程的属性" class="headerlink" title="2 进程的属性"></a>2 进程的属性</h1><h2 id="2-1-进程的分类"><a href="#2-1-进程的分类" class="headerlink" title="2.1 进程的分类"></a>2.1 进程的分类</h2><p>大概明白进程是个什么样的存在后，我们需要进一步了解的就是进程分类。可以从两个角度来分：</p><ul><li>以进程的功能与服务的对象来分；</li><li>以应用程序的服务类型来分；</li></ul><p>第一个角度来看，我们可以分为用户进程与系统进程：</p><ul><li>用户进程：通过执行用户程序、应用程序或称之为内核之外的系统程序而产生的进程，此类进程可以在用户的控制下运行或关闭。</li><li>系统进程：通过执行系统内核程序而产生的进程，比如可以执行内存资源分配和进程切换等相对底层的工作；而且该进程的运行不受用户的干预，即使是 root 用户也不能干预系统进程的运行。</li></ul><p>第二角度来看，我们可以将进程分为交互进程、批处理进程、守护进程：</p><ul><li>交互进程：由一个 shell 终端启动的进程，在执行过程中，需要与用户进行交互操作，可以运行于前台，也可以运行在后台。</li><li>批处理进程：该进程是一个进程集合，负责按顺序启动其他的进程。</li><li>守护进程：守护进程是一直运行的一种进程，在 Linux 系统启动时启动，在系统关闭时终止。它们独立于控制终端并且周期性的执行某种任务或等待处理某些发生的事件。例如 httpd 进程，一直处于运行状态，等待用户的访问。还有经常用的 cron（在 centOS 系列为 crond）进程，这个进程为 crontab 的守护进程，可以周期性的执行用户设定的某些任务。</li></ul><h2 id="2-2-进程的衍生"><a href="#2-2-进程的衍生" class="headerlink" title="2.2 进程的衍生"></a>2.2 进程的衍生</h2><p>进程有这么多的种类，那么进程之间定是有相关性的，而这些有关联性的进程又是如何产生的，如何衍生的？</p><p>就比如我们启动了终端，就是启动了一个 bash 进程，我们可以在 bash 中再输入 bash 则会再启动一个 bash 的进程，此时第二个 bash 进程就是由第一个 bash 进程创建出来的，他们之间又是个什么关系？</p><p>我们一般称呼第一个 bash 进程是第二 bash 进程的父进程，第二 bash 进程是第一个 bash 进程的子进程，这层关系是如何得来的呢？</p><p>关于父进程与子进程便会提及这两个系统调用 <code>fork()</code> 与 <code>exec()</code></p><blockquote><p><strong>fork-exec</strong>是由 Dennis M. Ritchie 创造的</p></blockquote><blockquote><p><strong>fork()</strong> 是一个系统调用（system call），它的主要作用就是为当前的进程创建一个新的进程，这个新的进程就是它的子进程，这个子进程除了父进程的返回值和 PID 以外其他的都一模一样，如进程的执行代码段，内存信息，文件描述，寄存器状态等等</p></blockquote><blockquote><p><strong>exec()</strong> 也是系统调用，作用是切换子进程中的执行程序也就是替换其从父进程复制过来的代码段与数据段</p></blockquote><p>子进程就是父进程通过系统调用 <code>fork()</code> 而产生的复制品，<code>fork()</code> 就是把父进程的 PCB 等进程的数据结构信息直接复制过来，只是修改了 PID，所以一模一样，只有在执行 <code>exec()</code> 之后才会不同，而早先的 <code>fork()</code> 比较消耗资源后来进化成 <code>vfork()</code>，效率高了不少，感兴趣的同学可以查查为什么。</p><p>这就是子进程产生的由来。简单的实现逻辑就如下方所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> p;</span><br><span class="line"></span><br><span class="line">p = fork();</span><br><span class="line"><span class="keyword">if</span> (p == (<span class="type">pid_t</span>) <span class="number">-1</span>)</span><br><span class="line">        <span class="comment">/* ERROR */</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p == <span class="number">0</span>)</span><br><span class="line">        <span class="comment">/* CHILD */</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="comment">/* PARENT */</span></span><br></pre></td></tr></table></figure><p>既然子进程是通过父进程而衍生出来的，那么子进程的退出与资源的回收定然与父进程有很大的相关性。当一个子进程要正常的终止运行时，或者该进程结束时它的主函数 <code>main()</code> 会执行 <code>exit(n);</code> 或者 <code>return n</code>，这里的返回值 n 是一个信号，系统会把这个 SIGCHLD 信号传给其父进程，当然若是异常终止也往往是因为这个信号。</p><p>在将要结束时的子进程代码执行部分已经结束执行了，系统的资源也基本归还给系统了，但若是其进程的进程控制块（PCB）仍驻留在内存中，而它的 PCB 还在，代表这个进程还存在（因为 PCB 就是进程存在的唯一标志，里面有 PID 等消息），并没有消亡，这样的进程称之为僵尸进程（Zombie）。</p><p>如图中第四列标题是 S，S 表示的是进程的状态，而在下属的第三行的 Z 表示的是 Zombie 的意思。（ ps 命令将在后续详解）</p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469027998669.png" alt="实验楼" style="zoom:67%;" /><p>正常情况下，父进程会收到两个返回值：exit code（SIGCHLD 信号）与 <code>reason for termination</code> 。之后，父进程会使用 <code>wait(&amp;status)</code> 系统调用以获取子进程的退出状态，然后内核就可以从内存中释放已结束的子进程的 PCB；而如若父进程没有这么做的话，子进程的 PCB 就会一直驻留在内存中，一直留在系统中成为僵尸进程（Zombie）。</p><p>虽然僵尸进程是已经放弃了几乎所有内存空间，没有任何可执行代码，也不能被调度，在进程列表中保留一个位置，记载该进程的退出状态等信息供其父进程收集，从而释放它。但是 Linux 系统中能使用的 PID 是有限的，如果系统中存在有大量的僵尸进程，系统将会因为没有可用的 PID 从而导致不能产生新的进程。</p><p>另外如果父进程结束（非正常的结束），未能及时收回子进程，子进程仍在运行，这样的子进程称之为孤儿进程。在 Linux 系统中，孤儿进程一般会被 init 进程所“收养”，成为 init 的子进程。由 init 来做善后处理，所以它并不至于像僵尸进程那样无人问津，不管不顾，大量存在会有危害。</p><p>进程 0 是系统引导时创建的一个特殊进程，也称之为内核初始化，其最后一个动作就是调用 <code>fork()</code> 创建出一个子进程运行 <code>/sbin/init</code> 可执行文件，而该进程就是 PID&#x3D;1 的进程 1，而进程 0 就转为交换进程（也被称为空闲进程），进程 1 （init 进程）是第一个用户态的进程，再由它不断调用 fork() 来创建系统里其他的进程，所以它是所有进程的父进程或者祖先进程。同时它是一个守护程序，直到计算机关机才会停止。</p><p>通过以下的命令我们可以很明显的看到这样的结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081468836854017.png" alt="实验楼" style="zoom:67%;" /><p>或者从此图我们可以更加形象的看清子父进程的关系</p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469030455439.png" alt="实验楼" style="zoom:67%;" /><p>通过以上的显示结果我们可以看的很清楚，init 为所有进程的父进程或者说是祖先进程</p><p>我们还可以使用这样一个命令来看，其中 pid 就是该进程的一个唯一编号，ppid 就是该进程的父进程的 pid，command 表示的是该进程通过执行什么样的命令或者脚本而产生的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps －fxo user,ppid,pid,pgid,<span class="built_in">command</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/image-20230531114851845-168550493671759.png" alt="psfxo"></p><p>可以在图中看见我们执行的 ps 就是由 zsh 通过 fork-exec 创建的子进程而执行的</p><p>使用这样的一个命令我们也能清楚的看见 init 如上文所说是由进程 0 这个初始化进程来创建出来的子进程，而其他的进程基本是由 init 创建的子进程，或者是由它的子进程创建出来的子进程。所以 init 是用户进程的第一个进程也是所有用户进程的父进程或者祖先进程。（ps 命令将在后续课程详解）</p><p>就像一个树状图，而 init 进程就是这棵树的根，其他进程由根不断的发散，开枝散叶</p><h2 id="2-3-进程组与Sessions"><a href="#2-3-进程组与Sessions" class="headerlink" title="2.3 进程组与Sessions"></a>2.3 进程组与Sessions</h2><p>每一个进程都会是一个进程组的成员，而且这个进程组是唯一存在的，他们是依靠 PGID（process group ID）来区别的，而每当一个进程被创建的时候，它便会成为其父进程所在组中的一员。</p><p>一般情况，进程组的 PGID 等同于进程组的第一个成员的 PID，并且这样的进程称为该进程组的领导者，也就是领导进程，进程一般通过使用 <code>getpgrp()</code> 系统调用来寻找其所在组的 PGID，领导进程可以先终结，此时进程组依然存在，并持有相同的 PGID，直到进程组中最后一个进程终结。</p><p>与进程组类似，每当一个进程被创建的时候，它便会成为其父进程所在 Session 中的一员，每一个进程组都会在一个 Session 中，并且这个 Session 是唯一存在的，</p><p>Session 主要是针对一个 tty 建立，Session 中的每个进程都称为一个工作(job)。每个会话可以连接一个终端(control terminal)。当控制终端有输入输出时，都传递给该会话的前台进程组。Session 意义在于将多个 jobs 囊括在一个终端，并取其中的一个 job 作为前台，来直接接收该终端的输入输出以及终端信号。 其他 jobs 在后台运行。</p><blockquote><p><strong>前台</strong>（foreground）就是在终端中运行，能与你有交互的</p></blockquote><blockquote><p><strong>后台</strong>（background）就是在终端中运行，但是你并不能与其任何的交互，也不会显示其执行的过程</p></blockquote><h2 id="2-4-工作管理"><a href="#2-4-工作管理" class="headerlink" title="2.4 工作管理"></a>2.4 工作管理</h2><p>bash(Bourne-Again shell)支持工作控制（job control），而 sh（Bourne shell）并不支持。</p><p>并且每个终端或者说 bash 只能管理当前终端中的 job，不能管理其他终端中的 job。比如我当前存在两个 bash 分别为 bash1、bash2，bash1 只能管理其自己里面的 job 并不能管理 bash2 里面的 job</p><p>我们都知道当一个进程在前台运作时我们可以用 <code>ctrl + c</code> 来终止它，但是若是在后台的话就不行了。</p><p>我们可以通过 <code>&amp;</code> 这个符号，让我们的命令在后台中运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> &amp;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469036077882.png" alt="实验楼" style="zoom:67%;" /><p>图中所显示的 <code>[1] 236</code>分别是该 job 的 job number 与该进程的 PID，而最后一行的 Done 表示该命令已经在后台执行完毕。</p><p>我们还可以通过 <code>ctrl + z</code> 使我们的当前工作停止并丢到后台中去</p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469036715105.png" alt="实验楼" style="zoom:67%;" /><p>被停止并放置在后台的工作我们可以使用这个命令来查看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">jobs</span></span><br></pre></td></tr></table></figure><img src="15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469037134869.png" alt="实验楼" style="zoom:67%;" /><p>其中第一列显示的为被放置后台 job 的编号，而第二列的 <code>＋</code> 表示最近(刚刚、最后)被放置后台的 job，同时也表示预设的工作，也就是若是有什么针对后台 job 的操作，首先对预设的 job，<code>-</code> 表示倒数第二（也就是在预设之前的一个）被放置后台的工作，倒数第三个（再之前的）以后都不会有这样的符号修饰，第三列表示它们的状态，而最后一列表示该进程执行的命令。</p><p>我们可以通过这样的一个命令将后台的工作拿到前台来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后面不加参数提取预设工作，加参数提取指定工作的编号</span></span><br><span class="line"><span class="comment"># ubuntu 在 zsh 中需要 %，在 bash 中不需要 %</span></span><br><span class="line"><span class="built_in">fg</span> [%jobnumber]</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469037555070.png" alt="实验楼" style="zoom:67%;" /><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469037666320.png" alt="实验楼" style="zoom:67%;" /><p>之前我们通过 <code>ctrl + z</code> 使得工作停止放置在后台，若是我们想让其在后台运作我们就使用这样一个命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#与fg类似，加参则指定，不加参则取预设</span></span><br><span class="line"><span class="built_in">bg</span> [%jobnumber]</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469037983282.png" alt="实验楼" style="zoom:67%;" /><p>既然有方法将被放置在后台的工作提至前台或者让它从停止变成继续运行在后台，当然也有方法删除一个工作，或者重启等等。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kill的使用格式如下</span></span><br><span class="line"><span class="built_in">kill</span> -signal %jobnumber</span><br><span class="line"></span><br><span class="line"><span class="comment"># signal从1-64个信号值可以选择，可以这样查看</span></span><br><span class="line"><span class="built_in">kill</span> －l</span><br></pre></td></tr></table></figure><p>其中常用的有这些信号值</p><table><thead><tr><th>信号值</th><th>作用</th></tr></thead><tbody><tr><td>-1</td><td>重新读取参数运行，类似与 restart</td></tr><tr><td>-2</td><td>如同 ctrl+c 的操作退出</td></tr><tr><td>-9</td><td>强制终止该任务</td></tr><tr><td>-15</td><td>正常的方式终止该任务</td></tr></tbody></table><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/images/15%20Linux%20%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/1135081469038840624.png" alt="实验楼" style="zoom:67%;" /><blockquote><p>若是在使用 kill ＋信号值然后直接加 pid，你将会对 pid 对应的进程进行操作。</p></blockquote><blockquote><p>若是在使用 kill+信号值然后 <code>％jobnumber</code>，这时所操作的对象是 job，这个数字就是就当前 bash 中后台的运行的 job 的 ID。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux基础入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 进程与程序 </tag>
            
            <tag> 进程的衍生 </tag>
            
            <tag> 工作管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux 内核1 完成一个简单的时间片轮转躲到程序内核代码</title>
      <link href="/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/1%20%E5%AE%8C%E6%88%90%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%BA%B2%E5%88%B0%E7%A8%8B%E5%BA%8F%E5%86%85%E6%A0%B8%E4%BB%A3%E7%A0%81/"/>
      <url>/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/1%20%E5%AE%8C%E6%88%90%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%BA%B2%E5%88%B0%E7%A8%8B%E5%BA%8F%E5%86%85%E6%A0%B8%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>使用实验楼的虚拟机打开 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意路径是区分大小的</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/LinuxKernel/linux-3.9.4</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">rm</span> -rf mykernel</span><br><span class="line"></span><br><span class="line">$ patch -p1 &lt; ../mykernel_for_linux3.9.4sc.patch</span><br><span class="line"></span><br><span class="line">$ make allnoconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译内核请耐心等待</span></span><br><span class="line">$ make</span><br><span class="line"></span><br><span class="line">$ qemu -kernel <span class="built_in">arch</span>/x86/boot/bzImage</span><br></pre></td></tr></table></figure><p>然后 <code>cd mykernel</code> 您可以看到 qemu 窗口输出的内容的代码 <code>mymain.c</code> 和 <code>myinterrupt.c</code></p><p>注意：修改代码后需要 make 重新编译之后才能生效哦。</p><p>使用自己的 Linux 系统环境搭建过程参见 <a href="https://github.com/mengning/mykernel/tree/4b59d452b7812560151c5684ce9a07bcaddb3127">mykernel</a>，其中也可以找到一个简单的时间片轮转多道程序内核代码</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux内核分析配套实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 内核 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux终端工具——zsh</title>
      <link href="/OS/Linux/Command&amp;Tools/zsh/"/>
      <url>/OS/Linux/Command&amp;Tools/zsh/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="zsh安装"><a href="#zsh安装" class="headerlink" title="zsh安装"></a>zsh安装</h1><ol><li>查看当前系统装了哪些shell</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shell</span><br></pre></td></tr></table></figure><ol start="2"><li>当前正在运行的是哪个版本的shell</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><ol start="3"><li>安装zsh</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install zsh</span><br></pre></td></tr></table></figure><ol start="4"><li>切换zsh</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/zsh（非实时，需重启）</span><br></pre></td></tr></table></figure><ol start="5"><li>查看zsh的主题有哪些</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls ~/.oh-my-zsh/themes/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Command&amp;Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
            <tag> zsh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux内核2 跟踪分析Linux内核的启动过程</title>
      <link href="/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/2%20%E8%B7%9F%E8%B8%AA%E5%88%86%E6%9E%90Linux%E5%86%85%E6%A0%B8%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"/>
      <url>/OS/Linux/Linux%E5%86%85%E6%A0%B8%E5%88%86%E6%9E%90%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C/2%20%E8%B7%9F%E8%B8%AA%E5%88%86%E6%9E%90Linux%E5%86%85%E6%A0%B8%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>使用实验楼的虚拟机打开 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/LinuxKernel/</span><br><span class="line">qemu -kernel linux-3.18.6/arch/x86/boot/bzImage -initrd rootfs.img</span><br></pre></td></tr></table></figure><p>内核启动完成后进入 <a href="https://github.com/mengning/menu">menu</a>程序（<a href="http://mooc.study.163.com/course/YOOKCS0008-1000002006">《软件工程 C 编码实践篇》的课程项目</a>），支持三个命令 help、version 和 quit，您也可以添加更多的命令，对选修过《软件工程 C 编码实践篇》的童鞋应该是 a piece of cake.</p><p>使用 gdb 跟踪调试内核</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ qemu -kernel linux-3.18.6/arch/x86/boot/bzImage -initrd rootfs.img -s -S</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关于-s和-S选项的说明：</span></span><br><span class="line"><span class="comment"># 1. -S</span></span><br><span class="line"><span class="comment">#   -S freeze CPU at startup (use ’c’ to start execution)</span></span><br><span class="line"><span class="comment"># 2. -s</span></span><br><span class="line"><span class="comment">#   -s shorthand for -gdb tcp::1234</span></span><br><span class="line"><span class="comment"># 若不想使用1234端口，则可以使用-gdb tcp:xxxx来取代-s选项</span></span><br></pre></td></tr></table></figure><p>另开一个 shell 窗口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开 GDB 调试器</span></span><br><span class="line">$ gdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 GDB 中输入以下命令：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在gdb界面中targe remote之前加载符号表</span></span><br><span class="line">（gdb）file linux-3.18.6/vmlinux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立gdb和gdbserver之间的连接,按c 让qemu上的Linux继续运行</span></span><br><span class="line">（gdb）target remote:1234</span><br><span class="line"></span><br><span class="line"><span class="comment"># 断点的设置可以在target remote之前，也可以在之后</span></span><br><span class="line">（gdb）<span class="built_in">break</span> start_kernel</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Linux内核分析配套实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 内核 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux防火墙命令——ufw</title>
      <link href="/OS/Linux/Command&amp;Tools/ufw/"/>
      <url>/OS/Linux/Command&amp;Tools/ufw/</url>
      
        <content type="html"><![CDATA[<p>防火墙是计算机安全的重要组成部分。在Linux中，UFW（Uncomplicated Firewall）是一个开源防火墙工具，可用于实现网络安全策略。它提供了一个简化的命令行接口，使得设置防火墙规则更加容易。在本文中，我们将介绍如何在Linux上使用UFW实现防火墙和安全策略。</p><p>[toc]</p><h1 id="安装UFW"><a href="#安装UFW" class="headerlink" title="安装UFW"></a>安装UFW</h1><p>许多Linux发行版都默认安装了UFW。如果你的Linux发行版没有安装，你可以使用以下命令来安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ufw <span class="comment"># Ubuntu和Debian</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install ufw <span class="comment"># CentOS和Fedora</span></span><br></pre></td></tr></table></figure><h1 id="设置UFW规则"><a href="#设置UFW规则" class="headerlink" title="设置UFW规则"></a>设置UFW规则</h1><p>在使用UFW之前，必须启用它。使用以下命令来启用UFW：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><p>默认情况下，UFW将拒绝所有传入连接和允许所有传出连接。要添加其他规则，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow [port]/[protocol]</span><br></pre></td></tr></table></figure><p>例如，启用SSH连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow ssh</span><br></pre></td></tr></table></figure><p>默认情况下，UFW假定TCP协议。如果要允许其他协议，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow [port]/[protocol]</span><br></pre></td></tr></table></figure><p>例如，启用UDP连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow 53/udp</span><br></pre></td></tr></table></figure><p>您还可以使用其他选项指定源地址，目标地址和应用程序。</p><h1 id="限制IP访问"><a href="#限制IP访问" class="headerlink" title="限制IP访问"></a>限制IP访问</h1><p>除了端口，还可以使用UFW限制对特定IP的访问。例如，要拒绝来自IP地址为192.168.1.100的所有连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw deny from 192.168.1.100</span><br></pre></td></tr></table></figure><p>或者，要允许仅该IP地址访问您的网站：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow from 192.168.1.100 to any port 80</span><br></pre></td></tr></table></figure><h1 id="修改默认策略"><a href="#修改默认策略" class="headerlink" title="修改默认策略"></a>修改默认策略</h1><p>您可以通过修改默认策略来更改UFW的行为。要允许所有传入连接并拒绝所有传出连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny outgoing</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default allow incoming</span><br></pre></td></tr></table></figure><p>或者，要拒绝所有传入连接并允许所有传出连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default allow outgoing</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny incoming</span><br></pre></td></tr></table></figure><h1 id="撤消规则"><a href="#撤消规则" class="headerlink" title="撤消规则"></a>撤消规则</h1><p>如果您需要删除规则，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw delete [规则号]</span><br></pre></td></tr></table></figure><p>规则号是规则列表中的数字序号，从1开始。</p><h1 id="禁用UFW"><a href="#禁用UFW" class="headerlink" title="禁用UFW"></a>禁用UFW</h1><p>要禁用UFW并删除所有规则，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw reset</span><br></pre></td></tr></table></figure><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>在Linux上使用UFW可以轻松实现防火墙和安全策略。UFW提供了一种简单的方式来控制入站和出站流量，并且易于使用和配置。通过设置良好的规则，可以增强系统的安全性。</p>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Command&amp;Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 防火墙 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux查询是否安装了某个软件</title>
      <link href="/OS/Linux/Command&amp;Tools/Linux%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%9F%90%E4%B8%AA%E8%BD%AF%E4%BB%B6/"/>
      <url>/OS/Linux/Command&amp;Tools/Linux%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%9F%90%E4%B8%AA%E8%BD%AF%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>1、rpm包安装的，可以用rpm -qa看到，如果要查找某软件包是否安装，用 rpm -qa | <a href="https://so.csdn.net/so/search?q=grep&spm=1001.2101.3001.7020">grep</a> “软件或者包的名字”。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep ruby</span><br></pre></td></tr></table></figure><p>2、以deb包安装的，可以用dpkg -l能看到。如果是查找指定软件包，用dpkg -l | grep “软件或者包的名字”；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep ruby</span><br></pre></td></tr></table></figure><p>3、yum方法安装的，可以用yum list installed查找，如果是查找指定包，命令后加 | grep “软件名或者包名”；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list installed | grep ruby</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Command&amp;Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 查询 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ls命令详解</title>
      <link href="/OS/Linux/Command&amp;Tools/ls/"/>
      <url>/OS/Linux/Command&amp;Tools/ls/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><blockquote><p>ls :列出文件或者目录</p></blockquote><ul><li><code>-l</code>，使用长格式显示</li><li><code>-a</code>，显示文件名以<code>.</code>开头的隐藏文件</li><li><code>-h</code>，以human易读格式显示，主要是看容量的时候使用<code>KB</code> <code>MB</code> <code>GB</code>，指当前文件夹目录的大小</li><li><code>-lh</code> ,文件或者目录大小的, 方便识别</li><li><code>-lhS</code> ,文件从大到小排序</li><li><code>-lg</code> ,不打印所有者信息</li><li><code>-ln</code> ,打印UID和GID</li><li><code>-l --si</code> si以1000为单位，而-h以1024为单位。</li><li><code>-l --block-size=M</code>: 设置文件显示单位</li><li><code>-li</code>，显示inode号</li><li><code>-r</code>，reverse，改变归类的顺序，例如和-t配合使用，-tr和-t显示顺序是颠倒的。</li><li><code>-R</code>，递归列出子目录</li><li><code>-lX/ -l --sort=extension</code>：扩展名排序</li><li><code>-t</code>，按照修改时间顺序归类文件。</li><li><code>-d</code>，列出目录本身的信息，而不是目录里边的内容。</li></ul><h1 id="字节"><a href="#字节" class="headerlink" title="字节"></a>字节</h1><blockquote><p>字节相关单位：</p></blockquote><p>K &#x3D; Kilobyte 千字节<br>M &#x3D; Megabyte 兆字节<br>G &#x3D; Gigabyte 十亿字节<br>T &#x3D; Terabyte 兆兆字节<br>P &#x3D; Petabyte 10的15次方字节<br>E &#x3D; Exabyte 艾字节<br>Z &#x3D; Zettabyte 泽它字节或皆字节<br>Y &#x3D; Yottabyte 尧字节</p><h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><ul><li><p><code>-a</code>: 显示所有档案以及目录（ls内定将档案或目录名称为“.&#x2F;..”的视为隐藏）</p></li><li><p><code>-A</code>: 显示除隐藏文件“.&#x2F;..”以外的所有文件列表</p></li><li><p><code>-b</code>: 将文件中的不可输出的字符以反斜线加字符编码的方式输出</p></li><li><p><code>-c</code> : 与”-lt“ 选项连用时，按照文件状态时间排序输出目录内容， 排序的依据是文件的索引节点中的ctime 字段。 与”-l“连用时，排序的依据是文件的状态改变时间。</p></li><li><p><code>-C</code>: 多列显示输出结果（只有文件名信息）</p></li><li><p><code>-d</code> : 仅显示目录名，而不显示目录下的内容列表， 显示符号链接文件本身， 而不显示其指定的目录列表。</p></li><li><p><code>-F</code>:  在每个输出项后最佳文件的类型标识符， * 可执行权限的普通文件，&#x2F; 表示目录， @ 表示符号链接，|表示命令管道， &#x3D; 表示sockets 套接字，  普通文件不输出标识符。</p></li><li><p><code>-h</code>: 以human易读格式显示， 文件大小以kb,mb显示</p></li><li><p><code>-i</code> :  显示文件索引节点号（inode）,一个索引节点代表一个文件</p></li><li><p><code>-l </code>: 以长格式显示目录下的内容列表，输出信息：文件名，文件类型，权限模式，硬链接数，所有者，组，文件大小， 文件最后修改时间。<span style="border-bottom: 2px dashed #000000"> <code>ls - l</code> 命令就是常用 <code>ll</code></span></p></li><li><p><code>-L </code>: 如果遇到性质为符号链接的文件或目录， 直接列出该链接所造的原始文件或目录</p></li><li><p><code>-m</code>: 以逗号分隔每个文件和目录的名称</p></li><li><p><code>-n</code> : 以用户标志码和群组识别码替代其名称uid &#x2F;gid</p></li><li><p><code>-r</code> : 以文件名反序排序并输出目录内容列表</p></li><li><p><code>-R</code>：递归处理，将制定目录下的所有文件及子目录一并处理</p></li><li><p><code>-s</code> : 显示文件和目录的大小， 以区块为单位</p></li><li><p><code>-t</code> : 用文件和目录的更改时间排序</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Linux </category>
          
          <category> Command&amp;Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2352. 相等行列对 - 力扣（LeetCode）</title>
      <link href="/LeetCode/2352.%20%E7%9B%B8%E7%AD%89%E8%A1%8C%E5%88%97%E5%AF%B9/"/>
      <url>/LeetCode/2352.%20%E7%9B%B8%E7%AD%89%E8%A1%8C%E5%88%97%E5%AF%B9/</url>
      
        <content type="html"><![CDATA[<p>2023_06_06</p><p>[toc]</p><h1 id="2352-相等行列对-力扣（LeetCode）"><a href="#2352-相等行列对-力扣（LeetCode）" class="headerlink" title="2352. 相等行列对 - 力扣（LeetCode）"></a><a href="https://leetcode.cn/problems/equal-row-and-column-pairs/">2352. 相等行列对 - 力扣（LeetCode）</a></h1><p>给你一个下标从 0 开始、大小为 n x n 的整数矩阵 grid ，返回满足 Ri 行和 Cj 列相等的行列对 (Ri, Cj) 的数目。</p><p>如果行和列以相同的顺序包含相同的元素（即相等的数组），则认为二者是相等的。</p><p> </p><p>示例 1：</p><p><img src="https://img2023.cnblogs.com/blog/2166070/202306/2166070-20230606232015247-2005756878.png" alt="img"></p><p>输入：grid &#x3D; [[3,2,1],[1,7,6],[2,7,7]]<br>输出：1<br>解释：存在一对相等行列对：</p><ul><li>(第 2 行，第 1 列)：[2,7,7]</li></ul><p>示例 2：</p><p><img src="https://img2023.cnblogs.com/blog/2166070/202306/2166070-20230606232037353-1792537934.png" alt="img"></p><p>输入：grid &#x3D; [[3,1,2,2],[1,4,4,5],[2,4,2,2],[2,4,2,2]]<br>输出：3<br>解释：存在三对相等行列对：</p><ul><li>(第 0 行，第 0 列)：[3,1,2,2]</li><li>(第 2 行, 第 2 列)：[2,4,2,2]</li><li>(第 3 行, 第 2 列)：[2,4,2,2]</li></ul><p> </p><p>提示：</p><p>n &#x3D;&#x3D; grid.length &#x3D;&#x3D; grid[i].length<br>1 &lt;&#x3D; n &lt;&#x3D; 200<br>1 &lt;&#x3D; grid[i][j] &lt;&#x3D; 105</p><p>来源：力扣（LeetCode）<br>链接：<a href="https://leetcode.cn/problems/equal-row-and-column-pairs">https://leetcode.cn/problems/equal-row-and-column-pairs</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="cpp"><a href="#cpp" class="headerlink" title="cpp"></a>cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">equalPairs</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>, n = grid.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; n; row++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; n; col++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">equal</span>(row, col, grid))</span><br><span class="line">                &#123;</span><br><span class="line">                    res++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> col, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;grid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = grid.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[row][i] != grid[i][col])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">equalPairs</span><span class="params">(grid [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(grid)</span><br><span class="line">    cnt := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _,row := <span class="keyword">range</span> grid &#123;</span><br><span class="line">        cnt[fmt.Sprint(row)]++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">        <span class="keyword">var</span> arr[] <span class="type">int</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">            arr = <span class="built_in">append</span>(arr, grid[i][j])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> val,ok := cnt[fmt.Sprint(arr)]; ok &#123;</span><br><span class="line">            res += val</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 数据 </tag>
            
            <tag> 哈希表 </tag>
            
            <tag> 矩阵 </tag>
            
            <tag> 模拟 </tag>
            
            <tag> Go </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2611. 老鼠和奶酪</title>
      <link href="/LeetCode/2611.%20%E8%80%81%E9%BC%A0%E5%92%8C%E5%A5%B6%E9%85%AA/"/>
      <url>/LeetCode/2611.%20%E8%80%81%E9%BC%A0%E5%92%8C%E5%A5%B6%E9%85%AA/</url>
      
        <content type="html"><![CDATA[<p>2023年6月7日23:18:51</p><p>[toc]</p><h1 id="2611-老鼠和奶酪-力扣（LeetCode）"><a href="#2611-老鼠和奶酪-力扣（LeetCode）" class="headerlink" title="2611. 老鼠和奶酪 - 力扣（LeetCode）"></a><a href="https://leetcode.cn/problems/mice-and-cheese/">2611. 老鼠和奶酪 - 力扣（LeetCode）</a></h1><p>有两只老鼠和 n 块不同类型的奶酪，每块奶酪都只能被其中一只老鼠吃掉。</p><p>下标为 i 处的奶酪被吃掉的得分为：</p><p>如果第一只老鼠吃掉，则得分为 reward1[i] 。<br>如果第二只老鼠吃掉，则得分为 reward2[i] 。<br>给你一个正整数数组 reward1 ，一个正整数数组 reward2 ，和一个非负整数 k 。</p><p>请你返回第一只老鼠恰好吃掉 k 块奶酪的情况下，最大 得分为多少。</p><p> </p><p>示例 1：</p><p>输入：reward1 &#x3D; [1,1,3,4], reward2 &#x3D; [4,4,1,1], k &#x3D; 2<br>输出：15<br>解释：这个例子中，第一只老鼠吃掉第 2 和 3 块奶酪（下标从 0 开始），第二只老鼠吃掉第 0 和 1 块奶酪。<br>总得分为 4 + 4 + 3 + 4 &#x3D; 15 。<br>15 是最高得分。<br>示例 2：</p><p>输入：reward1 &#x3D; [1,1], reward2 &#x3D; [1,1], k &#x3D; 2<br>输出：2<br>解释：这个例子中，第一只老鼠吃掉第 0 和 1 块奶酪（下标从 0 开始），第二只老鼠不吃任何奶酪。<br>总得分为 1 + 1 &#x3D; 2 。<br>2 是最高得分。 </p><p>提示：</p><p>1 &lt;&#x3D; n &#x3D;&#x3D; reward1.length &#x3D;&#x3D; reward2.length &lt;&#x3D; 105<br>1 &lt;&#x3D; reward1[i], reward2[i] &lt;&#x3D; 1000<br>0 &lt;&#x3D; k &lt;&#x3D; n</p><p>来源：力扣（LeetCode）<br>链接：<a href="https://leetcode.cn/problems/mice-and-cheese">https://leetcode.cn/problems/mice-and-cheese</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><ol><li>思路<br><strong>贪心 + 排序</strong></li></ol><p>算出差值，取K 个最大值即可</p><ol><li>代码</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">miceAndCheese</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; reward1, vector&lt;<span class="type">int</span>&gt;&amp; reward2, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = reward1.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">diffs</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ans += reward2[i];</span><br><span class="line">            diffs[i] = reward1[i] - reward2[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sort</span>(diffs.<span class="built_in">begin</span>(), diffs.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;=k; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ans += diffs[n-i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">miceAndCheese</span><span class="params">(reward1 []<span class="type">int</span>, reward2 []<span class="type">int</span>, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    ans := <span class="number">0</span></span><br><span class="line">    n := <span class="built_in">len</span>(reward1)</span><br><span class="line"></span><br><span class="line">    diffs := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;n; i++ &#123;</span><br><span class="line">        ans += reward2[i]</span><br><span class="line">        diffs[i] = reward1[i] - reward2[i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort.Ints(diffs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;=k; i++ &#123;</span><br><span class="line">        ans += diffs[n-i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1706. 球会落何处 - 力扣（LeetCode）</title>
      <link href="/LeetCode/1706.%20%E7%90%83%E4%BC%9A%E8%90%BD%E4%BD%95%E5%A4%84/"/>
      <url>/LeetCode/1706.%20%E7%90%83%E4%BC%9A%E8%90%BD%E4%BD%95%E5%A4%84/</url>
      
        <content type="html"><![CDATA[<p>2022_02_24</p><p>[toc]</p><h1 id="1706-球会落何处"><a href="#1706-球会落何处" class="headerlink" title="1706. 球会落何处"></a><a href="https://leetcode-cn.com/problems/where-will-the-ball-fall/">1706. 球会落何处</a></h1><p>用一个大小为 <code>m x n</code> 的二维网格 <code>grid</code> 表示一个箱子。你有 <code>n</code> 颗球。箱子的顶部和底部都是开着的。</p><p>箱子中的每个单元格都有一个对角线挡板，跨过单元格的两个角，可以将球导向左侧或者右侧。</p><ul><li>将球导向右侧的挡板跨过左上角和右下角，在网格中用 <code>1</code> 表示。</li><li>将球导向左侧的挡板跨过右上角和左下角，在网格中用 <code>-1</code> 表示。</li></ul><p>在箱子每一列的顶端各放一颗球。每颗球都可能卡在箱子里或从底部掉出来。如果球恰好卡在两块挡板之间的 “V” 形图案，或者被一块挡导向到箱子的任意一侧边上，就会卡住。</p><p>返回一个大小为 <code>n</code> 的数组 <code>answer</code> ，其中 <code>answer[i]</code> 是球放在顶部的第 <code>i</code> 列后从底部掉出来的那一列对应的下标，如果球卡在盒子里，则返回 <code>-1</code> 。</p><p><strong>示例 1：</strong></p><p><strong><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/12/26/ball.jpg"></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输入：grid = [[1,1,1,-1,-1],[1,1,1,-1,-1],[-1,-1,-1,1,1],[1,1,1,1,-1],[-1,-1,-1,-1,-1]]</span><br><span class="line">输出：[1,-1,-1,-1,-1]</span><br><span class="line">解释：示例如图：</span><br><span class="line">b0 球开始放在第 0 列上，最终从箱子底部第 1 列掉出。</span><br><span class="line">b1 球开始放在第 1 列上，会卡在第 2、3 列和第 1 行之间的 &quot;V&quot; 形里。</span><br><span class="line">b2 球开始放在第 2 列上，会卡在第 2、3 列和第 0 行之间的 &quot;V&quot; 形里。</span><br><span class="line">b3 球开始放在第 3 列上，会卡在第 2、3 列和第 0 行之间的 &quot;V&quot; 形里。</span><br><span class="line">b4 球开始放在第 4 列上，会卡在第 2、3 列和第 1 行之间的 &quot;V&quot; 形里。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：grid = [[-1]]</span><br><span class="line">输出：[-1]</span><br><span class="line">解释：球被卡在箱子左侧边上。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：grid = [[1,1,1,1,1,1],[-1,-1,-1,-1,-1,-1],[1,1,1,1,1,1],[-1,-1,-1,-1,-1,-1]]</span><br><span class="line">输出：[0,1,2,3,4,-1]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>m == grid.length</code></li><li><code>n == grid[i].length</code></li><li><code>1 &lt;= m, n &lt;= 100</code></li><li><code>grid[i][j]</code> 为 <code>1</code> 或 <code>-1</code></li></ul><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>思路</p><p>我们依次判断每个球的最终位置。对于每个球，从上至下判断球位置的移动方向。在对应的位置，如果挡板向右偏，则球会往右移动；如果挡板往左偏，则球会往左移动。若移动过程中碰到侧边或者 \text{V}V 型，则球会停止移动，卡在箱子里。如果可以完成本层的移动，则继续判断下一层的移动方向，直到落出箱子或者卡住。</p><p>作者：LeetCode-Solution<br>链接：<a href="https://leetcode-cn.com/problems/where-will-the-ball-fall/solution/qiu-hui-luo-he-chu-by-leetcode-solution-xqop/">https://leetcode-cn.com/problems/where-will-the-ball-fall/solution/qiu-hui-luo-he-chu-by-leetcode-solution-xqop/</a><br>来源：力扣（LeetCode）<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findBall</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = grid[<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">//箱子的列数</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123; <span class="comment">//分别求每个球掉到底部的位置下标</span></span><br><span class="line">            <span class="type">int</span> col = i; <span class="comment">//col表示球在下降过程中的纵坐标</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; row : grid)&#123; <span class="comment">//分别求出球掉到每层的位置</span></span><br><span class="line">                <span class="type">int</span> dir = row[col];　<span class="comment">//dir表示球在下降过程中向左或向右下降</span></span><br><span class="line">                col += dir; <span class="comment">//更新球在下一层的纵坐标,向右移动(纵坐标加1)/向左移动(纵坐标减1)</span></span><br><span class="line">                <span class="keyword">if</span>(col &lt; <span class="number">0</span> || col == n || row[col] != dir )&#123; <span class="comment">//row[col]表示球将要移动的方向上挡板的布置情况,dir表示当前球的移动方向，两者方向不一致会形成夹角</span></span><br><span class="line">                    col = <span class="number">-1</span>;　<span class="comment">//当形成夹角或被挡在箱子侧边时,球将会卡在盒子里,所以该球下降的结果值直接赋值为-1;</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ans[i] = col; <span class="comment">//col表示每个球掉落到底部的位置,即为结果值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">​<span class="function"><span class="keyword">func</span> <span class="title">findBall</span><span class="params">(grid [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(grid[<span class="number">0</span>])</span><br><span class="line">    ans := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j := <span class="keyword">range</span> ans &#123;</span><br><span class="line">        col := j <span class="comment">// 球的初始列</span></span><br><span class="line">        <span class="keyword">for</span> _, row := <span class="keyword">range</span> grid &#123;</span><br><span class="line">            dir := row[col]</span><br><span class="line">            col += dir <span class="comment">// 移动球</span></span><br><span class="line">            <span class="keyword">if</span> col &lt; <span class="number">0</span> || col == n || row[col] != dir &#123; <span class="comment">// 到达侧边或V型</span></span><br><span class="line">                col = <span class="number">-1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans[j] = col <span class="comment">// col &gt;= 0 为成功到达底部</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> 矩阵 </tag>
            
            <tag> 模拟 </tag>
            
            <tag> Go </tag>
            
            <tag> C/C++ </tag>
            
            <tag> 数组 </tag>
            
            <tag> 深度优先搜索 </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCP/IP的四元组、五元组、七元组</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E5%9B%9B%E5%85%83%E7%BB%84%E3%80%81%E4%BA%94%E5%85%83%E7%BB%84%E3%80%81%E4%B8%83%E5%85%83%E7%BB%84/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E5%9B%9B%E5%85%83%E7%BB%84%E3%80%81%E4%BA%94%E5%85%83%E7%BB%84%E3%80%81%E4%B8%83%E5%85%83%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h1 id="TCP-x2F-IP的四元组、五元组、七元组"><a href="#TCP-x2F-IP的四元组、五元组、七元组" class="headerlink" title="TCP&#x2F;IP的四元组、五元组、七元组"></a>TCP&#x2F;IP的四元组、五元组、七元组</h1><p>四元组是：</p><p>　　源IP地址、目的IP地址、源端口、目的端口</p><p>五元组是：</p><p>　　源IP地址、目的IP地址、<strong>协议号</strong>、源端口、目的端口</p><p>七元组是：</p><p>　　源IP地址、目的IP地址、协议号、源端口、目的端口、<strong>服务类型</strong>、<strong>接口索引</strong></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>socket 长连接</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/windows%20Socket%E9%95%BF%E8%BF%9E%E6%8E%A5/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/windows%20Socket%E9%95%BF%E8%BF%9E%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">BOOL _KeepAlive(SP_SOCKET fd)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//定义结构及宏</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KeepAlive</span></span><br><span class="line">&#123;</span><br><span class="line">u_long onoff;</span><br><span class="line">u_long keepalivetime;</span><br><span class="line">u_long keepaliveinterval;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIO_KEEPALIVE_VALS _WSAIOW(IOC_VENDOR,4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//KeepAlive实现</span></span><br><span class="line">KeepAlive inKeepAlive = &#123; <span class="number">0</span> &#125;; <span class="comment">//输入参数</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulInLen = <span class="built_in">sizeof</span>(KeepAlive);</span><br><span class="line"></span><br><span class="line">KeepAlive outKeepAlive = &#123; <span class="number">0</span> &#125;; <span class="comment">//输出参数</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulOutLen = <span class="built_in">sizeof</span>(KeepAlive);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> ulBytesReturn = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//keepalive xp以前的系统发送5次，xp之后的系统发送10</span></span><br><span class="line">inKeepAlive.onoff = <span class="number">1</span>;</span><br><span class="line">inKeepAlive.keepaliveinterval = <span class="number">5000</span>; <span class="comment">//两次KeepAlive探测间的时间间隔</span></span><br><span class="line">inKeepAlive.keepalivetime = <span class="number">5000</span>; <span class="comment">//开始首次KeepAlive探测前的TCP空闭时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WSAIoctl</span>((SOCKET)fd, SIO_KEEPALIVE_VALS,</span><br><span class="line">(LPVOID)&amp;inKeepAlive, ulInLen,</span><br><span class="line">(LPVOID)&amp;outKeepAlive, ulOutLen,</span><br><span class="line">&amp;ulBytesReturn, <span class="literal">NULL</span>, <span class="literal">NULL</span>) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">LOGT</span>(<span class="string">&quot;Set Keep Alive FAILED.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">LOGT</span>(<span class="string">&quot;Set Keep Alive OK.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> socket </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcp.flags 说明</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/tcp/tcp.flags/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/tcp/tcp.flags/</url>
      
        <content type="html"><![CDATA[<h1 id="tcp-flags-说明"><a href="#tcp-flags-说明" class="headerlink" title="tcp.flags 说明"></a>tcp.flags 说明</h1><p>在Wireshark的过滤器中,tcp.flags可以用于过滤各种TCP标志位。它包含以下项目:</p><ul><li><p>SYN: 标志位SYN&#x3D;1,用于TCP三次握手中的 SYN 数据包,请求建立连接</p></li><li><p>ACK: 标志位ACK&#x3D;1,确认接收到的数据</p></li><li><p>FIN: 标志位FIN&#x3D;1,请求关闭连接</p></li><li><p>RST: 标志位RST&#x3D;1,重置连接</p></li><li><p>PSH: 标志位PSH&#x3D;1,接收方应立即传送此报文的数据,而不等待其他数据</p></li><li><p>URG: 标志位URG&#x3D;1,此报文包含紧急数据</p></li><li><p>ECE: ECN Echo, 标志位ECE&#x3D;1,回复ECN设置的通知</p></li><li><p>CWR: Congestion Window Reduced,标志位CWR&#x3D;1,通知发送方拥塞窗口已经减少</p></li></ul><p>这些标志位可以单独使用,也可以组合使用。例如:</p><ul><li><p>SYN+ACK: 服务端响应的SYN+ACK数据包,同意建立连接并确认SYN</p></li><li><p>FIN+ACK: 确认对端的FIN的数据包,同时自身也请求关闭连接</p></li></ul><p>在Wireshark的过滤器中,可以使用这些标志位进行过滤,例如:- SYN 过滤SYN数据包</p><ul><li><p>ACK 过滤ACK数据包 </p></li><li><p>FIN 过滤FIN数据包</p></li><li><p>RST 过滤RST数据包</p></li><li><p>tcp.flags.syn&#x3D;&#x3D;1 过滤SYN标志位为1的数据包</p></li><li><p>tcp.flags.syn&#x3D;&#x3D; &amp;&amp; tcp.flags.ack&#x3D;&#x3D;1 过滤同时包含SYN和ACK标志位的数据包</p></li></ul><p>通过过滤不同的标志位或标志位组合,可以分析出TCP连接的握手、数据传输和释放过程。当然,除了这些标志位外,过滤器中 tcp 还包含其他字段,例如:- srcport 源端口<br>  - dstport 目标端口<br>  - seq 序列号<br>  - ack 确认号<br>  - window_size 窗口大小<br>  - payload:可以过滤包含特定数据的包<br>  - 等等</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
          <category> tcp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络编程 </tag>
            
            <tag> tcp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libevent http server</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/libevent/Libevent%E2%80%94%E2%80%94httpserver/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/libevent/Libevent%E2%80%94%E2%80%94httpserver/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="实现http-server"><a href="#实现http-server" class="headerlink" title="实现http-server"></a>实现http-server</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;evhttp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;event.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/http.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/event.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/bufferevent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/bufferevent_compat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/http_struct.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/http_compat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;event2/listener.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Iphlpapi.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_MAX 1024*16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//解析post请求数据</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_post_message</span><span class="params">(<span class="type">char</span>* buf, <span class="keyword">struct</span> evhttp_request* req)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">size_t</span> post_size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">post_size = <span class="built_in">evbuffer_get_length</span>(req-&gt;input_buffer);<span class="comment">//获取数据长度</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,post len:%d\n&quot;</span>, __LINE__, post_size);</span><br><span class="line"><span class="keyword">if</span> (post_size &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,post msg is empty!\n&quot;</span>, __LINE__);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> copy_len = post_size &gt; BUF_MAX ? BUF_MAX : post_size;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,post len:%d, copy_len:%d\n&quot;</span>, __LINE__, post_size, copy_len);</span><br><span class="line"><span class="built_in">memcpy</span>(buf, <span class="built_in">evbuffer_pullup</span>(req-&gt;input_buffer, <span class="number">-1</span>), copy_len);</span><br><span class="line">buf[post_size] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,post msg:%s\n&quot;</span>, __LINE__, buf);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析http头，主要用于get请求时解析uri和请求参数</span></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_http_header</span><span class="params">(<span class="keyword">struct</span> evhttp_request* req, <span class="keyword">struct</span> evkeyvalq* params, <span class="type">const</span> <span class="type">char</span>* query_char)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (req == <span class="literal">NULL</span> || params == <span class="literal">NULL</span> || query_char == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;input params is null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evhttp_uri</span>* decoded = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">char</span>* query = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">char</span>* query_result = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* path;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* uri = <span class="built_in">evhttp_request_get_uri</span>(req);<span class="comment">//获取请求uri</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (uri == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,evhttp_request_get_uri return null\n&quot;</span>, __LINE__);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,Got a GET request for &lt;%s&gt;\n&quot;</span>, __LINE__, uri);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解码uri</span></span><br><span class="line">decoded = <span class="built_in">evhttp_uri_parse</span>(uri);</span><br><span class="line"><span class="keyword">if</span> (!decoded)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,It&#x27;s not a good URI. Sending BADREQUEST\n&quot;</span>, __LINE__);</span><br><span class="line"><span class="built_in">evhttp_send_error</span>(req, HTTP_BADREQUEST, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取uri中的path部分</span></span><br><span class="line">path = <span class="built_in">evhttp_uri_get_path</span>(decoded);</span><br><span class="line"><span class="keyword">if</span> (path == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,path is:%s\n&quot;</span>, __LINE__, path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取uri中的参数部分</span></span><br><span class="line">query = (<span class="type">char</span>*)<span class="built_in">evhttp_uri_get_query</span>(decoded);</span><br><span class="line"><span class="keyword">if</span> (query == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,evhttp_uri_get_query return null\n&quot;</span>, __LINE__);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询指定参数的值</span></span><br><span class="line"><span class="built_in">evhttp_parse_query_str</span>(query, params);</span><br><span class="line">query_result = (<span class="type">char</span>*)<span class="built_in">evhttp_find_header</span>(params, query_char);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> query_result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理get请求</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">http_handler_testget_msg</span><span class="params">(<span class="keyword">struct</span> evhttp_request* req, <span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (req == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;input param req is null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* sign = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">char</span>* data = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evkeyvalq</span> sign_params = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">sign = <span class="built_in">find_http_header</span>(req, &amp;sign_params, <span class="string">&quot;sign&quot;</span>);<span class="comment">//获取get请求uri中的sign参数</span></span><br><span class="line"><span class="keyword">if</span> (sign == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;request uri no param sign.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,get request param: sign=[%s]\n&quot;</span>, __LINE__, sign);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">find_http_header</span>(req, &amp;sign_params, <span class="string">&quot;data&quot;</span>);<span class="comment">//获取get请求uri中的data参数</span></span><br><span class="line"><span class="keyword">if</span> (data == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;request uri no param data.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,get request param: data=[%s]\n&quot;</span>, __LINE__, data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//回响应</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evbuffer</span>* retbuff = <span class="literal">NULL</span>;</span><br><span class="line">retbuff = <span class="built_in">evbuffer_new</span>();</span><br><span class="line"><span class="keyword">if</span> (retbuff == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;retbuff is null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">evbuffer_add_printf</span>(retbuff, <span class="string">&quot;Receive get request,Thamks for the request!&quot;</span>);</span><br><span class="line"><span class="built_in">evhttp_send_reply</span>(req, HTTP_OK, <span class="string">&quot;Client&quot;</span>, retbuff);</span><br><span class="line"><span class="built_in">evbuffer_free</span>(retbuff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理post请求</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">http_handler_testpost_msg</span><span class="params">(<span class="keyword">struct</span> evhttp_request* req, <span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (req == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;input param req is null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> buf[BUF_MAX] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="built_in">get_post_message</span>(buf, req);<span class="comment">//获取请求数据，一般是json格式的数据</span></span><br><span class="line"><span class="keyword">if</span> (buf == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;get_post_message return null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//可以使用json库解析需要的数据</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,request data:%s&quot;</span>, __LINE__, buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//回响应</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evbuffer</span>* retbuff = <span class="literal">NULL</span>;</span><br><span class="line">retbuff = <span class="built_in">evbuffer_new</span>();</span><br><span class="line"><span class="keyword">if</span> (retbuff == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;retbuff is null.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">evbuffer_add_printf</span>(retbuff, <span class="string">&quot;Receive Get request,Thamks for the request!&quot;</span>);</span><br><span class="line"><span class="built_in">evhttp_send_reply</span>(req, HTTP_OK, <span class="string">&quot;Client&quot;</span>, retbuff);</span><br><span class="line"><span class="built_in">evbuffer_free</span>(retbuff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">evhttp</span>* http_server = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">short</span> http_port = <span class="number">8081</span>;</span><br><span class="line"><span class="type">char</span>* http_addr = <span class="string">&quot;0.0.0.0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line">&#123;</span><br><span class="line">WORD wVersionRequested;</span><br><span class="line">WSADATA wsaData;</span><br><span class="line"><span class="type">int</span> err;</span><br><span class="line"></span><br><span class="line">wVersionRequested = <span class="built_in">MAKEWORD</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">err = <span class="built_in">WSAStartup</span>(wVersionRequested, &amp;wsaData);</span><br><span class="line"><span class="keyword">if</span> (err != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;WSAStartup failed with error: %d\n&quot;</span>, err);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _WIN32</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化</span></span><br><span class="line"><span class="built_in">event_init</span>();</span><br><span class="line"><span class="comment">//启动http服务端</span></span><br><span class="line">http_server = <span class="built_in">evhttp_start</span>(http_addr, http_port);</span><br><span class="line"><span class="keyword">if</span> (http_server == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;====line:%d,%s\n&quot;</span>, __LINE__, <span class="string">&quot;http server start failed.&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置请求超时时间(s)</span></span><br><span class="line"><span class="built_in">evhttp_set_timeout</span>(http_server, <span class="number">5</span>);</span><br><span class="line"><span class="comment">//设置事件处理函数，evhttp_set_cb针对每一个事件(请求)注册一个处理函数，</span></span><br><span class="line"><span class="comment">//区别于evhttp_set_gencb函数，是对所有请求设置一个统一的处理函数</span></span><br><span class="line"><span class="built_in">evhttp_set_cb</span>(http_server, <span class="string">&quot;/me/testpost&quot;</span>, http_handler_testpost_msg, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">evhttp_set_cb</span>(http_server, <span class="string">&quot;/me/testget&quot;</span>, http_handler_testget_msg, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环监听</span></span><br><span class="line"><span class="built_in">event_dispatch</span>();</span><br><span class="line"><span class="comment">//实际上不会释放，代码不会运行到这一步</span></span><br><span class="line"><span class="built_in">evhttp_free</span>(http_server);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="使用-postman-请求"><a href="#使用-postman-请求" class="headerlink" title="使用 postman 请求"></a>使用 postman 请求</h1><h2 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="punctuation">:</span><span class="number">8081</span>/me/testpost</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求体</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123123Qq&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reqtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023年1月28日15:44:58&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/Libevent%E2%80%94%E2%80%94httpserver/image-20230128155253773.png" alt="get请求"></p><p>http-server 控制台输出：</p><div style="background:black;font:conloas;color:white;"> ====line:65,Got a GET request for </me/testget> <br>====line:85,path is:/me/testget<br>====line:92,evhttp_uri_get_query return null<br>====line:118,request uri no param sign.<br>====line:65,Got a GET request for </me/testget><br>====line:85,path is:/me/testget<br>====line:92,evhttp_uri_get_query return null<br>====line:128,request uri no param data.<br></span><h2 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 接口</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="punctuation">:</span><span class="number">8081</span>/me/testpost</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求体</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123123Qq&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reqtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023年1月28日15:44:58&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/Libevent%E2%80%94%E2%80%94httpserver/image-20230128154948132.png" alt="post请求"></p><p>http-server 控制台输出：</p><div style="background:black;font:conloas;color:white;"> ====line:27,post len:98<br>====line:36,post len:98, copy_len:98<br>====line:39,post msg:{<br>    "username": "A",<br>    "password": "123123Qq",<br>    "reqtime": "2023骞?鏈?8鏃?5:44:58"<br>}<br>====line:168,request data:{<br>    "username": "A",<br>    "password": "123123Qq",<br>    "reqtime": "2023骞?鏈?8鏃?5:44:58"<br>}<br></div>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
          <category> libevent </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络编程 </tag>
            
            <tag> libevent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Curl使用的一些demo，记录</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Curl%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Curl%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="1、编译及使用"><a href="#1、编译及使用" class="headerlink" title="1、编译及使用"></a>1、编译及使用</h1><h2 id="1-1-编译"><a href="#1-1-编译" class="headerlink" title="1.1 编译"></a>1.1 编译</h2><h3 id="1-1-1下载"><a href="#1-1-1下载" class="headerlink" title="1.1.1下载"></a>1.1.1下载</h3><p><a href="https://github.com/curl/curl">GitHub - curl&#x2F;curl: A command line tool and library for transferring data with URL syntax, supporting DICT, FILE, FTP, FTPS, GOPHER, GOPHERS, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, MQTT, POP3, POP3S, RTMP, RTMPS, RTSP, SCP, SFTP, SMB, SMBS, SMTP, SMTPS, TELNET and TFTP. libcurl offers a myriad of powerful features</a></p><p>点击链接下载，也可以使用<code>git clone</code>到本地</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/curl/curl.git</span><br></pre></td></tr></table></figure><h3 id="1-1-2-编译"><a href="#1-1-2-编译" class="headerlink" title="1.1.2 编译"></a>1.1.2 编译</h3><ul><li>方法一 VS编译器</li></ul><p>如果需要使用vs编译，首先运行 <code>project</code> 目录下的 <code>generate.bat</code> 文件。然后在<code>projects/Windwows</code> 目录下打开对应的解决方案即可</p><ul><li>方法二 nmake</li></ul><p>在下载目录 <code>winbuild</code> 目录下，查看 <a href="">README.md</a> ，里边告诉了我们如何编译自己需要的包，以我本人使用的为例。</p><ol><li><p>打开对应版本的vs命令行工具</p><p><img src="/../../../images/Curl%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/image-20220624124518653.png" alt="image-20220624124518653"></p></li><li><p>进入对应的编译目录 <code>curl-src\winbuild</code>，接着执行以下命令就好。具体的命令参数可以查看winbuild目录下的介绍，选择自己需要的环境就好。</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmake /f Makefile.vc mode=dll vc=15 MACHINE=x86</span><br></pre></td></tr></table></figure><ol start="3"><li>执行以后就能在根目录 <code>build</code> 下看到生成了对应的文件夹，这时候就可以在项目中使用了。注意生成目录下有 <code>bin、include、lib</code> 三个文件夹。</li></ol><h2 id="1-2-使用"><a href="#1-2-使用" class="headerlink" title="1.2 使用"></a>1.2 使用</h2><p>将生成的文件拖动到项目所在文件夹目录下，这时候需要做以下几个步骤，打开项目的属性页面：</p><h3 id="1-2-1-预处理器"><a href="#1-2-1-预处理器" class="headerlink" title="1.2.1 预处理器"></a>1.2.1 预处理器</h3><p>在预处理器中添加以下字段：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;BUILDING_LIBCURL;HTTP_ONLY;</span><br></pre></td></tr></table></figure><h3 id="1-2-2-附加库"><a href="#1-2-2-附加库" class="headerlink" title="1.2.2 附加库"></a>1.2.2 附加库</h3><ol><li><p>在链接器中附加库目录，把lib文件夹添加到附加库目录当中</p></li><li><p>添加lib文件</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libcurl_a.lib;Ws2_32.lib;Wldap32.lib;winmm.lib;Crypt32.lib;Normaliz.lib;%(AdditionalDependencies)</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-3-3-使用"><a href="#1-3-3-使用" class="headerlink" title="1.3.3 使用"></a>1.3.3 使用</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;curl/curl.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">UriHelper::Encode</span><span class="params">(<span class="type">const</span> string&amp; source)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CURL* curl = <span class="built_in">curl_easy_init</span>();</span><br><span class="line"><span class="type">char</span>* cres = <span class="built_in">curl_easy_escape</span>(curl, source.<span class="built_in">c_str</span>(), source.<span class="built_in">length</span>());</span><br><span class="line"><span class="function">string <span class="title">res</span><span class="params">(cres)</span></span>;</span><br><span class="line"><span class="built_in">curl_free</span>(cres);</span><br><span class="line"><span class="built_in">curl_easy_cleanup</span>(curl);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">Encode</span>(<span class="string">R&quot;(https://10.92.4.117:8443/tac</span></span><br><span class="line"><span class="string">        /download/client/com.qianxin.trustagent.win.standard.exe.bm-3.1.1.4585/</span></span><br><span class="line"><span class="string">        TrustAgent_standard_3.1.1.4585.aef031d09[10.92.4.117@443].exe)&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div style="background-color:black;color:white;font-family:conloas;">输出：<br>http0.0000000.0000000.000000www.baidu.com0.000000s0.000000ie%3Dutf-8 0.000000%3D8 %3Dbaidu%26wd%3D5.185438E-3164%B8%B48.694087E-3156%97%B65.190920E-3169%820.000000E5.12199E-31670.000000E%B1</div>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> HTTP </tag>
            
            <tag> Curl </tag>
            
            <tag> 网络编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSI七层网络协议模型各层协议</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/images/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B/osi.png" alt="osi"></p><p><img src="/images/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A8%A1%E5%9E%8B/image-20230817205227314.png" alt="image-20230817205227314"></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络编程 </tag>
            
            <tag> 协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPv6</title>
      <link href="/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IPv6/"/>
      <url>/Code/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IPv6/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="IPv6地址格式"><a href="#IPv6地址格式" class="headerlink" title="IPv6地址格式"></a><strong>IPv6地址格式</strong></h1><p>IPv6的地址长度是128位（bit）。</p><p>将这128位的地址按每16位划分为一个段，将每个段转换成十六进制数字，并用冒号隔开。</p><p>例如：2000:0000:0000:0000:0001:2345:6789:abcd</p><p>这个地址很长，可以用两种方法对这个地址进行压缩，</p><p>前导零压缩法：</p><p>将每一段的前导零省略，但是每一段都至少应该有一个数字</p><p>例如：2000:0:0:0:1:2345:6789:abcd</p><p>双冒号法：</p><p>如果一个以冒号十六进制数表示法表示的IPv6地址中，如果几个连续的段值都是0，那么这些0可以简记为::。每个地址中只能有一个::。</p><p>例如：2000::1:2345:6789:abcd</p><h3 id="单播地址（Unicast-IPv6-Addresses）"><a href="#单播地址（Unicast-IPv6-Addresses）" class="headerlink" title="单播地址（Unicast IPv6 Addresses）"></a><strong>单播地址（<strong><strong>Unicast IPv6 Addresses</strong></strong>）</strong></h3><p>可聚合的全球单播地址（Aggregatable Global Unicast Addresses）</p><p>可在全球范围内路由和到达的，相当于IPv4里面的global addresses。前三个bit是001</p><p>例如：2000::1:2345:6789:abcd</p><p>链路本地地址（Link-Local Addresses）</p><p>用于同一个链路上的相邻节点之间通信，相当于IPv4里面的169.254.0.0&#x2F;16地址。Ipv6的路由器不会转发链路本地地址的数据包。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是FE80::&#x2F;64</p><p>例如：FE80::1</p><p>站点本地地址（Site-Local Addresses）</p><p>对于无法访问internet的本地网络，可以使用站点本地地址，这个相当于IPv4里面的private address（10.0.0.0&#x2F;8, 172.16.0.0&#x2F;12, and 192.168.0.0&#x2F;16）。它的前10个bit是1111 1110 11，它最后是16bit的Subnet ID和64bit的interface ID，所以它的前缀是FEC0::&#x2F;48。</p><p>值得注意的是，在RFC3879中，最终决定放弃单播站点本地地址。放弃的理由是，由于其固有的二义性带来的单播站点本地地址的复杂性超过了它们可能带来的好处。它在RFC4193中被ULA取代。</p><p>唯一的本地IPv6单播地址（ULA，Unique Local IPv6 Unicast Address）</p><p>在RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FD00::&#x2F;8，后面跟一个被称为全局ID的40bit随机标识符。</p><p>未指定地址（Unspecified address）</p><p>0:0:0:0:0:0:0:0 或者::</p><p>当一个有效地址还不能确定，一般用未指定地址作为源地址。未指定地址不能作为一个目标地址来使用。</p><p>回环地址（Loopback address）</p><p>回环地址::1用于标识一个回环接口，可以使一个节点可以给自己发送数据包。相当于IPv4的回环地址127.0.0.1</p><p>兼容IPv4的地址（IPv4-compatible address）</p><p>形如::w.x,y.z，这里的w.x.y.z是IPv4公共地址的十进制点号表示法，用于IPv6&#x2F;IPv4节点们（同时支持）在使用仅支持IPv4的网络上用IPv6的协议进行通信。</p><p>但是事实证明这种技术不是个好主意，RFC4291中废弃了对这类地址的使用。</p><p>IPv4映射地址（IPv4-mapped address）</p><p>形如::FFFF:w.x.y.z，这里的w.x.y.z是IPv4公共地址的十进制点号表示法,用于一个仅支持IPv4的节点表现为一个IPv6的节点</p><p>6over4地址</p><p>[64bit-prefix]:0:0:WWXX:YYZZ,其中的WWXX:YYZZ是w.x.y.z IPv4公共地址的十进制点号表示法，用于一个使用6to4协议的隧道机制的节点。</p><p>6to4地址</p><p>2002:WWXX:YYZZ:[SLA ID]:[Interface ID],用于表示一个使用6to4协议的隧道机制节点。</p><h3 id="多播IPv6地址（Multicast-IPv6-Addresses）"><a href="#多播IPv6地址（Multicast-IPv6-Addresses）" class="headerlink" title="多播IPv6地址（Multicast IPv6 Addresses）"></a><strong>多播IPv6地址（<strong><strong>Multicast IPv6 Addresses</strong></strong>）</strong></h3><p>前8个bit为1111 1111，</p><p>其中FF01::到FF0F::的多播地址是保留专用地址</p><p>FF01::1 节点本地范围所有节点多播地址</p><p>FF02::1 链路本地范围所有节点多播地址</p><p>FF01::2 节点本地范围所有路由器多播地址</p><p>FF02::2 链路本地范围所有路由器多播地址</p><p>FF05::2 站点本地范围所有路由器多播地址</p><h2 id="为-IPv6-划分子网"><a href="#为-IPv6-划分子网" class="headerlink" title="为 IPv6 划分子网"></a>为 IPv6 划分子网</h2><p>在对 IPv6 地址空间进行子网划分时，需要使用子网划分技术，以一种允许将剩余地址空间的摘要和委派路由到 IPv6 Intranet 的不同部分的方式，为 48 位全局地址前缀划分 16 位子网 ID 字段。</p><p>您不需要以任何特定的方式进行子网划分。此处介绍的子网划分技术假定您是通过使用子网 ID 字段的高序位划分其地址空间的可变部分来进行子网划分的。虽然此方法有助于分层寻址和路由，但此方法并不是非用不可。例如，在只有少数子网的小型组织中，您可以通过为子网编号（从 0 开始），轻松地为全局地址创建平面寻址空间。</p><h3 id="对全局地址前缀进行子网划分"><a href="#对全局地址前缀进行子网划分" class="headerlink" title="对全局地址前缀进行子网划分"></a>对全局地址前缀进行子网划分</h3><p>对于全局地址，Internet 编号分配机构 (IANA) 或 ISP 会分配一个前 48 位均为固定位的 IPv6 地址前缀。若要对 48 位全局地址前缀的子网 ID 字段进行子网划分，需要执行一个包含两步的过程：</p><table><thead><tr><th>1.</th><th>确定用于子网划分的位数。</th></tr></thead><tbody><tr><td>2.</td><td>枚举出新的子网网络前缀。</td></tr></tbody></table><p>确定用于子网划分的位数</p><p>用于子网划分的位数决定着您可以分配给您的网络各部分（基于地理区划或部门分类）的新子网网络前缀的可能的数量。在分层路由基础结构中，您必须确定您在层次结构的各层需要的网络前缀数，进而确定各层需要的位数。为层次结构的各层选择的位越多，您拥有的用于枚举层次结构最后一层中的单个子网的位越少。</p><p>例如，您可以实施一个包含两层的层次结构来反映地理&#x2F;部门结构，4 位用于地理层，6 位用于部门层。这一方案允许 16 个地理区域，各个区域中的各个部门只占剩余的子网划分空间的 6 (16 - 6 - 4) 位，或者说每个部门只有 64 (&#x3D;26) 个子网。</p><p>在层次结构中任何给定的层上，许多位已被层次结构中的上一层固定了 (<em>f</em>)，许多位被用来在层次结构中的当前层进行子网划分 (<em>s</em>)，还有许多位留给层次结构中的下一层使用 (<em>r</em>)。下面这个等式始终成立：<em>f</em>+<em>s</em>+<em>r</em> &#x3D; 16。</p><h3 id="枚举子网网络前缀"><a href="#枚举子网网络前缀" class="headerlink" title="枚举子网网络前缀"></a>枚举子网网络前缀</h3><p>根据用于子网划分的位数，您必须列出新的子网网络前缀，您可以使用下面两种主要方法之一：</p><table><thead><tr><th>•</th><th>使用子网 ID 和递增值的十六进制表示形式来枚举新的子网网络前缀。</th></tr></thead><tbody><tr><td>•</td><td>使用子网 ID 和递增值的十进制表示形式来枚举新的子网网络前缀。</td></tr></tbody></table><p>这两种方法产生的结果相同，都会生成子网网络前缀的一个枚举列表。</p><p>要使用十六进制方法创建子网网络前缀的枚举列表，请执行以下步骤：</p><table><thead><tr><th>1.</th><th>根据为子网划分选择的位数 <em>s</em> 和进行子网划分的网络前缀的前缀长度 <em>m</em>，计算以下各值：<em>f</em> &#x3D; <em>m</em> - 48<em>f</em> 是子网 ID 中已固定的位的数目。<em>n</em> &#x3D; 2s<em>n</em> 是您将获得的网络前缀的数目。<em>i</em> &#x3D; 216-(f+s) <em>i</em> 是以十六进制表示的各个连续子网 ID 之间的递增值。<em>P</em> &#x3D; <em>m+s**P</em> 是新的子网网络前缀的前缀长度。</th></tr></thead><tbody><tr><td>2.</td><td>创建一个包含 <em>n</em> 行、两列的表。第一列存放网络前缀编号（从 1 开始），第二列存放新的子网网络前缀。</td></tr><tr><td>3.</td><td>将使用新的前缀长度的原始网络前缀放在第一行的第二列中。例如，根据进行子网划分的子网 ID 的十六进制值 <em>F</em>，子网网络前缀为 [48 位前缀]:<em>F</em>::&#x2F;<em>P</em>。</td></tr><tr><td>4.</td><td>将站点本地地址或全局地址的子网 ID 部分中的值加上 <em>i</em>，将结果放在下一行的第二列中。例如，在第二行中，子网前缀为 [48 位前缀]:<em>F</em>+<em>i</em>::&#x2F;<em>P</em>。</td></tr><tr><td>5.</td><td>重复步骤 4，直到您完成该表。</td></tr></tbody></table><p>例如，要对全局地址前缀 3FFE:FFFF:0:C000::&#x2F;51 进行 3 位子网划分，首先计算前缀数量值、递增值和新前缀长度值。起始值是 <em>F</em>&#x3D;0xC000，<em>s</em>&#x3D;3，<em>m</em>&#x3D;51，因此 <em>f</em>&#x3D;51-48&#x3D;3。前缀的数量是 8 (<em>n</em>&#x3D;23)。递增值是 0x400 (<em>i</em>&#x3D;216-(3+3)&#x3D;1024&#x3D;0x400)。新的前缀长度是 54 (<em>P</em>&#x3D;51+3)。</p><p>接下来，构造一个包含 8 行的表，如表 4-12 所示。将 3FFE:FFFF:0:C000::&#x2F;54 放在网络前缀 1 所在的那一行的第二列，然后让网络前缀的子网 ID 部分依次递增 0x400，将结果分别填入后面的各行中。</p><p>下表为使用十六进制技术对 3FFE:FFFF:0:C000::&#x2F;51 进行 3 位子网划分：</p><table><thead><tr><th>网络前缀</th><th>子网网络前缀</th></tr></thead><tbody><tr><td>1</td><td>3FFE:FFFF:0:C000::&#x2F;54</td></tr><tr><td>2</td><td>3FFE:FFFF:0:C400::&#x2F;54</td></tr><tr><td>3</td><td>3FFE:FFFF:0:C800::&#x2F;54</td></tr><tr><td>4</td><td>3FFE:FFFF:0:CC00::&#x2F;54</td></tr><tr><td>5</td><td>3FFE:FFFF:0:D000::&#x2F;54</td></tr><tr><td>6</td><td>3FFE:FFFF:0:D400::&#x2F;54</td></tr><tr><td>7</td><td>3FFE:FFFF:0:D800::&#x2F;54</td></tr><tr><td>8</td><td>3FFE:FFFF:0:DC00::&#x2F;54</td></tr></tbody></table><p>要使用十进制方法创建子网网络前缀的枚举列表，请执行以下步骤：</p><table><thead><tr><th>1.</th><th>根据用于子网划分的位数 <em>s</em>、进行子网划分的网络前缀的前缀长度 <em>m</em> 和进行子网划分的子网 ID 的十六进制值 <em>F</em>，计算以下各值：<em>f</em> &#x3D; <em>m</em> - 48<em>f</em> 是子网 ID 中已固定的位的数目。<em>n</em> &#x3D; 2s<em>n</em> 是您将获得的网络前缀的数目。<em>i</em> &#x3D; 216-(f+s) <em>i</em> 是各个连续子网 ID 之间的递增值。<em>P</em> &#x3D; <em>m</em>+<em>s**P</em> 是新的子网网络前缀的前缀长度。<em>D</em> &#x3D; <em>F</em> 的十进制表示形式</th></tr></thead><tbody><tr><td>2.</td><td>创建一个包含 <em>n</em> 行、三列的表。第一列存放网络前缀编号（从 1 开始），第二列存放新的子网网络前缀的子网 ID 部分的十进制表示形式，第三列存放新的子网网络前缀。</td></tr><tr><td>3.</td><td>将子网 ID 的十进制表示形式 (<em>D</em>) 放在第一行的第一列，将子网前缀 [48 位前缀]:<em>F</em>::&#x2F;<em>P</em> 放在第一行的第二列。</td></tr><tr><td>4.</td><td>用子网 ID 十进制表示形式的值加上 <em>i</em>，将结果放在下一行的第二列。例如，第二行的子网 ID 的十进制表示形式是 <em>D</em>+<em>i</em>。</td></tr><tr><td>5.</td><td>在第三列中，将子网 ID 的十进制表示形式转换为十六进制，并构造前缀 [48 位前缀]:[<em>SubnetID</em>]::&#x2F;<em>P</em>。例如，在第二行中，子网网络前缀为 [48 位前缀]:[<em>D</em>+<em>i</em>（转换为十六进制）]::&#x2F;<em>P</em>。</td></tr><tr><td>6.</td><td>重复步骤 4 和 5，直到您完成该表。</td></tr></tbody></table><p>例如，要对站点本地网络前缀 3FFE:FFFF:0:C000::&#x2F;51 进行 3 位子网划分，首先计算前缀数量值、递增值、新前缀长度值和起始子网 ID 十进制表示形式。我们的起始值是 <em>F</em>&#x3D;0xC000，<em>s</em>&#x3D;3，<em>m</em>&#x3D;51，这样 <em>f</em>&#x3D;51-48&#x3D;3。前缀数量是 8 (<em>n</em>&#x3D;23)。递增值是 1024 (<em>i</em>&#x3D;216-(3+3))。新的前缀长度是 54 (<em>P</em>&#x3D;51+3)。起始子网 ID 的十进制表示形式是 49152 (D&#x3D;0xC000&#x3D;49152)。</p><p>接下来，构造一个包含 8 行的表，如表 4-13 所示。将 49192 放在网络前缀 1 所在的那一行的第一列，将 3FFE:FFFF:0:C000::&#x2F;54 放在该行的第二列。让网络前缀的子网 ID 部分（第四个十六进制块）依次递增 1024，然后将结果转换为十六进制并分别填入后面的各行中。</p><p>下表为使用十进制技术对 3FFE:FFFF:0:C000::&#x2F;51 进行 3 位子网划分：</p><table><thead><tr><th>网络前缀</th><th>子网 ID 的十进制表示形式</th><th>子网网络前缀</th></tr></thead><tbody><tr><td>1</td><td>49192</td><td>3FFE:FFFF:0:C000::&#x2F;54</td></tr><tr><td>2</td><td>50176</td><td>3FFE:FFFF:0:C400::&#x2F;54</td></tr><tr><td>3</td><td>51200</td><td>3FFE:FFFF:0:C800::&#x2F;54</td></tr><tr><td>4</td><td>52224</td><td>3FFE:FFFF:0:CC00::&#x2F;54</td></tr><tr><td>5</td><td>53248</td><td>3FFE:FFFF:0:D000::&#x2F;54</td></tr><tr><td>6</td><td>54272</td><td>3FFE:FFFF:0:D400::&#x2F;54</td></tr><tr><td>7</td><td>55296</td><td>3FFE:FFFF:0:D800::&#x2F;54</td></tr><tr><td>8</td><td>56320</td><td>3FFE:FFFF:0:DC00::&#x2F;54</td></tr></tbody></table><h3 id="变量长度子网划分"><a href="#变量长度子网划分" class="headerlink" title="变量长度子网划分"></a>变量长度子网划分</h3><p>与 IPv4 相同的是，您可以对 IPv6 地址前缀循环进行子网划分来在组织 Intranet 的各个层次提供路由摘要，定义单个子网的地址前缀可达到 64 位。与 IPv4 不同的是，您无法使用可变长度子网划分来创建不同大小的子网，因为所有 IPv6 子网都使用 64 位网络 ID 和 64 位接口 ID。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 网络编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络编程 </tag>
            
            <tag> IPv6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式反向引用</title>
      <link href="/Code/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E5%8C%B9%E9%85%8D%E4%B8%8D%E7%AD%89%E4%BA%8E/"/>
      <url>/Code/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E5%8C%B9%E9%85%8D%E4%B8%8D%E7%AD%89%E4%BA%8E/</url>
      
        <content type="html"><![CDATA[<p><code>[^a]*</code> 表示匹配除了a以外的所有字符<br><code>[^abc]*</code> 表示匹配除了a、b、c以外的所有字符，注意这里不是abc字符串，而是a、b、c任何一个字符都不匹配</p><p>当我们要不匹配某个字符串或者中文词组的时候，可以这样用<br><code>((?!天空).)*</code> 这个表示匹配出’天空’之外的所有字符</p><p><code>regex(?![0-9]+)</code> 匹配不是regex，但后面不是数字</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> regex </tag>
            
            <tag> 正则表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt插件——使用 QtCipherSqlitePlugin 对数据库进行加密</title>
      <link href="/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%AF%86/"/>
      <url>/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="开源库介绍"><a href="#开源库介绍" class="headerlink" title="开源库介绍"></a>开源库介绍</h1><p><a href="https://github.com/devbean/QtCipherSqlitePlugin">devbean&#x2F;QtCipherSqlitePlugin: A Qt plugin for cipher SQLite. (github.com)</a></p><p>该加密库是基于 SQLite 和 wxSQLite3 源代码开发的的一个加密 SQLite 的Qt插件。总结就是，可以使用该插件对 SQLite 的数据库进行加密。</p><h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><ol><li>在开始之前，可以去仓库的 wiki 界面找到相应的开始教程，以下操作参考 wiki 。</li></ol><blockquote><ol><li><p>拉取该库到本地后，打开 <code>QtCipherSqlitePlugin.pro</code>，就能看到如下图所示的工程结构。</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E6%95%B0%E6%8D%AE%E5%BA%93/images/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%AF%86/project.png" alt="image-20220508222820701"></p><ol><li><code>demo</code> 目录是一个如何使用该加密插件的工程，涉及数据库的加密、打开、创建等</li><li><code>sqlitecipher</code>是我们编译 <code>dll</code> 的工程文件</li><li>为 <code>Qt</code> 的插件测试工程，里边有关于该加密库的详细使用方式介绍。</li></ol></li><li><p>不论是使用上述测试工程中的哪个，我们第一步都需要编译插件的动态库出来使用。</p><ol><li>单独<code>sqlitecipher.pro</code></li><li>为 <code>sqlitecipher.pro</code> 调整 <code>Qt kits</code> ，笔者的环境为 <code>MSVC 2015 32 bit</code>, <code>Release</code>模式</li><li>右击项目文件，点击部署即可</li><li>到工程所在的文件夹，就能看到 <code>build-sqlitecipher-Desktop_Qt_5_9_9_MSVC2015_32bit-Release</code> 的文件夹，在 <code>.\plugins\sqldrivers</code>下就能看到生成的动态库文件，动态库 <code>sqlitecipher.dll</code></li><li>拷贝该文件到你的 <code>Qt</code> 目录下 <code>kits</code> 对应的文件夹当中。如笔者的为 <code>$Qt安装目录$\5.9.9\msvc2015\plugins\sqldrivers</code></li></ol></li></ol></blockquote><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>到这一步，我们就需要查看一下动态库是否可用了。使用 <code>Qt</code> 的 <code>#include &lt;QSqlDatabase&gt;</code>中的方法即可：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; QSqlDatabase::<span class="built_in">drivers</span>();</span><br></pre></td></tr></table></figure><p>执行上述代码，如果加载成功的话，我们会在 <code>qDebug()</code> 的输出中看到相应的数据库名。</p><p><code>(&quot;QSQLITE&quot;, &quot;QMYSQL&quot;, &quot;QMYSQL3&quot;, &quot;QODBC&quot;, &quot;QODBC3&quot;, &quot;QPSQL&quot;, &quot;QPSQL7&quot;, </code><strong><code>&quot;SQLITECIPHER&quot;)</code></strong></p><p>以上代码，在 <code>demo</code> 所在工程中都能找到对应的代码，不用读者编写。</p><blockquote><p>另外，使用 <code>SQLITECIPHER</code> 数据库也可以打开普通未加密的 <code>QSQLITE</code> 创建的数据库。</p></blockquote><h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><p>加密数据库的使用也简单，区别于普通数据库的方式是需要设置连接属性。以该开源库为例，其主要通过三个连接属性去决定是否设置密码。主要涉及到的关键字为以下三个：</p><ul><li>Added by QtCipherSqlitePlugin<ul><li>QSQLITE_CREATE_KEY</li><li>QSQLITE_UPDATE_KEY</li><li>QSQLITE_REMOVE_KEY</li></ul></li></ul><p>还有其他几个继承自 <code>SqlitePlugin</code> 的关键字，用法与 <code>SqlitePlugin</code> 打开数据库设置一致。</p><ul><li>Provided by Qt SqlitePlugin<ul><li>QSQLITE_BUSY_TIMEOUT</li><li>QSQLITE_OPEN_READONLY</li><li>QSQLITE_OPEN_URI</li><li>QSQLITE_ENABLE_SHARED_CACHE</li></ul></li></ul><p>以下代码演示三种关键字的用法。</p><h3 id="创建数据库密码-QSQLITE-CREATE-KEY"><a href="#创建数据库密码-QSQLITE-CREATE-KEY" class="headerlink" title="创建数据库密码 QSQLITE_CREATE_KEY"></a>创建数据库密码 <code>QSQLITE_CREATE_KEY</code></h3><p>如果输出中有 <code>SQLITECIPHER</code> 的名字，那么恭喜你，插件没有问题！<br>为没有加密的数据库增加密码<br>Qt 默认提供的 SQLite 插件是没有加密功能的。新版本的 <code>QtCipherSqlitePlugin</code> 支持为原本没有加密的数据库增加密码，使用方法如下：<br>C++</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_CREATE_KEY&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;    </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();    </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码，我们使用 <code>test.db</code> 数据库，将密码设置为 test，同时指定连接选项为 <code>QSQLITE_CREATE_KEY</code> 。此时，调用 open() 函数之后，<code>QtCipherSqlitePlugin</code> 将使用改密码为这个数据库进行加密。</p><h3 id="删除数据库密码-QSQLITE-REMOVE-KEY"><a href="#删除数据库密码-QSQLITE-REMOVE-KEY" class="headerlink" title="删除数据库密码 QSQLITE_REMOVE_KEY"></a>删除数据库密码 <code>QSQLITE_REMOVE_KEY</code></h3><p><code>QtCipherSqlitePlugin</code> 可以删除数据库密码，此时需要提供原密码，并使用连接选项 <code>QSQLITE_REMOVE_KEY</code> ，如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_REMOVE_KEY&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;   </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();   </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="更新数据库密码-QSQLITE-UPDATE-KEY"><a href="#更新数据库密码-QSQLITE-UPDATE-KEY" class="headerlink" title="更新数据库密码 QSQLITE_UPDATE_KEY"></a>更新数据库密码 <code>QSQLITE_UPDATE_KEY</code></h3><p><code>QtCipherSqlitePlugin</code> 可以更新数据库原有密码，需要设置原密码，并且使用连接选项 <code>QSQLITE_UPDATE_KEY</code> 设置新密码，具体代码如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_UPDATE_KEY=newtest&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;    </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();   </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果原密码不正确，<code>QtCipherSqlitePlugin</code> 会直接返回错误。</p><p>如果新密码设置为空，例如 <code>QSQLITE_UPDATE_KEY=</code> ，则作用等同于删除密码。同样的，设置 <code>setConnectOptions(&quot;&quot;)</code> 也相当于清除设置的属性。</p><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>以下代码是我个人想写一个通用的设置属性的接口，后来思考一番不太现实以示众多读者，不要重蹈覆辙。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">setDBConfig</span><span class="params">(QSqlDatabase* dbconn, QMap&lt;ENUM_SQLKEY, QString&gt; qMapCfg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it : qMapCfg.<span class="built_in">toStdMap</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (it.first &lt;= QSQLITE_REMOVE_KEY)</span><br><span class="line">&#123;</span><br><span class="line">dbconn-&gt;<span class="built_in">setPassword</span>(it.second);</span><br><span class="line">dbconn-&gt;<span class="built_in">setConnectOptions</span>(<span class="built_in">GETOBJNAME</span>(it.first));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (it.first == QSQLITE_UPDATE_KEY)</span><br><span class="line">&#123;</span><br><span class="line">dbconn-&gt;<span class="built_in">setPassword</span>(it.second);</span><br><span class="line">dbconn-&gt;<span class="built_in">setConnectOptions</span>(<span class="built_in">QString</span>(<span class="string">&quot;%1=%2&quot;</span>).<span class="built_in">arg</span>().<span class="built_in">arg</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 数据库 </tag>
            
            <tag> 加密 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MYSQL——数据类型</title>
      <link href="/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="MYSQL-数据类型整理"><a href="#MYSQL-数据类型整理" class="headerlink" title="MYSQL 数据类型整理"></a>MYSQL 数据类型整理</h1><p>MySQL 中定义数据字段的类型对你数据库的优化是非常重要的。</p><p>MySQL 支持多种类型，大致可以分为三类：数值、日期&#x2F;时间和字符串(字符)类型。</p><hr><h2 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h2><p>MySQL 支持所有标准 SQL 数值数据类型。</p><p>这些类型包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL 和 NUMERIC)，以及近似数值数据类型(FLOAT、REAL 和 DOUBLE PRECISION)。</p><p>关键字INT是INTEGER的同义词，关键字DEC是DECIMAL的同义词。</p><p>BIT数据类型保存位字段值，并且支持 MyISAM、MEMORY、InnoDB 和 BDB表。</p><p>作为 SQL 标准的扩展，MySQL 也支持整数类型 TINYINT、MEDIUMINT 和 BIGINT。下面的表显示了需要的每个整数类型的存储和范围。</p><table><thead><tr><th align="left">类型</th><th align="left">大小</th><th align="left">范围（有符号）</th><th align="left">范围（无符号）</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">TINYINT</td><td align="left">1 Bytes</td><td align="left">(-128，127)</td><td align="left">(0，255)</td><td align="left">小整数值</td></tr><tr><td align="left">SMALLINT</td><td align="left">2 Bytes</td><td align="left">(-32 768，32 767)</td><td align="left">(0，65 535)</td><td align="left">大整数值</td></tr><tr><td align="left">MEDIUMINT</td><td align="left">3 Bytes</td><td align="left">(-8 388 608，8 388 607)</td><td align="left">(0，16 777 215)</td><td align="left">大整数值</td></tr><tr><td align="left">INT或INTEGER</td><td align="left">4 Bytes</td><td align="left">(-2 147 483 648，2 147 483 647)</td><td align="left">(0，4 294 967 295)</td><td align="left">大整数值</td></tr><tr><td align="left">BIGINT</td><td align="left">8 Bytes</td><td align="left">(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td><td align="left">(0，18 446 744 073 709 551 615)</td><td align="left">极大整数值</td></tr><tr><td align="left">FLOAT</td><td align="left">4 Bytes</td><td align="left">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td><td align="left">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td><td align="left">单精度 浮点数值</td></tr><tr><td align="left">DOUBLE</td><td align="left">8 Bytes</td><td align="left">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td align="left">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td align="left">双精度 浮点数值</td></tr><tr><td align="left">DECIMAL</td><td align="left">对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td><td align="left">依赖于M和D的值</td><td align="left">依赖于M和D的值</td><td align="left">小数值</td></tr></tbody></table><hr><h2 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h2><p>表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。</p><p>每个时间类型有一个有效值范围和一个”零”值，当指定不合法的MySQL不能表示的值时使用”零”值。</p><p>TIMESTAMP类型有专有的自动更新特性，将在后面描述。</p><table><thead><tr><th align="left">类型</th><th align="left">大小 ( bytes)</th><th align="left">范围</th><th align="left">格式</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">DATE</td><td align="left">3</td><td align="left">1000-01-01&#x2F;9999-12-31</td><td align="left">YYYY-MM-DD</td><td align="left">日期值</td></tr><tr><td align="left">TIME</td><td align="left">3</td><td align="left">‘-838:59:59’&#x2F;‘838:59:59’</td><td align="left">HH:MM:SS</td><td align="left">时间值或持续时间</td></tr><tr><td align="left">YEAR</td><td align="left">1</td><td align="left">1901&#x2F;2155</td><td align="left">YYYY</td><td align="left">年份值</td></tr><tr><td align="left">DATETIME</td><td align="left">8</td><td align="left">‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td><td align="left">YYYY-MM-DD hh:mm:ss</td><td align="left">混合日期和时间值</td></tr><tr><td align="left">TIMESTAMP</td><td align="left">4</td><td align="left">‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td><td align="left">YYYY-MM-DD hh:mm:ss</td><td align="left">混合日期和时间值，时间戳</td></tr></tbody></table><hr><h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><p>字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET。该节描述了这些类型如何工作以及如何在查询中使用这些类型。</p><table><thead><tr><th align="left">类型</th><th align="left">大小</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">CHAR</td><td align="left">0-255 bytes</td><td align="left">定长字符串</td></tr><tr><td align="left">VARCHAR</td><td align="left">0-65535 bytes</td><td align="left">变长字符串</td></tr><tr><td align="left">TINYBLOB</td><td align="left">0-255 bytes</td><td align="left">不超过 255 个字符的二进制字符串</td></tr><tr><td align="left">TINYTEXT</td><td align="left">0-255 bytes</td><td align="left">短文本字符串</td></tr><tr><td align="left">BLOB</td><td align="left">0-65 535 bytes</td><td align="left">二进制形式的长文本数据</td></tr><tr><td align="left">TEXT</td><td align="left">0-65 535 bytes</td><td align="left">长文本数据</td></tr><tr><td align="left">MEDIUMBLOB</td><td align="left">0-16 777 215 bytes</td><td align="left">二进制形式的中等长度文本数据</td></tr><tr><td align="left">MEDIUMTEXT</td><td align="left">0-16 777 215 bytes</td><td align="left">中等长度文本数据</td></tr><tr><td align="left">LONGBLOB</td><td align="left">0-4 294 967 295 bytes</td><td align="left">二进制形式的极大文本数据</td></tr><tr><td align="left">LONGTEXT</td><td align="left">0-4 294 967 295 bytes</td><td align="left">极大文本数据</td></tr></tbody></table><p><strong>注意</strong>：char(n) 和 varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。</p><p>CHAR 和 VARCHAR 类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。</p><p>BINARY 和 VARBINARY 类似于 CHAR 和 VARCHAR，不同的是它们包含二进制字符串而不要非二进制字符串。也就是说，它们包含字节字符串而不是字符字符串。这说明它们没有字符集，并且排序和比较基于列值字节的数值值。</p><p>BLOB 是一个二进制大对象，可以容纳可变数量的数据。有 4 种 BLOB 类型：TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB。它们区别在于可容纳存储范围不同。</p><p>有 4 种 TEXT 类型：TINYTEXT、TEXT、MEDIUMTEXT 和 LONGTEXT。对应的这 4 种 BLOB 类型，可存储的最大长度不同，可根据实际情况选择。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 数据库 </category>
          
          <category> MYSQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript</title>
      <link href="/Code/TypeScript/selfRecord/"/>
      <url>/Code/TypeScript/selfRecord/</url>
      
        <content type="html"><![CDATA[<p>[Toc]</p><h1 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h1><ol><li>安装</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm add @netless/fastboard @netless/window-manager white-web-sdk</span><br></pre></td></tr></table></figure><h1 id="创建实时音频"><a href="#创建实时音频" class="headerlink" title="创建实时音频"></a>创建实时音频</h1><h2 id="采集音视频相关"><a href="#采集音视频相关" class="headerlink" title="采集音视频相关"></a>采集音视频相关</h2><h3 id="1-获取摄像头列表"><a href="#1-获取摄像头列表" class="headerlink" title="1. 获取摄像头列表"></a>1. 获取摄像头列表</h3><blockquote><p>调用 <code>getMicrophones</code> 获取可用的摄像头列表</p><p><code>getMicrophones</code> 方法会通过 Promise 异步返回一个 <code>MediaDeviceInfo</code> 对象的数组。<code>MediaDeviceInfo</code> 对象复用了 WebRTC API 中的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDeviceInfo">MediaDeviceInfo 对象</a>。因为是异步方法，你可以使用 then&#x2F;catch (ES6) 或 async&#x2F;await (ES7) 获取返回值。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取可用的麦克风设备列表。</span></span><br><span class="line"><span class="comment">// 调用时，如果浏览器还没有获得麦克风访问权限，会在界面上提示你是否允许浏览器访问麦克风。</span></span><br><span class="line"><span class="title class_">AgoraRTC</span>.<span class="title function_">getMicrophones</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">deviceInfoArray</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 返回 MediaDeviceInfo 数组对象之后的操作*/</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Failed to get microphones!&quot;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="2-获取摄像头设备信息"><a href="#2-获取摄像头设备信息" class="headerlink" title="2. 获取摄像头设备信息"></a>2. 获取摄像头设备信息</h3><p>在此教程中，我们在 HTML 中创建一个下拉菜单来供用户选择使用的摄像头设备。在用户界面上使用 <code>label</code> 属性显示设备信息。<code>deviceId</code> 属性用于保存设备 ID，用于后续的摄像头访问。</p><blockquote><p><code>label</code>，即设备标签，返回一个 DOMString，代表描述对应设备的标签。如果浏览器没有获取设备权限，则返回 <code>&quot;&quot;</code>。</p></blockquote><blockquote><p><code>deviceId</code>，即设备 ID，返回一个 DOMString，代表对应设备。设备 ID 对于应用是唯一的，只要浏览器的 cookie 没有被清除，即使你开启了新的浏览器会话（session），设备 ID 也会保持不变。如果你清除了浏览器 cookie，则设备 ID 会重置。同理，如果你开启了浏览器隐私模式，对于同一个设备，每个浏览器会话的设备 ID 都是不同的。因此，建议每次对设备进行操作时重新获取设备 ID。</p></blockquote><p><strong>HTML</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>通过麦克风采集并在本地渲染音频<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span> 选择你要使用的麦克风 <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span> = <span class="string">&quot;microphoneList&quot;</span> <span class="attr">onchange</span> = <span class="string">&quot;getDeviceId()&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span>&gt;</span> ---选择麦克风--- <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>你选择设备的 deviceId 是：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;deviceId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义设备 ID 与标签的映射</span></span><br><span class="line"><span class="keyword">let</span> dict = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取摄像头列表</span></span><br><span class="line"><span class="title class_">AgoraRTC</span>.<span class="title function_">getMicrophones</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">deviceInfoArray</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> deviceInfo <span class="keyword">of</span> deviceInfoArray) &#123;</span><br><span class="line">    <span class="keyword">let</span> option = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;option&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;microphoneList&quot;</span>).<span class="title function_">appendChild</span>(option);</span><br><span class="line">    option.<span class="property">innerHTML</span> = deviceInfo.<span class="property">label</span>;</span><br><span class="line">    dict[deviceInfo.<span class="property">label</span>] = deviceInfo.<span class="property">deviceId</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Failed to get microphones!&quot;</span>, e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据下拉菜单选择的设备标签，显示相应的设备 ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDeviceId</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> microphoneList = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;microphoneList&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> deviceLabel = microphoneList.<span class="property">options</span>[microphoneList.<span class="property">selectedIndex</span>].<span class="property">text</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;deviceId&quot;</span>).<span class="property">innerHTML</span> = dict[deviceLabel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-创建麦克风音频轨道并渲染"><a href="#3-创建麦克风音频轨道并渲染" class="headerlink" title="3. 创建麦克风音频轨道并渲染"></a>3. 创建麦克风音频轨道并渲染</h3><p>调用 <code>createMicrophoneAudioTrack</code> 创建麦克风音频轨道并调用成员方法 <code>play</code> 通过系统默认扬声器对视频进行渲染。这里轨道的概念和 WebRTC 中的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStreamTrack">track</a> 相似。一个轨道代表一路特定的视频源或音频源。声网 SDK 将不同来源的音视频轨道进行抽象，定义了摄像头视频轨道、屏幕采集视频轨道及自定义源视频轨道等。</p><blockquote><p>这个步骤只是为了演示麦克风音频轨道的渲染。实际开发通话应用时，本地不需要播放本地麦克风采集的音频。</p></blockquote><ol><li><p><strong>HTML</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>通过麦克风采集并在本地渲染音频<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span> 选择你要使用的麦克风 <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;microphoneList&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;getDeviceId()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span> ---选择麦克风--- <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>你选择设备的 deviceId 是：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;deviceId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>CSS</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">font-family</span>: system-ui;<span class="attribute">background</span>: <span class="number">#f06d06</span>;<span class="attribute">color</span>: white;<span class="attribute">text-align</span>: center;&#125;</span><br><span class="line"><span class="selector-tag">div</span> &#123;<span class="attribute">height</span>: <span class="number">200px</span>;<span class="attribute">width</span>: <span class="number">50%</span>;&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局变量</span></span><br><span class="line"><span class="keyword">let</span> dict = &#123;&#125;; <span class="comment">// 使用 dict 映射设备标签和设备 ID</span></span><br><span class="line"><span class="keyword">let</span> selectedDeviceId = <span class="string">&quot;&quot;</span>; <span class="comment">// 下选框选择的设备对应的 ID</span></span><br><span class="line"><span class="keyword">let</span> microphoneAudioTrack = <span class="literal">null</span>; <span class="comment">// 麦克风音频轨道对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取本地麦克风列表</span></span><br><span class="line"><span class="title class_">AgoraRTC</span>.<span class="title function_">getMicrophones</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">deviceInfoArray</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> deviceInfo <span class="keyword">of</span> deviceInfoArray) &#123;</span><br><span class="line">    <span class="keyword">let</span> option = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;option&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;microphoneList&quot;</span>).<span class="title function_">appendChild</span>(option);</span><br><span class="line">    option.<span class="property">innerHTML</span> = deviceInfo.<span class="property">label</span>;</span><br><span class="line">    dict[deviceInfo.<span class="property">label</span>] = deviceInfo.<span class="property">deviceId</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Failed to get microphones!&quot;</span>, e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建麦克风音频轨道</span></span><br><span class="line"><span class="title class_">AgoraRTC</span>.<span class="title function_">createMicrophoneAudioTrack</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">microphoneAudioTrack</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染音频。SDK 使用系统默认的扬声器播放声音。</span></span><br><span class="line">    microphoneAudioTrack.<span class="title function_">play</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Failed to play audio!&quot;</span>, e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据选择的设备标签，返回对应的设备 ID 并传给麦克风音频轨道</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDeviceId</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">let</span> microphoneList = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;microphoneList&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> deviceLabel = microphoneList.<span class="property">options</span>[microphoneList.<span class="property">selectedIndex</span>].<span class="property">text</span>;</span><br><span class="line">selectedDeviceId = dict[deviceLabel];</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;deviceId&quot;</span>).<span class="property">innerHTML</span> = selectedDeviceId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (microphoneAudioTrack != <span class="literal">null</span>) &#123;</span><br><span class="line">    microphoneAudioTrack.<span class="title function_">setDevice</span>(selectedDeviceId);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="音频回调"><a href="#音频回调" class="headerlink" title="#音频回调"></a>#音频回调</h3><blockquote><p>setAudioFrameCallback</p><ul><li><p>setAudioFrameCallback(audioFrameCallback: <em>null</em> | <em>function</em>, frameSize?: <em>undefined</em> | <em>number</em>): <em>void</em></p></li><li><p>设置原始音频数据（PCM）回调。</p><p>设置成功后，SDK 会不断地将远端音频轨道的音频帧以 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer">AudioBuffer</a> 的形式通过回调返回。</p><blockquote><p>你可以通过 <code>frameSize</code> 来设置每次回调中音频帧的大小。该设置也会影响回调的间隔，<code>frameSize</code> 越大，每次回调的音频数据越多，回调间隔越长。</p></blockquote></li></ul></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">track.<span class="title function_">setAudioFrameCallback</span>(<span class="function">(<span class="params">buffer</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> channel = <span class="number">0</span>; channel &lt; buffer.<span class="property">numberOfChannels</span>; channel += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// Float32Array with PCM data</span></span><br><span class="line">    <span class="keyword">const</span> currentChannelData = buffer.<span class="title function_">getChannelData</span>(channel);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;PCM data in channel&quot;</span>, channel, currentChannelData);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">2048</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="comment">// Stop getting the raw audio data</span></span><br><span class="line">track.<span class="title function_">setAudioFrameCallback</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h4 id="音频回调解码"><a href="#音频回调解码" class="headerlink" title="音频回调解码"></a>音频回调解码</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer">AudioBuffer - Web API 接口参考 | MDN</a></p><p>AudioBuffer 接口表示存在内存里的一段短小的音频资源，利用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BaseAudioContext/decodeAudioData"><code>AudioContext.decodeAudioData()</code></a>方法从一个音频文件构建，或者利用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BaseAudioContext/createBuffer"><code>AudioContext.createBuffer()</code></a>从原始数据构建。把音频放入 AudioBuffer 后，可以传入到一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBufferSourceNode"><code>AudioBufferSourceNode</code></a>进行播放。</p><p>这些类型对象被设计来控制小音频片段，往往短于 45 秒。对于更长的声音，通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaElementAudioSourceNode"><code>MediaElementAudioSourceNode</code></a>来实现更为合适。缓存区（buffer）包含以下数据：不间断的 IEEE754 32 位线性 PCM，从-1 到 1 的范围额定，就是说，32 位的浮点缓存区的每个样本在-1.0 到 1.0 之间。如果<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer"><code>AudioBuffer</code></a>有不同的频道，他们通常被保存在独立的缓存区。</p><h5 id="1-属性"><a href="#1-属性" class="headerlink" title="1) 属性"></a>1) <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer#%E5%B1%9E%E6%80%A7">属性</a></h5><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/sampleRate"><code>AudioBuffer.sampleRate</code></a> 只读</p><p>存储在缓存区的 PCM 数据的采样率：浮点数，单位为 sample&#x2F;s。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/length"><code>AudioBuffer.length</code></a> 只读</p><p>返回存储在缓存区的 PCM 数据的采样帧数：整形。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/duration"><code>AudioBuffer.duration</code></a> 只读</p><p>返回存储在缓存区的 PCM 数据的时长：双精度型（单位为秒）。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/numberOfChannels"><code>AudioBuffer.numberOfChannels</code></a> 只读</p><p>返回存储在缓存区的 PCM 数据的通道数：整形。</p></li></ul><h5 id="2-方法"><a href="#2-方法" class="headerlink" title="2) 方法"></a>2) <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer#%E6%96%B9%E6%B3%95">方法</a></h5><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/getChannelData"><code>AudioBuffer.getChannelData()</code></a></p><p>返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code>Float32Array</code></a>，包含了带有频道的 PCM 数据，由频道参数定义（有 0 代表第一个频道）</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer/copyFromChannel"><code>AudioBuffer.copyFromChannel()</code></a></p><p>从 AudioBuffer 的指定频道复制到数组终端。</p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer/copyToChannel"><code>AudioBuffer.copyToChannel()</code> (en-US)</a></p><p>复制样品到原数组的 AudioBuffer 的指定频道</p></li></ul><h5 id="3-例子"><a href="#3-例子" class="headerlink" title="3) 例子"></a>3) <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer#%E4%BE%8B%E5%AD%90">例子</a></h5><p>以下的例子展示了如何构建一个 AudioBuffer 以及随机用白噪音填充。你可以在 <a href="https://github.com/mdn/webaudio-examples/tree/master/audio-buffer">audio-buffer demo</a>库发现完整的源代码；一个<a href="https://mdn.github.io/webaudio-examples/audio-buffer/">running live</a> 的版本也可获得。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stereo</span></span><br><span class="line"><span class="keyword">var</span> channels = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an empty two second stereo buffer at the</span></span><br><span class="line"><span class="comment">// sample rate of the AudioContext</span></span><br><span class="line"><span class="keyword">var</span> frameCount = audioCtx.<span class="property">sampleRate</span> * <span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">var</span> myArrayBuffer = audioCtx.<span class="title function_">createBuffer</span>(channels, frameCount, audioCtx.<span class="property">sampleRate</span>);</span><br><span class="line"></span><br><span class="line">button.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Fill the buffer with white noise;</span></span><br><span class="line">  <span class="comment">// just random values between -1.0 and 1.0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> channel = <span class="number">0</span>; channel &lt; channels; channel++) &#123;</span><br><span class="line">    <span class="comment">// This gives us the actual array that contains the data</span></span><br><span class="line">    <span class="keyword">var</span> nowBuffering = myArrayBuffer.<span class="title function_">getChannelData</span>(channel);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; frameCount; i++) &#123;</span><br><span class="line">      <span class="comment">// Math.random() is in [0; 1.0]</span></span><br><span class="line">      <span class="comment">// audio needs to be in [-1.0; 1.0]</span></span><br><span class="line">      nowBuffering[i] = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get an AudioBufferSourceNode.</span></span><br><span class="line">  <span class="comment">// This is the AudioNode to use when we want to play an AudioBuffer</span></span><br><span class="line">  <span class="keyword">var</span> source = audioCtx.<span class="title function_">createBufferSource</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set the buffer in the AudioBufferSourceNode</span></span><br><span class="line">  source.<span class="property">buffer</span> = myArrayBuffer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// connect the AudioBufferSourceNode to the</span></span><br><span class="line">  <span class="comment">// destination so we can hear the sound</span></span><br><span class="line">  source.<span class="title function_">connect</span>(audioCtx.<span class="property">destination</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// start the source playing</span></span><br><span class="line">  source.<span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-规格参数"><a href="#4-规格参数" class="headerlink" title="4) 规格参数"></a>4) <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AudioBuffer#%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0">规格参数</a></h5><table><thead><tr><th align="left">Specification</th></tr></thead><tbody><tr><td align="left"><a href="https://webaudio.github.io/web-audio-api/#AudioBuffer">Web Audio API # AudioBuffer</a></td></tr></tbody></table><h2 id="录音对象属性"><a href="#录音对象属性" class="headerlink" title="录音对象属性"></a>录音对象属性</h2><p><a href="https://docs.agora.io/cn/Voice/API%20Reference/web_ng/interfaces/microphoneaudiotrackinitconfig.html">Agora Web API Reference - 语音通话 - 文档中心 - 声网Agora</a></p><h2 id="音频编码"><a href="#音频编码" class="headerlink" title="音频编码"></a>音频编码</h2><h3 id="AudioEncoderConfigurationPreset"><a href="#AudioEncoderConfigurationPreset" class="headerlink" title="AudioEncoderConfigurationPreset"></a>AudioEncoderConfigurationPreset</h3><p>AudioEncoderConfigurationPreset: <em>keyof typeof AUDIO_ENCODER_CONFIG_SETTINGS</em></p><p>SDK 预设的 [AudioEncoderConfiguration](<a href="https://docs.agora.io/cn/Voice/API">https://docs.agora.io/cn/Voice/API</a> Reference&#x2F;web_ng&#x2F;interfaces&#x2F;audioencoderconfiguration.html) 配置。</p><p>你可以在以下方法中传入预设值来控制本地音频的编码配置：</p><ul><li>[AgoraRTC.createCustomAudioTrack](<a href="https://docs.agora.io/cn/Voice/API">https://docs.agora.io/cn/Voice/API</a> Reference&#x2F;web_ng&#x2F;interfaces&#x2F;iagorartc.html#createcustomaudiotrack)</li><li>[AgoraRTC.createMicrophoneAudioTrack](<a href="https://docs.agora.io/cn/Voice/API">https://docs.agora.io/cn/Voice/API</a> Reference&#x2F;web_ng&#x2F;interfaces&#x2F;iagorartc.html#createmicrophoneaudiotrack)</li><li>[AgoraRTC.createBufferSourceAudioTrack](<a href="https://docs.agora.io/cn/Voice/API">https://docs.agora.io/cn/Voice/API</a> Reference&#x2F;web_ng&#x2F;interfaces&#x2F;iagorartc.html#createbuffersourceaudiotrack)</li></ul><p>下表列出了 SDK 所有内置的音频属性配置，SDK 默认使用 <code>&quot;music_standard&quot;</code>。</p><table><thead><tr><th align="left">音频属性</th><th align="left">配置</th></tr></thead><tbody><tr><td align="left"><code>&quot;speech_low_quality&quot;</code></td><td align="left">16 kHz 采样率，单声道，编码码率约 24 Kbps</td></tr><tr><td align="left"><code>&quot;speech_standard&quot;</code></td><td align="left">32 kHz 采样率，单声道，编码码率约 24 Kbps</td></tr><tr><td align="left"><code>&quot;music_standard&quot;</code></td><td align="left">48 kHz 采样率，单声道，编码码率约 40 Kbps</td></tr><tr><td align="left"><code>&quot;standard_stereo&quot;</code></td><td align="left">48 kHz 采样率，双声道，编码码率约 64 Kbps</td></tr><tr><td align="left"><code>&quot;high_quality&quot;</code></td><td align="left">48 kHz 采样率，单声道， 编码码率约 128 Kbps</td></tr><tr><td align="left"><code>&quot;high_quality_stereo&quot;</code></td><td align="left">48 kHz 采样率，双声道，编码码率约 192 Kbps</td></tr></tbody></table><h1 id="本地音频轨道"><a href="#本地音频轨道" class="headerlink" title="本地音频轨道"></a>本地音频轨道</h1><p><a href="https://docs.agora.io/cn/Voice/API%20Reference/web_ng/interfaces/ilocalaudiotrack.html">Agora Web API Reference - 语音通话 - 文档中心 - 声网Agora</a></p><h1 id="对接"><a href="#对接" class="headerlink" title="对接"></a>对接</h1><p><a href="https://www.agora.io/cn/community/blog-119-category-24195">基于声网 Web SDK 实现视频通话场景 - 专栏 - 声网 Agora RTC 开发者社区</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
            <tag> TypeScript </tag>
            
            <tag> fastboard </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>音频房间创建及连接说明</title>
      <link href="/Code/TypeScript/%E9%9F%B3%E9%A2%91%E4%BC%A0%E8%BE%93/"/>
      <url>/Code/TypeScript/%E9%9F%B3%E9%A2%91%E4%BC%A0%E8%BE%93/</url>
      
        <content type="html"><![CDATA[<h1 id="声网开源通话代码"><a href="#声网开源通话代码" class="headerlink" title="声网开源通话代码"></a>声网开源通话代码</h1><p><a href="https://github.com/AgoraIO/API-Examples-Web/tree/main/Demo/selfRendering">API-Examples-Web&#x2F;Demo&#x2F;selfRendering at main · AgoraIO&#x2F;API-Examples-Web</a></p><h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/TypeScript/images/%E9%9F%B3%E9%A2%91%E4%BC%A0%E8%BE%93/1.png" alt="image-20220802150315495"></p><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.banner</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#52575c</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-text</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#join-form</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tips</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.join-info-text</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">480px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">320px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-name</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#success-alert</span>, <span class="selector-id">#success-alert-with-token</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">640px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.player</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">320px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">240px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Video Self-Rendering -- Agora<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../assets/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid banner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;banner-text&quot;</span>&gt;</span>Video Self-Rendering<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: rgb(255, 255, 255);fill: rgb(255, 255, 255);fill-rule: evenodd; position: absolute; right: 10px; top: 4px;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;Header-link &quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/AgoraIO/API-Examples-Web/tree/main/Demo&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;octicon octicon-mark-github v-align-middle&quot;</span> <span class="attr">height</span>=<span class="string">&quot;32&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 16 16&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">fill-rule</span>=<span class="string">&quot;evenodd&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;success-alert&quot;</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-success alert-dismissible fade show&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">strong</span>&gt;</span>Congratulations!<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> You can invite others to watch your live by click <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;alert&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Close&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;join-form&quot;</span> <span class="attr">name</span>=<span class="string">&quot;join-form&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row join-info-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;join-info-text&quot;</span>&gt;</span>AppID<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;appid&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;enter appid&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span>&gt;</span>If you don`t know what is your appid, checkout <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://docs.agora.io/en/Agora%20Platform/terms?platform=All%20Platforms#a-nameappidaapp-id&quot;</span>&gt;</span>this<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;join-info-text&quot;</span>&gt;</span>Token(optional)<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;token&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;enter token&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span>&gt;</span>If you don`t know what is your token, checkout <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://docs.agora.io/en/Agora%20Platform/terms?platform=All%20Platforms#a-namekeyadynamic-key&quot;</span>&gt;</span>this<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;join-info-text&quot;</span>&gt;</span>Channel<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;channel&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;enter channel name&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span>&gt;</span>If you don`t know what is your channel, checkout <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://docs.agora.io/en/Agora%20Platform/terms?platform=All%20Platforms#channel&quot;</span>&gt;</span>this<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;join-info-text&quot;</span>&gt;</span>User ID(optional)<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">onkeyup</span>=<span class="string">&quot;this.value=this.value.replace(/[^0-9]/g,&#x27;&#x27;)&quot;</span> <span class="attr">onafterpaste</span>=<span class="string">&quot;this.value=this.value.replace(/[^0-9]/g,&#x27;&#x27;)&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter the user ID&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;host-join&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-sm&quot;</span>&gt;</span>Join as host<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;audience-join&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-sm&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">aria-haspopup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            Join as audience</span><br><span class="line">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;audience dropdown-menu&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;lowLatency&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Interactive Live Streaming Standard&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Interactive Live Streaming Standard<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;ultraLowLatency&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Interactive Live Streaming Premium&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Interactive Live Streaming Premium<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;leave&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-sm&quot;</span> <span class="attr">disabled</span>&gt;</span>Leave<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Single button --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row video-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;local-player-name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;player-name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;local-player&quot;</span> <span class="attr">class</span>=<span class="string">&quot;player&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;local-player-mirror-area&quot;</span> <span class="attr">class</span>=<span class="string">&quot;player video-mirror&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Video Mirror&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none; border: 2px dashed red ;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;local-player-mirror&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100%; position: relative; overflow: hidden; background-color: black;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;local-player-mirror-video-track&quot;</span> <span class="attr">class</span>=<span class="string">&quot;agora_video_player&quot;</span> <span class="attr">playsinline</span>=<span class="string">&quot;&quot;</span> <span class="attr">muted</span>=<span class="string">&quot;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100%; position: absolute; left: 0px; top: 0px; transform: rotateY(180deg); object-fit: cover;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;w-100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;remote-playerlist&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../assets/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../assets/bootstrap.bundle.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://download.agora.io/sdk/release/AgoraRTC_N.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="通话逻辑"><a href="#通话逻辑" class="headerlink" title="通话逻辑"></a>通话逻辑</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create Agora client</span></span><br><span class="line"><span class="keyword">var</span> client = <span class="title class_">AgoraRTC</span>.<span class="title function_">createClient</span>(&#123;<span class="attr">mode</span>: <span class="string">&quot;live&quot;</span>, <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span>&#125;);</span><br><span class="line"><span class="title class_">AgoraRTC</span>.<span class="title function_">enableLogUpload</span>();</span><br><span class="line"><span class="keyword">var</span> localTracks = &#123;</span><br><span class="line">    <span class="attr">videoTrack</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">audioTrack</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> remoteUsers = &#123;&#125;;</span><br><span class="line"><span class="comment">// Agora client options</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">appid</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">channel</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">uid</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">token</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">role</span>: <span class="string">&quot;audience&quot;</span>, <span class="comment">// host or audience</span></span><br><span class="line">    <span class="attr">audienceLatency</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the demo can auto join channel with params in url</span></span><br><span class="line">$(() =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> urlParams = <span class="keyword">new</span> <span class="title function_">URL</span>(location.<span class="property">href</span>).<span class="property">searchParams</span>;</span><br><span class="line">    options.<span class="property">appid</span> = urlParams.<span class="title function_">get</span>(<span class="string">&quot;appid&quot;</span>);</span><br><span class="line">    options.<span class="property">channel</span> = urlParams.<span class="title function_">get</span>(<span class="string">&quot;channel&quot;</span>);</span><br><span class="line">    options.<span class="property">token</span> = urlParams.<span class="title function_">get</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    options.<span class="property">uid</span> = urlParams.<span class="title function_">get</span>(<span class="string">&quot;uid&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">appid</span> &amp;&amp; options.<span class="property">channel</span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#uid&quot;</span>).<span class="title function_">val</span>(options.<span class="property">uid</span>);</span><br><span class="line">        $(<span class="string">&quot;#appid&quot;</span>).<span class="title function_">val</span>(options.<span class="property">appid</span>);</span><br><span class="line">        $(<span class="string">&quot;#token&quot;</span>).<span class="title function_">val</span>(options.<span class="property">token</span>);</span><br><span class="line">        $(<span class="string">&quot;#channel&quot;</span>).<span class="title function_">val</span>(options.<span class="property">channel</span>);</span><br><span class="line">        $(<span class="string">&quot;#join-form&quot;</span>).<span class="title function_">submit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#host-join&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    options.<span class="property">role</span> = <span class="string">&quot;host&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#lowLatency&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    options.<span class="property">role</span> = <span class="string">&quot;audience&quot;</span></span><br><span class="line">    options.<span class="property">audienceLatency</span> = <span class="number">1</span></span><br><span class="line">    $(<span class="string">&quot;#join-form&quot;</span>).<span class="title function_">submit</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#ultraLowLatency&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    options.<span class="property">role</span> = <span class="string">&quot;audience&quot;</span></span><br><span class="line">    options.<span class="property">audienceLatency</span> = <span class="number">2</span></span><br><span class="line">    $(<span class="string">&quot;#join-form&quot;</span>).<span class="title function_">submit</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#join-form&quot;</span>).<span class="title function_">submit</span>(<span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    $(<span class="string">&quot;#host-join&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    $(<span class="string">&quot;#audience-join&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        options.<span class="property">appid</span> = $(<span class="string">&quot;#appid&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        options.<span class="property">token</span> = $(<span class="string">&quot;#token&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        options.<span class="property">channel</span> = $(<span class="string">&quot;#channel&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        options.<span class="property">uid</span> = <span class="title class_">Number</span>($(<span class="string">&quot;#uid&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">join</span>();</span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">role</span> === <span class="string">&quot;host&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;#success-alert a&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>, <span class="string">`index.html?appid=<span class="subst">$&#123;options.appid&#125;</span>&amp;channel=<span class="subst">$&#123;options.channel&#125;</span>&amp;token=<span class="subst">$&#123;options.token&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">if</span> (options.<span class="property">token</span>) &#123;</span><br><span class="line">                $(<span class="string">&quot;#success-alert-with-token&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;block&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $(<span class="string">&quot;#success-alert a&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>, <span class="string">`index.html?appid=<span class="subst">$&#123;options.appid&#125;</span>&amp;channel=<span class="subst">$&#123;options.channel&#125;</span>&amp;token=<span class="subst">$&#123;options.token&#125;</span>`</span>);</span><br><span class="line">                $(<span class="string">&quot;#success-alert&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;block&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        $(<span class="string">&quot;#leave&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#leave&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">leave</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">join</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// create Agora client</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">role</span> === <span class="string">&quot;audience&quot;</span>) &#123;</span><br><span class="line">        client.<span class="title function_">setClientRole</span>(options.<span class="property">role</span>, &#123;<span class="attr">level</span>: options.<span class="property">audienceLatency</span>&#125;);</span><br><span class="line">        <span class="comment">// add event listener to play remote tracks when remote user publishs.</span></span><br><span class="line">        client.<span class="title function_">on</span>(<span class="string">&quot;user-published&quot;</span>, handleUserPublished);</span><br><span class="line">        client.<span class="title function_">on</span>(<span class="string">&quot;user-unpublished&quot;</span>, handleUserUnpublished);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        client.<span class="title function_">setClientRole</span>(options.<span class="property">role</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// join the channel</span></span><br><span class="line">    options.<span class="property">uid</span> = <span class="keyword">await</span> client.<span class="title function_">join</span>(options.<span class="property">appid</span>, options.<span class="property">channel</span>, options.<span class="property">token</span> || <span class="literal">null</span>, options.<span class="property">uid</span> || <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">role</span> === <span class="string">&quot;host&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// create local audio and video tracks</span></span><br><span class="line">        localTracks.<span class="property">audioTrack</span> = <span class="keyword">await</span> <span class="title class_">AgoraRTC</span>.<span class="title function_">createMicrophoneAudioTrack</span>();</span><br><span class="line">        localTracks.<span class="property">videoTrack</span> = <span class="keyword">await</span> <span class="title class_">AgoraRTC</span>.<span class="title function_">createCameraVideoTrack</span>();</span><br><span class="line">        <span class="comment">// play local video track</span></span><br><span class="line">        localTracks.<span class="property">videoTrack</span>.<span class="title function_">play</span>(<span class="string">&quot;local-player&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#local-player-name&quot;</span>).<span class="title function_">text</span>(<span class="string">`localTrack(<span class="subst">$&#123;options.uid&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create the mirror of local player</span></span><br><span class="line">        $(<span class="string">&quot;#local-player-mirror-area&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">        <span class="keyword">var</span> mirrorPlayer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;local-player-mirror-video-track&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//get browser-native object MediaStreamTrack from WebRTC SDK</span></span><br><span class="line">        <span class="keyword">const</span> msTrack = localTracks.<span class="property">videoTrack</span>.<span class="title function_">getMediaStreamTrack</span>();</span><br><span class="line">        <span class="comment">//generate browser-native object MediaStream with above video track</span></span><br><span class="line">        <span class="keyword">const</span> ms = <span class="keyword">new</span> <span class="title class_">MediaStream</span>([msTrack])</span><br><span class="line">        mirrorPlayer.<span class="property">srcObject</span> = ms;</span><br><span class="line">        mirrorPlayer.<span class="title function_">play</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// publish local tracks to channel</span></span><br><span class="line">        <span class="keyword">await</span> client.<span class="title function_">publish</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(localTracks));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;publish success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">leave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (trackName <span class="keyword">in</span> localTracks) &#123;</span><br><span class="line">        <span class="keyword">var</span> track = localTracks[trackName];</span><br><span class="line">        <span class="keyword">if</span> (track) &#123;</span><br><span class="line">            track.<span class="title function_">stop</span>();</span><br><span class="line">            track.<span class="title function_">close</span>();</span><br><span class="line">            localTracks[trackName] = <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove remote users and player views</span></span><br><span class="line">    remoteUsers = &#123;&#125;;</span><br><span class="line">    $(<span class="string">&quot;#remote-playerlist&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leave the channel</span></span><br><span class="line">    <span class="keyword">await</span> client.<span class="title function_">leave</span>();</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#local-player-name&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    $(<span class="string">&quot;#host-join&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    $(<span class="string">&quot;#audience-join&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    $(<span class="string">&quot;#leave&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    $(<span class="string">&quot;.video-mirror&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;client leaves channel success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">user, mediaType</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> uid = user.<span class="property">uid</span>;</span><br><span class="line">    <span class="comment">// subscribe to a remote user</span></span><br><span class="line">    <span class="keyword">await</span> client.<span class="title function_">subscribe</span>(user, mediaType);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;subscribe success&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (mediaType === <span class="string">&#x27;video&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> player = $(<span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;player-wrapper-<span class="subst">$&#123;uid&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p class=&quot;player-name&quot;&gt;remoteUser(<span class="subst">$&#123;uid&#125;</span>)&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;div id=&quot;player-<span class="subst">$&#123;uid&#125;</span>&quot; class=&quot;player&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;p class=&quot;player-name&quot;&gt;Video Mirror&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;div id=&quot;player-<span class="subst">$&#123;uid&#125;</span>-mirror-area&quot; class=&quot;player&quot; style=&quot;border: 2px dashed red ;&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div style=&quot;width: 100%; height: 100%; position: relative; overflow: hidden; background-color: black;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;video id=&quot;video_track-video-<span class="subst">$&#123;uid&#125;</span>-mirror&quot; </span></span><br><span class="line"><span class="string">                    class=&quot;agora_video_player&quot; playsinline=&quot;&quot; muted=&quot;&quot; </span></span><br><span class="line"><span class="string">                    style=&quot;width: 100%; height: 100%; position: absolute; left: 0px; top: 0px; object-fit: contain;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;/video&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>);</span><br><span class="line">        $(<span class="string">&quot;#remote-playerlist&quot;</span>).<span class="title function_">append</span>(player);</span><br><span class="line">        user.<span class="property">videoTrack</span>.<span class="title function_">play</span>(<span class="string">`player-<span class="subst">$&#123;uid&#125;</span>`</span>, &#123;<span class="attr">fit</span>:<span class="string">&quot;contain&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//handling the mirror video</span></span><br><span class="line">        $(<span class="string">`#player-<span class="subst">$&#123;uid&#125;</span>-mirror-area`</span>).<span class="title function_">show</span>();</span><br><span class="line">        <span class="keyword">var</span> mirrorRemotePlayer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">`video_track-video-<span class="subst">$&#123;uid&#125;</span>-mirror`</span>);</span><br><span class="line">        <span class="comment">//get browser-native object MediaStreamTrack from WebRTC SDK</span></span><br><span class="line">        <span class="keyword">const</span> msTrack = user.<span class="property">videoTrack</span>.<span class="title function_">getMediaStreamTrack</span>();</span><br><span class="line">        <span class="comment">//generate browser-native object MediaStream with above video track</span></span><br><span class="line">        <span class="keyword">const</span> ms = <span class="keyword">new</span> <span class="title class_">MediaStream</span>([msTrack])</span><br><span class="line">        mirrorRemotePlayer.<span class="property">srcObject</span> = ms;</span><br><span class="line">        mirrorRemotePlayer.<span class="title function_">play</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mediaType === <span class="string">&#x27;audio&#x27;</span>) &#123;</span><br><span class="line">        user.<span class="property">audioTrack</span>.<span class="title function_">play</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleUserPublished</span>(<span class="params">user, mediaType</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = user.<span class="property">uid</span>;</span><br><span class="line">    remoteUsers[id] = user;</span><br><span class="line">    <span class="title function_">subscribe</span>(user, mediaType);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleUserUnpublished</span>(<span class="params">user, mediaType</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaType === <span class="string">&#x27;video&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> id = user.<span class="property">uid</span>;</span><br><span class="line">        <span class="keyword">delete</span> remoteUsers[id];</span><br><span class="line">        $(<span class="string">`#player-wrapper-<span class="subst">$&#123;id&#125;</span>`</span>).<span class="title function_">remove</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="改动点"><a href="#改动点" class="headerlink" title="改动点"></a>改动点</h1><p>新建一个配置页面，由用户进入房间时填写 <code>AppId</code>,<code>token</code>,<code>channel</code>等</p><p><code>js</code> 代码改动点：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options.<span class="property">appid</span> = $(<span class="string">&quot;#appid&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">options.<span class="property">token</span> = $(<span class="string">&quot;#token&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">options.<span class="property">channel</span> = $(<span class="string">&quot;#channel&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">options.<span class="property">uid</span> = <span class="title class_">Number</span>($(<span class="string">&quot;#uid&quot;</span>).<span class="title function_">val</span>());</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> TypeScript </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu22.04安装 MYSQL 并使用 navicat 连接</title>
      <link href="/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL/README/"/>
      <url>/Code/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL/README/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Ubuntu 安装 mysql 的教程网上一大堆。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ol><li>修改配置文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>[mysqld]</code> 添加 <code>skip-grant-tables</code></li></ol><p><img src="/images/README/readme-1.png" alt="修改配置"></p><ol start="3"><li>重启数据库</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"></span><br><span class="line">sudo service mysql restart</span><br></pre></td></tr></table></figure><h1 id="修改用户属性"><a href="#修改用户属性" class="headerlink" title="修改用户属性"></a>修改用户属性<a id="modifyuser"></a></h1><ol><li>进入 <code>mysql</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -u root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 mysql 数据库</span></span><br><span class="line">use mysql;</span><br></pre></td></tr></table></figure><ol start="2"><li>更新用户密码</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alter user root identified with mysql_native_password by <span class="string">&#x27;Admin1234&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"></span><br><span class="line">update user <span class="built_in">set</span> authentication_string=<span class="string">&#x27;Admin1234&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;admin&#x27;</span>;</span><br></pre></td></tr></table></figure><p>到此就可以使用用户登录了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><ol start="3"><li>补充，创建其他用户</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED BY <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="授权远程使用"><a href="#授权远程使用" class="headerlink" title="授权远程使用"></a>授权远程使用</h1><blockquote><p>更改授权后，一定要执行 <code>flush priviledges;</code>。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>执行上一步可能会报错，因为在 <a href="#modifyuser">上一步</a> 修改用户密码时，设置了地址为 <code>localhost</code>。所以这里不能直接授权其他主机访问，需要先把root账号的host修改为可以访问所有主机，再去授权。</p><ul><li>修改root账户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update user <span class="built_in">set</span> host=<span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush priviledges;</span><br></pre></td></tr></table></figure><ul><li>授权远程使用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant all on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush priviledges;</span><br></pre></td></tr></table></figure><ul><li>重启数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"></span><br><span class="line">sudo service mysql restart</span><br></pre></td></tr></table></figure><h1 id="使用-navicat-连接数据库"><a href="#使用-navicat-连接数据库" class="headerlink" title="使用 navicat 连接数据库"></a>使用 <code>navicat</code> 连接数据库</h1><blockquote><p>如果出现连接时报错 <code>1130-host ... is not allowed to connect to this MySql server</code>。则说明是服务器端口权限没开放。简单改动可直接使用ufw命令。如下所示：</p><p><code>sudo ufw allow 3306</code></p></blockquote><p>如下图所示：</p><ul><li>连接名：随便起名，用来区分连接的数据库</li><li>主机：<code>192.168.0.102</code> 为虚拟机的ip地址</li><li>端口：3306,mysql默认端口</li><li>用户名：root</li><li>密码：密码</li></ul><p><img src="/images/README/navicat.png" alt="navicat"></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> 数据库 </category>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> navicat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 键盘长按</title>
      <link href="/Code/Qt/%E9%BC%A0%E6%A0%87%E9%94%AE%E7%9B%98/Qt%E9%94%AE%E7%9B%98%E9%95%BF%E6%8C%89/"/>
      <url>/Code/Qt/%E9%BC%A0%E6%A0%87%E9%94%AE%E7%9B%98/Qt%E9%94%AE%E7%9B%98%E9%95%BF%E6%8C%89/</url>
      
        <content type="html"><![CDATA[<h1 id="KeyPressEvent-事件"><a href="#KeyPressEvent-事件" class="headerlink" title="KeyPressEvent 事件"></a><code>KeyPressEvent</code> 事件</h1><p>键盘事件是重写 <code>keypressevent</code> 函数，详见代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//keyLongPress.cpp</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;keyLongPress.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_keyLongPress.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">KeyLongPress::<span class="built_in">KeyLongPress</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QWidget</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::KeyLongPress)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">KeyLongPress::~<span class="built_in">KeyLongPress</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//QMouseEvent没有isAutoRepeat()方法...无语了，</span></span><br><span class="line"><span class="comment">//这样有些操作就不方便实现了，</span></span><br><span class="line"><span class="comment">//比如长按鼠标多少秒呼出某个(登录)窗口啥的。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//! [按键按下事件-Begin]</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">KeyLongPress::keyPressEvent</span><span class="params">(QKeyEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">isAutoRepeat</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt;  <span class="string">&quot;按键长按中...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;按键按下&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//! [按键按下事件-End]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//! [按键释放事件-Begin]</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">KeyLongPress::keyReleaseEvent</span><span class="params">(QKeyEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">isAutoRepeat</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt;  <span class="string">&quot;按键不断释放...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;按键释放&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//! [按键释放事件-End]</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><h2 id="运行之后，测试效果："><a href="#运行之后，测试效果：" class="headerlink" title="运行之后，测试效果："></a>运行之后，测试效果：</h2><p>你Click看下输出：是只有1次Press和1次Release的，</p><p>长按看下输出：是Press和Release一直在不停的输出的。</p><p>示意图：</p><p><img src="/images/Qt%E9%94%AE%E7%9B%98%E9%95%BF%E6%8C%89/1.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 鼠标键盘 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 键盘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 圆形进度条</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%9C%86%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%9C%86%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h1><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%8A%A8%E7%94%BB/images/Qt%E5%9C%86%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1/1.gif" alt="img"></p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%8A%A8%E7%94%BB/images/Qt%E5%9C%86%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1/2.gif" alt="img"></p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%8A%A8%E7%94%BB/images/Qt%E5%9C%86%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1/3.gif" alt="img"></p><h1 id="h"><a href="#h" class="headerlink" title="h"></a>h</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _QROUNDPROGRESSBAR_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _QROUNDPROGRESSBAR_H_</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QRoundProgressBar</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//进度条形状</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">BarStyle</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//圆环状</span></span><br><span class="line">        StyleDonut = <span class="number">0</span>,</span><br><span class="line">        <span class="comment">//圆饼状</span></span><br><span class="line">        StylePie,</span><br><span class="line">        <span class="comment">//圆线状</span></span><br><span class="line">        StyleLine</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">QRoundProgressBar</span>(QWidget *parent , BarStyle style = StyleLine);</span><br><span class="line">    ~<span class="built_in">QRoundProgressBar</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//设置扫描弧度起始角度</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setStartAngle</span><span class="params">(<span class="type">double</span> position)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置轮廓画笔的宽度</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setOutlinePenWidth</span><span class="params">(<span class="type">double</span> penWidth)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置画笔宽度</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setDataPenWidth</span><span class="params">(<span class="type">double</span> penWidth)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置进度条精度 88.88%,几位小数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setDecimals</span><span class="params">(<span class="type">int</span> count)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置进度条风格</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBarStyle</span><span class="params">(BarStyle style)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置范围</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setRange</span><span class="params">(<span class="type">double</span> min, <span class="type">double</span> max)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置当前值</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">int</span> val)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置当前值</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">double</span> val)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置最小值</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMinimum</span><span class="params">(<span class="type">double</span> min)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置最大值</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMaximum</span><span class="params">(<span class="type">double</span> max)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *event)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//画基础图形</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawBase</span><span class="params">(QPainter&amp; p, <span class="type">const</span> QRectF&amp; baseRect, <span class="type">const</span> QRectF &amp;innerRect)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//根据值画出进度条</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawValue</span><span class="params">(QPainter&amp; p, <span class="type">const</span> QRectF&amp; baseRect, <span class="type">double</span> value, <span class="type">double</span> arcLength, <span class="type">const</span> QRectF &amp; innerRect</span></span></span><br><span class="line"><span class="params"><span class="function">        , <span class="type">double</span> innerDiameter)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//画中心文字</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawText</span><span class="params">(QPainter&amp; p, <span class="type">const</span> QRectF&amp; innerRect, <span class="type">double</span> value)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span>   m_min;                                 <span class="comment">//最小值</span></span><br><span class="line">    <span class="type">double</span>   m_max;                                 <span class="comment">//最大值</span></span><br><span class="line">    <span class="type">double</span>   m_value;                               <span class="comment">//当前值</span></span><br><span class="line">    BarStyle m_barStyle;                            <span class="comment">//进度条风格</span></span><br><span class="line">    <span class="type">int</span>      m_decimals;                            <span class="comment">//进度条精度</span></span><br><span class="line">    <span class="type">double</span>   m_startAngel;                          <span class="comment">//扫描弧度起始角度</span></span><br><span class="line">    <span class="type">double</span>   m_outlinePenWidth;                     <span class="comment">//轮廓画笔的宽度</span></span><br><span class="line">    <span class="type">double</span>   m_dataPenWidth;                        <span class="comment">//画笔宽度</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// _QROUNDPROGRESSBAR_H_</span></span></span><br></pre></td></tr></table></figure><h1 id="cpp"><a href="#cpp" class="headerlink" title="cpp"></a>cpp</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;QRoundProgressBar.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPointF&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtMath&gt;</span></span></span><br><span class="line"> </span><br><span class="line">QRoundProgressBar::<span class="built_in">QRoundProgressBar</span>(QWidget *parent , BarStyle style)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">m_min</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_max</span>(<span class="number">100</span>)</span><br><span class="line">    , <span class="built_in">m_value</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_startAngel</span>(<span class="number">90</span>)</span><br><span class="line">    , <span class="built_in">m_barStyle</span>(style)</span><br><span class="line">    , <span class="built_in">m_outlinePenWidth</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_dataPenWidth</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_decimals</span>(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">QRoundProgressBar::~<span class="built_in">QRoundProgressBar</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setStartAngle</span><span class="params">(<span class="type">double</span> angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (angle != m_startAngel)</span><br><span class="line">    &#123;</span><br><span class="line">        m_startAngel = angle;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setOutlinePenWidth</span><span class="params">(<span class="type">double</span> penWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (penWidth != m_outlinePenWidth)</span><br><span class="line">    &#123;</span><br><span class="line">        m_outlinePenWidth = penWidth;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setDataPenWidth</span><span class="params">(<span class="type">double</span> penWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (penWidth != m_dataPenWidth)</span><br><span class="line">    &#123;</span><br><span class="line">        m_dataPenWidth = penWidth;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setDecimals</span><span class="params">(<span class="type">int</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">0</span> &amp;&amp; count != m_decimals)</span><br><span class="line">    &#123;</span><br><span class="line">        m_decimals = count;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setBarStyle</span><span class="params">(BarStyle style)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (style != m_barStyle)</span><br><span class="line">    &#123;</span><br><span class="line">        m_barStyle = style;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setRange</span><span class="params">(<span class="type">double</span> min, <span class="type">double</span> max)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_min = min;</span><br><span class="line">    m_max = max;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (m_max &lt; m_min)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qSwap</span>(m_max, m_min);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (m_value &lt; m_min)</span><br><span class="line">    &#123;</span><br><span class="line">        m_value = m_min;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (m_value &gt; m_max)</span><br><span class="line">    &#123;</span><br><span class="line">        m_value = m_max;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setValue</span><span class="params">(<span class="type">double</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_value != val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (val &lt; m_min)</span><br><span class="line">        &#123;</span><br><span class="line">            m_value = m_min;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (val &gt; m_max)</span><br><span class="line">        &#123;</span><br><span class="line">            m_value = m_max;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            m_value = val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setValue</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setValue</span>(<span class="built_in">double</span>(val));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setMinimum</span><span class="params">(<span class="type">double</span> min)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setRange</span>(min, m_max);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::setMaximum</span><span class="params">(<span class="type">double</span> max)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setRange</span>(m_min, max);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::paintEvent</span><span class="params">(QPaintEvent* <span class="comment">/*event*/</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//外圈直径</span></span><br><span class="line">    <span class="type">double</span> outerDiameter = <span class="keyword">this</span>-&gt;<span class="built_in">width</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//外圈矩形</span></span><br><span class="line">    <span class="function">QRectF <span class="title">baseRect</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, outerDiameter, outerDiameter)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    p.<span class="built_in">setRenderHints</span>(QPainter::Antialiasing | QPainter::SmoothPixmapTransform);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//画背景矩形填充白色</span></span><br><span class="line">    p.<span class="built_in">fillRect</span>(baseRect, <span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#FFFFFF&quot;</span>)));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//内圆直径</span></span><br><span class="line">    <span class="type">double</span> innerDiameter = <span class="built_in">width</span>() * <span class="number">0.9</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//内圈矩形</span></span><br><span class="line">    QRectF innerRect;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//计算内圈矩形</span></span><br><span class="line">    <span class="keyword">if</span> (m_barStyle == StyleLine)</span><br><span class="line">    &#123;</span><br><span class="line">        innerDiameter = outerDiameter - m_outlinePenWidth;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(m_barStyle == StyleDonut)</span><br><span class="line">    &#123;</span><br><span class="line">        innerDiameter = outerDiameter * <span class="number">0.9</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">double</span> delta = (outerDiameter - innerDiameter) / <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">    innerRect = <span class="built_in">QRectF</span>(delta, delta, innerDiameter, innerDiameter);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//画基础图形</span></span><br><span class="line">    <span class="built_in">drawBase</span>(p, baseRect, innerRect);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//计算当前步长比例</span></span><br><span class="line">    <span class="type">double</span> arcStep = <span class="number">360.0</span> / (m_max - m_min) * m_value;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//根据值画出进度条</span></span><br><span class="line">    <span class="built_in">drawValue</span>(p, baseRect, m_value, arcStep, innerRect, innerDiameter);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//画文字</span></span><br><span class="line">    <span class="built_in">drawText</span>(p, baseRect, m_value);</span><br><span class="line"> </span><br><span class="line">    p.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::drawBase</span><span class="params">(QPainter &amp;p, <span class="type">const</span> QRectF &amp;baseRect, <span class="type">const</span> QRectF &amp;innerRect)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (m_barStyle)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> StyleDonut:</span><br><span class="line">        &#123;</span><br><span class="line">            QPainterPath dataPath;</span><br><span class="line">            dataPath.<span class="built_in">setFillRule</span>(Qt::OddEvenFill);</span><br><span class="line">            dataPath.<span class="built_in">moveTo</span>(baseRect.<span class="built_in">center</span>());</span><br><span class="line">            dataPath.<span class="built_in">addEllipse</span>(innerRect);</span><br><span class="line"> </span><br><span class="line">            QPen pen;</span><br><span class="line">            pen.<span class="built_in">setColor</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#DEE3E7&quot;</span>));</span><br><span class="line">            pen.<span class="built_in">setWidth</span>(<span class="number">10</span>);</span><br><span class="line">            p.<span class="built_in">setPen</span>(pen);</span><br><span class="line">            p.<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#FFFFFF&quot;</span>)));</span><br><span class="line">        </span><br><span class="line">            p.<span class="built_in">drawPath</span>(dataPath);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">case</span> StylePie:</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#FFFFFF&quot;</span>), m_outlinePenWidth));</span><br><span class="line">            p.<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#DEE3E7&quot;</span>)));</span><br><span class="line">            p.<span class="built_in">drawEllipse</span>(baseRect);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">case</span> StyleLine:</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#FFFFFF&quot;</span>), m_outlinePenWidth));</span><br><span class="line">            p.<span class="built_in">setBrush</span>(Qt::NoBrush);</span><br><span class="line">            p.<span class="built_in">drawEllipse</span>(baseRect.<span class="built_in">adjusted</span>(m_outlinePenWidth / <span class="number">2</span>, m_outlinePenWidth / <span class="number">2</span>, -m_outlinePenWidth / <span class="number">2</span>, -m_outlinePenWidth / <span class="number">2</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::drawValue</span><span class="params">(QPainter &amp;p, <span class="type">const</span> QRectF &amp;baseRect , <span class="type">double</span> value, <span class="type">double</span> arcLength</span></span></span><br><span class="line"><span class="params"><span class="function">                          , <span class="type">const</span> QRectF &amp; innerRect, <span class="type">double</span> innerDiameter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == m_min)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (m_barStyle == StyleLine)</span><br><span class="line">    &#123;</span><br><span class="line">        p.<span class="built_in">setPen</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#2F8DED&quot;</span>));</span><br><span class="line">        p.<span class="built_in">setBrush</span>(Qt::NoBrush);</span><br><span class="line">        p.<span class="built_in">drawArc</span>(baseRect,m_startAngel * <span class="number">16</span>, -arcLength * <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (m_barStyle == StyleDonut)</span><br><span class="line">    &#123;</span><br><span class="line">        QPen pen;</span><br><span class="line">        pen.<span class="built_in">setColor</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#2F8DED&quot;</span>));</span><br><span class="line">        pen.<span class="built_in">setWidth</span>(<span class="number">8</span>);</span><br><span class="line">        pen.<span class="built_in">setCapStyle</span>(Qt::RoundCap);</span><br><span class="line">        p.<span class="built_in">setPen</span>(pen);</span><br><span class="line">        p.<span class="built_in">drawArc</span>(innerRect, m_startAngel*<span class="number">16</span> , <span class="number">-16</span>*arcLength);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//获取中心点坐标</span></span><br><span class="line">        QPointF centerPoint = baseRect.<span class="built_in">center</span>();</span><br><span class="line">        QPainterPath dataPath;</span><br><span class="line">        dataPath.<span class="built_in">setFillRule</span>(Qt::WindingFill);</span><br><span class="line">        dataPath.<span class="built_in">moveTo</span>(centerPoint);</span><br><span class="line">        <span class="comment">//逆时针画弧长</span></span><br><span class="line">        dataPath.<span class="built_in">arcTo</span>(baseRect, m_startAngel, -arcLength);</span><br><span class="line">        <span class="keyword">if</span> (m_barStyle == StylePie)</span><br><span class="line">        &#123;</span><br><span class="line">            dataPath.<span class="built_in">lineTo</span>(centerPoint);</span><br><span class="line">            p.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#2F8DED&quot;</span>), m_dataPenWidth));</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#2F8DED&quot;</span>)));</span><br><span class="line">        p.<span class="built_in">drawPath</span>(dataPath);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRoundProgressBar::drawText</span><span class="params">(QPainter &amp;p, <span class="type">const</span> QRectF &amp;rect, <span class="type">double</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString textToDraw = <span class="string">&quot;%&quot;</span>;</span><br><span class="line">    <span class="type">double</span> percent = (value - m_min) / (m_max - m_min) * <span class="number">100.0</span>;</span><br><span class="line">    textToDraw = QString::<span class="built_in">number</span>(percent, <span class="string">&#x27;f&#x27;</span>, m_decimals) + textToDraw;</span><br><span class="line"> </span><br><span class="line">    QFont f;</span><br><span class="line">    f.<span class="built_in">setFamily</span>(<span class="string">&quot;微软雅黑&quot;</span>);</span><br><span class="line">    f.<span class="built_in">setPixelSize</span>(<span class="number">20</span>);</span><br><span class="line"> </span><br><span class="line">    p.<span class="built_in">setFont</span>(f);</span><br><span class="line">    p.<span class="built_in">setPen</span>(<span class="built_in">QColor</span>(<span class="string">&quot;#606266&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    p.<span class="built_in">drawText</span>(rect, Qt::AlignCenter, textToDraw);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 进度条 </tag>
            
            <tag> 圆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt动画类</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="动画框架结构"><a href="#动画框架结构" class="headerlink" title="动画框架结构"></a>动画框架结构</h1><p>动画框架由基类 <code>QAbstractAnimation</code> 以及它的两个子类<code> QVariantAnimation</code> 、<code>QAnimationGroup</code> 组成。基础动画由QVariantAnimation的子类QPropertyAnimation来设置，再通过将多个QPropertyAnimation和QPauseAnimation组合成为动画组（QParallelAnimationGroup、QSequentialAnimationGroup），完成一个连续的动画。</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%8A%A8%E7%94%BB/images/Qt%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/Qt%E5%8A%A8%E7%94%BB%E6%A1%86%E6%9E%B6.png" alt="Qt动画框架">QPropertyAnimation</p><p><code>QPropertyAnimation</code> 类能够修改Qt的属性值，如pos、geometry等属性。设置好动画的初值和末值，以及持续的时间后，一个属性动画就基本完成了。</p><h2 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h2><p>通过修改控件的geometry属性可以实现缩放效果，也可以实现位移的动画，该属性的前两个值确定了控件左上角的位置，后两个值确定了控件的大小。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//scale</span></span><br><span class="line">QPropertyAnimation *pScaleAnimation1 = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(ui-&gt;scaleButton, <span class="string">&quot;geometry&quot;</span>);</span><br><span class="line">pScaleAnimation1-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">pScaleAnimation1-&gt;<span class="built_in">setStartValue</span>(<span class="built_in">QRect</span>(<span class="number">190</span>, <span class="number">230</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">pScaleAnimation1-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QRect</span>(<span class="number">120</span>, <span class="number">160</span>, <span class="number">140</span>, <span class="number">140</span>));</span><br></pre></td></tr></table></figure><h2 id="位移"><a href="#位移" class="headerlink" title="位移"></a>位移</h2><p>如果只是需要位移动画的话，修改控件的pos属性即可。pos属性就是控件的左上角所在的位置。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pos</span></span><br><span class="line">QPropertyAnimation *pPosAnimation1 = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(ui-&gt;posButton, <span class="string">&quot;pos&quot;</span>);</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setStartValue</span>(<span class="built_in">QPoint</span>(<span class="number">360</span>, <span class="number">160</span>));</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QPoint</span>(<span class="number">360</span>, <span class="number">350</span>));</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br></pre></td></tr></table></figure><h2 id="不透明度"><a href="#不透明度" class="headerlink" title="不透明度"></a>不透明度</h2><p>Qt的控件没有单独的透明度属性，要修改控件的透明度可以通过 <code>QGraphicsOpacityEffect</code> 类来实现。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//opacity</span></span><br><span class="line">QGraphicsOpacityEffect *pButtonOpacity = <span class="keyword">new</span> <span class="built_in">QGraphicsOpacityEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">pButtonOpacity-&gt;<span class="built_in">setOpacity</span>(<span class="number">1</span>);</span><br><span class="line">ui-&gt;opasityButton-&gt;<span class="built_in">setGraphicsEffect</span>(pButtonOpacity);</span><br><span class="line"></span><br><span class="line">QPropertyAnimation *pOpacityAnimation1 = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(pButtonOpacity, <span class="string">&quot;opacity&quot;</span>);</span><br><span class="line">pOpacityAnimation1-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">pOpacityAnimation1-&gt;<span class="built_in">setStartValue</span>(<span class="number">1</span>);</span><br><span class="line">pOpacityAnimation1-&gt;<span class="built_in">setEndValue</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="动画曲线"><a href="#动画曲线" class="headerlink" title="动画曲线"></a>动画曲线</h2><p>动画还可以设置时间的插值曲线，默认是linear，即线性运动，通过设置QEasingCurve即可。Qt提供了40种已经定义好的曲线（如果有需要也可以自定义曲线）：</p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/%E5%8A%A8%E7%94%BB/images/Qt%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/Qt%E5%8A%A8%E7%94%BB%E6%9B%B2%E7%BA%BF.png" alt="Qt动画曲线"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pScaleAnimation1-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 启动动画</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%90%AF%E5%8A%A8%E5%8A%A8%E7%94%BB/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%90%AF%E5%8A%A8%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="QSplashScreen"><a href="#QSplashScreen" class="headerlink" title="QSplashScreen"></a>QSplashScreen</h1><h2 id="设置图片"><a href="#设置图片" class="headerlink" title="设置图片"></a>设置图片</h2><blockquote><p>Qt内置了用于程序启动的动画直接使用QSplashScreen即可。</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPixmap <span class="title">pixmap</span><span class="params">(<span class="string">&quot;:load.gif&quot;</span>)</span></span>;     <span class="comment">//读取图片</span></span><br><span class="line"><span class="function">QSplashScreen <span class="title">splash</span><span class="params">(pixmap)</span></span>; <span class="comment">//</span></span><br><span class="line">splash.<span class="built_in">setWindowOpacity</span>(<span class="number">0.8</span>); <span class="comment">// 设置窗口透明度</span></span><br><span class="line">splash.<span class="built_in">show</span>();</span><br><span class="line">splash.<span class="built_in">showMessage</span>(<span class="string">&quot;程序正在加载......&quot;</span>, Qt::AlignCenter, Qt::red); <span class="comment">//显示文字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选项</span></span><br><span class="line"><span class="meta">#ifdeg DEBUG</span></span><br><span class="line">QDateTime time = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">QDateTime currentTime = QDateTime::<span class="built_in">currentDateTime</span>(); <span class="comment">//记录当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (time.<span class="built_in">secsTo</span>(currentTime) &lt;= <span class="number">5</span>) <span class="comment">// 5为需要延时的秒数</span></span><br><span class="line">&#123;</span><br><span class="line">    currentTime = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">    a.<span class="built_in">processEvents</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">widget w;</span><br><span class="line">w.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">splash.<span class="built_in">finish</span>(&amp;w); <span class="comment">//在主体对象初始化完成后结束启动动画</span></span><br></pre></td></tr></table></figure><p>以上代码放在程序的入口<code>main</code>函数中即可。 <code>widget</code>就是我们需要启动的程序。</p><h1 id="自定义启动动画"><a href="#自定义启动动画" class="headerlink" title="自定义启动动画"></a>自定义启动动画</h1><blockquote><p>自定义启动动画的方式网上有几种重写 <code>QSplashScreen</code> 的。笔者也尝试使用了一下，发现并不好用，于是按照一开始的方案，准备用一个 <code>widget</code> 去写启动动画。</p><p>参考 <code>QSplashScreen</code> 的方式，还是使用 <code>finish(QWidget *mainWin)</code> 的接口去作为窗体关闭的入口。</p></blockquote><h2 id="finish-Qwidget-mainWin"><a href="#finish-Qwidget-mainWin" class="headerlink" title="finish(Qwidget *mainWin)"></a><code>finish(Qwidget *mainWin)</code></h2><p>关于 <code>finished(QWidget *mainWin)</code> 直接把 <code>QSplashScreen</code> 的源码搬过来即可。</p><blockquote><p>源码一般在你使用的版本的 <code>src</code> 文件夹下：</p><p><code>$&#123;install dir&#125;\5.9.9\Src\qtbase\src\widgets\widgets</code></p><p><code>QSplashScreen</code> 源码中的 <code>finish()</code> 如下所示：</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    Makes the splash screen wait until the widget \a mainWin is displayed</span></span><br><span class="line"><span class="comment">    before calling close() on itself.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 这个接口我们需要复制到自定义的启动动画窗体中。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QSplashScreen::finish</span><span class="params">(QWidget *mainWin)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mainWin) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mainWin-&gt;<span class="built_in">windowHandle</span>())</span><br><span class="line">            mainWin-&gt;<span class="built_in">createWinId</span>();</span><br><span class="line">        <span class="built_in">waitForWindowExposed</span>(mainWin-&gt;<span class="built_in">windowHandle</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码，唯一的问题在于 <code>waitForWindowExposed</code> 这个函数我没有找到实现，也没有仔细找，但是在 <code>Qt</code> 的 <code>testlib</code> 库中有一个类似的接口 <code>QTest::qwaitForWindowExposed()</code> 两个接口的作用应该是一致的。上述代码中 <code>waitForWindowExposed(mainWin-&gt;windowHandle());</code> 经笔者测试哈（不一定准确），<del>即使去掉也不会影响 <code>finish()</code> 接口的作用。^2022年7月27日08:39:40^</del>  去掉还是会有影响的，相当于判断窗口的逻辑没了。关于 <code>waitForWindowExposed()</code> 在 Qt源码中的实现，笔者在调试程序的时候发现去掉这行代码，怎么看启动动画和运行的程序之间的衔接都不太合理，遂决定找一下这个 <code>waitForWindowExposed()</code> 的源码，这一找，真的是远在天边，近在眼前。函数的实现就在 <code>qsplashscreen.cpp</code> 中。这里贴一下其源码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A copy of Qt Test&#x27;s qWaitForWindowExposed() and qSleep().</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">bool</span> <span class="title">waitForWindowExposed</span><span class="params">(QWindow *window, <span class="type">int</span> timeout = <span class="number">1000</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">enum</span> &#123; TimeOutMs = <span class="number">10</span> &#125;;</span><br><span class="line">    QElapsedTimer timer;</span><br><span class="line">    timer.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">while</span> (!window-&gt;<span class="built_in">isExposed</span>()) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> remaining = timeout - <span class="built_in">int</span>(timer.<span class="built_in">elapsed</span>());</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        QCoreApplication::<span class="built_in">processEvents</span>(QEventLoop::AllEvents, remaining);</span><br><span class="line">        QCoreApplication::<span class="built_in">sendPostedEvents</span>(<span class="number">0</span>, QEvent::DeferredDelete);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(Q_OS_WINRT)</span></span><br><span class="line">        <span class="built_in">WaitForSingleObjectEx</span>(<span class="built_in">GetCurrentThread</span>(), TimeOutMs, <span class="literal">false</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(Q_OS_WIN)</span></span><br><span class="line">        <span class="built_in">Sleep</span>(<span class="built_in">uint</span>(TimeOutMs));</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">timespec</span> ts = &#123; TimeOutMs / <span class="number">1000</span>, (TimeOutMs % <span class="number">1000</span>) * <span class="number">1000</span> * <span class="number">1000</span> &#125;;</span><br><span class="line">        <span class="built_in">nanosleep</span>(&amp;ts, <span class="literal">NULL</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> window-&gt;<span class="built_in">isExposed</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要使用你源码中的实现，则需要引入两个头问题。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QElapsedTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtGui/QWindow&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="设置窗体"><a href="#设置窗体" class="headerlink" title="*设置窗体"></a>*设置窗体</h2><p>设置窗体的逻辑也比较简单，就是创建一个<code>widget</code>、<code>Dialog</code>专门用来实现启动动画的逻辑。如下所示为Qt程序的入口函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">Dialog d; <span class="comment">// 启动动画的窗台</span></span><br><span class="line">    d.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    Widget w;</span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">d.<span class="built_in">finish</span>(&amp;w); <span class="comment">// 复制的 QSplashScreen 中的 finished()</span></span><br><span class="line"><span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中的 <code>Dialog d</code> 就是我们创建的一个自定义的启动动画窗口，至于窗口内要实现什么，依据你个人的业务和需求去实现即可。</p><h1 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h1><blockquote><p>上文中的 <code>Dialog</code> 还没有主界面就展示了，或者 <code>Dialog</code> 展示了但是没有画面。</p></blockquote><p>关于这个问题，我认为是主界面的刷新太快了（大家可以调试代码去观察一下现象），也就是 <code>finish</code> 相当于是瞬间调用了。导致 <code>Dialog</code><u>没有展示和来得及刷新</u> 。这个问题网友也给出了方案，让 <code>main</code> 做一些别的操作延时一下。目前笔者用过的最好的不是在 <code>main</code> 中 <code>sleep</code> 。而是执行以下 <code>processEvent()</code></p><p>具体的代码就是在 <code>Widget::show()</code> 之前调用，如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的时间只是为了做一个判断，只调用一下 a.processEvents(); 应该也是可以的</span></span><br><span class="line">QDateTime time = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">QDateTime currentTime = QDateTime::<span class="built_in">currentDateTime</span>();   <span class="comment">//记录当前时间</span></span><br><span class="line"><span class="keyword">while</span> (time.<span class="built_in">secsTo</span>(currentTime) &lt;= <span class="number">5</span>)                   <span class="comment">//5为需要延时的秒数</span></span><br><span class="line">&#123;</span><br><span class="line">    currentTime = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">    a.<span class="built_in">processEvents</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h1><blockquote><p><code>Dialog</code> 结束的时候界面关闭和主界面的展示会中断一下，强迫症难以接受这种突然闪现怎么办？</p></blockquote><p>还是会到 <code>finish()</code> 。</p><p>在 <code>closed()</code> 的位置 <code>sleep()</code>，让关闭的窗口稍微等一等，等主界面展示出来之后再关闭。<code>1s</code> 的时间足够主界面刷新出来了 。代码如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::finish</span><span class="params">(QWidget *mainWin)</span> <span class="comment">// 这里已经是我们自定义的启动动画窗口 Dialog 了</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mainWin) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mainWin-&gt;<span class="built_in">windowHandle</span>())</span><br><span class="line">            mainWin-&gt;<span class="built_in">createWinId</span>();</span><br><span class="line">        <span class="built_in">waitForWindowExposed</span>(mainWin-&gt;<span class="built_in">windowHandle</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">1</span>); <span class="comment">// sleep 的单位是秒</span></span><br><span class="line">    <span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><blockquote><p><code>widget</code> 的代码不展示</p></blockquote><h2 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dialog.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPixmap&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSplashScreen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> QT_DEBUG <span class="comment">// 使用 QSplashScreen 的启动动画</span></span></span><br><span class="line">    <span class="function">QPixmap <span class="title">pixmap</span><span class="params">(<span class="string">&quot;:/test.gif&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">QSplashScreen <span class="title">splash</span><span class="params">(pixmap,<span class="number">10</span>)</span></span>;</span><br><span class="line">    splash.<span class="built_in">show</span>();</span><br><span class="line">    QDateTime time = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">        QDateTime currentTime = QDateTime::<span class="built_in">currentDateTime</span>();   <span class="comment">//记录当前时间</span></span><br><span class="line">        <span class="keyword">while</span> (time.<span class="built_in">secsTo</span>(currentTime) &lt;= <span class="number">5</span>)                   <span class="comment">//5为需要延时的秒数</span></span><br><span class="line">        &#123;</span><br><span class="line">            currentTime = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">            a.<span class="built_in">processEvents</span>();</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    Dialog d; <span class="comment">// 使用自定义的启动动画</span></span><br><span class="line">    d.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    QDateTime time = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">    QDateTime currentTime = QDateTime::<span class="built_in">currentDateTime</span>();   <span class="comment">//记录当前时间</span></span><br><span class="line">    <span class="keyword">while</span> (time.<span class="built_in">secsTo</span>(currentTime) &lt;= <span class="number">5</span>)                   <span class="comment">//5为需要延时的秒数</span></span><br><span class="line">    &#123;</span><br><span class="line">        currentTime = QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">        a.<span class="built_in">processEvents</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Widget w; <span class="comment">// 主程序</span></span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> QT_DEBUG <span class="comment">// 使用 QSplashScreen 的启动动画</span></span></span><br><span class="line">splash.<span class="built_in">finish</span>(&amp;w);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">   d.<span class="built_in">finish</span>(&amp;w);</span><br><span class="line">   <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dialog-h"><a href="#dialog-h" class="headerlink" title="dialog.h"></a>dialog.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DIALOG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DIALOG_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDialog&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> : <span class="keyword">public</span> QDialog</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Dialog</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">Dialog</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QWidget *mainWin)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Dialog *ui;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// DIALOG_H</span></span></span><br></pre></td></tr></table></figure><h2 id="dialog-cpp"><a href="#dialog-cpp" class="headerlink" title="dialog.cpp"></a>dialog.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dialog.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_dialog.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Dialog::<span class="built_in">Dialog</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QDialog</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Dialog)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">   <span class="comment">// setWindowFlags(Qt::FramelessWindowHint | Qt::Tool | Qt::WindowStaysOnTopHint | Qt::Window);</span></span><br><span class="line">    <span class="comment">//setAttribute(Qt::WA_TranslucentBackground);</span></span><br><span class="line">    <span class="built_in">setStyleSheet</span>(<span class="string">&quot;#Dialog&#123;&quot;</span></span><br><span class="line">                  <span class="string">&quot;border-image: url(:/bgimg_334.png);&quot;</span> <span class="comment">// 自己添加一个图片到程序，不添加也不影响程序运行</span></span><br><span class="line">                  <span class="string">&quot;background-position: center;&quot;</span></span><br><span class="line">                  <span class="string">&quot;backgroun d-repeat: no-repeat;&quot;</span></span><br><span class="line">                  <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dialog::~<span class="built_in">Dialog</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::finish</span><span class="params">(QWidget* mainWin)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mainWin) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mainWin-&gt;<span class="built_in">windowHandle</span>())</span><br><span class="line">            mainWin-&gt;<span class="built_in">createWinId</span>();</span><br><span class="line">    <span class="comment">//QTest::qWaitForWindowExposed(mainWin-&gt;windowHandle());</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dialog-ui"><a href="#dialog-ui" class="headerlink" title="dialog.ui"></a>dialog.ui</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;ui version=<span class="string">&quot;4.0&quot;</span>&gt;</span><br><span class="line"> &lt;<span class="keyword">class</span>&gt;Dialog&lt;/<span class="keyword">class</span>&gt;</span><br><span class="line"> &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QDialog&quot;</span> name=<span class="string">&quot;Dialog&quot;</span>&gt;</span><br><span class="line">  &lt;property name=<span class="string">&quot;geometry&quot;</span>&gt;</span><br><span class="line">   &lt;rect&gt;</span><br><span class="line">    &lt;x&gt;<span class="number">0</span>&lt;/x&gt;</span><br><span class="line">    &lt;y&gt;<span class="number">0</span>&lt;/y&gt;</span><br><span class="line">    &lt;width&gt;<span class="number">400</span>&lt;/width&gt;</span><br><span class="line">    &lt;height&gt;<span class="number">300</span>&lt;/height&gt;</span><br><span class="line">   &lt;/rect&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property name=<span class="string">&quot;windowTitle&quot;</span>&gt;</span><br><span class="line">   &lt;string&gt;Dialog&lt;/string&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;layout <span class="keyword">class</span>=<span class="string">&quot;QGridLayout&quot;</span> name=<span class="string">&quot;gridLayout&quot;</span>&gt;</span><br><span class="line">   &lt;item row=<span class="string">&quot;2&quot;</span> column=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">    &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QDialogButtonBox&quot;</span> name=<span class="string">&quot;buttonBox&quot;</span>&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;orientation&quot;</span>&gt;</span><br><span class="line">      &lt;<span class="keyword">enum</span>&gt;Qt::Horizontal&lt;/<span class="keyword">enum</span>&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;standardButtons&quot;</span>&gt;</span><br><span class="line">      &lt;set&gt;QDialogButtonBox::Cancel|QDialogButtonBox::Ok&lt;/set&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">    &lt;/widget&gt;</span><br><span class="line">   &lt;/item&gt;</span><br><span class="line">   &lt;item row=<span class="string">&quot;1&quot;</span> column=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">    &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QFrame&quot;</span> name=<span class="string">&quot;frame&quot;</span>&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;frameShape&quot;</span>&gt;</span><br><span class="line">      &lt;<span class="keyword">enum</span>&gt;QFrame::StyledPanel&lt;/<span class="keyword">enum</span>&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;frameShadow&quot;</span>&gt;</span><br><span class="line">      &lt;<span class="keyword">enum</span>&gt;QFrame::Raised&lt;/<span class="keyword">enum</span>&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">     &lt;layout <span class="keyword">class</span>=<span class="string">&quot;QGridLayout&quot;</span> name=<span class="string">&quot;gridLayout_2&quot;</span>&gt;</span><br><span class="line">      &lt;item row=<span class="string">&quot;0&quot;</span> column=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">       &lt;layout <span class="keyword">class</span>=<span class="string">&quot;QVBoxLayout&quot;</span> name=<span class="string">&quot;verticalLayout&quot;</span>&gt;</span><br><span class="line">        &lt;item&gt;</span><br><span class="line">         &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QStackedWidget&quot;</span> name=<span class="string">&quot;stackedWidget&quot;</span>&gt;</span><br><span class="line">          &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QWidget&quot;</span> name=<span class="string">&quot;page&quot;</span>&gt;</span><br><span class="line">           &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QWidget&quot;</span> name=<span class="string">&quot;widget&quot;</span> native=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;property name=<span class="string">&quot;geometry&quot;</span>&gt;</span><br><span class="line">             &lt;rect&gt;</span><br><span class="line">              &lt;x&gt;<span class="number">-101</span>&lt;/x&gt;</span><br><span class="line">              &lt;y&gt;<span class="number">-10</span>&lt;/y&gt;</span><br><span class="line">              &lt;width&gt;<span class="number">231</span>&lt;/width&gt;</span><br><span class="line">              &lt;height&gt;<span class="number">51</span>&lt;/height&gt;</span><br><span class="line">             &lt;/rect&gt;</span><br><span class="line">            &lt;/property&gt;</span><br><span class="line">           &lt;/widget&gt;</span><br><span class="line">          &lt;/widget&gt;</span><br><span class="line">          &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QWidget&quot;</span> name=<span class="string">&quot;page_2&quot;</span>/&gt;</span><br><span class="line">         &lt;/widget&gt;</span><br><span class="line">        &lt;/item&gt;</span><br><span class="line">        &lt;item&gt;</span><br><span class="line">         &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QStackedWidget&quot;</span> name=<span class="string">&quot;stackedWidget_2&quot;</span>&gt;</span><br><span class="line">          &lt;property name=<span class="string">&quot;currentIndex&quot;</span>&gt;</span><br><span class="line">           &lt;number&gt;<span class="number">1</span>&lt;/number&gt;</span><br><span class="line">          &lt;/property&gt;</span><br><span class="line">          &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QWidget&quot;</span> name=<span class="string">&quot;page_3&quot;</span>/&gt;</span><br><span class="line">          &lt;widget <span class="keyword">class</span>=<span class="string">&quot;QWidget&quot;</span> name=<span class="string">&quot;page_4&quot;</span>/&gt;</span><br><span class="line">         &lt;/widget&gt;</span><br><span class="line">        &lt;/item&gt;</span><br><span class="line">       &lt;/layout&gt;</span><br><span class="line">      &lt;/item&gt;</span><br><span class="line">     &lt;/layout&gt;</span><br><span class="line">    &lt;/widget&gt;</span><br><span class="line">   &lt;/item&gt;</span><br><span class="line">  &lt;/layout&gt;</span><br><span class="line"> &lt;/widget&gt;</span><br><span class="line"> &lt;resources/&gt;</span><br><span class="line"> &lt;connections&gt;</span><br><span class="line">  &lt;connection&gt;</span><br><span class="line">   &lt;sender&gt;buttonBox&lt;/sender&gt;</span><br><span class="line">   &lt;signal&gt;<span class="built_in">accepted</span>()&lt;/signal&gt;</span><br><span class="line">   &lt;receiver&gt;Dialog&lt;/receiver&gt;</span><br><span class="line">   &lt;slot&gt;<span class="built_in">accept</span>()&lt;/slot&gt;</span><br><span class="line">   &lt;hints&gt;</span><br><span class="line">    &lt;hint type=<span class="string">&quot;sourcelabel&quot;</span>&gt;</span><br><span class="line">     &lt;x&gt;<span class="number">248</span>&lt;/x&gt;</span><br><span class="line">     &lt;y&gt;<span class="number">254</span>&lt;/y&gt;</span><br><span class="line">    &lt;/hint&gt;</span><br><span class="line">    &lt;hint type=<span class="string">&quot;destinationlabel&quot;</span>&gt;</span><br><span class="line">     &lt;x&gt;<span class="number">157</span>&lt;/x&gt;</span><br><span class="line">     &lt;y&gt;<span class="number">274</span>&lt;/y&gt;</span><br><span class="line">    &lt;/hint&gt;</span><br><span class="line">   &lt;/hints&gt;</span><br><span class="line">  &lt;/connection&gt;</span><br><span class="line">  &lt;connection&gt;</span><br><span class="line">   &lt;sender&gt;buttonBox&lt;/sender&gt;</span><br><span class="line">   &lt;signal&gt;<span class="built_in">rejected</span>()&lt;/signal&gt;</span><br><span class="line">   &lt;receiver&gt;Dialog&lt;/receiver&gt;</span><br><span class="line">   &lt;slot&gt;<span class="built_in">reject</span>()&lt;/slot&gt;</span><br><span class="line">   &lt;hints&gt;</span><br><span class="line">    &lt;hint type=<span class="string">&quot;sourcelabel&quot;</span>&gt;</span><br><span class="line">     &lt;x&gt;<span class="number">316</span>&lt;/x&gt;</span><br><span class="line">     &lt;y&gt;<span class="number">260</span>&lt;/y&gt;</span><br><span class="line">    &lt;/hint&gt;</span><br><span class="line">    &lt;hint type=<span class="string">&quot;destinationlabel&quot;</span>&gt;</span><br><span class="line">     &lt;x&gt;<span class="number">286</span>&lt;/x&gt;</span><br><span class="line">     &lt;y&gt;<span class="number">274</span>&lt;/y&gt;</span><br><span class="line">    &lt;/hint&gt;</span><br><span class="line">   &lt;/hints&gt;</span><br><span class="line">  &lt;/connection&gt;</span><br><span class="line"> &lt;/connections&gt;</span><br><span class="line">&lt;/ui&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt任务栏显示进度条</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E4%BB%BB%E5%8A%A1%E6%A0%8F%E8%BF%9B%E5%BA%A6%E6%9D%A1/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E4%BB%BB%E5%8A%A1%E6%A0%8F%E8%BF%9B%E5%BA%A6%E6%9D%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="Qt-任务栏显示进度条"><a href="#Qt-任务栏显示进度条" class="headerlink" title="Qt 任务栏显示进度条"></a>Qt 任务栏显示进度条</h1><blockquote><p>注意事项：</p><ol><li>修改pro文件</li><li>界面展示后再 <code>new QWinTaskbarButton</code>，否则会不显示</li></ol></blockquote><h2 id="Qt-官方demo"><a href="#Qt-官方demo" class="headerlink" title="# Qt 官方demo"></a># Qt 官方demo</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QWinTaskbarButton *button = <span class="keyword">new</span> <span class="built_in">QWinTaskbarButton</span>(widget);</span><br><span class="line">button-&gt;<span class="built_in">setWindow</span>(widget-&gt;<span class="built_in">windowHandle</span>());</span><br><span class="line">button-&gt;<span class="built_in">setOverlayIcon</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:/loading.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">QWinTaskbarProgress *progress = button-&gt;<span class="built_in">progress</span>();</span><br><span class="line">progress-&gt;<span class="built_in">setVisible</span>(<span class="literal">true</span>);</span><br><span class="line">progress-&gt;<span class="built_in">setValue</span>(<span class="number">50</span>);</span><br></pre></td></tr></table></figure><h2 id="Demo"><a href="#Demo" class="headerlink" title="# Demo"></a># Demo</h2><h3 id="1-修改pro文件"><a href="#1-修改pro文件" class="headerlink" title="1 修改pro文件"></a>1 修改pro文件</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win32:QT += winextras</span><br></pre></td></tr></table></figure><h3 id="2-h"><a href="#2-h" class="headerlink" title="2 .h"></a>2 .h</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> TASKBARPROGRESS_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TASKBARPROGRESS_H</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QAbstractButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWinTaskbarProgress&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWinTaskbarButton&gt;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskbarProgress</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskbarProgress</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">TaskbarProgress</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">TaskbarProgress</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onButtonClicked</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onTimeout</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::TaskbarProgress *ui;</span><br><span class="line"> </span><br><span class="line">    QTimer *timer;</span><br><span class="line"> </span><br><span class="line">    QWinTaskbarButton *windowsTaskbarButton;</span><br><span class="line"> </span><br><span class="line">    QWinTaskbarProgress *windowsTaskbarProgress;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// TASKBARPROGRESS_H</span></span></span><br></pre></td></tr></table></figure><h3 id="3-cpp"><a href="#3-cpp" class="headerlink" title="3 .cpp"></a>3 .cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;taskbarprogress.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_taskbarprogress.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">TaskbarProgress::<span class="built_in">TaskbarProgress</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QMainWindow</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::TaskbarProgress)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"> </span><br><span class="line">    timer = <span class="keyword">new</span> QTimer;</span><br><span class="line">    timer-&gt;<span class="built_in">setInterval</span>(<span class="number">1000</span>);     <span class="comment">//设置时间间隔</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//创建显示进度的任务栏按钮</span></span><br><span class="line">    windowsTaskbarButton = <span class="keyword">new</span> <span class="built_in">QWinTaskbarButton</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;TaskbarProgress::onTimeout);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;Btn_Start, &amp;QAbstractButton::clicked, <span class="keyword">this</span>, &amp;TaskbarProgress::onButtonClicked);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">TaskbarProgress::~<span class="built_in">TaskbarProgress</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskbarProgress::onButtonClicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将任务栏按钮关联到进度栏，假设进度栏是它自己的窗口</span></span><br><span class="line">    windowsTaskbarButton-&gt;<span class="built_in">setWindow</span>(<span class="built_in">windowHandle</span>());</span><br><span class="line">    windowsTaskbarProgress = windowsTaskbarButton-&gt;<span class="built_in">progress</span>();</span><br><span class="line">    windowsTaskbarProgress-&gt;<span class="built_in">setRange</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskbarProgress::onTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//当进度条的值发生变化时，更改任务栏中的进度值</span></span><br><span class="line">    windowsTaskbarProgress-&gt;<span class="built_in">setValue</span>(windowsTaskbarProgress-&gt;<span class="built_in">value</span>() + <span class="number">20</span>);</span><br><span class="line">    windowsTaskbarProgress-&gt;<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">if</span> (windowsTaskbarProgress-&gt;<span class="built_in">value</span>() &gt; <span class="number">99</span>) &#123;</span><br><span class="line">        windowsTaskbarProgress-&gt;<span class="built_in">setValue</span>(<span class="number">0</span>);</span><br><span class="line">        timer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 动画 </tag>
            
            <tag> 任务栏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 动画效果 （抖动、下坠、透明度）</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%8A%A8%E7%94%BB/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/Qt%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>收集整理的一些 Qt 常用动画</p></blockquote><p>[toc]</p><h1 id="下坠效果"><a href="#下坠效果" class="headerlink" title="下坠效果"></a>下坠效果</h1><p>通过计算桌面的宽度、高度，来设置动画的起始值和结束值。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onDropWindow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPropertyAnimation *pAnimation = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(<span class="keyword">this</span>, <span class="string">&quot;geometry&quot;</span>);</span><br><span class="line">    QDesktopWidget *pDesktopWidget = QApplication::<span class="built_in">desktop</span>();</span><br><span class="line">    <span class="type">int</span> x = (pDesktopWidget-&gt;<span class="built_in">availableGeometry</span>().<span class="built_in">width</span>() - <span class="built_in">width</span>()) / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> y = (pDesktopWidget-&gt;<span class="built_in">availableGeometry</span>().<span class="built_in">height</span>() - <span class="built_in">height</span>()) / <span class="number">2</span>;</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setStartValue</span>(<span class="built_in">QRect</span>(x, <span class="number">0</span>, <span class="built_in">width</span>(), <span class="built_in">height</span>()));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QRect</span>(x, y, <span class="built_in">width</span>(), <span class="built_in">height</span>()));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::OutElastic);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">start</span>(QAbstractAnimation::DeleteWhenStopped);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="抖动效果"><a href="#抖动效果" class="headerlink" title="抖动效果"></a>抖动效果</h1><p>获取界面的坐标，然后进行上、下、左、右坐标浮动，通过setKeyValueAt()来设置每一时刻的位置，实现抖动效果。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onShakeWindow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPropertyAnimation *pAnimation = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(<span class="keyword">this</span>, <span class="string">&quot;pos&quot;</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setDuration</span>(<span class="number">500</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setLoopCount</span>(<span class="number">2</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">3</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">3</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.1</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() + <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() + <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.2</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() + <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.3</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() + <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.4</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.5</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() + <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() + <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.6</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() + <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.7</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() + <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.8</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.9</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() + <span class="number">6</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() + <span class="number">6</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">1</span>, <span class="built_in">QPoint</span>(<span class="built_in">geometry</span>().<span class="built_in">x</span>() - <span class="number">3</span>, <span class="built_in">geometry</span>().<span class="built_in">y</span>() - <span class="number">3</span>));</span><br><span class="line">    pAnimation-&gt;<span class="built_in">start</span>(QAbstractAnimation::DeleteWhenStopped);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="透明度效果"><a href="#透明度效果" class="headerlink" title="透明度效果"></a>透明度效果</h1><p>设置每一时刻的透明度值，动画结束时界面还原（透明度再为1）。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::onOpacityWindow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPropertyAnimation *pAnimation = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(<span class="keyword">this</span>, <span class="string">&quot;windowOpacity&quot;</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">0.5</span>, <span class="number">0</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">setKeyValueAt</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    pAnimation-&gt;<span class="built_in">start</span>(QAbstractAnimation::DeleteWhenStopped);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是不是很有趣，还不快点儿，实现属于自己的动画。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 动画 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QStackWidget动画(2)</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/QStackWidget%E5%8A%A8%E7%94%BB2/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/QStackWidget%E5%8A%A8%E7%94%BB2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>QStackWidget 切换动画的实现方式，通过重写 <code>QWidget</code> 实现</p></blockquote><p>使用重写实现的切换动画使用和展示上更稳定，推荐使用当前这个。</p><h1 id="h-文件"><a href="#h-文件" class="headerlink" title=".h 文件"></a>.h 文件</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYSTACKWIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYSTACKWIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPropertyAnimation&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStackWidget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyStackWidget</span>(QWidget *parent);</span><br><span class="line">    ~<span class="built_in">MyStackWidget</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">addWidget</span><span class="params">(QWidget *widget)</span></span>;             <span class="comment">//添加控件</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insertWidget</span><span class="params">(<span class="type">int</span> index, QWidget *widget)</span></span>;   <span class="comment">//插入控件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">removeWidget</span><span class="params">(QWidget *widget)</span></span>;         <span class="comment">//删除控件</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">()</span> <span class="type">const</span></span>;                          <span class="comment">//目前控件数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setWidgetsVisible</span><span class="params">()</span></span>;                   <span class="comment">//设置控件可见</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCurrentWidget</span><span class="params">(QWidget *widget)</span></span>;     <span class="comment">//设置当前widget显示</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCurrentIndex</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">currentIndex</span><span class="params">()</span> <span class="type">const</span></span>;                   <span class="comment">//获取当前显示位置</span></span><br><span class="line"></span><br><span class="line">    <span class="function">QWidget *<span class="title">currentWidget</span><span class="params">()</span> <span class="type">const</span></span>;             <span class="comment">//获取当前显示的控件</span></span><br><span class="line">    <span class="function">QWidget *<span class="title">widget</span><span class="params">(<span class="type">int</span> index)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">indexOf</span><span class="params">(QWidget *widget)</span> <span class="type">const</span></span>;         <span class="comment">//获取widget所在位置</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setDuration</span><span class="params">(<span class="type">int</span> duration)</span></span>;             <span class="comment">//设置动画时长</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resizeEvent</span><span class="params">(QResizeEvent *event)</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">widgetRemoved</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">currentChanged</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onValueChanged</span><span class="params">(<span class="type">const</span> QVariant &amp;value)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QList&lt;QWidget *&gt; m_widgetLst;           <span class="comment">//加入的控件链表</span></span><br><span class="line">    QPropertyAnimation *m_moveAnimation;    <span class="comment">//动画类</span></span><br><span class="line">    <span class="type">int</span> m_curIndex = <span class="number">0</span>;                     <span class="comment">//当前显示位置</span></span><br><span class="line">    <span class="type">int</span> m_offset = <span class="number">0</span>;                       <span class="comment">//需要显示的位置与当前显示的位置的偏差</span></span><br><span class="line">    <span class="type">int</span> m_lastIndex = <span class="number">0</span>;                    <span class="comment">//最后位置</span></span><br><span class="line">    <span class="type">int</span> m_duration = <span class="number">500</span>;                   <span class="comment">//动画显示时长，单位:ms</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">moveAnimationStart</span><span class="params">()</span></span>;              <span class="comment">//启动移动动画</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MYSTACKWIDGET_H</span></span></span><br></pre></td></tr></table></figure><h1 id="cpp-文件"><a href="#cpp-文件" class="headerlink" title=".cpp 文件"></a>.cpp 文件</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mystackwidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPropertyAnimation&gt;</span></span></span><br><span class="line"></span><br><span class="line">MyStackWidget::<span class="built_in">MyStackWidget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    m_offset = <span class="number">0</span>;</span><br><span class="line">    m_curIndex = <span class="number">0</span>;</span><br><span class="line">    m_lastIndex = <span class="number">0</span>;</span><br><span class="line">    m_duration = <span class="number">500</span>;</span><br><span class="line">    m_moveAnimation = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(<span class="keyword">this</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">setDuration</span>(m_duration);</span><br><span class="line">    <span class="built_in">connect</span>(m_moveAnimation, &amp;QPropertyAnimation::valueChanged, <span class="keyword">this</span>, &amp;MyStackWidget::onValueChanged);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyStackWidget::~<span class="built_in">MyStackWidget</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyStackWidget::count</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_widgetLst.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyStackWidget::currentIndex</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_curIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::setDuration</span><span class="params">(<span class="type">int</span> duration)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_duration = duration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyStackWidget::addWidget</span><span class="params">(QWidget * widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="built_in">indexOf</span>(widget);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">    widget-&gt;<span class="built_in">setParent</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_widgetLst.<span class="built_in">append</span>(widget);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">count</span>() - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyStackWidget::indexOf</span><span class="params">(QWidget * widget)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_widgetLst.<span class="built_in">indexOf</span>(widget);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyStackWidget::insertWidget</span><span class="params">(<span class="type">int</span> index, QWidget * widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> curindex = <span class="built_in">indexOf</span>(widget);</span><br><span class="line">    <span class="keyword">if</span> (curindex &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> curindex;</span><br><span class="line">    &#125;</span><br><span class="line">    widget-&gt;<span class="built_in">setParent</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_widgetLst.<span class="built_in">insert</span>(index, widget);</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QWidget * <span class="title">MyStackWidget::currentWidget</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_curIndex &gt;= <span class="number">0</span> &amp;&amp; m_curIndex &lt; <span class="built_in">count</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> m_widgetLst.<span class="built_in">at</span>(m_curIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QWidget * <span class="title">MyStackWidget::widget</span><span class="params">(<span class="type">int</span> index)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; <span class="built_in">count</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> m_widgetLst.<span class="built_in">at</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::removeWidget</span><span class="params">(QWidget * widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="built_in">indexOf</span>(widget);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        m_widgetLst.<span class="built_in">removeAll</span>(widget);</span><br><span class="line">        <span class="function">emit <span class="title">widgetRemoved</span><span class="params">(index)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::setCurrentWidget</span><span class="params">(QWidget * widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="built_in">indexOf</span>(widget);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; m_curIndex != index) &#123;</span><br><span class="line">        <span class="built_in">setCurrentIndex</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::setCurrentIndex</span><span class="params">(<span class="type">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; m_curIndex != index) &#123;</span><br><span class="line">        m_lastIndex = m_curIndex;</span><br><span class="line">        m_curIndex = index;</span><br><span class="line">        <span class="built_in">moveAnimationStart</span>();</span><br><span class="line">        <span class="function">emit <span class="title">currentChanged</span><span class="params">(index)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::resizeEvent</span><span class="params">(QResizeEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QWidget::<span class="built_in">resizeEvent</span>(event);</span><br><span class="line">    <span class="type">int</span> size = <span class="built_in">count</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        m_widgetLst.<span class="built_in">at</span>(i)-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>(), <span class="keyword">this</span>-&gt;<span class="built_in">height</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_moveAnimation-&gt;<span class="built_in">state</span>() == QAbstractAnimation::Running) &#123;</span><br><span class="line">        <span class="built_in">moveAnimationStart</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">setWidgetsVisible</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::onValueChanged</span><span class="params">(<span class="type">const</span> QVariant &amp;value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_offset = value.<span class="built_in">toInt</span>();</span><br><span class="line">    m_widgetLst.<span class="built_in">at</span>(m_curIndex)-&gt;<span class="built_in">move</span>(m_offset, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (m_curIndex &gt; m_lastIndex) &#123;</span><br><span class="line">        m_widgetLst.<span class="built_in">at</span>(m_lastIndex)-&gt;<span class="built_in">move</span>(m_offset - <span class="keyword">this</span>-&gt;<span class="built_in">width</span>(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        m_widgetLst.<span class="built_in">at</span>(m_lastIndex)-&gt;<span class="built_in">move</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>() + m_offset, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::moveAnimationStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">stop</span>();</span><br><span class="line">    <span class="built_in">setWidgetsVisible</span>();</span><br><span class="line">    <span class="type">int</span> startOffset = m_offset;</span><br><span class="line">    <span class="keyword">if</span> (m_curIndex &gt; m_lastIndex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (startOffset == <span class="number">0</span>) startOffset = <span class="keyword">this</span>-&gt;<span class="built_in">width</span>();</span><br><span class="line">        <span class="keyword">else</span> startOffset = <span class="keyword">this</span>-&gt;<span class="built_in">width</span>() - <span class="built_in">qAbs</span>(startOffset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (startOffset == <span class="number">0</span>) startOffset = -<span class="keyword">this</span>-&gt;<span class="built_in">width</span>();</span><br><span class="line">        <span class="keyword">else</span> startOffset = <span class="built_in">qAbs</span>(startOffset) - <span class="keyword">this</span>-&gt;<span class="built_in">width</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">setDuration</span>(<span class="built_in">qAbs</span>(startOffset) * m_duration / <span class="keyword">this</span>-&gt;<span class="built_in">width</span>());</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">setStartValue</span>(startOffset);</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">setEndValue</span>(<span class="number">0</span>);</span><br><span class="line">    m_moveAnimation-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyStackWidget::setWidgetsVisible</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> size = <span class="built_in">count</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_lastIndex == i || m_curIndex == i)</span><br><span class="line">            m_widgetLst.<span class="built_in">at</span>(i)-&gt;<span class="built_in">setVisible</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            m_widgetLst.<span class="built_in">at</span>(i)-&gt;<span class="built_in">setVisible</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 动画 </tag>
            
            <tag> QStackWidget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QStackWidget动画（1）</title>
      <link href="/Code/Qt/%E5%8A%A8%E7%94%BB/QStackWidget%E5%8A%A8%E7%94%BB/"/>
      <url>/Code/Qt/%E5%8A%A8%E7%94%BB/QStackWidget%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<p>使用直接提升为组件为当前组件即可。</p><p>.h</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> QANIMATIONSTACKEDWIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QANIMATIONSTACKEDWIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QStackedWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QVariant&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QPropertyAnimation</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QGraphicsOpacityEffect</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QParallelAnimationGroup</span>;</span><br><span class="line"><span class="comment">//class QVariant;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QAnimationStackedWidget</span> : <span class="keyword">public</span> QStackedWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">QAnimationStackedWidget</span><span class="params">(QWidget *parent = Q_NULLPTR)</span></span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">QAnimationStackedWidget</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Next</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SwitchToIndex</span><span class="params">(<span class="type">int</span> NextIndex, <span class="type">bool</span> bFront = <span class="literal">true</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCurrentWidget</span><span class="params">(QWidget* widget)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QParallelAnimationGroup* m_ParlGroup;</span><br><span class="line"></span><br><span class="line">    QPropertyAnimation *m_pAnimPrty;</span><br><span class="line"></span><br><span class="line">    QGraphicsOpacityEffect* m_pAnimGraphicsEffect;</span><br><span class="line">    QPropertyAnimation* m_pAnimGraphics;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> m_bAnimation;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> m_nDuration;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> m_nWidgetCount;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> m_nNextIndex;</span><br><span class="line"></span><br><span class="line">    QVariant m_nCurValue;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> m_bMoveFront;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintPrevious</span><span class="params">(QPainter &amp;paint, <span class="type">int</span> currentIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintNext</span><span class="params">(QPainter &amp;paint, <span class="type">int</span> nextIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">moveAnimationStart</span><span class="params">(<span class="type">bool</span> bEnter)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">slotAnimationValueChanged</span><span class="params">(QVariant value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">slotAnimationFinished</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// QANIMATIONSTACKEDWIDGET_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;QAnimationStackedWidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPropertyAnimation&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QParallelAnimationGroup&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGraphicsOpacityEffect&gt;</span></span></span><br><span class="line"></span><br><span class="line">QAnimationStackedWidget::<span class="built_in">QAnimationStackedWidget</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QStackedWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QAnimationStackedWidget::~<span class="built_in">QAnimationStackedWidget</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_bAnimation = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    m_nDuration = <span class="number">350</span>;</span><br><span class="line"></span><br><span class="line">    m_ParlGroup = <span class="keyword">new</span> <span class="built_in">QParallelAnimationGroup</span>();</span><br><span class="line"></span><br><span class="line">    m_pAnimGraphicsEffect = <span class="keyword">new</span> <span class="built_in">QGraphicsOpacityEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_pAnimGraphicsEffect-&gt;<span class="built_in">setOpacity</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setGraphicsEffect</span>(m_pAnimGraphicsEffect);</span><br><span class="line"></span><br><span class="line">m_pAnimGraphics = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(m_pAnimGraphicsEffect, <span class="string">&quot;opacity&quot;</span>);</span><br><span class="line">    m_pAnimPrty = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(<span class="keyword">this</span>, <span class="built_in">QByteArray</span>());</span><br><span class="line">    <span class="built_in">connect</span>(m_pAnimPrty, <span class="built_in">SIGNAL</span>(<span class="built_in">valueChanged</span>(QVariant)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">slotAnimationValueChanged</span>(QVariant)));</span><br><span class="line">    <span class="built_in">connect</span>(m_pAnimPrty, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">slotAnimationFinished</span>()));</span><br><span class="line"></span><br><span class="line">    m_pAnimPrty-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br><span class="line">    m_pAnimGraphics-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br><span class="line"></span><br><span class="line">m_ParlGroup-&gt;<span class="built_in">addAnimation</span>(m_pAnimPrty);</span><br><span class="line">m_ParlGroup-&gt;<span class="built_in">addAnimation</span>(m_pAnimGraphics);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::slotAnimationValueChanged</span><span class="params">(QVariant value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_nCurValue = value;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::slotAnimationFinished</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_bAnimation = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">widget</span>(<span class="built_in">currentIndex</span>())-&gt;<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setCurrentIndex</span>(m_nNextIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::paintEvent</span><span class="params">(QPaintEvent *e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_bAnimation)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">QPainter <span class="title">paint</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m_bMoveFront)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//绘制当前Widget</span></span><br><span class="line">            <span class="built_in">paintPrevious</span>(paint, <span class="built_in">currentIndex</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绘制下一个widget</span></span><br><span class="line">            <span class="built_in">paintNext</span>(paint, m_nNextIndex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//绘制当前Widget</span></span><br><span class="line">            <span class="built_in">paintPrevious</span>(paint, m_nNextIndex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绘制下一个widget</span></span><br><span class="line">            <span class="built_in">paintNext</span>(paint, <span class="built_in">currentIndex</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::paintPrevious</span><span class="params">(QPainter &amp;paint, <span class="type">int</span> currentIndex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获得当前页面的Widget</span></span><br><span class="line">    QWidget *w = <span class="built_in">widget</span>(currentIndex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 切换过程窗口的背景色</span></span><br><span class="line">    QString strStyle = <span class="built_in">QString</span>(<span class="string">&quot;#%1&#123;background-color: #FFFFFF&#125;&quot;</span>).<span class="built_in">arg</span>(w-&gt;<span class="built_in">objectName</span>());</span><br><span class="line"></span><br><span class="line">    w-&gt;<span class="built_in">setStyleSheet</span>(strStyle);</span><br><span class="line"></span><br><span class="line">    <span class="function">QPixmap <span class="title">pixmap</span><span class="params">(w-&gt;size())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将Widget的内容渲染到QPixmap对象中，即将Widget变成一张图片</span></span><br><span class="line">    w-&gt;<span class="built_in">render</span>(&amp;pixmap);</span><br><span class="line"></span><br><span class="line">    QRect r = w-&gt;<span class="built_in">geometry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制当前的Widget</span></span><br><span class="line">    <span class="type">double</span> value = m_nCurValue.<span class="built_in">toDouble</span>();</span><br><span class="line">    <span class="function">QRectF <span class="title">r1</span><span class="params">(<span class="number">0.0</span>, <span class="number">0.0</span>, value, r.height())</span></span>;</span><br><span class="line">    <span class="function">QRectF <span class="title">r2</span><span class="params">(r.width() - value, <span class="number">0</span>, value, r.height())</span></span>;</span><br><span class="line">    paint.<span class="built_in">drawPixmap</span>(r1, pixmap, r2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::paintNext</span><span class="params">(QPainter &amp;paint, <span class="type">int</span> nextIndex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QWidget *nextWidget = <span class="built_in">widget</span>(nextIndex);</span><br><span class="line"></span><br><span class="line">    QString strStyle = <span class="built_in">QString</span>(<span class="string">&quot;#%1&#123;background-color: #FFFFFF&#125;&quot;</span>).<span class="built_in">arg</span>(nextWidget-&gt;<span class="built_in">objectName</span>());</span><br><span class="line"></span><br><span class="line">    nextWidget-&gt;<span class="built_in">setStyleSheet</span>(strStyle);</span><br><span class="line"></span><br><span class="line">    QRect r = <span class="built_in">geometry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这行代码不加会有bug，第一次切换的时候，QStackedWidget并没有为child分配大小</span></span><br><span class="line">    nextWidget-&gt;<span class="built_in">resize</span>(r.<span class="built_in">width</span>(), r.<span class="built_in">height</span>());</span><br><span class="line">    <span class="function">QPixmap <span class="title">nextPixmap</span><span class="params">(nextWidget-&gt;size())</span></span>;</span><br><span class="line"></span><br><span class="line">    nextWidget-&gt;<span class="built_in">render</span>(&amp;nextPixmap);</span><br><span class="line">    <span class="type">double</span> value = m_nCurValue.<span class="built_in">toDouble</span>();</span><br><span class="line">    <span class="function">QRectF <span class="title">r1</span><span class="params">(value, <span class="number">0.0</span>, r.width() - value, r.height())</span></span>;</span><br><span class="line">    <span class="function">QRectF <span class="title">r2</span><span class="params">(<span class="number">0.0</span>, <span class="number">0.0</span>, r.width() - value, r.height())</span></span>;</span><br><span class="line"></span><br><span class="line">    paint.<span class="built_in">drawPixmap</span>(r1, nextPixmap, r2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::moveAnimationStart</span><span class="params">(<span class="type">bool</span> bEnter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (bEnter)</span><br><span class="line">&#123;</span><br><span class="line">m_pAnimPrty-&gt;<span class="built_in">setStartValue</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>());</span><br><span class="line">m_pAnimPrty-&gt;<span class="built_in">setEndValue</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setDuration</span>(m_nDuration);</span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setStartValue</span>(<span class="number">0</span>);</span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setEndValue</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">m_pAnimPrty-&gt;<span class="built_in">setStartValue</span>(<span class="number">0</span>);</span><br><span class="line">m_pAnimPrty-&gt;<span class="built_in">setEndValue</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>());</span><br><span class="line"></span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setDuration</span>(m_nDuration);</span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setStartValue</span>(<span class="number">0</span>);</span><br><span class="line">m_pAnimGraphics-&gt;<span class="built_in">setEndValue</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m_pAnimPrty-&gt;<span class="built_in">setDuration</span>(m_nDuration);</span><br><span class="line"></span><br><span class="line"><span class="comment">// m_pAnimPrty-&gt;start();</span></span><br><span class="line"></span><br><span class="line">m_ParlGroup-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::SwitchToIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">bool</span> bFront)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//如果正在动画，那么return</span></span><br><span class="line">    <span class="type">int</span> curIndex = <span class="built_in">currentIndex</span>();</span><br><span class="line"></span><br><span class="line">    m_bMoveFront = bFront;</span><br><span class="line">    m_bAnimation = <span class="literal">true</span>;</span><br><span class="line">    m_nWidgetCount = <span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    m_nNextIndex = index;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//隐藏当前的widget</span></span><br><span class="line">    <span class="built_in">widget</span>(curIndex)-&gt;<span class="built_in">hide</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始动画并设置间隔和开始、结束值</span></span><br><span class="line">    QRect g = <span class="built_in">geometry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> width = g.<span class="built_in">width</span>();</span><br><span class="line"></span><br><span class="line">    bFront = index &gt;= curIndex;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">moveAnimationStart</span>(bFront);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::setCurrentWidget</span><span class="params">(QWidget* widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> index = <span class="built_in">indexOf</span>(widget);</span><br><span class="line">    <span class="built_in">SwitchToIndex</span>(index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QAnimationStackedWidget::Next</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//如果正在动画，那么return</span></span><br><span class="line">    <span class="keyword">if</span>(m_bAnimation)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_bAnimation = <span class="literal">true</span>;</span><br><span class="line">    m_nWidgetCount = <span class="built_in">count</span>();</span><br><span class="line">    <span class="type">int</span> nIndex = <span class="built_in">currentIndex</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算下一页的索引</span></span><br><span class="line">    m_nNextIndex = (nIndex + <span class="number">1</span>) % m_nWidgetCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//隐藏当前的widget</span></span><br><span class="line">    <span class="built_in">widget</span>(nIndex)-&gt;<span class="built_in">hide</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始动画并设置间隔和开始、结束值</span></span><br><span class="line">    QRect g = <span class="built_in">geometry</span>();</span><br><span class="line">    <span class="type">int</span> x = g.<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">int</span> width = g.<span class="built_in">width</span>();</span><br><span class="line">    m_pAnimPrty-&gt;<span class="built_in">setStartValue</span>(width);</span><br><span class="line">    m_pAnimPrty-&gt;<span class="built_in">setEndValue</span>(<span class="number">0</span>);</span><br><span class="line">    m_pAnimPrty-&gt;<span class="built_in">setDuration</span>(m_nDuration);</span><br><span class="line">    m_pAnimPrty-&gt;<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 动画 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动画 </tag>
            
            <tag> QStackWidget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 国际化</title>
      <link href="/Code/Qt/%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2/"/>
      <url>/Code/Qt/%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p>支持国际化是软件发布的基本项。现阶段我所在的项目也是有了这一需求，基于Qt实现这一需求也相对比较简单。</p><p>[toc]</p><h1 id="Qt支持国际化"><a href="#Qt支持国际化" class="headerlink" title="# Qt支持国际化"></a># Qt支持国际化</h1><p>Qt安装时，带了一个 <code>Qt Linguist</code> 的软件，这个软件就是 Qt 用来实现软件翻译的工具。在 Qt 中，所有的输入不见和文本绘制方式对Qt支持的所有语言都提供了内置的支持。Qt内置的字体引擎可以在同一时间正确而且精确地绘制不同的文本，这些文本可以包含来自众多不同书写系统的字符。</p><h1 id="使用-Qt-Linguist-翻译工具"><a href="#使用-Qt-Linguist-翻译工具" class="headerlink" title="# 使用 Qt Linguist 翻译工具"></a># 使用 Qt Linguist 翻译工具</h1><h2 id="tr-函数"><a href="#tr-函数" class="headerlink" title="tr()函数"></a><code>tr()</code>函数</h2><p>在Qt中编写代码时要对需要显示的字符串调用 <code>tr()</code> 函数，完成代码编写后对这个应用程序的翻译主要包含以下几个步骤：</p><blockquote><p>使用tr()函数 -&gt; 修改pro文件 -&gt; 更新语言文件 -&gt; 发布语言文件 -&gt; 使用语言文件（QTranslator）</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Qt 因为槽函数问题或者逻辑问题导致重复new问题解决办法及建议</title>
      <link href="/Code/Qt/%E5%86%85%E5%AD%98/%E9%87%8D%E5%A4%8Dnew%E9%97%AE%E9%A2%98/"/>
      <url>/Code/Qt/%E5%86%85%E5%AD%98/%E9%87%8D%E5%A4%8Dnew%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="槽函数中重复-new"><a href="#槽函数中重复-new" class="headerlink" title="槽函数中重复 new"></a>槽函数中重复 <code>new</code></h1><p>这个问题比骄常见，举一个简单的例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;<span class="keyword">this</span>::slotCreateItem);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">slotCreateItem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QWidget *widget = <span class="keyword">new</span> <span class="built_in">QWidget</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timer-&gt;<span class="built_in">start</span>(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>上边只是为了说明一下类似的这种情况，由于一些特殊原因导致的槽函数中会多次触发 <code>new</code> 操作。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><ol><li><p>设置为成员变量，在进入函数时，先执行 <code>delete</code> ，再去 <code>new</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">slotCreateItem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">nullptr</span> == m_widget)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> m_widget;</span><br><span class="line">        m_widget = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    m_widget = <span class="keyword">new</span> <span class="built_in">QWidget</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>第二种办法就是设置控件属性</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">slotCreateItem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QWidget *widget = <span class="keyword">new</span> <span class="built_in">QWidget</span>();</span><br><span class="line">    widget-&gt;<span class="built_in">setAttribute</span>(WA_DeleteOnClose);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="槽函数多次绑定问题"><a href="#槽函数多次绑定问题" class="headerlink" title="槽函数多次绑定问题"></a>槽函数多次绑定问题</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;<span class="keyword">this</span>::slotCreateItem);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">slotCreateItem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;<span class="keyword">this</span>::slotRePaint); <span class="comment">// 每进入一次就会绑定一次，每绑定一次，触发次数就会增加一次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="解决办法-1"><a href="#解决办法-1" class="headerlink" title="解决办法"></a>解决办法</h2><p>使用 Qt 的第五个参数控制。将上述代码改为以下形式</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;<span class="keyword">this</span>::slotRePaint, Qt::UniqueConnection); <span class="comment">// （modify）每进入一次就会绑定一次，每绑定一次，触发次数就会增加一次</span></span><br></pre></td></tr></table></figure><blockquote><p> <code>Qt::UniqueConnection</code>：这是一个标记，可以使用位或与上述任何一种连接类型结合使用。当 <code>Qt::UniqueConnection</code> 被设置后，如果连接已经存在，<code>QObject::connect()</code> 将会失败(即，如果相同的信号已经为同一对对象连接到相同的槽位)。这个标志是在Qt 4.6中引入的。</p></blockquote><p>以下为 Qt 第五个参数各个含义：</p><table><thead><tr><th>常量</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td>Qt::AutoConnection</td><td>0</td><td>(默认)如果接收器位于发出信号的线程中，则使用Qt::DirectConnection。否则，使用Qt::QueuedConnection。连接类型是在信号发出时确定的。</td></tr><tr><td>Qt::DirectConnection</td><td>1</td><td>发出信号时立即调用插槽。槽在信令线程中执行。</td></tr><tr><td>Qt::QueuedConnection</td><td>2</td><td>当控制返回到接收方线程的事件循环时，将调用插槽。插槽在接收方的线程中执行。</td></tr><tr><td>Qt::BlockingQueuedConnection</td><td>3</td><td>与Qt::QueuedConnection相同，除了信令线程阻塞直到插槽返回。如果接收端位于信令线程中，则绝不能使用此连接，否则应用程序将死锁。</td></tr><tr><td>Qt::UniqueConnection</td><td>0x80</td><td>这是一个标记，可以使用位或与上述任何一种连接类型结合使用。当Qt::UniqueConnection被设置后，如果连接已经存在，QObject::connect()将会失败</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> 内存 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> new </tag>
            
            <tag> 内存 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt pro文件用法</title>
      <link href="/Code/Qt/pro%E6%96%87%E4%BB%B6%E7%94%A8%E6%B3%95/"/>
      <url>/Code/Qt/pro%E6%96%87%E4%BB%B6%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="宏判断"><a href="#宏判断" class="headerlink" title="宏判断"></a>宏判断</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(contains(DEFINES,OEM_Config)) &#123;</span><br><span class="line">    FORMS += $<span class="variable">$PWD</span>/Form.ui</span><br><span class="line">    HEADERS += $<span class="variable">$PWD</span>/Form.h</span><br><span class="line">    SOURCES += $<span class="variable">$PWD</span>/Form.cpp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pro文件转vcproj之后的配置"><a href="#pro文件转vcproj之后的配置" class="headerlink" title="pro文件转vcproj之后的配置"></a>pro文件转vcproj之后的配置</h2><ol><li>常规项</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置工具集为</span></span><br><span class="line">$(DefaultPlatformToolset)</span><br><span class="line"><span class="comment"># 设置sdk版本</span></span><br><span class="line">$([Microsoft.Build.Utilities.ToolLocationHelper]::GetLatestSDKTargetPlatformVersion(<span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;10.0&#x27;</span>))</span><br></pre></td></tr></table></figure><ol start="2"><li>生成前事件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call $(SolutionDir)prompt.bat</span><br></pre></td></tr></table></figure><ol start="3"><li>prompt.bat</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------------------------</span><br><span class="line"><span class="built_in">echo</span> [TrustAgent.pro] 文件有更新时，请重新生成当前工程</span><br><span class="line"><span class="built_in">echo</span> 以下配置并不适用于所有人，如有编译报错，请自行修改。</span><br><span class="line"><span class="built_in">echo</span> 1. Qt工具集默认配置为环境变量QtPath: 当前系统QtPath:[%QtPath%] （推荐 5.9.9_msvc2015）</span><br><span class="line"><span class="built_in">echo</span> 2. 工具集默认配置为: $(DefaultPlatformToolset) （推荐 10.0.19041.0及以上）</span><br><span class="line"><span class="built_in">echo</span> 3. SDK默认配置为: $([Microsoft.Build.Utilities.ToolLocationHelper]::GetLatestSDKTargetPlatformVersion(<span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;10.0&#x27;</span>)) （推荐 V142）</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------------------------</span><br><span class="line"></span><br><span class="line">@REM <span class="keyword">if</span> <span class="string">&quot;%QtPath%&quot;</span> == <span class="string">&quot;&quot;</span> (</span><br><span class="line">@REM     choice /c:yn /m <span class="string">&quot;当前未配置环境变量，是否打开系统配置页面：&quot;</span></span><br><span class="line">@REM     <span class="keyword">if</span> %errorlevel%==1 (</span><br><span class="line">@REM         start ms-settings:about</span><br><span class="line">@REM     )</span><br><span class="line">@REM )</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 重启</title>
      <link href="/Code/Qt/Qt%E9%87%8D%E5%90%AF/"/>
      <url>/Code/Qt/Qt%E9%87%8D%E5%90%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="Qt-实现电脑重启（需要管理员）"><a href="#Qt-实现电脑重启（需要管理员）" class="headerlink" title="Qt 实现电脑重启（需要管理员）"></a>Qt 实现电脑重启（需要管理员）</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">reboot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString program = QApplication::<span class="built_in">applicationFilePath</span>();</span><br><span class="line">QStringList arguments = QApplication::<span class="built_in">arguments</span>();</span><br><span class="line">QString workingDirectory = QDir::<span class="built_in">currentPath</span>();</span><br><span class="line">QProcess::<span class="built_in">startDetached</span>(program, arguments, workingDirectory);</span><br><span class="line">QApplication::<span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt获取控件位置</title>
      <link href="/Code/Qt/Qt%E8%8E%B7%E5%8F%96%E6%8E%A7%E4%BB%B6%E4%BD%8D%E7%BD%AE/"/>
      <url>/Code/Qt/Qt%E8%8E%B7%E5%8F%96%E6%8E%A7%E4%BB%B6%E4%BD%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Qt 获取窗口、系统屏幕大小尺寸信息，Qt获取控件位置坐标、屏幕坐标，相对父窗体坐标 </p></blockquote><p>[toc]</p><h1 id="一、获取窗口大小尺寸信息"><a href="#一、获取窗口大小尺寸信息" class="headerlink" title="一、获取窗口大小尺寸信息"></a>一、获取窗口大小尺寸信息</h1><p>Qt 窗口尺寸，窗口大小和大小改变引起的事件 <code>QResizeEvent</code>。</p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E8%8E%B7%E5%8F%96%E6%8E%A7%E4%BB%B6%E4%BD%8D%E7%BD%AE/1.png" alt="在这里插入图片描述" style="zoom:80%;float:left;" /><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E8%8E%B7%E5%8F%96%E6%8E%A7%E4%BB%B6%E4%BD%8D%E7%BD%AE/2.png" alt="在这里插入图片描述" style="float: left;" /><h2 id="涉及坐标、长宽的接口"><a href="#涉及坐标、长宽的接口" class="headerlink" title="涉及坐标、长宽的接口"></a>涉及坐标、长宽的接口</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗口左上角的位置(含边框)</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">frameGeometry</span>().<span class="built_in">x</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">frameGeometry</span>().<span class="built_in">y</span>() &lt;&lt; ;<span class="comment">//1</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">x</span>()  &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">y</span>();<span class="comment">//2</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">x</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">y</span>();<span class="comment">//3</span></span><br><span class="line"><span class="comment">//窗口的宽度和高度(含边框)</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">frameGeometry</span>().<span class="built_in">width</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">frameGeometry</span>().<span class="built_in">height</span>();</span><br><span class="line"><span class="comment">//窗口左上角的位置(不含边框)</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">x</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">y</span>();</span><br><span class="line"><span class="comment">//窗口的宽度和高度(不含边框)</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">width</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">height</span>();<span class="comment">//1</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">width</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">height</span>();<span class="comment">//2</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">rect</span>().<span class="built_in">width</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">rect</span>().<span class="built_in">height</span>();<span class="comment">//3</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">size</span>().<span class="built_in">width</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">size</span>().<span class="built_in">height</span>();<span class="comment">//4</span></span><br></pre></td></tr></table></figure><h1 id="Qt获取系统屏幕大小"><a href="#Qt获取系统屏幕大小" class="headerlink" title="Qt获取系统屏幕大小"></a>Qt获取系统屏幕大小</h1><p><code>QDesktopWidget</code> 提供了详细的位置信息，其能够自动返回窗口在用户窗口的位置和应用程序窗口的位置。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QDesktopWidget* pDesktopWidget = QApplication::<span class="built_in">desktop</span>();</span><br><span class="line"><span class="comment">//获取可用桌面大小</span></span><br><span class="line">QRect deskRect = QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">availableGeometry</span>();</span><br><span class="line"><span class="comment">//获取主屏幕分辨率</span></span><br><span class="line">QRect screenRect = QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">screenGeometry</span>();</span><br><span class="line"><span class="comment">//获取屏幕数量</span></span><br><span class="line"><span class="type">int</span> nScreenCount = QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">screenCount</span>();</span><br></pre></td></tr></table></figure><p>Qt5开始， <code>QDesktopWidget</code>官方不建议使用，改为 <code>QScreen</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QScreen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QRect&gt;</span></span></span><br><span class="line"> </span><br><span class="line">QList&lt;QScreen *&gt; list_screen =  QGuiApplication::<span class="built_in">screens</span>();  <span class="comment">//多显示器</span></span><br><span class="line">QRect rect = list_screen.<span class="built_in">at</span>(<span class="number">0</span>)-&gt;<span class="built_in">geometry</span>();</span><br><span class="line">desktop_width = rect.<span class="built_in">width</span>();</span><br><span class="line">desktop_height = rect.<span class="built_in">height</span>();</span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; desktop_width &lt;&lt;desktop_height;</span><br></pre></td></tr></table></figure><h1 id="三、设置窗体大小"><a href="#三、设置窗体大小" class="headerlink" title="三、设置窗体大小"></a>三、设置窗体大小</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setGeometry</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setGeometry</span><span class="params">(<span class="type">const</span> QRect &amp;)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">const</span> QSize &amp;)</span></span></span><br></pre></td></tr></table></figure><h1 id="四、Qt获取控件位置坐标、屏幕坐标、相对父窗体坐标"><a href="#四、Qt获取控件位置坐标、屏幕坐标、相对父窗体坐标" class="headerlink" title="四、Qt获取控件位置坐标、屏幕坐标、相对父窗体坐标"></a>四、Qt获取控件位置坐标、屏幕坐标、相对父窗体坐标</h1><ol><li>这个只是返回相对这个 <code>widget</code> （重载了<code>QMouseEvent</code>的<code>widget</code>）的位置。</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QMouseEvent::pos</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><ol start="2"><li>窗口坐标，这个是返回鼠标的全局坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QMouseEvent::globalPos</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><ol start="3"><li>相对显示器的全局坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QCursor::pos</span><span class="params">()</span> [<span class="type">static</span>]</span></span><br></pre></td></tr></table></figure><ol start="4"><li>将窗口坐标转换成显示器坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QWidget::mapToGlobal</span><span class="params">(<span class="type">const</span> QPoint &amp; pos)</span>  <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="5"><li>将显示器坐标转换成窗口坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QWidget::mapFromGlobal</span><span class="params">(<span class="type">const</span> QPoint &amp; pos)</span> <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="6"><li>将窗口坐标获得的<code>pos</code>转成父类<code>widget</code>的坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QWidget::mapFromParent</span><span class="params">(<span class="type">const</span> QPoint &amp; pos)</span> <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="7"><li>将当前窗口坐标转换成指定<code>parent</code>坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPoint <span class="title">QWidget::mapTo</span><span class="params">(<span class="type">const</span> QWidget * parent, <span class="type">const</span> QPoint &amp;pos)</span> <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="8"><li>这个属性获得的是当前目前控件在父窗口中的位置</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> QPointF &amp;<span class="title">QMouseEvent::screenPos</span><span class="params">()</span> <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="9"><li>Returns the position of the mouse cursor asa QPointF, relative to the screen that received the event.<br>和 <code>QPoint QMouseEvent::globalPos()</code> 值相同，但是类型更高精度的 <code>QPointF</code><br>This function was introduced in Qt 5.0.</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> QPointF &amp;<span class="title">QMouseEvent::screenPos</span><span class="params">()</span> <span class="type">const</span></span></span><br></pre></td></tr></table></figure><ol start="10"><li>获取全局坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QCursor::<span class="built_in">pos</span>() == QMouseEvent::<span class="built_in">globalPos</span>() </span><br></pre></td></tr></table></figure><ol start="11"><li>将鼠标的坐标转换成全局坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QMouseEvent::<span class="built_in">globalPos</span>() == ui.posBtn-&gt;<span class="built_in">mapToGlobal</span>(ui.posBtn-&gt;<span class="built_in">pos</span>());</span><br></pre></td></tr></table></figure><ol start="12"><li>将鼠标坐标（鼠标当前坐标，QCursor::pos()）直接转换成当前窗口相对坐标</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui.posBtn-&gt;<span class="built_in">mapFromGlobal</span>(QCursor::<span class="built_in">pos</span>());</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLite3 数据库加密</title>
      <link href="/Code/Qt/SQLite%E5%8A%A0%E5%AF%86/"/>
      <url>/Code/Qt/SQLite%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<h2 id="Set-Connect-options"><a href="#Set-Connect-options" class="headerlink" title="Set Connect options"></a>Set Connect options</h2><ul><li>Provided by Qt SqlitePlugin<ul><li>QSQLITE_BUSY_TIMEOUT</li><li>QSQLITE_OPEN_READONLY</li><li>QSQLITE_OPEN_URI</li><li>QSQLITE_ENABLE_SHARED_CACHE</li></ul></li><li>Added by QtCipherSqlitePlugin<ul><li>QSQLITE_CREATE_KEY</li><li>QSQLITE_UPDATE_KEY</li><li>QSQLITE_REMOVE_KEY</li></ul></li></ul><h1 id="创建数据库密码-QSQLITE-CREATE-KEY"><a href="#创建数据库密码-QSQLITE-CREATE-KEY" class="headerlink" title="创建数据库密码 QSQLITE_CREATE_KEY"></a>创建数据库密码 <code>QSQLITE_CREATE_KEY</code></h1><p>如果输出中有 <code>SQLITECIPHER</code> 的名字，那么恭喜你，插件没有问题！<br>为没有加密的数据库增加密码<br>Qt 默认提供的 SQLite 插件是没有加密功能的。新版本的 <code>QtCipherSqlitePlugin</code> 支持为原本没有加密的数据库增加密码，使用方法如下：<br>C++</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_CREATE_KEY&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;    </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();    </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码，我们使用 <code>test.db</code> 数据库，将密码设置为 test，同时指定连接选项为 <code>QSQLITE_CREATE_KEY</code> 。此时，调用 open() 函数之后，<code>QtCipherSqlitePlugin</code> 将使用改密码为这个数据库进行加密。</p><h1 id="删除数据库密码-QSQLITE-REMOVE-KEY"><a href="#删除数据库密码-QSQLITE-REMOVE-KEY" class="headerlink" title="删除数据库密码 QSQLITE_REMOVE_KEY"></a>删除数据库密码 <code>QSQLITE_REMOVE_KEY</code></h1><p><code>QtCipherSqlitePlugin</code> 可以删除数据库密码，此时需要提供原密码，并使用连接选项 <code>QSQLITE_REMOVE_KEY</code> ，如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_REMOVE_KEY&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;   </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();   </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="更新数据库密码-QSQLITE-UPDATE-KEY"><a href="#更新数据库密码-QSQLITE-UPDATE-KEY" class="headerlink" title="更新数据库密码 QSQLITE_UPDATE_KEY"></a>更新数据库密码 <code>QSQLITE_UPDATE_KEY</code></h1><p><code>QtCipherSqlitePlugin</code> 可以更新数据库原有密码，需要设置原密码，并且使用连接选项 <code>QSQLITE_UPDATE_KEY</code> 设置新密码，具体代码如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase dbconn = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;SQLITECIPHER&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;test.db&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setPassword</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">dbconn.<span class="built_in">setConnectOptions</span>(<span class="string">&quot;QSQLITE_UPDATE_KEY=newtest&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (!dbconn.<span class="built_in">open</span>()) &#123;    </span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Can not open connection: &quot;</span> &lt;&lt; dbconn.<span class="built_in">lastError</span>().<span class="built_in">driverText</span>();   </span><br><span class="line">    <span class="built_in">exit</span>(CONNECTION_FAILED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果原密码不正确，<code>QtCipherSqlitePlugin</code> 会直接返回错误。</p><p>如果新密码设置为空，例如 <code>QSQLITE_UPDATE_KEY=</code> ，则作用等同于删除密码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QUpdateDB::setDBConfig</span><span class="params">(QSqlDatabase* dbconn, QMap&lt;ENUM_SQLKEY, QString&gt; qMapCfg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it : qMapCfg.<span class="built_in">toStdMap</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (it.first &lt;= QSQLITE_REMOVE_KEY)</span><br><span class="line">&#123;</span><br><span class="line">dbconn-&gt;<span class="built_in">setPassword</span>(it.second);</span><br><span class="line">dbconn-&gt;<span class="built_in">setConnectOptions</span>(<span class="built_in">GETOBJNAME</span>(it.first));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (it.first == QSQLITE_UPDATE_KEY)</span><br><span class="line">&#123;</span><br><span class="line">dbconn-&gt;<span class="built_in">setPassword</span>(it.second);</span><br><span class="line">dbconn-&gt;<span class="built_in">setConnectOptions</span>(<span class="built_in">QString</span>(<span class="string">&quot;%1=%2&quot;</span>).<span class="built_in">arg</span>().<span class="built_in">arg</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> SQLite3 </tag>
            
            <tag> 数据库 </tag>
            
            <tag> 开源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt实现窗口拖拽</title>
      <link href="/Code/Qt/Qt%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD/"/>
      <url>/Code/Qt/Qt%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>QT窗口默认可以直接鼠标点住窗口的标题栏实现拖拽移动，如果需要鼠标点住窗口客户区域实现窗口的拖拽移动，可以通过QMouseEvent事件来实现。</p><h1 id="h文件"><a href="#h文件" class="headerlink" title=".h文件"></a>.h文件</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QMouseEvent</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="number">0</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">//拖拽窗口</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent *event)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span>        m_bDrag;</span><br><span class="line">    QPoint      mouseStartPoint;</span><br><span class="line">    QPoint      windowTopLeftPoint;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="cpp文件"><a href="#cpp文件" class="headerlink" title=".cpp文件"></a>.cpp文件</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拖拽操作</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">button</span>() == Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        m_bDrag = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//获得鼠标的初始位置</span></span><br><span class="line">        mouseStartPoint = event-&gt;<span class="built_in">globalPos</span>();</span><br><span class="line">        <span class="comment">//mouseStartPoint = event-&gt;pos();</span></span><br><span class="line">        <span class="comment">//获得窗口的初始位置</span></span><br><span class="line">        windowTopLeftPoint = <span class="keyword">this</span>-&gt;<span class="built_in">frameGeometry</span>().<span class="built_in">topLeft</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_bDrag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//获得鼠标移动的距离</span></span><br><span class="line">        QPoint distance = event-&gt;<span class="built_in">globalPos</span>() - mouseStartPoint;</span><br><span class="line">        <span class="comment">//QPoint distance = event-&gt;pos() - mouseStartPoint;</span></span><br><span class="line">        <span class="comment">//改变窗口的位置</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">move</span>(windowTopLeftPoint + distance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseReleaseEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">button</span>() == Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        m_bDrag = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 拖拽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 截图</title>
      <link href="/Code/Qt/Qt%E6%88%AA%E5%9B%BE/"/>
      <url>/Code/Qt/Qt%E6%88%AA%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>转载自： <a href="https://www.freesion.com/article/3411345767/">QT 截图 - 灰信网（软件开发博客聚合） (freesion.com)</a></p></blockquote><p><strong>QT 截图</strong></p><h1 id="一、简要说明"><a href="#一、简要说明" class="headerlink" title="一、简要说明"></a>一、简要说明</h1><p>  <strong>简单的实现截图功能，包括全屏截图，矩形区域截图，主要环境：win7-32bit，QT Creator5.2。</strong></p><p>  工程源代码 链接：<a href="https://pan.baidu.com/s/1xt-oyaz4pWNNFG4q85nmSA">https://pan.baidu.com/s/1xt-oyaz4pWNNFG4q85nmSA</a> 密码：6uky</p><h1 id="二、效果"><a href="#二、效果" class="headerlink" title="二、效果"></a>二、效果</h1><p><strong>运行效果</strong></p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E6%88%AA%E5%9B%BE/Qt%E6%88%AA%E5%9B%BE1.gif" alt="img"></p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E6%88%AA%E5%9B%BE/Qt%E6%88%AA%E5%9B%BE2.png" alt="img"></p><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E6%88%AA%E5%9B%BE/%E6%95%88%E6%9E%9C%E5%9B%BE.png" alt="img"></p><h2 id="1、-全屏截图"><a href="#1、-全屏截图" class="headerlink" title="1、 全屏截图"></a><strong>1、 全屏截图</strong></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取全屏截图</span></span><br><span class="line"> </span><br><span class="line">QPixmapfullScreen = QPixmap::<span class="built_in">grabWindow</span>(QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">winId</span>());</span><br><span class="line"> </span><br><span class="line"><span class="comment">//打开文件对话框</span></span><br><span class="line"> </span><br><span class="line">QStringfileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="string">&quot;文件另存为&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="built_in">tr</span>(<span class="string">&quot;ConfigFiles (*.jpg)&quot;</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//保存截图</span></span><br><span class="line"> </span><br><span class="line">fullScreen.<span class="built_in">save</span>(fileName,<span class="string">&quot;jpg&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="2、-矩形截图：在全屏截图的基础上，在全屏截图选取一个矩形区域"><a href="#2、-矩形截图：在全屏截图的基础上，在全屏截图选取一个矩形区域" class="headerlink" title="2、 矩形截图：在全屏截图的基础上，在全屏截图选取一个矩形区域"></a><strong>2、 矩形截图：在全屏截图的基础上，在全屏截图选取一个矩形区域</strong></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fullScreen.<span class="built_in">copy</span>(rect).save(fileName);<span class="comment">//rect是一个矩形</span></span><br><span class="line"> </span><br><span class="line">或者是fullScreen.<span class="built_in">copy</span>(x,y,width,height).save(fileName);<span class="comment">//x,y为矩形左上角坐标，</span></span><br><span class="line"> </span><br><span class="line">width为矩形宽度，height为矩形的高度。</span><br><span class="line"> </span><br><span class="line">需要注意的是 屏幕左上角为（<span class="number">0</span>,<span class="number">0</span>），x,y分别向右、下递增。</span><br></pre></td></tr></table></figure><p><strong>那么如何实现任意的矩形区域呢？</strong></p><h1 id="四、改进"><a href="#四、改进" class="headerlink" title="四、改进"></a>四、改进</h1><h2 id="1、-任意矩形区域"><a href="#1、-任意矩形区域" class="headerlink" title="1、 任意矩形区域"></a><strong>1、 任意矩形区域</strong></h2><p>   <strong>按下鼠标左键不放得到一个点P(x1,y1)</strong></p><p>  <strong>拖动鼠标</strong></p><p>  <strong>释放鼠标左键得到另外一个点Q(x2,y2)</strong></p><p>  <strong>如此得到一个以P、Q为对角的矩形</strong></p><h2 id="2、-实现动态矩形效果"><a href="#2、-实现动态矩形效果" class="headerlink" title="2、 实现动态矩形效果"></a><strong>2、 实现动态矩形效果</strong></h2><p>  <strong>拉上一层半透明的遮罩(其实就是一个半透明的</strong>showFullScreen<strong>窗体)</strong></p><p>  <strong>注意：拉上遮罩之前应将父窗体隐去，不然每一张全屏截图都会有父窗体</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowState</span>(Qt::WindowMinimized);<span class="comment">//最小化父窗体。</span></span><br></pre></td></tr></table></figure><p>  <strong>（可能需要延时）</strong></p><p>  <strong>将矩形局域重绘(达到去除矩形区域部分的遮罩的效果)</strong></p><h2 id="3、-右键菜单-复制到剪切板-另存为-退出-以及增加快捷键"><a href="#3、-右键菜单-复制到剪切板-另存为-退出-以及增加快捷键" class="headerlink" title="3、 右键菜单(复制到剪切板+另存为+退出)以及增加快捷键"></a><strong>3、 右键菜单(复制到剪切板+另存为+退出)以及增加快捷键</strong></h2><p>  <strong>复制到剪切板：</strong>QGuiApplication::clipboard()-&gt;setPixmap(fullScreen.copy(rect));</p><p>  **组合快捷键Ctrl+C：**if(****e-&gt;key()&#x3D;&#x3D;Qt::Key_C&amp;&amp;e-&gt;modifiers()&#x3D;&#x3D;Qt::ControlModifier)</p><h2 id="4、-矩形截图时，实时显示鼠标的位置、矩形截图的位置以及大小信息"><a href="#4、-矩形截图时，实时显示鼠标的位置、矩形截图的位置以及大小信息" class="headerlink" title="4、 矩形截图时，实时显示鼠标的位置、矩形截图的位置以及大小信息"></a>4、 矩形截图时，实时显示鼠标的位置、矩形截图的位置以及大小信息</h2><p>  <strong>通过鼠标移动事件(设置鼠标轨迹跟踪：</strong>setMouseTracking(true);</p><p>  <strong>update()触发</strong><em>paintEvent重绘事件</em></p><h2 id="5、-无边框窗体拖动"><a href="#5、-无边框窗体拖动" class="headerlink" title="5、 无边框窗体拖动"></a>5、 无边框窗体拖动</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现无边框 (Qt::FramelessWindowHint去边框)  、Qt::WindowStaysOnTopHint窗体置顶 防止拖到任务栏下面</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint| Qt::WindowSystemMenuHint |Qt::WindowMinMaxButtonsHint|Qt::WindowStaysOnTopHint);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//拖动(实际上是根据鼠标的移动 来移动窗体)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//当前鼠标相对窗体的位置-刚按下左键时的相对位置=鼠标移动的大小</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">move</span>(e-&gt;<span class="built_in">pos</span>()-beginPos+<span class="keyword">this</span>-&gt;<span class="built_in">pos</span>());</span><br><span class="line"> </span><br><span class="line"><span class="comment">//鼠标移动的大小+窗体原来的位置=窗体移动后的位置</span></span><br></pre></td></tr></table></figure><h2 id="6、-窗体贴边-当窗体靠在屏幕上边，并且鼠标离开窗体时，窗体贴边，当鼠标进入窗体时，窗体全部展示"><a href="#6、-窗体贴边-当窗体靠在屏幕上边，并且鼠标离开窗体时，窗体贴边，当鼠标进入窗体时，窗体全部展示" class="headerlink" title="6、 窗体贴边(当窗体靠在屏幕上边，并且鼠标离开窗体时，窗体贴边，当鼠标进入窗体时，窗体全部展示)"></a>6、 窗体贴边(当窗体靠在屏幕上边，并且鼠标离开窗体时，窗体贴边，当鼠标进入窗体时，窗体全部展示)</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//窗体贴边</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">y</span>()&lt;=<span class="number">0</span>)<span class="comment">//窗体贴在屏幕上边</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">move</span>(<span class="built_in">pos</span>().<span class="built_in">x</span>(),<span class="number">-29</span>);<span class="comment">//贴边</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//窗体弹出</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">y</span>()&lt;=<span class="number">0</span>)<span class="comment">//鼠标进入并且已经贴边</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="built_in">move</span>(<span class="built_in">pos</span>().<span class="built_in">x</span>(),<span class="number">0</span>);<span class="comment">//弹出整个窗体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="五、工程结构"><a href="#五、工程结构" class="headerlink" title="五、工程结构"></a>五、工程结构</h1><p><img src="https://www.freesion.com/images/175/98d5b014d5ca3fdf439ac410f37dab6f.png" alt="img"></p><h1 id="六、源文件"><a href="#六、源文件" class="headerlink" title="六、源文件"></a>六、源文件</h1><p>screen.h文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> SCREEN_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCREEN_H</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPoint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMouseEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QContextMenuEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMenu&gt;</span><span class="comment">//右键菜单</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPaintEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span><span class="comment">//画笔</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPixmap&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFileDialog&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QShowEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QClipboard&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QKeyEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QRect&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Screen</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Screen</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line"> </span><br><span class="line">signals:</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">saveScreenOther</span><span class="params">()</span></span>;<span class="comment">//截图另存为</span></span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">grapFullScreen</span><span class="params">()</span></span>;<span class="comment">//全屏截图</span></span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">copyScreen</span><span class="params">()</span></span>; <span class="comment">//右键复制到粘贴板</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">contextMenuEvent</span><span class="params">(QContextMenuEvent *)</span></span>;  <span class="comment">//--右键菜单事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent *e)</span></span>;       <span class="comment">//--鼠标按下事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent *e)</span></span>;       <span class="comment">//--鼠标移动事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent *e)</span></span>;   <span class="comment">//--鼠标释放（松开）事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;          <span class="comment">//--画图事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;           <span class="comment">//--窗体show事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">keyPressEvent</span><span class="params">(QKeyEvent *e)</span></span>;      <span class="comment">//--按键事件</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPoint beginPos;<span class="comment">//记录鼠标的起始位置</span></span><br><span class="line">    QPoint endPos;<span class="comment">//记录鼠标的结束位置</span></span><br><span class="line">    QMenu *menu; <span class="comment">//右键菜单对象</span></span><br><span class="line">    <span class="type">bool</span> leftPres;<span class="comment">//记录鼠标左键是否按下，按下为true</span></span><br><span class="line">    QRect * rect; <span class="comment">//矩形截图区域</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    QPixmap fullScreen;<span class="comment">//全屏截图</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">QPoint <span class="title">getBeginPos</span><span class="params">()</span></span>;<span class="comment">//获取鼠标的起始位置</span></span><br><span class="line">    <span class="function">QPoint <span class="title">getEndPos</span><span class="params">()</span></span>;<span class="comment">//获取鼠标的结束位置</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setBeginPos</span><span class="params">(QPoint p)</span></span>;<span class="comment">//设置鼠标的起始位置</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setEndPos</span><span class="params">(QPoint p)</span></span>;<span class="comment">//设置鼠标的结束位置</span></span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// SCREEN_H</span></span></span><br></pre></td></tr></table></figure><p>widgets.h文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIDGET_H</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Widget</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_2_clicked</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_4_clicked</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_3_clicked</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enterEvent</span><span class="params">(QEvent *e)</span></span>;  <span class="comment">//--鼠标进入事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">leaveEvent</span><span class="params">(QEvent *e)</span></span>;  <span class="comment">//--鼠标离开事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent *e)</span></span>;       <span class="comment">//--鼠标按下事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent *e)</span></span>;       <span class="comment">//--鼠标移动事件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent *e)</span></span>;   <span class="comment">//--鼠标释放（松开）事件</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">        <span class="type">bool</span> leftPress;</span><br><span class="line">        QPoint beginPos;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// WIDGET_H</span></span></span><br></pre></td></tr></table></figure><p><strong>screen.cpp文件</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;screen.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">Screen::<span class="built_in">Screen</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    beginPos = <span class="built_in">QPoint</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">    endPos = beginPos;</span><br><span class="line">    leftPres = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">setMouseTracking</span>(<span class="literal">true</span>);<span class="comment">//开启鼠标实时追踪，实时的显示鼠标的位置</span></span><br><span class="line">    rect = <span class="keyword">new</span> <span class="built_in">QRect</span>(<span class="number">0</span>,<span class="number">0</span>,QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">width</span>(),QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">height</span>());</span><br><span class="line">    menu = <span class="keyword">new</span> <span class="built_in">QMenu</span>(<span class="keyword">this</span>);<span class="comment">//创建右键菜单</span></span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(<span class="string">&quot;复制(CTRL+C)&quot;</span>, <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">copyScreen</span>()));</span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(<span class="string">&quot;截图另存为(ALT+C)&quot;</span>, <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">saveScreenOther</span>()));</span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(<span class="string">&quot;全屏截图(ALT+A)&quot;</span>, <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">grapFullScreen</span>()));</span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(<span class="string">&quot;退出截图(ESC)&quot;</span>, <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">hide</span>()));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::copyScreen</span><span class="params">()</span> <span class="comment">//右键复制到粘贴板</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   QGuiApplication::<span class="built_in">clipboard</span>()-&gt;<span class="built_in">setPixmap</span>(fullScreen.<span class="built_in">copy</span>(*rect));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::contextMenuEvent</span><span class="params">(QContextMenuEvent *)</span>  <span class="comment">//右键菜单事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setCursor</span>(Qt::ArrowCursor);</span><br><span class="line">    menu-&gt;<span class="built_in">exec</span>(<span class="built_in">cursor</span>().<span class="built_in">pos</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::mousePressEvent</span><span class="params">(QMouseEvent *e)</span>       <span class="comment">//--鼠标按下事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">button</span>() == Qt::LeftButton)<span class="comment">//鼠标左键按下</span></span><br><span class="line">    &#123;</span><br><span class="line">        leftPres = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">setBeginPos</span>(e-&gt;<span class="built_in">pos</span>());<span class="comment">//鼠标相对窗体的位置</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::mouseMoveEvent</span><span class="params">(QMouseEvent *e)</span>    <span class="comment">//--鼠标移动事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(leftPres)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">setEndPos</span>(e-&gt;<span class="built_in">pos</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">update</span>();<span class="comment">//重绘、触发画图事件</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::mouseReleaseEvent</span><span class="params">(QMouseEvent *e)</span> <span class="comment">//--鼠标释放（松开）事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    leftPres = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">setEndPos</span>(e-&gt;<span class="built_in">pos</span>());</span><br><span class="line">    <span class="comment">//使得起始点在左上角，结束点在右下角</span></span><br><span class="line">    <span class="keyword">if</span>(beginPos.<span class="built_in">x</span>()&gt;endPos.<span class="built_in">x</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        beginPos.<span class="built_in">setX</span>(beginPos.<span class="built_in">x</span>() + endPos.<span class="built_in">x</span>());</span><br><span class="line">        endPos.<span class="built_in">setX</span>(beginPos.<span class="built_in">x</span>() - endPos.<span class="built_in">x</span>());</span><br><span class="line">        beginPos.<span class="built_in">setX</span>(beginPos.<span class="built_in">x</span>() - endPos.<span class="built_in">x</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(beginPos.<span class="built_in">y</span>()&gt;endPos.<span class="built_in">y</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        beginPos.<span class="built_in">setY</span>(beginPos.<span class="built_in">y</span>() + endPos.<span class="built_in">y</span>());</span><br><span class="line">        endPos.<span class="built_in">setY</span>(beginPos.<span class="built_in">y</span>() - endPos.<span class="built_in">y</span>());</span><br><span class="line">        beginPos.<span class="built_in">setY</span>(beginPos.<span class="built_in">y</span>() - endPos.<span class="built_in">y</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    rect-&gt;<span class="built_in">setRect</span>(beginPos.<span class="built_in">x</span>(),beginPos.<span class="built_in">y</span>(),endPos.<span class="built_in">x</span>()-beginPos.<span class="built_in">x</span>(),endPos.<span class="built_in">y</span>()-beginPos.<span class="built_in">y</span>());</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function">QPoint <span class="title">Screen::getBeginPos</span><span class="params">()</span><span class="comment">//获取鼠标的起始位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> beginPos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QPoint <span class="title">Screen::getEndPos</span><span class="params">()</span><span class="comment">//获取鼠标的结束位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> endPos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::setBeginPos</span><span class="params">(QPoint p)</span><span class="comment">//设置鼠标的起始位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;beginPos = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Screen::setEndPos</span><span class="params">(QPoint p)</span><span class="comment">//设置鼠标的结束位置</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;endPos = p;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">Screen::paintEvent</span><span class="params">(QPaintEvent *)</span>          <span class="comment">//--画图事件</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>; <span class="comment">//将当前窗体对象设置为画布</span></span><br><span class="line">     QPen pen;</span><br><span class="line">     pen.<span class="built_in">setColor</span>(Qt::red);<span class="comment">//设置笔色</span></span><br><span class="line">     pen.<span class="built_in">setWidth</span>(<span class="number">1</span>);     <span class="comment">//画笔线条宽度</span></span><br><span class="line">     painter.<span class="built_in">setPen</span>(pen);<span class="comment">//设置画笔</span></span><br><span class="line"> </span><br><span class="line">     <span class="type">int</span> lx = beginPos.<span class="built_in">x</span>()&lt;endPos.<span class="built_in">x</span>()?beginPos.<span class="built_in">x</span>():endPos.<span class="built_in">x</span>();<span class="comment">//矩形截图区域左上角x坐标</span></span><br><span class="line">     <span class="type">int</span> ly = beginPos.<span class="built_in">y</span>()&lt;endPos.<span class="built_in">y</span>()?beginPos.<span class="built_in">y</span>():endPos.<span class="built_in">y</span>();<span class="comment">//矩形截图区域右上角x坐标</span></span><br><span class="line">     <span class="type">int</span> w = beginPos.<span class="built_in">x</span>()&lt;endPos.<span class="built_in">x</span>()?endPos.<span class="built_in">x</span>()-beginPos.<span class="built_in">x</span>():beginPos.<span class="built_in">x</span>()-endPos.<span class="built_in">x</span>();<span class="comment">//矩形截图区域宽度</span></span><br><span class="line">     <span class="type">int</span> h = beginPos.<span class="built_in">y</span>()&lt;endPos.<span class="built_in">y</span>()?endPos.<span class="built_in">y</span>()-beginPos.<span class="built_in">y</span>():beginPos.<span class="built_in">y</span>()-endPos.<span class="built_in">y</span>();<span class="comment">//矩形截图区域高度</span></span><br><span class="line"> </span><br><span class="line">     QRect rect = <span class="built_in">QRect</span>(lx,ly,w,h);<span class="comment">//矩形截图区域</span></span><br><span class="line">     <span class="keyword">if</span>(lx!=<span class="number">-1</span> &amp;&amp; w&gt;<span class="number">0</span> &amp;&amp; h&gt;<span class="number">0</span>)<span class="comment">//防止第一次就重绘 并且宽高大于0时才进行截图操作</span></span><br><span class="line">     &#123;</span><br><span class="line"> </span><br><span class="line">         painter.<span class="built_in">drawPixmap</span>(rect,fullScreen,rect);<span class="comment">//重绘截图矩形部分，即恢复原图，达到去除幕布效果</span></span><br><span class="line">         painter.<span class="built_in">drawRect</span>(lx, ly, w, h);<span class="comment">//画截图矩形</span></span><br><span class="line">         <span class="comment">//截图区域大小位置提示</span></span><br><span class="line">         <span class="keyword">if</span>(ly&gt;<span class="number">10</span>)<span class="comment">//避免看不到提示,在截图矩形上边不接近屏幕上边时，提示在截图矩形的上边的上面</span></span><br><span class="line">         &#123;</span><br><span class="line">             painter.<span class="built_in">drawText</span>(lx + <span class="number">2</span>, ly - <span class="number">8</span>, <span class="built_in">tr</span>(<span class="string">&quot;截图范围(%1,%2) - (%3,%4)  截图大小：(%5 x %6)&quot;</span>) .<span class="built_in">arg</span>(lx).<span class="built_in">arg</span>(ly).<span class="built_in">arg</span>(lx + w).<span class="built_in">arg</span>(ly + h).<span class="built_in">arg</span>(w).<span class="built_in">arg</span>(h));</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span><span class="comment">//在截图矩形上边接近屏幕上边时，提示在截图矩形的上边的下面</span></span><br><span class="line">         &#123;</span><br><span class="line">            painter.<span class="built_in">drawText</span>(lx + <span class="number">2</span>, ly + <span class="number">12</span>, <span class="built_in">tr</span>(<span class="string">&quot;截图范围(%1,%2) - (%3,%4)  截图大小：(%5 x %6)&quot;</span>) .<span class="built_in">arg</span>(lx).<span class="built_in">arg</span>(ly).<span class="built_in">arg</span>(lx + w).<span class="built_in">arg</span>(ly + h).<span class="built_in">arg</span>(w).<span class="built_in">arg</span>(h));</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//实时显示鼠标的位置</span></span><br><span class="line">     painter.<span class="built_in">drawText</span>(<span class="built_in">cursor</span>().<span class="built_in">pos</span>().<span class="built_in">x</span>(), <span class="built_in">cursor</span>().<span class="built_in">pos</span>().<span class="built_in">y</span>(), <span class="built_in">tr</span>(<span class="string">&quot;(%1,%2)&quot;</span>) .<span class="built_in">arg</span>(<span class="built_in">cursor</span>().<span class="built_in">pos</span>().<span class="built_in">x</span>()).<span class="built_in">arg</span>(<span class="built_in">cursor</span>().<span class="built_in">pos</span>().<span class="built_in">y</span>()));</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">Screen::showEvent</span><span class="params">(QShowEvent *)</span>           <span class="comment">//--窗体show事件</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">      <span class="comment">//设置透明度实现模糊背景</span></span><br><span class="line">     <span class="built_in">setWindowOpacity</span>(<span class="number">0.7</span>);</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">Screen::saveScreenOther</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     QString fileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="string">&quot;截图另存为&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Image (*.jpg *.png *.bmp)&quot;</span>);</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">if</span> (fileName.<span class="built_in">length</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         fullScreen.<span class="built_in">copy</span>(*rect).<span class="built_in">save</span>(fileName,<span class="string">&quot;bmp&quot;</span>);</span><br><span class="line"> </span><br><span class="line">         <span class="built_in">close</span>();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">Screen::grapFullScreen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     endPos.<span class="built_in">setX</span>(<span class="number">-1</span>);<span class="comment">//此时避免画截图矩形</span></span><br><span class="line">     QString fileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="string">&quot;保存全屏截图&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;JPEG Files (*.jpg)&quot;</span>);</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">if</span> (fileName.<span class="built_in">length</span>() &gt; <span class="number">0</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         fullScreen.<span class="built_in">save</span>(fileName, <span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">         <span class="built_in">close</span>();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">this</span>-&gt;<span class="built_in">hide</span>();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">Screen::keyPressEvent</span><span class="params">(QKeyEvent *e)</span> <span class="comment">//按键事件</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">/// Esc 键退出截图;</span></span><br><span class="line">     <span class="keyword">if</span> (e-&gt;<span class="built_in">key</span>() == Qt::Key_Escape)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="built_in">hide</span>();</span><br><span class="line">     &#125;<span class="comment">///CTRL+C 复制</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(e-&gt;<span class="built_in">key</span>() == Qt::Key_C &amp;&amp; e-&gt;<span class="built_in">modifiers</span>() ==  Qt::ControlModifier)</span><br><span class="line">     &#123;</span><br><span class="line">         QGuiApplication::<span class="built_in">clipboard</span>()-&gt;<span class="built_in">setPixmap</span>(fullScreen.<span class="built_in">copy</span>(*rect));</span><br><span class="line"> </span><br><span class="line">     &#125;<span class="comment">///截图另存为(ALT+C)</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(e-&gt;<span class="built_in">key</span>() == Qt::Key_C &amp;&amp; e-&gt;<span class="built_in">modifiers</span>() ==  Qt::AltModifier)</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="built_in">saveScreenOther</span>();</span><br><span class="line">     &#125;<span class="comment">///全屏截图(ALT+A)</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(e-&gt;<span class="built_in">key</span>() == Qt::Key_A &amp;&amp; e-&gt;<span class="built_in">modifiers</span>() ==  Qt::AltModifier)</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="built_in">grapFullScreen</span>();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">     &#123;</span><br><span class="line">         e-&gt;<span class="built_in">ignore</span>();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>widget.cpp文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFileDialog&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QScreen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPoint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;screen.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QWidget</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    beginPos = <span class="keyword">this</span>-&gt;<span class="built_in">pos</span>();</span><br><span class="line">    leftPress = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;CanMove&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//实现无边框 (Qt::FramelessWindowHint去边框)  Qt::WindowStaysOnTopHint 窗体置顶 防止拖到任务栏下面</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint | Qt::WindowSystemMenuHint | Qt::WindowMinMaxButtonsHint|Qt::WindowStaysOnTopHint);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mousePressEvent</span><span class="params">(QMouseEvent *e)</span>       <span class="comment">//--鼠标按下事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">button</span>() == Qt::LeftButton)<span class="comment">//鼠标左键按下</span></span><br><span class="line">    &#123;</span><br><span class="line">        leftPress = <span class="literal">true</span>;</span><br><span class="line">        beginPos = e-&gt;<span class="built_in">pos</span>();<span class="comment">//鼠标相对窗体的位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseMoveEvent</span><span class="params">(QMouseEvent *e)</span>       <span class="comment">//--鼠标移动事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (leftPress)</span><br><span class="line">    &#123;<span class="comment">//当前鼠标相对窗体的位置-刚按下左键时的相对位置=鼠标移动的大小</span></span><br><span class="line">         <span class="built_in">move</span>(e-&gt;<span class="built_in">pos</span>() - beginPos + <span class="keyword">this</span>-&gt;<span class="built_in">pos</span>());</span><br><span class="line">         <span class="comment">//           鼠标移动的大小+窗体原来的位置=窗体移动后的位置</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseReleaseEvent</span><span class="params">(QMouseEvent *e)</span>   <span class="comment">//--鼠标释放（松开）事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    leftPress = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::enterEvent</span><span class="params">(QEvent *e)</span>  <span class="comment">//--鼠标进入事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">y</span>()&lt;=<span class="number">0</span>)<span class="comment">//鼠标进入并且已经贴边</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">pos</span>().<span class="built_in">x</span>(),<span class="number">0</span>);<span class="comment">//弹出整个窗体</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::leaveEvent</span><span class="params">(QEvent *e)</span>  <span class="comment">//--鼠标离开事件</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">pos</span>().<span class="built_in">y</span>()&lt;=<span class="number">0</span>)<span class="comment">//窗体贴在屏幕上边</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">pos</span>().<span class="built_in">x</span>(),<span class="number">-29</span>);<span class="comment">//贴边</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_2_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//截图之前隐去窗体，不然截图之中就会有窗体的存在</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">windowState</span>() != Qt::WindowMinimized )</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="built_in">setWindowState</span>( Qt::WindowMinimized );<span class="comment">//最小化父窗体</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//延时等待父窗体最小化 延时250毫秒</span></span><br><span class="line">    QTime _Timer = QTime::<span class="built_in">currentTime</span>().<span class="built_in">addMSecs</span>(<span class="number">250</span>);</span><br><span class="line">    <span class="keyword">while</span>( QTime::<span class="built_in">currentTime</span>() &lt; _Timer )</span><br><span class="line">    &#123;</span><br><span class="line">        QCoreApplication::<span class="built_in">processEvents</span>(QEventLoop::AllEvents, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//先获取全屏截图，再拉上幕布</span></span><br><span class="line">    Screen *m = <span class="keyword">new</span> <span class="built_in">Screen</span>();</span><br><span class="line">    m-&gt;fullScreen = QPixmap::<span class="built_in">grabWindow</span>(QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">winId</span>());</span><br><span class="line">    m-&gt;<span class="built_in">showFullScreen</span>();</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="comment">//获取全屏截图</span></span><br><span class="line">      QPixmap p = QPixmap::<span class="built_in">grabWindow</span>(QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">winId</span>());</span><br><span class="line">      <span class="comment">//打开文件对话框</span></span><br><span class="line">      QString fileName = QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>, <span class="string">&quot;文件另存为&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="built_in">tr</span>(<span class="string">&quot;Config Files (*.bmp)&quot;</span>));</span><br><span class="line">      <span class="comment">//保存截图</span></span><br><span class="line">      <span class="keyword">if</span>(fileName.<span class="built_in">length</span>() &gt; <span class="number">0</span> &amp;&amp; p.<span class="built_in">save</span>(fileName,<span class="string">&quot;bmp&quot;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">          QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="string">&quot;提示&quot;</span>, <span class="string">&quot;保存成功!&quot;</span>,QMessageBox::Ok);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_4_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">windowState</span>() != Qt::WindowMinimized )</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="built_in">setWindowState</span>( Qt::WindowMinimized );<span class="comment">//最小化窗体</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_3_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">close</span>();<span class="comment">//关闭窗体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.cpp文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;screen.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    Widget w;</span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line">   <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>七、注意事项</strong></p><p>  ****update()触发***<strong>paintEvent重绘事件，不是直接调用*paintEvent()。</strong></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 截图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 鼠标 hover 操作时弹出文字气泡</title>
      <link href="/Code/Qt/Qt%E6%B0%94%E6%B3%A1/"/>
      <url>/Code/Qt/Qt%E6%B0%94%E6%B3%A1/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><p>需求描述：鼠标 hover 在一个控件上时，展示设置好的气泡信息</p><h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E6%B0%94%E6%B3%A1/2.gif" alt="2022_04_22_15_56_50_238"></p><h1 id="相关说明"><a href="#相关说明" class="headerlink" title="相关说明"></a>相关说明</h1><p>Qt5之前的版本要设置气泡需要通过C++中其他的类库去实现，在Qt5中则已经实现了相关的Qt类。并且除了设置文字气泡之外，还可以通过重写 <code>QToolTip</code> 类实现自己需要的气泡样式。</p><p>从 <a href="http://qt5.digitser.net/5.9/zh-CN/index.html">Qt 5.9.9 </a> 已经支持 <code>QToolTip</code>。基本所有继承于 <code>QWidget</code> 的组件都可以通过 <code>setToolTip()</code>设置气泡信息。以下所展示的Qt基类都可以设置气泡信息。</p><blockquote><ul><li>setToolTip: <a href="http://qt5.digitser.net/5.9/zh-CN/qaction.html#toolTip-prop">QAction </a><a href="http://qt5.digitser.net/5.9/zh-CN/qgraphicsitem.html#setToolTip">QGraphicsItem </a><a href="http://qt5.digitser.net/5.9/zh-CN/qlistwidgetitem.html#setToolTip">QListWidgetItem </a><a href="http://qt5.digitser.net/5.9/zh-CN/qstandarditem.html#setToolTip">QStandardItem </a><a href="http://qt5.digitser.net/5.9/zh-CN/qsystemtrayicon.html#toolTip-prop">QSystemTrayIcon </a><a href="http://qt5.digitser.net/5.9/zh-CN/qtablewidgetitem.html#setToolTip">QTableWidgetItem </a><a href="http://qt5.digitser.net/5.9/zh-CN/qtextcharformat.html#setToolTip">QTextCharFormat </a><a href="http://qt5.digitser.net/5.9/zh-CN/qtreewidgetitem.html#setToolTip">QTreeWidgetItem </a><a href="http://qt5.digitser.net/5.9/zh-CN/qwidget.html#toolTip-prop">QWidget </a><a href="http://qt5.digitser.net/5.9/zh-CN/qwinthumbnailtoolbutton.html#toolTip-prop">QWinThumbnailToolButton</a></li><li>setToolTipDuration: <a href="http://qt5.digitser.net/5.9/zh-CN/qwidget.html#toolTipDuration-prop">QWidget</a></li><li>setToolTipsVisible: <a href="http://qt5.digitser.net/5.9/zh-CN/qmenu.html#toolTipsVisible-prop">QMenu</a></li></ul></blockquote><p>基本上所有继承于 <code>QWidget</code> 的Qt控件类都支持设置气泡，本文以 <code>QLabel</code> 和 <code>QPushButton</code> 为例演示文字气泡功能。</p><h2 id="支持-SetToolTip的控件"><a href="#支持-SetToolTip的控件" class="headerlink" title="支持 SetToolTip的控件"></a>支持 <code>SetToolTip</code>的控件</h2><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%E6%B0%94%E6%B3%A1/1.png" alt="image-20220422160147373"></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>代码很简单，在ui界面拖一个 <code>QLabel</code> 和一个 <code>QPushbutton</code> 即可，信号槽直接在ui界面右击转到槽即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPixmap&gt;</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">QPixmap <span class="title">img</span><span class="params">(<span class="string">&quot;:/Win11.jpg&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setPixmap</span>(img);</span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setScaledContents</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setToolTip</span>(<span class="built_in">QString</span>(<span class="string">&quot;壁纸《Win11.png》&quot;</span>));</span><br><span class="line">    ui-&gt;pushButton-&gt;<span class="built_in">setToolTip</span>(<span class="built_in">QString</span>(<span class="string">&quot;隐藏或显示图片&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ui-&gt;label-&gt;<span class="built_in">isVisible</span>())</span><br><span class="line">        ui-&gt;label-&gt;<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ui-&gt;label-&gt;<span class="built_in">setVisible</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 气泡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 窗口居中显示</title>
      <link href="/Code/Qt/Qt%E7%AA%97%E5%8F%A3%E5%B1%85%E4%B8%AD/"/>
      <url>/Code/Qt/Qt%E7%AA%97%E5%8F%A3%E5%B1%85%E4%B8%AD/</url>
      
        <content type="html"><![CDATA[<p>一、进行界面布局的时候，往往需要将界面显示在整个桌面的中心位置，所以需要进行一下处理</p><p>二、加上头文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopWidget&gt;</span></span></span><br></pre></td></tr></table></figure><p>三、再在构造函数中加上代码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QDesktopWidget *deskdop=QApplication::<span class="built_in">desktop</span>();</span><br><span class="line"><span class="built_in">move</span>((deskdop-&gt;<span class="built_in">width</span>()-<span class="keyword">this</span>-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (deskdop-&gt;<span class="built_in">height</span>()-<span class="keyword">this</span>-&gt;<span class="built_in">height</span>())/<span class="number">2</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 布局 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt图片旋转</title>
      <link href="/Code/Qt/Qt%E5%9B%BE%E7%89%87%E6%97%8B%E8%BD%AC/"/>
      <url>/Code/Qt/Qt%E5%9B%BE%E7%89%87%E6%97%8B%E8%BD%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="Qt-loading-样式-图片旋转"><a href="#Qt-loading-样式-图片旋转" class="headerlink" title="Qt loading 样式 图片旋转"></a>Qt loading 样式 图片旋转</h1><p>图片旋转可以使用paintevent时间，也可以使用过滤器实现。如下为使用过滤器的方式实现图片旋转。</p><ol><li>首先在 UI 中绘制 一个 QLabel 用于承载旋转图片。</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;labelLoadIcon</span><br></pre></td></tr></table></figure><ol start="2"><li>然后给载体安装过滤器事件，保证其可触发的状态</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;labelLoadIcon-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><ol start="3"><li>写过滤器要实现的功能，旋转</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QAuthInit::eventFilter</span><span class="params">(QObject* watched, QEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (watched == ui-&gt;labelLoadIcon &amp;&amp; event-&gt;<span class="built_in">type</span>() == QEvent::Paint &amp;&amp; !<span class="keyword">this</span>-&gt;<span class="built_in">parentWidget</span>()-&gt;<span class="built_in">isHidden</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QImage loading = <span class="built_in">QImage</span>(<span class="string">&quot;:/loading.jpg&quot;</span>);</span><br><span class="line">        <span class="function">QPainter <span class="title">painter_inner</span><span class="params">(ui-&gt;labelLoadIcon)</span></span>;</span><br><span class="line">        painter_inner.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">        painter_inner.<span class="built_in">setBrush</span>(Qt::NoBrush);</span><br><span class="line">        painter_inner.<span class="built_in">setRenderHint</span>(QPainter::SmoothPixmapTransform);</span><br><span class="line">        painter_inner.<span class="built_in">translate</span>(loading.<span class="built_in">width</span>() / <span class="built_in">qreal</span>(<span class="number">2</span>) + <span class="number">0</span>, loading.<span class="built_in">height</span>() / <span class="built_in">qreal</span>(<span class="number">2</span>) + <span class="number">0</span>); <span class="comment">//设置旋转中心</span></span><br><span class="line">        painter_inner.<span class="built_in">rotate</span>(-m_nAngle_ring);          <span class="comment">//旋转</span></span><br><span class="line">        painter_inner.<span class="built_in">translate</span>(-(loading.<span class="built_in">width</span>() / <span class="built_in">qreal</span>(<span class="number">2</span>) + <span class="number">0</span>), -(loading.<span class="built_in">height</span>() / <span class="built_in">qreal</span>(<span class="number">2</span>) + <span class="number">0</span>)); <span class="comment">//将原点复位</span></span><br><span class="line">        painter_inner.<span class="built_in">drawImage</span>(<span class="built_in">QPointF</span>(<span class="number">0</span>, <span class="number">0</span>), loading);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 事件仍然抛给QT</span></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(watched, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>定时调用，使过滤器中旋转的角度变化，从而达到旋转的效果</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QTimer* timerLoading = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">timerLoading-&gt;<span class="built_in">setInterval</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">connect</span>(timerLoading, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;LoadingWidget::onTimeOut); <span class="comment">// 在槽函数中修改 m_nAngle_ring 的值</span></span><br><span class="line"></span><br><span class="line">timerLoading-&gt;<span class="built_in">start</span>();</span><br></pre></td></tr></table></figure><ol start="5"><li>定时器槽函数</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">LoadingWidget::onTimeOut</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;<span class="built_in">parentWidget</span>()-&gt;<span class="built_in">isHidden</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//每次间隔转2度,也就是说转一圈需要180次</span></span><br><span class="line">        <span class="keyword">if</span> (m_nAngle_ring == <span class="number">360</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            m_nAngle_ring = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        m_nAngle_ring += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        ui-&gt;labelLoadIcon-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 旋转 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt常用基础代码汇总</title>
      <link href="/Code/Qt/Qt%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Qt%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81%E6%B1%87%E6%80%BB/"/>
      <url>/Code/Qt/Qt%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Qt%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="1、show-与-exec"><a href="#1、show-与-exec" class="headerlink" title="1、show() 与 exec()"></a>1、show() 与 exec()</h1><p><code>show</code>显示的是非模态对话框；<code>exec</code>显示的是模态对话框。</p><h1 id="2、设置无边框窗口"><a href="#2、设置无边框窗口" class="headerlink" title="2、设置无边框窗口"></a>2、设置无边框窗口</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint);      <span class="comment">//设置为无边框窗口</span></span><br></pre></td></tr></table></figure><h1 id="3、设置窗体透明"><a href="#3、设置窗体透明" class="headerlink" title="3、设置窗体透明"></a>3、设置窗体透明</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground);   <span class="comment">//设置窗体透明</span></span><br></pre></td></tr></table></figure><h1 id="4、Qt字符串转换"><a href="#4、Qt字符串转换" class="headerlink" title="4、Qt字符串转换"></a>4、Qt字符串转换</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QStringToTCHAR(x)     (wchar_t*) x.utf16()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PQStringToTCHAR(x)    (wchar_t*) x-&gt;utf16()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCHARToQString(x)     QString::fromUtf16((x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCHARToQStringN(x,y)  QString::fromUtf16((x),(y))</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QStringToTCHAR(x)     x.local8Bit().constData()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PQStringToTCHAR(x)    x-&gt;local8Bit().constData()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCHARToQString(x)     QString::fromLocal8Bit((x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCHARToQStringN(x,y)  QString::fromLocal8Bit((x),(y))</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h1 id="5、Qss读取"><a href="#5、Qss读取" class="headerlink" title="5、Qss读取"></a>5、Qss读取</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::InitStyle</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_LCD_Hour-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot; font: 18px black;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(i != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">QFile <span class="title">file</span><span class="params">(QString(<span class="string">&quot;:/Assert/qss/style%1.qss&quot;</span>).arg(i))</span></span>;</span><br><span class="line">        file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">setStyleSheet</span>(file.<span class="built_in">readAll</span>());</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// m_LCD_Min-&gt;setStyleSheet(&quot;color: black; &quot;);</span></span><br><span class="line">    <span class="comment">// m_LCD_Sec-&gt;setStyleSheet(&quot;color: black; &quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(QString(<span class="string">&quot;:/Assert/qss/main.qss&quot;</span>))</span></span>;</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setStyleSheet</span>(file.<span class="built_in">readAll</span>());</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6、QWidget自动列宽"><a href="#6、QWidget自动列宽" class="headerlink" title="6、QWidget自动列宽"></a>6、QWidget自动列宽</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TreeWidget 自动列宽 add by mingming.shi 2021-10-23</span></span><br><span class="line">ui.treeWidget-&gt;<span class="built_in">header</span>()-&gt;<span class="built_in">setSectionResizeMode</span>(QHeaderView::ResizeToContents);</span><br></pre></td></tr></table></figure><h1 id="7、Qss写法参考"><a href="#7、Qss写法参考" class="headerlink" title="7、Qss写法参考"></a>7、Qss写法参考</h1><p><a href="https://blog.csdn.net/Fuel_Ming/article/details/120740512">QSS单独设置某控件样式</a></p><h1 id="8、Qt正则表达式"><a href="#8、Qt正则表达式" class="headerlink" title="8、Qt正则表达式"></a>8、Qt正则表达式</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QRegExp <span class="title">rx</span><span class="params">(<span class="string">&quot;\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b&quot;</span>)</span></span>;  <span class="comment">//IP的正则表达式</span></span><br><span class="line"><span class="keyword">if</span>(!rx.<span class="built_in">exactMatch</span>(m_lineEdit-&gt;<span class="built_in">text</span>()))</span><br><span class="line">&#123;</span><br><span class="line">    QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Error&quot;</span>),</span><br><span class="line">                          <span class="built_in">tr</span>(<span class="string">&quot;IP WRONG.\n&quot;</span></span><br><span class="line">                             <span class="string">&quot;Please Make Sure Input Correct IP!&quot;</span>),</span><br><span class="line">                          QMessageBox::Ok);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(m_lineEdit-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>() &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;Info&quot;</span>),</span><br><span class="line">                          <span class="built_in">tr</span>(<span class="string">&quot;IP Correct.\n&quot;</span></span><br><span class="line">                             <span class="string">&quot;Input Correct IP is Saved!&quot;</span>),</span><br><span class="line">                          QMessageBox::Ok);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="9、字体相关"><a href="#9、字体相关" class="headerlink" title="9、字体相关"></a>9、字体相关</h1><ul><li>查询系统支持的字体</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QFontDatabase database;</span><br><span class="line">foreach (<span class="type">const</span> QString &amp;family, database.<span class="built_in">families</span>()) &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;family;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>设置全局字体<br>font内容为family查询到的字体名称<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;family&quot;</span>)</span></span>;</span><br><span class="line">QApplication::<span class="built_in">setFont</span>(font);</span><br></pre></td></tr></table></figure></li><li>外部加载字体<ul><li>字体支持ttc或ttf格式加载；</li><li>使用addApplicationFont可以为系统路径，也可以资源文件。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fontId = QFontDatabase::<span class="built_in">addApplicationFont</span>(<span class="string">&quot;font.ttc&quot;</span>);</span><br><span class="line">QStringList fontIDs = QFontDatabase::<span class="built_in">applicationFontFamilies</span>(fontId);</span><br><span class="line"><span class="keyword">if</span> (! fontIDs.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(fontIDs.first())</span></span>;</span><br><span class="line">    QApplication::<span class="built_in">setFont</span>(font);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Failed to load font.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="10-Qt锁"><a href="#10-Qt锁" class="headerlink" title="10. Qt锁"></a>10. Qt锁</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">QMutex mutex;</span><br><span class="line"><span class="type">int</span> number = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">method1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mutex.<span class="built_in">lock</span>();</span><br><span class="line">    number *= <span class="number">5</span>;</span><br><span class="line">    number /= <span class="number">4</span>;</span><br><span class="line">    mutex.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">method2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mutex.<span class="built_in">lock</span>();</span><br><span class="line">    number *= <span class="number">3</span>;</span><br><span class="line">    number /= <span class="number">2</span>;</span><br><span class="line">    mutex.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="11、-计时器-定时器"><a href="#11、-计时器-定时器" class="headerlink" title="11、 计时器 定时器"></a>11、 计时器 定时器</h1><h2 id="计时器"><a href="#计时器" class="headerlink" title="计时器"></a>计时器</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QTimer *timer = <span class="keyword">new</span> QTimer;</span><br><span class="line"><span class="built_in">connect</span>(timer, <span class="built_in">SIGNAL</span>(<span class="built_in">timeout</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">slotTimeOut</span>()));</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, [=]()<span class="keyword">mutable</span>&#123;</span><br><span class="line">   <span class="built_in">slotTimeOut</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">timer-&gt;<span class="built_in">start</span>(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="单次定时器"><a href="#单次定时器" class="headerlink" title="单次定时器"></a>单次定时器</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3秒后 启用下载按钮</span></span><br><span class="line">QTimer::<span class="built_in">singleShot</span>(<span class="number">3</span> * <span class="number">1000</span>, <span class="keyword">this</span>, [=]() &#123;</span><br><span class="line">ui-&gt;pushBtnUpgrade-&gt;<span class="built_in">setDisabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="12、乱码问题"><a href="#12、乱码问题" class="headerlink" title="12、乱码问题"></a>12、乱码问题</h1><p>在头文件添加以下代码即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1600)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h1 id="13、-QTextBrower-设置字体颜色"><a href="#13、-QTextBrower-设置字体颜色" class="headerlink" title="13、 QTextBrower 设置字体颜色"></a>13、 QTextBrower 设置字体颜色</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> TEXT_COLOR_RED(STRING)         <span class="string">&quot;&lt;font color=red&gt;&quot;</span> + STRING + <span class="string">&quot;&lt;/font&gt;&quot;</span> <span class="string">&quot;&lt;font color=black&gt; &lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEXT_COLOR_BLUE(STRING)        <span class="string">&quot;&lt;font color=blue&gt;&quot;</span> + STRING + <span class="string">&quot;&lt;/font&gt;&quot;</span> <span class="string">&quot;&lt;font color=black&gt; &lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEXT_COLOR_GREEN(STRING)        <span class="string">&quot;&lt;font color=green&gt;&quot;</span> + STRING + <span class="string">&quot;&lt;/font&gt;&quot;</span> <span class="string">&quot;&lt;font color=black&gt; &lt;/font&gt;&quot;</span></span></span><br><span class="line"></span><br><span class="line">ui-&gt;textBrowser-&gt;<span class="built_in">setText</span>(<span class="built_in">TEXT_COLOR_BLUE</span>(content));</span><br></pre></td></tr></table></figure><h1 id="14-Qt-http下载网络中断问题"><a href="#14-Qt-http下载网络中断问题" class="headerlink" title="14 Qt http下载网络中断问题"></a>14 Qt http下载网络中断问题</h1><blockquote><p>使用 <code>QNetworkAccessManager</code> 下载文件时，网络中断返回的异常吗仍然是200，需要判断 <code>slotFinished</code> 函数中需要判断 <code>error</code> 的状态来判断下载是否正常</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QHttpDownloadObject::Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QNetworkAccessManager *m_pManager = <span class="keyword">new</span> <span class="built_in">QNetworkAccessManager</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_pOnlinemanager = <span class="keyword">new</span> <span class="built_in">QNetworkConfigurationManager</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (&quot;ftp&quot;, &quot;file&quot;, &quot;qrc&quot;, &quot;http&quot;, &quot;https&quot;, &quot;data&quot;)</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; m_pManager-&gt;<span class="built_in">supportedSchemes</span>();</span><br><span class="line">    m_pManager-&gt;<span class="built_in">setNetworkAccessible</span>(QNetworkAccessManager::Accessible);</span><br><span class="line"></span><br><span class="line">    QNetworkConfigurationManager manager;</span><br><span class="line">    m_pManager-&gt;<span class="built_in">setConfiguration</span>(manager.<span class="built_in">defaultConfiguration</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">connect</span>(m_pManager, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>(QNetworkReply*)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">slotRequestFinished</span>(QNetworkReply*)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QHttpDownloadObject::PerformRequest</span><span class="params">(QString strUrl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QNetworkRequest request;</span><br><span class="line"></span><br><span class="line">    request.<span class="built_in">setUrl</span>(<span class="built_in">QUrl</span>(strUrl));</span><br><span class="line"></span><br><span class="line">    request.<span class="built_in">setHeader</span>(QNetworkRequest::ContentTypeHeader, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    m_fileTmp.<span class="built_in">setFileName</span>(m_DestFilePath);</span><br><span class="line">    m_fileTmp.<span class="built_in">open</span>(QIODevice::Append);</span><br><span class="line"></span><br><span class="line">    m_pReply = m_pManager-&gt;<span class="built_in">get</span>(request);   <span class="comment">// get 方式</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(m_pReply, &amp;QNetworkReply::readyRead,        <span class="keyword">this</span>, &amp;QHttpDownloadObject::onReadyRead);</span><br><span class="line">    <span class="built_in">connect</span>(m_pReply, &amp;QNetworkReply::downloadProgress, <span class="keyword">this</span>, &amp;QHttpDownloadObject::downloadProgress);</span><br><span class="line">    <span class="comment">// 使用当前接口判断下载时否异常</span></span><br><span class="line"><span class="built_in">connect</span>(m_pReply, <span class="built_in">static_cast</span>&lt;<span class="built_in">void</span>(QNetworkReply::*)(QNetworkReply::NetworkError)&gt;(&amp;QNetworkReply::error), <span class="keyword">this</span>, &amp;QHttpDownloadObject::onError);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QHttpDownloadObject::slotRequestFinished</span><span class="params">(QNetworkReply *reply)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">disconnect</span>(m_pReply, <span class="built_in">SIGNAL</span>(<span class="built_in">downloadProgress</span>(qint64, qint64)), <span class="keyword">this</span>, <span class="built_in">SIGNAL</span>(<span class="built_in">downloadProgress</span>(qint64, qint64)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_fileTmp.<span class="built_in">isOpen</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        m_fileTmp.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取响应的信息，状态码为200表示正常</span></span><br><span class="line">QVariant statusCode = reply-&gt;<span class="built_in">attribute</span>(QNetworkRequest::HttpStatusCodeAttribute);</span><br><span class="line">    QString strError = reply-&gt;<span class="built_in">errorString</span>();</span><br><span class="line">    QNetworkReply::NetworkError error = reply-&gt;<span class="built_in">error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;+++++++++&quot;</span> &lt;&lt; statusCode &lt;&lt; strError &lt;&lt; error; <span class="comment">// QVariant(int, 200) &quot;Connection closed&quot; QNetworkReply::NetworkError(RemoteHostClosedError)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (statusCode.<span class="built_in">toInt</span>() &gt;= <span class="number">400</span> || error != QNetworkReply::NoError) </span><br><span class="line">    &#123;</span><br><span class="line"><span class="built_in">QLOG_INFO</span>() &lt;&lt; <span class="string">&quot;无法下载文件，错误状态码:&quot;</span> &lt;&lt; statusCode &lt;&lt; <span class="string">&quot;错误信息:&quot;</span> &lt;&lt; strError &lt;&lt; error;</span><br><span class="line"><span class="function">emit <span class="title">sigDownloadFinished</span><span class="params">(DOWNLOAD_CODE_NETBAD, QString(ERRORTITLE_APPACCESS_NETFAULT).arg(strError))</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        emit <span class="built_in">sigDownloadFinished</span>(statusCode.<span class="built_in">toInt</span>(), strError);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    reply-&gt;<span class="built_in">close</span>();</span><br><span class="line">    reply-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    m_pManager-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    m_pOnlinemanager-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="15-管理员运行程序"><a href="#15-管理员运行程序" class="headerlink" title="15 管理员运行程序"></a>15 管理员运行程序</h1><ol><li>管理员运行程序，限定在MSVC编译器，在项目pro文件中增加如下代码。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QMAKE_LFLAGS += /MANIFESTUAC:<span class="string">&quot;level=&#x27;requireAdministrator&#x27; uiAccess=&#x27;false&#x27;&quot;</span> <span class="comment">#以管理员运行</span></span><br><span class="line">QMAKE_LFLAGS += /SUBSYSTEM:WINDOWS,<span class="string">&quot;5.01&quot;</span> <span class="comment">#VS2013 在XP运行</span></span><br></pre></td></tr></table></figure><h1 id="16-QLabel-点击事件"><a href="#16-QLabel-点击事件" class="headerlink" title="16 QLabel 点击事件"></a>16 QLabel 点击事件</h1><p>重写 <code>QLabel</code> 事件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QCycleProgress::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">emit <span class="title">clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">QLabel::<span class="built_in">mousePressEvent</span>(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="17-程序防重入"><a href="#17-程序防重入" class="headerlink" title="17 程序防重入"></a>17 程序防重入</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qrcode.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSharedMemory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">     <span class="comment">//创建运行时只允许存在一个程序</span></span><br><span class="line">    <span class="type">static</span> QSharedMemory *shareMem = <span class="keyword">new</span> <span class="built_in">QSharedMemory</span>(<span class="string">&quot;SingleAPP&quot;</span>);</span><br><span class="line">    <span class="comment">//判断如果存在存直接退出</span></span><br><span class="line">    <span class="keyword">if</span>(!shareMem-&gt;<span class="built_in">create</span>(<span class="number">1</span>))&#123;</span><br><span class="line">        qApp-&gt;<span class="built_in">quit</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="type">int</span> result = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (result !=<span class="number">0</span>) &#123;</span><br><span class="line">            Create_qrcode w;</span><br><span class="line">            w.<span class="built_in">setWindowIcon</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:/images/main_logo.ico&quot;</span>));</span><br><span class="line">            w.<span class="built_in">show</span>();</span><br><span class="line">            result= a.<span class="built_in">exec</span>();  <span class="comment">//!退出时如果为零，正常退出，否则重启程序</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="18-弹窗显示在屏幕中间"><a href="#18-弹窗显示在屏幕中间" class="headerlink" title="18 弹窗显示在屏幕中间"></a>18 弹窗显示在屏幕中间</h1><p>使用</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTrayTooltipForm::show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">placeTip</span>(QCursor::<span class="built_in">pos</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UpdateStatus</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTrayTooltipForm::placeTip</span><span class="params">(<span class="type">const</span> QPoint&amp; pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">QRect screen = QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">screenGeometry</span>(QApplication::<span class="built_in">desktop</span>()-&gt;<span class="built_in">screenNumber</span>(pos));</span><br><span class="line"></span><br><span class="line">QPoint p = pos;</span><br><span class="line">p += <span class="built_in">QPoint</span>(<span class="number">2</span>,<span class="number">16</span>);</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">x</span>() + <span class="keyword">this</span>-&gt;<span class="built_in">width</span>() &gt; screen.<span class="built_in">x</span>() + screen.<span class="built_in">width</span>())</span><br><span class="line">p.<span class="built_in">rx</span>() -= <span class="number">4</span> + <span class="keyword">this</span>-&gt;<span class="built_in">width</span>();</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">y</span>() + <span class="keyword">this</span>-&gt;<span class="built_in">height</span>() &gt; screen.<span class="built_in">y</span>() + screen.<span class="built_in">height</span>())</span><br><span class="line">p.<span class="built_in">ry</span>() -= <span class="number">24</span> + <span class="keyword">this</span>-&gt;<span class="built_in">height</span>();</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">y</span>() &lt; screen.<span class="built_in">y</span>())</span><br><span class="line">p.<span class="built_in">setY</span>(screen.<span class="built_in">y</span>());</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">x</span>() + <span class="keyword">this</span>-&gt;<span class="built_in">width</span>() &gt; screen.<span class="built_in">x</span>() + screen.<span class="built_in">width</span>())</span><br><span class="line">p.<span class="built_in">setX</span>(screen.<span class="built_in">x</span>() + screen.<span class="built_in">width</span>() - <span class="keyword">this</span>-&gt;<span class="built_in">width</span>());</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">x</span>() &lt; screen.<span class="built_in">x</span>())</span><br><span class="line">p.<span class="built_in">setX</span>(screen.<span class="built_in">x</span>());</span><br><span class="line"><span class="keyword">if</span> (p.<span class="built_in">y</span>() + <span class="keyword">this</span>-&gt;<span class="built_in">height</span>() &gt; screen.<span class="built_in">y</span>() + screen.<span class="built_in">height</span>())</span><br><span class="line">p.<span class="built_in">setY</span>(screen.<span class="built_in">y</span>() + screen.<span class="built_in">height</span>() - <span class="keyword">this</span>-&gt;<span class="built_in">height</span>());</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">move</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> Qt开发经验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手册 </tag>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/Qt/Qt%20%E8%8E%B7%E5%8F%96cmd%E8%BE%93%E5%87%BA%20/"/>
      <url>/Code/Qt/Qt%20%E8%8E%B7%E5%8F%96cmd%E8%BE%93%E5%87%BA%20/</url>
      
        <content type="html"><![CDATA[<p>Qt 使用 <code>QProcess</code> 执行命令行脚本，并通过 <code>readAllStandardOutput</code> 获取其输出。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QProcess&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个QProcess对象</span></span><br><span class="line">    QProcess cmdProcess;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置要执行的命令</span></span><br><span class="line">    QString command = <span class="string">&quot;your_cmd_command&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动命令并等待它完成</span></span><br><span class="line">    cmdProcess.<span class="built_in">start</span>(command);</span><br><span class="line">    cmdProcess.<span class="built_in">waitForFinished</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取命令输出</span></span><br><span class="line">    QByteArray output = cmdProcess.<span class="built_in">readAllStandardOutput</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将输出转换为字符串并输出</span></span><br><span class="line">    QString outputStr = QString::<span class="built_in">fromLocal8Bit</span>(output);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; outputStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> cmd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt事件过滤器（eventFilter）</title>
      <link href="/Code/Qt/Qt%20%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
      <url>/Code/Qt/Qt%20%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="事件过滤器"><a href="#事件过滤器" class="headerlink" title="事件过滤器"></a>事件过滤器</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QObject::installEventFilter</span><span class="params">(QObject *filterObj)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span></span>;</span><br></pre></td></tr></table></figure><p>Qt的事件过滤由以上两个方法实现，首先安装一个事件过滤器，然后重写 <code>bool eventFilter(QObject *obj, QEvent *event)</code>。</p><p><code>filterObj</code>表示事件筛选器对象，它接收发送到此<code>QObject</code>对象的所有事件。筛选器可以停止事件，也可以将事件转发给此<code>QObject</code>对象。事件过滤器<code>filterObj</code>通过它的<code>eventFilter()</code>函数接收事件。</p><h2 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h2><blockquote><p>当鼠标进入 <code>lineEdit</code> 的时候并且操作时 <code>HoverEnter</code> 的时候，则修改 <code>QLabel</code> 的颜色。</p></blockquote><ol><li>安装事件过滤器</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;lineEdit-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>重写 <code>eventFilter()</code></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Widget::eventFilter</span><span class="params">(QObject *wcg, QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (wcg == ui-&gt;lineEdit)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::HoverEnter)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label_2-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;进入&quot;</span>));</span><br><span class="line">            ui-&gt;label_2-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QLabel&#123;color:red;&#125;&quot;</span>);</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;进入&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::HoverLeave)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label_2-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;离开&quot;</span>));</span><br><span class="line">            ui-&gt;label_2-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;QLabel&#123;color:green;&#125;&quot;</span>);</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;离开&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(wcg,event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随机字符串</title>
      <link href="/Code/Qt/Qt%20%E9%9A%8F%E6%9C%BA%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/Code/Qt/Qt%20%E9%9A%8F%E6%9C%BA%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Qt生成自定义字符串</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">qsrand</span>(QDateTime::<span class="built_in">currentMSecsSinceEpoch</span>());</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> ch[] = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="type">int</span> size = <span class="built_in">sizeof</span>(ch);</span><br><span class="line"><span class="type">char</span>* str = <span class="keyword">new</span> <span class="type">char</span>[nLen + <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> nIndex = <span class="number">0</span>; nIndex &lt; nLen; ++nIndex)</span><br><span class="line">&#123;</span><br><span class="line">num = <span class="built_in">rand</span>() % (size - <span class="number">1</span>);</span><br><span class="line">str[nIndex] = ch[num];</span><br><span class="line">&#125;</span><br><span class="line">str[nLen] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">res</span><span class="params">(str)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">QLOG_INFO</span>() &lt;&lt; __FUNCTION__ &lt;&lt; __LINE__ &lt;&lt; res;</span><br><span class="line"></span><br><span class="line">   m_RandomCode = res;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 字符串 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt Http 下载（转载）</title>
      <link href="/Code/Qt/QtHttp%E4%B8%8B%E8%BD%BD/"/>
      <url>/Code/Qt/QtHttp%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="QT之HTTP请求下载"><a href="#QT之HTTP请求下载" class="headerlink" title="QT之HTTP请求下载"></a>QT之HTTP请求下载</h2><p>标签： <a href="https://www.freesion.com/tag/Qt/">Qt</a> <a href="https://www.freesion.com/tag/HTTP/">HTTP</a></p><h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>最近在研究了一下用Qt 的方法来实现<strong>http下载</strong>，Qt 中的<strong>Http请求</strong>主要用到了<strong>QNetworkAccessManager</strong>、<strong>QNetworkReply</strong>、<strong>QNetworkRequest</strong> 这三块。本篇文章主要叙述如何用Qt 的方法进行HTTP 请求下载文件，能够支持****断点续传****（断点续传即能够手动停止下载，下次可以从已经下载的部分开始继续下载未完成的部分，而没有必要从头开始上传下载），并且实时更新下载信息。整体代码考虑十分周到，对各种情况也做了相应的处理，并且有通俗易懂的注释。好了，代码走起！</p><h1 id="代码之路"><a href="#代码之路" class="headerlink" title="代码之路"></a>代码之路</h1><p>在讲解代码之前先看一下效果图：</p><h3 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h3><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/QtHttp%E4%B8%8B%E8%BD%BD/QtHttpDownload.gif" alt="效果"></p><p>从图中可以看出点击start按钮，进行下载，stop按钮暂停当前下载，close按钮停止当前下载，并删除已经下载的临时文件，并将所有参数重置， 这里界面中下载链接输入框为空是因为我在代码中默认了url，也可以在输入框中输入url进行下载。</p><hr><p>代码主要包含两个部分：</p><blockquote><p>1、DownLoadManager ： 用来请求下载，向界面传递下载信息，并将下载的内容保存到文件中</p><p>2、MyHttpDownload ： 用来接收下载链接，利用DownLoadManager进行下载，更新界面，并对当前下载进行操作（包括：开始、暂停、停止下载）。</p></blockquote><h2 id="1、DOWNLOADMANAGER"><a href="#1、DOWNLOADMANAGER" class="headerlink" title="1、DOWNLOADMANAGER"></a>1、DOWNLOADMANAGER</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;downloadmanager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QFileInfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDir&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DOWNLOAD_FILE_SUFFIX    <span class="string">&quot;_tmp&quot;</span></span></span><br><span class="line"> </span><br><span class="line">DownLoadManager::<span class="built_in">DownLoadManager</span>(QObject *parent)</span><br><span class="line">    : <span class="built_in">QObject</span>(parent)</span><br><span class="line">    , <span class="built_in">m_networkManager</span>(<span class="literal">NULL</span>)</span><br><span class="line">    , <span class="built_in">m_url</span>(<span class="built_in">QUrl</span>(<span class="string">&quot;&quot;</span>))</span><br><span class="line">    , <span class="built_in">m_fileName</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    , <span class="built_in">m_isSupportBreakPoint</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">m_bytesReceived</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_bytesTotal</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_bytesCurrentReceived</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_isStop</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    m_networkManager = <span class="keyword">new</span> <span class="built_in">QNetworkAccessManager</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">DownLoadManager::~<span class="built_in">DownLoadManager</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置是否支持断点续传;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::setDownInto</span><span class="params">(<span class="type">bool</span> isSupportBreakPoint)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_isSupportBreakPoint = isSupportBreakPoint;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取当前下载链接;</span></span><br><span class="line"><span class="function">QString <span class="title">DownLoadManager::getDownloadUrl</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_url.<span class="built_in">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 开始下载文件，传入下载链接和文件的路径;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::downloadFile</span><span class="params">(QString url , QString fileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 防止多次点击开始下载按钮，进行多次下载，只有在停止标志变量为true时才进行下载;</span></span><br><span class="line">    <span class="keyword">if</span> (m_isStop)</span><br><span class="line">    &#123;</span><br><span class="line">        m_isStop = <span class="literal">false</span>;</span><br><span class="line">        m_url = <span class="built_in">QUrl</span>(url);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 这里可用从url中获取文件名，但不是对所有的url都有效;</span></span><br><span class="line"><span class="comment">//      QString fileName = m_url.fileName();</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 将当前文件名设置为临时文件名，下载完成时修改回来;</span></span><br><span class="line">        m_fileName = fileName + DOWNLOAD_FILE_SUFFIX;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 如果当前下载的字节数为0那么说明未下载过或者重新下载</span></span><br><span class="line">        <span class="comment">// 则需要检测本地是否存在之前下载的临时文件，如果有则删除</span></span><br><span class="line">        <span class="keyword">if</span> (m_bytesCurrentReceived &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">removeFile</span>(m_fileName);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        QNetworkRequest request;</span><br><span class="line">        request.<span class="built_in">setUrl</span>(m_url);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 如果支持断点续传，则设置请求头信息</span></span><br><span class="line">        <span class="keyword">if</span> (m_isSupportBreakPoint)</span><br><span class="line">        &#123;</span><br><span class="line">            QString strRange = <span class="built_in">QString</span>(<span class="string">&quot;bytes=%1-&quot;</span>).<span class="built_in">arg</span>(m_bytesCurrentReceived);</span><br><span class="line">            request.<span class="built_in">setRawHeader</span>(<span class="string">&quot;Range&quot;</span>, strRange.<span class="built_in">toLatin1</span>());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 请求下载;</span></span><br><span class="line">        m_reply = m_networkManager-&gt;<span class="built_in">get</span>(request);</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">connect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">downloadProgress</span>(qint64, qint64)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onDownloadProgress</span>(qint64, qint64)));</span><br><span class="line">        <span class="built_in">connect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">readyRead</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onReadyRead</span>()));</span><br><span class="line">        <span class="built_in">connect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onFinished</span>()));</span><br><span class="line">        <span class="built_in">connect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">error</span>(QNetworkReply::NetworkError)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onError</span>(QNetworkReply::NetworkError)));</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 下载进度信息;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::onDownloadProgress</span><span class="params">(qint64 bytesReceived, qint64 bytesTotal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!m_isStop)</span><br><span class="line">    &#123;</span><br><span class="line">        m_bytesReceived = bytesReceived;</span><br><span class="line">        m_bytesTotal = bytesTotal;</span><br><span class="line">        <span class="comment">// 更新下载进度;(加上 m_bytesCurrentReceived 是为了断点续传时之前下载的字节)</span></span><br><span class="line">        <span class="function">emit <span class="title">signalDownloadProcess</span><span class="params">(m_bytesReceived + m_bytesCurrentReceived, m_bytesTotal + m_bytesCurrentReceived)</span></span>;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取下载内容，保存到文件中;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::onReadyRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!m_isStop)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">QFile <span class="title">file</span><span class="params">(m_fileName)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="built_in">open</span>(QIODevice::WriteOnly | QIODevice::Append))</span><br><span class="line">        &#123;</span><br><span class="line">            file.<span class="built_in">write</span>(m_reply-&gt;<span class="built_in">readAll</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 下载完成;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::onFinished</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_isStop = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// http请求状态码;</span></span><br><span class="line">    QVariant statusCode = m_reply-&gt;<span class="built_in">attribute</span>(QNetworkRequest::HttpStatusCodeAttribute);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (m_reply-&gt;<span class="built_in">error</span>() == QNetworkReply::NoError)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 重命名临时文件;</span></span><br><span class="line">        <span class="function">QFileInfo <span class="title">fileInfo</span><span class="params">(m_fileName)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (fileInfo.<span class="built_in">exists</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> index = m_fileName.<span class="built_in">lastIndexOf</span>(DOWNLOAD_FILE_SUFFIX);</span><br><span class="line">            QString realName = m_fileName.<span class="built_in">left</span>(index);</span><br><span class="line">            QFile::<span class="built_in">rename</span>(m_fileName, realName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 有错误输出错误;</span></span><br><span class="line">        QString strError = m_reply-&gt;<span class="built_in">errorString</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;__________&quot;</span> + strError;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">emit <span class="title">signalReplyFinished</span><span class="params">(statusCode.toInt())</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 下载过程中出现错误，关闭下载，并上报错误，这里未上报错误类型，可自己定义进行上报;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::onError</span><span class="params">(QNetworkReply::NetworkError code)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString strError = m_reply-&gt;<span class="built_in">errorString</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;__________&quot;</span> + strError;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">closeDownload</span>();</span><br><span class="line">    <span class="function">emit <span class="title">signalDownloadError</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 停止下载工作;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::stopWork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_isStop = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (m_reply != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">disconnect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">downloadProgress</span>(qint64, qint64)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onDownloadProgress</span>(qint64, qint64)));</span><br><span class="line">        <span class="built_in">disconnect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">readyRead</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onReadyRead</span>()));</span><br><span class="line">        <span class="built_in">disconnect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onFinished</span>()));</span><br><span class="line">        <span class="built_in">disconnect</span>(m_reply, <span class="built_in">SIGNAL</span>(<span class="built_in">error</span>(QNetworkReply::NetworkError)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onError</span>(QNetworkReply::NetworkError)));</span><br><span class="line">        m_reply-&gt;<span class="built_in">abort</span>();</span><br><span class="line">        m_reply-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        m_reply = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 暂停下载按钮被按下,暂停当前下载;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::stopDownload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 这里m_isStop变量为了保护多次点击暂停下载按钮，导致m_bytesCurrentReceived 被不停累加;</span></span><br><span class="line">    <span class="keyword">if</span> (!m_isStop)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//记录当前已经下载字节数</span></span><br><span class="line">        m_bytesCurrentReceived += m_bytesReceived;</span><br><span class="line">        <span class="built_in">stopWork</span>();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 重置参数;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::reset</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_bytesCurrentReceived = <span class="number">0</span>;</span><br><span class="line">    m_bytesReceived = <span class="number">0</span>;</span><br><span class="line">    m_bytesTotal = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 删除文件;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::removeFile</span><span class="params">(QString fileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 删除已下载的临时文件;</span></span><br><span class="line">    <span class="function">QFileInfo <span class="title">fileInfo</span><span class="params">(fileName)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (fileInfo.<span class="built_in">exists</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QFile::<span class="built_in">remove</span>(fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 停止下载按钮被按下，关闭下载，重置参数，并删除下载的临时文件;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DownLoadManager::closeDownload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">stopWork</span>();</span><br><span class="line">    <span class="built_in">reset</span>();</span><br><span class="line">    <span class="built_in">removeFile</span>(m_fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、MYHTTPDOWNLOAD"><a href="#2、MYHTTPDOWNLOAD" class="headerlink" title="2、MYHTTPDOWNLOAD"></a>2、MYHTTPDOWNLOAD</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myhttpdownload.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;downloadmanager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIT_KB 1024            <span class="comment">//KB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIT_MB 1024*1024       <span class="comment">//MB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIT_GB 1024*1024*1024  <span class="comment">//GB</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIME_INTERVAL 300       <span class="comment">//0.3s</span></span></span><br><span class="line"> </span><br><span class="line">MyHttpDownload::<span class="built_in">MyHttpDownload</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">m_downloadManager</span>(<span class="literal">NULL</span>)</span><br><span class="line">    , <span class="built_in">m_url</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    , <span class="built_in">m_timeInterval</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_currentDownload</span>(<span class="number">0</span>)</span><br><span class="line">    , <span class="built_in">m_intervalDownload</span>(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">initWindow</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">MyHttpDownload::~<span class="built_in">MyHttpDownload</span>()</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::initWindow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.progressBar-&gt;<span class="built_in">setValue</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">connect</span>(ui.pButtonStart, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onStartDownload</span>()));</span><br><span class="line">    <span class="built_in">connect</span>(ui.pButtonStop, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onStopDownload</span>()));</span><br><span class="line">    <span class="built_in">connect</span>(ui.pButtonClose, <span class="built_in">SIGNAL</span>(<span class="built_in">clicked</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onCloseDownload</span>()));</span><br><span class="line">    <span class="comment">// 进度条设置样式;</span></span><br><span class="line">    ui.progressBar-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot;\</span></span><br><span class="line"><span class="string">                QProgressBar\</span></span><br><span class="line"><span class="string">                &#123;\</span></span><br><span class="line"><span class="string">                    border-width: 0 10 0 10;\</span></span><br><span class="line"><span class="string">                    border-left: 1px, gray;\</span></span><br><span class="line"><span class="string">                    border-right: 1px, gray;\</span></span><br><span class="line"><span class="string">                    border-image:url(:/Resources/progressbar_back.png);\</span></span><br><span class="line"><span class="string">                &#125;\</span></span><br><span class="line"><span class="string">                QProgressBar::chunk\</span></span><br><span class="line"><span class="string">                &#123;\</span></span><br><span class="line"><span class="string">                    border-width: 0 10 0 10;\</span></span><br><span class="line"><span class="string">                    border-image:url(:/Resources/progressbar.png);\</span></span><br><span class="line"><span class="string">                &#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 开始下载;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::onStartDownload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 从界面获取下载链接;</span></span><br><span class="line">    m_url = ui.downloadUrl-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="keyword">if</span> (m_downloadManager == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        m_downloadManager = <span class="keyword">new</span> <span class="built_in">DownLoadManager</span>(<span class="keyword">this</span>);</span><br><span class="line">        <span class="built_in">connect</span>(m_downloadManager , <span class="built_in">SIGNAL</span>(<span class="built_in">signalDownloadProcess</span>(qint64, qint64)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onDownloadProcess</span>(qint64, qint64)));</span><br><span class="line">        <span class="built_in">connect</span>(m_downloadManager, <span class="built_in">SIGNAL</span>(<span class="built_in">signalReplyFinished</span>(<span class="type">int</span>)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">onReplyFinished</span>(<span class="type">int</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 这里先获取到m_downloadManager中的url与当前的m_url 对比，如果url变了需要重置参数,防止文件下载不全;</span></span><br><span class="line">    QString url = m_downloadManager-&gt;<span class="built_in">getDownloadUrl</span>();</span><br><span class="line">    <span class="keyword">if</span> (url != m_url)</span><br><span class="line">    &#123;</span><br><span class="line">        m_downloadManager-&gt;<span class="built_in">reset</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    m_downloadManager-&gt;<span class="built_in">setDownInto</span>(<span class="literal">true</span>);</span><br><span class="line">    m_downloadManager-&gt;<span class="built_in">downloadFile</span>(m_url, <span class="string">&quot;F:/MyHttpDownload/MyDownloadFile.zip&quot;</span>);</span><br><span class="line">    m_timeRecord.<span class="built_in">start</span>();</span><br><span class="line">    m_timeInterval = <span class="number">0</span>;</span><br><span class="line">    ui.labelStatus-&gt;<span class="built_in">setText</span>(<span class="built_in">QStringLiteral</span>(<span class="string">&quot;正在下载&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 暂停下载;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::onStopDownload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.labelStatus-&gt;<span class="built_in">setText</span>(<span class="built_in">QStringLiteral</span>(<span class="string">&quot;停止下载&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (m_downloadManager != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        m_downloadManager-&gt;<span class="built_in">stopDownload</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ui.labelSpeed-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0 KB/S&quot;</span>);</span><br><span class="line">    ui.labelRemainTime-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0s&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 关闭下载;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::onCloseDownload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_downloadManager-&gt;<span class="built_in">closeDownload</span>();</span><br><span class="line">    ui.progressBar-&gt;<span class="built_in">setValue</span>(<span class="number">0</span>);</span><br><span class="line">    ui.labelSpeed-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0 KB/S&quot;</span>);</span><br><span class="line">    ui.labelRemainTime-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0s&quot;</span>);</span><br><span class="line">    ui.labelStatus-&gt;<span class="built_in">setText</span>(<span class="built_in">QStringLiteral</span>(<span class="string">&quot;关闭下载&quot;</span>));</span><br><span class="line">    ui.labelCurrentDownload-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0 B&quot;</span>);</span><br><span class="line">    ui.labelFileSize-&gt;<span class="built_in">setText</span>(<span class="string">&quot;0 B&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 更新下载进度;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::onDownloadProcess</span><span class="params">(qint64 bytesReceived, qint64 bytesTotal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 输出当前下载进度;</span></span><br><span class="line">    <span class="comment">// 用到除法需要注意除0错误;</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="built_in">QString</span>(<span class="string">&quot;%1&quot;</span>).<span class="built_in">arg</span>(bytesReceived * <span class="number">100</span> / bytesTotal + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 更新进度条;</span></span><br><span class="line">    ui.progressBar-&gt;<span class="built_in">setMaximum</span>(bytesTotal);</span><br><span class="line">    ui.progressBar-&gt;<span class="built_in">setValue</span>(bytesReceived);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// m_intervalDownload 为下次计算速度之前的下载字节数;</span></span><br><span class="line">    m_intervalDownload += bytesReceived - m_currentDownload;</span><br><span class="line">    m_currentDownload = bytesReceived;</span><br><span class="line"> </span><br><span class="line">    uint timeNow = m_timeRecord.<span class="built_in">elapsed</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 超过0.3s更新计算一次速度;</span></span><br><span class="line">    <span class="keyword">if</span> (timeNow - m_timeInterval &gt; TIME_INTERVAL)</span><br><span class="line">    &#123;</span><br><span class="line">        qint64 ispeed = m_intervalDownload * <span class="number">1000</span> / (timeNow - m_timeInterval);</span><br><span class="line">        QString strSpeed = <span class="built_in">transformUnit</span>(ispeed, <span class="literal">true</span>);</span><br><span class="line">        ui.labelSpeed-&gt;<span class="built_in">setText</span>(strSpeed);</span><br><span class="line">        <span class="comment">// 剩余时间;</span></span><br><span class="line">        qint64 timeRemain = (bytesTotal - bytesReceived) / ispeed;</span><br><span class="line">        ui.labelRemainTime-&gt;<span class="built_in">setText</span>(<span class="built_in">transformTime</span>(timeRemain));</span><br><span class="line"> </span><br><span class="line">        ui.labelCurrentDownload-&gt;<span class="built_in">setText</span>(<span class="built_in">transformUnit</span>(m_currentDownload));</span><br><span class="line">        ui.labelFileSize-&gt;<span class="built_in">setText</span>(<span class="built_in">transformUnit</span>(bytesTotal));</span><br><span class="line"> </span><br><span class="line">        m_intervalDownload = <span class="number">0</span>;</span><br><span class="line">        m_timeInterval = timeNow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 下载完成;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHttpDownload::onReplyFinished</span><span class="params">(<span class="type">int</span> statusCode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 根据状态码判断当前下载是否出错;</span></span><br><span class="line">    <span class="keyword">if</span> (statusCode &gt;= <span class="number">200</span> &amp;&amp; statusCode &lt; <span class="number">400</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Download Failed&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Download Success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 转换单位;</span></span><br><span class="line"><span class="function">QString <span class="title">MyHttpDownload::transformUnit</span><span class="params">(qint64 bytes , <span class="type">bool</span> isSpeed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString strUnit = <span class="string">&quot; B&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (bytes &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        bytes = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt; UNIT_KB)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt; UNIT_MB)</span><br><span class="line">    &#123;</span><br><span class="line">        bytes /= UNIT_KB;</span><br><span class="line">        strUnit = <span class="string">&quot; KB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &lt; UNIT_GB)</span><br><span class="line">    &#123;</span><br><span class="line">        bytes /= UNIT_MB;</span><br><span class="line">        strUnit = <span class="string">&quot; MB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bytes &gt; UNIT_GB)</span><br><span class="line">    &#123;</span><br><span class="line">        bytes /= UNIT_GB;</span><br><span class="line">        strUnit = <span class="string">&quot; GB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (isSpeed)</span><br><span class="line">    &#123;</span><br><span class="line">        strUnit += <span class="string">&quot;/S&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">QString</span>(<span class="string">&quot;%1%2&quot;</span>).<span class="built_in">arg</span>(bytes).<span class="built_in">arg</span>(strUnit);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 转换时间;</span></span><br><span class="line"><span class="function">QString <span class="title">MyHttpDownload::transformTime</span><span class="params">(qint64 seconds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString strValue;</span><br><span class="line">    <span class="function">QString <span class="title">strSpacing</span><span class="params">(<span class="string">&quot; &quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (seconds &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        strValue = <span class="built_in">QString</span>(<span class="string">&quot;%1s&quot;</span>).<span class="built_in">arg</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (seconds &lt; <span class="number">60</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        strValue = <span class="built_in">QString</span>(<span class="string">&quot;%1s&quot;</span>).<span class="built_in">arg</span>(seconds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (seconds &lt; <span class="number">60</span> * <span class="number">60</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> nMinute = seconds / <span class="number">60</span>;</span><br><span class="line">        <span class="type">int</span> nSecond = seconds - nMinute * <span class="number">60</span>;</span><br><span class="line"> </span><br><span class="line">        strValue = <span class="built_in">QString</span>(<span class="string">&quot;%1m&quot;</span>).<span class="built_in">arg</span>(nMinute);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nSecond &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1s&quot;</span>).<span class="built_in">arg</span>(nSecond);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (seconds &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> nHour = seconds / (<span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="type">int</span> nMinute = (seconds - nHour * <span class="number">60</span> * <span class="number">60</span>) / <span class="number">60</span>;</span><br><span class="line">        <span class="type">int</span> nSecond = seconds - nHour * <span class="number">60</span> * <span class="number">60</span> - nMinute * <span class="number">60</span>;</span><br><span class="line"> </span><br><span class="line">        strValue = <span class="built_in">QString</span>(<span class="string">&quot;%1h&quot;</span>).<span class="built_in">arg</span>(nHour);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nMinute &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1m&quot;</span>).<span class="built_in">arg</span>(nMinute);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nSecond &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1s&quot;</span>).<span class="built_in">arg</span>(nSecond);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> nDay = seconds / (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">        <span class="type">int</span> nHour = (seconds - nDay * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>) / (<span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="type">int</span> nMinute = (seconds - nDay * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> - nHour * <span class="number">60</span> * <span class="number">60</span>) / <span class="number">60</span>;</span><br><span class="line">        <span class="type">int</span> nSecond = seconds - nDay * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> - nHour * <span class="number">60</span> * <span class="number">60</span> - nMinute * <span class="number">60</span>;</span><br><span class="line"> </span><br><span class="line">        strValue = <span class="built_in">QString</span>(<span class="string">&quot;%1d&quot;</span>).<span class="built_in">arg</span>(nDay);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nHour &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1h&quot;</span>).<span class="built_in">arg</span>(nHour);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nMinute &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1m&quot;</span>).<span class="built_in">arg</span>(nMinute);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (nSecond &gt; <span class="number">0</span>)</span><br><span class="line">            strValue += strSpacing + <span class="built_in">QString</span>(<span class="string">&quot;%1s&quot;</span>).<span class="built_in">arg</span>(nSecond);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> strValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="标注：-代码注释中提到可以根据URL来获取文件名，下方给予解释说明。"><a href="#标注：-代码注释中提到可以根据URL来获取文件名，下方给予解释说明。" class="headerlink" title="标注： 代码注释中提到可以根据URL来获取文件名，下方给予解释说明。"></a>标注： 代码注释中提到可以根据URL来获取文件名，下方给予解释说明。</h3><blockquote><p>QString QUrl::fileName(ComponentFormattingOptions options &#x3D; FullyDecoded) const<br>Returns the name of the file, excluding the directory path.<br><strong>Note that, if this QUrl object is given a path ending in a slash, the name of the file is considered empty.</strong><br>If the path doesn’t contain any slash, it is fully returned as the fileName.</p><p>在Qt助手中我们找到此方法，根据加粗的字段可以看出fileName()方法也可能返回为空，所以不是都有效。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
            <tag> QNetWork </tag>
            
            <tag> QNetworkRequest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt快捷键以及全局注册</title>
      <link href="/Code/Qt/Qt%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/Code/Qt/Qt%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Qt在Win系统上的消息通知</title>
      <link href="/Code/Qt/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/"/>
      <url>/Code/Qt/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><p>需求描述： Qt应用程序在windows系统上发送win消息通知</p><h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A51.gif" alt="演示"></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>代码实现很简单，主要调用的接口为<code>QSystemTrayIcon.showMessage()</code></p><p>使用的Demo为 <a href="https://blog.csdn.net/Fuel_Ming/article/details/124348526">【Qt】 鼠标 hover 操作时弹出文字气泡_欧恩意的博客-CSDN博客</a> 这篇文章，结合图片隐藏显示，在系统显示通知。</p><h2 id="widget-h"><a href="#widget-h" class="headerlink" title="widget.h"></a>widget.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPixmap&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSystemTrayIcon&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMenu&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QIcon&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QAction&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123; <span class="keyword">class</span> <span class="title class_">Widget</span>; &#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    QSystemTrayIcon *trayIcon;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stTrayIconActive</span><span class="params">(QSystemTrayIcon::ActivationReason acReason)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_pushButton_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// WIDGET_H</span></span></span><br></pre></td></tr></table></figure><h2 id="widget-cpp"><a href="#widget-cpp" class="headerlink" title="widget.cpp"></a>widget.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">QPixmap <span class="title">img</span><span class="params">(<span class="string">&quot;:/Win11.jpg&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setPixmap</span>(img);</span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setScaledContents</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">setToolTip</span>(<span class="built_in">QString</span>(<span class="string">&quot;壁纸《Win11.png》&quot;</span>));</span><br><span class="line">    ui-&gt;pushButton-&gt;<span class="built_in">setToolTip</span>(<span class="built_in">QString</span>(<span class="string">&quot;隐藏或显示图片&quot;</span>));</span><br><span class="line"></span><br><span class="line">    QIcon icon = QApplication::<span class="built_in">style</span>()-&gt;<span class="built_in">standardIcon</span>((QStyle::StandardPixmap)<span class="number">0</span>);</span><br><span class="line">    QIcon icon1 = QApplication::<span class="built_in">style</span>()-&gt;<span class="built_in">standardIcon</span>((QStyle::StandardPixmap)<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置通知栏的图标</span></span><br><span class="line">    trayIcon = <span class="keyword">new</span> <span class="built_in">QSystemTrayIcon</span>(<span class="keyword">this</span>);</span><br><span class="line">    trayIcon-&gt;<span class="built_in">setIcon</span>(icon);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置通知栏的单击事件</span></span><br><span class="line">    <span class="built_in">connect</span>(trayIcon, <span class="built_in">SIGNAL</span>(<span class="built_in">activated</span>(QSystemTrayIcon::ActivationReason)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">stTrayIconActive</span>(QSystemTrayIcon::ActivationReason)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置通知栏的右键菜单</span></span><br><span class="line">    QMenu * menu = <span class="keyword">new</span> <span class="built_in">QMenu</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置菜单项目</span></span><br><span class="line">    QAction *actionHide = <span class="keyword">new</span> <span class="built_in">QAction</span>(icon, <span class="string">&quot;Hide&quot;</span>, menu);</span><br><span class="line"></span><br><span class="line">    menu-&gt;<span class="built_in">addAction</span>(actionHide);</span><br><span class="line">    trayIcon-&gt;<span class="built_in">setContextMenu</span>(menu);</span><br><span class="line">    <span class="comment">// 设置Action的响应</span></span><br><span class="line">    <span class="built_in">connect</span>(actionHide, <span class="built_in">SIGNAL</span>(<span class="built_in">triggered</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">stActionHide</span>()));</span><br><span class="line">    trayIcon-&gt;<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//托盘的消息提示</span></span><br><span class="line">    trayIcon-&gt;<span class="built_in">showMessage</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;this is a message&quot;</span>, icon1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::stTrayIconActive</span><span class="params">(QSystemTrayIcon::ActivationReason acReason)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (acReason)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> QSystemTrayIcon::Trigger:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">showNormal</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_pushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QIcon icon = QApplication::<span class="built_in">style</span>()-&gt;<span class="built_in">standardIcon</span>((QStyle::StandardPixmap)<span class="number">0</span>);</span><br><span class="line">    QIcon icon1 = QApplication::<span class="built_in">style</span>()-&gt;<span class="built_in">standardIcon</span>((QStyle::StandardPixmap)<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ui-&gt;label-&gt;<span class="built_in">isVisible</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        trayIcon-&gt;<span class="built_in">showMessage</span>(<span class="string">&quot;提醒&quot;</span>, <span class="string">&quot;隐藏图片&quot;</span>, icon1);</span><br><span class="line">        ui-&gt;label-&gt;<span class="built_in">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        trayIcon-&gt;<span class="built_in">showMessage</span>(<span class="string">&quot;提醒&quot;</span>, <span class="string">&quot;显示图片&quot;</span>, icon1);</span><br><span class="line">        ui-&gt;label-&gt;<span class="built_in">setVisible</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="widget-ui"><a href="#widget-ui" class="headerlink" title="widget.ui"></a>widget.ui</h2><p><img src="https://raw.githubusercontent.com/holdyounger/ScopeBlog/rc_images/Images/Qt/images/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/Qt%20Win%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A52.png" alt="UI"></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> win </tag>
            
            <tag> 通知 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt 自定义气泡</title>
      <link href="/Code/Qt/Qt%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B0%94%E6%B3%A1/"/>
      <url>/Code/Qt/Qt%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B0%94%E6%B3%A1/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>Qt 自定义气泡</p><h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="/images/Qt%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B0%94%E6%B3%A1/Qt%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B0%94%E6%B3%A1.gif" alt="自定义气泡"></p><h1 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h1><h2 id="1-绘制弹出的气泡"><a href="#1-绘制弹出的气泡" class="headerlink" title="1. 绘制弹出的气泡"></a>1. 绘制弹出的气泡</h2><blockquote><p>弹出气泡的主要部分已经用ui文件生成了，剩下的就是气泡的三角区域，也是比较难的一个部分</p></blockquote><h3 id="1-1-ui文件代码："><a href="#1-1-ui文件代码：" class="headerlink" title="1.1 ui文件代码："></a>1.1 ui文件代码：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui</span> <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span>&gt;</span>qFloatWidget<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;qFloatWidget&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;geometry&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">x</span>&gt;</span>0<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">y</span>&gt;</span>0<span class="tag">&lt;/<span class="name">y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">width</span>&gt;</span>191<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">height</span>&gt;</span>105<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;windowTitle&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">string</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_2&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QStackedWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;stackedWidget&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;currentIndex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">number</span>&gt;</span>0<span class="tag">&lt;/<span class="name">number</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_4&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QLabel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;label_2&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>2<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;page_2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_3&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QLabel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resources</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">connections</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-2绘制三角区域代码"><a href="#1-2绘制三角区域代码" class="headerlink" title="1.2绘制三角区域代码"></a>1.2绘制三角区域代码</h3><p>三角区域的位置可以根据自己的需求修改。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    QPainterPath drawPath;</span><br><span class="line"></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// painter.setPen(QPen(Qt::blue, 1));</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::white);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小三角区域;</span></span><br><span class="line">    QPolygon trianglePolygon;</span><br><span class="line"></span><br><span class="line">    <span class="function">QRect <span class="title">myRect</span><span class="params">(ui-&gt;stackedWidget-&gt;x(), ui-&gt;stackedWidget-&gt;y(), ui-&gt;stackedWidget-&gt;width(), ui-&gt;stackedWidget-&gt;height())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置小三的具体位置</span></span><br><span class="line">    <span class="type">int</span> tri_pos_x, tri_pos_y;</span><br><span class="line"></span><br><span class="line">    m_offset = ui-&gt;stackedWidget-&gt;<span class="built_in">width</span>() / <span class="number">2</span>  - m_triangleWidth / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">switch</span> (derect)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> up:&#123;</span><br><span class="line">        <span class="comment">// 小三角左边的点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + m_offset;</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>();</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y); <span class="comment">// 小三角起点</span></span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth / <span class="number">2</span>, tri_pos_y - m_triangleHeight);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> left:&#123;</span><br><span class="line">        <span class="comment">// 小三上边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>();</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + m_offset;</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x - m_triangleHeight, tri_pos_y + m_triangleWidth / <span class="number">2</span>);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y + m_triangleWidth);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> right:&#123;</span><br><span class="line">        <span class="comment">// 小三上边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + myRect.<span class="built_in">width</span>();</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + m_offset;</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleHeight, tri_pos_y + m_triangleWidth / <span class="number">2</span>);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y + m_triangleWidth);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> down:&#123;</span><br><span class="line">        <span class="comment">// 小三左边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + m_offset;</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + myRect.<span class="built_in">height</span>();</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth / <span class="number">2</span>, tri_pos_y + m_triangleHeight);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth, tri_pos_y);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    drawPath.<span class="built_in">addRoundedRect</span>(myRect, BORDER_RADIUS, BORDER_RADIUS);</span><br><span class="line">    drawPath.<span class="built_in">addPolygon</span>(trianglePolygon);</span><br><span class="line">    painter.<span class="built_in">drawPath</span>(drawPath);</span><br></pre></td></tr></table></figure><p>以上就是主要的绘图事件，创建了一个带三角的气泡界面。接下来就是在主界面去响应了。</p><h2 id="2-鼠标事件"><a href="#2-鼠标事件" class="headerlink" title="2. 鼠标事件"></a>2. 鼠标事件</h2><p>鼠标时间还是用到了QLabel的过滤器，监听 <code>QEvent::Enter</code> 和 <code>QEvent::Leave</code> 两个事件。具体代码如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Widget::eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString str = <span class="built_in">QString</span>(<span class="string">&quot;&lt;style&gt; span &#123;text-decoration: none; color: #006FFF;font-family: Microsoft YaHei;&#125;&lt;/style&gt;  &lt;span&gt;连接%1&lt;/span&gt; &lt;br&gt; 虚拟地址：%2&lt;br&gt;登录地址：%3&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;已成功&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;192.168.0.0&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;192.168.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">uint8_t</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(obj == ui-&gt;label)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::Enter)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label-&gt;<span class="built_in">setText</span>(<span class="string">&quot;进入&quot;</span>);</span><br><span class="line">            <span class="function">QPoint <span class="title">GlobalPoint</span><span class="params">(ui-&gt;label-&gt;mapToGlobal(QPoint(<span class="number">0</span>, <span class="number">0</span>)))</span></span>;<span class="comment">//获取控件在窗体中的坐标</span></span><br><span class="line">            x = GlobalPoint.<span class="built_in">x</span>();</span><br><span class="line">            y = GlobalPoint.<span class="built_in">y</span>() + ui-&gt;label-&gt;<span class="built_in">height</span>();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; x &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; y ;</span><br><span class="line">            m_widget-&gt;<span class="built_in">myMove</span>(x, y);</span><br><span class="line">            m_widget-&gt;<span class="built_in">setDerection</span>(qFloatWidget::up);</span><br><span class="line">            m_widget-&gt;<span class="built_in">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::Leave)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label-&gt;<span class="built_in">setText</span>((<span class="string">&quot;离开&quot;</span>));</span><br><span class="line">            m_widget-&gt;<span class="built_in">hide</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(obj,event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-动画"><a href="#3-动画" class="headerlink" title="3. 动画"></a>3. 动画</h2><p>动画内容比较简单，只需要创建一个简单的位移动画就可以了，当然也可以去掉动画，直接让气泡弹出。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加动画</span></span><br><span class="line"><span class="comment">// 位移</span></span><br><span class="line">QPropertyAnimation *pPosAnimation1 = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(m_widget, <span class="string">&quot;pos&quot;</span>);</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setStartValue</span>(QCursor::<span class="built_in">pos</span>());</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QPoint</span>(x,y));</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br><span class="line">pPosAnimation1-&gt;<span class="built_in">start</span>();</span><br></pre></td></tr></table></figure><h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><h2 id="QFloatWidget-h"><a href="#QFloatWidget-h" class="headerlink" title="QFloatWidget.h"></a>QFloatWidget.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> QFLOATWIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QFLOATWIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1600)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> SHADOW_WIDTH = <span class="number">30</span>;                 <span class="comment">// 窗口阴影宽度;</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> TRIANGLE_WIDTH = <span class="number">30</span>;               <span class="comment">// 小三角的宽度;</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> TRIANGLE_HEIGHT = <span class="number">10</span>;              <span class="comment">// 小三角的高度;</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BORDER_RADIUS = <span class="number">15</span>;                 <span class="comment">// 窗口边角的弧度;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">qFloatWidget</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">qFloatWidget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">qFloatWidget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">qFloatWidget</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Derection</span>&#123;</span><br><span class="line">        left,</span><br><span class="line">        right,</span><br><span class="line">        up,</span><br><span class="line">        down</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置小三角起始位置;</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setStartPos</span><span class="params">(<span class="type">int</span> startX)</span></span>;</span><br><span class="line">    <span class="comment">// 设置小三角宽和高;</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTriangleInfo</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span></span>;</span><br><span class="line">    <span class="comment">// 设置小三角的位置</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setDerection</span><span class="params">(Derection d)</span></span>;</span><br><span class="line">    <span class="comment">// 比起左上角的位置  用户更关心小三角的尖尖的位置 重载move以便用户更容易定位气泡框的位置</span></span><br><span class="line">    <span class="comment">// x,y 是气泡窗口小贱贱的坐标</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">myMove</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setWidgetIndex</span><span class="params">(<span class="type">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 小三角的偏移量;</span></span><br><span class="line">    <span class="type">int</span> m_offset;</span><br><span class="line">    <span class="comment">// 小三角的宽度;</span></span><br><span class="line">    <span class="type">int</span> m_triangleWidth;</span><br><span class="line">    <span class="comment">// 小三角高度;</span></span><br><span class="line">    <span class="type">int</span> m_triangleHeight;</span><br><span class="line">    Derection derect;</span><br><span class="line"></span><br><span class="line">    Ui::qFloatWidget *ui;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// QFLOATWIDGET_H</span></span></span><br></pre></td></tr></table></figure><h2 id="QFloatWidget-cpp"><a href="#QFloatWidget-cpp" class="headerlink" title="QFloatWidget.cpp"></a>QFloatWidget.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qfloatwidget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_qfloatwidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGraphicsDropShadowEffect&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QHBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPoint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QVariant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPropertyAnimation&gt;</span></span></span><br><span class="line"></span><br><span class="line">qFloatWidget::<span class="built_in">qFloatWidget</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QWidget</span>(parent),</span><br><span class="line">    <span class="built_in">m_offset</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="built_in">m_triangleWidth</span>(TRIANGLE_WIDTH),</span><br><span class="line">    <span class="built_in">m_triangleHeight</span>(TRIANGLE_HEIGHT),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::qFloatWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint);</span><br><span class="line">    <span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground);</span><br><span class="line">    <span class="built_in">setAttribute</span>(Qt::WA_NoSystemBackground);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置具体阴影</span></span><br><span class="line">    QGraphicsDropShadowEffect *shadow_effect = <span class="keyword">new</span> <span class="built_in">QGraphicsDropShadowEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">    shadow_effect-&gt;<span class="built_in">setOffset</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    shadow_effect-&gt;<span class="built_in">setColor</span>(<span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">133</span>, <span class="number">255</span>));</span><br><span class="line">    shadow_effect-&gt;<span class="built_in">setBlurRadius</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setGraphicsEffect</span>(shadow_effect);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">qFloatWidget::~<span class="built_in">qFloatWidget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::setStartPos</span><span class="params">(<span class="type">int</span> startX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_offset = startX;</span><br><span class="line">    <span class="built_in">repaint</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::setTriangleInfo</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_triangleWidth = width;</span><br><span class="line">    m_triangleHeight = height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::setDerection</span><span class="params">(Derection d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    derect = d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::myMove</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> top_left_x, top_left_y;</span><br><span class="line">    <span class="keyword">switch</span> (derect) &#123;</span><br><span class="line">    <span class="keyword">case</span> down:</span><br><span class="line">        top_left_x = x - m_offset - m_triangleWidth / <span class="number">2</span> - ui-&gt;stackedWidget-&gt;<span class="built_in">x</span>();</span><br><span class="line">        top_left_y = y - m_triangleHeight - ui-&gt;stackedWidget-&gt;<span class="built_in">height</span>() - ui-&gt;stackedWidget-&gt;<span class="built_in">y</span>();</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">QPoint</span>(top_left_x, top_left_y));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> up:</span><br><span class="line">        top_left_x = x - m_offset - m_triangleWidth / <span class="number">2</span> - ui-&gt;stackedWidget-&gt;<span class="built_in">x</span>();</span><br><span class="line">        top_left_y = y + m_triangleHeight - ui-&gt;stackedWidget-&gt;<span class="built_in">y</span>();</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">QPoint</span>(top_left_x, top_left_y));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> left:</span><br><span class="line">        top_left_x = x + m_triangleHeight - ui-&gt;stackedWidget-&gt;<span class="built_in">x</span>();</span><br><span class="line">        top_left_y = y - m_offset - m_triangleWidth / <span class="number">2</span> - ui-&gt;stackedWidget-&gt;<span class="built_in">y</span>();</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">QPoint</span>(top_left_x, top_left_y));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> right:</span><br><span class="line">        top_left_x = x - m_triangleHeight - ui-&gt;stackedWidget-&gt;<span class="built_in">width</span>() - ui-&gt;stackedWidget-&gt;<span class="built_in">x</span>();</span><br><span class="line">        top_left_y = y - m_triangleWidth / <span class="number">2</span> - m_offset - ui-&gt;stackedWidget-&gt;<span class="built_in">y</span>();</span><br><span class="line">        <span class="built_in">move</span>(<span class="built_in">QPoint</span>(top_left_x, top_left_y));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::setWidgetIndex</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;stackedWidget-&gt;<span class="built_in">setCurrentIndex</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">qFloatWidget::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    QPainterPath drawPath;</span><br><span class="line"></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// painter.setPen(QPen(Qt::blue, 1));</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(Qt::white);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小三角区域;</span></span><br><span class="line">    QPolygon trianglePolygon;</span><br><span class="line"></span><br><span class="line">    <span class="function">QRect <span class="title">myRect</span><span class="params">(ui-&gt;stackedWidget-&gt;x(), ui-&gt;stackedWidget-&gt;y(), ui-&gt;stackedWidget-&gt;width(), ui-&gt;stackedWidget-&gt;height())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置小三的具体位置</span></span><br><span class="line">    <span class="type">int</span> tri_pos_x, tri_pos_y;</span><br><span class="line"></span><br><span class="line">    m_offset = ui-&gt;stackedWidget-&gt;<span class="built_in">width</span>() / <span class="number">2</span>  - m_triangleWidth / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">switch</span> (derect)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> up:&#123;</span><br><span class="line">        <span class="comment">// 小三角左边的点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + m_offset;</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>();</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y); <span class="comment">// 小三角起点</span></span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth / <span class="number">2</span>, tri_pos_y - m_triangleHeight);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> left:&#123;</span><br><span class="line">        <span class="comment">// 小三上边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>();</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + m_offset;</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x - m_triangleHeight, tri_pos_y + m_triangleWidth / <span class="number">2</span>);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y + m_triangleWidth);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> right:&#123;</span><br><span class="line">        <span class="comment">// 小三上边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + myRect.<span class="built_in">width</span>();</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + m_offset;</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleHeight, tri_pos_y + m_triangleWidth / <span class="number">2</span>);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y + m_triangleWidth);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> down:&#123;</span><br><span class="line">        <span class="comment">// 小三左边点的位置</span></span><br><span class="line">        tri_pos_x = myRect.<span class="built_in">x</span>() + m_offset;</span><br><span class="line">        tri_pos_y = myRect.<span class="built_in">y</span>() + myRect.<span class="built_in">height</span>();</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x, tri_pos_y);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth / <span class="number">2</span>, tri_pos_y + m_triangleHeight);</span><br><span class="line">        trianglePolygon &lt;&lt; <span class="built_in">QPoint</span>(tri_pos_x + m_triangleWidth, tri_pos_y);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    drawPath.<span class="built_in">addRoundedRect</span>(myRect, BORDER_RADIUS, BORDER_RADIUS);</span><br><span class="line">    drawPath.<span class="built_in">addPolygon</span>(trianglePolygon);</span><br><span class="line">    painter.<span class="built_in">drawPath</span>(drawPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="QFloatWidget-ui"><a href="#QFloatWidget-ui" class="headerlink" title="QFloatWidget.ui"></a>QFloatWidget.ui</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui</span> <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span>&gt;</span>qFloatWidget<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;qFloatWidget&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;geometry&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">x</span>&gt;</span>0<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">y</span>&gt;</span>0<span class="tag">&lt;/<span class="name">y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">width</span>&gt;</span>191<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">height</span>&gt;</span>105<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;windowTitle&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">string</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_2&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QStackedWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;stackedWidget&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;currentIndex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">number</span>&gt;</span>0<span class="tag">&lt;/<span class="name">number</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_4&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QLabel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;label_2&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>2<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;page_2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout_3&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QLabel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resources</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">connections</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="widget-h"><a href="#widget-h" class="headerlink" title="widget.h"></a>widget.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMouseEvent&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qmylabel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qfloatwidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1600)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123; <span class="keyword">class</span> <span class="title class_">Widget</span>; &#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line">    qFloatWidget *m_widget;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// WIDGET_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="widget-cpp"><a href="#widget-cpp" class="headerlink" title="widget.cpp"></a>widget.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QPropertyAnimation&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGraphicsEffect&gt;</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_widget = <span class="keyword">new</span> <span class="built_in">qFloatWidget</span>();</span><br><span class="line">    ui-&gt;label-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Widget::eventFilter</span><span class="params">(QObject *obj, QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString str = <span class="built_in">QString</span>(<span class="string">&quot;&lt;style&gt; span &#123;text-decoration: none; color: #006FFF;font-family: Microsoft YaHei;&#125;&lt;/style&gt;  &lt;span&gt;连接%1&lt;/span&gt; &lt;br&gt; 虚拟地址：%2&lt;br&gt;登录地址：%3&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;已成功&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;192.168.0.0&quot;</span>).<span class="built_in">arg</span>(<span class="string">&quot;192.168.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">uint8_t</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(obj == ui-&gt;label)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::Enter)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label-&gt;<span class="built_in">setText</span>(<span class="string">&quot;进入&quot;</span>);</span><br><span class="line">            <span class="function">QPoint <span class="title">GlobalPoint</span><span class="params">(ui-&gt;label-&gt;mapToGlobal(QPoint(<span class="number">0</span>, <span class="number">0</span>)))</span></span>;<span class="comment">//获取控件在窗体中的坐标</span></span><br><span class="line">            x = GlobalPoint.<span class="built_in">x</span>();</span><br><span class="line">            y = GlobalPoint.<span class="built_in">y</span>() + ui-&gt;label-&gt;<span class="built_in">height</span>();</span><br><span class="line"></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; x &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; y ;</span><br><span class="line">            m_widget-&gt;<span class="built_in">myMove</span>(x, y);</span><br><span class="line">            m_widget-&gt;<span class="built_in">setDerection</span>(qFloatWidget::up);</span><br><span class="line">            m_widget-&gt;<span class="built_in">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>() == QEvent::Leave)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;label-&gt;<span class="built_in">setText</span>((<span class="string">&quot;离开&quot;</span>));</span><br><span class="line">            m_widget-&gt;<span class="built_in">hide</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    <span class="comment">// 位移</span></span><br><span class="line">    QPropertyAnimation *pPosAnimation1 = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(m_widget, <span class="string">&quot;pos&quot;</span>);</span><br><span class="line">    pPosAnimation1-&gt;<span class="built_in">setDuration</span>(<span class="number">1000</span>);</span><br><span class="line">    pPosAnimation1-&gt;<span class="built_in">setStartValue</span>(QCursor::<span class="built_in">pos</span>());</span><br><span class="line">    pPosAnimation1-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QPoint</span>(x,y));</span><br><span class="line">    pPosAnimation1-&gt;<span class="built_in">setEasingCurve</span>(QEasingCurve::InOutQuad);</span><br><span class="line">    pPosAnimation1-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(obj,event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="widget-ui"><a href="#widget-ui" class="headerlink" title="widget.ui"></a>widget.ui</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui</span> <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span>&gt;</span>Widget<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QWidget&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Widget&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;geometry&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">x</span>&gt;</span>0<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">y</span>&gt;</span>0<span class="tag">&lt;/<span class="name">y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">width</span>&gt;</span>497<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">height</span>&gt;</span>252<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;windowTitle&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">string</span>&gt;</span>Widget<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;QGridLayout&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gridLayout&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">row</span>=<span class="string">&quot;0&quot;</span> <span class="attr">column</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">widget</span> <span class="attr">class</span>=<span class="string">&quot;QLabel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">string</span>&gt;</span>123123123123<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;textFormat&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enum</span>&gt;</span>Qt::PlainText<span class="tag">&lt;/<span class="name">enum</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;wordWrap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bool</span>&gt;</span>false<span class="tag">&lt;/<span class="name">bool</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">widget</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resources</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">connections</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> 气泡 </tag>
            
            <tag> 自定义控件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【一文搞懂】qss</title>
      <link href="/Code/Qt/Qss/"/>
      <url>/Code/Qt/Qss/</url>
      
        <content type="html"><![CDATA[<h1 id="Qss"><a href="#Qss" class="headerlink" title="Qss"></a>Qss</h1><p>Qss的写法参考<code>css</code>即可。</p><blockquote><p>网站推荐：</p><p><a href="https://doc.qt.io/archives/qt-4.8/stylesheet-reference.html">Qt Style Sheets Reference | Qt 4.8</a></p><p>书籍推荐：</p><p><a href="https://pan.baidu.com/s/12F3fdZH5AO_epxmWIzV2cg">《Qt样式葵花宝典》提取码：nod5</a></p><p>工具推荐：</p><ul><li><p><a href="ttps://pan.baidu.com/s/1PrCgUx57c7iPUMjq3lsClw">Qss Editor 0.6.1 提取码：yzbi</a></p><p><img src="/images/Qss/qsseditor.jpg" alt="qsseditor"></p></li><li><p><a href="https://pan.baidu.com/s/1xxom5Zl3DwXgUAHFkaK6UA">Qss Stylesheet Editor 1.7 提取码：4r3i</a></p><p><img src="/images/Qss/qssstylesheeteditor.png" alt="qssstylesheeteditor"></p></li></ul></blockquote><h1 id="Qss加载的常规操作"><a href="#Qss加载的常规操作" class="headerlink" title="Qss加载的常规操作"></a>Qss加载的常规操作</h1><ol><li>在资源文件夹中添加<code>style.qss</code>的文件</li><li>以文件IO的方式读取并设置即可。</li><li>读取的代码： <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::InitStyle</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_LCD_Hour-&gt;<span class="built_in">setStyleSheet</span>(<span class="string">&quot; font: 18px black;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(i != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">QFile <span class="title">file</span><span class="params">(QString(<span class="string">&quot;:/Assert/qss/style%1.qss&quot;</span>).arg(i))</span></span>;</span><br><span class="line">        file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">setStyleSheet</span>(file.<span class="built_in">readAll</span>());</span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// m_LCD_Min-&gt;setStyleSheet(&quot;color: black; &quot;);</span></span><br><span class="line">    <span class="comment">// m_LCD_Sec-&gt;setStyleSheet(&quot;color: black; &quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(QString(<span class="string">&quot;:/Assert/qss/main.qss&quot;</span>))</span></span>;</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setStyleSheet</span>(file.<span class="built_in">readAll</span>());</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 感兴趣的朋友可以看看我整理的一些Qt小项目常用的一些代码：[【Qt】常用基础代码汇总（随时更新）_欧恩意的博客-CSDN博客_qt代码整理]<a href="https://blog.csdn.net/Fuel_Ming/article/details/122830341">https://blog.csdn.net/Fuel_Ming/article/details/122830341</a>)</li></ol><h1 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h1><p>一般情况下，在ui文件中的控件有效，而在代码中声明的则无效，因为Qt是根据<code>objectName</code>来识别的，所以自己声明的控件需要设置对象名。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_btn-&gt;<span class="built_in">setObjectName</span>(<span class="string">&quot;BtnOK&quot;</span>);</span><br></pre></td></tr></table></figure><p>在<code>QSS</code>文件中：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QPushButton<span class="selector-id">#BtnOK</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:white;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="built_in">rgb</span>(<span class="number">0</span>,<span class="number">112</span>,<span class="number">210</span>);</span><br><span class="line">&#125;</span><br><span class="line">QPushButton<span class="selector-id">#BtnOK</span>::hover&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">0</span>,<span class="number">134</span>,<span class="number">252</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通用选择器"><a href="#通用选择器" class="headerlink" title="通用选择器"></a>通用选择器</h2><p>即 <code>*</code> 表示的css对象。作用于所有的界面控件</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类型选择器"><a href="#类型选择器" class="headerlink" title="类型选择器"></a>类型选择器</h2><ol><li>作用于自己及子类</li></ol><p><code>类名</code>（Qt类）作为选择器，作用于其自身和他所有的子类</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QFrame &#123;</span><br><span class="line"><span class="attribute">background</span>: gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用了类型选择器 <code>QFrame</code>，所以 QFrame 和它的子类 <code>QLable</code>，<code>QLCDNumber</code>，<code>QTableWidget</code> 等的背景会是灰色的，<code>QPushButton</code> 不是 <code>QFrame</code> 的子类，所以不受影响。在Qt的类图或者帮助手册中可以看到一个Qt类的子类和父类。</p><ol start="2"><li>只作用于自己</li></ol><p>即 <code>. + 类名</code> 的形式。作用对象只有它自己。子类不受影响。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QWidget *window = <span class="keyword">new</span> <span class="built_in">QWidget</span>();</span><br><span class="line">window-&gt;<span class="built_in">setStylesheet</span>(<span class="string">&quot;.QWidget &#123; &quot;</span></span><br><span class="line">                      <span class="string">&quot;color:red;&quot;</span></span><br><span class="line">                      <span class="string">&quot;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="ID选择器"><a href="#ID选择器" class="headerlink" title="ID选择器"></a>ID选择器</h2><p><code># + objectname</code>作为选择器。只作用于此 <code>objectname</code> 的对象（多个对象可以设置同一个 <code>objectname</code>，但不推荐这么写）。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">QPushButton *btn = <span class="keyword">new</span> QPushButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置属性名</span></span><br><span class="line">btn-&gt;<span class="built_in">setObjectName</span>(<span class="string">&quot;openButton&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置样式</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line">btn-&gt;<span class="built_in">setStylesheet</span>(<span class="string">&quot;#openButton &#123; &quot;</span></span><br><span class="line">                      <span class="string">&quot;color:red;&quot;</span></span><br><span class="line">                      <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">btn-&gt;<span class="built_in">setStylesheet</span>(<span class="string">&quot;QPushButton#openButton &#123; &quot;</span></span><br><span class="line">                      <span class="string">&quot;color:red;&quot;</span></span><br><span class="line">                      <span class="string">&quot;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h2><p><code>[属性 = 值]</code>的形式设置样式。需要通过<code>object-&gt;property()</code>接口设置Qt控件的属性值（Dynamic Properties）。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="built_in">setStyleSheet</span>(<span class="string">&quot;.QWidget &#123; background: gray; &#125;&quot;</span></span><br><span class="line">                  <span class="string">&quot;QPushButton[level=\&quot;dangerous\&quot;] &#123; background: magenta; &#125;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">openButton-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;level&quot;</span>, <span class="string">&quot;dangerous&quot;</span>);</span><br><span class="line">closeButton-&gt;<span class="built_in">setProperty</span>(<span class="string">&quot;level&quot;</span>, <span class="string">&quot;dangerous&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="包含选择器"><a href="#包含选择器" class="headerlink" title="包含选择器"></a>包含选择器</h2><p>也就是对控件内的控件的类进行设置，一看就懂，选择器之间用<mark>空格</mark>隔开，包含选择器和子元素选择器需要区分：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QFrame &#123;</span><br><span class="line">    <span class="attribute">background</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">QFrame QPushButton &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid magenta;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="子元素选择器"><a href="#子元素选择器" class="headerlink" title="子元素选择器"></a>子元素选择器</h2><p>选择器之间用 <code>&gt;</code> 隔开，作用于<code>Widget</code>的 直接 <code>子Widget</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QFrame &#123;</span><br><span class="line">    <span class="attribute">background</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">QFrame &gt; QPushButton &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid magenta;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="伪类选择器"><a href="#伪类选择器" class="headerlink" title="伪类选择器"></a>伪类选择器</h2><p><code>选择器:状态</code> 作为选择器。支持<code>!</code>操作。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QPushButton<span class="selector-pseudo">:hover</span> &#123; <span class="attribute">color</span>: white &#125;</span><br><span class="line">QCheckBox<span class="selector-pseudo">:checked</span> &#123; <span class="attribute">color</span>: white &#125;</span><br><span class="line">QCheckBox:!checked &#123; <span class="attribute">color</span>: red &#125;</span><br></pre></td></tr></table></figure><p>常见的伪类选择器如下所示：</p><table><thead><tr><th align="left">伪类</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">:disabled</td><td align="left">Widget 被禁用时</td></tr><tr><td align="left">:enabled</td><td align="left">Widget 可使用时</td></tr><tr><td align="left">:focus</td><td align="left">Widget 得到输入焦点</td></tr><tr><td align="left">:hover</td><td align="left">鼠标放到 Widget 上</td></tr><tr><td align="left">:pressed</td><td align="left">鼠标按下时</td></tr><tr><td align="left">:checked</td><td align="left">被选中时</td></tr><tr><td align="left">:unchecked</td><td align="left">未选中时</td></tr><tr><td align="left">:has-children</td><td align="left">Item 有子 item，例如 QTreeView 的 item 有子 item 时</td></tr><tr><td align="left">:has-siblings</td><td align="left">Item 有 兄弟，例如 QTreeView 的 item 有兄弟 item 时</td></tr><tr><td align="left">:open</td><td align="left">打开或展开状态，例如 QTreeView 的 item 展开，QPushButton 的菜单弹出时</td></tr><tr><td align="left">:closed</td><td align="left">关闭或者非展开状态</td></tr><tr><td align="left">:on</td><td align="left">Widget 状态是可切换的（toggle）, 在 on 状态</td></tr><tr><td align="left">:off</td><td align="left">Widget 状态是可切换的（toggle）, 在 off 状态</td></tr></tbody></table><h2 id="SubControl选择器"><a href="#SubControl选择器" class="headerlink" title="SubControl选择器"></a>SubControl选择器</h2><p><code>选择器::subcontrol</code> 作为选择 Subcontrol 的选择器。</p><p>有些 Widget 是由多个部分组合成的，例如 QCheckBox 由 icon(indicator) 和 text 组成，可以使用 <code>选择器::subcontrol</code> 来设置 subcontrol 的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QCheckBox::indicator &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QCheckBox &#123;</span><br><span class="line">    spacing: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>常用的 Subcontrol 有：</p><table><thead><tr><th align="left">Subcontrol</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">::indicator</td><td align="left">A QCheckBox, QRadioButton, checkable QMenu item,  or a checkable QGroupBox’s indicator</td></tr><tr><td align="left">::menu-indicator</td><td align="left">A QPushButton’s menu indicator</td></tr><tr><td align="left">::item</td><td align="left">A QMenu, QMenuBar, or QStatusBar’s item</td></tr><tr><td align="left">::up-button</td><td align="left">A QSpinBox or QScrollBar’s up button</td></tr><tr><td align="left">::down-button</td><td align="left">A QSpinBox or QScrollBar’s down button</td></tr><tr><td align="left">::up-arrow</td><td align="left">A QSpinBox, QScrollBar, or QHeaderView’s up arrow</td></tr><tr><td align="left">::down-arrow</td><td align="left">A QSpinBox, QScrollBar, or QHeaderView’s down arrow</td></tr><tr><td align="left">::drop-down</td><td align="left">A QComboBox’s drop-down arrow</td></tr><tr><td align="left">::title</td><td align="left">A QGroupBox or QDockWidget’s title</td></tr><tr><td align="left">::groove</td><td align="left">A QSlider’s groove</td></tr><tr><td align="left">::chunk</td><td align="left">A QProgressBar’s progress chunk</td></tr><tr><td align="left">::branch</td><td align="left">A QTreeView’s branch indicator</td></tr></tbody></table><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>一些其他写法的参考demo</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ================================================ *</span></span><br><span class="line"><span class="comment">author:lei</span></span><br><span class="line"><span class="comment">lastedited:2020.2</span></span><br><span class="line"><span class="comment">* ================================================ */</span></span><br><span class="line">$text = <span class="selector-id">#222</span>;</span><br><span class="line">$<span class="attribute">background</span> = <span class="selector-id">#FDFDFD</span>;</span><br><span class="line">$<span class="attribute">border</span> = <span class="selector-id">#999999</span>;</span><br><span class="line">$selected = <span class="selector-id">#8BF</span>; <span class="comment">/*hover*/</span></span><br><span class="line">$pressed = <span class="selector-id">#59F</span>;</span><br><span class="line">$focused = <span class="selector-id">#EA2</span>; <span class="comment">/*actived*/</span></span><br><span class="line">$grad1a = <span class="selector-id">#EEEEEF</span>; <span class="comment">/*gradient start*/</span></span><br><span class="line">$grad1b = <span class="selector-id">#DADADF</span>; <span class="comment">/*gradient end*/</span></span><br><span class="line"></span><br><span class="line">QWidget</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">color</span>: $text;</span><br><span class="line">    <span class="attribute">background-color</span>: $background;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QFrame&#123;</span><br><span class="line">    <span class="attribute">color</span>: $text;</span><br><span class="line">    <span class="attribute">background-color</span>: $background;<span class="comment">/*不能设置为transparent*/</span></span><br><span class="line">&#125;</span><br><span class="line">QMainWindow::separator&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-style</span>: outset;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QMainWindow::separator:hover&#123;</span><br><span class="line">    <span class="attribute">background</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line">QSplitter::handle&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-style</span>: outset;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QSplitter::handle:hover&#123;<span class="comment">/*splitter-&gt;handle(1)-&gt;setAttribute(Qt::WA_Hover, true);才生效*/</span></span><br><span class="line">    <span class="attribute">border-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line">QSplitter::handle:pressed&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line">QSizeGrip&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* Label                                           */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QLabel &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* A QLabel is a QFrame ... */</span></span><br><span class="line"><span class="comment">/* A QToolTip is a QLabel ... */</span></span><br><span class="line">QToolTip &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">210</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* TextBox                                         */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QLineEdit &#123;</span><br><span class="line">    <span class="attribute">background</span>: $background;<span class="comment">/*不建议设为透明，否则table编辑时会字显示*/</span></span><br><span class="line">    selection-<span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border-style</span>: inset;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QLineEdit<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line">QLineEdit<span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*QLineEdit[readOnly=&quot;true&quot;] &#123; color: gray &#125;*/</span></span><br><span class="line">QLineEdit<span class="selector-attr">[echoMode=<span class="string">&quot;2&quot;</span>]</span>&#123;</span><br><span class="line">    lineedit-password-character: <span class="number">9679</span>;<span class="comment">/*字符的ascii码35 88等 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QLineEdit<span class="selector-pseudo">:read-only</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: lightgray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QLineEdit<span class="selector-pseudo">:disabled</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: lightgray;</span><br><span class="line">    <span class="attribute">background</span>: lightgray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTextEdit&#123;</span><br><span class="line">    selection-<span class="attribute">background-color</span>:$selected;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-style</span>: inset;</span><br><span class="line">&#125;</span><br><span class="line">QTextEdit<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line">QTextEdit<span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* Button                                          */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QPushButton &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="comment">/*background-color: QLinearGradient( x1: 0, y1: 0, x2: 0, y2: 1, </span></span><br><span class="line"><span class="comment">        stop: 0 $grad1a, stop: 0.05 $grad1b,stop: 0.5 $grad1b, </span></span><br><span class="line"><span class="comment">        stop: 0.9 $grad1a, stop: 1 $grad1a);*/</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QPushButton<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QPushButton:pressed</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;      </span><br><span class="line">    <span class="attribute">background-color</span>: $pressed;</span><br><span class="line">    <span class="attribute">border-color</span>: $border;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QPushButton<span class="selector-pseudo">:focus</span>, QPushButton<span class="selector-pseudo">:default</span> &#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $focused; <span class="comment">/* make the default button prominent */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">QToolButton,QToolButton:unchecked &#123; <span class="comment">/* ToolBar里的按钮和带下拉菜单的按钮 */</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QToolButton<span class="selector-pseudo">:checked</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line">QToolButton<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QToolButton:pressed,QToolButton:checked:hover&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $pressed;</span><br><span class="line">    <span class="attribute">border-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line">QToolButton<span class="selector-pseudo">:checked</span>:pressed&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* only for MenuButtonPopup */</span></span><br><span class="line">QToolButton<span class="selector-attr">[popupMode=<span class="string">&quot;1&quot;</span>]</span>&#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">15px</span>; <span class="comment">/* make way for the popup button */</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="comment">/*background: qlineargradient(x1:0, y1:0 ,x2:0, y2:1</span></span><br><span class="line"><span class="comment">        stop: 0 $grad1a, stop: 0.05 $grad1b, stop: 0.5 $grad1b</span></span><br><span class="line"><span class="comment">        stop: 0.95 $grad1a stop: 1$grad1a)*/</span></span><br><span class="line">&#125;</span><br><span class="line">QToolButton<span class="selector-attr">[popupMode=<span class="string">&quot;1&quot;</span>]</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line">QToolButton<span class="selector-attr">[popupMode=<span class="string">&quot;1&quot;</span>]</span>:pressed&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: $pressed;</span><br><span class="line">    <span class="attribute">border-color</span>: $border;</span><br><span class="line">&#125;</span><br><span class="line">QToolButton::menu-button &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-top-right-radius</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* Slider ProgressBar                              */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QProgressBar &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QProgressBar::chunk &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $focused;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QSlider&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::groove&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">background</span>: $background;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::handle &#123;<span class="comment">/*设置中间的那个滑动的键*/</span>                           </span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">background</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::groove:horizontal &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3px</span>; <span class="comment">/* the groove expands to the size of the slider by default. by giving it a height, it has a fixed size */</span></span><br><span class="line">    <span class="attribute">left</span>:<span class="number">5px</span>; <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::groove:vertical&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">5px</span>; <span class="attribute">bottom</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::handle:horizontal&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">7px</span>; <span class="comment">/* height */</span></span><br><span class="line">&#125;</span><br><span class="line">QSlider::handle:vertical&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">7px</span>; <span class="comment">/* height */</span></span><br><span class="line">&#125;</span><br><span class="line">QSlider::add-page&#123;<span class="comment">/*还没有滑上去的地方*/</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">background</span>:$grad1a;</span><br><span class="line">&#125;</span><br><span class="line">QSlider::sub-page&#123;<span class="comment">/*已经划过的从地方*/</span>                            </span><br><span class="line">    <span class="attribute">background</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* ScrollBar                                       */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QScrollBar&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $background;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QScrollBar<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>:$selected;</span><br><span class="line">&#125;</span><br><span class="line">QScrollBar::handle&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">background</span>: $pressed;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QScrollBar::handle:hover &#123;</span><br><span class="line">    <span class="attribute">background</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line">QScrollBar::add-line, QScrollBar::sub-line,</span><br><span class="line">QScrollBar::add-page, QScrollBar::sub-page &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QScrollArea&#123;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*QScrollArea  QAbstractSlider&#123;</span></span><br><span class="line"><span class="comment">    border-radius: 0px;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* DockWidget                                       */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QDockWidget, QDockWidget &gt; QWidget<span class="comment">/*not work*/</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $border;<span class="comment">/*qt bug*/</span></span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QDockWidget::title &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-style</span>: inset;</span><br><span class="line">    <span class="attribute">text-align</span>: left; <span class="comment">/* align the text to the left */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* GroupBox                                        */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QGroupBox &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $background;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.5em</span>;</span><br><span class="line">&#125;</span><br><span class="line">QGroupBox::title &#123;</span><br><span class="line">    subcontrol-origin: margin;</span><br><span class="line">    subcontrol-<span class="attribute">position</span>: top left;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">1em</span>;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">0.1em</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: $background;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* ToolBox                                         */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QToolBox&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">&#125;</span><br><span class="line">QToolBox::tab &#123;</span><br><span class="line">    <span class="attribute">background</span>: $grad1a;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QToolBox::tab:hover &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QToolBox::tab:pressed &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $pressed;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QToolBox::tab:selected &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">border-color</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* TabWidget                                       */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QTabWidget&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QTabWidget::pane&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">&#125;</span><br><span class="line">QTabWidget::tab-bar &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab &#123;</span><br><span class="line">    <span class="attribute">background</span>: $background;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $border;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">3px</span> <span class="number">5px</span>;    </span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:hover &#123;</span><br><span class="line">    <span class="attribute">background</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:selected &#123;</span><br><span class="line">    <span class="attribute">background</span>: $selected;</span><br><span class="line">    <span class="attribute">border-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:pressed &#123;</span><br><span class="line">    <span class="attribute">background</span>: $pressed;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:focus &#123;</span><br><span class="line">    <span class="attribute">border-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:top&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: transparent;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:bottom&#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: transparent;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:left&#123;</span><br><span class="line">    <span class="attribute">border-right</span>: transparent;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QTabBar::tab:right&#123;</span><br><span class="line">    <span class="attribute">border-left</span>: transparent;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* QHeaderView for list table                      */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QHeaderView &#123;</span><br><span class="line"><span class="attribute">border</span>: none;</span><br><span class="line"><span class="attribute">margin</span>: <span class="number">0px</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QHeaderView::section, QTableCornerButton::section &#123;<span class="comment">/*设置表头属性*/</span><span class="comment">/*左上角*/</span></span><br><span class="line"><span class="attribute">background-color</span>: $grad1a;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">0</span> <span class="number">3px</span>;</span><br><span class="line"><span class="attribute">border-right</span>: <span class="number">1px</span> solid $border;</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">1px</span> solid $border;</span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line">QHeaderView::section:hover, QTableCornerButton::section:hover&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $selected;</span><br><span class="line">&#125;</span><br><span class="line">QHeaderView::section:pressed&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $pressed;</span><br><span class="line">&#125;</span><br><span class="line">QHeaderView::section:checked &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: $focused;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line"><span class="comment">/* QTableWidget                                    */</span></span><br><span class="line"><span class="comment">/* =============================================== */</span></span><br><span class="line">QTableWidget, QTableView</span><br><span class="line">&#123;</span><br><span class="line">    gridline-<span class="attribute">color</span>: $border;    <span class="comment">/*表格中的网格线条颜色*/</span></span><br><span class="line">    <span class="attribute">background</span>: $background;</span><br><span class="line">    <span class="comment">/*设置交替颜色，需要在函数属性中设置:tableWidget-&gt;setAlternatingRowColors(true)*/</span></span><br><span class="line">    alternate-<span class="attribute">background-color</span>: $grad1a;</span><br><span class="line">    <span class="comment">/*selection-color:$background;    鼠标选中时前景色：文字颜色*/</span></span><br><span class="line">    selection-<span class="attribute">background-color</span>:$selected;   <span class="comment">/*鼠标选中时背景色*/</span></span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid $border;  <span class="comment">/*边框线的宽度、颜色*/</span></span><br><span class="line">    <span class="comment">/*border:none;    去除边界线*/</span></span><br><span class="line">    <span class="comment">/*border-radius:5px;*/</span></span><br><span class="line">    <span class="comment">/*padding:10px 10px;*/</span>  <span class="comment">/*表格与边框的间距*/</span></span><br><span class="line">&#125;</span><br><span class="line">QTableView::item, QTabWidget::item&#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line"><span class="attribute">outline-style</span>: none;</span><br><span class="line"><span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTableView::item:hover &#123;</span><br><span class="line"><span class="attribute">background</span>: $selected;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid $focused;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTableView::item:selected &#123;</span><br><span class="line"><span class="attribute">background</span>: $selected;</span><br><span class="line"><span class="attribute">color</span>: $grad1a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTableView::item:selected:active &#123;</span><br><span class="line"><span class="attribute">background</span>: $pressed;</span><br><span class="line"><span class="attribute">color</span>: $grad1a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTableWidget QComboBox&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>窗体不显示或半透明</title>
      <link href="/Code/Qt/QWebEngineView/%E7%AA%97%E4%BD%93%E4%B8%8D%E6%98%BE%E7%A4%BA%E6%88%96%E7%AA%97%E4%BD%93%E5%8D%8A%E9%80%8F%E6%98%8E/"/>
      <url>/Code/Qt/QWebEngineView/%E7%AA%97%E4%BD%93%E4%B8%8D%E6%98%BE%E7%A4%BA%E6%88%96%E7%AA%97%E4%BD%93%E5%8D%8A%E9%80%8F%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<p>使用 QWebEnginueView 控件后，如果父窗体设置了一下属性，就会导致窗口不显示或半透明。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint);</span><br><span class="line"><span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground);</span><br></pre></td></tr></table></figure><p>解决办法：</p><p><a href="https://blog.csdn.net/s634772208/article/details/124791501">QWebEngineView在顶层窗口为透明无标题栏的情况下有问题_shanql的博客-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QWebEngineView </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> QWebEngineView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 QWebEngineView 加载网页慢的问题</title>
      <link href="/Code/Qt/QWebEngineView/%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%85%A2/"/>
      <url>/Code/Qt/QWebEngineView/%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%85%A2/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h1><p>把 <code>QWebEngineview</code> 发起的每个网络请求全部打印，看看是哪个请求慢：</p><h2 id="重写-QWebEngineUrlRequestInterceptor"><a href="#重写-QWebEngineUrlRequestInterceptor" class="headerlink" title="重写 QWebEngineUrlRequestInterceptor"></a>重写 <code>QWebEngineUrlRequestInterceptor</code></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomUrlRequestInterceptor</span> : <span class="keyword">public</span> QWebEngineUrlRequestInterceptor</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CustomUrlRequestInterceptor</span>(QObject* parent = <span class="literal">nullptr</span>) :  <span class="built_in">QWebEngineUrlRequestInterceptor</span>(parent) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">interceptRequest</span><span class="params">(QWebEngineUrlRequestInfo&amp; info)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 可在发送请求前对URL进行修改</span></span><br><span class="line">        <span class="keyword">if</span> (info.<span class="built_in">requestUrl</span>().<span class="built_in">host</span>() == <span class="string">&quot;www.example.com&quot;</span>) &#123;</span><br><span class="line">            QUrl newUrl = info.<span class="built_in">requestUrl</span>();</span><br><span class="line">            newUrl.<span class="built_in">setHost</span>(<span class="string">&quot;www.newexample.com&quot;</span>);</span><br><span class="line">            info.<span class="built_in">setUrl</span>(newUrl);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可添加自定义Header</span></span><br><span class="line">        info.<span class="built_in">setHttpHeader</span>(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Custom User-Agent&quot;</span>);</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// 打印日志</span></span><br><span class="line">LogUtils::<span class="built_in">info</span>(info.<span class="built_in">requestUrl</span>().<span class="built_in">toString</span>().<span class="built_in">toStdString</span>().<span class="built_in">c_str</span>());<span class="comment">//输出日志</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="关闭系统代理"><a href="#关闭系统代理" class="headerlink" title="关闭系统代理"></a>关闭系统代理</h1><p>设置关闭系统自动代理即可：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QNetworkProxyFactory::<span class="built_in">setUseSystemConfiguration</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QWebEngineView </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> QWebEngineView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt窗口适配系统缩放</title>
      <link href="/Code/Qt/QWin/Qt%E7%AA%97%E5%8F%A3%E9%80%82%E9%85%8D%E7%B3%BB%E7%BB%9F%E7%BC%A9%E6%94%BE/"/>
      <url>/Code/Qt/QWin/Qt%E7%AA%97%E5%8F%A3%E9%80%82%E9%85%8D%E7%B3%BB%E7%BB%9F%E7%BC%A9%E6%94%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DpiCompatible</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">double</span> <span class="title">GetDpiScale</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span> dDpi = <span class="number">1.0</span>;</span><br><span class="line">HDC desktopDc = <span class="built_in">GetDC</span>(<span class="literal">NULL</span>);</span><br><span class="line"><span class="type">float</span> horizontalDPI = <span class="built_in">GetDeviceCaps</span>(desktopDc, LOGPIXELSX);</span><br><span class="line"><span class="type">float</span> verticalDPI = <span class="built_in">GetDeviceCaps</span>(desktopDc, LOGPIXELSY);</span><br><span class="line"><span class="type">int</span> dpi = (horizontalDPI + verticalDPI) / <span class="number">2</span>;</span><br><span class="line">dDpi = <span class="number">1</span> + ((dpi - <span class="number">96</span>) / <span class="number">24</span>) * <span class="number">0.25</span>;</span><br><span class="line"><span class="keyword">if</span> (dDpi &lt; <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">dDpi = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">ReleaseDC</span>(<span class="literal">NULL</span>, desktopDc);</span><br><span class="line"><span class="keyword">return</span> dDpi;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">InitQtDPICompatible</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">SetProcessDPIAware</span>();</span><br><span class="line"><span class="built_in">qputenv</span>(<span class="string">&quot;QT_SCALE_FACTOR&quot;</span>, QString::<span class="built_in">number</span>(<span class="built_in">GetDpiScale</span>()).<span class="built_in">toLatin1</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置该属性解决在不同缩放比例的显示器之间移动时布局混乱和不跟随windows系统缩放的问题</span></span><br><span class="line">DpiCompatible::<span class="built_in">InitQtDPICompatible</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QWin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> win </tag>
            
            <tag> 缩放 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QListWidget 用法整理</title>
      <link href="/Code/Qt/QListWidget%20%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86/"/>
      <url>/Code/Qt/QListWidget%20%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="设置显示模式"><a href="#设置显示模式" class="headerlink" title="设置显示模式"></a>设置显示模式</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QListView::ListMode</span><br><span class="line">QListView::IconMode</span><br></pre></td></tr></table></figure><p>调用接口：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setViewMode</span>(QListWidget::IconMode); <span class="comment">//显示模式</span></span><br></pre></td></tr></table></figure><h1 id="添加控件"><a href="#添加控件" class="headerlink" title="添加控件"></a>添加控件</h1><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><img src="images/QListWidget%20%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86/QListWidget_all.png" style="zoom:50%" /><p>新建项目的时候创建一个带ui的项目，新建完成后，在界面拖拽一个QListWidget。</p><h2 id="Widget-h"><a href="#Widget-h" class="headerlink" title="Widget.h"></a>Widget.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QListWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QStringList&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QListWidgetItem&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGridLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QToolButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QLineEdit&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QRadioButton&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123; <span class="keyword">class</span> <span class="title class_">Widget</span>; &#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initListWidget</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// WIDGET_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Widget-cpp"><a href="#Widget-cpp" class="headerlink" title="Widget.cpp"></a>Widget.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">initListWidget</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::initListWidget</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;listWidget-&gt;<span class="built_in">setCurrentRow</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    QStringList StrListHeader;</span><br><span class="line">    StrListHeader &lt;&lt; <span class="built_in">QString</span>(<span class="string">&quot;选中&quot;</span>) &lt;&lt; <span class="built_in">QString</span>(<span class="string">&quot;序号&quot;</span>) &lt;&lt; <span class="built_in">QString</span>(<span class="string">&quot;文件名&quot;</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>(<span class="built_in">tr</span>(<span class="string">&quot;Oak&quot;</span>), ui-&gt;listWidget);</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>(<span class="built_in">tr</span>(<span class="string">&quot;Fir&quot;</span>), ui-&gt;listWidget);</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>(<span class="built_in">tr</span>(<span class="string">&quot;Pine&quot;</span>), ui-&gt;listWidget);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    QListWidgetItem *ListItem = <span class="keyword">new</span> QListWidgetItem;</span><br><span class="line">    <span class="comment">//    ListItem-&gt;setText();</span></span><br><span class="line"></span><br><span class="line">    QListWidgetItem *WContainerItem = <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>(ui-&gt;listWidget);</span><br><span class="line">    QWidget *WContainer = <span class="keyword">new</span> <span class="built_in">QWidget</span>(ui-&gt;listWidget);<span class="comment">//新建一个QWidget窗口</span></span><br><span class="line">    QGridLayout*Glayout = <span class="keyword">new</span> QGridLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*************start*****************/</span></span><br><span class="line"><span class="comment">/* 在这里添加需要的控件 */</span></span><br><span class="line">    QLineEdit *lineEdit = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    QLineEdit *lineEdit_1 = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    QToolButton *toolButton = <span class="keyword">new</span> QToolButton;</span><br><span class="line">    QRadioButton *radioButton = <span class="keyword">new</span> QRadioButton;</span><br><span class="line">    QRadioButton *radioButton_1 = <span class="keyword">new</span> QRadioButton;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Glayout-&gt;<span class="built_in">addWidget</span>(lineEdit,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    Glayout-&gt;<span class="built_in">addWidget</span>(radioButton,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    Glayout-&gt;<span class="built_in">addWidget</span>(lineEdit_1,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">    Glayout-&gt;<span class="built_in">addWidget</span>(radioButton_1,<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  WContainer-&gt;<span class="built_in">setLayout</span>(Glayout);</span><br><span class="line"><span class="comment">/******************end****************/</span></span><br><span class="line"></span><br><span class="line">    WContainerItem-&gt;<span class="built_in">setSizeHint</span>(<span class="built_in">QSize</span>(<span class="number">40</span>,<span class="number">40</span>));</span><br><span class="line"></span><br><span class="line">    ui-&gt;listWidget-&gt;<span class="built_in">setItemWidget</span>(WContainerItem, WContainer);<span class="comment">//将WContainer赋予WContainerItem</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> QListWidget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QTableWidget 遍历</title>
      <link href="/Code/Qt/QTableWidget/QTableWidget%E9%81%8D%E5%8E%86/"/>
      <url>/Code/Qt/QTableWidget/QTableWidget%E9%81%8D%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> row=<span class="number">0</span>; row&lt;ui-&gt;tableWidget-&gt;<span class="built_in">rowCount</span>(); row++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> col=<span class="number">0</span>; col&lt;ui-&gt;tableWidget-&gt;<span class="built_in">columnCount</span>(); col++)</span><br><span class="line">&#123;</span><br><span class="line">QTableWidgetItem* item = ui-&gt;tableWidget_right-&gt;<span class="built_in">item</span>(row,col);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> row=<span class="number">0</span>; row&lt;ui-&gt;tableWidget-&gt;<span class="built_in">rowCount</span>(); row++)</span><br><span class="line">&#123;</span><br><span class="line">QTableWidgetItem* item = ui-&gt;tableWidget_right-&gt;<span class="built_in">item</span>(row,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QTableWidget </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> QTableWidget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QLineEdit 修改部分文本样式</title>
      <link href="/Code/Qt/QLineEdit/QLineEdit%E4%BF%AE%E6%94%B9%E9%83%A8%E5%88%86%E6%96%87%E6%9C%AC%E6%A0%B7%E5%BC%8F/"/>
      <url>/Code/Qt/QLineEdit/QLineEdit%E4%BF%AE%E6%94%B9%E9%83%A8%E5%88%86%E6%96%87%E6%9C%AC%E6%A0%B7%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>功能描述： 修改QLineEdit中部分文本的样式</p><p>预期效果：</p><p><img src="/images/QLineEdit%E4%BF%AE%E6%94%B9%E9%83%A8%E5%88%86%E6%96%87%E6%9C%AC%E6%A0%B7%E5%BC%8F/1.png" alt="效果展示"></p><p>windows系统路径不允许有<code>？</code>等符号，高亮显示不允许的符号。</p></blockquote><p>[toc]</p><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">setLineEditTextFormat</span><span class="params">(QLineEdit* lineEdit, <span class="type">const</span> QList&lt;QTextLayout::FormatRange&gt;&amp; formats)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!lineEdit)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    QList&lt;QInputMethodEvent::Attribute&gt; attributes;</span><br><span class="line">    foreach(<span class="type">const</span> QTextLayout::FormatRange&amp; fr, formats)</span><br><span class="line">    &#123;</span><br><span class="line">        QInputMethodEvent::AttributeType type = QInputMethodEvent::TextFormat;</span><br><span class="line">        <span class="type">int</span> start = fr.start - lineEdit-&gt;<span class="built_in">cursorPosition</span>();</span><br><span class="line">        <span class="type">int</span> length = fr.length;</span><br><span class="line">        QVariant value = fr.format;</span><br><span class="line">        attributes.<span class="built_in">append</span>(QInputMethodEvent::<span class="built_in">Attribute</span>(type, start, length, value));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QInputMethodEvent <span class="title">event</span><span class="params">(QString(), attributes)</span></span>;</span><br><span class="line">    QCoreApplication::<span class="built_in">sendEvent</span>(lineEdit, &amp;event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">clearLineEditTextFormat</span><span class="params">(QLineEdit* lineEdit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setLineEditTextFormat</span>(lineEdit, <span class="built_in">QList</span>&lt;QTextLayout::FormatRange&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Usage example:</span></span><br><span class="line">QLineEdit* lineEdit = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">lineEdit-&gt;<span class="built_in">setText</span>(<span class="built_in">tr</span>(<span class="string">&quot;Task Tracker - Entry&quot;</span>));</span><br><span class="line"></span><br><span class="line">QList&lt;QTextLayout::FormatRange&gt; formats;</span><br><span class="line"></span><br><span class="line">QTextCharFormat f;</span><br><span class="line"></span><br><span class="line">f.<span class="built_in">setFontWeight</span>(QFont::Bold);</span><br><span class="line">QTextLayout::FormatRange fr_task;</span><br><span class="line">fr_task.start = <span class="number">0</span>;</span><br><span class="line">fr_task.length = <span class="number">4</span>;</span><br><span class="line">fr_task.format = f;</span><br><span class="line"></span><br><span class="line">f.<span class="built_in">setFontItalic</span>(<span class="literal">true</span>);</span><br><span class="line">f.<span class="built_in">setBackground</span>(Qt::darkYellow);</span><br><span class="line">f.<span class="built_in">setForeground</span>(Qt::white);</span><br><span class="line">QTextLayout::FormatRange fr_tracker;</span><br><span class="line">fr_tracker.start = <span class="number">5</span>;</span><br><span class="line">fr_tracker.length = <span class="number">7</span>;</span><br><span class="line">fr_tracker.format = f;</span><br><span class="line"></span><br><span class="line">formats.<span class="built_in">append</span>(fr_task);</span><br><span class="line">formats.<span class="built_in">append</span>(fr_tracker);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setLineEditTextFormat</span>(lineEdit, formats);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QLineEdit </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>QAction Icon 大小问题</title>
      <link href="/Code/Qt/QAction%20Icon%20%E5%A4%A7%E5%B0%8F/"/>
      <url>/Code/Qt/QAction%20Icon%20%E5%A4%A7%E5%B0%8F/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><blockquote><p>右键托盘弹出菜单，这个菜单是是通过 <code>QMenu</code> 实现的，通过添加 <code>QAction</code> 实现了几个子项。后续 UI 优化，提出需要修改 Icon的大小，设置 Icon 的大小为 <code>24*24</code>，遂进行了一番尝试，因影响颇多，暂且记录于此。</p></blockquote><p>关于我这个右键托盘弹出选项框的肯定有别的方案，但是第一时间是想找一种比较简单的方案去实现，因此一直在搜索如何设置Icon大小的问题，目前看到的解决方案有以下几种：</p><ol><li>通过设置 <code>Style</code> 实现</li><li>通过 <code>QWidgetAction</code> 实现</li><li>新建一个 <code>Widget</code>，实现 <code>QMenu</code> 的效果</li></ol><h1 id="1-通过设置-Style，修改icon-size"><a href="#1-通过设置-Style，修改icon-size" class="headerlink" title="1 通过设置 Style，修改icon size"></a>1 通过设置 Style，修改icon size</h1><ol><li>新建样式类</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCommonStyle&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QStyleOption&gt;</span></span></span><br><span class="line"><span class="comment">// 自定义一个style类，通过setStyle设置给menu，以此设置iconsize</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QCustonIconStyle</span> : <span class="keyword">public</span> QCommonStyle</span><br><span class="line">&#123;</span><br><span class="line">Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">QCustonIconStyle</span>(<span class="type">int</span> size)</span><br><span class="line">: <span class="built_in">QCommonStyle</span>(), <span class="built_in">size_</span>(size) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">QCustonIconStyle::pixelMetric</span><span class="params">(PixelMetric metric, <span class="type">const</span> QStyleOption* option, <span class="type">const</span> QWidget* widget)</span> <span class="type">const</span>  <span class="keyword">override</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (metric == QStyle::PM_SmallIconSize) &#123;</span><br><span class="line"><span class="keyword">return</span> size_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">        <span class="comment">// 一下内容是我尝试修改UI的，改了size之后会导致icon移位，需要修改间距和边距</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (metric == QStyle::PM_LayoutLeftMargin)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (metric == QStyle::PM_MenuHMargin)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (metric == QStyle::PM_LayoutHorizontalSpacing)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> QCommonStyle::<span class="built_in">pixelMetric</span>(metric, option, widget);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> size_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>使用方法：</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QCustonIconStyle* style = <span class="keyword">new</span> <span class="built_in">QCustonIconStyle</span>(<span class="number">20</span>);</span><br><span class="line">QMenu-&gt;<span class="built_in">setStyle</span>(style);</span><br></pre></td></tr></table></figure><ol start="3"><li><p>遗留问题，使用该方法之后，<code>QAction</code>的 <code>horverd()</code> 信号就不会触发了</p><blockquote><p>关于这个问题的解决方法也很简单，尝试了一天，最终选择继承重写 <code>QProxyStyle</code> 就能解决这个问题。</p></blockquote></li></ol><h1 id="2-使用-QWidgetAction"><a href="#2-使用-QWidgetAction" class="headerlink" title="2 使用 QWidgetAction"></a>2 使用 QWidgetAction</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">action_ = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(menu);</span><br><span class="line">QWidgetAction* action = <span class="keyword">new</span> <span class="built_in">QWidgetAction</span>(<span class="keyword">this</span>);</span><br><span class="line">action-&gt;<span class="built_in">setDefaultWidget</span>(action_ );</span><br><span class="line">menu-&gt;<span class="built_in">addAction</span>(action);</span><br></pre></td></tr></table></figure><h1 id="3-新建界面"><a href="#3-新建界面" class="headerlink" title="3 新建界面"></a>3 新建界面</h1>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>QLineEdit 修改密码模式及其样式</title>
      <link href="/Code/Qt/QLineEdit/QLineEdit%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E6%98%BE%E7%A4%BA%E5%8F%8A%E5%85%B6%E6%98%BE%E7%A4%BA%E6%A0%B7%E5%BC%8F/"/>
      <url>/Code/Qt/QLineEdit/QLineEdit%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E6%98%BE%E7%A4%BA%E5%8F%8A%E5%85%B6%E6%98%BE%E7%A4%BA%E6%A0%B7%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="Qt设置为密码模式"><a href="#Qt设置为密码模式" class="headerlink" title="Qt设置为密码模式"></a>Qt设置为密码模式</h2><p>参考 <code>QLineEdit::setEchoMode</code>。密码模式总共有两种</p><ul><li>QLineEdit::Password</li><li>QLineEdit::PasswordEchoOnEdit</li></ul><h2 id="修改样式"><a href="#修改样式" class="headerlink" title="修改样式"></a>修改样式</h2><p>QLineEdit 密码样式使用 Unicode 字符表示,<br>密码样式修改在QLineEdit::Password 、QLineEdit::PasswordEchoOnEdit 有效<br><a href="https://unicode-table.com/cn/search/">Unicode 值查询网址： https://unicode-table.com/cn/search/</a></p><h3 id="1-默认样式"><a href="#1-默认样式" class="headerlink" title="1. 默认样式"></a>1. 默认样式</h3><p>默认样式是实心圆点 ，Unicode值 9769</p><h3 id="2-自定义样式"><a href="#2-自定义样式" class="headerlink" title="2. 自定义样式"></a>2. 自定义样式</h3><p>参考  <code>Qt 助手</code> 中的提升，搜索 <code>Qt Style Sheets Examples</code> 中关于 <code>QLineEdit</code> 的提示设置即可。</p><p><code>*</code> 的 unicode 编码为 9679。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">QLineEdit[echoMode=<span class="string">&quot;2&quot;</span>] &#123;</span><br><span class="line">      lineedit-password-character: <span class="number">9679</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Qt </category>
          
          <category> QLineEdit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> QLineEdit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/Python/python%E8%A7%A3%E6%9E%90Json/"/>
      <url>/Code/Python/python%E8%A7%A3%E6%9E%90Json/</url>
      
        <content type="html"><![CDATA[<h2 id="解析Json的常见代码"><a href="#解析Json的常见代码" class="headerlink" title="解析Json的常见代码"></a>解析Json的常见代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json <span class="comment"># 导入json解析需要的包</span></span><br></pre></td></tr></table></figure><h3 id="1-json-loads-读取字符串到json-object"><a href="#1-json-loads-读取字符串到json-object" class="headerlink" title="1. json.loads()读取字符串到json object"></a>1. <code>json.loads()</code>读取字符串到<code>json object</code></h3><p><code>json.loads()</code>是将<code>str\bytes\bytearray</code>等格式的文件读取到<code>json object</code>中。但是在使用的时候往往会因为一些小问题导致读取错误等。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Docstring:</span><br><span class="line">Deserialize ``s`` (a ``str``, ``bytes`` or ``bytearray`` instance</span><br><span class="line">containing a JSON document) to a Python object.</span><br><span class="line"></span><br><span class="line">``object_hook`` is an optional function that will be called with the</span><br><span class="line">result of any object literal decode (a ``dict``). The return value of</span><br><span class="line">``object_hook`` will be used instead of the ``dict``. This feature</span><br><span class="line">can be used to implement custom decoders (e.g. JSON-RPC class hinting).</span><br><span class="line"></span><br><span class="line">``object_pairs_hook`` is an optional function that will be called with the</span><br><span class="line">result of any object literal decoded with an ordered list of pairs.  The</span><br><span class="line">return value of ``object_pairs_hook`` will be used instead of the ``dict``.</span><br><span class="line">This feature can be used to implement custom decoders.  If ``object_hook``</span><br><span class="line">is also defined, the ``object_pairs_hook`` takes priority.</span><br><span class="line"></span><br><span class="line">``parse_float``, if specified, will be called with the string</span><br><span class="line">of every JSON float to be decoded. By default this is equivalent to</span><br><span class="line">float(num_str). This can be used to use another datatype or parser</span><br><span class="line">for JSON floats (e.g. decimal.Decimal).</span><br><span class="line"></span><br><span class="line">``parse_int``, if specified, will be called with the string</span><br><span class="line">of every JSON int to be decoded. By default this is equivalent to</span><br><span class="line">int(num_str). This can be used to use another datatype or parser</span><br><span class="line">for JSON integers (e.g. float).</span><br><span class="line"></span><br><span class="line">``parse_constant``, if specified, will be called with one of the</span><br><span class="line">following strings: -Infinity, Infinity, NaN.</span><br><span class="line">This can be used to raise an exception if invalid JSON numbers</span><br><span class="line">are encountered.</span><br><span class="line"></span><br><span class="line">To use a custom ``JSONDecoder`` subclass, specify it with the ``cls``</span><br><span class="line">kwarg; otherwise ``JSONDecoder`` is used.</span><br></pre></td></tr></table></figure></blockquote><p><b><span style="class: faa-bounce animated-hover;border-bottom: 5px solid #8F81EF;"><a href="https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA">data.json文件链接</a></span></b></p><blockquote><p>链接：<a href="https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA">https://pan.baidu.com/s/1omzU65YMpJr0jPPFItZ7SA</a><br>提取码：ysly<br>复制这段内容后打开百度网盘手机App，操作更方便哦</p></blockquote><p>上述文件相对常见的Json文件来说，还是有点区别的，用python的json库操作相对有点困难。</p><p>报错<code>Expection \，delimiter</code>，看了好些解决办法仍然没能成功解决：<i id='1'></i></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 输入文件</span><br><span class="line">&#123;&#x27;asin&#x27;: &#x27;0000032069&#x27;, &#x27;title&#x27;: &#x27;Adult Ballet Tutu Cheetah Pink&#x27;, &#x27;price&#x27;: 7.89, &#x27;imUrl&#x27;: &#x27;http://ecx.images-amazon.com/images/I/51EzU6quNML._SX342_.jpg&#x27;, &#x27;related&#x27;: &#123;&#x27;also_bought&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;0000032034&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00EXVN9PU&#x27;, &#x27;B0041EOTJO&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B001GTKPDQ&#x27;, &#x27;B00EON0SJ2&#x27;, &#x27;B005HMHOQ4&#x27;, &#x27;B002XZMGGQ&#x27;], &#x27;also_viewed&#x27;: [&#x27;B00D0F450I&#x27;, &#x27;0000032050&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;0000032042&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B00JHNSNSM&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B0071KR2LC&#x27;, &#x27;B00GOR07RE&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B005F50FXC&#x27;, &#x27;B0079MCIMU&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00H3RYN3I&#x27;, &#x27;B005C4Y4F6&#x27;, &#x27;B007IEFT84&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B00FNNFXAG&#x27;, &#x27;B007R2RM8W&#x27;, &#x27;B007VM3AMK&#x27;, &#x27;B00C0PLENA&#x27;, &#x27;B00BJGG6VG&#x27;, &#x27;B00E1YRI4C&#x27;, &#x27;B00IIK61WA&#x27;, &#x27;B009UC638W&#x27;, &#x27;B00KZN6RVI&#x27;, &#x27;B00CSFEENY&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00HSOJJ94&#x27;, &#x27;B00LIPP4VG&#x27;, &#x27;B009RXWNSI&#x27;, &#x27;B00E87F196&#x27;, &#x27;B005HMHOQY&#x27;, &#x27;B00J6S9MSS&#x27;, &#x27;0000032034&#x27;, &#x27;B00CJQGNJK&#x27;, &#x27;B008FCA0F0&#x27;, &#x27;B0056LG7GY&#x27;, &#x27;B00DPQWCZ2&#x27;, &#x27;B00I3PV0US&#x27;, &#x27;B00KZN6IVW&#x27;, &#x27;B0054TBWKO&#x27;, &#x27;B00I2S01I8&#x27;, &#x27;B00BXF12P8&#x27;, &#x27;B00GVHU678&#x27;, &#x27;B005NWENGC&#x27;, &#x27;B003AVKOP2&#x27;, &#x27;B00JK8MQ4Q&#x27;, &#x27;B00FZIMVQS&#x27;, &#x27;B008BB19VE&#x27;, &#x27;B00GTEXPOE&#x27;, &#x27;B009WPT2RQ&#x27;, &#x27;B00E37SBBG&#x27;], &#x27;bought_together&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;]&#125;, &#x27;brand&#x27;: &#x27;BubuBibi&#x27;, &#x27;categories&#x27;: [[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;, &#x27;Clothing&#x27;, &#x27;Girls&#x27;, &#x27;Skirts&#x27;]]&#125;</span><br><span class="line">&#123;&#x27;asin&#x27;: &#x27;0000031909&#x27;, &#x27;related&#x27;: &#123;&#x27;also_bought&#x27;: [&#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;0000031895&#x27;, &#x27;B00D2K1M3O&#x27;, &#x27;0000031852&#x27;, &#x27;B00D0WDS9A&#x27;, &#x27;B00D10CLVW&#x27;, &#x27;B00D103F8U&#x27;, &#x27;B003AVEU6G&#x27;, &#x27;B00D2K0PA0&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00D0ZF44Y&#x27;, &#x27;B008F0SMUC&#x27;, &#x27;B00D0GCI8S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B002YSCPZY&#x27;, &#x27;0448408775&#x27;, &#x27;B002R0FABA&#x27;, &#x27;B008GHWNWC&#x27;, &#x27;B002R0FA24&#x27;, &#x27;B001GTKPEK&#x27;, &#x27;B006XA7KZO&#x27;, &#x27;B001GZUQ9S&#x27;, &#x27;B00613VNL0&#x27;, &#x27;B003IEDM9Q&#x27;, &#x27;B003LTOZK8&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B008UBQZKU&#x27;, &#x27;B001AQD8VQ&#x27;, &#x27;B003ILA0L2&#x27;, &#x27;B00AFDOPDA&#x27;, &#x27;B002R0F7FE&#x27;], &#x27;also_viewed&#x27;: [&#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B00E1YRI4C&#x27;, &#x27;B00AFDOPDA&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00CEUWY8K&#x27;, &#x27;B003IEDM9Q&#x27;, &#x27;B00HSOJB9M&#x27;, &#x27;0000031895&#x27;, &#x27;B003AVKOP2&#x27;, &#x27;B005C4Y4F6&#x27;, &#x27;B008F0SMUC&#x27;, &#x27;B00362QGW0&#x27;, &#x27;B008UD01L2&#x27;, &#x27;B00FAZ5ZE6&#x27;, &#x27;B008F0SY6O&#x27;, &#x27;B00DPLLQR2&#x27;, &#x27;B00CEUWUZC&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B00CEUX0D8&#x27;, &#x27;B00JHNSNSM&#x27;, &#x27;B00D10CLVW&#x27;, &#x27;B00D23MC6W&#x27;, &#x27;B007XAI53E&#x27;, &#x27;B008X6CBS2&#x27;, &#x27;B004PEI45U&#x27;, &#x27;B005HMHOQ4&#x27;, &#x27;B002C3Y6WG&#x27;, &#x27;B00HSC8O74&#x27;, &#x27;B008BMGHM4&#x27;, &#x27;B00CEUWTFS&#x27;, &#x27;B00FNNFXAG&#x27;, &#x27;B00CYBU84G&#x27;, &#x27;B00D9C32NI&#x27;, &#x27;B0046W9T8C&#x27;, &#x27;B008UBG5IW&#x27;, &#x27;B001YHX45G&#x27;, &#x27;B00CEV8366&#x27;, &#x27;B00I2UHSZA&#x27;, &#x27;B009RXWNSI&#x27;, &#x27;B008FCA0F0&#x27;, &#x27;B001GTKPEK&#x27;, &#x27;B004TU1VPU&#x27;, &#x27;B00CBPIO7S&#x27;, &#x27;B00CHHXJ0M&#x27;, &#x27;B00538F5OK&#x27;, &#x27;B005F50FXC&#x27;, &#x27;B00CEUX4QQ&#x27;, &#x27;B003XRKA7A&#x27;, &#x27;0000031852&#x27;, &#x27;B002C3R5XI&#x27;, &#x27;B00C6Q1Z6E&#x27;], &#x27;bought_together&#x27;: [&#x27;B002BZX8Z6&#x27;]&#125;, &#x27;title&#x27;: &#x27;Girls Ballet Tutu Neon Pink&#x27;, &#x27;price&#x27;: 7.0, &#x27;salesRank&#x27;: &#123;&#x27;Toys &amp; Games&#x27;: 201847&#125;, &#x27;imUrl&#x27;: &#x27;http://ecx.images-amazon.com/images/I/41xBoP0FVzL._SY300_.jpg&#x27;, &#x27;brand&#x27;: &#x27;Unknown&#x27;, &#x27;categories&#x27;: [[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;]], &#x27;description&#x27;: &#x27;High quality 3 layer ballet tutu. 12 inches in length&#x27;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常见的Json读取</span></span><br><span class="line">JsonText = <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># 打开data.json</span></span><br><span class="line">Json = JsonText.readlines() <span class="comment"># 把json中的文件全部读取到Json对象中。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取上述data.json为json对象的代码</span></span><br><span class="line">list_data = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_Json_file</span>(<span class="params">i,x</span>):</span><br><span class="line">    <span class="comment"># 返回有效的Json字段</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第&quot;</span> + i + <span class="string">&quot;行:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="comment"># 关于expectint的报错，我这处理就是但凡报错，直接返回空字段，如果你有别的解决办法，一定指教一下，不胜感激</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        JsonStr = x.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>).replace(<span class="string">&#x27;/ &#x27;</span>, <span class="string">&#x27;/&#x27;</span>).replace(<span class="string">&#x27;, &#x27;</span>,<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        ret = json.loads(JsonStr,strict=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;categories&#x27;</span> <span class="keyword">in</span> ret):</span><br><span class="line">        <span class="built_in">print</span>(ret[<span class="string">&#x27;categories&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> ret[<span class="string">&#x27;categories&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">    </span><br><span class="line">list_data = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(Json)):</span><br><span class="line">list_data.append(read_Json_file(<span class="built_in">str</span>(i+<span class="number">1</span>),Json[i]))</span><br></pre></td></tr></table></figure><h3 id="程序输出"><a href="#程序输出" class="headerlink" title="程序输出"></a>程序输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">第1行:</span><br><span class="line">&#123;&#x27;asin&#x27;: &#x27;0000032069&#x27;, &#x27;title&#x27;: &#x27;Adult Ballet Tutu Cheetah Pink&#x27;, &#x27;price&#x27;: 7.89, &#x27;imUrl&#x27;: &#x27;http://ecx.images-amazon.com/images/I/51EzU6quNML._SX342_.jpg&#x27;, &#x27;related&#x27;: &#123;&#x27;also_bought&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;0000032034&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00EXVN9PU&#x27;, &#x27;B0041EOTJO&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B001GTKPDQ&#x27;, &#x27;B00EON0SJ2&#x27;, &#x27;B005HMHOQ4&#x27;, &#x27;B002XZMGGQ&#x27;], &#x27;also_viewed&#x27;: [&#x27;B00D0F450I&#x27;, &#x27;0000032050&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;0000032042&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B00JHNSNSM&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B0071KR2LC&#x27;, &#x27;B00GOR07RE&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B005F50FXC&#x27;, &#x27;B0079MCIMU&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00H3RYN3I&#x27;, &#x27;B005C4Y4F6&#x27;, &#x27;B007IEFT84&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B00FNNFXAG&#x27;, &#x27;B007R2RM8W&#x27;, &#x27;B007VM3AMK&#x27;, &#x27;B00C0PLENA&#x27;, &#x27;B00BJGG6VG&#x27;, &#x27;B00E1YRI4C&#x27;, &#x27;B00IIK61WA&#x27;, &#x27;B009UC638W&#x27;, &#x27;B00KZN6RVI&#x27;, &#x27;B00CSFEENY&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00HSOJJ94&#x27;, &#x27;B00LIPP4VG&#x27;, &#x27;B009RXWNSI&#x27;, &#x27;B00E87F196&#x27;, &#x27;B005HMHOQY&#x27;, &#x27;B00J6S9MSS&#x27;, &#x27;0000032034&#x27;, &#x27;B00CJQGNJK&#x27;, &#x27;B008FCA0F0&#x27;, &#x27;B0056LG7GY&#x27;, &#x27;B00DPQWCZ2&#x27;, &#x27;B00I3PV0US&#x27;, &#x27;B00KZN6IVW&#x27;, &#x27;B0054TBWKO&#x27;, &#x27;B00I2S01I8&#x27;, &#x27;B00BXF12P8&#x27;, &#x27;B00GVHU678&#x27;, &#x27;B005NWENGC&#x27;, &#x27;B003AVKOP2&#x27;, &#x27;B00JK8MQ4Q&#x27;, &#x27;B00FZIMVQS&#x27;, &#x27;B008BB19VE&#x27;, &#x27;B00GTEXPOE&#x27;, &#x27;B009WPT2RQ&#x27;, &#x27;B00E37SBBG&#x27;], &#x27;bought_together&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;]&#125;, &#x27;brand&#x27;: &#x27;BubuBibi&#x27;, &#x27;categories&#x27;: [[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;, &#x27;Clothing&#x27;, &#x27;Girls&#x27;, &#x27;Skirts&#x27;]]&#125;</span><br><span class="line"></span><br><span class="line">[[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;, &#x27;Clothing&#x27;, &#x27;Girls&#x27;, &#x27;Skirts&#x27;]]</span><br><span class="line">第2行:</span><br><span class="line">&#123;&#x27;asin&#x27;: &#x27;0000031909&#x27;, &#x27;related&#x27;: &#123;&#x27;also_bought&#x27;: [&#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;0000031895&#x27;, &#x27;B00D2K1M3O&#x27;, &#x27;0000031852&#x27;, &#x27;B00D0WDS9A&#x27;, &#x27;B00D10CLVW&#x27;, &#x27;B00D103F8U&#x27;, &#x27;B003AVEU6G&#x27;, &#x27;B00D2K0PA0&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00D0ZF44Y&#x27;, &#x27;B008F0SMUC&#x27;, &#x27;B00D0GCI8S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B002YSCPZY&#x27;, &#x27;0448408775&#x27;, &#x27;B002R0FABA&#x27;, &#x27;B008GHWNWC&#x27;, &#x27;B002R0FA24&#x27;, &#x27;B001GTKPEK&#x27;, &#x27;B006XA7KZO&#x27;, &#x27;B001GZUQ9S&#x27;, &#x27;B00613VNL0&#x27;, &#x27;B003IEDM9Q&#x27;, &#x27;B003LTOZK8&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B008UBQZKU&#x27;, &#x27;B001AQD8VQ&#x27;, &#x27;B003ILA0L2&#x27;, &#x27;B00AFDOPDA&#x27;, &#x27;B002R0F7FE&#x27;], &#x27;also_viewed&#x27;: [&#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B00E1YRI4C&#x27;, &#x27;B00AFDOPDA&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00CEUWY8K&#x27;, &#x27;B003IEDM9Q&#x27;, &#x27;B00HSOJB9M&#x27;, &#x27;0000031895&#x27;, &#x27;B003AVKOP2&#x27;, &#x27;B005C4Y4F6&#x27;, &#x27;B008F0SMUC&#x27;, &#x27;B00362QGW0&#x27;, &#x27;B008UD01L2&#x27;, &#x27;B00FAZ5ZE6&#x27;, &#x27;B008F0SY6O&#x27;, &#x27;B00DPLLQR2&#x27;, &#x27;B00CEUWUZC&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B00CEUX0D8&#x27;, &#x27;B00JHNSNSM&#x27;, &#x27;B00D10CLVW&#x27;, &#x27;B00D23MC6W&#x27;, &#x27;B007XAI53E&#x27;, &#x27;B008X6CBS2&#x27;, &#x27;B004PEI45U&#x27;, &#x27;B005HMHOQ4&#x27;, &#x27;B002C3Y6WG&#x27;, &#x27;B00HSC8O74&#x27;, &#x27;B008BMGHM4&#x27;, &#x27;B00CEUWTFS&#x27;, &#x27;B00FNNFXAG&#x27;, &#x27;B00CYBU84G&#x27;, &#x27;B00D9C32NI&#x27;, &#x27;B0046W9T8C&#x27;, &#x27;B008UBG5IW&#x27;, &#x27;B001YHX45G&#x27;, &#x27;B00CEV8366&#x27;, &#x27;B00I2UHSZA&#x27;, &#x27;B009RXWNSI&#x27;, &#x27;B008FCA0F0&#x27;, &#x27;B001GTKPEK&#x27;, &#x27;B004TU1VPU&#x27;, &#x27;B00CBPIO7S&#x27;, &#x27;B00CHHXJ0M&#x27;, &#x27;B00538F5OK&#x27;, &#x27;B005F50FXC&#x27;, &#x27;B00CEUX4QQ&#x27;, &#x27;B003XRKA7A&#x27;, &#x27;0000031852&#x27;, &#x27;B002C3R5XI&#x27;, &#x27;B00C6Q1Z6E&#x27;], &#x27;bought_together&#x27;: [&#x27;B002BZX8Z6&#x27;]&#125;, &#x27;title&#x27;: &#x27;Girls Ballet Tutu Neon Pink&#x27;, &#x27;price&#x27;: 7.0, &#x27;salesRank&#x27;: &#123;&#x27;Toys &amp; Games&#x27;: 201847&#125;, &#x27;imUrl&#x27;: &#x27;http://ecx.images-amazon.com/images/I/41xBoP0FVzL._SY300_.jpg&#x27;, &#x27;brand&#x27;: &#x27;Unknown&#x27;, &#x27;categories&#x27;: [[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;]], &#x27;description&#x27;: &#x27;High quality 3 layer ballet tutu. 12 inches in length&#x27;&#125;</span><br><span class="line"></span><br><span class="line">[[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;]]</span><br></pre></td></tr></table></figure><p>打印了json中<code>categories</code>对象的值：</p><blockquote><p>[[‘Sports &amp; Outdoors’,<br>   ‘Other Sports’,<br>   ‘Dance’,<br>   ‘Clothing’,<br>   ‘Girls’,<br>   ‘Skirts’]],<br> [[‘Sports &amp; Outdoors’, ‘Other Sports’, ‘Dance’]],<br> [[‘Sports &amp; Outdoors’,<br>   ‘Other Sports’,<br>   ‘Dance’,<br>   ‘Clothing’,<br>   ‘Girls’,<br>   ‘Skirts’]]</p></blockquote><h3 id="2-常见错误及解决办法"><a href="#2-常见错误及解决办法" class="headerlink" title="2. 常见错误及解决办法"></a>2. 常见错误及解决办法</h3><ol><li><code>Expecting property name enclosed in double quotes: line 1 column 2 (char 1)</code></li></ol><!-- tab 描述 --><p>Json文件的单双引号不对，如下所示Python中的一个<code>str</code>，Json中的<code>Key值</code>都是用单引号<code>&#39;</code>括起来的，就会报错<code>Expecting property name enclosed in double quotes</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;&#x27;asin&#x27;: &#x27;0000032069&#x27;, &#x27;title&#x27;: &#x27;Adult Ballet Tutu Cheetah Pink&#x27;, &#x27;price&#x27;: 7.89, &#x27;imUrl&#x27;: &#x27;http://ecx.images-amazon.com/images/I/51EzU6quNML._SX342_.jpg&#x27;, &#x27;related&#x27;: &#123;&#x27;also_bought&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;0000032034&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00EXVN9PU&#x27;, &#x27;B0041EOTJO&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B001GTKPDQ&#x27;, &#x27;B00EON0SJ2&#x27;, &#x27;B005HMHOQ4&#x27;, &#x27;B002XZMGGQ&#x27;], &#x27;also_viewed&#x27;: [&#x27;B00D0F450I&#x27;, &#x27;0000032050&#x27;, &#x27;B00D2JTMS2&#x27;, &#x27;0000032042&#x27;, &#x27;B004PYEE8G&#x27;, &#x27;B00JHNSNSM&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;B00D2JSRFQ&#x27;, &#x27;B00D0FCQQI&#x27;, &#x27;B00D2JRWWA&#x27;, &#x27;B003AVNY6I&#x27;, &#x27;B0071KR2LC&#x27;, &#x27;B00GOR07RE&#x27;, &#x27;B00D0FIIJM&#x27;, &#x27;B005F50FXC&#x27;, &#x27;B0079MCIMU&#x27;, &#x27;B00D0FDUAY&#x27;, &#x27;B00H3RYN3I&#x27;, &#x27;B005C4Y4F6&#x27;, &#x27;B007IEFT84&#x27;, &#x27;B00D0D5F6S&#x27;, &#x27;B002BZX8Z6&#x27;, &#x27;B00JHONN1S&#x27;, &#x27;B008F0SU0Y&#x27;, &#x27;B00FNNFXAG&#x27;, &#x27;B007R2RM8W&#x27;, &#x27;B007VM3AMK&#x27;, &#x27;B00C0PLENA&#x27;, &#x27;B00BJGG6VG&#x27;, &#x27;B00E1YRI4C&#x27;, &#x27;B00IIK61WA&#x27;, &#x27;B009UC638W&#x27;, &#x27;B00KZN6RVI&#x27;, &#x27;B00CSFEENY&#x27;, &#x27;B002GZGI4E&#x27;, &#x27;B00HSOJJ94&#x27;, &#x27;B00LIPP4VG&#x27;, &#x27;B009RXWNSI&#x27;, &#x27;B00E87F196&#x27;, &#x27;B005HMHOQY&#x27;, &#x27;B00J6S9MSS&#x27;, &#x27;0000032034&#x27;, &#x27;B00CJQGNJK&#x27;, &#x27;B008FCA0F0&#x27;, &#x27;B0056LG7GY&#x27;, &#x27;B00DPQWCZ2&#x27;, &#x27;B00I3PV0US&#x27;, &#x27;B00KZN6IVW&#x27;, &#x27;B0054TBWKO&#x27;, &#x27;B00I2S01I8&#x27;, &#x27;B00BXF12P8&#x27;, &#x27;B00GVHU678&#x27;, &#x27;B005NWENGC&#x27;, &#x27;B003AVKOP2&#x27;, &#x27;B00JK8MQ4Q&#x27;, &#x27;B00FZIMVQS&#x27;, &#x27;B008BB19VE&#x27;, &#x27;B00GTEXPOE&#x27;, &#x27;B009WPT2RQ&#x27;, &#x27;B00E37SBBG&#x27;], &#x27;bought_together&#x27;: [&#x27;0000032050&#x27;, &#x27;B00D0DJAEG&#x27;, &#x27;0000032042&#x27;, &#x27;B00D0F450I&#x27;]&#125;, &#x27;brand&#x27;: &#x27;BubuBibi&#x27;, &#x27;categories&#x27;: [[&#x27;Sports &amp; Outdoors&#x27;, &#x27;Other Sports&#x27;, &#x27;Dance&#x27;, &#x27;Clothing&#x27;, &#x27;Girls&#x27;, &#x27;Skirts&#x27;]]&#125;&quot;</span></span><br></pre></td></tr></table></figure><!-- endtab --><!-- tab 解决办法 --><p>替换掉<code>str</code>中的<code>&#39;</code>为<code>&quot;</code>，替换<code>/_（空格）</code>为<code>/</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>).replace(<span class="string">&#x27;/ &#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br></pre></td></tr></table></figure><p>再接着读取就不会报错了！！！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JsonValue[<span class="string">&#x27;categories&#x27;</span>]</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">[</span>&#x27;Sports &amp; Outdoors&#x27;<span class="punctuation">,</span> &#x27;Other Sports&#x27;<span class="punctuation">,</span> &#x27;Dance&#x27;<span class="punctuation">,</span> &#x27;Clothing&#x27;<span class="punctuation">,</span> &#x27;Girls&#x27;<span class="punctuation">,</span> &#x27;Skirts&#x27;<span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><!-- endtab --><ol start="2"><li><code>expecting , delimiter</code></li></ol><!-- tab 描述 --><p>这个问题真的被搞得头疼，到目前还没解决，<code>Json</code>字段是没有问题的，但是<code>loads()函数</code>就是会报错</p><!-- endtab --><!-- tab 问题解决 --><p><a href="#1">解决办法</a></p><!-- endtab -->]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>python 开启http服务</title>
      <link href="/Code/Python/python%E5%BC%80%E5%90%AFhttp%E6%9C%8D%E5%8A%A1/"/>
      <url>/Code/Python/python%E5%BC%80%E5%90%AFhttp%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：使用python开启http服务</p></blockquote><p>[toc]</p><h1 id="python-开启-http-服务"><a href="#python-开启-http-服务" class="headerlink" title="python 开启 http 服务"></a>python 开启 http 服务</h1><p>在需要开启http服务的文件件运行一下命令即可：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer <span class="number">8080</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">python -m http.server <span class="number">8080</span></span><br></pre></td></tr></table></figure><p><img src="/images/python%E5%BC%80%E5%90%AFhttp%E6%9C%8D%E5%8A%A1/image-20230815123001895.png" alt="image-20230815123001895"></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 界面实现 Gui 界面自动输入</title>
      <link href="/Code/Python/gui%E7%95%8C%E9%9D%A2%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5/"/>
      <url>/Code/Python/gui%E7%95%8C%E9%9D%A2%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>开发过程中使用后台时，每次都需要输入用户名和密码，很麻烦，尝试解决这个麻烦的过程中使用了 pyautogui 这个库，整理记录一下，实际登录web网站时，自动输入还有别的方法，可以使用油猴脚本实现，详见文末<a href="#%E6%B2%B9%E7%8C%B4">使用油猴自动登录网站</a>。</p></blockquote><p>[toc]</p><h1 id="使用-python-实现-Gui-自动登录"><a href="#使用-python-实现-Gui-自动登录" class="headerlink" title="使用 python 实现 Gui 自动登录"></a>使用 python 实现 Gui 自动登录</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>界面主动输入 <code>admin</code> 后跳转到密码栏再自动输入  <code>Admin@2022</code></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>主要是使用 pyautogui 库， pyautogui封装了界面的相关操作，包括鼠标和键盘事件。</p><p><a href="../../../Demo/Python/%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5/tacInputTest.py">源码</a></p><ol><li><code>pyautogui.typewrite</code> 可以模拟输入字符的输入</li><li><code>pyautogui.press</code> 可以模拟其他操作类型的键的输入</li></ol><p>基于以上两点，我们只需要构建一个输入的队列，然后遍历队列执行响应的操作即可</p><h3 id="构建输入队列"><a href="#构建输入队列" class="headerlink" title="构建输入队列"></a>构建输入队列</h3><p>队列的键值的键值如下所示，先输入需要录入的单词，紧接着执行对应的操作即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;pyautogui.typewrite， pyautogui.press&#125;</span></span><br><span class="line"></span><br><span class="line">tac = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>:<span class="string">&#x27;tab&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Admin@2022&#x27;</span>:<span class="string">&#x27;enter&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wiki = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>:<span class="string">&#x27;tab&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Admin@2022&#x27;</span>:<span class="string">&#x27;enter&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="遍历输入队列"><a href="#遍历输入队列" class="headerlink" title="遍历输入队列"></a>遍历输入队列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> tac:</span><br><span class="line">    <span class="built_in">print</span>(key, <span class="string">&quot;:&quot;</span>, tac[key])</span><br><span class="line">    pyautogui.typewrite(key, interval=interval)</span><br><span class="line">    pyautogui.press(tac[key], interval=interval)</span><br></pre></td></tr></table></figure><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">python -m PyInstaller -F -w  -n auto_input ./auto_input.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> pyautogui</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制速度</span></span><br><span class="line">interval = <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line">tac = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>:<span class="string">&#x27;tab&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Admin@2022&#x27;</span>:<span class="string">&#x27;enter&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wiki = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>:<span class="string">&#x27;tab&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Admin@2022&#x27;</span>:<span class="string">&#x27;enter&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text_alert = <span class="string">&quot;&quot;&quot;开始前请确保完成以下操作</span></span><br><span class="line"><span class="string">    1. 请切换为英文输入法</span></span><br><span class="line"><span class="string">    2. 请打开输入界面</span></span><br><span class="line"><span class="string">    3. 将光标放至开始输入的位置</span></span><br><span class="line"><span class="string">    4. 选择要输入的代码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> codes</span><br><span class="line">    option = pyautogui.confirm(text=text_alert, title=<span class="string">&#x27;自动输入小工具&#x27;</span>, buttons=[<span class="string">&#x27;tac&#x27;</span>,<span class="string">&#x27;wiki&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> option == <span class="string">&#x27;tac&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> tac:</span><br><span class="line">            <span class="built_in">print</span>(key, <span class="string">&quot;:&quot;</span>, tac[key])</span><br><span class="line">            pyautogui.typewrite(key, interval=interval)</span><br><span class="line">            pyautogui.press(tac[key], interval=interval)</span><br><span class="line">    <span class="keyword">elif</span> option == <span class="string">&#x27;wiki&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> tac:</span><br><span class="line">            <span class="built_in">print</span>(key, <span class="string">&quot;:&quot;</span>, wiki[key])</span><br><span class="line">            pyautogui.typewrite(key, interval=interval)</span><br><span class="line">            pyautogui.press(wiki[key], interval=interval)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web网站使用油猴脚本实现自动登录"><a href="#web网站使用油猴脚本实现自动登录" class="headerlink" title="web网站使用油猴脚本实现自动登录"></a><a id="油猴"></a>web网站使用油猴脚本实现自动登录</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         零信任TAC一键登录</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       BladeHiker</span></span><br><span class="line"><span class="comment">// @match        https://*/admin/*</span></span><br><span class="line"><span class="comment">// @match        https://*/tap/admin/*</span></span><br><span class="line"><span class="comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=57.171</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="function">() =&gt;</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>==<span class="string">&#x27;/admin/login&#x27;</span>)&#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>].<span class="property">value</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].<span class="property">value</span> = <span class="string">&#x27;Admin@2022&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">InputEvent</span>(<span class="string">&quot;input&quot;</span>))</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">InputEvent</span>(<span class="string">&quot;input&quot;</span>))</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;button&quot;</span>)[<span class="number">0</span>].<span class="title function_">click</span>()</span><br><span class="line">                &#125;,<span class="number">200</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>==<span class="string">&#x27;/tap/admin/dist/login&#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>].<span class="property">value</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].<span class="property">value</span> = <span class="string">&#x27;admin@1234&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">InputEvent</span>(<span class="string">&quot;input&quot;</span>))</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">InputEvent</span>(<span class="string">&quot;input&quot;</span>))</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;button&quot;</span>)[<span class="number">0</span>].<span class="title function_">click</span>()</span><br><span class="line">                &#125;,<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        &#125;&#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【管道】（一） 初识管道</title>
      <link href="/Code/IPC/%E5%88%9D%E8%AF%86%E7%AE%A1%E9%81%93/"/>
      <url>/Code/IPC/%E5%88%9D%E8%AF%86%E7%AE%A1%E9%81%93/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>自己的理解，</p><p>首先要区分概念：管道和管道通信</p><p>所谓“管道”，是指用于连接一个读进程和一个写进程以实现它们之间通信的一个共享文件，又名pipe文件 （是一种特殊的文件，这就意味着你可以向操作文件一样操作无名管道，无名管道在内核中对应的是一段特殊的内存空间，这段内存空间由操作系统进行管理，对用户是不可见的，在用户空间的应用程序中只能通过系统调用来访问它。在这段内存空间中以循环队列的方式来临时存储一个进程发往另外一个进程的信息，并且在通信完成后就会自动释放相应的空间。）</p><p>而管道通信是消息传递的一种特殊方式。</p><p>即管道是文件，是服务于管道通信的特殊文件，而管道通信是一种通信方式，这种通信方式比较特殊，是半双工的通信方式，即数据只能单向流动，数据传递的方式是字符流形式，它一般是应用在具有共同祖先的进程间使用。</p><ol><li><p>管道通信是什么？      </p><p>用于进程之间通信的一种通信方式。</p></li><li><p>管道通信有哪些特点？</p><p>半双工的通信方式，数据只能单向流动，数据传递的方式是字符流形式。</p></li><li><p>管道通信的应用场合？</p><p>具有共同祖先的进程间使用。</p></li></ol><h1 id="1、什么是管道"><a href="#1、什么是管道" class="headerlink" title="1、什么是管道"></a>1、什么是管道</h1><p>管道：<br>—就像现实中的水管，水就像数据。（连接进程，相当于在进程间连接一个通路，用来传递信息）<br>—管道是一种半双工的通信方式<br>—数据只能单向流动，而且只能在具有共同祖先的进程间使用。</p><p>所谓半双工的模式</p><p>（假设通信双方是甲方和乙方，双工通信方式的意思是甲可以向乙发送数据，乙也可以向甲发送数据，即数据流通是双向的。而半双工的通信方式是指甲乙两方不能同时向对方发送数据，也就是甲向乙发送数据时，乙只能接收不能发送，而乙向甲发送数据时，甲只能接收不能向乙发送数据）</p><p>举个例子：<br>形象来说类似一个单刀双掷开关，有两个选择，但是二者是互斥的，当选择了一方另一方就失效。<br>而对于此处的管道，可以把它想成是管道的一端，一次只能调用一种功能读入或者写入，二者也是互斥的。</p><p>管道通信是消息传递的一种特殊方式，管道机制必须提供以下三方面的协调能力：互斥、同步和确定对方的存在。</p><h1 id="2、为什么要有管道"><a href="#2、为什么要有管道" class="headerlink" title="2、为什么要有管道"></a>2、为什么要有管道</h1><p>在一个多进程操作系统所提供的运行环境下，可以通过两种不同的途径或者说采用两种不同的策略，来建立起复杂的大型应用系统。一种途径就是通过一个孤立的,大型的，复杂的进程提供所需的全部服务，另外一种途径就是通过由若干相互联系的，小型的。相对简单的进程构成的组合来提供所需的功能。早期的操作系统往往倾向与前者，而Unix以及其衍生的各种操作系统往往倾向于后者。相比之下，后者有着各种好处：1.模块化，2.各个进程都得到保护，在相当程度上排除了相互干扰的可能性，3.灵活性更强。<br>当然这种好处也是要付出代价的，也有缺点，但是相比之下，这种途径的优点远远超出了其缺点。<br>Unix（从而Linux）向应用软件提供了一些进程间通信的手段，早期的Unix提供了：管道（pipe），信（signal），跟踪（trace）。</p><p>进程之间的通信，从物理上分，可以分为同主机的进程之间的通信和不同主机间的进程之间的通信。从通信内容方式上分，可以分为数据交互、同步通信、异步通信。</p><p><a href="http://www.2cto.com/os/linux/">Linux 教程</a></p><p>系统进程之间的通信方式大致如下图所示</p><p><img src="/images/%E5%88%9D%E8%AF%86%E7%AE%A1%E9%81%93/Linux-ipc.png" alt="image-20230612092651943"></p><p>集合上述两种从物理和内容方式的划分，可以这样理解上图：</p><p>（1）同主机进程间数据交互机制：无名管道（PIPE）、有名管道（FIFO）、消息队列（Message Queue）和共享<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&spm=1001.2101.3001.7020">内存</a>（Shared Memory）。</p><p>（2）同主机进程间同步通信机制：信号量（Semaphore）。</p><p>（3）同主机进程间异步通信机制：信号（Signal）。</p><p>（4）不同主机间进程数据交互机制：套接字（Socket）、远程调用RPC（Remote Procedure Call）。</p><p><strong>管道通信</strong></p><p>管道又可以分为<strong>无名管道</strong>和<strong>命名管道</strong>，两者的用途是不一样的。</p><p>无名管道PIPE：主要用于具有亲缘关系的进程之间的通信，无名管道的通信是单向的，只能由一段到另外一段；无名管道是临时性的，完成通信后将自动消失。一般采用先创建无名管道，再创建子进程，使子进程继承父进程的管道文件描述符，从而实现父子进程间的通信；在非亲缘关系管道之间，如果想利用无名管道进行通信，则需要借助另外的文件描述符传递机制。</p><p>有名管道FIFO：有名管道是一个实际存在的特殊文件，利用有名管道可以实现同主机任意进程之间的数据交互。</p><p>无名管道是一种特殊的文件，这就意味着你可以向操作文件一样操作无名管道，无名管道在内核中对应的是一段特殊的内存空间，这段内存空间由操作系统进行管理，对用户是不可见的，在用户空间的应用程序中只能通过系统调用来访问它。在这段内存空间中以循环队列的方式来临时存储一个进程发往另外一个进程的信息，并且在通信完成后就会自动释放相应的空间。</p><p>即无名管道主要用于具有亲缘关系的父子进程之间的通信，是临时性的，需要先创建管道，再创建子进程；管道都是单向的，若要实现双向通信，则需要两个管道。命名管道是实际存在的文件，使用前需要先打开，管道默认的read和write操作都是阻塞式的。</p><h1 id="3、如何建立进程间管道？"><a href="#3、如何建立进程间管道？" class="headerlink" title="3、如何建立进程间管道？"></a>3、如何建立进程间管道？</h1><p>这里我们只谈管道：父进程与子进程，或者两个兄弟进程之间，可以通过系统调用建立起一个单向的通信管道。但是，这种管道只能由父进程来建立，所以对于子进程来说是静态的，与生俱来的。管道两端的进程各自将该管道视作一个文件。一个进程往通道中写的内容由另一个进程从通道读出，通过通道传递的内容遵循“先入先出”（FIFO）的规则。每个通道都是单向的，需要双向通信时要建立起两个通道。</p><p>下面说一说进程间管道的建立，在这之前我们要说到fork()函数，在Linux系统中一个新的进程是由一个已经存在的进程“复制”出来的，而不是“创造”出来的（而所谓的“创建”实际上就是复制）。<br>管道机制的主体是系统调用pipe()，但是由pipe（）所建立的管道的两端都在同一个进程中，这样的管道起不到进程间通信的作用。所以必须在fork（）的配合下，才能在父子进程间或者两个子进程之间建立起进程间的通信管道。</p><p>下面就介绍一下怎样将管道用于进程间通信：<br>（1）进程A创建了一个管道，创建完成时代表管道两端的两个已打开文件都在进程A中。</p><p>(2)进程A通过frok（）创建出进程B，在fork（）的过程中进程A的打开文件表按原样复制到进程B中。</p><p>(3)进程A关闭管道的读端，而进程B关闭管道的写段。于是，管道的写段在进程A中而读端在进程B中，成为了父子进程之间的通信管道。</p><p>(4)进程A又通过frok（）创建进程C，而后关闭其管道写段而与管道脱离关系，使得管道的写段在进程C中而读端在进程B中，成为两个兄弟进程之间的管道。</p><p>人们在认识到管道机制也存在一些缺点和不足。由于管道是一种“无名”，“无形”的文件，它可以通过fork（）的过程创建于“近亲” 的进程之间，而不能成为可以在任意两个进程之间建立通信的机制，更不可能成为一种一般的，通用的进程间通信模型，同时，管道机制的这种缺点本身强烈的暗示着人们，只要用“有名”，“有形”的文件来实现管道，就能克服这种缺点。所以有了管道之后，“命名管道”的出现时必然的。<br>为了实现“命名管道”，在“普通文件”，“块设备文件”，“字符设备文件”之外，又设立了一种文件类型，称为FIFO文件。对这种文件的访问严格遵循“先进先出”的原则。这样就可以像在磁盘上建立一个文件一样建立一个命名管道，具体可以使用命令mknod来建立。</p><p>函数介绍：<br>¢int read(intfd, void *buf, int count);<br>—功能：从参数fd指定的读端读取管道数据到大小为count的缓存buf中，返回实际读取到的字节数。<br>—参数<br>¢fd:管道读端<br>¢buf:缓存区，保存读到的数据<br>¢count:读取字节数</p><p>•intwrite(intfd, void *buf, intcount);<br>•功能：向参数fd指定的写端从缓存buf中取出count个字节到管道中，返回值为实际写入的字节数。</p><p>•参数<br>•fd:管道写端<br>•buf:缓存区，将要写入管道的数据<br>•count:写入的字节数</p><p>参考来源：  <a href="http://blog.csdn.net/followingturing/article/details/6071937">http://blog.csdn.net/followingturing/article/details/6071937</a></p><p>​          <a href="http://c.biancheng.net/cpp/html/2592.html">http://c.biancheng.net/cpp/html/2592.html</a></p><p>​          <a href="http://www.2cto.com/os/201410/343247.html">http://www.2cto.com/os/201410/343247.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> IPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《深入理解Windows操作系统》 </tag>
            
            <tag> IPC </tag>
            
            <tag> Pipe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件大小换算方法</title>
      <link href="/Code/LeetCode/ConvertFileSize/"/>
      <url>/Code/LeetCode/ConvertFileSize/</url>
      
        <content type="html"><![CDATA[<h1 id="文件大小转换方法"><a href="#文件大小转换方法" class="headerlink" title="文件大小转换方法"></a>文件大小转换方法</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">convertSize</span><span class="params">(<span class="type">double</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string strSize[<span class="number">6</span>] = &#123; <span class="string">&quot;B&quot;</span>, <span class="string">&quot;KB&quot;</span>, <span class="string">&quot;MB&quot;</span>, <span class="string">&quot;GB&quot;</span>, <span class="string">&quot;TB&quot;</span>, <span class="string">&quot;PB&quot;</span> &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> flag = <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; _countof(strSize); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((size / flag) &lt; <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">char</span> strTemp[<span class="number">1024</span>];</span><br><span class="line">            string strRet;</span><br><span class="line">            <span class="built_in">sprintf_s</span>(strTemp, <span class="string">&quot;%.2f&quot;</span>, size);</span><br><span class="line">            <span class="keyword">return</span> strRet.<span class="built_in">append</span>(strTemp).<span class="built_in">append</span>(strSize[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            size = size / flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">    <span class="type">double</span> FlieSize_1 = <span class="number">224945</span>;</span><br><span class="line">    <span class="type">double</span> FlieSize_2 = <span class="number">2249450</span>;</span><br><span class="line">    <span class="type">double</span> FlieSize_3 = <span class="number">2249450000</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;FlieSize_1：&quot;</span> &lt;&lt; <span class="built_in">convertSize</span>(FlieSize_1) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;FlieSize_2：&quot;</span> &lt;&lt; <span class="built_in">convertSize</span>(FlieSize_2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;FlieSize_3：&quot;</span> &lt;&lt; <span class="built_in">convertSize</span>(FlieSize_3) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【管道】（二） 管道通信</title>
      <link href="/Code/IPC/%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1/"/>
      <url>/Code/IPC/%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文所讲管道通信主要是<B>进程间</B>管道通信。</p></blockquote><p>[toc]</p><h1 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h1><blockquote><p> 命名管道的通信是在一个命名管道服务器和一个命名管道客户之间进行的。命名管道服务器是指创建爱你命名管道的应用程序，客户可以连接到它所创建的命名管道上。命名管道的 <mark>名称的格式</mark> 是 <code>\\Server\pipe\PipeName</code>。</p><ul><li>名称中的<code>Server</code>部分指定了此命名管道服务器当前执行所在的计算机（<mark>需要注意的是</mark>：命名管道服务器不能创建远程系统上的命名管道）。但是这个名称可以是一个DNS名称（比如，mspress.microsoft.com）、一个NetBIOS名称（mspress）或者一个IP地址（131.107.0.1）。</li><li>名称中的 <code>Pipe</code> 部分必须是字符串 <code>Pipe</code>。而 <code>PipeName</code> 则是分配给此命名管道的唯一名。命名管道名称中的唯一名部分可以包含子目录。如：<code>\\MyComputer\Pipe\MyServerApp\ConnectionPipe</code> 是一个包含子目录的命名管道名称的例子。</li></ul><p>综上，我们在一个示例程序中创建的管道可以命名为 <code>\\.\pipe\DemoApp\test.pip</code> （使用转义也就是<code>\\\\.\\pipe\\DemoApp\\test_pip</code>），这里的 <code>\</code> 代表的是本地计算机。</p><hr><p>而以上的管道名，也就是我们后续调用API的参数之一，也是我们唯一可以标识管道的标志。</p></blockquote><h1 id="创建管道的方式一-CreateNamedPipe"><a href="#创建管道的方式一-CreateNamedPipe" class="headerlink" title="创建管道的方式一 CreateNamedPipe"></a>创建管道的方式一 <code>CreateNamedPipe</code></h1><h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">CreateNamedPipeA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           LPCSTR                lpName,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwOpenMode,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwPipeMode,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 nMaxInstances,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 nOutBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 nInBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 nDefaultTimeOut,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><ol><li><code>lpName</code><br>要创建的管道名。</li><li><code>dwOpenMode</code></li><li><code>dwPipeMod</code></li><li><code>nMaxInstances</code></li><li><code>nOutBufferSize</code></li><li><code>nInBufferSize</code></li><li><code>nDefaultTimeOut</code></li><li><code>lpSecurityAttributes</code></li></ol><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h1 id="创建管道的方式二-CreateFile"><a href="#创建管道的方式二-CreateFile" class="headerlink" title="创建管道的方式二 CreateFile"></a>创建管道的方式二 <code>CreateFile</code></h1><h2 id="原型-1"><a href="#原型-1" class="headerlink" title="原型"></a>原型</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h2><h2 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h2><h1 id="Demo1——管道客户端和服务端的控制台程序"><a href="#Demo1——管道客户端和服务端的控制台程序" class="headerlink" title="Demo1——管道客户端和服务端的控制台程序"></a>Demo1——管道客户端和服务端的控制台程序</h1><h1 id="Demo2——管道类"><a href="#Demo2——管道类" class="headerlink" title="Demo2——管道类"></a>Demo2——管道类</h1><p>知识来源：</p><ul><li>《深入解析Windows操作系统》</li><li><a href="https://blog.csdn.net/qq78442761/article/details/124429013">Qt笔记-Windows管道通信_IT1995的博客-CSDN博客_qt管道通信</a></li><li><a href="https://blog.csdn.net/huaizhanye8788/article/details/122742920">多进程通信之管道demo_Sunbigwang的博客-CSDN博客_多进程管道</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> IPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 《深入理解Windows操作系统》 </tag>
            
            <tag> IPC </tag>
            
            <tag> Pipe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go——Wails经验整理</title>
      <link href="/Code/GO/wailsapp/wails%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/"/>
      <url>/Code/GO/wailsapp/wails%E7%BB%8F%E9%AA%8C%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> wailsapp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Wails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/GO/wailsapp/todo/todo/"/>
      <url>/Code/GO/wailsapp/todo/todo/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> wailsapp </category>
          
          <category> todo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程1——面向对象编程</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/README/</url>
      
        <content type="html"><![CDATA[<p> Go 语言的代码是以包结构来组织的，且如果标示符（变量名，函数名，自定义类型等）如果以大写字母开头那么这些标示符是可以导出的，可以在任何导入了定义该标示符的包的包中直接使用。Go 语言中的面向对象和 C++，Java 中的面向对象不同，因为 Go 语言不支持继承，Go 语言只支持组合。</p><h4 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h4><p>Go 语言的中结构体 <code>struct</code> 与 C++、JAVA 中的类 <code>class</code> 相似，但 Go 放弃了传统面向对象的诸多特性，只保留了组合。</p><ul><li><strong>type</strong> typeName typeSpecification</li></ul><p>其中，<code>typeName</code> 可以是一个包或者函数内唯一合法的 Go 标示符。<code>typeSpecification</code> 可以是任何内置的类型，一个接口或者是一个结构体。所谓结构体，它的字段是由其他类型或者接口组成。例如我们通过结构体定义了一下类型：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ColorPoint <span class="keyword">struct</span> &#123;</span><br><span class="line">    color.Color     <span class="comment">// 匿名字段(嵌入)</span></span><br><span class="line">    x, y <span class="type">int</span>        <span class="comment">// 具名字段(聚合)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码我们通过结构体自定义了类型 <code>ColorPoint</code>，结构体中 <code>color.Color</code> 字段是 Color 包的类型 color，这个字段没有名字，所以被称为匿名的，也是嵌入字段。字段 <code>x</code> 和 <code>y</code> 是有变量名的，所以被称为具名字段。假如我们创建了类型 <code>ColorPoint</code> 的一个值 <code>point</code>（通过语法：<code>point := ColorPoint&#123;&#125;</code> 创建），那么这些字段可以通过 <code>point.Color</code>、<code>point.x</code>、<code>point.y</code> 访问。其他面向对象语言中的”类 (<code>class</code>)”、”对象 (<code>object</code>)”、”实例 (<code>instance</code>)”在 Go 语言中我们完全避开使用。相反的我们使用”类型 (<code>type</code>)”和其对应的”值”，其中自定义类型的值可以包含方法。</p><p>定义了结构体后如何创建并初始化一个对象实例呢？Go 语言支持以下几种方法进行实现：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先定义一个结构体Man</span></span><br><span class="line"><span class="keyword">type</span> Man <span class="keyword">struct</span>&#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//对象创建与初始化</span></span><br><span class="line">man := <span class="built_in">new</span>(Man)</span><br><span class="line">man := &amp;Man&#123;&#125;</span><br><span class="line">man := &amp;Man&#123;<span class="string">&quot;Tom&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">man := &amp;Man&#123;name: <span class="string">&quot;Tom&quot;</span>, age: <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure><p>为了更加方便的创建对象，我们一般会使用一个全局函数来完成对象的创建，这和传统的“构造函数”类似。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMan</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>)</span></span> *Man &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Man&#123;name, age&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 面向对象编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程3——组合</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E7%BB%84%E5%90%88/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E7%BB%84%E5%90%88/README/</url>
      
        <content type="html"><![CDATA[<p>Go 语言虽然抛弃了继承，但是却提供了一个更加方便的组合特性。相对于继承的编译期确定实现，组合的运行态指定实现，更加灵活。下面通过一段代码来了解组合的基本属性以及它与继承的不同之处。</p><p>先定义一个结构体 Base, 并为它添加两个方法 <code>Foo()</code> 和 <code>Bar()</code>：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Base <span class="keyword">struct</span>&#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Base)</span></span> Foo() &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Base)</span></span> Bar() &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Seed <span class="keyword">struct</span> &#123;</span><br><span class="line">    Base</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Seed)</span></span> Foo() &#123;</span><br><span class="line">    s.Base.Foo()</span><br><span class="line">    s.Bar()</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码先定义了一个 Base 类，然后定义了一个 Seed 类。Seed 类“继承”了 Base 类的所有成员属性和方法并重写了 <code>Foo()</code> 方法。同时在重写 <code>Foo()</code> 方法时调用了 Base 类的 <code>Foo()</code> 方法和 <code>Bar()</code> 方法。需要注意的是，若此时 Seed 的对象通过 <code>s.Foo()</code> 调用 <code>Foo()</code> 方法时，实际调用的是 Seed 重写过后的 <code>Foo()</code> 方法，而不是基类 Base 的 <code>Foo()</code> 方法，若想调用 Base 类的 <code>Foo()</code> 方法则要使用 <code>s.Base.Foo</code>，而调用没有重写的 <code>Bar()</code> 方法时，使用 <code>s.Bar()</code> 和<code>s.Base.Bar()</code> 效果是一样的。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 组合 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程2——方法</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%96%B9%E6%B3%95/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%96%B9%E6%B3%95/README/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="./struct_t.go">Demo</a></p></blockquote><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><blockquote><p><strong>方法</strong>是作用在自定义类型上的一类特殊函数，通常自定义类型的值会被传递给该函数，该值可能是以指针或者复制值的形式传递。定义方法和定义函数几乎相同，只是需要在 <code>func</code> 关键字和方法名之间必须写上接接受者。例如我们给类型 <code>Count</code> 定义了以下方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Count <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count *Count)</span></span> Increment() &#123; *count++ &#125;  <span class="comment">// 接受者是一个 `Count` 类型的指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count *Count)</span></span> Decrement() &#123; *count-- &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count Count)</span></span> IsZero() <span class="type">bool</span> &#123; <span class="keyword">return</span> count == <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure><p>以上代码中，我们在内置类型 <code>int</code> 的基础上定义了自定义类型 <code>Count</code>，然后给该类型添加了 <code>Increment()</code>、<code>Decrement()</code> 和 <code>IsZero()</code> 方法，其中前两者的接受者为 <code>Count</code> 类型的指针，后一个方法接收 <code>Count</code> 类型的值。</p></blockquote><p>Demo:</p><p>类型的方法集是指可以被该类型的值调用的所有方法的集合。</p><p>一个指向自定义类型的值的指针，它的方法集由该类型定义的所有方法组成，无论这些方法接受的是一个值还是一个指针。如果在指针上调用一个接受值的方法，Go 语言会聪明地将该指针解引用。</p><p>一个自定义类型值的方法集合则由该类型定义的接收者为值类型的方法组成，但是不包括那些接收者类型为指针的方法。</p><p>其实这些限制 Go 语言帮我们解决的非常好，结果就是我们可以在值类型上调用接收者为指针的方法。假如我们只有一个值，仍然可以调用一个接收者为指针类型的方法，这是因为 Go 语言会自动获取值的地址传递给该方法，前提是该值是可寻址的。</p><p>在以上定义的类型 <code>Count</code> 中，<code>*Count</code> 方法集是 <code>Increment()</code>, <code>Decrement()</code> 和 <code>IsZero()</code>，<code>Count</code> 的值的方法集是 <code>IsZero()</code>。但是因为 <code>Count</code> 类型的是可寻址的，所以我们可以使用 <code>Count</code> 的值调用全部的方法。</p><p>另外如果结构体的字段也有方法，我们也可以直接通过结构体访问字段中的方法。下面让我们练习下，创建源文件 <code>struct_t.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Count <span class="type">int</span> <span class="comment">// 创建自定义类型 Count</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count *Count)</span></span> Increment()  &#123; *count++ &#125; <span class="comment">// Count类型的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count *Count)</span></span> Decrement()  &#123; *count-- &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(count Count)</span></span> IsZero() <span class="type">bool</span> &#123; <span class="keyword">return</span> count == <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Part <span class="keyword">struct</span> &#123; <span class="comment">// 基于结构体创建自定义类型 Part</span></span><br><span class="line">    stat  <span class="type">string</span></span><br><span class="line">    Count <span class="comment">// 匿名字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(part Part)</span></span> IsZero() <span class="type">bool</span> &#123; <span class="comment">// 覆盖了匿名字段Count的IsZero()方法</span></span><br><span class="line">    <span class="keyword">return</span> part.Count.IsZero() &amp;&amp; part.stat == <span class="string">&quot;&quot;</span> <span class="comment">// 调用了匿名字段的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(part Part)</span></span> String() <span class="type">string</span> &#123; <span class="comment">// 定义String()方法，自定义了格式化指令%v的输出</span></span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&lt;&lt;%s, %d&gt;&gt;&quot;</span>, part.stat, part.Count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i Count = <span class="number">-1</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Start \&quot;Count\&quot; test:\nOrigin value of count: %d\n&quot;</span>, i)</span><br><span class="line">    i.Increment()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Value of count after increment: %d\n&quot;</span>, i)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Count is zero t/f? : %t\n\n&quot;</span>, i.IsZero())</span><br><span class="line">    fmt.Println(<span class="string">&quot;Start: \&quot;Part\&quot; test:&quot;</span>)</span><br><span class="line">    part := Part&#123;<span class="string">&quot;232&quot;</span>, <span class="number">0</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Part: %v\n&quot;</span>, part)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Part is zero t/f? : %t\n&quot;</span>, part.IsZero())</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Count in Part is zero t/f?: %t\n&quot;</span>, part.Count.IsZero()) <span class="comment">// 尽管覆盖了匿名字段的方法，但还是可以访问</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码中，我们创建了 <code>Count</code> 类型，然后在其基础上又创建了结构体类型 <code>Part</code>。我们为 <code>Count</code> 类型定义了 3 个方法，并在 <code>Part</code> 类型中创建了方法 <code>IsZero()</code> 覆盖了其匿名字段 <code>Count</code> 中 <code>IsZero()</code> 方法。但是我们还是可以二次访问到匿名字段中被覆盖的方法。执行代码，输出如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ go run struct_t.go</span><br><span class="line">Start <span class="string">&quot;Count&quot;</span> <span class="built_in">test</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Origin value of count: -1</span><br><span class="line">Value of count after increment: 0</span><br><span class="line">Count is zero t/f? : <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Start: <span class="string">&quot;Part&quot;</span> <span class="built_in">test</span>:</span><br><span class="line">Part: &lt;&lt;<span class="string">232, 0&gt;&gt;</span></span><br><span class="line"><span class="string">Part is zero t/f? : false</span></span><br><span class="line"><span class="string">Count in Part is zero t/f?: true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 方法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程5——接口变量值的类型</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%8E%A5%E5%8F%A3%E5%8F%98%E9%87%8F%E5%80%BC%E7%9A%84%E7%B1%BB%E5%9E%8B/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%8E%A5%E5%8F%A3%E5%8F%98%E9%87%8F%E5%80%BC%E7%9A%84%E7%B1%BB%E5%9E%8B/README/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="./interface_t1.go">Demo</a></p></blockquote><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>在 Go 中，<strong>接口</strong>是一组方法签名。当一个类型为接口中的所有方法提供定义时，它被称为实现该接口。它与 oop 非常相似。接口指定类型应具有的方法，类型决定如何实现这些方法。</p><h3 id="接口基础"><a href="#接口基础" class="headerlink" title="接口基础"></a>接口基础</h3><p>之所以说 Go 语言的面向对象很灵活，很大一部分原因是由于接口的存在。接口是一个自定义类型，它声明了一个或者多个方法签名，任何实现了这些方法的类型都实现这个接口。<code>infterface&#123;&#125;</code> 类型是声明了空方法集的接口类型。任何一个值都满足 <code>interface&#123;&#125;</code> 类型，也就是说如果一个函数或者方法接收 <code>interface&#123;&#125;</code> 类型的参数，那么任意类型的参数都可以传递给该函数。接口是完全抽象的，不能实例化。接口能存储任何实现了该接口的类型。直接看例子吧，创建源文件 <code>interface_t.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123; <span class="comment">// 结构体</span></span><br><span class="line">    name  <span class="type">string</span></span><br><span class="line">    age   <span class="type">int</span></span><br><span class="line">    phone <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Human实现SayHi方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> SayHi() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Hi, I am %s you can call me on %s\n&quot;</span>, h.name, h.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Human实现Sing方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> Sing(lyrics <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;La la la la...&quot;</span>, lyrics)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    Human  <span class="comment">//匿名字段</span></span><br><span class="line">    school <span class="type">string</span></span><br><span class="line">    loan   <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">    Human   <span class="comment">//匿名字段</span></span><br><span class="line">    company <span class="type">string</span></span><br><span class="line">    money   <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee重载Human的SayHi方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span></span> SayHi() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Hi, I am %s, I work at %s. Call me on %s\n&quot;</span>, e.name,</span><br><span class="line">        e.company, e.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interface Men被Human,Student和Employee实现</span></span><br><span class="line"><span class="comment">// 因为这三个类型都实现了这两个方法</span></span><br><span class="line"><span class="keyword">type</span> Men <span class="keyword">interface</span> &#123;</span><br><span class="line">    SayHi()</span><br><span class="line">    Sing(lyrics <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mike := Student&#123;Human&#123;<span class="string">&quot;Mike&quot;</span>, <span class="number">25</span>, <span class="string">&quot;222-222-XXX&quot;</span>&#125;, <span class="string">&quot;MIT&quot;</span>, <span class="number">0.00</span>&#125;</span><br><span class="line">    paul := Student&#123;Human&#123;<span class="string">&quot;Paul&quot;</span>, <span class="number">26</span>, <span class="string">&quot;111-222-XXX&quot;</span>&#125;, <span class="string">&quot;Harvard&quot;</span>, <span class="number">100</span>&#125;</span><br><span class="line">    sam := Employee&#123;Human&#123;<span class="string">&quot;Sam&quot;</span>, <span class="number">36</span>, <span class="string">&quot;444-222-XXX&quot;</span>&#125;, <span class="string">&quot;Golang Inc.&quot;</span>, <span class="number">1000</span>&#125;</span><br><span class="line">    Tom := Employee&#123;Human&#123;<span class="string">&quot;Tom&quot;</span>, <span class="number">37</span>, <span class="string">&quot;222-444-XXX&quot;</span>&#125;, <span class="string">&quot;Things Ltd.&quot;</span>, <span class="number">5000</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义Men类型的变量i</span></span><br><span class="line">    <span class="keyword">var</span> i Men</span><br><span class="line"></span><br><span class="line">    <span class="comment">//i能存储Student</span></span><br><span class="line">    i = mike</span><br><span class="line">    fmt.Println(<span class="string">&quot;This is Mike, a Student:&quot;</span>)</span><br><span class="line">    i.SayHi()</span><br><span class="line">    i.Sing(<span class="string">&quot;November rain&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//i也能存储Employee</span></span><br><span class="line">    i = Tom</span><br><span class="line">    fmt.Println(<span class="string">&quot;This is Tom, an Employee:&quot;</span>)</span><br><span class="line">    i.SayHi()</span><br><span class="line">    i.Sing(<span class="string">&quot;Born to be wild&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义了slice Men</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Let&#x27;s use a slice of Men and see what happens&quot;</span>)</span><br><span class="line">    x := <span class="built_in">make</span>([]Men, <span class="number">3</span>)</span><br><span class="line">    <span class="comment">//这三个都是不同类型的元素，但是他们实现了interface同一个接口</span></span><br><span class="line">    x[<span class="number">0</span>], x[<span class="number">1</span>], x[<span class="number">2</span>] = paul, sam, mike</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> x &#123;</span><br><span class="line">        value.SayHi()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="接口变量值的类型"><a href="#接口变量值的类型" class="headerlink" title="接口变量值的类型*"></a>接口变量值的类型<code>*</code></h3><blockquote><p><span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">接口类型声明的变量里能存储任何实现了该接口的类型的值。</span></p><p>有的时候我们需要知道这个变量里的值的类型，那么需要怎么做呢？可以使用类型断言，或者是 <code>switch</code> 类型判断分支。以下的例子 <code>interface_t1.go</code> 我们使用了 <code>switch</code> 类型判断分支。</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*使用了switch 类型判断分支*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">type</span> List []Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="type">string</span></span><br><span class="line">age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现了fmt.Stringer接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;(name: &quot;</span> + p.name + <span class="string">&quot;- age: &quot;</span> + strconv.Itoa(p.age) + <span class="string">&quot; years)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">list := <span class="built_in">make</span>(List, <span class="number">4</span>)</span><br><span class="line">list[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">list[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">list[<span class="number">2</span>] = Person&#123;<span class="string">&quot;Dennis&quot;</span>, <span class="number">70</span>&#125;</span><br><span class="line">list[<span class="number">3</span>] = <span class="number">1</span> + <span class="number">2i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, element := <span class="keyword">range</span> list &#123;</span><br><span class="line"><span class="keyword">switch</span> value := element.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %d\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %s\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">case</span> Person:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %s\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is of a different type&quot;</span>, index)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌入interface"><a href="#嵌入interface" class="headerlink" title="嵌入interface"></a>嵌入interface</h3><p>结构体中可以嵌入匿名字段，其实在接口里也可以再嵌入接口。<span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">如果一个 <code>interface1</code> 作为 <code>interface2</code> 的一个嵌入字段，那么 <code>interface2</code> 隐式的包含了 <code>interface1</code> 里的方法。</span>如下例子中，<code>Interface2</code> 包含了 <code>Interface1</code> 的所有方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface1 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Send()</span><br><span class="line">    Receive()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Interface2 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Interface1</span><br><span class="line">    Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 接口变量值的类型 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程6——嵌入 interface</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E5%B5%8C%E5%85%A5interface/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E5%B5%8C%E5%85%A5interface/README/</url>
      
        <content type="html"><![CDATA[<p>在前面的课程中我们已经知道在结构体中可以嵌入匿名字段，其实在接口里也可以再嵌入接口。如果一个 interface1 作为 interface2 的一个嵌入字段，那么 interface2 隐式的包含了 interface1 里的方法。如下例子中，Interface2 包含了 Interface1 的所有方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface1 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Send()</span><br><span class="line">    Receive()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Interface2 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Interface1</span><br><span class="line">    Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 嵌入interface </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go面向对象编程4——接口</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%8E%A5%E5%8F%A3/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E6%8E%A5%E5%8F%A3/README/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="./interface_t.go">Demo</a></p></blockquote><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>在 Go 中，<strong>接口</strong>是一组方法签名。当一个类型为接口中的所有方法提供定义时，它被称为实现该接口。它与 oop 非常相似。接口指定类型应具有的方法，类型决定如何实现这些方法。</p><h3 id="接口基础"><a href="#接口基础" class="headerlink" title="接口基础"></a>接口基础</h3><p>之所以说 Go 语言的面向对象很灵活，很大一部分原因是由于接口的存在。接口是一个自定义类型，它声明了一个或者多个方法签名，任何实现了这些方法的类型都实现这个接口。<code>infterface&#123;&#125;</code> 类型是声明了空方法集的接口类型。任何一个值都满足 <code>interface&#123;&#125;</code> 类型，也就是说如果一个函数或者方法接收 <code>interface&#123;&#125;</code> 类型的参数，那么任意类型的参数都可以传递给该函数。接口是完全抽象的，不能实例化。接口能存储任何实现了该接口的类型。直接看例子吧，创建源文件 <code>interface_t.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123; <span class="comment">// 结构体</span></span><br><span class="line">    name  <span class="type">string</span></span><br><span class="line">    age   <span class="type">int</span></span><br><span class="line">    phone <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Human实现SayHi方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> SayHi() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Hi, I am %s you can call me on %s\n&quot;</span>, h.name, h.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Human实现Sing方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> Sing(lyrics <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;La la la la...&quot;</span>, lyrics)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    Human  <span class="comment">//匿名字段</span></span><br><span class="line">    school <span class="type">string</span></span><br><span class="line">    loan   <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">    Human   <span class="comment">//匿名字段</span></span><br><span class="line">    company <span class="type">string</span></span><br><span class="line">    money   <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee重载Human的SayHi方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span></span> SayHi() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Hi, I am %s, I work at %s. Call me on %s\n&quot;</span>, e.name,</span><br><span class="line">        e.company, e.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interface Men被Human,Student和Employee实现</span></span><br><span class="line"><span class="comment">// 因为这三个类型都实现了这两个方法</span></span><br><span class="line"><span class="keyword">type</span> Men <span class="keyword">interface</span> &#123;</span><br><span class="line">    SayHi()</span><br><span class="line">    Sing(lyrics <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mike := Student&#123;Human&#123;<span class="string">&quot;Mike&quot;</span>, <span class="number">25</span>, <span class="string">&quot;222-222-XXX&quot;</span>&#125;, <span class="string">&quot;MIT&quot;</span>, <span class="number">0.00</span>&#125;</span><br><span class="line">    paul := Student&#123;Human&#123;<span class="string">&quot;Paul&quot;</span>, <span class="number">26</span>, <span class="string">&quot;111-222-XXX&quot;</span>&#125;, <span class="string">&quot;Harvard&quot;</span>, <span class="number">100</span>&#125;</span><br><span class="line">    sam := Employee&#123;Human&#123;<span class="string">&quot;Sam&quot;</span>, <span class="number">36</span>, <span class="string">&quot;444-222-XXX&quot;</span>&#125;, <span class="string">&quot;Golang Inc.&quot;</span>, <span class="number">1000</span>&#125;</span><br><span class="line">    Tom := Employee&#123;Human&#123;<span class="string">&quot;Tom&quot;</span>, <span class="number">37</span>, <span class="string">&quot;222-444-XXX&quot;</span>&#125;, <span class="string">&quot;Things Ltd.&quot;</span>, <span class="number">5000</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义Men类型的变量i</span></span><br><span class="line">    <span class="keyword">var</span> i Men</span><br><span class="line"></span><br><span class="line">    <span class="comment">//i能存储Student</span></span><br><span class="line">    i = mike</span><br><span class="line">    fmt.Println(<span class="string">&quot;This is Mike, a Student:&quot;</span>)</span><br><span class="line">    i.SayHi()</span><br><span class="line">    i.Sing(<span class="string">&quot;November rain&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//i也能存储Employee</span></span><br><span class="line">    i = Tom</span><br><span class="line">    fmt.Println(<span class="string">&quot;This is Tom, an Employee:&quot;</span>)</span><br><span class="line">    i.SayHi()</span><br><span class="line">    i.Sing(<span class="string">&quot;Born to be wild&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义了slice Men</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Let&#x27;s use a slice of Men and see what happens&quot;</span>)</span><br><span class="line">    x := <span class="built_in">make</span>([]Men, <span class="number">3</span>)</span><br><span class="line">    <span class="comment">//这三个都是不同类型的元素，但是他们实现了interface同一个接口</span></span><br><span class="line">    x[<span class="number">0</span>], x[<span class="number">1</span>], x[<span class="number">2</span>] = paul, sam, mike</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> x &#123;</span><br><span class="line">        value.SayHi()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="接口变量值的类型"><a href="#接口变量值的类型" class="headerlink" title="接口变量值的类型*"></a>接口变量值的类型<code>*</code></h3><blockquote><p><span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">接口类型声明的变量里能存储任何实现了该接口的类型的值。</span></p><p>有的时候我们需要知道这个变量里的值的类型，那么需要怎么做呢？可以使用类型断言，或者是 <code>switch</code> 类型判断分支。以下的例子 <code>interface_t1.go</code> 我们使用了 <code>switch</code> 类型判断分支。</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*使用了switch 类型判断分支*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">type</span> List []Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="type">string</span></span><br><span class="line">age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现了fmt.Stringer接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;(name: &quot;</span> + p.name + <span class="string">&quot;- age: &quot;</span> + strconv.Itoa(p.age) + <span class="string">&quot; years)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">list := <span class="built_in">make</span>(List, <span class="number">4</span>)</span><br><span class="line">list[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">list[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">list[<span class="number">2</span>] = Person&#123;<span class="string">&quot;Dennis&quot;</span>, <span class="number">70</span>&#125;</span><br><span class="line">list[<span class="number">3</span>] = <span class="number">1</span> + <span class="number">2i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, element := <span class="keyword">range</span> list &#123;</span><br><span class="line"><span class="keyword">switch</span> value := element.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %d\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %s\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">case</span> Person:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %s\n&quot;</span>, index, value)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;list[%d] is of a different type&quot;</span>, index)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌入interface"><a href="#嵌入interface" class="headerlink" title="嵌入interface"></a>嵌入interface</h3><p>结构体中可以嵌入匿名字段，其实在接口里也可以再嵌入接口。<span style="background: PaleVioletRed;border-radius:10px;padding:1px 5px;color:white;font-weight:900">如果一个 <code>interface1</code> 作为 <code>interface2</code> 的一个嵌入字段，那么 <code>interface2</code> 隐式的包含了 <code>interface1</code> 里的方法。</span>如下例子中，<code>Interface2</code> 包含了 <code>Interface1</code> 的所有方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface1 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Send()</span><br><span class="line">    Receive()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Interface2 <span class="keyword">interface</span> &#123;</span><br><span class="line">    Interface1</span><br><span class="line">    Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 面向对象编程 </category>
          
          <category> 接口 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go简明手册——词频统计综合案例</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/README/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="./wordcount/wordcount.go">wordcount.go</a></p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>词频统计的程序逻辑很简单。我们首先会创建一个映射，然后读取文件的每一行，提取单词，然后更新映射中单词所对应的数量即可。</p><p>为了演示面向对象和 goroutine 的使用，我们将基础映射类型封装成了一个统计单词频率的包。我们在基础映射类型上创建了类型 <code>WordCound</code>，然后为该类型了实现了关键方法 <code>UpdateFreq()</code> 和 <code>WordFreqCounter()</code>，其中前者会读取一个文件并统计该文件中的所有单词的词频，后者通过 goroutine 实现了并发统计。</p><p>其并发逻辑是：对于每一个文件，创建一个 goroutine，在这个 goroutine 内部调用 <code>UpdateFreq()</code> 方法统计对应文件的词频，当统计完成以后会将映射中每一对键值转化为 <code>Pair</code> 结构发送到 <code>results</code> 通道，并在发送完成时候发送一个空结构体的值到 <code>done</code> 通道以表示自己的任务已经完成。由于 <code>map</code> 映射结构不支持并发写操作，所以我们通过 <code>result</code> 通道来保证每次只有一个 goroutine 能更新映射。又因为当所有的 goroutine 结束以后，有可能 <code>results</code> 通道中还有没来得及处理的数据，所以在 <code>WordFreqCounter()</code> 的结尾我们又开启了一个 <code>for</code> 循环处理 <code>results</code> 通道中的剩余数据。说了这么多，我们直接写代码吧。</p><p>在 <code>$GOPATH/src/wordcount</code> 目录中创建文件 <code>wordcount.go</code>，输入以下源码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wordcount</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bufio&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;sort&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Pair <span class="keyword">struct</span> &#123;</span><br><span class="line">    Key   <span class="type">string</span></span><br><span class="line">    Value <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PariList实现了sort接口，可以使用sort.Sort对其排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PairList []Pair</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PairList)</span></span> Swap(i, j <span class="type">int</span>)      &#123; p[i], p[j] = p[j], p[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PairList)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(p) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PairList)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> p[j].Value &lt; p[i].Value &#125; <span class="comment">// 逆序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取单词</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SplitOnNonLetters</span><span class="params">(s <span class="type">string</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    notALetter := <span class="function"><span class="keyword">func</span><span class="params">(char <span class="type">rune</span>)</span></span> <span class="type">bool</span> &#123; <span class="keyword">return</span> !unicode.IsLetter(char) &#125;</span><br><span class="line">    <span class="keyword">return</span> strings.FieldsFunc(s, notALetter)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   基于map实现了类型WordCount, 并对期实现了Merge(), Report(), SortReport(), UpdateFreq(),</span></span><br><span class="line"><span class="comment">   WordFreqCounter() 方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> WordCount <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于合并两个WordCount</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(source WordCount)</span></span> Merge(wordcount WordCount) WordCount &#123;</span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> wordcount &#123;</span><br><span class="line">        source[k] += v</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> source</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印词频统计情况</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wordcount WordCount)</span></span> Report() &#123;</span><br><span class="line">    words := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(wordcount))</span><br><span class="line">    wordWidth, frequencyWidth := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word, frequency := <span class="keyword">range</span> wordcount &#123;</span><br><span class="line">        words = <span class="built_in">append</span>(words, word)</span><br><span class="line">        <span class="keyword">if</span> width := utf8.RuneCountInString(word); width &gt; wordWidth &#123;</span><br><span class="line">            wordWidth = width</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> width := <span class="built_in">len</span>(fmt.Sprint(frequency)); width &gt; frequencyWidth &#123;</span><br><span class="line">            frequencyWidth = width</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort.Strings(words)</span><br><span class="line">    gap := wordWidth + frequencyWidth - <span class="built_in">len</span>(<span class="string">&quot;Word&quot;</span>) - <span class="built_in">len</span>(<span class="string">&quot;Frequency&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Word %*s%s\n&quot;</span>, gap, <span class="string">&quot; &quot;</span>, <span class="string">&quot;Frequency&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%-*s %*d\n&quot;</span>, wordWidth, word, frequencyWidth,</span><br><span class="line">            wordcount[word])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从多到少打印词频</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wordcount WordCount)</span></span> SortReport() &#123;</span><br><span class="line">    p := <span class="built_in">make</span>(PairList, <span class="built_in">len</span>(wordcount))</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> wordcount &#123; <span class="comment">// 将wordcount map转换成PairList</span></span><br><span class="line">        p[i] = Pair&#123;k, v&#125;</span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort.Sort(p) <span class="comment">// 因为PairList实现了排序接口，所以可以使用sort.Sort()对其排序</span></span><br><span class="line"></span><br><span class="line">    wordWidth, frequencyWidth := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, pair := <span class="keyword">range</span> p &#123;</span><br><span class="line">        word, frequency := pair.Key, pair.Value</span><br><span class="line">        <span class="keyword">if</span> width := utf8.RuneCountInString(word); width &gt; wordWidth &#123;</span><br><span class="line">            wordWidth = width</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> width := <span class="built_in">len</span>(fmt.Sprint(frequency)); width &gt; frequencyWidth &#123;</span><br><span class="line">            frequencyWidth = width</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    gap := wordWidth + frequencyWidth - <span class="built_in">len</span>(<span class="string">&quot;Word&quot;</span>) - <span class="built_in">len</span>(<span class="string">&quot;Frequency&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Word %*s%s\n&quot;</span>, gap, <span class="string">&quot; &quot;</span>, <span class="string">&quot;Frequency&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, pair := <span class="keyword">range</span> p &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%-*s %*d\n&quot;</span>, wordWidth, pair.Key, frequencyWidth,</span><br><span class="line">            pair.Value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从文件中读取单词，并更新其出现的次数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wordcount WordCount)</span></span> UpdateFreq(filename <span class="type">string</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file *os.File</span><br><span class="line">    <span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file, err = os.Open(filename); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;failed to open the file: &quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close() <span class="comment">// 本函数退出之前时，关闭文件</span></span><br><span class="line"></span><br><span class="line">    reader := bufio.NewReader(file)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        line, err := reader.ReadString(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> _, word := <span class="keyword">range</span> SplitOnNonLetters(strings.TrimSpace(line)) &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(word) &gt; utf8.UTFMax ||</span><br><span class="line">                utf8.RuneCountInString(word) &gt; <span class="number">1</span> &#123;</span><br><span class="line">                wordcount[strings.ToLower(word)] += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> err != io.EOF &#123;</span><br><span class="line">                log.Println(<span class="string">&quot;failed to finish reading the file: &quot;</span>, err)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并发统计单词频次</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wordcount WordCount)</span></span> WordFreqCounter(files []<span class="type">string</span>) &#123;</span><br><span class="line"></span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> Pair, <span class="built_in">len</span>(files))  <span class="comment">// goroutine 将结果发送到该channel</span></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="built_in">len</span>(files)) <span class="comment">// 每个goroutine工作完成后，发送一个空结构体到该channel，表示工作完成</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(files); &#123; <span class="comment">// 有多少个文件就开启多少个goroutine, 使用匿名函数的方式</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(done <span class="keyword">chan</span>&lt;- <span class="keyword">struct</span>&#123;&#125;, results <span class="keyword">chan</span>&lt;- Pair, filename <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">            wordcount := <span class="built_in">make</span>(WordCount)</span><br><span class="line">            wordcount.UpdateFreq(filename)</span><br><span class="line">            <span class="keyword">for</span> k, v := <span class="keyword">range</span> wordcount &#123;</span><br><span class="line">                pair := Pair&#123;k, v&#125;</span><br><span class="line">                results &lt;- pair</span><br><span class="line">            &#125;</span><br><span class="line">            done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">        &#125;(done, results, files[i])</span><br><span class="line"></span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> working := <span class="built_in">len</span>(files); working &gt; <span class="number">0</span>; &#123; <span class="comment">// 监听通道，直到所有的工作goroutine完成任务时才退出</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> pair := &lt;-results: <span class="comment">// 接收发送到通道中的统计结果</span></span><br><span class="line">            wordcount[pair.Key] += pair.Value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> &lt;-done: <span class="comment">// 判断工作goroutine是否全部完成</span></span><br><span class="line">            working--</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">DONE: <span class="comment">// 再次启动for循环处理通道中还未处理完的值</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> pair := &lt;-results:</span><br><span class="line">            wordcount[pair.Key] += pair.Value</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span> DONE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(results)</span><br><span class="line">    <span class="built_in">close</span>(done)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在 <code>$GOPATH</code> 目录中创建文件 <code>wordfreq.go</code>，输入以下源码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">    <span class="string">&quot;wordcount&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) == <span class="number">1</span> || os.Args[<span class="number">1</span>] == <span class="string">&quot;-h&quot;</span> || os.Args[<span class="number">1</span>] == <span class="string">&quot;--help&quot;</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;usage: %s &lt;file1&gt; [&lt;file2&gt; [... &lt;fileN&gt;]]\n&quot;</span>,</span><br><span class="line">            filepath.Base(os.Args[<span class="number">0</span>]))</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wordcounter := <span class="built_in">make</span>(wordcount.WordCount)</span><br><span class="line">    <span class="comment">// for _, filename := range os.Args[1:] &#123;</span></span><br><span class="line">    <span class="comment">//  wordcount.UpdateFreq(filename)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    wordcounter.WordFreqCounter(os.Args[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">    wordcounter.SortReport()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 词频统计综合案例 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
            <tag> Code </tag>
            
            <tag> GO </tag>
            
            <tag> 面向对象编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go并发编程——超时机制</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6/README/</url>
      
        <content type="html"><![CDATA[<p>通过前面的内容我们了解到，<code>channel</code> 的读写操作非常简单，只需要通过 <code>&lt;-</code> 操作符即可实现，但是 <code>channel</code> 的使用不当却会带来大麻烦。我们先来看之前的一段代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">a &lt;- <span class="number">1</span></span><br><span class="line">z := &lt;-a</span><br></pre></td></tr></table></figure><p>观察上面三行代码，第 2 行往 <code>channel</code> 内写入了数据，第 3 行从 <code>channel</code> 中读取了数据，如果程序运行正常当然不会出什么问题，可如果第二行数据写入失败，或者 <code>channel</code> 中没有数据，那么第 3 行代码会因为永远无法从 <code>a</code> 中读取到数据而一直处于阻塞状态。相反的，如果 <code>channel</code> 中的数据一直没有被读取，那么写入操作也会一直处于阻塞状态。如果不正确处理这个情况，很可能会导致整个 <code>goroutine</code> 锁死，这就是超时问题。Go 语言没有针对超时提供专门的处理机制，但是我们却可以利用 <code>select</code> 来巧妙地实现超时处理机制，下面看一个示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span></span> &#123;</span><br><span class="line">    time.Sleep(<span class="number">1e9</span>) <span class="comment">//等待1秒</span></span><br><span class="line">    t &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ch:  <span class="comment">//从ch中读取数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> &lt;-t:  <span class="comment">//如果1秒后没有从ch中读取到数据，那么从t中读取，并进行下一步操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样的方法就可以让程序在等待 1 秒后继续执行，而不会因为 ch 读取等待而导致程序停滞，从而巧妙地实现了超时处理机制，这种方法不仅简单，在实际项目开发中也是非常实用的。</p><h4 id="channel-的关闭"><a href="#channel-的关闭" class="headerlink" title="channel 的关闭"></a>channel 的关闭</h4><p><code>channel</code> 的关闭非常简单，使用 Go 语言内置的 <code>close()</code> 函数即可关闭 <code>channel</code>，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure><p>关闭了 <code>channel</code> 后如何查看 <code>channel</code> 是否关闭成功了呢？很简单，我们可以在读取 <code>channel</code> 时采用多重返回值的方式，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x, ok := &lt;-ch</span><br></pre></td></tr></table></figure><p>通过查看第二个返回值的 <code>bool</code> 值即可判断 <code>channel</code> 是否关闭，若为 <code>false</code> 则表示 <code>channel</code> 被关闭，反之则没有关闭。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 并发与并行 </category>
          
          <category> 超时机制 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go并发编程——select</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/select/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/select/README/</url>
      
        <content type="html"><![CDATA[<p><code>select</code> 用于处理异步 IO 问题，它的语法与 <code>switch</code> 非常类似。由 <code>select</code> 开始一个新的选择块，每个选择条件由 <code>case</code> 语句来描述，并且每个 <code>case</code> 语句里必须是一个 <code>channel</code> 操作。它既可以用于 <code>channel</code> 的数据接收，也可以用于 <code>channel</code> 的数据发送。如果 <code>select</code> 的多个分支都满足条件，则会随机的选取其中一个满足条件的分支。</p><p>新建源文件 <code>channel.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;time&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">        c1 &lt;- <span class="string">&quot;one&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">        c2 &lt;- <span class="string">&quot;two&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;-c1:</span><br><span class="line">            fmt.Println(<span class="string">&quot;received&quot;</span>, msg1)</span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;-c2:</span><br><span class="line">            fmt.Println(<span class="string">&quot;received&quot;</span>, msg2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码先初始化两个 <code>channel</code> c1 和 c2，然后开启两个 <code>goroutine</code> 分别往 c1 和 c2 写入数据，再通过 <code>select</code> 监听两个 <code>channel</code>，从中读取数据并输出。</p><p>运行结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run channel.go</span><br><span class="line">received one</span><br><span class="line">received two</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 并发与并行 </category>
          
          <category> select </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go并发编程——channel</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/channel/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/channel/README/</url>
      
        <content type="html"><![CDATA[<p><code>channel</code> 是<code>goroutine</code> 之间互相通讯的东西。类似我们 Unix 上的管道（可以在进程间传递消息），用来 <code>goroutine</code> 之间发消息和接收消息。其实，就是在做 <code>goroutine</code> 之间的内存共享。<code>channel</code> 是类型相关的，也就是说一个 <code>channel</code> 只能传递一种类型的值，这个类型需要在 <code>channel</code> 声明时指定。</p><h4 id="声明与初始化"><a href="#声明与初始化" class="headerlink" title="声明与初始化"></a>声明与初始化</h4><p><code>channel</code> 的一般声明形式：<strong>var</strong> chanName <strong>chan</strong> ElementType。</p><p>与普通变量的声明不同的是在类型前面加了 <code>channel</code> 关键字，<code>ElementType</code> 则指定了这个 <code>channel</code> 所能传递的元素类型。示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">chan</span> <span class="type">int</span> <span class="comment">//声明一个传递元素类型为int的channel</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">chan</span> <span class="type">float64</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">chan</span> <span class="type">string</span></span><br></pre></td></tr></table></figure><p>初始化一个 <code>channel</code> 也非常简单，直接使用 Go 语言内置的 <code>make()</code> 函数，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) <span class="comment">//初始化一个int型的名为a的channel</span></span><br><span class="line">b := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">float64</span>)</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br></pre></td></tr></table></figure><p><code>channel</code> 最频繁的操作就是写入和读取，这两个操作也非常简单，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">a &lt;- <span class="number">1</span>  <span class="comment">//将数据写入channel</span></span><br><span class="line">z := &lt;-a  <span class="comment">//从channel中读取数据</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 并发与并行 </category>
          
          <category> channel </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go并发编程——goroutine</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/goroutine/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/goroutine/README/</url>
      
        <content type="html"><![CDATA[<p><code>goroutine</code> 是 Go 语言并行设计的核心。<code>goroutine</code> 是一种比线程更轻量的实现，十几个 <code>goroutine</code> 可能在底层就是几个线程。 不同的是，Golang 在 runtime、系统调用等多方面对 <code>goroutine</code> 调度进行了封装和处理，当遇到长时间执行或者进行系统调用时，会主动把当前 <code>goroutine</code> 的 CPU (P) 转让出去，让其他 <code>goroutine</code> 能被调度并执行，也就是 Golang 从语言层面支持了协程。要使用 <code>goroutine</code> 只需要简单的在需要执行的函数前添加 <code>go</code> 关键字即可。当执行 <code>goroutine</code> 时候，Go 语言立即返回，接着执行剩余的代码，<code>goroutine</code> 不阻塞主线程。下面我们通过一小段代码来讲解 <code>go</code> 的使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先我们先实现一个 Add()函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    c := a + b</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> Add(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">//使用go关键字让函数并发执行</span></span><br></pre></td></tr></table></figure><p>Go 的并发执行就是这么简单，当在一个函数前加上 <code>go</code> 关键字，该函数就会在一个新的 goroutine 中并发执行，当该函数执行完毕时，这个新的 goroutine 也就结束了。不过需要注意的是，如果该函数具有返回值，那么返回值会被丢弃。所以什么时候用 <code>go</code> 还需要酌情考虑。</p><p>接着我们通过一个案例来体验一下 Go 的并发到底是怎么样的。新建源文件 <code>goroutine.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    c := a + b</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> Add(i, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行 <code>goroutine.go</code> 文件会发现屏幕上什么都没有，但程序并不会报错，这是什么原因呢？原来当主程序执行到 for 循环时启动了 10 个 <code>goroutine</code>，然后主程序就退出了，而启动的 10 个 <code>goroutine</code> 还没来得及执行 <code>Add()</code> 函数，所以程序不会有任何输出。也就是说主 <code>goroutine</code> 并不会等待其他 <code>goroutine</code> 执行结束。那么如何解决这个问题呢？Go 语言提供的信道（<code>channel</code>）就是专门解决并发通信问题的，下一节我们将详细介绍。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 并发与并行 </category>
          
          <category> goroutine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go并发编程——概要</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/README/</url>
      
        <content type="html"><![CDATA[<h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ul><li>并发与并行</li><li>协程</li><li>goroutine</li><li>channel</li><li>select</li></ul><h1 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h1><blockquote><h4 id="并发与并行"><a href="#并发与并行" class="headerlink" title="并发与并行"></a>并发与并行</h4><p>并发指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，通过 CPU 时间片轮转使多个进程快速交替的执行。而并行的关键是你有同时处理多个任务的能力。并发和并行都可以是很多个线程，就看这些线程能不能同时被（多个）CPU 执行，如果可以就说明是并行，而并发是多个线程被（一个）CPU 轮流切换着执行。一个经典且通俗易懂的例子这样解释并发与并行的区别：并发是两个队列，使用一台咖啡机；并行是两个队列，使用两台咖啡机。如果串行，一个队列使用一台咖啡机，那么哪怕前面那个人有事出去了半天，后面的人也只能等着他回来才能去接咖啡，这效率无疑是最低的。图解：</p><p><img src="/images/README/1.jpeg" alt="并发与并行"></p></blockquote><blockquote><h4 id="协程"><a href="#协程" class="headerlink" title="协程*"></a>协程<code>*</code></h4><p>协程也叫轻量级线程。与传统的进程和线程相比，协程最大的优点就在于其足够“轻”，操作系统可以轻松创建上百万个协程而不会导致系统资源枯竭，而线程和进程通常最多不过近万个。而多数语言在语法层面上是不支持协程的，一般都是通过库的方式进行支持，但库的支持方式和功能不够完善，经常会引发阻塞等一系列问题，而 Go 语言在语法层面上支持协程，也叫 <code>goroutine</code>。这让协程变得非常简单，让轻量级线程的切换管理不再依赖于系统的进程和线程，也不依赖 CPU 的数量。</p></blockquote><h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine*"></a>goroutine<code>*</code></h2><p><code>goroutine</code> 是 Go 语言并行设计的核心。<code>goroutine</code> 是一种比线程更轻量的实现，十几个 <code>goroutine</code> 可能在底层就是几个线程。 不同的是，Golang 在 runtime、系统调用等多方面对 <code>goroutine</code> 调度进行了封装和处理，当遇到长时间执行或者进行系统调用时，会主动把当前 <code>goroutine</code> 的 CPU (P) 转让出去，让其他 <code>goroutine</code> 能被调度并执行，也就是 Golang 从语言层面支持了协程。要使用 <code>goroutine</code> 只需要简单的在需要执行的函数前添加 <code>go</code> 关键字即可。当执行 <code>goroutine</code> 时候，Go 语言立即返回，接着执行剩余的代码，<code>goroutine</code> 不阻塞主线程。下面我们通过一小段代码来讲解 <code>go</code> 的使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先我们先实现一个 Add()函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    c := a + b</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> Add(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">//使用go关键字让函数并发执行</span></span><br></pre></td></tr></table></figure><p>Go 的并发执行就是这么简单，当在一个函数前加上 <code>go</code> 关键字，该函数就会在一个新的 goroutine 中并发执行，当该函数执行完毕时，这个新的 goroutine 也就结束了。不过需要注意的是，如果该函数具有返回值，那么返回值会被丢弃。所以什么时候用 <code>go</code> 还需要酌情考虑。</p><p>接着我们通过一个案例来体验一下 Go 的并发到底是怎么样的。新建源文件 <code>goroutine.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    c := a + b</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> Add(i, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行 <code>goroutine.go</code> 文件会发现屏幕上什么都没有，但程序并不会报错，这是什么原因呢？原来当主程序执行到 for 循环时启动了 10 个 <code>goroutine</code>，然后主程序就退出了，而启动的 10 个 <code>goroutine</code> 还没来得及执行 <code>Add()</code> 函数，所以程序不会有任何输出。也就是说主 <code>goroutine</code> 并不会等待其他 <code>goroutine</code> 执行结束。那么如何解决这个问题呢？Go 语言提供的信道（<code>channel</code>）就是专门解决并发通信问题的</p><h2 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h2><p><code>channel</code> 是<code>goroutine</code> 之间互相通讯的东西。类似我们 Unix 上的管道（可以在进程间传递消息），用来 <code>goroutine</code> 之间发消息和接收消息。其实，就是在做 <code>goroutine</code> 之间的内存共享。<code>channel</code> 是类型相关的，也就是说一个 <code>channel</code> 只能传递一种类型的值，这个类型需要在 <code>channel</code> 声明时指定。</p><h3 id="声明与初始化"><a href="#声明与初始化" class="headerlink" title="声明与初始化"></a>声明与初始化</h3><p><code>channel</code> 的一般声明形式：<strong>var</strong> chanName <strong>chan</strong> ElementType。</p><p>与普通变量的声明不同的是在类型前面加了 <code>channel</code> 关键字，<code>ElementType</code> 则指定了这个 <code>channel</code> 所能传递的元素类型。示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">chan</span> <span class="type">int</span> <span class="comment">//声明一个传递元素类型为int的channel</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">chan</span> <span class="type">float64</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">chan</span> <span class="type">string</span></span><br></pre></td></tr></table></figure><p>初始化一个 <code>channel</code> 也非常简单，直接使用 Go 语言内置的 <code>make()</code> 函数，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) <span class="comment">//初始化一个int型的名为a的channel</span></span><br><span class="line">b := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">float64</span>)</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br></pre></td></tr></table></figure><p><code>channel</code> 最频繁的操作就是写入和读取，这两个操作也非常简单，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">a &lt;- <span class="number">1</span>  <span class="comment">//将数据写入channel</span></span><br><span class="line">z := &lt;-a  <span class="comment">//从channel中读取数据</span></span><br></pre></td></tr></table></figure><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p><code>select</code> 用于处理异步 IO 问题，它的语法与 <code>switch</code> 非常类似。由 <code>select</code> 开始一个新的选择块，每个选择条件由 <code>case</code> 语句来描述，并且每个 <code>case</code> 语句里必须是一个 <code>channel</code> 操作。它既可以用于 <code>channel</code> 的数据接收，也可以用于 <code>channel</code> 的数据发送。如果 <code>select</code> 的多个分支都满足条件，则会随机的选取其中一个满足条件的分支。</p><p>新建源文件 <code>channel.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;time&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">        c1 &lt;- <span class="string">&quot;one&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">        c2 &lt;- <span class="string">&quot;two&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;-c1:</span><br><span class="line">            fmt.Println(<span class="string">&quot;received&quot;</span>, msg1)</span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;-c2:</span><br><span class="line">            fmt.Println(<span class="string">&quot;received&quot;</span>, msg2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码先初始化两个 <code>channel</code> c1 和 c2，然后开启两个 <code>goroutine</code> 分别往 c1 和 c2 写入数据，再通过 <code>select</code> 监听两个 <code>channel</code>，从中读取数据并输出。</p><p>运行结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run channel.go</span><br><span class="line">received one</span><br><span class="line">received two</span><br></pre></td></tr></table></figure><h2 id="超时机制"><a href="#超时机制" class="headerlink" title="超时机制"></a>超时机制</h2><p>通过前面的内容我们了解到，<code>channel</code> 的读写操作非常简单，只需要通过 <code>&lt;-</code> 操作符即可实现，但是 <code>channel</code> 的使用不当却会带来大麻烦。我们先来看之前的一段代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">a &lt;- <span class="number">1</span></span><br><span class="line">z := &lt;-a</span><br></pre></td></tr></table></figure><p>观察上面三行代码，第 2 行往 <code>channel</code> 内写入了数据，第 3 行从 <code>channel</code> 中读取了数据，如果程序运行正常当然不会出什么问题，可如果第二行数据写入失败，或者 <code>channel</code> 中没有数据，那么第 3 行代码会因为永远无法从 <code>a</code> 中读取到数据而一直处于阻塞状态。相反的，如果 <code>channel</code> 中的数据一直没有被读取，那么写入操作也会一直处于阻塞状态。如果不正确处理这个情况，很可能会导致整个 <code>goroutine</code> 锁死，这就是超时问题。Go 语言没有针对超时提供专门的处理机制，但是我们却可以利用 <code>select</code> 来巧妙地实现超时处理机制，下面看一个示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span></span> &#123;</span><br><span class="line">    time.Sleep(<span class="number">1e9</span>) <span class="comment">//等待1秒</span></span><br><span class="line">    t &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ch:  <span class="comment">//从ch中读取数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> &lt;-t:  <span class="comment">//如果1秒后没有从ch中读取到数据，那么从t中读取，并进行下一步操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样的方法就可以让程序在等待 1 秒后继续执行，而不会因为 ch 读取等待而导致程序停滞，从而巧妙地实现了超时处理机制，这种方法不仅简单，在实际项目开发中也是非常实用的。</p><h4 id="channel-的关闭"><a href="#channel-的关闭" class="headerlink" title="channel 的关闭"></a>channel 的关闭</h4><p><code>channel</code> 的关闭非常简单，使用 Go 语言内置的 <code>close()</code> 函数即可关闭 <code>channel</code>，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure><p>关闭了 <code>channel</code> 后如何查看 <code>channel</code> 是否关闭成功了呢？很简单，我们可以在读取 <code>channel</code> 时采用多重返回值的方式，示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x, ok := &lt;-ch</span><br></pre></td></tr></table></figure><p>通过查看第二个返回值的 <code>bool</code> 值即可判断 <code>channel</code> 是否关闭，若为 <code>false</code> 则表示 <code>channel</code> 被关闭，反之则没有关闭。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> 并发与并行 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go简明手册概要</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Readme/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Readme/</url>
      
        <content type="html"><![CDATA[<p><a href="./Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/readme.md">Go语言基础</a><br><a href="./Go%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/readme.md">Go语言介绍</a><br><a href="./Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/readme.md">Go语言顺序编程</a><br><a href="./%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C/readme.md">并发与并行</a><br><a href="./%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/readme.md">词频统计综合案例</a><br><a href="./%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/readme.md">面向对象编程</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/README/</url>
      
        <content type="html"><![CDATA[<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理*"></a>错误处理<code>*</code></h2><blockquote><p>错误处理是任何语言都需要考虑到的问题，而 Go 语言在错误处理上解决得更为完善，优雅的错误处理机制是 Go 语言的一大特点。</p></blockquote><h4 id="error"><a href="#error" class="headerlink" title="error"></a>error</h4><p>Go 语言引入了一个错误处理的标准模式，即 <code>error</code> 接口，该接口定义如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于大多数函数，如果要返回错误，可以将 <code>error</code> 作为多返回值的最后一个：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(param <span class="type">int</span>)</span></span>(ret <span class="type">int</span>, err <span class="type">error</span>)</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用时的代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n, err := foo(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">//  错误处理</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 使用返回值n</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们还可以自定义错误类型，创建源文件 <code>error.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义的出错结构</span></span><br><span class="line"><span class="keyword">type</span> myError <span class="keyword">struct</span> &#123;</span><br><span class="line">    arg  <span class="type">int</span></span><br><span class="line">    errMsg <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现Error接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *myError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%d - %s&quot;</span>, e.arg, e.errMsg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//两种出错</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">error_test</span><span class="params">(arg <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> arg &lt; <span class="number">0</span>  &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">-1</span>, errors.New(<span class="string">&quot;Bad Arguments - negtive!&quot;</span>)</span><br><span class="line">     &#125;<span class="keyword">else</span> <span class="keyword">if</span> arg &gt;<span class="number">256</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>, &amp;myError&#123;arg, <span class="string">&quot;Bad Arguments - too large!&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arg*arg, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//相关的测试</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="type">int</span>&#123;<span class="number">-1</span>, <span class="number">4</span>, <span class="number">1000</span>&#125; &#123;</span><br><span class="line">        <span class="keyword">if</span> r, e := error_test(i); e != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;failed:&quot;</span>, e)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;success:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> 错误处理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go顺序编程——流程控制</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/README/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>Go 语言提供的流程控制语句包括 <code>if</code>、<code>switch</code>、<code>for</code>、<code>goto</code>、<code>select</code>，其中 <code>select</code> 用于监听 <code>channel</code>（通道）在讲解通道的时候再详细介绍。</p><h4 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h4><p>语法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> optionalStatement1; booleanExpression1 &#123;</span><br><span class="line">    block1</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> optionalStatement2; booleanExpression2 &#123;</span><br><span class="line">    block2</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    block3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 <code>optionalStatement</code> 是可选的表达式，真正决定分支走向的是 <code>booleanExpression1</code> 的值。</p><h4 id="for-语句"><a href="#for-语句" class="headerlink" title="for 语句"></a>for 语句</h4><p>Go 语言的 <code>for</code> 语句可以遍历数组，切片，映射等类型，也可以用于无限循环。以下是其语法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123; <span class="comment">// 无限循环</span></span><br><span class="line">    block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> booleanExpression &#123; <span class="comment">// while循环，在Go语言中没有while关键字</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, char := <span class="keyword">range</span> aString &#123; <span class="comment">// 迭代字符串</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item := <span class="keyword">range</span> aChannel &#123; <span class="comment">// 迭代通道</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h4><p>Go 语言中使用 <code>goto</code> 关键字实现跳转。<code>goto</code> 语句的语义非常简单，就是跳转到本函数内的某个标签，例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myfunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    THIS: <span class="comment">//定义一个THIS标签</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">goto</span> THIS <span class="comment">//跳转到THIS标签</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> 流程控制 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go顺序编程——类型转换</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/Readme/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/Readme/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h1><p>Go 语言提供了一种在不同但相互兼容的类型之间相互转换的方式，这种转换非常有用并且是安全的。但是需要注意的是在数值之间进行转换可能造成其他问题，如精度丢失或者错误的结果。以下是类型转换的语法：</p><ul><li><code>resultOfType := Type(expression)</code></li></ul><p>几个例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x := <span class="type">int16</span>(<span class="number">2345</span>)        <span class="comment">// 声明一个类型为int16的整数，其值为2345</span></span><br><span class="line">y := <span class="type">int32</span>(x)           <span class="comment">// 将int16类型的整数转换为int32类型</span></span><br><span class="line">a := <span class="type">uint16</span>(<span class="number">65000</span>)       <span class="comment">// 声明一个类型为uint16类型的整数</span></span><br><span class="line">b := <span class="type">int16</span>(a)           <span class="comment">// 转换为int16类型，虽然能转换成功，但是由于65000超过in16类型的范围，会导致结果错误，b的值为 -536</span></span><br></pre></td></tr></table></figure><p>另外在 Go 语言中可以通过 <code>type</code> 关键字声明类型，如 <code>type StringsSlice []string</code> 将 <code>[]string</code>（<code>string</code> 类型的切片）声明为 <code>StringSlice</code> 类型。</p><h1 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h1><p>说到类型断言就需要先了解下 Go 语言中的接口。在 Go 语言中接口是一个自定义类型。它声明了一个或者多个方法。任何实现了这些方法的对象（类型）都满足这个接口。</p><p>接口是完全抽象的，不能实例化。<code>interface&#123;&#125;</code> 类型表示一个空接口，任何类型都满足空接口。也就是说 <code>interface&#123;&#125;</code> 类型的值可以用于表示任意 Go 语言类型的值。</p><p>这里的空接口有点类似于 Python 语言中的 object 实例。既然 <code>interface&#123;&#125;</code> 可以用于表示任意类型，那有的时候我们需要将 <code>interface&#123;&#125;</code> 类型转换为我们需要的类型，这个操作称为类型断言。</p><p><strong>一般情况下只有我们希望表达式是某种特定类型的值时才使用类型断言</strong>。Go 语言中可以使用以下语法：</p><ul><li><code>resultOfType, boolean := expression.(Type)</code>：安全的类型断言。</li><li><code>resultOfType := expression.(Type)</code>：非安全的类型断言，失败时程序会产生异常。</li></ul><p>创建源文件 <code>type_t.go</code>，输入以下源文件：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="type">uint16</span>(<span class="number">65000</span>)</span><br><span class="line">    y := <span class="type">int16</span>(x) <span class="comment">// 将 x转换为int16类型</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type and value of x is: %T and %d\n&quot;</span>, x, x) <span class="comment">// %T 格式化指令的作用是输出变量的类型</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type and value of y is: %T and %d\n&quot;</span>, y, y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="number">99</span> <span class="comment">// 创建一个interface&#123;&#125;类型，其值为99</span></span><br><span class="line">    <span class="keyword">var</span> s <span class="keyword">interface</span>&#123;&#125; = []<span class="type">string</span>&#123;<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>&#125;</span><br><span class="line">    j := i.(<span class="type">int</span>) <span class="comment">// 我们假设i是兼容int类型，并使用类型断言将其转换为int类型</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type and value of j is: %T and %d\n&quot;</span>, j, j)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s, ok := s.([]<span class="type">string</span>); ok &#123; <span class="comment">// 创建了影子变量，if的作用域中覆盖了外部的变量s</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;%T -&gt; %q\n&quot;</span>, s, s)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行程序：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go run type_t.go</span><br><span class="line"><span class="built_in">type</span> and value of x is: uint16 and 65000</span><br><span class="line"><span class="built_in">type</span> and value of y is: int16 and -536</span><br><span class="line"><span class="built_in">type</span> and value of j is: int and 99</span><br><span class="line">[]string -&gt; [<span class="string">&quot;left&quot;</span> <span class="string">&quot;right&quot;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> 类型转换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go顺序编程——函数的多返回值</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E5%87%BD%E6%95%B0%E7%9A%84%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/%E5%87%BD%E6%95%B0%E7%9A%84%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC/README/</url>
      
        <content type="html"><![CDATA[<p>与 C&#x2F;C++ 和 JAVA 不同，Go 语言的函数和方法可以有多个返回值，这是 Go 提供的一个优美的特性，示例如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Divide</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span> <span class="params">(a <span class="type">int</span>, b <span class="type">int</span>)</span></span> (num <span class="type">int</span>, err <span class="type">error</span>)&#123; <span class="comment">//定义两个返回值</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        err = errors.New(<span class="string">&quot;被除数不能为零！&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span>   <span class="comment">//支持多个返回值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><p>在 Go 语言中，你可以在代码里随时定义匿名函数，匿名函数由一个不带函数名的函数声明和函数体组成，示例如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a, b, c <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b &lt; c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你可以将匿名函数直接赋值给一个变量，也可以直接调用运行，示例如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x := <span class="function"><span class="keyword">func</span> <span class="params">(a, b, c <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b &lt; c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a, b, c <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b &lt; c</span><br><span class="line">&#125; (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="comment">//小括号内直接给参数列表表示函数调用</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> 函数的多返回值 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go顺序编程——Go语言顺序编程</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/readme/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/readme/</url>
      
        <content type="html"><![CDATA[<h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ul><li>流程控制</li><li>函数</li><li>类型转换</li><li>类型断言</li><li>error</li><li>defer 和 panic</li></ul><h3 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h3><p><a href="./panic%E5%92%8Cdefer/README">panic和defer</a><br><a href="./%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/README">错误处理</a><br><a href="./%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/README">类型转换</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go顺序编程——switch语句</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/switch%E8%AF%AD%E5%8F%A5/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/switch%E8%AF%AD%E5%8F%A5/README/</url>
      
        <content type="html"><![CDATA[<p>Go 语言中 <code>switch</code> 分支既可用于常用的分支就像 C 语言中的 <code>switch</code> 一样，也可以用于类型开关，所谓类型开关就是用于判断变量属于什么类型。但是需要注意的是 Go 语言的 <code>switch</code> 语句不会自动贯穿，相反，如果想要贯穿需要添加 <code>fallthrough</code> 语句。表达式开关 <code>switch</code> 的语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> optionalStatement; optionalExpression &#123;</span><br><span class="line">    <span class="keyword">case</span> expression1: block1</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">case</span> expressionN: blockN</span><br><span class="line">    <span class="keyword">default</span>: blockD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是个例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> &#123;        <span class="comment">// 没有表达式，默认为True值，匹配分支中值为True的分支</span></span><br><span class="line">    <span class="keyword">case</span> value &lt; minimum:</span><br><span class="line">        <span class="keyword">return</span> minimum</span><br><span class="line">    <span class="keyword">case</span> value &gt; maximum:</span><br><span class="line">        <span class="keyword">return</span> maximum</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的例子中，switch 后面没有默认的表达式，这个时候 Go 语言默认其值为 <code>True</code>。</p><p>在前面我们提到过类型断言，如果我们知道变量的类型就可以使用类型断言，但是当我们知道类型可能是许多类型中的一种时候，我们就可以使用类型开关。其语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> optionalStatement; typeSwitchGuard &#123;</span><br><span class="line">    <span class="keyword">case</span> type1: block1</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">case</span> typeN: blockN</span><br><span class="line">    <span class="keyword">default</span>: blockD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说了这么多，让我们进行下练习，创建源文件 <code>switch_t.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">classchecker</span><span class="params">(items ...<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123; <span class="comment">// 创建一个函数，该函数可以接受任意多的任意类型的参数</span></span><br><span class="line">    <span class="keyword">for</span> i, x := <span class="keyword">range</span> items &#123;</span><br><span class="line">        <span class="keyword">switch</span> x := x.(<span class="keyword">type</span>) &#123; <span class="comment">// 创建了影子变量</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">bool</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a bool, value: %t\n&quot;</span>, i, x)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">float64</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a float64, value: %f\n&quot;</span>, i, x)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">int</span>, <span class="type">int8</span>, <span class="type">int16</span>, <span class="type">int32</span>, <span class="type">int64</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a int, value: %d\n&quot;</span>, i, x)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">uint</span>, <span class="type">uint8</span>, <span class="type">uint16</span>, <span class="type">uint32</span>, <span class="type">uint64</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a uint, value: %d\n&quot;</span>, i, x)</span><br><span class="line">        <span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a nil\n&quot;</span>, i)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d is a string, value: %s\n&quot;</span>, i, x)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;param #%d&#x27;s type is unknow\n&quot;</span>, i)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    classchecker(<span class="number">5</span>, <span class="number">-17.98</span>, <span class="string">&quot;AIDEN&quot;</span>, <span class="literal">nil</span>, <span class="literal">true</span>, <span class="built_in">complex</span>(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码中我们首先创建了一个接收任意数量任意类型参数的函数，然后使用 <code>for ... range aSlice</code> 的语法迭代了每一个在切片 <code>items</code> 中的元素，接着使用了 <code>switch</code> 类型开关判断了每一个参数的类型，并打印了其值和类型。程序运行输出如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run switch_t.<span class="keyword">go</span></span><br><span class="line">param #<span class="number">0</span> is a <span class="type">int</span>, value: <span class="number">5</span></span><br><span class="line">param #<span class="number">1</span> is a <span class="type">float64</span>, value: <span class="number">-17.980000</span></span><br><span class="line">param #<span class="number">2</span> is a <span class="type">string</span>, value: AIDEN</span><br><span class="line">param #<span class="number">3</span> is a <span class="literal">nil</span></span><br><span class="line">param #<span class="number">4</span> is a <span class="type">bool</span>, value: <span class="literal">true</span></span><br><span class="line">param #<span class="number">5</span><span class="string">&#x27;s type is unknow</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> switch语句 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go基本语法——格式化字符串</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>Go 语言标准库中的 <code>fmt</code> 包提供了打印函数将数据以字符串形式输出到控制台，文件，其他满足 <code>io.Writer</code> 接口的值以及其他字符串。目前为止我们使用了 <code>fmt.Printf</code> 和 <code>fmt.Println</code>，对于前者的使用，就像 C 语言中的 <code>printf</code> 函数一样，我们可以提供一些格式化指令，让 Go 语言对输出的字符串进行格式化。同样的我们可以使用一些格式化修饰符，改变格式化指令的输出结果， 如左对齐等。常用的格式化指令如下：</p><table><thead><tr><th>格式化指令</th><th>含义</th></tr></thead><tbody><tr><td><code>%%</code></td><td>% 字面量</td></tr><tr><td><code>%b</code></td><td>一个二进制整数，将一个整数格式化为二进制的表达方式</td></tr><tr><td><code>%c</code></td><td>一个 Unicode 的字符</td></tr><tr><td><code>%d</code></td><td>十进制数值</td></tr><tr><td><code>%o</code></td><td>八进制数值</td></tr><tr><td><code>%x</code></td><td>小写的十六进制数值</td></tr><tr><td><code>%X</code></td><td>大写的十六进制数值</td></tr><tr><td><code>%U</code></td><td>一个 Unicode 表示法表示的整形码值，默认是 4 个数字字符</td></tr><tr><td><code>%s</code></td><td>输出以原生的 UTF-8 字节表示的字符，如果 console 不支持 UTF-8 编码，则会输出乱码</td></tr><tr><td><code>%t</code></td><td>以 true 或者 false 的方式输出布尔值</td></tr><tr><td><code>%v</code></td><td>使用默认格式输出值，或者使用类型的 String() 方法输出的自定义值，如果该方法存在的话</td></tr><tr><td>%T</td><td>输出值的类型</td></tr></tbody></table><p>常用的格式化指令修饰符如下：</p><ul><li><p><code>空白</code> 如果输出的数字为负，则在其前面加上一个减号 <code>-</code>。如果输出的是整数，则在前面加一个空格。使用 <code>%x</code> 或者 <code>%X</code> 格式化指令输出时，会在结果之间添加一个空格。例如 <code>fmt.Printf(&quot;% X&quot;, &quot;实&quot;)</code> 输出 E5 AE 9E。</p></li><li><pre><code>#<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - `%#o` 输出以 `0` 开始的八进制数据。</span><br><span class="line">  - `%#x` 输出以 `0x` 开始的十六进制数据。</span><br><span class="line"></span><br><span class="line">- `+` 让格式化指令在数值前面输出 `+` 号或者 `-` 号，为字符串输出 ASCII 字符（非 ASCII 字符会被转义），为结构体输出其字段名。</span><br><span class="line"></span><br><span class="line">- `-` 让格式化指令将值向左对齐（默认值为像右对齐）。</span><br><span class="line"></span><br><span class="line">- `0` 让格式指令以数字 0 而非空白进行填充。</span><br><span class="line"></span><br><span class="line">让我们练习一下，创建源文件 `fmt_t.go`，输入以下源码：</span><br><span class="line"></span><br><span class="line">```go</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    text := &quot;\u5B9E\u9A8C\u697C&quot;</span><br><span class="line">    fmt.Printf(&quot;bool output:\n%t\n%t\n\n&quot;, true, false)</span><br><span class="line">    fmt.Println(&quot;number output, origin value: 64&quot;)</span><br><span class="line">    fmt.Printf(&quot;|%b|%8b|%-8b|%08b|% 8b|\n&quot;, 64, 64, 64, 64, 64)</span><br><span class="line">    fmt.Printf(&quot;|%x|%8x|%-8x|%08X|% 8X|\n\n&quot;, 64, 64, 64, 64, 64)</span><br><span class="line">    fmt.Println(`text output, origin value: \u5B9E\u9A8C\u697C`)</span><br><span class="line">    fmt.Printf(&quot;content: %s\n&quot;, text)</span><br><span class="line">    fmt.Printf(&quot;hex value: % X\nUnicode value: &quot;, text)</span><br><span class="line">    for _, char := range text &#123;</span><br><span class="line">        fmt.Printf(&quot;%U &quot;, char)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println()</span><br><span class="line">    bytes := []byte(text)</span><br><span class="line">    fmt.Printf(&quot;value of bytes: %s\n&quot;, bytes)</span><br><span class="line">    fmt.Printf(&quot;hex value of bytes: % X\n&quot;, bytes)</span><br><span class="line">    fmt.Printf(&quot;origin value of bytes: %v\n&quot;, bytes)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p>运行代码，输出如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ go run fmt_t.go</span><br><span class="line">bool output:</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"></span><br><span class="line">number output, origin value: 64</span><br><span class="line">|1000000| 1000000|1000000 |01000000| 1000000|</span><br><span class="line">|40|      40|40      |00000040|      40|</span><br><span class="line"></span><br><span class="line">text output, origin value: \u5B9E\u9A8C\u697C</span><br><span class="line">content: 实验楼</span><br><span class="line">hex value: E5 AE 9E E9 AA 8C E6 A5 BC</span><br><span class="line">Unicode value: U+5B9E U+9A8C U+697C</span><br><span class="line">value of bytes: 实验楼</span><br><span class="line">hex value of bytes: E5 AE 9E E9 AA 8C E6 A5 BC</span><br><span class="line">origin value of bytes: [229 174 158 233 170 140 230 165 188]</span><br></pre></td></tr></table></figure><p>代码一目了然，就不详细解释了。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言基础 </category>
          
          <category> 格式化字符串 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/panic%E5%92%8Cdefer/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E9%A1%BA%E5%BA%8F%E7%BC%96%E7%A8%8B/panic%E5%92%8Cdefer/README/</url>
      
        <content type="html"><![CDATA[<h1 id="panic-和-recover"><a href="#panic-和-recover" class="headerlink" title="panic 和 recover"></a><code>panic</code> 和 <code>recover</code></h1><p><code>panic()</code> 函数用于抛出异常，<code>recover()</code> 函数用于捕获异常，这两个函数的原型如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panic</span><span class="params">(<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recover</span><span class="params">()</span></span> <span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>当在一个函数中调用 <code>panic()</code> 时，正常的函数执行流程将立即终止，但函数中之前使用 <code>defer</code> 关键字延迟执行的语句将正常展开执行，之后该函数将返回到调用函数，并导致逐层向上执行 <code>panic()</code> 流程，直至所属的 <code>goroutine</code> 中所有正在执行的函数被终止。错误信息将被报告，包括在调用 <code>panic()</code> 函数时传入的参数，这个过程称为错误流程处理。</p><p><code>panic()</code> 接受一个 <code>interface&#123;&#125;</code> 参数，可支持任意类型，例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">panic</span>(<span class="number">404</span>)</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;network broken&quot;</span>)</span><br><span class="line"><span class="built_in">panic</span>(Error(<span class="string">&quot;file not exists&quot;</span>))</span><br></pre></td></tr></table></figure><p>在 <code>defer</code> 语句中，可以使用 <code>recover()</code> 终止错误处理流程，这样可以避免异常向上传递，但要注意 <code>recover()</code> 之后，程序不会再回到 <code>panic()</code> 那里，函数仍在 <code>defer</code> 之后返回。新建一个源文件 <code>error1.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(errors.New(<span class="string">&quot;i&#x27;m a bug&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> (result <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            err := r.(<span class="type">error</span>)</span><br><span class="line">            fmt.Println(<span class="string">&quot;Cache Exception:&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    foo()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(test())     <span class="comment">// 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言顺序编程 </category>
          
          <category> panic和defer </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Go基本语法——字符类型</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>在 Go 语言中支持两个字符类型，一个是 <code>Byte</code>（实际上是 Unit8 的别名），代表 UTF-8 字符串的单个字节的值；另一个是 <code>rune</code>，代表单个 Unicode 字符。</p><p>处于简化语言的考虑，Go 语言的多数 API 都假设字符串为 UTF-8 编码。尽管 Unicode 字符在标准库中有支持，但实际很少使用。</p><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>Go 语言的数组是一个定长的序列，其中的元素类型相同。多维数组可以简单地使用自身为数组的元素来创建。数组的元素使用操作符号 <code>[ ]</code> 来索引，索引从 <code>0</code> 开始，到 <code>len(array)-1</code> 结束。数组使用以下语法创建：</p><ul><li><code>[length]Type</code></li><li><code>[N]Type&#123;value1, value2, ..., valueN&#125;</code></li><li><code>[...]Type&#123;value1, value2, ..., valueN&#125;</code></li></ul><p>如果使用了 <code>...</code>（省略符）操作符，Go 语言会为我们自动计算数组的长度。在任何情况下，一个数组的长度都是固定的并且不可修改。数组的长度可以使用 <code>len()</code> 函数获得。由于数组的长度是固定的，因此数组的长度和容量都是一样的，因此对于数组而言 <code>cap()</code> 和 <code>len()</code> 函数返回值都是一样的。数组也可以使用和切片一样的语法进行切片，只是其结果为一个切片，而非数组。同样的，数组也可以使用 <code>range</code> 进行索引访问。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言基础 </category>
          
          <category> 字符类型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go基本语法——字符串</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>Go 语言中的字符串是 UTF-8 字符的一个序列（当字符为 ASCII 码时则占用 1 个字节，其它字符根据需要占用 2-4 个字节）。UTF-8 是被广泛使用的编码格式，是文本文件的标准编码，其它包括 XML 和 JSON 在内，也都使用该编码。由于该编码对占用字节长度的不定性，Go 中的字符串也可能根据需要占用 1 至 4 个字节，这与其它语言如 C++、Java 或者 Python 不同。Go 这样做的好处是不仅减少了内存和硬盘空间占用，同时也不用像其它语言那样需要对使用 UTF-8 字符集的文本进行编码和解码。</p><p>Go 语言中字符串的可以使用双引号 (“) 或者反引号 (&#96;) 来创建。双引号用来创建可解析的字符串字面量，所谓可解析的是指字符串中的一些符号可以被格式化为其他内容，如 \n 在在输出时候会被格式化成换行符，如果需要按照原始字符输出必须进行转义。而反引号创建的字符串原始是什么样，那输出还是什么，不需要进行任何转义。以下是几个例子：</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t1 := <span class="string">&quot;\&quot;hello\&quot;&quot;</span>             <span class="comment">//内容： &quot;hello&quot;</span></span><br><span class="line">t2 := <span class="string">`&quot;hello&quot;`</span>               <span class="comment">//内容：和t1一致</span></span><br><span class="line">t3 := <span class="string">&quot;\u6B22\u8FCE&quot;</span>          <span class="comment">//内容：欢迎</span></span><br></pre></td></tr></table></figure><p>Go 语言中的部分转义字符如下表所示：</p><table><thead><tr><th>转义字符</th><th>含义</th></tr></thead><tbody><tr><td><code>\\</code></td><td>表示反斜线</td></tr><tr><td><code>\&#39;</code></td><td>单引号</td></tr><tr><td><code>\&quot;</code></td><td>双引号</td></tr><tr><td><code>\n</code></td><td>换行符</td></tr><tr><td><code>\uhhhh</code></td><td>4 个 16 进制数字给定的 Unicode 字符</td></tr></tbody></table><p>在 Go 语言中单个字符可以使用单引号 (‘) 来创建。之前的课程中，我们有学习过 rune 类型，它等同于 int32，在 Go 语言中，一个单一的字符可以用一个单一的 rune 来表示。这也是容易理解的，因为 Go 语言的字符串是 UTF-8 编码，其底层使用 4 个字节表示，也就是 32 bit。</p><p>在 Go 语言中，字符串支持切片操作，但是需要注意的是如果字符串都是由 ASCII 字符组成，那可以随便使用切片进行操作，但是如果字符串中包含其他非 ASCII 字符，直接使用切片获取想要的单个字符时需要十分小心，因为对字符串直接使用切片时是通过字节进行索引的，但是非 ASCII 字符在内存中可能不是由一个字节组成。如果想对字符串中字符依次访问，可以使用 range 操作符。另外获取字符串的长度可能有两种含义，一种是指获取字符串的字节长度，一种是指获取字符串的字符数量。字符串支持以下操作：</p><table><thead><tr><th>语法</th><th>描述</th></tr></thead><tbody><tr><td><code>s += t</code></td><td>将字符串 t 追加到 s 末尾</td></tr><tr><td><code>s + t</code></td><td>将字符串 s 和 t 级联</td></tr><tr><td><code>s[n]</code></td><td>从字符串 s 中索引位置为 n 处的原始字节</td></tr><tr><td><code>s[n:m]</code></td><td>从位置 n 到位置 <code>m-1</code> 处取得的字符（字节）串</td></tr><tr><td><code>s[n:]</code></td><td>从位置 n 到位置 <code>len(s)-1</code> 处取得的字符（字节）串</td></tr><tr><td><code>s[:m]</code></td><td>从位置 0 到位置 <code>m-1</code> 处取得的字符（字节）串</td></tr><tr><td><code>len(s)</code></td><td>字符串 s 中的字节数</td></tr><tr><td><code>len([]rune(s))</code></td><td>字符串 s 中字符的个数，可以使用更快的方法 <code>utf8.RuneCountInString()</code></td></tr><tr><td><code>[]rune(s)</code></td><td>将字符串 s 转换为一个 unicode 值组成的串</td></tr><tr><td><code>string(chars)</code></td><td>chars 类型是 <code>[]rune</code> 或者 <code>[]int32</code>, 将之转换为字符串</td></tr><tr><td><code>[]byte(s)</code></td><td>无副本的将字符串 s 转换为一个原始的字节的切片数组，不保证转换的字节是合法的 UTF-8 编码字节</td></tr></tbody></table><p>让我们尝试一个例子，创建源文件 string_t.go，然后输入以下源代码：</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t0 := <span class="string">&quot;\u6B22\u8FCE\u6765\u5230&quot;</span> <span class="comment">// t0内容：欢迎来到</span></span><br><span class="line">    t1 := <span class="string">&quot;\u5B9E\u9A8C\u697C&quot;</span>       <span class="comment">// t1内容：实验楼</span></span><br><span class="line">    t2 := t0 + t1</span><br><span class="line">    <span class="keyword">for</span> index, char := <span class="keyword">range</span> t2 &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%-2d    %U      &#x27;%c&#x27;    %X      %d\n&quot;</span>,</span><br><span class="line">            index, char, char, []<span class="type">byte</span>(<span class="type">string</span>(char)), <span class="built_in">len</span>([]<span class="type">byte</span>(<span class="type">string</span>(char))))</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;length of t0: %d, t1: %d, t2: %d\n&quot;</span>, <span class="built_in">len</span>(t0), <span class="built_in">len</span>(t1), <span class="built_in">len</span>(t2))</span><br><span class="line">    fmt.Printf(<span class="string">&quot;content of t2[0:2] is: %X\n&quot;</span>, t2[<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后通过以下方式运行，在这里一起显示了程序的输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ go run string_t.go</span><br><span class="line">0     U+6B22      <span class="string">&#x27;欢&#x27;</span>    E6ACA2      3</span><br><span class="line">3     U+8FCE      <span class="string">&#x27;迎&#x27;</span>    E8BF8E      3</span><br><span class="line">6     U+6765      <span class="string">&#x27;来&#x27;</span>    E69DA5      3</span><br><span class="line">9     U+5230      <span class="string">&#x27;到&#x27;</span>    E588B0      3</span><br><span class="line">12    U+5B9E      <span class="string">&#x27;实&#x27;</span>    E5AE9E      3</span><br><span class="line">15    U+9A8C      <span class="string">&#x27;验&#x27;</span>    E9AA8C      3</span><br><span class="line">18    U+697C      <span class="string">&#x27;楼&#x27;</span>    E6A5BC      3</span><br><span class="line">length of t0: 12, t1: 9, t2: 21</span><br><span class="line">content of t2[0:2] is: E6AC</span><br></pre></td></tr></table></figure><p>说明：</p><p>通过前面的课程我们知道通过 \uhhhh 的方式我们可以通过创建 Unicode 字符。</p><p>在以上程序中，首先通过 :&#x3D; 符号创建了变量 t0，其值为 \u6B22\u8FCE\u6765\u5230，是 欢迎来到 中文字符的 unicode 编码，然后以同样的方式创建了变量 t1，其值为 实验楼，然后通过 + 操作符将 t0 和t1 拼接赋值给 t2。然后我们通过 range 操作符号对 unicode 字符串 t2 中的每一个 unicode 字符依次操作，我们这里只是简单的打印出每个字符在 t2 中的位置，每个字符的 unicode 码值，每个字符的字面量，每个字符的十六进制值，以及每个字符的字节长度。</p><p>这里我们使用 fmt 包种支持的格式指令，如果读者学习过 C 语言的话就一目了然。接着，我们通过 len 操作符计算出了每个字符串的字节长度。最后，我们使用切片访问了字符串 t2 的第 0-1 个字节，也就是前两个字节，其内容为 E6AC。前面我们说到不能使用切片的方式访问非 ASCII 字符串中的字符，原因在这里一目了然。字符 欢 其底层使用了三个字节表示，内容是 E6ACA2，如果只是简单的使用切片（只取切片中的一项）访问的是不能访问到整个字符的，因为字符的切片是通过字节数来索引的。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言基础 </category>
          
          <category> 字符串 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go基本语法——切片</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%88%87%E7%89%87/%E5%88%87%E7%89%87/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/%E5%88%87%E7%89%87/%E5%88%87%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>一般而言，Go 语言的切片比数组更加灵活，强大而且方便。数组是按值传递的（即是传递的副本），而切片是引用类型，传递切片的成本非常小，而且是不定长的。而且数组是定长的，而切片可以调整长度。创建切片的语法如下：</p><ul><li><code>make([ ]Type, length, capacity)</code></li><li><code>make([ ]Type, length)</code></li><li><code>[ ]Type&#123;&#125;</code></li><li><code>[ ]Type&#123;value1, value2, ..., valueN&#125;</code></li></ul><p>内置函数 <code>make()</code> 用于创建切片、映射和通道。当用于创建一个切片时，它会创建一个隐藏的初始化为零值的数组，然后返回一个引用该隐藏数组的切片。该隐藏的数组与 Go 语言中的所有数组一样，都是固定长度，如果使用第一种语法创建，那么其长度为切片的容量 <code>capacity</code>；如果是第二种语法，那么其长度记为切片的长度 <code>length</code>。一个切片的容量即为隐藏数组的长度，而其长度则为不超过该容量的任意值。另外可以通过内置的函数 <code>append()</code> 来增加切片的容量。切片可以支持以下操作：</p><p>我们练习下，创建源文件 <code>slice_array.go</code>，输入以下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;len and cap of array %v is: %d and %d\n&quot;</span>, a, <span class="built_in">len</span>(a), <span class="built_in">cap</span>(a))</span><br><span class="line">    fmt.Printf(<span class="string">&quot;item in array: %v is:&quot;</span>, a)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> a &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;% d&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    s1 := a[<span class="number">3</span>:<span class="number">6</span>]</span><br><span class="line">    fmt.Printf(<span class="string">&quot;len and cap of slice: %v is: %d and %d\n&quot;</span>, s1, <span class="built_in">len</span>(s1), <span class="built_in">cap</span>(s1))</span><br><span class="line">    fmt.Printf(<span class="string">&quot;item in slice: %v is:&quot;</span>, s1)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> s1 &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    s1[<span class="number">0</span>] = <span class="number">456</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;item in array changed after changing slice: %v is:&quot;</span>, s1)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> a &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    s2 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">    s2[<span class="number">4</span>] = <span class="number">5</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;len and cap of slice: %v is: %d and %d\n&quot;</span>, s2, <span class="built_in">len</span>(s2), <span class="built_in">cap</span>(s2))</span><br><span class="line">    fmt.Printf(<span class="string">&quot;item in slice %v is:&quot;</span>, s2)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> s2 &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码中，我们首先创建了一个数组，数组的长度是由 Go 语言自动计算出的（省略号语法），然后通过切片操作从数组 <code>a</code> 中创建了切片 <code>s1</code>，接着我们修改了该切片的第一个位置的数值，然后发现数组 <code>a</code> 中的值也发生了变化。最后我们通过 <code>make()</code> 函数创建了一个切片，该切片的长度和容量分别为 10 和 20，还可以发现 Go 语言将未初始化的项自动赋予零值。运行代码输出如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$  go run slice_array.go</span><br><span class="line">len and <span class="built_in">cap</span> of array [1 2 3 4 5 6 7] is: 7 and 7</span><br><span class="line">item <span class="keyword">in</span> array: [1 2 3 4 5 6 7] is: 1 2 3 4 5 6 7</span><br><span class="line">len and <span class="built_in">cap</span> of slice: [4 5 6] is: 3 and 4</span><br><span class="line">item <span class="keyword">in</span> slice: [4 5 6] is: 4 5 6</span><br><span class="line">item <span class="keyword">in</span> array changed after changing slice: [456 5 6] is: 1 2 3 456 5 6 7</span><br><span class="line">len and <span class="built_in">cap</span> of slice: [0 0 0 0 5 0 0 0 0 0] is: 10 and 20</span><br><span class="line">item <span class="keyword">in</span> slice [0 0 0 0 5 0 0 0 0 0] is: 0 0 0 0 5 0 0 0 0 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言基础 </category>
          
          <category> 切片 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go简明手册——Go创建并使用本地宝</title>
      <link href="/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/package/README/"/>
      <url>/Code/GO/Go%E7%AE%80%E6%98%8E%E6%89%8B%E5%86%8C/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/package/README/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="包"><a href="#包" class="headerlink" title="包"></a>包</h1><blockquote><p><strong>包</strong>是各种类型和函数的集合。在包中，如果标示符（类型名称，函数名称，方法名称）的首字母是大写，那这些标示符是可以被导出的，也就是说可以在包以外直接使用。</p></blockquote><p><code>$GOPATH</code> ：环境变量（指向一个或多个目录），以及其子目录 <code>src</code> 目录的，当我们使用 <code>import</code> 关键字导入包的时候，Go 语言会在 <code>$GOPATH</code> 和 <code>GOROOT</code> 目录中搜索包。</p><h1 id="创建并使用自定义包"><a href="#创建并使用自定义包" class="headerlink" title="创建并使用自定义包"></a>创建并使用自定义包</h1><blockquote><p><a href="./package.zip">源文件</a><br>注意点：</p><ol><li>go文件名和文件夹名并没有关系，文件名可以是任意的，文件定义的<code>package</code> 才是标识</li><li>方法定义一定得是首字母大写</li><li>自定义包不能和导入处于同级目录，必须建一个文件夹存放自定义包</li></ol></blockquote><p>先看一下目录结构，以下示例是导入两包，一个是<code>add</code>，一个是<code>simpleinterest</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">│  go.mod</span><br><span class="line">│  main.go</span><br><span class="line">│  README.md</span><br><span class="line">│</span><br><span class="line">├─add</span><br><span class="line">│      add.go</span><br><span class="line">│</span><br><span class="line">└─simpleinterest</span><br><span class="line">        simpleinterest.go</span><br></pre></td></tr></table></figure><h2 id="步骤说明"><a href="#步骤说明" class="headerlink" title="步骤说明"></a>步骤说明</h2><h3 id="1-创建package文件夹"><a href="#1-创建package文件夹" class="headerlink" title="1 创建package文件夹"></a>1 创建package文件夹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> package</span><br><span class="line"></span><br><span class="line">go mod init packagetest</span><br></pre></td></tr></table></figure><p>执行上述命令后，会生成 <code>go.mod</code> 文件，内容如下所示</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module packageTest</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.20</span></span><br></pre></td></tr></table></figure><h3 id="2-创建各个文件"><a href="#2-创建各个文件" class="headerlink" title="2 创建各个文件"></a>2 创建各个文件</h3><h4 id="main-go"><a href="#main-go" class="headerlink" title="main.go"></a>main.go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;packageTest/add&quot;</span> <span class="comment">//导入 add 包 这个包必须放在$GOPATH下才可</span></span><br><span class="line"><span class="string">&quot;packageTest/simpleinterest&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p, r, t = <span class="number">5000.0</span>, <span class="number">10.0</span>, <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* init function to check if p, r and t are greater than zero</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(<span class="string">&quot;Main package initialized&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> p &lt; <span class="number">0</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Principal is less than zero&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r &lt; <span class="number">0</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Rate of interest is less than zero&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> t &lt; <span class="number">0</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Duration is less than zero&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := add.Add(<span class="number">1</span>, <span class="number">2</span>)                      <span class="comment">//调用 add 包中的 add 函数</span></span><br><span class="line">si := simpleinterest.Calculate(p, r, t) <span class="comment">// 调用 simpleinterest 包的 Calculate 函数</span></span><br><span class="line">fmt.Println(c)</span><br><span class="line">fmt.Println(<span class="string">&quot;Simple interest is&quot;</span>, si)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="simpleinterest-x2F-simpleinterest-go"><a href="#simpleinterest-x2F-simpleinterest-go" class="headerlink" title="simpleinterest&#x2F;simpleinterest.go"></a>simpleinterest&#x2F;simpleinterest.go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> simpleinterest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * init function added</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Simple interest package initialized&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Calculate calculates and returns the simple interest for principal p, rate of interest r for time duration t years</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Calculate</span><span class="params">(p <span class="type">float64</span>, r <span class="type">float64</span>, t <span class="type">float64</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line">interest := p * (r / <span class="number">100</span>) * t</span><br><span class="line"><span class="keyword">return</span> interest</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="add-x2F-add-go"><a href="#add-x2F-add-go" class="headerlink" title="add&#x2F;add.go"></a>add&#x2F;add.go</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> add</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a <span class="type">int</span>, b <span class="type">int</span>)</span></span> (num <span class="type">int</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-执行并调试"><a href="#3-执行并调试" class="headerlink" title="3 执行并调试"></a>3 执行并调试</h3><p>输出如下所示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Main package initialized</span><br><span class="line">Simple interest package initialized</span><br><span class="line">3</span><br><span class="line">Simple interest is 500</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go简明手册 </category>
          
          <category> Go语言基础 </category>
          
          <category> package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go简明手册 </tag>
            
            <tag> go </tag>
            
            <tag> package </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go开发经验(1)</title>
      <link href="/Code/GO/Go%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Go%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C(1)/"/>
      <url>/Code/GO/Go%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Go%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C(1)/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="1-var-与-的区别"><a href="#1-var-与-的区别" class="headerlink" title="1 var 与 := 的区别"></a>1 <code>var</code> 与 <code>:=</code> 的区别</h1><p><strong><code>:= </code>只能在声明“局部变量”的时候使用，而“var”没有这个限制。</strong></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
          <category> Go开发经验 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>duilib 入门</title>
      <link href="/Code/Duilib/%E5%85%A5%E9%97%A8/"/>
      <url>/Code/Duilib/%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="开卷有益"><a href="#开卷有益" class="headerlink" title="开卷有益"></a>开卷有益</h1><p>🎈github： <a href="https://github.com/duilib/duilib">duilib&#x2F;duilib</a></p><p>📖说明：Duilib是一个Windows下免费开源的DirectUI界面库，由于简约易扩展的设计以及稳定高效的实现被各大互联网公司普遍接受，广泛应用于包括IM、视频客户端、股票行情软件、导航软件、手机辅助软件、安全软件等多个行业的众多PC客户端软件。Duilib还在不断的发展中，在文档、例子、动画、渲染引擎等多个方面将持续改进。</p><h2 id="基于Duilib的软件不完全列表"><a href="#基于Duilib的软件不完全列表" class="headerlink" title="基于Duilib的软件不完全列表"></a>基于Duilib的软件不完全列表</h2><p>Duilib自2010年8月21日发布以来，获得了众多开发者和大公司的信赖，在各行各业的软件中得到了广泛应用，以下是一个作者知道不完全列表，欢迎大家补充指正 <a href="https://github.com/duilib/duilib/wiki/%E5%9F%BA%E4%BA%8EDuilib%E7%9A%84%E8%BD%AF%E4%BB%B6%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%88%97%E8%A1%A8">https://github.com/duilib/duilib/wiki/%E5%9F%BA%E4%BA%8EDuilib%E7%9A%84%E8%BD%AF%E4%BB%B6%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%88%97%E8%A1%A8</a></p><p>下面两个修改版本大家可以参考一下</p><h2 id="腾讯使用的的duilib修改版"><a href="#腾讯使用的的duilib修改版" class="headerlink" title="腾讯使用的的duilib修改版"></a>腾讯使用的的duilib修改版</h2><p><a href="https://github.com/tencentyun/TIMSDK/tree/master/cross-platform/Windows/IMApp/Basic/duilib">https://github.com/tencentyun/TIMSDK/tree/master/cross-platform/Windows/IMApp/Basic/duilib</a></p><h2 id="网易使用的duilib修改版"><a href="#网易使用的duilib修改版" class="headerlink" title="网易使用的duilib修改版"></a>网易使用的duilib修改版</h2><p><a href="https://github.com/netease-im/NIM_Duilib_Framework/tree/master/duilib">https://github.com/netease-im/NIM_Duilib_Framework/tree/master/duilib</a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>使用<a href="https://github.com/Microsoft/vcpkg">vcpkg</a>库管理器下载并安装duilib:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Microsoft/vcpkg.git</span><br><span class="line"><span class="built_in">cd</span> vcpkg</span><br><span class="line">./bootstrap-vcpkg.sh</span><br><span class="line">./vcpkg integrate install</span><br><span class="line">./vcpkg install duilib</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> Duilib </category>
          
      </categories>
      
      
        <tags>
            
            <tag> duilib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO HACK PE文件分析</title>
      <link href="/Code/GO/GO_HACK_PEFILES/"/>
      <url>/Code/GO/GO_HACK_PEFILES/</url>
      
        <content type="html"><![CDATA[<p>使用 go 对 PE文件进行分析</p><ol><li>使用debug&#x2F;pe标准库进行解析</li><li>使用Reader对象对PE文件内容进行解析</li></ol><h1 id="PE文件结构"><a href="#PE文件结构" class="headerlink" title="PE文件结构"></a>PE文件结构</h1><ol><li>DOSheader 包含签名（0x5a4d）peheader(0x3c指向0x50 0x45 0x00 0x00)</li><li>dos stub</li><li>coff file header</li><li>optional header</li><li>section table</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pe头</span></span><br><span class="line"><span class="keyword">type</span> FileHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">    Machine              <span class="type">uint16</span></span><br><span class="line">    NumberOfSections     <span class="type">uint16</span>  <span class="comment">// 分区数</span></span><br><span class="line">    TimeDateStamp        <span class="type">uint32</span></span><br><span class="line">    PointerToSymbolTable <span class="type">uint32</span></span><br><span class="line">    NumberOfSymbols      <span class="type">uint32</span></span><br><span class="line">    SizeOfOptionalHeader <span class="type">uint16</span></span><br><span class="line">    Characteristics      <span class="type">uint16</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>如果需要增加新分区，插入后门代码，需要修改这里的分区数属性</li><li>增加新的Sections</li><li>或者在imagebase中增加shellcode</li></ol><p>作者：mafa1993<br>链接：<a href="https://www.jianshu.com/p/2294fcfc0286">https://www.jianshu.com/p/2294fcfc0286</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;debug/pe&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/binary&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">&quot;G:\\Windows\\WinSxS\\amd64_microsoft-windows-calc_31bf3856ad364e35_10.0.18362.1_none_7c1b713697f466dd\\calc.exe&quot;</span>) <span class="comment">// Modify for binary or change to accept args</span></span><br><span class="line">    check(err)</span><br><span class="line">    pefile, err := pe.NewFile(f) <span class="comment">// 创建pe文件对象</span></span><br><span class="line">    check(err)</span><br><span class="line">    <span class="keyword">defer</span> f.Close()</span><br><span class="line">    <span class="keyword">defer</span> pefile.Close()</span><br><span class="line"></span><br><span class="line">    dosHeader := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">96</span>) <span class="comment">// 读取前96个字节</span></span><br><span class="line">    sizeOffset := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dec to Ascii (searching for MZ)</span></span><br><span class="line">    _, err = f.Read(dosHeader)</span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----DOS Header / Stub----- header和stub解析]&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Magic Value: %s%s\n&quot;</span>, <span class="type">string</span>(dosHeader[<span class="number">0</span>]), <span class="type">string</span>(dosHeader[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Validate PE+0+0 (Valid PE format)</span></span><br><span class="line">    pe_sig_offset := <span class="type">int64</span>(binary.LittleEndian.Uint32(dosHeader[<span class="number">0x3c</span>:])) <span class="comment">// 从0x3c后开始读取</span></span><br><span class="line">    f.ReadAt(sizeOffset, pe_sig_offset)                                  <span class="comment">// sizeoffset为buffer，pe_sig_offset是读取的位置  这里不加:可以吗？？ 读取0x50 0x45 0x00 0x00</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----Signature Header-----]&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] LFANEW Value: %s\n&quot;</span>, <span class="type">string</span>(sizeOffset))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create the reader and read COFF Header</span></span><br><span class="line">    sr := io.NewSectionReader(f, <span class="number">0</span>, <span class="number">1</span>&lt;&lt;<span class="number">63</span><span class="number">-1</span>)       <span class="comment">// 读取到2^64次方-1</span></span><br><span class="line">    _, err = sr.Seek(pe_sig_offset+<span class="number">4</span>, os.SEEK_SET) <span class="comment">// 重置指针</span></span><br><span class="line">    check(err)</span><br><span class="line">    binary.Read(sr, binary.LittleEndian, &amp;pefile.FileHeader) <span class="comment">// 二进制读取</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get size of OptionalHeader</span></span><br><span class="line">    <span class="comment">// 可选头解析  向加载程序提供重要数据，加载程序将可执行文件加载到虚拟内存</span></span><br><span class="line">    <span class="keyword">var</span> sizeofOptionalHeader32 = <span class="type">uint16</span>(binary.Size(pe.OptionalHeader32&#123;&#125;))</span><br><span class="line">    <span class="keyword">var</span> sizeofOptionalHeader64 = <span class="type">uint16</span>(binary.Size(pe.OptionalHeader64&#123;&#125;))</span><br><span class="line">    <span class="keyword">var</span> oh32 pe.OptionalHeader32</span><br><span class="line">    <span class="keyword">var</span> oh64 pe.OptionalHeader64</span><br><span class="line"></span><br><span class="line">    <span class="comment">// type FileHeader struct &#123;</span></span><br><span class="line">    <span class="comment">//  Machine              uint16</span></span><br><span class="line">    <span class="comment">//  NumberOfSections     uint16</span></span><br><span class="line">    <span class="comment">//  TimeDateStamp        uint32</span></span><br><span class="line">    <span class="comment">//  PointerToSymbolTable uint32</span></span><br><span class="line">    <span class="comment">//  NumberOfSymbols      uint32</span></span><br><span class="line">    <span class="comment">//  SizeOfOptionalHeader uint16</span></span><br><span class="line">    <span class="comment">//  Characteristics      uint16</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read OptionalHeader</span></span><br><span class="line">    <span class="keyword">switch</span> pefile.FileHeader.SizeOfOptionalHeader &#123;</span><br><span class="line">    <span class="keyword">case</span> sizeofOptionalHeader32:</span><br><span class="line">        binary.Read(sr, binary.LittleEndian, &amp;oh32)</span><br><span class="line">    <span class="keyword">case</span> sizeofOptionalHeader64:</span><br><span class="line">        binary.Read(sr, binary.LittleEndian, &amp;oh64)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Print File Header</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----COFF File Header-----]&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Machine Architecture: %#x\n&quot;</span>, pefile.FileHeader.Machine)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Number of Sections: %#x\n&quot;</span>, pefile.FileHeader.NumberOfSections)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Size of Optional Header: %#x\n&quot;</span>, pefile.FileHeader.SizeOfOptionalHeader)</span><br><span class="line">    <span class="comment">// Print section names</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----Section Offsets-----]&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Number of Sections Field Offset: %#x\n&quot;</span>, pe_sig_offset+<span class="number">6</span>)</span><br><span class="line">    <span class="comment">// this is the end of the Signature header (0x7c) + coff (20bytes) + oh32 (224bytes)</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Section Table Offset: %#x\n&quot;</span>, pe_sig_offset+<span class="number">0xF8</span>)</span><br><span class="line">    <span class="comment">// Print Optional Header</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----Optional Header-----]&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果对pe文件加入后门，需要对下面两项有所了解</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Entry Point: %#x\n&quot;</span>, oh32.AddressOfEntryPoint) <span class="comment">// 相对于imageBase的可执行代码位置</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] ImageBase: %#x\n&quot;</span>, oh32.ImageBase)             <span class="comment">// 将图像加载到内存时第一个字节位置</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Size of Image: %#x\n&quot;</span>, oh32.SizeOfImage) <span class="comment">// 图像的实际大小</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Sections Alignment: %#x\n&quot;</span>, oh32.SectionAlignment)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] File Alignment: %#x\n&quot;</span>, oh32.FileAlignment)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Characteristics: %#x\n&quot;</span>, pefile.FileHeader.Characteristics)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Size of Headers: %#x\n&quot;</span>, oh32.SizeOfHeaders)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Checksum: %#x\n&quot;</span>, oh32.CheckSum)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Machine: %#x\n&quot;</span>, pefile.FileHeader.Machine)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] Subsystem: %#x\n&quot;</span>, oh32.Subsystem)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;[+] DLLCharacteristics: %#x\n&quot;</span>, oh32.DllCharacteristics)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print Data Directory</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----Data Directory----- 数据目录解析，可选头的最后128字节]&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> winnt_datadirs = []<span class="type">string</span>&#123;</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_EXPORT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_IMPORT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_RESOURCE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_EXCEPTION&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_SECURITY&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_BASERELOC&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_DEBUG&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_COPYRIGHT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_GLOBALPTR&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_TLS&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_IAT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR&quot;</span>,</span><br><span class="line">        <span class="string">&quot;IMAGE_NUMBEROF_DIRECTORY_ENTRIES&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> idx, directory := <span class="keyword">range</span> oh32.DataDirectory &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[!] Data Directory: %s\n&quot;</span>, winnt_datadirs[idx])</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Image Virtual Address: %#x\n&quot;</span>, directory.VirtualAddress)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Image Size: %#x\n&quot;</span>, directory.Size)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;[-----Section Table----- 解析分区表]&quot;</span>)</span><br><span class="line">    <span class="comment">// 包含了相关分区的详细信息，与coff file header中numberofsections 匹配</span></span><br><span class="line">    <span class="keyword">for</span> _, section := <span class="keyword">range</span> pefile.Sections &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;[+] --------------------&quot;</span>)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Name: %s\n&quot;</span>, section.Name)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Characteristics: %#x\n&quot;</span>, section.Characteristics)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Virtual Size: %#x\n&quot;</span>, section.VirtualSize)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Virtual Offset: %#x\n&quot;</span>, section.VirtualAddress)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Raw Size: %#x\n&quot;</span>, section.Size)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Raw Offset to Data: %#x\n&quot;</span>, section.Offset)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;[+] Section Append Offset (Next Section): %#x\n&quot;</span>, section.Offset+section.Size)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// s := pefile.Section(&quot;.text&quot;)</span></span><br><span class="line">    <span class="comment">// fmt.Printf(&quot;%v&quot;, *s)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;Section Table Offset&quot; + (40bytes * number of sections)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> GO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> PE文件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>锁</title>
      <link href="/Code/CPP/%E9%94%81/"/>
      <url>/Code/CPP/%E9%94%81/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_lock&lt;std::recursive_mutex&gt; <span class="title">lock</span><span class="params">(sensor_handle_mutex)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> mutex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>visual studio 编译告警常见处理手段</title>
      <link href="/Code/CPP/%E7%BC%96%E8%AF%91%E5%91%8A%E8%AD%A6%E5%B8%B8%E8%A7%81%E5%A4%84%E7%90%86%E6%89%8B%E6%AE%B5/"/>
      <url>/Code/CPP/%E7%BC%96%E8%AF%91%E5%91%8A%E8%AD%A6%E5%B8%B8%E8%A7%81%E5%A4%84%E7%90%86%E6%89%8B%E6%AE%B5/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h3 id="C2001"><a href="#C2001" class="headerlink" title="C2001"></a>C2001</h3><blockquote><p>常量中有换行符</p></blockquote><p>文件保存为 UTF-8 签名</p><h3 id="C4100"><a href="#C4100" class="headerlink" title="C4100"></a>C4100</h3><blockquote><p>“*” 类型未使用</p></blockquote><p>windows 代码文件中使用 </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNREFERENCED_PARAMETER</span>(X)</span><br></pre></td></tr></table></figure><p>如果是在Qt中，则可以使用</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Q_UNUSED</span>(X);</span><br></pre></td></tr></table></figure><p>另外，也不建议使用上述两种方式。当实现接口或标准导出内的方法时，有一些参数没有被引用是相当常见的。编译器会发现未 使用的参数，并产生一个警告，有些组件甚至会认为这是一个错误。为避免发生如此情况， 将未使用的参数使用&#x2F;* 参数名 *&#x2F; 语法将其注释掉。不要使用 UNREFERENCED_PARAMETER（） 宏，因为其 1）太繁琐，2）并不能保证参数实际上真的未被引用。</p><p>最好的方法就是在函数接口中注释掉未使用的变量。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LRESULT WndProc（HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM <span class="comment">/* lParam */</span>）</span><br></pre></td></tr></table></figure><h3 id="C4805"><a href="#C4805" class="headerlink" title="C4805"></a>C4805</h3><blockquote><p>操作类型混合不安全：一般在操作 <code>bool</code> 和 <code>int</code> 时会触发这一警告</p></blockquote><p>简单处理就是不要使用这种作为判断的依据，要么用 <code>bool</code> 类型，要么用 <code>int</code> 类型。</p><ul><li>也可以使用强制转换。</li></ul><h3 id="C4996"><a href="#C4996" class="headerlink" title="C4996"></a>C4996</h3><h4 id="GetVersionExA-被声明为已否决"><a href="#GetVersionExA-被声明为已否决" class="headerlink" title="GetVersionExA 被声明为已否决"></a><code>GetVersionExA</code> 被声明为已否决</h4><p>碰见这种情况，需要关闭项目的SDL检查。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Project Properties &gt; Configuration Properties &gt; C/C++ &gt; General &gt; SDL checks关掉</span><br></pre></td></tr></table></figure><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ol><li>‘qsort’：Use std::sort</li><li></li></ol><h3 id="C5208"><a href="#C5208" class="headerlink" title="C5208"></a>C5208</h3><p>出现这个问题的原因是 C 风格代码和 C++ 风格代码混用导致的，结构体在 C 和 C++ 中是不一样的：</p><p>C</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">     <span class="type">char</span> *yyy=new zzz[ttt];</span><br><span class="line">&#125;xxx;</span><br></pre></td></tr></table></figure><p>CPP</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">xxx</span> </span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">char</span> *yyy=<span class="keyword">new</span> zzz[ttt];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>具体原因是：最新的C++20标准中，为了更好的实现模块<a href="https://www.zhihu.com/search?q=module&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1243864776%7D">module</a>的特性，typedef 一个未命名的struct被限制为只能使用纯粹的c语言语法，它不能通过赋值进行类内初始化了。</p></blockquote><p>所以修改的方案就是不要声明匿名结构体，在声明时创建结构体名。</p><h3 id="C6387"><a href="#C6387" class="headerlink" title="C6387"></a>C6387</h3><blockquote><p>警告内容：“***”可能是0，这不符合函数“****”的规范。</p></blockquote><p>这个问题就是函数参数没有做校验，也就是判空等情况，如下所示代码就会出现该警告：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">m_hMutex = <span class="built_in">CreateMutex</span>(<span class="literal">NULL</span>, TRUE, <span class="keyword">this</span>-&gt;MutexName);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetLastError</span>() == ERROR_ALREADY_EXISTS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WaitForSingleObject</span>(m_hMutex, INFINITE) == WAIT_OBJECT_0)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Unlock</span>(m_hMutex);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">g_hMutex = m_hMutex;</span><br><span class="line">MutexReleased = FALSE;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改为如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">m_hMutex = <span class="built_in">CreateMutex</span>(<span class="literal">NULL</span>, TRUE, <span class="keyword">this</span>-&gt;MutexName);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">GetLastError</span>() == ERROR_ALREADY_EXISTS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (m_hMutex != <span class="literal">NULL</span>) <span class="comment">// 添加判空逻辑</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WaitForSingleObject</span>(m_hMutex, INFINITE) == WAIT_OBJECT_0)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Unlock</span>(m_hMutex);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">g_hMutex = m_hMutex;</span><br><span class="line">MutexReleased = FALSE;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LNK4098"><a href="#LNK4098" class="headerlink" title="LNK4098"></a>LNK4098</h3><blockquote><p>LINK : warning LNK4098: 默认库“LIBCMT”与其他库的使用冲突；请使用 &#x2F;NODEFAULTLIB:library</p></blockquote><p>简单处理就是在VS项目属性 -&gt; 链接器 -&gt; 命令行 中添加上述提示的内容。以 <code>LIBCMT</code> 库为例：添加内容如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/NODEFAULTLIB:LIBCMT</span><br></pre></td></tr></table></figure><h3 id="LNK4099"><a href="#LNK4099" class="headerlink" title="LNK4099"></a>LNK4099</h3><blockquote><p>warning LNK4099: 未找到 PDB“cryptlib.pdb”(使用“cryptlib.lib(cryptlib.obj)</p></blockquote><p>一般这种情况属于使用了开源库编译的lib，在项目中使用时，调试信息格式选择了 <code>/zi</code> 选项。因此会提示没有 <code>obj</code> 文件。</p><p>解决办法就是程序调试信息选择无即可。另外就是我们编译过程中如果需要调试信息格式，也就是pdb该怎么同时处理这两个问题：</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> visual studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>⏰ 时间处理</title>
      <link href="/Code/CPP/%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86/"/>
      <url>/Code/CPP/%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Simple-Demo"><a href="#Simple-Demo" class="headerlink" title="Simple Demo"></a>Simple Demo</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">time_t</span> t;</span><br><span class="line">    <span class="built_in">time</span>(&amp;t);</span><br><span class="line">    cout &lt;&lt; t &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码会输出一个10位数，表示的是到当前时间的秒数，起点是 <code>1970年1月1日 00:00:00</code></p><h2 id="time-t-转换"><a href="#time-t-转换" class="headerlink" title="time_t 转换"></a><code>time_t</code> 转换</h2><ol><li><p><code>string</code> 转 <code>time_t</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">time_t</span> <span class="title">StringToDatetime</span><span class="params">(std::string str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> *cha = (<span class="type">char</span>*)str.<span class="built_in">data</span>();             <span class="comment">// 将string转换成char*。</span></span><br><span class="line">    tm tm_;                                    <span class="comment">// 定义tm结构体。</span></span><br><span class="line">    <span class="type">int</span> year, month, day, hour, minute, second;<span class="comment">// 定义时间的各个int临时变量。</span></span><br><span class="line">    <span class="built_in">sscanf</span>(cha, <span class="string">&quot;%d-%d-%d %d:%d:%d&quot;</span>, &amp;year, &amp;month, &amp;day, &amp;hour, &amp;minute, &amp;second);<span class="comment">// 将string存储的日期时间，转换为int临时变量。</span></span><br><span class="line">    tm_.tm_year = year - <span class="number">1900</span>;                 <span class="comment">// 年，由于tm结构体存储的是从1900年开始的时间，所以tm_year为int临时变量减去1900。</span></span><br><span class="line">    tm_.tm_mon = month - <span class="number">1</span>;                    <span class="comment">// 月，由于tm结构体的月份存储范围为0-11，所以tm_mon为int临时变量减去1。</span></span><br><span class="line">    tm_.tm_mday = day;                         <span class="comment">// 日。</span></span><br><span class="line">    tm_.tm_hour = hour;                        <span class="comment">// 时。</span></span><br><span class="line">    tm_.tm_min = minute;                       <span class="comment">// 分。</span></span><br><span class="line">    tm_.tm_sec = second;                       <span class="comment">// 秒。</span></span><br><span class="line">    tm_.tm_isdst = <span class="number">0</span>;                          <span class="comment">// 非夏令时。</span></span><br><span class="line">    <span class="type">time_t</span> t_ = <span class="built_in">mktime</span>(&amp;tm_);                  <span class="comment">// 将tm结构体转换成time_t格式。</span></span><br><span class="line">    <span class="keyword">return</span> t_;                                 <span class="comment">// 返回值。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>time_t</code> 转 <code>string</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)</span><br><span class="line">    <span class="type">time_t</span> t=std::chrono::system_clock::<span class="built_in">to_time_t</span>(std::chrono::system_clock::<span class="built_in">now</span>());</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss&lt;&lt;std::<span class="built_in">put_time</span>(std::<span class="built_in">localtime</span>(&amp;t),<span class="string">&quot;%F %X&quot;</span>);</span><br><span class="line">    ss.<span class="built_in">str</span>();</span><br><span class="line">(<span class="number">2</span>)</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">strftime</span> <span class="params">(<span class="type">char</span>* ptr, <span class="type">size_t</span> maxsize, <span class="type">const</span> <span class="type">char</span>* format,</span></span></span><br><span class="line"><span class="params"><span class="function">                 <span class="type">const</span> <span class="keyword">struct</span> tm* timeptr )</span></span>;</span><br><span class="line">    ptr:存储转换结果</span><br><span class="line">    maxsize:复制到ptr的最大字符数，包括结束符<span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    format:转换格式，类似printf，可加入其他需要复制过去的字符</span><br><span class="line">    timeptr:时间</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">    tm* local_time = std::<span class="built_in">localtime</span>(&amp;t);</span><br><span class="line">    <span class="built_in">strftime</span>(buf,<span class="built_in">sizeof</span>(buf),<span class="string">&quot;%F %X&quot;</span>,local_time);</span><br></pre></td></tr></table></figure></li></ol><h1 id="C-时间类"><a href="#C-时间类" class="headerlink" title="C++时间类"></a>C++时间类</h1><p>使用C++时间类处理获取系统当前时间 <a href="https://www.apiref.com/cpp-zh/cpp/chrono.html">日期和时间工具 - C++中文 - API参考文档 (apiref.com)</a></p><p>头文件 <code>#include &lt;chrono&gt;</code></p><ol><li>获取当前时间</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system_clock::time_point now = std::chrono::system_clock::<span class="built_in">now</span>();</span><br></pre></td></tr></table></figure><ol start="2"><li>将当前时间转换为time_格式</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">time_t</span> tt = std::chrono::system_clock::<span class="built_in">to_time_t</span>(now);</span><br></pre></td></tr></table></figure><ol start="3"><li>将time_格式的时间转换为tm *格式</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span>* tmNow = <span class="built_in">localtime</span>(&amp;tt);</span><br></pre></td></tr></table></figure><ol start="4"><li>将tm*格式的时间转换为可读的时间</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> date[<span class="number">20</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="built_in">sprintf</span>(date, <span class="string">&quot;%d-%02d-%02d %02d:%02d:%02d&quot;</span>,(<span class="type">int</span>)tmNow-&gt;tm_year + <span class="number">1900</span>, (<span class="type">int</span>)tmNow-&gt;tm_mon + <span class="number">1</span>, (<span class="type">int</span>)tmNow-&gt;tm_mday,  (<span class="type">int</span>)tmNow-&gt;tm_hour, (<span class="type">int</span>)tmNow-&gt;tm_min, (<span class="type">int</span>)tmNow-&gt;tm_sec);</span><br></pre></td></tr></table></figure><p>最后，在C++中的话可以将char*字符串转换为std::string字符串来处理</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">timeNow</span><span class="params">(date)</span></span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 时间 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件后缀校验</title>
      <link href="/Code/CPP/%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E6%A0%A1%E9%AA%8C/"/>
      <url>/Code/CPP/%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E6%A0%A1%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  std::string fn = <span class="string">&quot;filename.conf&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span>(fn.<span class="built_in">substr</span>(fn.<span class="built_in">find_last_of</span>(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>) == <span class="string">&quot;conf&quot;</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Yes...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;No...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态声明子类</title>
      <link href="/Code/CPP/%E5%8A%A8%E6%80%81%E5%A3%B0%E6%98%8E%E5%AD%90%E7%B1%BB/"/>
      <url>/Code/CPP/%E5%8A%A8%E6%80%81%E5%A3%B0%E6%98%8E%E5%AD%90%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BaseClass</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;BaseClass Construct&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BaseClass</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;BaseClass Destruct&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span>  <span class="title">TestFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;BaseClass TestFunction&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">int</span> Test;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SonClass</span> : <span class="keyword">public</span> BaseClass</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SonClass</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;SonClass Construct&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">SonClass</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;SonClass Destruct&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span>  <span class="title">TestFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;SonClass TestFunction&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>           *LPVOID;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> _baseClass, <span class="keyword">class</span> _derivedClass&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DoDynamicSubclassing</span><span class="params">(_baseClass *pBaseObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pBaseObj)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(<span class="built_in">sizeof</span>(_baseClass) == <span class="built_in">sizeof</span>(_derivedClass), <span class="string">&quot;DynamicSubclassing to _derivedClass must not have its own members&quot;</span>);</span><br><span class="line">        _derivedClass _derivedClassinstance;</span><br><span class="line">        LPVOID *pBaseVirtPtr = (LPVOID*)pBaseObj, *pDerivedVirtPtr = (LPVOID*)&amp;_derivedClassinstance;</span><br><span class="line">        <span class="comment">//assign the virtual ptr of the derived class</span></span><br><span class="line">        *pBaseVirtPtr = *pDerivedVirtPtr;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BaseClass *Test = <span class="keyword">new</span> BaseClass;</span><br><span class="line">    cout &lt;&lt; *(<span class="type">int</span>*)Test &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">DoDynamicSubclassing</span>&lt;BaseClass, SonClass&gt;(Test);</span><br><span class="line">    Test-&gt;<span class="built_in">TestFunction</span>();</span><br><span class="line">    cout &lt;&lt; *(<span class="type">int</span>*)Test &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot; ————————- &quot;</span> &lt;&lt;endl;</span><br><span class="line">    BaseClass aaaa;</span><br><span class="line">    cout &lt;&lt; *(<span class="type">int</span>*)&amp;aaaa &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">DoDynamicSubclassing</span>&lt;BaseClass, SonClass&gt;(&amp;aaaa);</span><br><span class="line">    aaaa.<span class="built_in">TestFunction</span>();</span><br><span class="line">    cout &lt;&lt; *(<span class="type">int</span>*)&amp;aaaa &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各种宏定义用法整理</title>
      <link href="/Code/CPP/%E5%AE%8F%E5%AE%9A%E4%B9%89/"/>
      <url>/Code/CPP/%E5%AE%8F%E5%AE%9A%E4%B9%89/</url>
      
        <content type="html"><![CDATA[<h1 id="C语言ASCII字符、16进制和BCD码值互转，各种好用的宏定义取值"><a href="#C语言ASCII字符、16进制和BCD码值互转，各种好用的宏定义取值" class="headerlink" title="C语言ASCII字符、16进制和BCD码值互转，各种好用的宏定义取值"></a>C语言ASCII字符、16进制和BCD码值互转，各种好用的宏定义取值</h1><p><strong>1、把Ascii字符转16进制</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">函数名:Ascii2Hex</span></span><br><span class="line"><span class="comment">功能描述:把Ascii字符转16进制</span></span><br><span class="line"><span class="comment">参数：Ascii字符</span></span><br><span class="line"><span class="comment">返回：16进制</span></span><br><span class="line"><span class="comment">***************************/</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">char</span> <span class="title">Ascii2Hex</span><span class="params">( <span class="type">unsigned</span> <span class="type">char</span> bAscii )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> bHex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( ( bAscii &gt;= <span class="number">0</span> ) &amp;&amp; ( bChar &lt;= <span class="number">9</span> ) )</span><br><span class="line">    &#123;</span><br><span class="line">        bHex = bAscii + <span class="number">0x30</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( ( bAscii &gt;= <span class="number">10</span> ) &amp;&amp; ( bAscii &lt;= <span class="number">15</span> ) )</span><br><span class="line">    &#123;</span><br><span class="line">        bHex = bAscii + <span class="number">0x37</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        bHex = <span class="number">0xff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bHex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2、把16进制转Ascii字符</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">函数名:Hex2Ascii</span></span><br><span class="line"><span class="comment">功能描述:把16进制转Ascii字符</span></span><br><span class="line"><span class="comment">参数：16进制</span></span><br><span class="line"><span class="comment">返回：Ascii字符</span></span><br><span class="line"><span class="comment">***************************/</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">char</span> <span class="title">Hex2Ascii</span><span class="params">( <span class="type">unsigned</span> <span class="type">char</span> bHex )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> bAscii = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( ( bHex &gt;= <span class="string">&#x27;0&#x27;</span> ) &amp;&amp; ( bHex &lt;= <span class="string">&#x27;9&#x27;</span> ) )</span><br><span class="line">    &#123;</span><br><span class="line">        bAscii =  bHex - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( ( bHex &gt;= <span class="string">&#x27;A&#x27;</span> ) &amp;&amp; ( bHex &lt;= <span class="string">&#x27;F&#x27;</span> ) )</span><br><span class="line">    &#123;</span><br><span class="line">        bAscii = bHex - <span class="string">&#x27;7&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( ( bHex &gt;= <span class="string">&#x27;a&#x27;</span> ) &amp;&amp; ( bHex &lt;= <span class="string">&#x27;f&#x27;</span> ) )</span><br><span class="line">    &#123;</span><br><span class="line">        bAscii = bHex - <span class="number">0x57</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">bAscii = <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> bAscii;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3、把16进制转BCD值</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">函数名:Hex2Bcd</span></span><br><span class="line"><span class="comment">功能描述:把16进制转BCD值</span></span><br><span class="line"><span class="comment">参数：16进制值</span></span><br><span class="line"><span class="comment">返回：BCD值</span></span><br><span class="line"><span class="comment">***************************/</span></span><br><span class="line"><span class="function">u_8 <span class="title">Hex2Bcd</span><span class="params">( u_8 HexCode )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>( ( HexCode % <span class="number">10</span> ) + ( HexCode / <span class="number">10</span> * <span class="number">16</span> ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4、把BCD值转2进制</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">函数名:Bcd2Bin</span></span><br><span class="line"><span class="comment">功能描述:把BCD值转2进制</span></span><br><span class="line"><span class="comment">参数：BCD值</span></span><br><span class="line"><span class="comment">返回：2进制值</span></span><br><span class="line"><span class="comment">***************************/</span></span><br><span class="line"><span class="function">u_8 <span class="title">Bcd2Bin</span><span class="params">( u_8 BcdCode )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>( ( ( ( BcdCode &gt;&gt; <span class="number">4</span> ) &amp; <span class="number">0x0F</span> ) * <span class="number">10</span> ) + ( BcdCode &amp; <span class="number">0x0F</span> ));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5、把2进制转BCD值</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">函数名:Bin2BCD</span></span><br><span class="line"><span class="comment">功能描述:把2进制转BCD值</span></span><br><span class="line"><span class="comment">参数：2进制值</span></span><br><span class="line"><span class="comment">返回：BCD值</span></span><br><span class="line"><span class="comment">***************************/</span></span><br><span class="line"><span class="function">u_8 <span class="title">Bin2BCD</span><span class="params">( u_8 BinCode )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>( ( ( (BinCode)/<span class="number">10</span> ) &lt;&lt; <span class="number">4</span> ) + ( (BinCode) %<span class="number">10</span> ));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6、把x值的第i位置为1</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********把x值的第i位置为1*************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X_SETBIT( x , i )       ( (x) |= ( 0x1 &lt;&lt; (i) )) </span></span><br></pre></td></tr></table></figure><p><strong>7、把x值的第i位清为0</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********把x值的第i位清为0**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X_CLRBIT( x , i )       ( (x) &amp;= ( ~( 0x01 &lt;&lt; (i) )))</span></span><br></pre></td></tr></table></figure><p><strong>8、判断x值的第i位是否为1</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********判断x值的第i位是否为1**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X_CHKBIT( x , i )       ( ((x) &gt;&gt; (i) ) &amp; 0x01 )</span></span><br></pre></td></tr></table></figure><p><strong>9、x,y值中的最小值</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********x,y值中的最小值**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X_MIN( x ,y )           (((x)&gt;(y))?(y):(x))</span></span><br></pre></td></tr></table></figure><p><strong>10、x,y值中的最大值</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********x,y值中的最大值**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X_MAX( x ,y )           (((x)&gt;(y))?(x):(y))</span></span><br></pre></td></tr></table></figure><p><strong>11、取i值的低8位</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********取i值的低8位**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_4_BYTE(i)    (u_8)( ( (i) &amp; 0xFF ) &gt;&gt; 0 )</span></span><br></pre></td></tr></table></figure><p><strong>12、取i值的8-16位</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********取i值的8-16位**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_3_BYTE(i)    (u_8)( ( (i) &amp; 0xFF00 ) &gt;&gt; 8 )</span></span><br></pre></td></tr></table></figure><p><strong>13、取i值的16-24位</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********取i值的16-24位**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_2_BYTE(i)    (u_8)( ( (i) &amp; 0xFF0000 ) &gt;&gt; 16 ) </span></span><br></pre></td></tr></table></figure><p><strong>14、取i值的24-32位</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********取i值的24-32位**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_1_BYTE(i)    (u_8)( ( (i) &amp; 0xFF000000 ) &gt;&gt; 24 )</span></span><br></pre></td></tr></table></figure><p><strong>15、4个字节为int型变量</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********4个字节为int型变量**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BYTE_TO_INT( byte,byte1,byte2,byte3 )    ( (byte&lt;&lt;24) | (byte1 &lt;&lt; 16) | (byte2 &lt;&lt; 8) | byte3 )</span></span><br></pre></td></tr></table></figure><p><strong>16、2个字节为short型变量</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********2个字节为short型变量**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BYTE_TO_SHORT( byte ,byte1)       ( (byte&lt;&lt;8)  | byte1 )</span></span><br></pre></td></tr></table></figure><p><strong>17、int型变量为4个字节</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********int型变量为4个字节**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INT_TO_BYTE( Val,byte )      do&#123; (byte)[0] = ((Val)&gt;&gt;24)&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                            (byte)[1] = ((Val)&gt;&gt;16)&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                            (byte)[2] = ((Val)&gt;&gt;8)&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                            (byte)[3] = ((Val))&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                        &#125;while(0)</span></span><br></pre></td></tr></table></figure><p><strong>18、short型变量为2个字节</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********short型变量为2个字节**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHORT_TO_BYTE( Val ,byte)     do&#123; (byte)[0] = ((Val)&gt;&gt;8)&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                             (byte)[1] = (Val)&amp;0xff;\</span></span><br><span class="line"><span class="meta">                                        &#125;while(0)</span></span><br></pre></td></tr></table></figure><p><strong>19、标准时间time转换字符串输出</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********标准时间time转换字符串输出**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIME_2_STR(t, str) do&#123; tm_t tmtime;\</span></span><br><span class="line"><span class="meta">         gmtime_r( (time_t *)&amp;t,&amp;tmtime );\</span></span><br><span class="line"><span class="meta">         sprintf(str,<span class="string">&quot;%04d-%02d-%02d %02d:%02d:%02d&quot;</span>,1900 + tmtime.tm_year, tmtime.tm_mon + 1, \</span></span><br><span class="line"><span class="meta">                          tmtime.tm_mday,tmtime.tm_hour, tmtime.tm_min, tmtime.tm_sec);\</span></span><br><span class="line"><span class="meta">                             &#125;while(0)  </span></span><br></pre></td></tr></table></figure><p><strong>20、IP值转换IP字符串输出</strong>              </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********IP值转换IP字符串输出**********/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IPADDR_2_STR(lIp, str) do&#123; u_8 ipaddr[4];\</span></span><br><span class="line"><span class="meta">     memcpy (&amp;(ipaddr[0]), &amp;(lIp), 4);\                                                 </span></span><br><span class="line">     <span class="built_in">sprintf</span>(str,<span class="string">&quot;%03d.%03d.%03d.%03d&quot;</span>,ipaddr[<span class="number">0</span>],ipaddr[<span class="number">1</span>],ipaddr[<span class="number">2</span>],ipaddr[<span class="number">3</span>]);\</span><br><span class="line">                                  &#125;<span class="keyword">while</span>(<span class="number">0</span>)   </span><br></pre></td></tr></table></figure><p>一、字符串化操作符#</p><ol><li><p><code>#</code> 的功能：将#后面的宏参数转化成字符串。</p></li><li><p>使用条件：只能用于有传入参数的宏定义中，且#必须置于宏定义体中的参数名前。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">// s是宏参数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Str(s) #s    <span class="comment">//功能：使用Str(s)将s转化为字符串</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="built_in">Str</span>(HelloWorld));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：HelloWorld</span></span><br></pre></td></tr></table></figure></li></ol><p>3.对空格的处理</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> example1(instr) #instr</span></span><br><span class="line"></span><br><span class="line">stringstr=<span class="built_in">example1</span>(abc)； 将会展成：string str=<span class="string">&quot;abc&quot;</span>；</span><br></pre></td></tr></table></figure><pre><code>    🥝 a、忽略传入参数名前面和后面的空格。</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如：str=example1( abc )； 将会被扩展成 str=&quot;abc&quot;；</span><br></pre></td></tr></table></figure><pre><code>    🥝 b、当传入参数名间存在空格时，编译器将自动连接各个子字符串，用每个子字符串中只一个空格连接，忽略多余一个空格。</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如：str=<span class="built_in">exapme1</span>( abc    def ); 将会被扩展成 str=<span class="string">&quot;abc def&quot;</span>；</span><br></pre></td></tr></table></figure><ol start="4"><li>宏定义作为宏参数，不展开，仍然作为字符串字面信息输出。</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STR(s)     #s </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// INT_MAX是某个文件中定义的宏，</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;int max: %s\n&quot;</span>,  <span class="built_in">STR</span>(INT_MAX)); <span class="comment">// 输出int max: INT_MAX</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>二、符号连接操作符 ##</p><ol><li><p><code>##</code> 的功能: 将前后两个标识符连接形成一个标识符。</p></li><li><p>使用条件：只能用于有传入参数的宏定义中，且##必须置于宏定义体中的参数名前。</p></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Var(x) var##x</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Var</span><span class="params">(<span class="number">1</span>)</span></span>=<span class="number">1</span>,<span class="built_in">Var</span>(<span class="number">2</span>)=<span class="number">2</span>,<span class="built_in">Var</span>(<span class="number">3</span>)=<span class="number">3</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;var1=%d\n&quot;</span>,var1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;var2=%d\n&quot;</span>,var2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;var3=%d\n&quot;</span>,var3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.注意</p><p>a、当用##连接形参时，##前后的空格可有可无。</p><p>如：#define exampleNum(n) num ## n 相当于 #define exampleNum(n) num##n<br>b、连接后的实际参数名，必须为实际存在的参数名或是编译器已知的宏定义。连接之后只是组成了一个参数名，并没有定义，因此要求这个参数名需要是已经存在或者说已经被定义了的参数或宏定义。</p><p>c、当宏参数是另一个宏时，凡宏定义中存在#或##的地方，宏参数不会再展开。</p><p>（ 只有当前宏生效, 参数里的宏！不会生效 ！）</p><pre><code>    ① 宏定义不存在’#‘和’##&#39;的情况</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> TOW      (2) </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUL(a,b) (a*b) </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d*%d=%d/n&quot;</span>, TOW, TOW, <span class="built_in">MUL</span>(TOW,TOW)); </span><br><span class="line">这行的宏会被展开为： </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d*%d=%d/n&quot;</span>, (<span class="number">2</span>), (<span class="number">2</span>), ((<span class="number">2</span>)*(<span class="number">2</span>))); </span><br><span class="line">MUL里的参数TOW会被展开为(<span class="number">2</span>). </span><br></pre></td></tr></table></figure><pre><code>    ② 宏定义存在’#‘或’##&#39;的时候（#在上方有讲解）</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> A          2 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONS(a,b)  (int)(a##e##b) <span class="comment">//ps：##放到宏参数后面相当于一个连接 无其他作用</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 由于A是宏，且作为宏CONS的参数，并且宏CONS##符号，所以A不能被解引用，因此上方程序编译报错。 </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">CONS</span>(A, A));  <span class="comment">// compile error   无法展开</span></span><br><span class="line"><span class="comment">//printf(&quot;%d\n&quot;, (int)(AeA)); </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错信息如下：</span></span><br><span class="line">main.c: In function ‘main’:</span><br><span class="line">main.c:<span class="number">8</span>:<span class="number">22</span>: error: ‘AeA’ <span class="built_in">undeclared</span> (first use in <span class="keyword">this</span> function)</span><br><span class="line">    <span class="number">8</span> |  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">CONS</span>(A, A));  <span class="comment">// compile error   无法展开</span></span><br><span class="line">      |                      ^</span><br><span class="line">main.c:<span class="number">5</span>:<span class="number">26</span>: note: in definition of macro ‘CONS’</span><br><span class="line">    <span class="number">5</span> | <span class="meta">#<span class="keyword">define</span> CONS(a,b)  (int)(a##e##b) <span class="comment">//ps：##放到宏参数后面相当于一个连接 无其他作用</span></span></span><br><span class="line">      |                          ^</span><br><span class="line">main.c:<span class="number">8</span>:<span class="number">22</span>: note: each undeclared identifier is reported only once <span class="keyword">for</span> each function it appears in</span><br><span class="line">    <span class="number">8</span> |  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">CONS</span>(A, A));  <span class="comment">// compile error   无法展开</span></span><br><span class="line">      |                      ^</span><br><span class="line">main.c:<span class="number">5</span>:<span class="number">26</span>: note: in definition of macro ‘CONS’</span><br><span class="line">    <span class="number">5</span> | <span class="meta">#<span class="keyword">define</span> CONS(a,b)  (int)(a##e##b) <span class="comment">//ps：##放到宏参数后面相当于一个连接 无其他作用</span></span></span><br><span class="line">      |                          ^</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 宏定义 </tag>
            
            <tag> 用法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>try-catch块</title>
      <link href="/Code/CPP/try-catch%E5%9D%97/"/>
      <url>/Code/CPP/try-catch%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><blockquote><p><b>Try 块：</b></p><p>将一或多个异常处理块（catch 子句）与复合语句关联。</p></blockquote><ol><li>声明一个具名形参的 catch 子句</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123; <span class="comment">/* */</span> &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123; <span class="comment">/* */</span> &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>声明一个无名形参的 catch 子句</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123; <span class="comment">/* */</span> &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp;) &#123; <span class="comment">/* */</span> &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>catch-all 处理块，可被任何异常激活</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123; <span class="comment">/* */</span> &#125; <span class="built_in">catch</span> (...) &#123; <span class="comment">/* */</span> &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 异常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 仿函数</title>
      <link href="/Code/CPP/%E4%BB%BF%E5%87%BD%E6%95%B0/"/>
      <url>/Code/CPP/%E4%BB%BF%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述： C++ 防函数使用和说明</p></blockquote><p>[toc]</p><h1 id="仿函数"><a href="#仿函数" class="headerlink" title="仿函数"></a>仿函数</h1><p>顾名思义，就是”仿造函数”的意思，它并不是函数，但是却有着类似于函数的行为. </p><p>我们在编程的时候，有时候会发现这样一种情况：有一些相同的功能，会在不同的成员函数中出现. 这时候按照一般的技巧，我们会将这些相同的功能独立出来进行封装. 但是写一个公共函数的话，函数用到的一些变量就可能被迫成为公共的全局变量. 而且，仅仅为了复用这一片代码，就要单独写一个函数，也不是很好维护，这个时候就可以用<strong>仿函数</strong>了.</p><p>按照百度词条的说法：写一个简单的类，除了那些维护一个类的成员函数外，就**只是实现一个operator()**，在类实例化的时候，就将要用的，非参数的元素传入类中. 这样写的好处是：</p><ol><li>免去了一些公共变量的全局化的维护. </li><li>可以使那些代码独立出来，以便下次复用. </li><li>这些仿函数还可以用<strong>关联，聚合，依赖</strong>的类之间的关系，与用到他们的类组合在一起，这样有利于资源的管理.</li></ol><p>作用：</p><ol><li>可替代函数指针，使用更加灵活</li><li>可存储状态，形成一种类似于闭包的机制</li></ol><h2 id="STL-提供的仿函数"><a href="#STL-提供的仿函数" class="headerlink" title="STL 提供的仿函数"></a>STL 提供的仿函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(STL提供的仿函数) --&gt; B(算术类仿函数)</span><br><span class="line">A --&gt; C(关系运算符仿函数)</span><br><span class="line">A --&gt; D(逻辑运算仿函数)</span><br><span class="line">A --&gt; E(&quot;位运算函数(since C++11)&quot;)</span><br><span class="line"></span><br><span class="line">B --&gt; B1(plus&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 相加</span><br><span class="line">B --&gt; B2(minus&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 相减</span><br><span class="line">B --&gt; B3(multiplies&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 相乘</span><br><span class="line">B --&gt; B4(divides&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 相除</span><br><span class="line">B --&gt; B5(modulus&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 取模</span><br><span class="line">B --&gt; B6(negate&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 取否</span><br><span class="line"></span><br><span class="line">C --&gt; C1(equal_to&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 等于</span><br><span class="line">C --&gt; C2(not_equal_to&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 不等于</span><br><span class="line">C --&gt; C3(greater&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 大于</span><br><span class="line">C --&gt; C4(greater_equal&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 大于等于</span><br><span class="line">C --&gt; C5(less&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 小于</span><br><span class="line">C --&gt; C6(less_equal&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 小于等于</span><br><span class="line"></span><br><span class="line">D --&gt; D1(logical_and&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 逻辑与</span><br><span class="line">D --&gt; D2(logical_or&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 逻辑或</span><br><span class="line">D --&gt; D3(logical_no&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 逻辑非</span><br><span class="line"></span><br><span class="line">E --&gt; E1(bit_and&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 按位与</span><br><span class="line">E --&gt; E2(bit_or&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 按位或</span><br><span class="line">E --&gt; E3(bit_xor&lt;&lt;a&gt;T&lt;/a&gt;&gt;) --&gt; 按位异或</span><br></pre></td></tr></table></figure><h3 id="STL-中-less-lt-T-gt-的用法示例"><a href="#STL-中-less-lt-T-gt-的用法示例" class="headerlink" title="STL 中 less&lt;T&gt; 的用法示例"></a>STL 中 <code>less&lt;T&gt;</code> 的用法示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">/home/muten003/CPP/functor/002.cpp</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(MyClass a, MyClass b);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compare</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(MyClass a, MyClass b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    less&lt;MyClass&gt; myclassLes;</span><br><span class="line">    MyClass myclass[<span class="number">3</span>];</span><br><span class="line">    myclass[<span class="number">0</span>].x = <span class="number">2</span>;</span><br><span class="line">    myclass[<span class="number">1</span>].x = <span class="number">1</span>;</span><br><span class="line">    myclass[<span class="number">2</span>].x = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">sort</span>(myclass, myclass + <span class="number">2</span>, myclassLes);</span><br><span class="line">    </span><br><span class="line">    for_each(sortClass, sortClass + <span class="number">3</span>, [] (UseLessClass obj) &#123;</span><br><span class="line">        cout &lt;&lt; obj.y &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; obj.x &lt;&lt; endl; </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br></pre></td></tr></table></figure><h2 id="使用仿函数的优点"><a href="#使用仿函数的优点" class="headerlink" title="使用仿函数的优点"></a>使用仿函数的优点</h2><p>将一个个功能通过类来实现，大多数情况下会加大代码量. 仿函数也是如此，但是仿函数却有着许多优点,<br>除了上述的有利于资源管理、有利于代码维护外,还具有这些特点</p><ol><li>智能性：仿函数是通过仿函数类来实现的，既然是类，里面就可以储存许多变量还有其他的一些信息.我们可以利用这个特征实现许多纯的函数实现不了的功能，举个简单的例子：我若再仿函数中加入了统计调用函数次数的功能。那么在我使用仿函数的时候，就可以自动实现统计次数的功能. 所以说，更加智能。</li><li>灵活性：或者说，每个仿函数都可以有自己的类型. 由于仿函数是泛型编程的一个例证, 它可以任意   指定类型。</li><li>通常比一般函数速度更快：尤其是大量调用函数的过程中. 比如说：STL排序的时候,所需要的那个排序规则(为一个bool型的函数).</li></ol><h1 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h1><h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compare</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a &lt; b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Function</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">comp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, Function func)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">func</span>(a, b))</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; b &lt;&lt; <span class="string">&quot; is bigger than &quot;</span> &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; a &lt;&lt; <span class="string">&quot; is bigger than &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">6</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">2</span>;</span><br><span class="line">    Compare com;</span><br><span class="line">    <span class="built_in">comp</span>(a, b, com);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="与普通函数对比"><a href="#与普通函数对比" class="headerlink" title="与普通函数对比"></a>与普通函数对比</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompareObject</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span> </span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;仿函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> number, <span class="type">int</span> number2)</span> </span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;仿函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看c++ for_each源码自定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShowActionObj</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> content)</span> </span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;custom 仿函数&quot;</span> &lt;&lt; content &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调方式</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showAction</span><span class="params">(<span class="type">int</span> content)</span> </span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;custom 普通函数&quot;</span> &lt;&lt; content &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 直接调用仿函数</span></span><br><span class="line">CompareObject fun1;</span><br><span class="line"><span class="built_in">fun1</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以回调方式调用</span></span><br><span class="line">set&lt;<span class="type">int</span>&gt; setVar&#123; <span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span> &#125;;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;使用仿函数:&quot;</span> &lt;&lt; endl;</span><br><span class="line">for_each(setVar.<span class="built_in">begin</span>(), setVar.<span class="built_in">end</span>(), <span class="built_in">ShowActionObj</span>());</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;使用普通函数&quot;</span> &lt;&lt; endl;</span><br><span class="line">for_each(setVar.<span class="built_in">begin</span>(), setVar.<span class="built_in">end</span>(), showAction);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">仿函数</span><br><span class="line">使用仿函数:</span><br><span class="line">custom 仿函数10</span><br><span class="line">custom 仿函数20</span><br><span class="line">custom 仿函数30</span><br><span class="line">custom 仿函数40</span><br><span class="line">custom 仿函数50</span><br><span class="line">custom 仿函数60</span><br><span class="line">使用普通函数</span><br><span class="line">custom 普通函数10</span><br><span class="line">custom 普通函数20</span><br><span class="line">custom 普通函数30</span><br><span class="line">custom 普通函数40</span><br><span class="line">custom 普通函数50</span><br><span class="line">custom 普通函数60</span><br></pre></td></tr></table></figure><p>补充 <code>for_eace</code> 的源码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_InIt</span>, <span class="keyword">class</span> <span class="title class_">_Fn</span>&gt;</span><br><span class="line"><span class="function">_CONSTEXPR20 _Fn <span class="title">for_each</span><span class="params">(_InIt _First, _InIt _Last, _Fn _Func)</span> </span>&#123; <span class="comment">// perform function for each element [_First, _Last)</span></span><br><span class="line">    _Adl_verify_range(_First, _Last);</span><br><span class="line">    <span class="keyword">auto</span> _UFirst      = _Get_unwrapped(_First);</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> _ULast = _Get_unwrapped(_Last);</span><br><span class="line">    <span class="keyword">for</span> (; _UFirst != _ULast; ++_UFirst) &#123;</span><br><span class="line">        _Func(*_UFirst);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _Func;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul><li><a href="https://blog.csdn.net/Edidaughter/article/details/124398393">C++仿函数_c++ 仿函数_我要精通C++的博客-CSDN博客</a></li><li><a href="https://www.jianshu.com/p/c7612337b173">C++ 仿函数 - 简书</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>using 用法整理</title>
      <link href="/Code/CPP/using/"/>
      <url>/Code/CPP/using/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><blockquote><p>简单整理一下using的用法</p></blockquote><h1 id="一、命名空间"><a href="#一、命名空间" class="headerlink" title="一、命名空间"></a>一、命名空间</h1><p>命名空间的用法相对简单哈</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////</span></span><br><span class="line"></span><br><span class="line">namepsapce nsmine &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cout</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">namespace</span> minedefine &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> MINE <span class="string">&quot;mine&quot;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> nsmine;</span><br><span class="line"><span class="keyword">using</span> nsmine::minedefine;</span><br></pre></td></tr></table></figure><h1 id="二、使用using起别名"><a href="#二、使用using起别名" class="headerlink" title="二、使用using起别名"></a>二、使用using起别名</h1><p>相当于 <code>typedef</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::vector&lt;<span class="type">int</span>&gt; intvec;</span><br><span class="line"><span class="keyword">using</span> intvec= std::vector&lt;<span class="type">int</span>&gt;;</span><br></pre></td></tr></table></figure><p>以上两种写法等价。同样两种方式也都适用于函数别名的声明。如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码 2-2</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*FP)</span> <span class="params">(<span class="type">int</span>, <span class="type">const</span> std::string&amp;)</span></span>;</span><br></pre></td></tr></table></figure><p>代码 2-2 使用 <code>typedef</code> 为 <code>void (int, const std::string&amp;)</code> 创建了一个别名 <code>FP</code>。同样我们使用using来做这个操作，函数返回类型是<code>void</code>，接收参数为<code>int,const std::string&amp;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Fp = <span class="built_in">void</span> (*) (<span class="type">int</span>, <span class="type">const</span> std::string&amp;);</span><br></pre></td></tr></table></figure><p>using的写法把别名的名字强制分离到了左边，而把别名指向的放在了右边，比较清晰，可读性比较好。比如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">std::string</span> <span class="params">(Foo::* fooMemFnPtr)</span> <span class="params">(<span class="type">const</span> std::string&amp;)</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">using</span> fooMemFnPtr = std::<span class="built_in">string</span> (Foo::*) (<span class="type">const</span> std::string&amp;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>std::future</title>
      <link href="/Code/CPP/std/future/"/>
      <url>/Code/CPP/std/future/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述: <code>std::future</code> 的用法整理</p></blockquote><p>[toc]</p><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::future &lt; T &gt; f</span><br></pre></td></tr></table></figure><p><code>std::future</code>是C++11标准库（并发支持库）中的一个<a href="https://so.csdn.net/so/search?q=%E6%A8%A1%E6%9D%BF%E7%B1%BB&spm=1001.2101.3001.7020">模板类</a>，它表示一个异步操作的结果。当我们在多线程编程中使用异步任务时，<code>std::future</code>可以帮助我们在需要的时候获取任务的执行结果。<code>std::future</code>的一个重要特性是能够阻塞当前线程，直到异步操作完成，从而确保我们在获取结果时不会遇到未完成的操作。</p><h1 id="成员函数"><a href="#成员函数" class="headerlink" title="成员函数"></a>成员函数</h1><ul><li>构造函数<ul><li><code>future() noexcept</code>: 默认构造函数。构造无共享状态的 <code>std::future </code>。构造后， <code>valid()</code> &#x3D;&#x3D; false</li><li><code>future( future&amp;&amp; other ) noexcept</code>:移动构造函数。用移动语义，以 other 的共享状态构造 std::future 。构造后 other.<code>valid()</code> &#x3D;&#x3D; false 。</li><li><code>future( const future&amp; other ) = delete</code> : 不可复制构造 (CopyConstructible) 。</li></ul></li><li>析构函数 <code>~future()</code>;</li><li>operator&#x3D;<ul><li><code>future&amp; operator=( future&amp;&amp; other ) noexcept</code>:释放任何共享状态并移动赋值 other 的内容给 *this 。赋值后， other.valid() &#x3D;&#x3D; false 且 this-&gt;valid() 将产生与 other.valid() 在赋值前相同的值。</li><li><code>future&amp; operator=( const future&amp; other ) = delete</code>: 不可复制赋值 (CopyAssignable) 。</li></ul></li><li><code>share() noexcept</code>: 转移 *this 的共享状态到 <code>std::shared_future</code> 对象。多个<code> std::shared_future</code> 对象可引用同一共享对象，调用后<code>valid()</code> &#x3D;&#x3D; <strong>false</strong> 。</li><li><code>T get()</code>: get 方法等待直至 future 拥有合法结果并（依赖于使用哪个模板）获取它。它等效地调用 <code>wait()</code> 等待结果。泛型模板和二个模板特化各含单个 get 版本。 get 的三个版本仅在返回类型有别。若调用此函数前 <code>valid()</code> 为 false 则行为未定义。释放任何共享状态。调用此方法后<code>valid()</code> 为 false 。</li><li><code>bool valid()</code>: 检查future是否可以共享状态。</li><li><code>wait()</code>: 等待结果变得可用</li><li>wait_for</li><li>wait_until</li></ul><h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><ol><li><strong>异步操作的结果获取</strong>：<code>std::future</code>提供了一种机制，允许我们在多线程环境中安全地获取异步操作的结果。</li><li><strong>隐藏异步操作的细节</strong>：<code>std::future</code>将异步操作的结果封装起来，使程序员无需关注线程同步和通信的具体实现细节。</li><li><strong>线程同步</strong>：通过阻塞等待异步操作完成，<code>std::future</code>可以确保我们在继续执行其他操作之前，已经获取了所需的结果。</li><li><strong>异常处理</strong>：<code>std::future</code>可以捕获异步操作中抛出的异常，并在获取结果时重新抛出，也可以在主线程中对其进行处理，从而使得异常处理更加简单。</li><li><strong>提高性能</strong>：<code>std::future</code>使得我们能够更好地利用多核处理器的性能，通过并行执行任务来提高程序的执行效率。</li></ol><h1 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h1><h2 id="异步任务"><a href="#异步任务" class="headerlink" title="异步任务"></a>异步任务</h2><p>当我们需要在后台执行一些耗时操作时，如<a href="https://so.csdn.net/so/search?q=%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99&spm=1001.2101.3001.7020">文件读写</a>、网络请求或计算密集型任务，<code>std::future</code>可以用来表示这些异步任务的结果。通过将任务与主线程分离，我们可以实现任务的并行处理，从而提高程序的执行效率。</p><h2 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h2><p>在<a href="https://so.csdn.net/so/search?q=%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B&spm=1001.2101.3001.7020">多线程编程</a>中，我们可能需要等待某些任务完成后才能继续执行其他操作。通过使用<code>std::future</code>，我们可以实现线程之间的同步，确保任务完成后再获取结果并继续执行后续操作。</p><h2 id="结果获取"><a href="#结果获取" class="headerlink" title="结果获取"></a>结果获取</h2><p><code>std::future</code>提供了一种安全的方式来获取异步任务的结果。我们可以使用<code>std::future::get()</code>函数来获取任务的结果。此函数会阻塞当前线程，直到异步操作完成。这样，在调用<code>get()</code>函数时，我们可以确保已经获取到了所需的结果。如果异步操作中发生了异常，<code>get()</code>函数会将异常重新抛出，使得我们能够处理这些异常。</p><h1 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h1><h2 id="使用std-async关联异步任务"><a href="#使用std-async关联异步任务" class="headerlink" title="使用std::async关联异步任务"></a>使用std::async关联异步任务</h2><p>使用<code>std::async</code>将任务与<code>std::future</code>关联。它创建并运行一个异步任务，并返回一个与该任务结果关联的<code>std::future</code>对象。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">long_running_task</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// std::future&lt;int&gt; 声明的类型与 long_running_task 返回值类型必须一致</span></span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; result_future = std::<span class="built_in">async</span>(std::launch::async, long_running_task);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在此处执行其他操作</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用std-promise与std-future配合"><a href="#使用std-promise与std-future配合" class="headerlink" title="使用std::promise与std::future配合"></a>使用std::promise与std::future配合</h2><p><code>std::promise</code>是另一种与<code>std::future</code>配合使用的方式。我们可以使用<code>std::promise</code>对象来显式地设置任务的结果，而<code>std::future</code>对象则用于获取这个结果。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">long_running_task</span><span class="params">(std::promise&lt;<span class="type">int</span>&gt; result_promise)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 执行长时间运行的任务</span></span><br><span class="line">    <span class="type">int</span> result = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将结果设置到promise对象中</span></span><br><span class="line">    result_promise.<span class="built_in">set_value</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::promise&lt;<span class="type">int</span>&gt; result_promise;</span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; result_future = result_promise.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个新线程，执行长时间运行的任务</span></span><br><span class="line">    <span class="function">std::thread <span class="title">task_thread</span><span class="params">(long_running_task, std::move(result_promise))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在此处执行其他操作</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    task_thread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结果获取与异常处理"><a href="#结果获取与异常处理" class="headerlink" title="结果获取与异常处理"></a>结果获取与异常处理</h2><p>使用<code>std::future::get()</code> 函数可以获取异步任务的结果。此函数会阻塞当前线程，直到异步操作完成。如果异步操作中发生了异常，<code>get()</code>函数会将异常重新抛出。</p><p>:warning: 注意：std::future::get()函数只能被调用一次。在调用get()之后，std::future对象将变为无效状态。</p><p>:construction: 如果需要多次访问结果，可以考虑使用std::shared_future。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Exception caught: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Unknown exception caught&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::<span class="function">chrono::milliseconds <span class="title">timeout</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">std::future_status status = result_future.<span class="built_in">wait_for</span>(timeout);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (status == std::future_status::ready) &#123;</span><br><span class="line">    <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Timeout: the task is still running&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><p>在使用<code>std::future</code>时，需要注意以下几点：</p><ol><li><code>std::future::get()</code>函数只能被<strong>调用一次</strong>。调用get()之后，<code>std::future</code>对象将变为无效状态。如果需要多次访问结果，可以考虑使用<a href="https://blog.csdn.net/qq_41898196/article/details/129739091#std::shared_future">std::shared_future</a>。</li><li><code>std::future</code>对象不可拷贝，但可以通过移动构造函数或移动赋值操作符进行转移。这意味着我们不能将std::future对象存储在容器中，除非使用<a href="https://blog.csdn.net/qq_41898196/article/details/129739091#std::shared_future">std::shared_future</a>或指针包装。</li><li>当使用<code>std::async</code>时，默认情况下，任务可能会在当前线程上下文中执行。这取决于库实现和系统资源。若要确保任务在新线程中执行，可以使用<code>std::launch::async</code>标志：</li></ol><blockquote><p>std::future result_future &#x3D; std::async(std::launch::async, long_running_task);</p></blockquote><ol><li>如果std::future对象在析构时仍关联着一个有效的异步操作，且该操作尚未完成，析构函数会阻塞等待操作完成。在某些情况下，这可能导致程序死锁。为了避免这个问题，可以在析构std::future对象之前显式地调用wait()、wait_for()或wait_until()函数。</li><li>虽然<code>std::future</code>在获取异步任务结果和线程同步方面非常有用，但它并不能解决所有并发问题。例如，<code>std::future</code>无法用于实现复杂的并发模式，如线程池、工作窃取等。对于这些高级并发需求，可能需要使用其他库或者自定义实现。</li><li>使用<code>std::promise</code>和<code>std::future</code>时，需要确保在调用<code>get()</code>之前已经设置了对应的值，否则会导致未定义的行为。这可能需要对代码进行仔细的设计和调试，以确保正确的执行顺序。</li><li><code>std::future</code>对象的生命周期需要仔细管理。如果<code>std::future</code>对象被提前销毁，那么关联的异步任务可能会变得不可访问。因此，需要确保在异步任务完成之前保持<code>std::future</code>对象的有效性。</li><li>在某些情况下，使用<code>std::future</code>可能会导致性能下降。例如，当多个线程频繁地等待异步操作结果时，可能会导致线程阻塞和上下文切换开销。为了避免这个问题，可以考虑使用非阻塞的方式查询异步操作状态，如<code>std::future::wait_for()</code>和<code>std::future::wait_until()</code>函数。这样，我们可以在异步操作未完成时执行其他任务，提高程序的响应性和并发性能。</li><li><code>std::future</code>并不适用于所有场景。例如，它不适用于需要处理多个输入或输出结果的任务，或者需要实现动态任务依赖关系的场景。在这些情况下，可能需要寻找其他并发和同步解决方案。</li><li>虽然<code>std::future</code>提供了异常处理机制，但需要注意的是，一旦<code>std::future::get()</code>函数重新抛出异常，该异常需要在调用<code>get()</code>的线程中进行捕获和处理。这意味着需要在主线程和其他线程中设置适当的异常处理策略，以确保程序的稳定性和健壮性。</li></ol><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="std-shared-future"><a href="#std-shared-future" class="headerlink" title="std::shared_future"></a>std::shared_future</h2><p><code>std::shared_future</code>是<code>std::future</code>的一个变体，允许多个线程共享同一个异步操作的结果。与<code>std::future</code>不同，<code>std::shared_future</code>对象可以被拷贝，因此可以将其存储在容器中或在多个线程之间传递。此外，<code>std::shared_future::get()</code>函数可以被多次调用，而不会使<code>std::shared_future</code>对象变为无效状态。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_result</span><span class="params">(std::shared_future&lt;<span class="type">int</span>&gt; result_future)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::promise&lt;<span class="type">int</span>&gt; result_promise;</span><br><span class="line">    std::shared_future&lt;<span class="type">int</span>&gt; result_future = result_promise.<span class="built_in">get_future</span>().<span class="built_in">share</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(print_result, result_future)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(print_result, result_future)</span></span>;</span><br><span class="line"></span><br><span class="line">    result_promise.<span class="built_in">set_value</span>(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="std-future-status"><a href="#std-future-status" class="headerlink" title="std::future_status"></a>std::future_status</h2><p><code>std::future_status</code>是一个枚举类型，表示异步操作的状态。它有三个可能的值：</p><ul><li><code>std::future_status::ready</code>：异步操作已完成，结果可用。</li><li><code>std::future_status::timeout</code>：异步操作尚未完成，等待已超时。</li><li><code>std::future_status::deferred</code>：异步操作已被延迟，尚未启动（仅当使用<code>std::launch::deferred</code>策略创建<code>std::future</code>对象时才可能出现）。</li></ul><p>我们可以使用<code>std::future::wait_for()</code>和<code>std::future::wait_until()</code>函数查询异步操作的状态，而无需阻塞当前线程。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">long_running_task</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::future&lt;<span class="type">int</span>&gt; result_future = std::<span class="built_in">async</span>(std::launch::async, long_running_task);</span><br><span class="line"></span><br><span class="line">    std::<span class="function">chrono::milliseconds <span class="title">timeout</span><span class="params">(<span class="number">1000</span>)</span></span>;</span><br><span class="line">    std::future_status status = result_future.<span class="built_in">wait_for</span>(timeout);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == std::future_status::ready) &#123;</span><br><span class="line">        <span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Timeout: the task is still running&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 等待任务完成，以便正确获取结果</span></span><br><span class="line"><span class="type">int</span> result = result_future.<span class="built_in">get</span>();</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Final result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>在上面的示例中，我们使用了<code>std::future::wait_for()</code>函数来查询异步操作的状态。如果状态为<code>std::future_status::ready</code>，我们可以立即获取结果。否则，我们可以在等待期间执行其他任务，以提高程序的响应性和并发性能。最后，在退出<code>main</code>函数之前，我们会调用<code>result_future.get()</code>以确保正确获取异步操作的结果。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
          <category> std </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> future </tag>
            
            <tag> std </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>队列和栈的互相实现</title>
      <link href="/Code/CPP/STL/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88%E7%9A%84%E4%BA%92%E7%9B%B8%E5%AE%9E%E7%8E%B0/"/>
      <url>/Code/CPP/STL/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88%E7%9A%84%E4%BA%92%E7%9B%B8%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：1. 用队列实现栈；2. 用栈实现队列</p><p>队列: 先进先出</p><p>栈：先进后出</p></blockquote><h1 id="队列实现栈"><a href="#队列实现栈" class="headerlink" title="队列实现栈"></a>队列实现栈</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>1. </p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(queueSta.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            queueSta.<span class="built_in">push</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> cnt = queueSta.<span class="built_in">size</span>();</span><br><span class="line">            queueSta.<span class="built_in">push</span>(val);</span><br><span class="line">            <span class="keyword">while</span>(cnt-- &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                queueSta.<span class="built_in">push</span>(queueSta.<span class="built_in">front</span>());</span><br><span class="line">                queueSta.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Pop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = queueSta.<span class="built_in">front</span>();</span><br><span class="line">        queueSta.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Empty</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> queueSta.<span class="built_in">empty</span>();&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  queue&lt;<span class="type">int</span>&gt; queueSta;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="栈实现队列"><a href="#栈实现队列" class="headerlink" title="栈实现队列"></a>栈实现队列</h1><h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><h2 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      sta1.<span class="built_in">push</span>(val);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Pop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(sta2.<span class="built_in">empty</span>())</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">while</span>(!sta1.<span class="built_in">empty</span>())</span><br><span class="line">          &#123;</span><br><span class="line">              sta2.<span class="built_in">push</span>(sta1.<span class="built_in">top</span>());</span><br><span class="line">              sta1.<span class="built_in">pop</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">int</span> res = sta2.<span class="built_in">top</span>();</span><br><span class="line">      sta2.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; sta1,sta2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
          <category> STL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> 队列 </tag>
            
            <tag> 栈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++开发工作经验</title>
      <link href="/Code/CPP/README/"/>
      <url>/Code/CPP/README/</url>
      
        <content type="html"><![CDATA[<ol><li><h2 id="睡眠"><a href="#睡眠" class="headerlink" title="睡眠"></a>睡眠</h2></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">头文件定义：</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>));<span class="comment">//睡眠1000毫秒（1秒）</span></span><br><span class="line">等同：</span><br><span class="line">std::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">1000</span>)</span></span>;</span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(dura);</span><br></pre></td></tr></table></figure><h2 id="2-随机字符串"><a href="#2-随机字符串" class="headerlink" title="2. 随机字符串"></a>2. 随机字符串</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">SPString::RandomString</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::string chars&#123; <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span> &#125;;</span><br><span class="line">std::random_device rd;</span><br><span class="line"><span class="function">std::mt19937 <span class="title">generator</span><span class="params">(rd())</span></span>;</span><br><span class="line">std::string output;</span><br><span class="line"></span><br><span class="line">output.<span class="built_in">reserve</span>(length);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> len_chars = chars.<span class="built_in">length</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">auto</span> randNumb = <span class="built_in">generator</span>();</span><br><span class="line"><span class="keyword">while</span> (randNumb &gt; len_chars &amp;&amp; length--)</span><br><span class="line">&#123;</span><br><span class="line">output.<span class="built_in">push_back</span>(chars[randNumb % len_chars]);</span><br><span class="line">randNumb /= len_chars;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-随机数"><a href="#3-随机数" class="headerlink" title="3. 随机数"></a>3. 随机数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成随机数  </span></span><br><span class="line">std::random_device rd;</span><br><span class="line"><span class="function">std::mt19937 <span class="title">gen</span><span class="params">(rd())</span></span>;</span><br><span class="line">std::uniform_int_distribution&lt;&gt; <span class="built_in">dis</span>(<span class="number">0</span>, <span class="number">999</span>);</span><br><span class="line"><span class="type">int</span> nId = <span class="built_in">dis</span>(gen);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++常用写法整理</title>
      <link href="/Code/CPP/STL/thread/C++%E5%B8%B8%E7%94%A8%E5%86%99%E6%B3%95%E6%95%B4%E7%90%86/"/>
      <url>/Code/CPP/STL/thread/C++%E5%B8%B8%E7%94%A8%E5%86%99%E6%B3%95%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="线程睡眠"><a href="#线程睡眠" class="headerlink" title="线程睡眠"></a>线程睡眠</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">头文件定义：</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>));<span class="comment">//睡眠1000毫秒（1秒）</span></span><br><span class="line">等同：</span><br><span class="line">std::<span class="function">chrono::milliseconds <span class="title">dura</span><span class="params">(<span class="number">1000</span>)</span></span>;</span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(dura);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
          <category> STL </category>
          
          <category> thread </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stl </tag>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Json11 C++ 用法总结</title>
      <link href="/Code/CPP/Json11/"/>
      <url>/Code/CPP/Json11/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">std::string strMsg =</span><br><span class="line"><span class="string">R&quot;(&#123;</span></span><br><span class="line"><span class="string">  &quot;user&quot; :&quot;test&quot;,</span></span><br><span class="line"><span class="string">  &quot;status&quot;:&quot;login&quot;,  //登录状态：login、logout</span></span><br><span class="line"><span class="string">  &quot;result&quot;:&quot;1&quot;,      //登录和登出结果，1表示成功，0表示失败</span></span><br><span class="line"><span class="string">  &quot;reason&quot;:&quot;&quot;, //原因，比如超时退出，准入策略限制导致登录失败等</span></span><br><span class="line"><span class="string">  &quot;token&quot;:&quot;xxx&quot;      //token内容</span></span><br><span class="line"><span class="string">&#125;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    std::string strMsg_empty = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    Json::object jstest = Json::object&#123;&#125;;</span><br><span class="line">    string err;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> json = Json::<span class="built_in">parse</span>(strMsg_empty, err, JsonParse::COMMENTS);</span><br><span class="line"></span><br><span class="line">    jstest[<span class="string">&quot;msgtype&quot;</span>] = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    jstest[<span class="string">&quot;data&quot;</span>] = (json);</span><br><span class="line"></span><br><span class="line">    Json json1 = <span class="built_in">Json</span>(jstest);</span><br><span class="line">    std::cout &lt;&lt; json1.<span class="built_in">dump</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> Json obj = Json::<span class="built_in">object</span>(&#123;</span><br><span class="line">&#123; <span class="string">&quot;msgtype&quot;</span>, <span class="string">&quot;TEST&quot;</span> &#125;,</span><br><span class="line">&#123; <span class="string">&quot;data&quot;</span>, json &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; obj.<span class="built_in">dump</span>() &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字符串类型转换整理(char、TCHAR、string、wstring、CString、WCHAR)</title>
      <link href="/Code/CPP/C++%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/"/>
      <url>/Code/CPP/C++%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="string-lt-–-gt-CString"><a href="#string-lt-–-gt-CString" class="headerlink" title="string &lt;–&gt; CString"></a>string &lt;–&gt; CString</h1><h2 id="string-gt-CString"><a href="#string-gt-CString" class="headerlink" title="string -&gt; CString"></a>string -&gt; CString</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::string str = <span class="string">&quot;string&quot;</span>;</span><br><span class="line">CString csRet;</span><br><span class="line"><span class="comment">// csRet.Format(&quot;%s&quot;, str.c_str());</span></span><br><span class="line"><span class="comment">// 如果上句报错就使用</span></span><br><span class="line">csRet.<span class="built_in">Format</span>(_T(<span class="string">&quot;%s&quot;</span>), str.<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure><h2 id="CString-gt-string"><a href="#CString-gt-string" class="headerlink" title="CString -&gt; string"></a>CString -&gt; string</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CString <span class="title">cstr</span><span class="params">(<span class="string">&quot;string&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">string </span><br></pre></td></tr></table></figure><h1 id="string-lt-–-gt-wstring"><a href="#string-lt-–-gt-wstring" class="headerlink" title="string &lt; – &gt; wstring"></a>string &lt; – &gt; wstring</h1><h2 id="string-gt-wstring"><a href="#string-gt-wstring" class="headerlink" title="string -&gt; wstring"></a>string -&gt; wstring</h2><p>solution 1：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//convert string to wstring</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> std::wstring <span class="title">to_wide_string</span><span class="params">(<span class="type">const</span> std::string&amp; input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;&gt; converter;</span><br><span class="line"><span class="keyword">return</span> converter.<span class="built_in">from_bytes</span>(input);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>solution 2:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">wstring <span class="title">stringToWstring</span><span class="params">(std::string str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    wstring result = <span class="string">L&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> nLen = <span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, str.<span class="built_in">c_str</span>(), str.<span class="built_in">size</span>(), <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nLen == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    TCHAR* buffer = <span class="keyword">new</span> TCHAR[nLen + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, str.<span class="built_in">c_str</span>(), str.<span class="built_in">size</span>(), buffer, nLen);</span><br><span class="line"></span><br><span class="line">    buffer[nLen] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    result.<span class="built_in">append</span>(buffer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] buffer;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="wstring-gt-string"><a href="#wstring-gt-string" class="headerlink" title="wstring -&gt; string"></a>wstring -&gt; string</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//convert wstring to string </span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> std::string <span class="title">to_byte_string</span><span class="params">(<span class="type">const</span> std::wstring&amp; input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;&gt; converter;</span><br><span class="line"><span class="keyword">return</span> converter.<span class="built_in">to_bytes</span>(input);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DWORD-lt-—-gt-string"><a href="#DWORD-lt-—-gt-string" class="headerlink" title="DWORD &lt;—&gt; string"></a>DWORD &lt;—&gt; string</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">DwordToString</span><span class="params">(DWORD val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string cur_str = <span class="built_in">to_string</span>(<span class="type">long</span> <span class="built_in">long</span> (val));</span><br><span class="line"><span class="keyword">return</span> cur_str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD <span class="title">StringToDword</span><span class="params">(string val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DWORD cur_dword;</span><br><span class="line"><span class="built_in">sscanf</span>(val.<span class="built_in">c_str</span>(),<span class="string">&quot;%ul&quot;</span>,&amp;cur_dword);</span><br><span class="line"><span class="keyword">return</span> cur_dword;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多查看已实现的编码转换文件：</p><p><a href="../../../Demo/Visual%20Studio/Utils/win_str_utills/README">win_str_utils</a></p><p><a href="../../../Demo/Visual%20Studio/Utils/win_str_utills/README.md">win_str_utils.md</a></p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> String </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lambda表达式</title>
      <link href="/Code/CPP/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/Code/CPP/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>概述：lambda表达式使用及说明</p></blockquote><p>[toc]</p><h1 id="lambda表达式说明"><a href="#lambda表达式说明" class="headerlink" title="lambda表达式说明"></a>lambda表达式说明</h1><p>lambda表达式的结构如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> func = [capture] (params) opt -&gt; ret &#123; func_body; &#125;;</span><br></pre></td></tr></table></figure><p>其中 func 是可以当作 lambda 表达式的名字，作为一个函数使用，capture 是捕获列表，params 是参数表，opt： 不需要可以省略。 （mutable: 可以修改按值传递进来的拷贝（注意是能修改拷贝，而不是值本身）exception: 指定函数抛出的异常，如抛出整数类型的异常，可以使用 throw ()）， ret 是返回值类型，func_body 是函数体。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> f = [](<span class="type">int</span> a) -&gt; <span class="type">int</span> &#123; <span class="keyword">return</span> a + <span class="number">1</span>; &#125;;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">f</span>(<span class="number">1</span>) &lt;&lt; std::endl;  <span class="comment">// 输出: 2</span></span><br></pre></td></tr></table></figure><h1 id="使用-lambda-表达式捕获列表"><a href="#使用-lambda-表达式捕获列表" class="headerlink" title="使用 lambda 表达式捕获列表"></a>使用 lambda 表达式捕获列表</h1><p>lambda 表达式还可以通过捕获列表捕获一定范围内的变量：</p><ul><li>[] 不捕获任何变量。</li><li>[&amp;] 捕获外部作用域中所有变量，并作为引用在函数体中使用（按引用捕获）。</li><li>[&#x3D;] 捕获外部作用域中所有变量，并作为副本在函数体中使用（按值捕获）。</li><li>[&#x3D;，&amp;foo] 按值捕获外部作用域中所有变量，并按引用捕获 foo 变量。</li><li>[bar] 按值捕获 bar 变量，同时不捕获其他变量。</li><li>[this] 捕获当前类中的 this 指针，让 lambda 表达式拥有和当前类成员函数同样的访问权限。如果已经使用了 &amp; 或者 &#x3D;，就默认添加此选项。捕获 this 的目的是可以在 lamda 中使用当前类的成员函数和成员变量。</li></ul><h2 id="捕获列表使用实例"><a href="#捕获列表使用实例" class="headerlink" title="捕获列表使用实例"></a>捕获列表使用实例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lambdaTest</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">output</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//auto x1 = [] &#123;return m_number; &#125;;// error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> x2 = [=] &#123;<span class="keyword">return</span> m_number + x + y; &#125;;<span class="comment">// ok</span></span><br><span class="line"><span class="comment">// auto x3 = [=] &#123; x = 2; return m_number + x + y; &#125;;// error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> x4 = [&amp;] &#123;<span class="keyword">return</span> m_number + x + y; &#125;;<span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> x5 = [<span class="keyword">this</span>] &#123;<span class="keyword">return</span> m_number; &#125;;<span class="comment">// ok</span></span><br><span class="line"><span class="comment">//auto x6 = [this] &#123;return m_number + x + y; &#125;;// error</span></span><br><span class="line"><span class="keyword">auto</span> x7 = [<span class="keyword">this</span>, x, y] &#123;<span class="keyword">return</span> m_number + x + y; &#125;;<span class="comment">// ok</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> m_number = <span class="number">100</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">lambdaTest test;</span><br><span class="line"></span><br><span class="line">test.<span class="built_in">output</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">函数</th><th>是否可读</th><th>是否可修改</th><th>说明</th></tr></thead><tbody><tr><td align="center">x1</td><td>:x:</td><td>:x:</td><td>错误，没有捕获外部变量，不能使用任何外部变量</td></tr><tr><td align="center">x2</td><td>:heavy_check_mark:</td><td>:x:</td><td>正确，值传递，可以访问所有外部变量</td></tr><tr><td align="center">x3</td><td>:heavy_check_mark:</td><td>:x:</td><td>错误，值传递，右值可读不可修改</td></tr><tr><td align="center">x4</td><td>:heavy_check_mark:</td><td>:heavy_check_mark:</td><td>正确，引用传递，可读可修改</td></tr><tr><td align="center">x5</td><td>:heavy_check_mark: this指针的成员变量可读<br />:x: 其他变量不可读</td><td>:heavy_check_mark: this指针的成员可写<br />:x: 其他变量不可写</td><td>正确，捕获this指针，可访问this指针的成员</td></tr><tr><td align="center">x6</td><td>同 <code>x5</code></td><td>同 <code>x5</code></td><td>错误，捕获 this 指针，<code>x</code> 和 <code>y</code> 不是其成员变量，不可访问</td></tr><tr><td align="center">x7</td><td>:heavy_check_mark: 值传递三个变量，均可读</td><td>:heavy_check_mark: this指针成员可修改 <br />:x: x 和 y 不可修改</td><td>正确，捕获 this 指针，x,y</td></tr></tbody></table><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p>lambda表达式的返回值通过 ‘-&gt;’ 传递，如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> add = [](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;；</span><br></pre></td></tr></table></figure><p>如上所示的返回类型还可以使用 <code>decltype</code> 推导返回类型：</p><blockquote><p><code>decltype</code> 是一个 C++ 关键字，它用于在编译时推断表达式的类型。这在编写通用代码时非常有用，特别是在使用 C++11 引入的 <code>auto</code> 关键字和范围 for 循环时。</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> add = [](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="keyword">decltype</span>(x+y) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;；</span><br></pre></td></tr></table></figure><p>说明：<code>decltype(a + b)</code> 推导了 <code>a + b</code> 的结果类型，并将该类型作为 lambda 函数的返回类型。</p><p>甚至，从 C++14 开始，还可以使用更简洁的方式来推导 lambda 函数的返回类型，即使用 <code>auto</code> 关键字。例如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> myLambda = [](<span class="type">int</span> a, <span class="type">int</span> b) -&gt; <span class="keyword">auto</span> &#123; <span class="keyword">return</span> a + b; &#125;;</span><br></pre></td></tr></table></figure><p>需要注意的是，使用 <code>auto</code> 推导返回类型的 lambda 函数在某些情况下可能会引发歧义。例如，如果你在 lambda 表达式中返回一个嵌套类型（如 <code>std::pair</code>），<code>auto</code> 可能会被推导为 <code>std::pair</code>，而不是你期望的嵌套类型的具体类型。在这种情况下，使用 <code>decltype</code> 可以更明确地指定返回类型。</p><h2 id="其他关键字"><a href="#其他关键字" class="headerlink" title="其他关键字"></a>其他关键字</h2><p>使用 lambda 表达式捕获列表捕获外部变量，如果希望去修改按值捕获的外部变量，那么应该如何处理呢？这就需要使用 mutable 选项，<code>被mutable修改是lambda表达式就算没有参数也要写明参数列表，并且可以去掉按值捕获的外部变量的只读（const）属性。</code></p><h3 id="mutable"><a href="#mutable" class="headerlink" title="mutable"></a>mutable</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">auto</span> f1 = [=] &#123;<span class="keyword">return</span> a++; &#125;;              <span class="comment">// error, 按值捕获外部变量, a是只读的</span></span><br><span class="line"><span class="keyword">auto</span> f2 = [=]()<span class="keyword">mutable</span> &#123;<span class="keyword">return</span> a++; &#125;;     <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>:tipping_hand_man: 注意：mutable 只是允许在函数内部修改值而已，作用域仅限于 lambda 函数内部，参考以下代码及输出：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lambdaFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> add1 = [](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">int</span> &#123; <span class="keyword">return</span> x + y;&#125;;</span><br><span class="line"><span class="keyword">auto</span> add2 = [](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="keyword">decltype</span>(x + y) &#123; <span class="keyword">return</span> x + y;&#125;;</span><br><span class="line"><span class="keyword">auto</span> add3 = [](<span class="type">int</span> a, <span class="type">int</span> b) -&gt; <span class="keyword">auto</span> &#123; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> modify_add = [](<span class="type">int</span> a, <span class="type">int</span> b)  <span class="keyword">mutable</span> -&gt; <span class="keyword">auto</span> &#123; a = <span class="number">3</span>; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="keyword">auto</span> value_modify_add = [=](<span class="type">int</span> a, <span class="type">int</span> b)  <span class="keyword">mutable</span> -&gt; <span class="keyword">auto</span> &#123; a = <span class="number">4</span>; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="keyword">auto</span> refrence_modify_add = [&amp;](<span class="type">int</span> a, <span class="type">int</span> b)  <span class="keyword">mutable</span> -&gt; <span class="keyword">auto</span> &#123; a = <span class="number">5</span>; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="keyword">auto</span> refrence_modify_add_byRef = [&amp;](<span class="type">int</span>&amp; a, <span class="type">int</span> b)  <span class="keyword">mutable</span> -&gt; <span class="keyword">auto</span> &#123; a = <span class="number">6</span>; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> x = <span class="number">2</span>, y = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;add1:&quot;</span> &lt;&lt; <span class="built_in">add1</span>(x, y) &lt;&lt; endl; <span class="comment">// add1:4</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;add2:&quot;</span> &lt;&lt; <span class="built_in">add2</span>(x, y) &lt;&lt; endl; <span class="comment">// add2:4</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;add3:&quot;</span> &lt;&lt; <span class="built_in">add3</span>(x, y) &lt;&lt; endl; <span class="comment">// add3:4</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;modify_add:&quot;</span> &lt;&lt; <span class="built_in">value_modify_add</span>(x, y) &lt;&lt; endl;  <span class="comment">// modify_add:5</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=2</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;value_modify_add:&quot;</span> &lt;&lt; <span class="built_in">value_modify_add</span>(x, y) &lt;&lt; endl; <span class="comment">// value_modify_add:6</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=2</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;value_modify_add:&quot;</span> &lt;&lt; <span class="built_in">refrence_modify_add</span>(x, y) &lt;&lt; endl; <span class="comment">// value_modify_add:7</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=2</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;refrence_modify_add_byRef:&quot;</span> &lt;&lt; <span class="built_in">refrence_modify_add_byRef</span>(x, y) &lt;&lt; endl; <span class="comment">// refrence_modify_add_byRef:8</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=6</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="关于为什么通过值拷贝的方式捕获的外部变量是只读的"><a href="#关于为什么通过值拷贝的方式捕获的外部变量是只读的" class="headerlink" title="关于为什么通过值拷贝的方式捕获的外部变量是只读的:"></a>关于为什么通过值拷贝的方式捕获的外部变量是只读的:</h3><p>lambda表达式的类型在C++11中会被看做是一个带 <code>operator()</code> 的类，即仿函数。<br>按照C++标准，lambda表达式的 <code>operator()</code> 默认是 <code>const</code> 的，一个 <code>const</code> 成员函数是无法修改成员变量值的。<br><code>mutable</code> 选项的作用就在于取消 <code>operator ()</code> 的 <code>const</code> 属性。</p><p>因为 lambda 表达式在 C++ 中会被看做是一个仿函数，因此可以使用<code>std::function和std::bind</code>来存储和操作lambda表达式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">testLambdawithfunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 包装可调用函数</span></span><br><span class="line">std::function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f1 = [](<span class="type">int</span> a) &#123;<span class="keyword">return</span> a; &#125;;</span><br><span class="line"><span class="comment">// 绑定可调用函数</span></span><br><span class="line">std::function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f2 = <span class="built_in">bind</span>([](<span class="type">int</span> a) &#123;<span class="keyword">return</span> a; &#125;, placeholders::_1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定可修改的函数</span></span><br><span class="line">std::function&lt;<span class="type">int</span>(<span class="type">int</span>&amp;, <span class="type">int</span>)&gt; f3 = [](<span class="type">int</span>&amp; a, <span class="type">int</span> b) &#123; a = <span class="number">3</span>; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="comment">// 绑定可修改的函数</span></span><br><span class="line">std::function&lt;<span class="type">int</span>(<span class="type">int</span>&amp;, <span class="type">int</span>)&gt; f4 = <span class="built_in">bind</span>([](<span class="type">int</span>&amp; a, <span class="type">int</span> b) &#123; a = <span class="number">4</span>; <span class="keyword">return</span> a + b; &#125;, std::placeholders::_1, std::placeholders::_2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> x = <span class="number">2</span>, y = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f1(100)&quot;</span> &lt;&lt; <span class="built_in">f1</span>(<span class="number">100</span>) &lt;&lt; endl; <span class="comment">// f1(100)100</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f2(200)&quot;</span> &lt;&lt; <span class="built_in">f2</span>(<span class="number">200</span>) &lt;&lt; endl; <span class="comment">// f2(200)200</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f3(x, y)&quot;</span> &lt;&lt; <span class="built_in">f3</span>(x, y) &lt;&lt; endl; <span class="comment">// f3(x, y)5</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=3</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f3(x, y)&quot;</span> &lt;&lt; <span class="built_in">f4</span>(x, y) &lt;&lt; endl; <span class="comment">// f3(x, y)6</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; endl; <span class="comment">// x=4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于没有捕获任何变量的 lambda 表达式，还可以转换成一个普通的函数指针：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> func_ptr = <span class="built_in">int</span>(*)(<span class="type">int</span>);</span><br><span class="line"><span class="comment">// 没有捕获任何外部变量的匿名函数</span></span><br><span class="line">func_ptr f = [](<span class="type">int</span> a)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="built_in">f</span>(<span class="number">1314</span>);</span><br></pre></td></tr></table></figure><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul><li><a href="https://blog.csdn.net/asdasdde/article/details/116268964">C++——Lambda函数_c++ lambda函数_勿在浮沙築高臺的博客-CSDN博客</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Code/C/goto%E5%A6%99%E7%94%A8/"/>
      <url>/Code/C/goto%E5%A6%99%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>当一个条件不满足，函数要退出时，已经申请的内存没有释放，但是又需要return的情况下，可以使用goto</p></blockquote><p>以下边的函数为例，在判断<code>if(pRet[i] == NULL)</code>时，如果为空时，如果直接<code>return</code>的话，那么已经申请内存的<code>pRet</code>则成了流浪儿，未能完全释放。在这种情况下就可以使用<code>return</code>语句直接调到程序的末尾去执行释放的操作。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @fn          Merge</span></span><br><span class="line"><span class="comment"> * @brief       根据输入的int变量求其对应的hash值   </span></span><br><span class="line"><span class="comment"> * @param[in]   intervals: 需要合并的数组</span></span><br><span class="line"><span class="comment">intervalsSize: 需要合并的数组的大小</span></span><br><span class="line"><span class="comment">intervalsColSize: 需要合并的数组的数量</span></span><br><span class="line"><span class="comment"> * @param[out]returnSize: 合并区间后数组的大小</span></span><br><span class="line"><span class="comment">returncolumnSizes: 合并区间后数组的数量</span></span><br><span class="line"><span class="comment"> * @return       int: 根据哈希生成的key值</span></span><br><span class="line"><span class="comment"> *               </span></span><br><span class="line"><span class="comment"> * @detail      </span></span><br><span class="line"><span class="comment"> * @date         2021-7-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span>** <span class="title function_">Merge</span><span class="params">(_In_ <span class="type">int</span>** intervals, _In_ <span class="type">int</span> intervalsSize, _In_ <span class="type">int</span>* intervalsColSize,</span></span><br><span class="line"><span class="params">_Out_ <span class="type">int</span>* returnSize, _Out_ <span class="type">int</span>** returnColumnSizes)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果只有一个区间，直接返回 <span class="doctag">TODO:</span>有必要的情况下-》申请内存</span></span><br><span class="line"><span class="keyword">if</span>(intervalsSize == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> intervals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> nItem = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一个元素从小到大排序；如果第一个元素相等，则根据第二个元素从小到大排序</span></span><br><span class="line">    qsort(intervals, intervalsSize, <span class="keyword">sizeof</span>(<span class="type">int</span> *), Compare);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> **pRet = (<span class="type">int</span>**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>*)*ARRSIZE_MAX_N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pRet == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义返回指针</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;intervalsSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        pRet[i] = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>)*intervalsColSize[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pRet[i] == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">-<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">+<span class="keyword">goto</span> END;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(pRet[i],<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="type">int</span>)*intervalsColSize[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 先将第一个区间存入</span></span><br><span class="line">    pRet[nItem][<span class="number">0</span>] = intervals[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    pRet[nItem][<span class="number">1</span>] = intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历合并到pRet</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; intervalsSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 当前区间起点小于合并区间终点-》覆盖</span></span><br><span class="line">        <span class="keyword">if</span>(intervals[i][<span class="number">0</span>] &lt;= pRet[nItem][<span class="number">1</span>] &amp;&amp; intervals[i][<span class="number">1</span>] &gt;= pRet[nItem][<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            pRet[nItem][<span class="number">1</span>] = intervals[i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 当前区间的起点大于合并区间的终点-》下一节点</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(intervals[i][<span class="number">0</span>] &gt; pRet[nItem][<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            (nItem)++;</span><br><span class="line">            pRet[nItem][<span class="number">0</span>] = intervals[i][<span class="number">0</span>];</span><br><span class="line">            pRet[nItem][<span class="number">1</span>] = intervals[i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    *returnSize = nItem + <span class="number">1</span>;</span><br><span class="line">    *returnColumnSizes = intervalsColSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pRet;</span><br><span class="line"><span class="comment">// Issue</span></span><br><span class="line">+END:</span><br><span class="line">+<span class="built_in">free</span>(pRet);</span><br><span class="line">+<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> C </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++内存分配</title>
      <link href="/Code/CPP/C++%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"/>
      <url>/Code/CPP/C++%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<blockquote><p>C++ 程序运行期间内存分配整理</p></blockquote><p>[toc]</p><h1 id="new-内存分配"><a href="#new-内存分配" class="headerlink" title="new 内存分配"></a>new 内存分配</h1><p>在C++中，使用<code>new</code>关键字分配的内存是在虚拟内存中。虚拟内存是一种抽象概念，它允许程序以连续且固定大小的内存地址空间运行，而不管物理内存的实际配置如何。</p><p>当你使用<code>new</code>在C++中创建一个对象或数组时，内存管理器会在堆内存中分配一块空间，并返回指向这块空间的指针。即使这块空间超出了程序当前的实际物理内存，操作系统也会通过页面调度和内存映射机制来确保程序的正确运行。</p><p>因此，使用<code>new</code>分配的内存是在虚拟内存中，但操作系统会根据物理内存的实际配置进行管理。</p>]]></content>
      
      
      <categories>
          
          <category> Code </category>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 内存分配 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
